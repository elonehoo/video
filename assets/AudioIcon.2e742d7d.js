var jx=Object.defineProperty;var qx=(i,s,g)=>s in i?jx(i,s,{enumerable:!0,configurable:!0,writable:!0,value:g}):i[s]=g;var we=(i,s,g)=>(qx(i,typeof s!="symbol"?s+"":s,g),g);import{d as Ar,c as It,e as qt,y as Nt,u as _e,b as pt,_ as pg,r as Ft,o as Ba,z as yb,f as Kt,t as lo,h as jr,g as wn,A as Hx,B as ZO,j as jn,C as Gv,D as $x,E as dg,G as UD,H as Kx,N as ug,I as cu,J as Ci,K as ll,L as Bv,M as jS,O as Wx,P as WC,a as op,Q as zx,R as br,S as GS,T as Yx,U as Bw,V as oT,W as oi,X as eN,k as Rs,v as Hv,F as ic,i as nr,w as Zn,Y as rp,m as tu,Z as Va,$ as IT,a0 as ET,a1 as Jx,a2 as Xx,a3 as Qx,a4 as TT,a5 as Jo,a6 as tN,a7 as Rw,a8 as Zx,a9 as e2,aa as t2,ab as ub,ac as nN,ad as n2,ae as rN,af as eT,ag as fw,ah as r2,ai as qS,aj as al,l as i2,ak as o2,al as iN,s as oN,p as aN,n as sN}from"./index.16972d0e.js";const a2=Ar({__name:"SvgIcon",props:{iconName:null,size:null},setup(i){const s=i,g=It(()=>`${s.iconName}`),m=It(()=>`svg-icon ${s.size&&["large","medium","small"].includes(s.size)?s.size:"large"}-icon ${g.value}`);return(R,A)=>(pt(),qt("div",{class:Nt(_e(m))},null,2))}});const lb=pg(a2,[["__scopeId","data-v-a661b9b8"]]),s2=""+new URL("avatar.00b7c7aa.png",import.meta.url).href;var FS=(i=>(i.MicOn="mic-on",i.MicOff="mic-off",i.MicOffDisabled="mic-off-gray",i.CameraOn="camera-on",i.CameraOff="camera-off",i.CameraOffDisabled="camera-off-gray",i.ArrowBorderDown="arrow-border-down",i.ScreenSharing="screen-sharing",i.ScreenShare="screen-share",i.ScreenShareStopped="screen-share-stopped",i.ScreenShareDisabled="screen-share-disabled",i.ChatActive="chat-active",i.Chat="chat",i.ExitFullScreen="exit-fullscreen",i.FullScreen="full-screen",i.InviteActive="invite-active",i.Invite="invite",i.ManageMemberActive="manage-member-active",i.ManageMember="manage-member",i.More="more",i.MoreActive="more-active",i.SettingActive="setting-active",i.Setting="setting",i.LineArrowUp="line-arrow-up",i.LineArrowDown="line-arrow-down",i.ApplyOnSeat="apply",i.ApplyActive="apply-active",i.GoOffSeat="go-off-seat",i))(FS||{});const c2=["src"],u2={class:"name"},l2={key:0,class:"user-control-container"},d2=Ar({__name:"UserInfo",props:{userId:null,userName:null,userAvatar:null},emits:["logOut"],setup(i){const s=Ft(),g=Ft(!1),m=It(()=>g.value?FS.LineArrowUp:FS.LineArrowDown);function R(){g.value=!g.value}function A(D){s.value.contains(D.target)||(g.value=!1)}return Ba(()=>{window.addEventListener("click",A)}),yb(()=>{window.removeEventListener("click",A)}),(D,x)=>(pt(),qt("div",{ref_key:"userInfoRef",ref:s,class:"user-info-container"},[Kt("div",{class:"user-info-content",onClick:R},[Kt("img",{class:"avatar",src:i.userAvatar||_e(s2)},null,8,c2),Kt("div",u2,lo(i.userName||i.userId),1),jr(lb,{class:"down-icon","icon-name":_e(m),size:"medium"},null,8,["icon-name"])]),g.value?(pt(),qt("div",l2,[Kt("div",{class:"user-control-item",onClick:x[0]||(x[0]=$=>D.$emit("logOut"))},"\u9000\u51FA\u767B\u5F55")])):wn("",!0)],512))}});const L8=pg(d2,[["__scopeId","data-v-2fad6485"]]);var h2=typeof global=="object"&&global&&global.Object===Object&&global;const cN=h2;var p2=typeof self=="object"&&self&&self.Object===Object&&self,f2=cN||p2||Function("return this")();const Rd=f2;var g2=Rd.Symbol;const hg=g2;var uN=Object.prototype,m2=uN.hasOwnProperty,v2=uN.toString,tT=hg?hg.toStringTag:void 0;function _2(i){var s=m2.call(i,tT),g=i[tT];try{i[tT]=void 0;var m=!0}catch{}var R=v2.call(i);return m&&(s?i[tT]=g:delete i[tT]),R}var y2=Object.prototype,S2=y2.toString;function I2(i){return S2.call(i)}var E2="[object Null]",T2="[object Undefined]",GD=hg?hg.toStringTag:void 0;function ZS(i){return i==null?i===void 0?T2:E2:GD&&GD in Object(i)?_2(i):I2(i)}function HS(i){return i!=null&&typeof i=="object"}var M2="[object Symbol]";function Sb(i){return typeof i=="symbol"||HS(i)&&ZS(i)==M2}function R2(i,s){for(var g=-1,m=i==null?0:i.length,R=Array(m);++g<m;)R[g]=s(i[g],g,i);return R}var C2=Array.isArray;const jv=C2;var b2=1/0,FD=hg?hg.prototype:void 0,VD=FD?FD.toString:void 0;function lN(i){if(typeof i=="string")return i;if(jv(i))return R2(i,lN)+"";if(Sb(i))return VD?VD.call(i):"";var s=i+"";return s=="0"&&1/i==-b2?"-0":s}var A2=/\s/;function k2(i){for(var s=i.length;s--&&A2.test(i.charAt(s)););return s}var w2=/^\s+/;function D2(i){return i&&i.slice(0,k2(i)+1).replace(w2,"")}function dT(i){var s=typeof i;return i!=null&&(s=="object"||s=="function")}var BD=0/0,O2=/^[-+]0x[0-9a-f]+$/i,N2=/^0b[01]+$/i,L2=/^0o[0-7]+$/i,P2=parseInt;function jD(i){if(typeof i=="number")return i;if(Sb(i))return BD;if(dT(i)){var s=typeof i.valueOf=="function"?i.valueOf():i;i=dT(s)?s+"":s}if(typeof i!="string")return i===0?i:+i;i=D2(i);var g=N2.test(i);return g||L2.test(i)?P2(i.slice(2),g?2:8):O2.test(i)?BD:+i}var x2="[object AsyncFunction]",U2="[object Function]",G2="[object GeneratorFunction]",F2="[object Proxy]";function dN(i){if(!dT(i))return!1;var s=ZS(i);return s==U2||s==G2||s==x2||s==F2}var V2=Rd["__core-js_shared__"];const gw=V2;var qD=function(){var i=/[^.]+$/.exec(gw&&gw.keys&&gw.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}();function B2(i){return!!qD&&qD in i}var j2=Function.prototype,q2=j2.toString;function $v(i){if(i!=null){try{return q2.call(i)}catch{}try{return i+""}catch{}}return""}var H2=/[\\^$.*+?()[\]{}|]/g,$2=/^\[object .+?Constructor\]$/,K2=Function.prototype,W2=Object.prototype,z2=K2.toString,Y2=W2.hasOwnProperty,J2=RegExp("^"+z2.call(Y2).replace(H2,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function X2(i){if(!dT(i)||B2(i))return!1;var s=dN(i)?J2:$2;return s.test($v(i))}function Q2(i,s){return i==null?void 0:i[s]}function e0(i,s){var g=Q2(i,s);return X2(g)?g:void 0}var Z2=e0(Rd,"WeakMap");const Cw=Z2;var eU=9007199254740991,tU=/^(?:0|[1-9]\d*)$/;function nU(i,s){var g=typeof i;return s=s==null?eU:s,!!s&&(g=="number"||g!="symbol"&&tU.test(i))&&i>-1&&i%1==0&&i<s}function hN(i,s){return i===s||i!==i&&s!==s}var rU=9007199254740991;function pN(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=rU}function iU(i){return i!=null&&pN(i.length)&&!dN(i)}var oU=Object.prototype;function aU(i){var s=i&&i.constructor,g=typeof s=="function"&&s.prototype||oU;return i===g}function sU(i,s){for(var g=-1,m=Array(i);++g<i;)m[g]=s(g);return m}var cU="[object Arguments]";function HD(i){return HS(i)&&ZS(i)==cU}var fN=Object.prototype,uU=fN.hasOwnProperty,lU=fN.propertyIsEnumerable,dU=HD(function(){return arguments}())?HD:function(i){return HS(i)&&uU.call(i,"callee")&&!lU.call(i,"callee")};const hU=dU;function pU(){return!1}var gN=typeof exports=="object"&&exports&&!exports.nodeType&&exports,$D=gN&&typeof module=="object"&&module&&!module.nodeType&&module,fU=$D&&$D.exports===gN,KD=fU?Rd.Buffer:void 0,gU=KD?KD.isBuffer:void 0,mU=gU||pU;const bw=mU;var vU="[object Arguments]",_U="[object Array]",yU="[object Boolean]",SU="[object Date]",IU="[object Error]",EU="[object Function]",TU="[object Map]",MU="[object Number]",RU="[object Object]",CU="[object RegExp]",bU="[object Set]",AU="[object String]",kU="[object WeakMap]",wU="[object ArrayBuffer]",DU="[object DataView]",OU="[object Float32Array]",NU="[object Float64Array]",LU="[object Int8Array]",PU="[object Int16Array]",xU="[object Int32Array]",UU="[object Uint8Array]",GU="[object Uint8ClampedArray]",FU="[object Uint16Array]",VU="[object Uint32Array]",vi={};vi[OU]=vi[NU]=vi[LU]=vi[PU]=vi[xU]=vi[UU]=vi[GU]=vi[FU]=vi[VU]=!0;vi[vU]=vi[_U]=vi[wU]=vi[yU]=vi[DU]=vi[SU]=vi[IU]=vi[EU]=vi[TU]=vi[MU]=vi[RU]=vi[CU]=vi[bU]=vi[AU]=vi[kU]=!1;function BU(i){return HS(i)&&pN(i.length)&&!!vi[ZS(i)]}function jU(i){return function(s){return i(s)}}var mN=typeof exports=="object"&&exports&&!exports.nodeType&&exports,aT=mN&&typeof module=="object"&&module&&!module.nodeType&&module,qU=aT&&aT.exports===mN,mw=qU&&cN.process,HU=function(){try{var i=aT&&aT.require&&aT.require("util").types;return i||mw&&mw.binding&&mw.binding("util")}catch{}}();const WD=HU;var zD=WD&&WD.isTypedArray,$U=zD?jU(zD):BU;const vN=$U;var KU=Object.prototype,WU=KU.hasOwnProperty;function zU(i,s){var g=jv(i),m=!g&&hU(i),R=!g&&!m&&bw(i),A=!g&&!m&&!R&&vN(i),D=g||m||R||A,x=D?sU(i.length,String):[],$=x.length;for(var B in i)(s||WU.call(i,B))&&!(D&&(B=="length"||R&&(B=="offset"||B=="parent")||A&&(B=="buffer"||B=="byteLength"||B=="byteOffset")||nU(B,$)))&&x.push(B);return x}function YU(i,s){return function(g){return i(s(g))}}var JU=YU(Object.keys,Object);const XU=JU;var QU=Object.prototype,ZU=QU.hasOwnProperty;function eG(i){if(!aU(i))return XU(i);var s=[];for(var g in Object(i))ZU.call(i,g)&&g!="constructor"&&s.push(g);return s}function tG(i){return iU(i)?zU(i):eG(i)}var nG=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,rG=/^\w*$/;function iG(i,s){if(jv(i))return!1;var g=typeof i;return g=="number"||g=="symbol"||g=="boolean"||i==null||Sb(i)?!0:rG.test(i)||!nG.test(i)||s!=null&&i in Object(s)}var oG=e0(Object,"create");const hT=oG;function aG(){this.__data__=hT?hT(null):{},this.size=0}function sG(i){var s=this.has(i)&&delete this.__data__[i];return this.size-=s?1:0,s}var cG="__lodash_hash_undefined__",uG=Object.prototype,lG=uG.hasOwnProperty;function dG(i){var s=this.__data__;if(hT){var g=s[i];return g===cG?void 0:g}return lG.call(s,i)?s[i]:void 0}var hG=Object.prototype,pG=hG.hasOwnProperty;function fG(i){var s=this.__data__;return hT?s[i]!==void 0:pG.call(s,i)}var gG="__lodash_hash_undefined__";function mG(i,s){var g=this.__data__;return this.size+=this.has(i)?0:1,g[i]=hT&&s===void 0?gG:s,this}function qv(i){var s=-1,g=i==null?0:i.length;for(this.clear();++s<g;){var m=i[s];this.set(m[0],m[1])}}qv.prototype.clear=aG;qv.prototype.delete=sG;qv.prototype.get=dG;qv.prototype.has=fG;qv.prototype.set=mG;function vG(){this.__data__=[],this.size=0}function Ib(i,s){for(var g=i.length;g--;)if(hN(i[g][0],s))return g;return-1}var _G=Array.prototype,yG=_G.splice;function SG(i){var s=this.__data__,g=Ib(s,i);if(g<0)return!1;var m=s.length-1;return g==m?s.pop():yG.call(s,g,1),--this.size,!0}function IG(i){var s=this.__data__,g=Ib(s,i);return g<0?void 0:s[g][1]}function EG(i){return Ib(this.__data__,i)>-1}function TG(i,s){var g=this.__data__,m=Ib(g,i);return m<0?(++this.size,g.push([i,s])):g[m][1]=s,this}function ap(i){var s=-1,g=i==null?0:i.length;for(this.clear();++s<g;){var m=i[s];this.set(m[0],m[1])}}ap.prototype.clear=vG;ap.prototype.delete=SG;ap.prototype.get=IG;ap.prototype.has=EG;ap.prototype.set=TG;var MG=e0(Rd,"Map");const pT=MG;function RG(){this.size=0,this.__data__={hash:new qv,map:new(pT||ap),string:new qv}}function CG(i){var s=typeof i;return s=="string"||s=="number"||s=="symbol"||s=="boolean"?i!=="__proto__":i===null}function Eb(i,s){var g=i.__data__;return CG(s)?g[typeof s=="string"?"string":"hash"]:g.map}function bG(i){var s=Eb(this,i).delete(i);return this.size-=s?1:0,s}function AG(i){return Eb(this,i).get(i)}function kG(i){return Eb(this,i).has(i)}function wG(i,s){var g=Eb(this,i),m=g.size;return g.set(i,s),this.size+=g.size==m?0:1,this}function sp(i){var s=-1,g=i==null?0:i.length;for(this.clear();++s<g;){var m=i[s];this.set(m[0],m[1])}}sp.prototype.clear=RG;sp.prototype.delete=bG;sp.prototype.get=AG;sp.prototype.has=kG;sp.prototype.set=wG;var DG="Expected a function";function jw(i,s){if(typeof i!="function"||s!=null&&typeof s!="function")throw new TypeError(DG);var g=function(){var m=arguments,R=s?s.apply(this,m):m[0],A=g.cache;if(A.has(R))return A.get(R);var D=i.apply(this,m);return g.cache=A.set(R,D)||A,D};return g.cache=new(jw.Cache||sp),g}jw.Cache=sp;var OG=500;function NG(i){var s=jw(i,function(m){return g.size===OG&&g.clear(),m}),g=s.cache;return s}var LG=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,PG=/\\(\\)?/g,xG=NG(function(i){var s=[];return i.charCodeAt(0)===46&&s.push(""),i.replace(LG,function(g,m,R,A){s.push(R?A.replace(PG,"$1"):m||g)}),s});const UG=xG;function GG(i){return i==null?"":lN(i)}function FG(i,s){return jv(i)?i:iG(i,s)?[i]:UG(GG(i))}var VG=1/0;function BG(i){if(typeof i=="string"||Sb(i))return i;var s=i+"";return s=="0"&&1/i==-VG?"-0":s}function jG(i,s){s=FG(s,i);for(var g=0,m=s.length;i!=null&&g<m;)i=i[BG(s[g++])];return g&&g==m?i:void 0}function nu(i,s,g){var m=i==null?void 0:jG(i,s);return m===void 0?g:m}function qG(i,s){for(var g=-1,m=s.length,R=i.length;++g<m;)i[R+g]=s[g];return i}function HG(){this.__data__=new ap,this.size=0}function $G(i){var s=this.__data__,g=s.delete(i);return this.size=s.size,g}function KG(i){return this.__data__.get(i)}function WG(i){return this.__data__.has(i)}var zG=200;function YG(i,s){var g=this.__data__;if(g instanceof ap){var m=g.__data__;if(!pT||m.length<zG-1)return m.push([i,s]),this.size=++g.size,this;g=this.__data__=new sp(m)}return g.set(i,s),this.size=g.size,this}function lg(i){var s=this.__data__=new ap(i);this.size=s.size}lg.prototype.clear=HG;lg.prototype.delete=$G;lg.prototype.get=KG;lg.prototype.has=WG;lg.prototype.set=YG;function JG(i,s){for(var g=-1,m=i==null?0:i.length,R=0,A=[];++g<m;){var D=i[g];s(D,g,i)&&(A[R++]=D)}return A}function XG(){return[]}var QG=Object.prototype,ZG=QG.propertyIsEnumerable,YD=Object.getOwnPropertySymbols,eF=YD?function(i){return i==null?[]:(i=Object(i),JG(YD(i),function(s){return ZG.call(i,s)}))}:XG;const tF=eF;function nF(i,s,g){var m=s(i);return jv(i)?m:qG(m,g(i))}function JD(i){return nF(i,tG,tF)}var rF=e0(Rd,"DataView");const Aw=rF;var iF=e0(Rd,"Promise");const kw=iF;var oF=e0(Rd,"Set");const ww=oF;var XD="[object Map]",aF="[object Object]",QD="[object Promise]",ZD="[object Set]",eO="[object WeakMap]",tO="[object DataView]",sF=$v(Aw),cF=$v(pT),uF=$v(kw),lF=$v(ww),dF=$v(Cw),Pv=ZS;(Aw&&Pv(new Aw(new ArrayBuffer(1)))!=tO||pT&&Pv(new pT)!=XD||kw&&Pv(kw.resolve())!=QD||ww&&Pv(new ww)!=ZD||Cw&&Pv(new Cw)!=eO)&&(Pv=function(i){var s=ZS(i),g=s==aF?i.constructor:void 0,m=g?$v(g):"";if(m)switch(m){case sF:return tO;case cF:return XD;case uF:return QD;case lF:return ZD;case dF:return eO}return s});const nO=Pv;var hF=Rd.Uint8Array;const rO=hF;var pF="__lodash_hash_undefined__";function fF(i){return this.__data__.set(i,pF),this}function gF(i){return this.__data__.has(i)}function db(i){var s=-1,g=i==null?0:i.length;for(this.__data__=new sp;++s<g;)this.add(i[s])}db.prototype.add=db.prototype.push=fF;db.prototype.has=gF;function mF(i,s){for(var g=-1,m=i==null?0:i.length;++g<m;)if(s(i[g],g,i))return!0;return!1}function vF(i,s){return i.has(s)}var _F=1,yF=2;function _N(i,s,g,m,R,A){var D=g&_F,x=i.length,$=s.length;if(x!=$&&!(D&&$>x))return!1;var B=A.get(i),te=A.get(s);if(B&&te)return B==s&&te==i;var re=-1,ie=!0,W=g&yF?new db:void 0;for(A.set(i,s),A.set(s,i);++re<x;){var Y=i[re],se=s[re];if(m)var Ae=D?m(se,Y,re,s,i,A):m(Y,se,re,i,s,A);if(Ae!==void 0){if(Ae)continue;ie=!1;break}if(W){if(!mF(s,function(Je,Xe){if(!vF(W,Xe)&&(Y===Je||R(Y,Je,g,m,A)))return W.push(Xe)})){ie=!1;break}}else if(!(Y===se||R(Y,se,g,m,A))){ie=!1;break}}return A.delete(i),A.delete(s),ie}function SF(i){var s=-1,g=Array(i.size);return i.forEach(function(m,R){g[++s]=[R,m]}),g}function IF(i){var s=-1,g=Array(i.size);return i.forEach(function(m){g[++s]=m}),g}var EF=1,TF=2,MF="[object Boolean]",RF="[object Date]",CF="[object Error]",bF="[object Map]",AF="[object Number]",kF="[object RegExp]",wF="[object Set]",DF="[object String]",OF="[object Symbol]",NF="[object ArrayBuffer]",LF="[object DataView]",iO=hg?hg.prototype:void 0,vw=iO?iO.valueOf:void 0;function PF(i,s,g,m,R,A,D){switch(g){case LF:if(i.byteLength!=s.byteLength||i.byteOffset!=s.byteOffset)return!1;i=i.buffer,s=s.buffer;case NF:return!(i.byteLength!=s.byteLength||!A(new rO(i),new rO(s)));case MF:case RF:case AF:return hN(+i,+s);case CF:return i.name==s.name&&i.message==s.message;case kF:case DF:return i==s+"";case bF:var x=SF;case wF:var $=m&EF;if(x||(x=IF),i.size!=s.size&&!$)return!1;var B=D.get(i);if(B)return B==s;m|=TF,D.set(i,s);var te=_N(x(i),x(s),m,R,A,D);return D.delete(i),te;case OF:if(vw)return vw.call(i)==vw.call(s)}return!1}var xF=1,UF=Object.prototype,GF=UF.hasOwnProperty;function FF(i,s,g,m,R,A){var D=g&xF,x=JD(i),$=x.length,B=JD(s),te=B.length;if($!=te&&!D)return!1;for(var re=$;re--;){var ie=x[re];if(!(D?ie in s:GF.call(s,ie)))return!1}var W=A.get(i),Y=A.get(s);if(W&&Y)return W==s&&Y==i;var se=!0;A.set(i,s),A.set(s,i);for(var Ae=D;++re<$;){ie=x[re];var Je=i[ie],Xe=s[ie];if(m)var Ue=D?m(Xe,Je,ie,s,i,A):m(Je,Xe,ie,i,s,A);if(!(Ue===void 0?Je===Xe||R(Je,Xe,g,m,A):Ue)){se=!1;break}Ae||(Ae=ie=="constructor")}if(se&&!Ae){var Be=i.constructor,Pe=s.constructor;Be!=Pe&&"constructor"in i&&"constructor"in s&&!(typeof Be=="function"&&Be instanceof Be&&typeof Pe=="function"&&Pe instanceof Pe)&&(se=!1)}return A.delete(i),A.delete(s),se}var VF=1,oO="[object Arguments]",aO="[object Array]",zC="[object Object]",BF=Object.prototype,sO=BF.hasOwnProperty;function jF(i,s,g,m,R,A){var D=jv(i),x=jv(s),$=D?aO:nO(i),B=x?aO:nO(s);$=$==oO?zC:$,B=B==oO?zC:B;var te=$==zC,re=B==zC,ie=$==B;if(ie&&bw(i)){if(!bw(s))return!1;D=!0,te=!1}if(ie&&!te)return A||(A=new lg),D||vN(i)?_N(i,s,g,m,R,A):PF(i,s,$,g,m,R,A);if(!(g&VF)){var W=te&&sO.call(i,"__wrapped__"),Y=re&&sO.call(s,"__wrapped__");if(W||Y){var se=W?i.value():i,Ae=Y?s.value():s;return A||(A=new lg),R(se,Ae,g,m,A)}}return ie?(A||(A=new lg),FF(i,s,g,m,R,A)):!1}function yN(i,s,g,m,R){return i===s?!0:i==null||s==null||!HS(i)&&!HS(s)?i!==i&&s!==s:jF(i,s,g,m,yN,R)}var qF=function(){return Rd.Date.now()};const _w=qF;var HF="Expected a function",$F=Math.max,KF=Math.min;function cO(i,s,g){var m,R,A,D,x,$,B=0,te=!1,re=!1,ie=!0;if(typeof i!="function")throw new TypeError(HF);s=jD(s)||0,dT(g)&&(te=!!g.leading,re="maxWait"in g,A=re?$F(jD(g.maxWait)||0,s):A,ie="trailing"in g?!!g.trailing:ie);function W(de){var Se=m,Ee=R;return m=R=void 0,B=de,D=i.apply(Ee,Se),D}function Y(de){return B=de,x=setTimeout(Je,s),te?W(de):D}function se(de){var Se=de-$,Ee=de-B,ke=s-Se;return re?KF(ke,A-Ee):ke}function Ae(de){var Se=de-$,Ee=de-B;return $===void 0||Se>=s||Se<0||re&&Ee>=A}function Je(){var de=_w();if(Ae(de))return Xe(de);x=setTimeout(Je,se(de))}function Xe(de){return x=void 0,ie&&m?W(de):(m=R=void 0,D)}function Ue(){x!==void 0&&clearTimeout(x),B=0,m=$=R=x=void 0}function Be(){return x===void 0?D:Xe(_w())}function Pe(){var de=_w(),Se=Ae(de);if(m=arguments,R=this,$=de,Se){if(x===void 0)return Y($);if(re)return clearTimeout(x),x=setTimeout(Je,s),W($)}return x===void 0&&(x=setTimeout(Je,s)),D}return Pe.cancel=Ue,Pe.flush=Be,Pe}function SN(i){for(var s=-1,g=i==null?0:i.length,m={};++s<g;){var R=i[s];m[R[0]]=R[1]}return m}function uO(i,s){return yN(i,s)}function Tb(i){return i==null}const tp=(i,s,{checkForDefaultPrevented:g=!0}={})=>R=>{const A=i==null?void 0:i(R);if(g===!1||!A)return s==null?void 0:s(R)};var lO;const Mo=typeof window<"u",$S=i=>typeof i=="boolean",Id=i=>typeof i=="number",WF=i=>typeof i=="string",yw=()=>{};Mo&&((lO=window==null?void 0:window.navigator)==null?void 0:lO.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function Mb(i){return Hx()?(ZO(i),!0):!1}function dO(i,s,g={}){const{immediate:m=!0}=g,R=Ft(!1);let A=null;function D(){A&&(clearTimeout(A),A=null)}function x(){R.value=!1,D()}function $(...B){D(),R.value=!0,A=setTimeout(()=>{R.value=!1,A=null,i(...B)},_e(s))}return m&&(R.value=!0,Mo&&$()),Mb(x),{isPending:R,start:$,stop:x}}function ag(i){var s;const g=_e(i);return(s=g==null?void 0:g.$el)!=null?s:g}const qw=Mo?window:void 0;function Uv(...i){let s,g,m,R;if(WF(i[0])?([g,m,R]=i,s=qw):[s,g,m,R]=i,!s)return yw;let A=yw;const D=jn(()=>ag(s),$=>{A(),$&&($.addEventListener(g,m,R),A=()=>{$.removeEventListener(g,m,R),A=yw})},{immediate:!0,flush:"post"}),x=()=>{D(),A()};return Mb(x),x}function zF(i,s,g={}){const{window:m=qw,ignore:R,capture:A=!0,detectIframe:D=!1}=g;if(!m)return;const x=Ft(!0);let $;const B=ie=>{m.clearTimeout($);const W=ag(i),Y=ie.composedPath();!W||W===ie.target||Y.includes(W)||!x.value||R&&R.length>0&&R.some(se=>{const Ae=ag(se);return Ae&&(ie.target===Ae||Y.includes(Ae))})||s(ie)},te=[Uv(m,"click",B,{passive:!0,capture:A}),Uv(m,"pointerdown",ie=>{const W=ag(i);x.value=!!W&&!ie.composedPath().includes(W)},{passive:!0}),Uv(m,"pointerup",ie=>{if(ie.button===0){const W=ie.composedPath();ie.composedPath=()=>W,$=m.setTimeout(()=>B(ie),50)}},{passive:!0}),D&&Uv(m,"blur",ie=>{var W;const Y=ag(i);((W=document.activeElement)==null?void 0:W.tagName)==="IFRAME"&&!(Y!=null&&Y.contains(document.activeElement))&&s(ie)})].filter(Boolean);return()=>te.forEach(ie=>ie())}const Dw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ow="__vueuse_ssr_handlers__";Dw[Ow]=Dw[Ow]||{};Dw[Ow];var hO=Object.getOwnPropertySymbols,YF=Object.prototype.hasOwnProperty,JF=Object.prototype.propertyIsEnumerable,XF=(i,s)=>{var g={};for(var m in i)YF.call(i,m)&&s.indexOf(m)<0&&(g[m]=i[m]);if(i!=null&&hO)for(var m of hO(i))s.indexOf(m)<0&&JF.call(i,m)&&(g[m]=i[m]);return g};function Rb(i,s,g={}){const m=g,{window:R=qw}=m,A=XF(m,["window"]);let D;const x=R&&"ResizeObserver"in R,$=()=>{D&&(D.disconnect(),D=void 0)},B=jn(()=>ag(i),re=>{$(),x&&R&&re&&(D=new ResizeObserver(s),D.observe(re,A))},{immediate:!0,flush:"post"}),te=()=>{$(),B()};return Mb(te),{isSupported:x,stop:te}}var pO;(function(i){i.UP="UP",i.RIGHT="RIGHT",i.DOWN="DOWN",i.LEFT="LEFT",i.NONE="NONE"})(pO||(pO={}));const Nw=i=>i===void 0,fT=i=>typeof Element>"u"?!1:i instanceof Element,QF=(i="")=>i.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d"),fO=i=>Object.keys(i);class ZF extends Error{constructor(s){super(s),this.name="ElementPlusError"}}function IN(i,s){throw new ZF(`[${i}] ${s}`)}function P8(i,s){}const EN=(i="")=>i.split(" ").filter(s=>!!s.trim()),gO=(i,s)=>{if(!i||!s)return!1;if(s.includes(" "))throw new Error("className should not contain space.");return i.classList.contains(s)},eV=(i,s)=>{!i||!s.trim()||i.classList.add(...EN(s))},tV=(i,s)=>{!i||!s.trim()||i.classList.remove(...EN(s))},mO=(i,s)=>{var g;if(!Mo||!i||!s)return"";let m=$x(s);m==="float"&&(m="cssFloat");try{const R=i.style[m];if(R)return R;const A=(g=document.defaultView)==null?void 0:g.getComputedStyle(i,"");return A?A[m]:""}catch{return i.style[m]}};function gT(i,s="px"){if(!i)return"";if(Gv(i))return i;if(Id(i))return`${i}${s}`}let YC;const nV=i=>{var s;if(!Mo)return 0;if(YC!==void 0)return YC;const g=document.createElement("div");g.className=`${i}-scrollbar__wrap`,g.style.visibility="hidden",g.style.width="100px",g.style.position="absolute",g.style.top="-9999px",document.body.appendChild(g);const m=g.offsetWidth;g.style.overflow="scroll";const R=document.createElement("div");R.style.width="100%",g.appendChild(R);const A=R.offsetWidth;return(s=g.parentNode)==null||s.removeChild(g),YC=m-A,YC};function rV(i,s){if(!Mo)return;if(!s){i.scrollTop=0;return}const g=[];let m=s.offsetParent;for(;m!==null&&i!==m&&i.contains(m);)g.push(m),m=m.offsetParent;const R=s.offsetTop+g.reduce(($,B)=>$+B.offsetTop,0),A=R+s.offsetHeight,D=i.scrollTop,x=D+i.clientHeight;R<D?i.scrollTop=R:A>x&&(i.scrollTop=A-i.clientHeight)}/*! Element Plus Icons Vue v2.0.6 */var dl=(i,s)=>{let g=i.__vccOpts||i;for(let[m,R]of s)g[m]=R;return g},iV={name:"ArrowUp"},oV={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},aV=Kt("path",{fill:"currentColor",d:"m488.832 344.32-339.84 356.672a32 32 0 0 0 0 44.16l.384.384a29.44 29.44 0 0 0 42.688 0l320-335.872 319.872 335.872a29.44 29.44 0 0 0 42.688 0l.384-.384a32 32 0 0 0 0-44.16L535.168 344.32a32 32 0 0 0-46.336 0z"},null,-1),sV=[aV];function cV(i,s,g,m,R,A){return pt(),qt("svg",oV,sV)}var uV=dl(iV,[["render",cV],["__file","arrow-up.vue"]]),lV={name:"CircleCheck"},dV={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},hV=Kt("path",{fill:"currentColor",d:"M512 896a384 384 0 1 0 0-768 384 384 0 0 0 0 768zm0 64a448 448 0 1 1 0-896 448 448 0 0 1 0 896z"},null,-1),pV=Kt("path",{fill:"currentColor",d:"M745.344 361.344a32 32 0 0 1 45.312 45.312l-288 288a32 32 0 0 1-45.312 0l-160-160a32 32 0 1 1 45.312-45.312L480 626.752l265.344-265.408z"},null,-1),fV=[hV,pV];function gV(i,s,g,m,R,A){return pt(),qt("svg",dV,fV)}var mV=dl(lV,[["render",gV],["__file","circle-check.vue"]]),vV={name:"CircleCloseFilled"},_V={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},yV=Kt("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896zm0 393.664L407.936 353.6a38.4 38.4 0 1 0-54.336 54.336L457.664 512 353.6 616.064a38.4 38.4 0 1 0 54.336 54.336L512 566.336 616.064 670.4a38.4 38.4 0 1 0 54.336-54.336L566.336 512 670.4 407.936a38.4 38.4 0 1 0-54.336-54.336L512 457.664z"},null,-1),SV=[yV];function IV(i,s,g,m,R,A){return pt(),qt("svg",_V,SV)}var TN=dl(vV,[["render",IV],["__file","circle-close-filled.vue"]]),EV={name:"CircleClose"},TV={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},MV=Kt("path",{fill:"currentColor",d:"m466.752 512-90.496-90.496a32 32 0 0 1 45.248-45.248L512 466.752l90.496-90.496a32 32 0 1 1 45.248 45.248L557.248 512l90.496 90.496a32 32 0 1 1-45.248 45.248L512 557.248l-90.496 90.496a32 32 0 0 1-45.248-45.248L466.752 512z"},null,-1),RV=Kt("path",{fill:"currentColor",d:"M512 896a384 384 0 1 0 0-768 384 384 0 0 0 0 768zm0 64a448 448 0 1 1 0-896 448 448 0 0 1 0 896z"},null,-1),CV=[MV,RV];function bV(i,s,g,m,R,A){return pt(),qt("svg",TV,CV)}var Hw=dl(EV,[["render",bV],["__file","circle-close.vue"]]),AV={name:"Close"},kV={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},wV=Kt("path",{fill:"currentColor",d:"M764.288 214.592 512 466.88 259.712 214.592a31.936 31.936 0 0 0-45.12 45.12L466.752 512 214.528 764.224a31.936 31.936 0 1 0 45.12 45.184L512 557.184l252.288 252.288a31.936 31.936 0 0 0 45.12-45.12L557.12 512.064l252.288-252.352a31.936 31.936 0 1 0-45.12-45.184z"},null,-1),DV=[wV];function OV(i,s,g,m,R,A){return pt(),qt("svg",kV,DV)}var mT=dl(AV,[["render",OV],["__file","close.vue"]]),NV={name:"Hide"},LV={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},PV=Kt("path",{d:"M876.8 156.8c0-9.6-3.2-16-9.6-22.4-6.4-6.4-12.8-9.6-22.4-9.6-9.6 0-16 3.2-22.4 9.6L736 220.8c-64-32-137.6-51.2-224-60.8-160 16-288 73.6-377.6 176C44.8 438.4 0 496 0 512s48 73.6 134.4 176c22.4 25.6 44.8 48 73.6 67.2l-86.4 89.6c-6.4 6.4-9.6 12.8-9.6 22.4 0 9.6 3.2 16 9.6 22.4 6.4 6.4 12.8 9.6 22.4 9.6 9.6 0 16-3.2 22.4-9.6l704-710.4c3.2-6.4 6.4-12.8 6.4-22.4Zm-646.4 528c-76.8-70.4-128-128-153.6-172.8 28.8-48 80-105.6 153.6-172.8C304 272 400 230.4 512 224c64 3.2 124.8 19.2 176 44.8l-54.4 54.4C598.4 300.8 560 288 512 288c-64 0-115.2 22.4-160 64s-64 96-64 160c0 48 12.8 89.6 35.2 124.8L256 707.2c-9.6-6.4-19.2-16-25.6-22.4Zm140.8-96c-12.8-22.4-19.2-48-19.2-76.8 0-44.8 16-83.2 48-112 32-28.8 67.2-48 112-48 28.8 0 54.4 6.4 73.6 19.2L371.2 588.8ZM889.599 336c-12.8-16-28.8-28.8-41.6-41.6l-48 48c73.6 67.2 124.8 124.8 150.4 169.6-28.8 48-80 105.6-153.6 172.8-73.6 67.2-172.8 108.8-284.8 115.2-51.2-3.2-99.2-12.8-140.8-28.8l-48 48c57.6 22.4 118.4 38.4 188.8 44.8 160-16 288-73.6 377.6-176C979.199 585.6 1024 528 1024 512s-48.001-73.6-134.401-176Z",fill:"currentColor"},null,-1),xV=Kt("path",{d:"M511.998 672c-12.8 0-25.6-3.2-38.4-6.4l-51.2 51.2c28.8 12.8 57.6 19.2 89.6 19.2 64 0 115.2-22.4 160-64 41.6-41.6 64-96 64-160 0-32-6.4-64-19.2-89.6l-51.2 51.2c3.2 12.8 6.4 25.6 6.4 38.4 0 44.8-16 83.2-48 112-32 28.8-67.2 48-112 48Z",fill:"currentColor"},null,-1),UV=[PV,xV];function GV(i,s,g,m,R,A){return pt(),qt("svg",LV,UV)}var FV=dl(NV,[["render",GV],["__file","hide.vue"]]),VV={name:"InfoFilled"},BV={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},jV=Kt("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64zm67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344zM590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296-44.096 0-108.992 44.736-148.48 101.504 0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04 67.84 0 107.904-43.648 147.456-100.416z"},null,-1),qV=[jV];function HV(i,s,g,m,R,A){return pt(),qt("svg",BV,qV)}var MN=dl(VV,[["render",HV],["__file","info-filled.vue"]]),$V={name:"Loading"},KV={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},WV=Kt("path",{fill:"currentColor",d:"M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32zm0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32zm448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32zm-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32zM195.2 195.2a32 32 0 0 1 45.248 0L376.32 331.008a32 32 0 0 1-45.248 45.248L195.2 240.448a32 32 0 0 1 0-45.248zm452.544 452.544a32 32 0 0 1 45.248 0L828.8 783.552a32 32 0 0 1-45.248 45.248L647.744 692.992a32 32 0 0 1 0-45.248zM828.8 195.264a32 32 0 0 1 0 45.184L692.992 376.32a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0zm-452.544 452.48a32 32 0 0 1 0 45.248L240.448 828.8a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0z"},null,-1),zV=[WV];function YV(i,s,g,m,R,A){return pt(),qt("svg",KV,zV)}var JV=dl($V,[["render",YV],["__file","loading.vue"]]),XV={name:"SuccessFilled"},QV={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},ZV=Kt("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896zm-55.808 536.384-99.52-99.584a38.4 38.4 0 1 0-54.336 54.336l126.72 126.72a38.272 38.272 0 0 0 54.336 0l262.4-262.464a38.4 38.4 0 1 0-54.272-54.336L456.192 600.384z"},null,-1),e3=[ZV];function t3(i,s,g,m,R,A){return pt(),qt("svg",QV,e3)}var RN=dl(XV,[["render",t3],["__file","success-filled.vue"]]),n3={name:"View"},r3={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},i3=Kt("path",{fill:"currentColor",d:"M512 160c320 0 512 352 512 352S832 864 512 864 0 512 0 512s192-352 512-352zm0 64c-225.28 0-384.128 208.064-436.8 288 52.608 79.872 211.456 288 436.8 288 225.28 0 384.128-208.064 436.8-288-52.608-79.872-211.456-288-436.8-288zm0 64a224 224 0 1 1 0 448 224 224 0 0 1 0-448zm0 64a160.192 160.192 0 0 0-160 160c0 88.192 71.744 160 160 160s160-71.808 160-160-71.744-160-160-160z"},null,-1),o3=[i3];function a3(i,s,g,m,R,A){return pt(),qt("svg",r3,o3)}var s3=dl(n3,[["render",a3],["__file","view.vue"]]),c3={name:"WarningFilled"},u3={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},l3=Kt("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896zm0 192a58.432 58.432 0 0 0-58.24 63.744l23.36 256.384a35.072 35.072 0 0 0 69.76 0l23.296-256.384A58.432 58.432 0 0 0 512 256zm0 512a51.2 51.2 0 1 0 0-102.4 51.2 51.2 0 0 0 0 102.4z"},null,-1),d3=[l3];function h3(i,s,g,m,R,A){return pt(),qt("svg",u3,d3)}var CN=dl(c3,[["render",h3],["__file","warning-filled.vue"]]);const bN="__epPropKey",Ri=i=>i,p3=i=>dg(i)&&!!i[bN],Cb=(i,s)=>{if(!dg(i)||p3(i))return i;const{values:g,required:m,default:R,type:A,validator:D}=i,$={type:A,required:!!m,validator:g||D?B=>{let te=!1,re=[];if(g&&(re=Array.from(g),UD(i,"default")&&re.push(R),te||(te=re.includes(B))),D&&(te||(te=D(B))),!te&&re.length>0){const ie=[...new Set(re)].map(W=>JSON.stringify(W)).join(", ");Kx(`Invalid prop: validation failed${s?` for prop "${s}"`:""}. Expected one of [${ie}], got value ${JSON.stringify(B)}.`)}return te}:void 0,[bN]:!0};return UD(i,"default")&&($.default=R),$},Ro=i=>SN(Object.entries(i).map(([s,g])=>[s,Cb(g,s)])),Lw=Ri([String,Object,Function]),x8={Close:mT},U8={Close:mT,SuccessFilled:RN,InfoFilled:MN,WarningFilled:CN,CircleCloseFilled:TN},G8={success:RN,warning:CN,error:TN,info:MN},f3={validating:JV,success:mV,error:Hw},cp=(i,s)=>{if(i.install=g=>{for(const m of[i,...Object.values(s!=null?s:{})])g.component(m.name,m)},s)for(const[g,m]of Object.entries(s))i[g]=m;return i},F8=(i,s)=>(i.install=g=>{i._context=g._context,g.config.globalProperties[s]=i},i),V8=(i,s)=>(i.install=g=>{g.directive(s,i)},i),bb=i=>(i.install=ug,i),vT={tab:"Tab",enter:"Enter",space:"Space",left:"ArrowLeft",up:"ArrowUp",right:"ArrowRight",down:"ArrowDown",esc:"Escape",delete:"Delete",backspace:"Backspace",numpadEnter:"NumpadEnter",pageUp:"PageUp",pageDown:"PageDown",home:"Home",end:"End"},Xo="update:modelValue",AN="change",B8="input",$w=["","default","small","large"],g3={large:40,default:32,small:24},m3=i=>g3[i||"default"],v3=i=>["",...$w].includes(i);var QC=(i=>(i[i.TEXT=1]="TEXT",i[i.CLASS=2]="CLASS",i[i.STYLE=4]="STYLE",i[i.PROPS=8]="PROPS",i[i.FULL_PROPS=16]="FULL_PROPS",i[i.HYDRATE_EVENTS=32]="HYDRATE_EVENTS",i[i.STABLE_FRAGMENT=64]="STABLE_FRAGMENT",i[i.KEYED_FRAGMENT=128]="KEYED_FRAGMENT",i[i.UNKEYED_FRAGMENT=256]="UNKEYED_FRAGMENT",i[i.NEED_PATCH=512]="NEED_PATCH",i[i.DYNAMIC_SLOTS=1024]="DYNAMIC_SLOTS",i[i.HOISTED=-1]="HOISTED",i[i.BAIL=-2]="BAIL",i))(QC||{});const kN=i=>/([(\uAC00-\uD7AF)|(\u3130-\u318F)])+/gi.test(i),_3=()=>Math.floor(Math.random()*1e4),y3=i=>i,S3=["class","style"],I3=/^on[A-Z]/,E3=(i={})=>{const{excludeListeners:s=!1,excludeKeys:g}=i,m=It(()=>((g==null?void 0:g.value)||[]).concat(S3)),R=cu();return R?It(()=>{var A;return SN(Object.entries((A=R.proxy)==null?void 0:A.$attrs).filter(([D])=>!m.value.includes(D)&&!(s&&I3.test(D))))}):It(()=>({}))},wN=Symbol(),MT=Symbol("formContextKey"),KS=Symbol("formItemContextKey"),DN=Symbol("scrollbarContextKey"),Kw=Symbol("popper"),ON=Symbol("popperContent"),NN=i=>{const s=cu();return It(()=>{var g,m;return(m=((g=s.proxy)==null?void 0:g.$props)[i])!=null?m:void 0})},hb=Ft();function t0(i,s=void 0){const g=cu()?Ci(wN,hb):hb;return i?It(()=>{var m,R;return(R=(m=g.value)==null?void 0:m[i])!=null?R:s}):g}const j8=(i,s,g=!1)=>{var m;const R=!!cu(),A=R?t0():void 0,D=(m=s==null?void 0:s.provide)!=null?m:R?ll:void 0;if(!D)return;const x=It(()=>{const $=_e(i);return A!=null&&A.value?T3(A.value,$):$});return D(wN,x),(g||!hb.value)&&(hb.value=x.value),x},T3=(i,s)=>{var g;const m=[...new Set([...fO(i),...fO(s)])],R={};for(const A of m)R[A]=(g=s[A])!=null?g:i[A];return R},Ww=Cb({type:String,values:$w,required:!1}),WS=(i,s={})=>{const g=Ft(void 0),m=s.prop?g:NN("size"),R=s.global?g:t0("size"),A=s.form?{size:void 0}:Ci(MT,void 0),D=s.formItem?{size:void 0}:Ci(KS,void 0);return It(()=>m.value||_e(i)||(D==null?void 0:D.size)||(A==null?void 0:A.size)||R.value||"")},M3=i=>{const s=NN("disabled"),g=Ci(MT,void 0);return It(()=>s.value||_e(i)||(g==null?void 0:g.disabled)||!1)},R3=({from:i,replacement:s,scope:g,version:m,ref:R,type:A="API"},D)=>{jn(()=>_e(D),x=>{},{immediate:!0})},C3=i=>({focus:()=>{var s,g;(g=(s=i.value)==null?void 0:s.focus)==null||g.call(s)}}),b3={prefix:Math.floor(Math.random()*1e4),current:0},A3=Symbol("elIdInjection"),pb=i=>{const s=Ci(A3,b3);return It(()=>_e(i)||`el-id-${s.prefix}-${s.current++}`)},k3=()=>{const i=Ci(MT,void 0),s=Ci(KS,void 0);return{form:i,formItem:s}},zw=(i,{formItemContext:s,disableIdGeneration:g,disableIdManagement:m})=>{g||(g=Ft(!1)),m||(m=Ft(!1));const R=Ft();let A;const D=It(()=>{var x;return!!(!i.label&&s&&s.inputIds&&((x=s.inputIds)==null?void 0:x.length)<=1)});return Ba(()=>{A=jn([Bv(i,"id"),g],([x,$])=>{const B=x!=null?x:$?void 0:pb().value;B!==R.value&&(s!=null&&s.removeInputId&&(R.value&&s.removeInputId(R.value),!(m!=null&&m.value)&&!$&&B&&s.addInputId(B)),R.value=B)},{immediate:!0})}),yb(()=>{A&&A(),s!=null&&s.removeInputId&&R.value&&s.removeInputId(R.value)}),{isLabeledByFormItem:D,inputId:R}};var w3={name:"en",el:{colorpicker:{confirm:"OK",clear:"Clear",defaultLabel:"color picker",description:"current color is {color}. press enter to select a new color."},datepicker:{now:"Now",today:"Today",cancel:"Cancel",clear:"Clear",confirm:"OK",dateTablePrompt:"Use the arrow keys and enter to select the day of the month",monthTablePrompt:"Use the arrow keys and enter to select the month",yearTablePrompt:"Use the arrow keys and enter to select the year",selectedDate:"Selected date",selectDate:"Select date",selectTime:"Select time",startDate:"Start Date",startTime:"Start Time",endDate:"End Date",endTime:"End Time",prevYear:"Previous Year",nextYear:"Next Year",prevMonth:"Previous Month",nextMonth:"Next Month",year:"",month1:"January",month2:"February",month3:"March",month4:"April",month5:"May",month6:"June",month7:"July",month8:"August",month9:"September",month10:"October",month11:"November",month12:"December",week:"week",weeks:{sun:"Sun",mon:"Mon",tue:"Tue",wed:"Wed",thu:"Thu",fri:"Fri",sat:"Sat"},weeksFull:{sun:"Sunday",mon:"Monday",tue:"Tuesday",wed:"Wednesday",thu:"Thursday",fri:"Friday",sat:"Saturday"},months:{jan:"Jan",feb:"Feb",mar:"Mar",apr:"Apr",may:"May",jun:"Jun",jul:"Jul",aug:"Aug",sep:"Sep",oct:"Oct",nov:"Nov",dec:"Dec"}},inputNumber:{decrease:"decrease number",increase:"increase number"},select:{loading:"Loading",noMatch:"No matching data",noData:"No data",placeholder:"Select"},dropdown:{toggleDropdown:"Toggle Dropdown"},cascader:{noMatch:"No matching data",loading:"Loading",placeholder:"Select",noData:"No data"},pagination:{goto:"Go to",pagesize:"/page",total:"Total {total}",pageClassifier:"",deprecationWarning:"Deprecated usages detected, please refer to the el-pagination documentation for more details"},dialog:{close:"Close this dialog"},drawer:{close:"Close this dialog"},messagebox:{title:"Message",confirm:"OK",cancel:"Cancel",error:"Illegal input",close:"Close this dialog"},upload:{deleteTip:"press delete to remove",delete:"Delete",preview:"Preview",continue:"Continue"},slider:{defaultLabel:"slider between {min} and {max}",defaultRangeStartLabel:"pick start value",defaultRangeEndLabel:"pick end value"},table:{emptyText:"No Data",confirmFilter:"Confirm",resetFilter:"Reset",clearFilter:"All",sumText:"Sum"},tree:{emptyText:"No Data"},transfer:{noMatch:"No matching data",noData:"No data",titles:["List 1","List 2"],filterPlaceholder:"Enter keyword",noCheckedFormat:"{total} items",hasCheckedFormat:"{checked}/{total} checked"},image:{error:"FAILED"},pageHeader:{title:"Back"},popconfirm:{confirmButtonText:"Yes",cancelButtonText:"No"}}};const D3=i=>(s,g)=>O3(s,g,_e(i)),O3=(i,s,g)=>nu(g,i,i).replace(/\{(\w+)\}/g,(m,R)=>{var A;return`${(A=s==null?void 0:s[R])!=null?A:`{${R}}`}`}),N3=i=>{const s=It(()=>_e(i).name),g=jS(i)?i:Ft(i);return{lang:s,locale:g,t:D3(i)}},Ab=()=>{const i=t0("locale");return N3(It(()=>i.value||w3))},LN="el",L3="is-",Ov=(i,s,g,m,R)=>{let A=`${i}-${s}`;return g&&(A+=`-${g}`),m&&(A+=`__${m}`),R&&(A+=`--${R}`),A},Hi=i=>{const s=t0("namespace"),g=It(()=>s.value||LN);return{namespace:g,b:(se="")=>Ov(_e(g),i,se,"",""),e:se=>se?Ov(_e(g),i,"",se,""):"",m:se=>se?Ov(_e(g),i,"","",se):"",be:(se,Ae)=>se&&Ae?Ov(_e(g),i,se,Ae,""):"",em:(se,Ae)=>se&&Ae?Ov(_e(g),i,"",se,Ae):"",bm:(se,Ae)=>se&&Ae?Ov(_e(g),i,se,"",Ae):"",bem:(se,Ae,Je)=>se&&Ae&&Je?Ov(_e(g),i,se,Ae,Je):"",is:(se,...Ae)=>{const Je=Ae.length>=1?Ae[0]:!0;return se&&Je?`${L3}${se}`:""},cssVar:se=>{const Ae={};for(const Je in se)se[Je]&&(Ae[`--${g.value}-${Je}`]=se[Je]);return Ae},cssVarName:se=>`--${g.value}-${se}`,cssVarBlock:se=>{const Ae={};for(const Je in se)se[Je]&&(Ae[`--${g.value}-${i}-${Je}`]=se[Je]);return Ae},cssVarBlockName:se=>`--${g.value}-${i}-${se}`}},P3=i=>{jS(i)||IN("[useLockscreen]","You need to pass a ref param to this function");const s=Hi("popup"),g=Wx(()=>s.bm("parent","hidden"));if(!Mo||gO(document.body,g.value))return;let m=0,R=!1,A="0",D=0;const x=()=>{tV(document.body,g.value),R&&(document.body.style.paddingRight=A)};jn(i,$=>{if(!$){x();return}R=!gO(document.body,g.value),R&&(A=document.body.style.paddingRight,D=Number.parseInt(mO(document.body,"paddingRight"),10)),m=nV(s.namespace.value);const B=document.documentElement.clientHeight<document.body.scrollHeight,te=mO(document.body,"overflowY");m>0&&(B||te==="scroll")&&R&&(document.body.style.paddingRight=`${D+m}px`),eV(document.body,g.value)}),ZO(()=>x())},x3=Cb({type:Ri(Boolean),default:null}),U3=Cb({type:Ri(Function)}),G3=i=>{const s=`update:${i}`,g=`onUpdate:${i}`,m=[s],R={[i]:x3,[g]:U3};return{useModelToggle:({indicator:D,toggleReason:x,shouldHideWhenRouteChanges:$,shouldProceed:B,onShow:te,onHide:re})=>{const ie=cu(),{emit:W}=ie,Y=ie.props,se=It(()=>WC(Y[g])),Ae=It(()=>Y[i]===null),Je=Se=>{D.value!==!0&&(D.value=!0,x&&(x.value=Se),WC(te)&&te(Se))},Xe=Se=>{D.value!==!1&&(D.value=!1,x&&(x.value=Se),WC(re)&&re(Se))},Ue=Se=>{if(Y.disabled===!0||WC(B)&&!B())return;const Ee=se.value&&Mo;Ee&&W(s,!0),(Ae.value||!Ee)&&Je(Se)},Be=Se=>{if(Y.disabled===!0||!Mo)return;const Ee=se.value&&Mo;Ee&&W(s,!1),(Ae.value||!Ee)&&Xe(Se)},Pe=Se=>{!$S(Se)||(Y.disabled&&Se?se.value&&W(s,!1):D.value!==Se&&(Se?Je():Xe()))},de=()=>{D.value?Be():Ue()};return jn(()=>Y[i],Pe),$&&ie.appContext.config.globalProperties.$route!==void 0&&jn(()=>({...ie.proxy.$route}),()=>{$.value&&D.value&&Be()}),Ba(()=>{Pe(Y[i])}),{hide:Be,show:Ue,toggle:de,hasUpdateHandler:se}},useModelToggleProps:R,useModelToggleEmits:m}},F3=i=>{if(!i)return{onClick:ug,onMousedown:ug,onMouseup:ug};let s=!1,g=!1;return{onClick:D=>{s&&g&&i(D),s=g=!1},onMousedown:D=>{s=D.target===D.currentTarget},onMouseup:D=>{g=D.target===D.currentTarget}}};function V3(){let i;const s=(m,R)=>{g(),i=window.setTimeout(m,R)},g=()=>window.clearTimeout(i);return Mb(()=>g()),{registerTimeout:s,cancelTimeout:g}}let wS=[];const vO=i=>{const s=i;s.key===vT.esc&&wS.forEach(g=>g(s))},B3=i=>{Ba(()=>{wS.length===0&&document.addEventListener("keydown",vO),Mo&&wS.push(i)}),op(()=>{wS=wS.filter(s=>s!==i),wS.length===0&&Mo&&document.removeEventListener("keydown",vO)})};let _O;const PN=`el-popper-container-${_3()}`,xN=`#${PN}`,j3=()=>{const i=document.createElement("div");return i.id=PN,document.body.appendChild(i),i},q3=()=>{zx(()=>{!Mo||(!_O||!document.body.querySelector(xN))&&(_O=j3())})},H3=Ro({showAfter:{type:Number,default:0},hideAfter:{type:Number,default:200}}),$3=({showAfter:i,hideAfter:s,open:g,close:m})=>{const{registerTimeout:R}=V3();return{onOpen:x=>{R(()=>{g(x)},_e(i))},onClose:x=>{R(()=>{m(x)},_e(s))}}},UN=Symbol("elForwardRef"),K3=i=>{ll(UN,{setForwardRef:g=>{i.value=g}})},W3=i=>({mounted(s){i(s)},updated(s){i(s)},unmounted(){i(null)}}),yO=Ft(0),GN=()=>{const i=t0("zIndex",2e3),s=It(()=>i.value+yO.value);return{initialZIndex:i,currentZIndex:s,nextZIndex:()=>(yO.value++,s.value)}};function z3(i){const s=Ft();function g(){if(i.value==null)return;const{selectionStart:R,selectionEnd:A,value:D}=i.value;if(R==null||A==null)return;const x=D.slice(0,Math.max(0,R)),$=D.slice(Math.max(0,A));s.value={selectionStart:R,selectionEnd:A,value:D,beforeTxt:x,afterTxt:$}}function m(){if(i.value==null||s.value==null)return;const{value:R}=i.value,{beforeTxt:A,afterTxt:D,selectionStart:x}=s.value;if(A==null||D==null||x==null)return;let $=R.length;if(R.endsWith(D))$=R.length-D.length;else if(R.startsWith(A))$=A.length;else{const B=A[x-1],te=R.indexOf(B,x-1);te!==-1&&($=te+1)}i.value.setSelectionRange($,$)}return[g,m]}var $i=(i,s)=>{const g=i.__vccOpts||i;for(const[m,R]of s)g[m]=R;return g};const Y3=Ro({size:{type:Ri([Number,String])},color:{type:String}}),J3={name:"ElIcon",inheritAttrs:!1},X3=Ar({...J3,props:Y3,setup(i){const s=i,g=Hi("icon"),m=It(()=>!s.size&&!s.color?{}:{fontSize:Nw(s.size)?void 0:gT(s.size),"--color":s.color});return(R,A)=>(pt(),qt("i",GS({class:_e(g).b(),style:_e(m)},R.$attrs),[br(R.$slots,"default")],16))}});var Q3=$i(X3,[["__file","/home/runner/work/element-plus/element-plus/packages/components/icon/src/icon.vue"]]);const np=cp(Q3);let sl;const Z3=`
  height:0 !important;
  visibility:hidden !important;
  overflow:hidden !important;
  position:absolute !important;
  z-index:-1000 !important;
  top:0 !important;
  right:0 !important;
`,e4=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing"];function t4(i){const s=window.getComputedStyle(i),g=s.getPropertyValue("box-sizing"),m=Number.parseFloat(s.getPropertyValue("padding-bottom"))+Number.parseFloat(s.getPropertyValue("padding-top")),R=Number.parseFloat(s.getPropertyValue("border-bottom-width"))+Number.parseFloat(s.getPropertyValue("border-top-width"));return{contextStyle:e4.map(D=>`${D}:${s.getPropertyValue(D)}`).join(";"),paddingSize:m,borderSize:R,boxSizing:g}}function SO(i,s=1,g){var m;sl||(sl=document.createElement("textarea"),document.body.appendChild(sl));const{paddingSize:R,borderSize:A,boxSizing:D,contextStyle:x}=t4(i);sl.setAttribute("style",`${x};${Z3}`),sl.value=i.value||i.placeholder||"";let $=sl.scrollHeight;const B={};D==="border-box"?$=$+A:D==="content-box"&&($=$-R),sl.value="";const te=sl.scrollHeight-R;if(Id(s)){let re=te*s;D==="border-box"&&(re=re+R+A),$=Math.max(re,$),B.minHeight=`${re}px`}if(Id(g)){let re=te*g;D==="border-box"&&(re=re+R+A),$=Math.min(re,$)}return B.height=`${$}px`,(m=sl.parentNode)==null||m.removeChild(sl),sl=void 0,B}const n4=Ro({id:{type:String,default:void 0},size:Ww,disabled:Boolean,modelValue:{type:Ri([String,Number,Object]),default:""},type:{type:String,default:"text"},resize:{type:String,values:["none","both","horizontal","vertical"]},autosize:{type:Ri([Boolean,Object]),default:!1},autocomplete:{type:String,default:"off"},formatter:{type:Function},parser:{type:Function},placeholder:{type:String},form:{type:String,default:""},readonly:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},showPassword:{type:Boolean,default:!1},showWordLimit:{type:Boolean,default:!1},suffixIcon:{type:Lw,default:""},prefixIcon:{type:Lw,default:""},containerRole:{type:String,default:void 0},label:{type:String,default:void 0},tabindex:{type:[String,Number],default:0},validateEvent:{type:Boolean,default:!0},inputStyle:{type:Ri([Object,Array,String]),default:()=>y3({})}}),r4={[Xo]:i=>Gv(i),input:i=>Gv(i),change:i=>Gv(i),focus:i=>i instanceof FocusEvent,blur:i=>i instanceof FocusEvent,clear:()=>!0,mouseleave:i=>i instanceof MouseEvent,mouseenter:i=>i instanceof MouseEvent,keydown:i=>i instanceof Event,compositionstart:i=>i instanceof CompositionEvent,compositionupdate:i=>i instanceof CompositionEvent,compositionend:i=>i instanceof CompositionEvent},i4=["role"],o4=["id","type","disabled","formatter","parser","readonly","autocomplete","tabindex","aria-label","placeholder"],a4=["id","tabindex","disabled","readonly","autocomplete","aria-label","placeholder"],s4={name:"ElInput",inheritAttrs:!1},c4=Ar({...s4,props:n4,emits:r4,setup(i,{expose:s,emit:g}){const m=i,R={suffix:"append",prefix:"prepend"},A=cu(),D=Yx(),x=Bw(),$=It(()=>{const nt={};return m.containerRole==="combobox"&&(nt["aria-haspopup"]=D["aria-haspopup"],nt["aria-owns"]=D["aria-owns"],nt["aria-expanded"]=D["aria-expanded"]),nt}),B=E3({excludeKeys:It(()=>Object.keys($.value))}),{form:te,formItem:re}=k3(),{inputId:ie}=zw(m,{formItemContext:re}),W=WS(),Y=M3(),se=Hi("input"),Ae=Hi("textarea"),Je=oT(),Xe=oT(),Ue=Ft(!1),Be=Ft(!1),Pe=Ft(!1),de=Ft(!1),Se=Ft(),Ee=oT(m.inputStyle),ke=It(()=>Je.value||Xe.value),De=It(()=>{var nt;return(nt=te==null?void 0:te.statusIcon)!=null?nt:!1}),Qe=It(()=>(re==null?void 0:re.validateState)||""),vt=It(()=>Qe.value&&f3[Qe.value]),ft=It(()=>de.value?s3:FV),it=It(()=>[D.style,m.inputStyle]),ut=It(()=>[m.inputStyle,Ee.value,{resize:m.resize}]),ee=It(()=>Tb(m.modelValue)?"":String(m.modelValue)),xe=It(()=>m.clearable&&!Y.value&&!m.readonly&&!!ee.value&&(Ue.value||Be.value)),Et=It(()=>m.showPassword&&!Y.value&&!m.readonly&&!!ee.value&&(!!ee.value||Ue.value)),Fn=It(()=>m.showWordLimit&&!!B.value.maxlength&&(m.type==="text"||m.type==="textarea")&&!Y.value&&!m.readonly&&!m.showPassword),Fr=It(()=>Array.from(ee.value).length),dt=It(()=>!!Fn.value&&Fr.value>Number(B.value.maxlength)),ai=It(()=>!!x.suffix||!!m.suffixIcon||xe.value||m.showPassword||Fn.value||!!Qe.value&&De.value),[bi,dr]=z3(Je);Rb(Xe,nt=>{if(!Fn.value||m.resize!=="both")return;const nn=nt[0],{width:yi}=nn.contentRect;Se.value={right:`calc(100% - ${yi+15+6}px)`}});const Gn=()=>{const{type:nt,autosize:nn}=m;if(!(!Mo||nt!=="textarea"))if(nn){const yi=dg(nn)?nn.minRows:void 0,Lr=dg(nn)?nn.maxRows:void 0;Ee.value={...SO(Xe.value,yi,Lr)}}else Ee.value={minHeight:SO(Xe.value).minHeight}},Ai=()=>{const nt=ke.value;!nt||nt.value===ee.value||(nt.value=ee.value)},si=nt=>{const{el:nn}=A.vnode;if(!nn)return;const Lr=Array.from(nn.querySelectorAll(`.${se.e(nt)}`)).find(ma=>ma.parentNode===nn);if(!Lr)return;const pr=R[nt];x[pr]?Lr.style.transform=`translateX(${nt==="suffix"?"-":""}${nn.querySelector(`.${se.be("group",pr)}`).offsetWidth}px)`:Lr.removeAttribute("style")},Nr=()=>{si("prefix"),si("suffix")},_i=async nt=>{bi();let{value:nn}=nt.target;m.formatter&&(nn=m.parser?m.parser(nn):nn,nn=m.formatter(nn)),!Pe.value&&nn!==ee.value&&(g(Xo,nn),g("input",nn),await oi(),Ai(),dr())},ve=nt=>{g("change",nt.target.value)},qn=nt=>{g("compositionstart",nt),Pe.value=!0},ho=nt=>{var nn;g("compositionupdate",nt);const yi=(nn=nt.target)==null?void 0:nn.value,Lr=yi[yi.length-1]||"";Pe.value=!kN(Lr)},hr=nt=>{g("compositionend",nt),Pe.value&&(Pe.value=!1,_i(nt))},Ki=()=>{de.value=!de.value,Co()},Co=async()=>{var nt;await oi(),(nt=ke.value)==null||nt.focus()},qr=()=>{var nt;return(nt=ke.value)==null?void 0:nt.blur()},Oo=nt=>{Ue.value=!0,g("focus",nt)},an=nt=>{var nn;Ue.value=!1,g("blur",nt),m.validateEvent&&((nn=re==null?void 0:re.validate)==null||nn.call(re,"blur").catch(yi=>void 0))},ur=nt=>{Be.value=!1,g("mouseleave",nt)},bt=nt=>{Be.value=!0,g("mouseenter",nt)},xt=nt=>{g("keydown",nt)},Qo=()=>{var nt;(nt=ke.value)==null||nt.select()},_r=()=>{g(Xo,""),g("change",""),g("clear"),g("input","")};return jn(()=>m.modelValue,()=>{var nt;oi(()=>Gn()),m.validateEvent&&((nt=re==null?void 0:re.validate)==null||nt.call(re,"change").catch(nn=>void 0))}),jn(ee,()=>Ai()),jn(()=>m.type,async()=>{await oi(),Ai(),Gn(),Nr()}),Ba(async()=>{!m.formatter&&m.parser,Ai(),Nr(),await oi(),Gn()}),eN(async()=>{await oi(),Nr()}),s({input:Je,textarea:Xe,ref:ke,textareaStyle:ut,autosize:Bv(m,"autosize"),focus:Co,blur:qr,select:Qo,clear:_r,resizeTextarea:Gn}),(nt,nn)=>Rs((pt(),qt("div",GS(_e($),{class:[nt.type==="textarea"?_e(Ae).b():_e(se).b(),_e(se).m(_e(W)),_e(se).is("disabled",_e(Y)),_e(se).is("exceed",_e(dt)),{[_e(se).b("group")]:nt.$slots.prepend||nt.$slots.append,[_e(se).bm("group","append")]:nt.$slots.append,[_e(se).bm("group","prepend")]:nt.$slots.prepend,[_e(se).m("prefix")]:nt.$slots.prefix||nt.prefixIcon,[_e(se).m("suffix")]:nt.$slots.suffix||nt.suffixIcon||nt.clearable||nt.showPassword,[_e(se).bm("suffix","password-clear")]:_e(xe)&&_e(Et)},nt.$attrs.class],style:_e(it),role:nt.containerRole,onMouseenter:bt,onMouseleave:ur}),[wn(" input "),nt.type!=="textarea"?(pt(),qt(ic,{key:0},[wn(" prepend slot "),nt.$slots.prepend?(pt(),qt("div",{key:0,class:Nt(_e(se).be("group","prepend"))},[br(nt.$slots,"prepend")],2)):wn("v-if",!0),Kt("div",{class:Nt([_e(se).e("wrapper"),_e(se).is("focus",Ue.value)])},[wn(" prefix slot "),nt.$slots.prefix||nt.prefixIcon?(pt(),qt("span",{key:0,class:Nt(_e(se).e("prefix"))},[Kt("span",{class:Nt(_e(se).e("prefix-inner"))},[br(nt.$slots,"prefix"),nt.prefixIcon?(pt(),nr(_e(np),{key:0,class:Nt(_e(se).e("icon"))},{default:Zn(()=>[(pt(),nr(rp(nt.prefixIcon)))]),_:1},8,["class"])):wn("v-if",!0)],2)],2)):wn("v-if",!0),Kt("input",GS({id:_e(ie),ref_key:"input",ref:Je,class:_e(se).e("inner")},_e(B),{type:nt.showPassword?de.value?"text":"password":nt.type,disabled:_e(Y),formatter:nt.formatter,parser:nt.parser,readonly:nt.readonly,autocomplete:nt.autocomplete,tabindex:nt.tabindex,"aria-label":nt.label,placeholder:nt.placeholder,style:nt.inputStyle,onCompositionstart:qn,onCompositionupdate:ho,onCompositionend:hr,onInput:_i,onFocus:Oo,onBlur:an,onChange:ve,onKeydown:xt}),null,16,o4),wn(" suffix slot "),_e(ai)?(pt(),qt("span",{key:1,class:Nt(_e(se).e("suffix"))},[Kt("span",{class:Nt(_e(se).e("suffix-inner"))},[!_e(xe)||!_e(Et)||!_e(Fn)?(pt(),qt(ic,{key:0},[br(nt.$slots,"suffix"),nt.suffixIcon?(pt(),nr(_e(np),{key:0,class:Nt(_e(se).e("icon"))},{default:Zn(()=>[(pt(),nr(rp(nt.suffixIcon)))]),_:1},8,["class"])):wn("v-if",!0)],64)):wn("v-if",!0),_e(xe)?(pt(),nr(_e(np),{key:1,class:Nt([_e(se).e("icon"),_e(se).e("clear")]),onMousedown:tu(_e(ug),["prevent"]),onClick:_r},{default:Zn(()=>[jr(_e(Hw))]),_:1},8,["class","onMousedown"])):wn("v-if",!0),_e(Et)?(pt(),nr(_e(np),{key:2,class:Nt([_e(se).e("icon"),_e(se).e("password")]),onClick:Ki},{default:Zn(()=>[(pt(),nr(rp(_e(ft))))]),_:1},8,["class"])):wn("v-if",!0),_e(Fn)?(pt(),qt("span",{key:3,class:Nt(_e(se).e("count"))},[Kt("span",{class:Nt(_e(se).e("count-inner"))},lo(_e(Fr))+" / "+lo(_e(B).maxlength),3)],2)):wn("v-if",!0),_e(Qe)&&_e(vt)&&_e(De)?(pt(),nr(_e(np),{key:4,class:Nt([_e(se).e("icon"),_e(se).e("validateIcon"),_e(se).is("loading",_e(Qe)==="validating")])},{default:Zn(()=>[(pt(),nr(rp(_e(vt))))]),_:1},8,["class"])):wn("v-if",!0)],2)],2)):wn("v-if",!0)],2),wn(" append slot "),nt.$slots.append?(pt(),qt("div",{key:1,class:Nt(_e(se).be("group","append"))},[br(nt.$slots,"append")],2)):wn("v-if",!0)],64)):(pt(),qt(ic,{key:1},[wn(" textarea "),Kt("textarea",GS({id:_e(ie),ref_key:"textarea",ref:Xe,class:_e(Ae).e("inner")},_e(B),{tabindex:nt.tabindex,disabled:_e(Y),readonly:nt.readonly,autocomplete:nt.autocomplete,style:_e(ut),"aria-label":nt.label,placeholder:nt.placeholder,onCompositionstart:qn,onCompositionupdate:ho,onCompositionend:hr,onInput:_i,onFocus:Oo,onBlur:an,onChange:ve,onKeydown:xt}),null,16,a4),_e(Fn)?(pt(),qt("span",{key:0,style:Va(Se.value),class:Nt(_e(se).e("count"))},lo(_e(Fr))+" / "+lo(_e(B).maxlength),7)):wn("v-if",!0)],64))],16,i4)),[[Hv,nt.type!=="hidden"]])}});var u4=$i(c4,[["__file","/home/runner/work/element-plus/element-plus/packages/components/input/src/input.vue"]]);const l4=cp(u4),NS=4,d4={vertical:{offset:"offsetHeight",scroll:"scrollTop",scrollSize:"scrollHeight",size:"height",key:"vertical",axis:"Y",client:"clientY",direction:"top"},horizontal:{offset:"offsetWidth",scroll:"scrollLeft",scrollSize:"scrollWidth",size:"width",key:"horizontal",axis:"X",client:"clientX",direction:"left"}},h4=({move:i,size:s,bar:g})=>({[g.size]:s,transform:`translate${g.axis}(${i}%)`}),p4=Ro({vertical:Boolean,size:String,move:Number,ratio:{type:Number,required:!0},always:Boolean}),f4=Ar({__name:"thumb",props:p4,setup(i){const s=i,g="Thumb",m=Ci(DN),R=Hi("scrollbar");m||IN(g,"can not inject scrollbar context");const A=Ft(),D=Ft(),x=Ft({}),$=Ft(!1);let B=!1,te=!1,re=Mo?document.onselectstart:null;const ie=It(()=>d4[s.vertical?"vertical":"horizontal"]),W=It(()=>h4({size:s.size,move:s.move,bar:ie.value})),Y=It(()=>A.value[ie.value.offset]**2/m.wrapElement[ie.value.scrollSize]/s.ratio/D.value[ie.value.offset]),se=Se=>{var Ee;if(Se.stopPropagation(),Se.ctrlKey||[1,2].includes(Se.button))return;(Ee=window.getSelection())==null||Ee.removeAllRanges(),Je(Se);const ke=Se.currentTarget;!ke||(x.value[ie.value.axis]=ke[ie.value.offset]-(Se[ie.value.client]-ke.getBoundingClientRect()[ie.value.direction]))},Ae=Se=>{if(!D.value||!A.value||!m.wrapElement)return;const Ee=Math.abs(Se.target.getBoundingClientRect()[ie.value.direction]-Se[ie.value.client]),ke=D.value[ie.value.offset]/2,De=(Ee-ke)*100*Y.value/A.value[ie.value.offset];m.wrapElement[ie.value.scroll]=De*m.wrapElement[ie.value.scrollSize]/100},Je=Se=>{Se.stopImmediatePropagation(),B=!0,document.addEventListener("mousemove",Xe),document.addEventListener("mouseup",Ue),re=document.onselectstart,document.onselectstart=()=>!1},Xe=Se=>{if(!A.value||!D.value||B===!1)return;const Ee=x.value[ie.value.axis];if(!Ee)return;const ke=(A.value.getBoundingClientRect()[ie.value.direction]-Se[ie.value.client])*-1,De=D.value[ie.value.offset]-Ee,Qe=(ke-De)*100*Y.value/A.value[ie.value.offset];m.wrapElement[ie.value.scroll]=Qe*m.wrapElement[ie.value.scrollSize]/100},Ue=()=>{B=!1,x.value[ie.value.axis]=0,document.removeEventListener("mousemove",Xe),document.removeEventListener("mouseup",Ue),de(),te&&($.value=!1)},Be=()=>{te=!1,$.value=!!s.size},Pe=()=>{te=!0,$.value=B};op(()=>{de(),document.removeEventListener("mouseup",Ue)});const de=()=>{document.onselectstart!==re&&(document.onselectstart=re)};return Uv(Bv(m,"scrollbarElement"),"mousemove",Be),Uv(Bv(m,"scrollbarElement"),"mouseleave",Pe),(Se,Ee)=>(pt(),nr(IT,{name:_e(R).b("fade"),persisted:""},{default:Zn(()=>[Rs(Kt("div",{ref_key:"instance",ref:A,class:Nt([_e(R).e("bar"),_e(R).is(_e(ie).key)]),onMousedown:Ae},[Kt("div",{ref_key:"thumb",ref:D,class:Nt(_e(R).e("thumb")),style:Va(_e(W)),onMousedown:se},null,38)],34),[[Hv,Se.always||$.value]])]),_:1},8,["name"]))}});var IO=$i(f4,[["__file","/home/runner/work/element-plus/element-plus/packages/components/scrollbar/src/thumb.vue"]]);const g4=Ro({always:{type:Boolean,default:!0},width:String,height:String,ratioX:{type:Number,default:1},ratioY:{type:Number,default:1}}),m4=Ar({__name:"bar",props:g4,setup(i,{expose:s}){const g=i,m=Ft(0),R=Ft(0);return s({handleScroll:D=>{if(D){const x=D.offsetHeight-NS,$=D.offsetWidth-NS;R.value=D.scrollTop*100/x*g.ratioY,m.value=D.scrollLeft*100/$*g.ratioX}}}),(D,x)=>(pt(),qt(ic,null,[jr(IO,{move:m.value,ratio:D.ratioX,size:D.width,always:D.always},null,8,["move","ratio","size","always"]),jr(IO,{move:R.value,ratio:D.ratioY,size:D.height,vertical:"",always:D.always},null,8,["move","ratio","size","always"])],64))}});var v4=$i(m4,[["__file","/home/runner/work/element-plus/element-plus/packages/components/scrollbar/src/bar.vue"]]);const _4=Ro({height:{type:[String,Number],default:""},maxHeight:{type:[String,Number],default:""},native:Boolean,wrapStyle:{type:Ri([String,Object,Array]),default:""},wrapClass:{type:[String,Array],default:""},viewClass:{type:[String,Array],default:""},viewStyle:{type:[String,Array,Object],default:""},noresize:Boolean,tag:{type:String,default:"div"},always:Boolean,minSize:{type:Number,default:20}}),y4={scroll:({scrollTop:i,scrollLeft:s})=>[i,s].every(Id)},S4={name:"ElScrollbar"},I4=Ar({...S4,props:_4,emits:y4,setup(i,{expose:s,emit:g}){const m=i,R=Hi("scrollbar");let A,D;const x=Ft(),$=Ft(),B=Ft(),te=Ft("0"),re=Ft("0"),ie=Ft(),W=Ft(1),Y=Ft(1),se=It(()=>{const Pe={};return m.height&&(Pe.height=gT(m.height)),m.maxHeight&&(Pe.maxHeight=gT(m.maxHeight)),[m.wrapStyle,Pe]}),Ae=()=>{var Pe;$.value&&((Pe=ie.value)==null||Pe.handleScroll($.value),g("scroll",{scrollTop:$.value.scrollTop,scrollLeft:$.value.scrollLeft}))};function Je(Pe,de){dg(Pe)?$.value.scrollTo(Pe):Id(Pe)&&Id(de)&&$.value.scrollTo(Pe,de)}const Xe=Pe=>{!Id(Pe)||($.value.scrollTop=Pe)},Ue=Pe=>{!Id(Pe)||($.value.scrollLeft=Pe)},Be=()=>{if(!$.value)return;const Pe=$.value.offsetHeight-NS,de=$.value.offsetWidth-NS,Se=Pe**2/$.value.scrollHeight,Ee=de**2/$.value.scrollWidth,ke=Math.max(Se,m.minSize),De=Math.max(Ee,m.minSize);W.value=Se/(Pe-Se)/(ke/(Pe-ke)),Y.value=Ee/(de-Ee)/(De/(de-De)),re.value=ke+NS<Pe?`${ke}px`:"",te.value=De+NS<de?`${De}px`:""};return jn(()=>m.noresize,Pe=>{Pe?(A==null||A(),D==null||D()):({stop:A}=Rb(B,Be),D=Uv("resize",Be))},{immediate:!0}),jn(()=>[m.maxHeight,m.height],()=>{m.native||oi(()=>{var Pe;Be(),$.value&&((Pe=ie.value)==null||Pe.handleScroll($.value))})}),ll(DN,ET({scrollbarElement:x,wrapElement:$})),Ba(()=>{m.native||oi(()=>{Be()})}),eN(()=>Be()),s({wrap$:$,update:Be,scrollTo:Je,setScrollTop:Xe,setScrollLeft:Ue,handleScroll:Ae}),(Pe,de)=>(pt(),qt("div",{ref_key:"scrollbar$",ref:x,class:Nt(_e(R).b())},[Kt("div",{ref_key:"wrap$",ref:$,class:Nt([Pe.wrapClass,_e(R).e("wrap"),{[_e(R).em("wrap","hidden-default")]:!Pe.native}]),style:Va(_e(se)),onScroll:Ae},[(pt(),nr(rp(Pe.tag),{ref_key:"resize$",ref:B,class:Nt([_e(R).e("view"),Pe.viewClass]),style:Va(Pe.viewStyle)},{default:Zn(()=>[br(Pe.$slots,"default")]),_:3},8,["class","style"]))],38),Pe.native?wn("v-if",!0):(pt(),nr(v4,{key:0,ref_key:"barRef",ref:ie,height:re.value,width:te.value,always:Pe.always,"ratio-x":Y.value,"ratio-y":W.value},null,8,["height","width","always","ratio-x","ratio-y"]))],2))}});var E4=$i(I4,[["__file","/home/runner/work/element-plus/element-plus/packages/components/scrollbar/src/scrollbar.vue"]]);const T4=cp(E4),FN=Ro({role:{type:String,default:"tooltip"}}),M4={name:"ElPopperRoot",inheritAttrs:!1},R4=Ar({...M4,props:FN,setup(i,{expose:s}){const g=i,m=Ft(),R=Ft(),A=Ft(),D=Ft(),x=It(()=>g.role),$={triggerRef:m,popperInstanceRef:R,contentRef:A,referenceRef:D,role:x};return s($),ll(Kw,$),(B,te)=>br(B.$slots,"default")}});var C4=$i(R4,[["__file","/home/runner/work/element-plus/element-plus/packages/components/popper/src/popper.vue"]]);const VN=Ro({arrowOffset:{type:Number,default:5}}),b4={name:"ElPopperArrow",inheritAttrs:!1},A4=Ar({...b4,props:VN,setup(i,{expose:s}){const g=i,m=Hi("popper"),{arrowOffset:R,arrowRef:A}=Ci(ON,void 0);return jn(()=>g.arrowOffset,D=>{R.value=D}),op(()=>{A.value=void 0}),s({arrowRef:A}),(D,x)=>(pt(),qt("span",{ref_key:"arrowRef",ref:A,class:Nt(_e(m).e("arrow")),"data-popper-arrow":""},null,2))}});var k4=$i(A4,[["__file","/home/runner/work/element-plus/element-plus/packages/components/popper/src/arrow.vue"]]);const w4="ElOnlyChild",D4=Ar({name:w4,setup(i,{slots:s,attrs:g}){var m;const R=Ci(UN),A=W3((m=R==null?void 0:R.setForwardRef)!=null?m:ug);return()=>{var D;const x=(D=s.default)==null?void 0:D.call(s,g);if(!x||x.length>1)return null;const $=BN(x);return $?Rs(Jx($,g),[[A]]):null}}});function BN(i){if(!i)return null;const s=i;for(const g of s){if(dg(g))switch(g.type){case Qx:continue;case Xx:case"svg":return EO(g);case ic:return BN(g.children);default:return g}return EO(g)}return null}function EO(i){return jr("span",{class:"el-only-child__content"},[i])}const jN=Ro({virtualRef:{type:Ri(Object)},virtualTriggering:Boolean,onMouseenter:Function,onMouseleave:Function,onClick:Function,onKeydown:Function,onFocus:Function,onBlur:Function,onContextmenu:Function,id:String,open:Boolean}),O4={name:"ElPopperTrigger",inheritAttrs:!1},N4=Ar({...O4,props:jN,setup(i,{expose:s}){const g=i,{role:m,triggerRef:R}=Ci(Kw,void 0);K3(R);const A=It(()=>x.value?g.id:void 0),D=It(()=>{if(m&&m.value==="tooltip")return g.open&&g.id?g.id:void 0}),x=It(()=>{if(m&&m.value!=="tooltip")return m.value}),$=It(()=>x.value?`${g.open}`:void 0);let B;return Ba(()=>{jn(()=>g.virtualRef,te=>{te&&(R.value=ag(te))},{immediate:!0}),jn(()=>R.value,(te,re)=>{B==null||B(),B=void 0,fT(te)&&(["onMouseenter","onMouseleave","onClick","onKeydown","onFocus","onBlur","onContextmenu"].forEach(ie=>{var W;const Y=g[ie];Y&&(te.addEventListener(ie.slice(2).toLowerCase(),Y),(W=re==null?void 0:re.removeEventListener)==null||W.call(re,ie.slice(2).toLowerCase(),Y))}),B=jn([A,D,x,$],ie=>{["aria-controls","aria-describedby","aria-haspopup","aria-expanded"].forEach((W,Y)=>{Tb(ie[Y])?te.removeAttribute(W):te.setAttribute(W,ie[Y])})},{immediate:!0})),fT(re)&&["aria-controls","aria-describedby","aria-haspopup","aria-expanded"].forEach(ie=>re.removeAttribute(ie))},{immediate:!0})}),op(()=>{B==null||B(),B=void 0}),s({triggerRef:R}),(te,re)=>te.virtualTriggering?wn("v-if",!0):(pt(),nr(_e(D4),GS({key:0},te.$attrs,{"aria-controls":_e(A),"aria-describedby":_e(D),"aria-expanded":_e($),"aria-haspopup":_e(x)}),{default:Zn(()=>[br(te.$slots,"default")]),_:3},16,["aria-controls","aria-describedby","aria-expanded","aria-haspopup"]))}});var L4=$i(N4,[["__file","/home/runner/work/element-plus/element-plus/packages/components/popper/src/trigger.vue"]]),Cs="top",au="bottom",su="right",bs="left",Yw="auto",RT=[Cs,au,su,bs],zS="start",_T="end",P4="clippingParents",qN="viewport",nT="popper",x4="reference",TO=RT.reduce(function(i,s){return i.concat([s+"-"+zS,s+"-"+_T])},[]),Jw=[].concat(RT,[Yw]).reduce(function(i,s){return i.concat([s,s+"-"+zS,s+"-"+_T])},[]),U4="beforeRead",G4="read",F4="afterRead",V4="beforeMain",B4="main",j4="afterMain",q4="beforeWrite",H4="write",$4="afterWrite",K4=[U4,G4,F4,V4,B4,j4,q4,H4,$4];function Md(i){return i?(i.nodeName||"").toLowerCase():null}function hl(i){if(i==null)return window;if(i.toString()!=="[object Window]"){var s=i.ownerDocument;return s&&s.defaultView||window}return i}function YS(i){var s=hl(i).Element;return i instanceof s||i instanceof Element}function ou(i){var s=hl(i).HTMLElement;return i instanceof s||i instanceof HTMLElement}function Xw(i){if(typeof ShadowRoot>"u")return!1;var s=hl(i).ShadowRoot;return i instanceof s||i instanceof ShadowRoot}function W4(i){var s=i.state;Object.keys(s.elements).forEach(function(g){var m=s.styles[g]||{},R=s.attributes[g]||{},A=s.elements[g];!ou(A)||!Md(A)||(Object.assign(A.style,m),Object.keys(R).forEach(function(D){var x=R[D];x===!1?A.removeAttribute(D):A.setAttribute(D,x===!0?"":x)}))})}function z4(i){var s=i.state,g={popper:{position:s.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(s.elements.popper.style,g.popper),s.styles=g,s.elements.arrow&&Object.assign(s.elements.arrow.style,g.arrow),function(){Object.keys(s.elements).forEach(function(m){var R=s.elements[m],A=s.attributes[m]||{},D=Object.keys(s.styles.hasOwnProperty(m)?s.styles[m]:g[m]),x=D.reduce(function($,B){return $[B]="",$},{});!ou(R)||!Md(R)||(Object.assign(R.style,x),Object.keys(A).forEach(function($){R.removeAttribute($)}))})}}var HN={name:"applyStyles",enabled:!0,phase:"write",fn:W4,effect:z4,requires:["computeStyles"]};function Td(i){return i.split("-")[0]}var Fv=Math.max,fb=Math.min,JS=Math.round;function XS(i,s){s===void 0&&(s=!1);var g=i.getBoundingClientRect(),m=1,R=1;if(ou(i)&&s){var A=i.offsetHeight,D=i.offsetWidth;D>0&&(m=JS(g.width)/D||1),A>0&&(R=JS(g.height)/A||1)}return{width:g.width/m,height:g.height/R,top:g.top/R,right:g.right/m,bottom:g.bottom/R,left:g.left/m,x:g.left/m,y:g.top/R}}function Qw(i){var s=XS(i),g=i.offsetWidth,m=i.offsetHeight;return Math.abs(s.width-g)<=1&&(g=s.width),Math.abs(s.height-m)<=1&&(m=s.height),{x:i.offsetLeft,y:i.offsetTop,width:g,height:m}}function $N(i,s){var g=s.getRootNode&&s.getRootNode();if(i.contains(s))return!0;if(g&&Xw(g)){var m=s;do{if(m&&i.isSameNode(m))return!0;m=m.parentNode||m.host}while(m)}return!1}function ip(i){return hl(i).getComputedStyle(i)}function Y4(i){return["table","td","th"].indexOf(Md(i))>=0}function fg(i){return((YS(i)?i.ownerDocument:i.document)||window.document).documentElement}function kb(i){return Md(i)==="html"?i:i.assignedSlot||i.parentNode||(Xw(i)?i.host:null)||fg(i)}function MO(i){return!ou(i)||ip(i).position==="fixed"?null:i.offsetParent}function J4(i){var s=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1,g=navigator.userAgent.indexOf("Trident")!==-1;if(g&&ou(i)){var m=ip(i);if(m.position==="fixed")return null}var R=kb(i);for(Xw(R)&&(R=R.host);ou(R)&&["html","body"].indexOf(Md(R))<0;){var A=ip(R);if(A.transform!=="none"||A.perspective!=="none"||A.contain==="paint"||["transform","perspective"].indexOf(A.willChange)!==-1||s&&A.willChange==="filter"||s&&A.filter&&A.filter!=="none")return R;R=R.parentNode}return null}function CT(i){for(var s=hl(i),g=MO(i);g&&Y4(g)&&ip(g).position==="static";)g=MO(g);return g&&(Md(g)==="html"||Md(g)==="body"&&ip(g).position==="static")?s:g||J4(i)||s}function Zw(i){return["top","bottom"].indexOf(i)>=0?"x":"y"}function sT(i,s,g){return Fv(i,fb(s,g))}function X4(i,s,g){var m=sT(i,s,g);return m>g?g:m}function KN(){return{top:0,right:0,bottom:0,left:0}}function WN(i){return Object.assign({},KN(),i)}function zN(i,s){return s.reduce(function(g,m){return g[m]=i,g},{})}var Q4=function(i,s){return i=typeof i=="function"?i(Object.assign({},s.rects,{placement:s.placement})):i,WN(typeof i!="number"?i:zN(i,RT))};function Z4(i){var s,g=i.state,m=i.name,R=i.options,A=g.elements.arrow,D=g.modifiersData.popperOffsets,x=Td(g.placement),$=Zw(x),B=[bs,su].indexOf(x)>=0,te=B?"height":"width";if(!(!A||!D)){var re=Q4(R.padding,g),ie=Qw(A),W=$==="y"?Cs:bs,Y=$==="y"?au:su,se=g.rects.reference[te]+g.rects.reference[$]-D[$]-g.rects.popper[te],Ae=D[$]-g.rects.reference[$],Je=CT(A),Xe=Je?$==="y"?Je.clientHeight||0:Je.clientWidth||0:0,Ue=se/2-Ae/2,Be=re[W],Pe=Xe-ie[te]-re[Y],de=Xe/2-ie[te]/2+Ue,Se=sT(Be,de,Pe),Ee=$;g.modifiersData[m]=(s={},s[Ee]=Se,s.centerOffset=Se-de,s)}}function e6(i){var s=i.state,g=i.options,m=g.element,R=m===void 0?"[data-popper-arrow]":m;R!=null&&(typeof R=="string"&&(R=s.elements.popper.querySelector(R),!R)||!$N(s.elements.popper,R)||(s.elements.arrow=R))}var t6={name:"arrow",enabled:!0,phase:"main",fn:Z4,effect:e6,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function QS(i){return i.split("-")[1]}var n6={top:"auto",right:"auto",bottom:"auto",left:"auto"};function r6(i){var s=i.x,g=i.y,m=window,R=m.devicePixelRatio||1;return{x:JS(s*R)/R||0,y:JS(g*R)/R||0}}function RO(i){var s,g=i.popper,m=i.popperRect,R=i.placement,A=i.variation,D=i.offsets,x=i.position,$=i.gpuAcceleration,B=i.adaptive,te=i.roundOffsets,re=i.isFixed,ie=D.x,W=ie===void 0?0:ie,Y=D.y,se=Y===void 0?0:Y,Ae=typeof te=="function"?te({x:W,y:se}):{x:W,y:se};W=Ae.x,se=Ae.y;var Je=D.hasOwnProperty("x"),Xe=D.hasOwnProperty("y"),Ue=bs,Be=Cs,Pe=window;if(B){var de=CT(g),Se="clientHeight",Ee="clientWidth";if(de===hl(g)&&(de=fg(g),ip(de).position!=="static"&&x==="absolute"&&(Se="scrollHeight",Ee="scrollWidth")),de=de,R===Cs||(R===bs||R===su)&&A===_T){Be=au;var ke=re&&de===Pe&&Pe.visualViewport?Pe.visualViewport.height:de[Se];se-=ke-m.height,se*=$?1:-1}if(R===bs||(R===Cs||R===au)&&A===_T){Ue=su;var De=re&&de===Pe&&Pe.visualViewport?Pe.visualViewport.width:de[Ee];W-=De-m.width,W*=$?1:-1}}var Qe=Object.assign({position:x},B&&n6),vt=te===!0?r6({x:W,y:se}):{x:W,y:se};if(W=vt.x,se=vt.y,$){var ft;return Object.assign({},Qe,(ft={},ft[Be]=Xe?"0":"",ft[Ue]=Je?"0":"",ft.transform=(Pe.devicePixelRatio||1)<=1?"translate("+W+"px, "+se+"px)":"translate3d("+W+"px, "+se+"px, 0)",ft))}return Object.assign({},Qe,(s={},s[Be]=Xe?se+"px":"",s[Ue]=Je?W+"px":"",s.transform="",s))}function i6(i){var s=i.state,g=i.options,m=g.gpuAcceleration,R=m===void 0?!0:m,A=g.adaptive,D=A===void 0?!0:A,x=g.roundOffsets,$=x===void 0?!0:x,B={placement:Td(s.placement),variation:QS(s.placement),popper:s.elements.popper,popperRect:s.rects.popper,gpuAcceleration:R,isFixed:s.options.strategy==="fixed"};s.modifiersData.popperOffsets!=null&&(s.styles.popper=Object.assign({},s.styles.popper,RO(Object.assign({},B,{offsets:s.modifiersData.popperOffsets,position:s.options.strategy,adaptive:D,roundOffsets:$})))),s.modifiersData.arrow!=null&&(s.styles.arrow=Object.assign({},s.styles.arrow,RO(Object.assign({},B,{offsets:s.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:$})))),s.attributes.popper=Object.assign({},s.attributes.popper,{"data-popper-placement":s.placement})}var YN={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:i6,data:{}},JC={passive:!0};function o6(i){var s=i.state,g=i.instance,m=i.options,R=m.scroll,A=R===void 0?!0:R,D=m.resize,x=D===void 0?!0:D,$=hl(s.elements.popper),B=[].concat(s.scrollParents.reference,s.scrollParents.popper);return A&&B.forEach(function(te){te.addEventListener("scroll",g.update,JC)}),x&&$.addEventListener("resize",g.update,JC),function(){A&&B.forEach(function(te){te.removeEventListener("scroll",g.update,JC)}),x&&$.removeEventListener("resize",g.update,JC)}}var JN={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:o6,data:{}},a6={left:"right",right:"left",bottom:"top",top:"bottom"};function ZC(i){return i.replace(/left|right|bottom|top/g,function(s){return a6[s]})}var s6={start:"end",end:"start"};function CO(i){return i.replace(/start|end/g,function(s){return s6[s]})}function e1(i){var s=hl(i),g=s.pageXOffset,m=s.pageYOffset;return{scrollLeft:g,scrollTop:m}}function t1(i){return XS(fg(i)).left+e1(i).scrollLeft}function c6(i){var s=hl(i),g=fg(i),m=s.visualViewport,R=g.clientWidth,A=g.clientHeight,D=0,x=0;return m&&(R=m.width,A=m.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(D=m.offsetLeft,x=m.offsetTop)),{width:R,height:A,x:D+t1(i),y:x}}function u6(i){var s,g=fg(i),m=e1(i),R=(s=i.ownerDocument)==null?void 0:s.body,A=Fv(g.scrollWidth,g.clientWidth,R?R.scrollWidth:0,R?R.clientWidth:0),D=Fv(g.scrollHeight,g.clientHeight,R?R.scrollHeight:0,R?R.clientHeight:0),x=-m.scrollLeft+t1(i),$=-m.scrollTop;return ip(R||g).direction==="rtl"&&(x+=Fv(g.clientWidth,R?R.clientWidth:0)-A),{width:A,height:D,x,y:$}}function n1(i){var s=ip(i),g=s.overflow,m=s.overflowX,R=s.overflowY;return/auto|scroll|overlay|hidden/.test(g+R+m)}function XN(i){return["html","body","#document"].indexOf(Md(i))>=0?i.ownerDocument.body:ou(i)&&n1(i)?i:XN(kb(i))}function cT(i,s){var g;s===void 0&&(s=[]);var m=XN(i),R=m===((g=i.ownerDocument)==null?void 0:g.body),A=hl(m),D=R?[A].concat(A.visualViewport||[],n1(m)?m:[]):m,x=s.concat(D);return R?x:x.concat(cT(kb(D)))}function Pw(i){return Object.assign({},i,{left:i.x,top:i.y,right:i.x+i.width,bottom:i.y+i.height})}function l6(i){var s=XS(i);return s.top=s.top+i.clientTop,s.left=s.left+i.clientLeft,s.bottom=s.top+i.clientHeight,s.right=s.left+i.clientWidth,s.width=i.clientWidth,s.height=i.clientHeight,s.x=s.left,s.y=s.top,s}function bO(i,s){return s===qN?Pw(c6(i)):YS(s)?l6(s):Pw(u6(fg(i)))}function d6(i){var s=cT(kb(i)),g=["absolute","fixed"].indexOf(ip(i).position)>=0,m=g&&ou(i)?CT(i):i;return YS(m)?s.filter(function(R){return YS(R)&&$N(R,m)&&Md(R)!=="body"}):[]}function h6(i,s,g){var m=s==="clippingParents"?d6(i):[].concat(s),R=[].concat(m,[g]),A=R[0],D=R.reduce(function(x,$){var B=bO(i,$);return x.top=Fv(B.top,x.top),x.right=fb(B.right,x.right),x.bottom=fb(B.bottom,x.bottom),x.left=Fv(B.left,x.left),x},bO(i,A));return D.width=D.right-D.left,D.height=D.bottom-D.top,D.x=D.left,D.y=D.top,D}function QN(i){var s=i.reference,g=i.element,m=i.placement,R=m?Td(m):null,A=m?QS(m):null,D=s.x+s.width/2-g.width/2,x=s.y+s.height/2-g.height/2,$;switch(R){case Cs:$={x:D,y:s.y-g.height};break;case au:$={x:D,y:s.y+s.height};break;case su:$={x:s.x+s.width,y:x};break;case bs:$={x:s.x-g.width,y:x};break;default:$={x:s.x,y:s.y}}var B=R?Zw(R):null;if(B!=null){var te=B==="y"?"height":"width";switch(A){case zS:$[B]=$[B]-(s[te]/2-g[te]/2);break;case _T:$[B]=$[B]+(s[te]/2-g[te]/2);break}}return $}function yT(i,s){s===void 0&&(s={});var g=s,m=g.placement,R=m===void 0?i.placement:m,A=g.boundary,D=A===void 0?P4:A,x=g.rootBoundary,$=x===void 0?qN:x,B=g.elementContext,te=B===void 0?nT:B,re=g.altBoundary,ie=re===void 0?!1:re,W=g.padding,Y=W===void 0?0:W,se=WN(typeof Y!="number"?Y:zN(Y,RT)),Ae=te===nT?x4:nT,Je=i.rects.popper,Xe=i.elements[ie?Ae:te],Ue=h6(YS(Xe)?Xe:Xe.contextElement||fg(i.elements.popper),D,$),Be=XS(i.elements.reference),Pe=QN({reference:Be,element:Je,strategy:"absolute",placement:R}),de=Pw(Object.assign({},Je,Pe)),Se=te===nT?de:Be,Ee={top:Ue.top-Se.top+se.top,bottom:Se.bottom-Ue.bottom+se.bottom,left:Ue.left-Se.left+se.left,right:Se.right-Ue.right+se.right},ke=i.modifiersData.offset;if(te===nT&&ke){var De=ke[R];Object.keys(Ee).forEach(function(Qe){var vt=[su,au].indexOf(Qe)>=0?1:-1,ft=[Cs,au].indexOf(Qe)>=0?"y":"x";Ee[Qe]+=De[ft]*vt})}return Ee}function p6(i,s){s===void 0&&(s={});var g=s,m=g.placement,R=g.boundary,A=g.rootBoundary,D=g.padding,x=g.flipVariations,$=g.allowedAutoPlacements,B=$===void 0?Jw:$,te=QS(m),re=te?x?TO:TO.filter(function(Y){return QS(Y)===te}):RT,ie=re.filter(function(Y){return B.indexOf(Y)>=0});ie.length===0&&(ie=re);var W=ie.reduce(function(Y,se){return Y[se]=yT(i,{placement:se,boundary:R,rootBoundary:A,padding:D})[Td(se)],Y},{});return Object.keys(W).sort(function(Y,se){return W[Y]-W[se]})}function f6(i){if(Td(i)===Yw)return[];var s=ZC(i);return[CO(i),s,CO(s)]}function g6(i){var s=i.state,g=i.options,m=i.name;if(!s.modifiersData[m]._skip){for(var R=g.mainAxis,A=R===void 0?!0:R,D=g.altAxis,x=D===void 0?!0:D,$=g.fallbackPlacements,B=g.padding,te=g.boundary,re=g.rootBoundary,ie=g.altBoundary,W=g.flipVariations,Y=W===void 0?!0:W,se=g.allowedAutoPlacements,Ae=s.options.placement,Je=Td(Ae),Xe=Je===Ae,Ue=$||(Xe||!Y?[ZC(Ae)]:f6(Ae)),Be=[Ae].concat(Ue).reduce(function(dr,Gn){return dr.concat(Td(Gn)===Yw?p6(s,{placement:Gn,boundary:te,rootBoundary:re,padding:B,flipVariations:Y,allowedAutoPlacements:se}):Gn)},[]),Pe=s.rects.reference,de=s.rects.popper,Se=new Map,Ee=!0,ke=Be[0],De=0;De<Be.length;De++){var Qe=Be[De],vt=Td(Qe),ft=QS(Qe)===zS,it=[Cs,au].indexOf(vt)>=0,ut=it?"width":"height",ee=yT(s,{placement:Qe,boundary:te,rootBoundary:re,altBoundary:ie,padding:B}),xe=it?ft?su:bs:ft?au:Cs;Pe[ut]>de[ut]&&(xe=ZC(xe));var Et=ZC(xe),Fn=[];if(A&&Fn.push(ee[vt]<=0),x&&Fn.push(ee[xe]<=0,ee[Et]<=0),Fn.every(function(dr){return dr})){ke=Qe,Ee=!1;break}Se.set(Qe,Fn)}if(Ee)for(var Fr=Y?3:1,dt=function(dr){var Gn=Be.find(function(Ai){var si=Se.get(Ai);if(si)return si.slice(0,dr).every(function(Nr){return Nr})});if(Gn)return ke=Gn,"break"},ai=Fr;ai>0;ai--){var bi=dt(ai);if(bi==="break")break}s.placement!==ke&&(s.modifiersData[m]._skip=!0,s.placement=ke,s.reset=!0)}}var m6={name:"flip",enabled:!0,phase:"main",fn:g6,requiresIfExists:["offset"],data:{_skip:!1}};function AO(i,s,g){return g===void 0&&(g={x:0,y:0}),{top:i.top-s.height-g.y,right:i.right-s.width+g.x,bottom:i.bottom-s.height+g.y,left:i.left-s.width-g.x}}function kO(i){return[Cs,su,au,bs].some(function(s){return i[s]>=0})}function v6(i){var s=i.state,g=i.name,m=s.rects.reference,R=s.rects.popper,A=s.modifiersData.preventOverflow,D=yT(s,{elementContext:"reference"}),x=yT(s,{altBoundary:!0}),$=AO(D,m),B=AO(x,R,A),te=kO($),re=kO(B);s.modifiersData[g]={referenceClippingOffsets:$,popperEscapeOffsets:B,isReferenceHidden:te,hasPopperEscaped:re},s.attributes.popper=Object.assign({},s.attributes.popper,{"data-popper-reference-hidden":te,"data-popper-escaped":re})}var _6={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:v6};function y6(i,s,g){var m=Td(i),R=[bs,Cs].indexOf(m)>=0?-1:1,A=typeof g=="function"?g(Object.assign({},s,{placement:i})):g,D=A[0],x=A[1];return D=D||0,x=(x||0)*R,[bs,su].indexOf(m)>=0?{x,y:D}:{x:D,y:x}}function S6(i){var s=i.state,g=i.options,m=i.name,R=g.offset,A=R===void 0?[0,0]:R,D=Jw.reduce(function(te,re){return te[re]=y6(re,s.rects,A),te},{}),x=D[s.placement],$=x.x,B=x.y;s.modifiersData.popperOffsets!=null&&(s.modifiersData.popperOffsets.x+=$,s.modifiersData.popperOffsets.y+=B),s.modifiersData[m]=D}var I6={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:S6};function E6(i){var s=i.state,g=i.name;s.modifiersData[g]=QN({reference:s.rects.reference,element:s.rects.popper,strategy:"absolute",placement:s.placement})}var ZN={name:"popperOffsets",enabled:!0,phase:"read",fn:E6,data:{}};function T6(i){return i==="x"?"y":"x"}function M6(i){var s=i.state,g=i.options,m=i.name,R=g.mainAxis,A=R===void 0?!0:R,D=g.altAxis,x=D===void 0?!1:D,$=g.boundary,B=g.rootBoundary,te=g.altBoundary,re=g.padding,ie=g.tether,W=ie===void 0?!0:ie,Y=g.tetherOffset,se=Y===void 0?0:Y,Ae=yT(s,{boundary:$,rootBoundary:B,padding:re,altBoundary:te}),Je=Td(s.placement),Xe=QS(s.placement),Ue=!Xe,Be=Zw(Je),Pe=T6(Be),de=s.modifiersData.popperOffsets,Se=s.rects.reference,Ee=s.rects.popper,ke=typeof se=="function"?se(Object.assign({},s.rects,{placement:s.placement})):se,De=typeof ke=="number"?{mainAxis:ke,altAxis:ke}:Object.assign({mainAxis:0,altAxis:0},ke),Qe=s.modifiersData.offset?s.modifiersData.offset[s.placement]:null,vt={x:0,y:0};if(de){if(A){var ft,it=Be==="y"?Cs:bs,ut=Be==="y"?au:su,ee=Be==="y"?"height":"width",xe=de[Be],Et=xe+Ae[it],Fn=xe-Ae[ut],Fr=W?-Ee[ee]/2:0,dt=Xe===zS?Se[ee]:Ee[ee],ai=Xe===zS?-Ee[ee]:-Se[ee],bi=s.elements.arrow,dr=W&&bi?Qw(bi):{width:0,height:0},Gn=s.modifiersData["arrow#persistent"]?s.modifiersData["arrow#persistent"].padding:KN(),Ai=Gn[it],si=Gn[ut],Nr=sT(0,Se[ee],dr[ee]),_i=Ue?Se[ee]/2-Fr-Nr-Ai-De.mainAxis:dt-Nr-Ai-De.mainAxis,ve=Ue?-Se[ee]/2+Fr+Nr+si+De.mainAxis:ai+Nr+si+De.mainAxis,qn=s.elements.arrow&&CT(s.elements.arrow),ho=qn?Be==="y"?qn.clientTop||0:qn.clientLeft||0:0,hr=(ft=Qe==null?void 0:Qe[Be])!=null?ft:0,Ki=xe+_i-hr-ho,Co=xe+ve-hr,qr=sT(W?fb(Et,Ki):Et,xe,W?Fv(Fn,Co):Fn);de[Be]=qr,vt[Be]=qr-xe}if(x){var Oo,an=Be==="x"?Cs:bs,ur=Be==="x"?au:su,bt=de[Pe],xt=Pe==="y"?"height":"width",Qo=bt+Ae[an],_r=bt-Ae[ur],nt=[Cs,bs].indexOf(Je)!==-1,nn=(Oo=Qe==null?void 0:Qe[Pe])!=null?Oo:0,yi=nt?Qo:bt-Se[xt]-Ee[xt]-nn+De.altAxis,Lr=nt?bt+Se[xt]+Ee[xt]-nn-De.altAxis:_r,pr=W&&nt?X4(yi,bt,Lr):sT(W?yi:Qo,bt,W?Lr:_r);de[Pe]=pr,vt[Pe]=pr-bt}s.modifiersData[m]=vt}}var R6={name:"preventOverflow",enabled:!0,phase:"main",fn:M6,requiresIfExists:["offset"]};function C6(i){return{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}}function b6(i){return i===hl(i)||!ou(i)?e1(i):C6(i)}function A6(i){var s=i.getBoundingClientRect(),g=JS(s.width)/i.offsetWidth||1,m=JS(s.height)/i.offsetHeight||1;return g!==1||m!==1}function k6(i,s,g){g===void 0&&(g=!1);var m=ou(s),R=ou(s)&&A6(s),A=fg(s),D=XS(i,R),x={scrollLeft:0,scrollTop:0},$={x:0,y:0};return(m||!m&&!g)&&((Md(s)!=="body"||n1(A))&&(x=b6(s)),ou(s)?($=XS(s,!0),$.x+=s.clientLeft,$.y+=s.clientTop):A&&($.x=t1(A))),{x:D.left+x.scrollLeft-$.x,y:D.top+x.scrollTop-$.y,width:D.width,height:D.height}}function w6(i){var s=new Map,g=new Set,m=[];i.forEach(function(A){s.set(A.name,A)});function R(A){g.add(A.name);var D=[].concat(A.requires||[],A.requiresIfExists||[]);D.forEach(function(x){if(!g.has(x)){var $=s.get(x);$&&R($)}}),m.push(A)}return i.forEach(function(A){g.has(A.name)||R(A)}),m}function D6(i){var s=w6(i);return K4.reduce(function(g,m){return g.concat(s.filter(function(R){return R.phase===m}))},[])}function O6(i){var s;return function(){return s||(s=new Promise(function(g){Promise.resolve().then(function(){s=void 0,g(i())})})),s}}function N6(i){var s=i.reduce(function(g,m){var R=g[m.name];return g[m.name]=R?Object.assign({},R,m,{options:Object.assign({},R.options,m.options),data:Object.assign({},R.data,m.data)}):m,g},{});return Object.keys(s).map(function(g){return s[g]})}var wO={placement:"bottom",modifiers:[],strategy:"absolute"};function DO(){for(var i=arguments.length,s=new Array(i),g=0;g<i;g++)s[g]=arguments[g];return!s.some(function(m){return!(m&&typeof m.getBoundingClientRect=="function")})}function r1(i){i===void 0&&(i={});var s=i,g=s.defaultModifiers,m=g===void 0?[]:g,R=s.defaultOptions,A=R===void 0?wO:R;return function(D,x,$){$===void 0&&($=A);var B={placement:"bottom",orderedModifiers:[],options:Object.assign({},wO,A),modifiersData:{},elements:{reference:D,popper:x},attributes:{},styles:{}},te=[],re=!1,ie={state:B,setOptions:function(se){var Ae=typeof se=="function"?se(B.options):se;Y(),B.options=Object.assign({},A,B.options,Ae),B.scrollParents={reference:YS(D)?cT(D):D.contextElement?cT(D.contextElement):[],popper:cT(x)};var Je=D6(N6([].concat(m,B.options.modifiers)));return B.orderedModifiers=Je.filter(function(Xe){return Xe.enabled}),W(),ie.update()},forceUpdate:function(){if(!re){var se=B.elements,Ae=se.reference,Je=se.popper;if(DO(Ae,Je)){B.rects={reference:k6(Ae,CT(Je),B.options.strategy==="fixed"),popper:Qw(Je)},B.reset=!1,B.placement=B.options.placement,B.orderedModifiers.forEach(function(Ee){return B.modifiersData[Ee.name]=Object.assign({},Ee.data)});for(var Xe=0;Xe<B.orderedModifiers.length;Xe++){if(B.reset===!0){B.reset=!1,Xe=-1;continue}var Ue=B.orderedModifiers[Xe],Be=Ue.fn,Pe=Ue.options,de=Pe===void 0?{}:Pe,Se=Ue.name;typeof Be=="function"&&(B=Be({state:B,options:de,name:Se,instance:ie})||B)}}}},update:O6(function(){return new Promise(function(se){ie.forceUpdate(),se(B)})}),destroy:function(){Y(),re=!0}};if(!DO(D,x))return ie;ie.setOptions($).then(function(se){!re&&$.onFirstUpdate&&$.onFirstUpdate(se)});function W(){B.orderedModifiers.forEach(function(se){var Ae=se.name,Je=se.options,Xe=Je===void 0?{}:Je,Ue=se.effect;if(typeof Ue=="function"){var Be=Ue({state:B,name:Ae,instance:ie,options:Xe}),Pe=function(){};te.push(Be||Pe)}})}function Y(){te.forEach(function(se){return se()}),te=[]}return ie}}r1();var L6=[JN,ZN,YN,HN];r1({defaultModifiers:L6});var P6=[JN,ZN,YN,HN,I6,m6,R6,t6,_6],x6=r1({defaultModifiers:P6});const eL=i=>{const s=[],g=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,{acceptNode:m=>{const R=m.tagName==="INPUT"&&m.type==="hidden";return m.disabled||m.hidden||R?NodeFilter.FILTER_SKIP:m.tabIndex>=0||m===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;g.nextNode();)s.push(g.currentNode);return s},OO=(i,s)=>{for(const g of i)if(!U6(g,s))return g},U6=(i,s)=>{if(getComputedStyle(i).visibility==="hidden")return!0;for(;i;){if(s&&i===s)return!1;if(getComputedStyle(i).display==="none")return!0;i=i.parentElement}return!1},G6=i=>{const s=eL(i),g=OO(s,i),m=OO(s.reverse(),i);return[g,m]},F6=i=>i instanceof HTMLInputElement&&"select"in i,tg=(i,s)=>{if(i&&i.focus){const g=document.activeElement;i.focus({preventScroll:!0}),i!==g&&F6(i)&&s&&i.select()}};function NO(i,s){const g=[...i],m=i.indexOf(s);return m!==-1&&g.splice(m,1),g}const V6=()=>{let i=[];return{push:m=>{const R=i[0];R&&m!==R&&R.pause(),i=NO(i,m),i.unshift(m)},remove:m=>{var R,A;i=NO(i,m),(A=(R=i[0])==null?void 0:R.resume)==null||A.call(R)}}},B6=(i,s=!1)=>{const g=document.activeElement;for(const m of i)if(tg(m,s),document.activeElement!==g)return},LO=V6(),Sw="focus-trap.focus-after-trapped",Iw="focus-trap.focus-after-released",PO={cancelable:!0,bubbles:!1},xO="focusAfterTrapped",UO="focusAfterReleased",j6=Symbol("elFocusTrap"),q6=Ar({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[xO,UO,"focusin","focusout","focusout-prevented","release-requested"],setup(i,{emit:s}){const g=Ft();let m,R;B3(W=>{i.trapped&&!A.paused&&s("release-requested",W)});const A={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},D=W=>{if(!i.loop&&!i.trapped||A.paused)return;const{key:Y,altKey:se,ctrlKey:Ae,metaKey:Je,currentTarget:Xe,shiftKey:Ue}=W,{loop:Be}=i,Pe=Y===vT.tab&&!se&&!Ae&&!Je,de=document.activeElement;if(Pe&&de){const Se=Xe,[Ee,ke]=G6(Se);Ee&&ke?!Ue&&de===ke?(W.preventDefault(),Be&&tg(Ee,!0),s("focusout-prevented")):Ue&&[Ee,Se].includes(de)&&(W.preventDefault(),Be&&tg(ke,!0),s("focusout-prevented")):de===Se&&(W.preventDefault(),s("focusout-prevented"))}};ll(j6,{focusTrapRef:g,onKeydown:D}),jn(()=>i.focusTrapEl,W=>{W&&(g.value=W)},{immediate:!0}),jn([g],([W],[Y])=>{W&&(W.addEventListener("keydown",D),W.addEventListener("focusin",B),W.addEventListener("focusout",te)),Y&&(Y.removeEventListener("keydown",D),Y.removeEventListener("focusin",B),Y.removeEventListener("focusout",te))});const x=W=>{s(xO,W)},$=W=>s(UO,W),B=W=>{const Y=_e(g);if(!Y)return;const se=W.target,Ae=se&&Y.contains(se);Ae&&s("focusin",W),!A.paused&&i.trapped&&(Ae?R=se:tg(R,!0))},te=W=>{const Y=_e(g);if(!(A.paused||!Y))if(i.trapped){const se=W.relatedTarget;!Tb(se)&&!Y.contains(se)&&setTimeout(()=>{!A.paused&&i.trapped&&tg(R,!0)},0)}else{const se=W.target;se&&Y.contains(se)||s("focusout",W)}};async function re(){await oi();const W=_e(g);if(W){LO.push(A);const Y=document.activeElement;if(m=Y,!W.contains(Y)){const Ae=new Event(Sw,PO);W.addEventListener(Sw,x),W.dispatchEvent(Ae),Ae.defaultPrevented||oi(()=>{let Je=i.focusStartEl;Gv(Je)||(tg(Je),document.activeElement!==Je&&(Je="first")),Je==="first"&&B6(eL(W),!0),(document.activeElement===Y||Je==="container")&&tg(W)})}}}function ie(){const W=_e(g);if(W){W.removeEventListener(Sw,x);const Y=new Event(Iw,PO);W.addEventListener(Iw,$),W.dispatchEvent(Y),Y.defaultPrevented||tg(m!=null?m:document.body,!0),W.removeEventListener(Iw,x),LO.remove(A)}}return Ba(()=>{i.trapped&&re(),jn(()=>i.trapped,W=>{W?re():ie()})}),op(()=>{i.trapped&&ie()}),{onKeydown:D}}});function H6(i,s,g,m,R,A){return br(i.$slots,"default",{handleKeydown:i.onKeydown})}var tL=$i(q6,[["render",H6],["__file","/home/runner/work/element-plus/element-plus/packages/components/focus-trap/src/focus-trap.vue"]]);const $6=["fixed","absolute"],K6=Ro({boundariesPadding:{type:Number,default:0},fallbackPlacements:{type:Ri(Array),default:()=>[]},gpuAcceleration:{type:Boolean,default:!0},offset:{type:Number,default:12},placement:{type:String,values:Jw,default:"bottom"},popperOptions:{type:Ri(Object),default:()=>({})},strategy:{type:String,values:$6,default:"absolute"}}),nL=Ro({...K6,id:String,style:{type:Ri([String,Array,Object])},className:{type:Ri([String,Array,Object])},effect:{type:String,default:"dark"},visible:Boolean,enterable:{type:Boolean,default:!0},pure:Boolean,focusOnShow:{type:Boolean,default:!1},trapping:{type:Boolean,default:!1},popperClass:{type:Ri([String,Array,Object])},popperStyle:{type:Ri([String,Array,Object])},referenceEl:{type:Ri(Object)},triggerTargetEl:{type:Ri(Object)},stopPopperMouseEvent:{type:Boolean,default:!0},ariaLabel:{type:String,default:void 0},virtualTriggering:Boolean,zIndex:Number}),W6=["mouseenter","mouseleave","focus","blur","close"],GO=(i,s)=>{const{placement:g,strategy:m,popperOptions:R}=i,A={placement:g,strategy:m,...R,modifiers:Y6(i)};return J6(A,s),X6(A,R==null?void 0:R.modifiers),A},z6=i=>{if(!!Mo)return ag(i)};function Y6(i){const{offset:s,gpuAcceleration:g,fallbackPlacements:m}=i;return[{name:"offset",options:{offset:[0,s!=null?s:12]}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5,fallbackPlacements:m!=null?m:[]}},{name:"computeStyles",options:{gpuAcceleration:g,adaptive:g}}]}function J6(i,{arrowEl:s,arrowOffset:g}){i.modifiers.push({name:"arrow",options:{element:s,padding:g!=null?g:5}})}function X6(i,s){s&&(i.modifiers=[...i.modifiers,...s!=null?s:[]])}const Q6={name:"ElPopperContent"},Z6=Ar({...Q6,props:nL,emits:W6,setup(i,{expose:s,emit:g}){const m=i,{popperInstanceRef:R,contentRef:A,triggerRef:D,role:x}=Ci(Kw,void 0),$=Ci(KS,void 0),{nextZIndex:B}=GN(),te=Hi("popper"),re=Ft(),ie=Ft("first"),W=Ft(),Y=Ft();ll(ON,{arrowRef:W,arrowOffset:Y}),$&&($.addInputId||$.removeInputId)&&ll(KS,{...$,addInputId:ug,removeInputId:ug});const se=Ft(m.zIndex||B()),Ae=Ft(!1);let Je;const Xe=It(()=>z6(m.referenceEl)||_e(D)),Ue=It(()=>[{zIndex:_e(se)},m.popperStyle]),Be=It(()=>[te.b(),te.is("pure",m.pure),te.is(m.effect),m.popperClass]),Pe=It(()=>x&&x.value==="dialog"?"false":void 0),de=({referenceEl:it,popperContentEl:ut,arrowEl:ee})=>{const xe=GO(m,{arrowEl:ee,arrowOffset:_e(Y)});return x6(it,ut,xe)},Se=(it=!0)=>{var ut;(ut=_e(R))==null||ut.update(),it&&(se.value=m.zIndex||B())},Ee=()=>{var it,ut;const ee={name:"eventListeners",enabled:m.visible};(ut=(it=_e(R))==null?void 0:it.setOptions)==null||ut.call(it,xe=>({...xe,modifiers:[...xe.modifiers||[],ee]})),Se(!1),m.visible&&m.focusOnShow?Ae.value=!0:m.visible===!1&&(Ae.value=!1)},ke=()=>{g("focus")},De=()=>{ie.value="first",g("blur")},Qe=it=>{var ut;m.visible&&!Ae.value&&(it.target&&(ie.value=it.target),Ae.value=!0,it.relatedTarget&&((ut=it.relatedTarget)==null||ut.focus()))},vt=()=>{m.trapping||(Ae.value=!1)},ft=()=>{Ae.value=!1,g("close")};return Ba(()=>{let it;jn(Xe,ut=>{var ee;it==null||it();const xe=_e(R);if((ee=xe==null?void 0:xe.destroy)==null||ee.call(xe),ut){const Et=_e(re);A.value=Et,R.value=de({referenceEl:ut,popperContentEl:Et,arrowEl:_e(W)}),it=jn(()=>ut.getBoundingClientRect(),()=>Se(),{immediate:!0})}else R.value=void 0},{immediate:!0}),jn(()=>m.triggerTargetEl,(ut,ee)=>{Je==null||Je(),Je=void 0;const xe=_e(ut||re.value),Et=_e(ee||re.value);if(fT(xe)){const{ariaLabel:Fn,id:Fr}=TT(m);Je=jn([x,Fn,Pe,Fr],dt=>{["role","aria-label","aria-modal","id"].forEach((ai,bi)=>{Tb(dt[bi])?xe.removeAttribute(ai):xe.setAttribute(ai,dt[bi])})},{immediate:!0})}fT(Et)&&["role","aria-label","aria-modal","id"].forEach(Fn=>{Et.removeAttribute(Fn)})},{immediate:!0}),jn(()=>m.visible,Ee,{immediate:!0}),jn(()=>GO(m,{arrowEl:_e(W),arrowOffset:_e(Y)}),ut=>{var ee;return(ee=R.value)==null?void 0:ee.setOptions(ut)})}),op(()=>{Je==null||Je(),Je=void 0}),s({popperContentRef:re,popperInstanceRef:R,updatePopper:Se,contentStyle:Ue}),(it,ut)=>(pt(),qt("div",{ref_key:"popperContentRef",ref:re,style:Va(_e(Ue)),class:Nt(_e(Be)),tabindex:"-1",onMouseenter:ut[0]||(ut[0]=ee=>it.$emit("mouseenter",ee)),onMouseleave:ut[1]||(ut[1]=ee=>it.$emit("mouseleave",ee))},[jr(_e(tL),{trapped:Ae.value,"trap-on-focus-in":!0,"focus-trap-el":re.value,"focus-start-el":ie.value,onFocusAfterTrapped:ke,onFocusAfterReleased:De,onFocusin:Qe,onFocusoutPrevented:vt,onReleaseRequested:ft},{default:Zn(()=>[br(it.$slots,"default")]),_:3},8,["trapped","focus-trap-el","focus-start-el"])],38))}});var eB=$i(Z6,[["__file","/home/runner/work/element-plus/element-plus/packages/components/popper/src/content.vue"]]);const tB=cp(C4),nB=Hi("tooltip"),i1=Ro({...H3,...nL,appendTo:{type:Ri([String,Object]),default:xN},content:{type:String,default:""},rawContent:{type:Boolean,default:!1},persistent:Boolean,ariaLabel:String,visible:{type:Ri(Boolean),default:null},transition:{type:String,default:`${nB.namespace.value}-fade-in-linear`},teleported:{type:Boolean,default:!0},disabled:{type:Boolean}}),rL=Ro({...jN,disabled:Boolean,trigger:{type:Ri([String,Array]),default:"hover"},triggerKeys:{type:Ri(Array),default:()=>[vT.enter,vT.space]}}),rB=Ro({openDelay:{type:Number},visibleArrow:{type:Boolean,default:void 0},hideAfter:{type:Number,default:200},showArrow:{type:Boolean,default:!0}}),o1=Symbol("elTooltip"),iB=Ar({name:"ElTooltipContent",components:{ElPopperContent:eB},inheritAttrs:!1,props:i1,setup(i){const s=Ft(null),g=Ft(!1),m=Ft(!1),R=Ft(!1),A=Ft(!1),{controlled:D,id:x,open:$,trigger:B,onClose:te,onOpen:re,onShow:ie,onHide:W,onBeforeShow:Y,onBeforeHide:se}=Ci(o1,void 0),Ae=It(()=>i.persistent);op(()=>{A.value=!0});const Je=It(()=>_e(Ae)?!0:_e($)),Xe=It(()=>i.disabled?!1:_e($)),Ue=It(()=>{var it;return(it=i.style)!=null?it:{}}),Be=It(()=>!_e($)),Pe=()=>{W()},de=()=>{if(_e(D))return!0},Se=tp(de,()=>{i.enterable&&_e(B)==="hover"&&re()}),Ee=tp(de,()=>{_e(B)==="hover"&&te()}),ke=()=>{var it,ut;(ut=(it=s.value)==null?void 0:it.updatePopper)==null||ut.call(it),Y==null||Y()},De=()=>{se==null||se()},Qe=()=>{ie(),ft=zF(It(()=>{var it;return(it=s.value)==null?void 0:it.popperContentRef}),()=>{if(_e(D))return;_e(B)!=="hover"&&te()})},vt=()=>{i.virtualTriggering||te()};let ft;return jn(()=>_e($),it=>{it||ft==null||ft()},{flush:"post"}),{ariaHidden:Be,entering:m,leaving:R,id:x,intermediateOpen:g,contentStyle:Ue,contentRef:s,destroyed:A,shouldRender:Je,shouldShow:Xe,onClose:te,open:$,onAfterShow:Qe,onBeforeEnter:ke,onBeforeLeave:De,onContentEnter:Se,onContentLeave:Ee,onTransitionLeave:Pe,onBlur:vt}}});function oB(i,s,g,m,R,A){const D=Jo("el-popper-content");return pt(),nr(tN,{disabled:!i.teleported,to:i.appendTo},[jr(IT,{name:i.transition,onAfterLeave:i.onTransitionLeave,onBeforeEnter:i.onBeforeEnter,onAfterEnter:i.onAfterShow,onBeforeLeave:i.onBeforeLeave},{default:Zn(()=>[i.shouldRender?Rs((pt(),nr(D,GS({key:0,id:i.id,ref:"contentRef"},i.$attrs,{"aria-label":i.ariaLabel,"aria-hidden":i.ariaHidden,"boundaries-padding":i.boundariesPadding,"fallback-placements":i.fallbackPlacements,"gpu-acceleration":i.gpuAcceleration,offset:i.offset,placement:i.placement,"popper-options":i.popperOptions,strategy:i.strategy,effect:i.effect,enterable:i.enterable,pure:i.pure,"popper-class":i.popperClass,"popper-style":[i.popperStyle,i.contentStyle],"reference-el":i.referenceEl,"trigger-target-el":i.triggerTargetEl,visible:i.shouldShow,"z-index":i.zIndex,onMouseenter:i.onContentEnter,onMouseleave:i.onContentLeave,onBlur:i.onBlur,onClose:i.onClose}),{default:Zn(()=>[wn(" Workaround bug #6378 "),i.destroyed?wn("v-if",!0):br(i.$slots,"default",{key:0})]),_:3},16,["id","aria-label","aria-hidden","boundaries-padding","fallback-placements","gpu-acceleration","offset","placement","popper-options","strategy","effect","enterable","pure","popper-class","popper-style","reference-el","trigger-target-el","visible","z-index","onMouseenter","onMouseleave","onBlur","onClose"])),[[Hv,i.shouldShow]]):wn("v-if",!0)]),_:3},8,["name","onAfterLeave","onBeforeEnter","onAfterEnter","onBeforeLeave"])],8,["disabled","to"])}var aB=$i(iB,[["render",oB],["__file","/home/runner/work/element-plus/element-plus/packages/components/tooltip/src/content.vue"]]);const sB=(i,s)=>Rw(i)?i.includes(s):i===s,bS=(i,s,g)=>m=>{sB(_e(i),s)&&g(m)},cB=Ar({name:"ElTooltipTrigger",components:{ElPopperTrigger:L4},props:rL,setup(i){const s=Hi("tooltip"),{controlled:g,id:m,open:R,onOpen:A,onClose:D,onToggle:x}=Ci(o1,void 0),$=Ft(null),B=()=>{if(_e(g)||i.disabled)return!0},te=Bv(i,"trigger"),re=tp(B,bS(te,"hover",A)),ie=tp(B,bS(te,"hover",D)),W=tp(B,bS(te,"click",Xe=>{Xe.button===0&&x(Xe)})),Y=tp(B,bS(te,"focus",A)),se=tp(B,bS(te,"focus",D)),Ae=tp(B,bS(te,"contextmenu",Xe=>{Xe.preventDefault(),x(Xe)})),Je=tp(B,Xe=>{const{code:Ue}=Xe;i.triggerKeys.includes(Ue)&&(Xe.preventDefault(),x(Xe))});return{onBlur:se,onContextMenu:Ae,onFocus:Y,onMouseenter:re,onMouseleave:ie,onClick:W,onKeydown:Je,open:R,id:m,triggerRef:$,ns:s}}});function uB(i,s,g,m,R,A){const D=Jo("el-popper-trigger");return pt(),nr(D,{id:i.id,"virtual-ref":i.virtualRef,open:i.open,"virtual-triggering":i.virtualTriggering,class:Nt(i.ns.e("trigger")),onBlur:i.onBlur,onClick:i.onClick,onContextmenu:i.onContextMenu,onFocus:i.onFocus,onMouseenter:i.onMouseenter,onMouseleave:i.onMouseleave,onKeydown:i.onKeydown},{default:Zn(()=>[br(i.$slots,"default")]),_:3},8,["id","virtual-ref","open","virtual-triggering","class","onBlur","onClick","onContextmenu","onFocus","onMouseenter","onMouseleave","onKeydown"])}var lB=$i(cB,[["render",uB],["__file","/home/runner/work/element-plus/element-plus/packages/components/tooltip/src/trigger.vue"]]);const{useModelToggleProps:dB,useModelToggle:hB,useModelToggleEmits:pB}=G3("visible"),fB=Ar({name:"ElTooltip",components:{ElPopper:tB,ElPopperArrow:k4,ElTooltipContent:aB,ElTooltipTrigger:lB},props:{...FN,...dB,...i1,...rL,...VN,...rB},emits:[...pB,"before-show","before-hide","show","hide","open","close"],setup(i,{emit:s}){q3();const g=It(()=>(Nw(i.openDelay),i.openDelay||i.showAfter)),m=It(()=>(Nw(i.visibleArrow),$S(i.visibleArrow)?i.visibleArrow:i.showArrow)),R=pb(),A=Ft(null),D=Ft(null),x=()=>{var Je;const Xe=_e(A);Xe&&((Je=Xe.popperInstanceRef)==null||Je.update())},$=Ft(!1),B=Ft(void 0),{show:te,hide:re,hasUpdateHandler:ie}=hB({indicator:$,toggleReason:B}),{onOpen:W,onClose:Y}=$3({showAfter:g,hideAfter:Bv(i,"hideAfter"),open:te,close:re}),se=It(()=>$S(i.visible)&&!ie.value);ll(o1,{controlled:se,id:R,open:Zx($),trigger:Bv(i,"trigger"),onOpen:Je=>{W(Je)},onClose:Je=>{Y(Je)},onToggle:Je=>{_e($)?Y(Je):W(Je)},onShow:()=>{s("show",B.value)},onHide:()=>{s("hide",B.value)},onBeforeShow:()=>{s("before-show",B.value)},onBeforeHide:()=>{s("before-hide",B.value)},updatePopper:x}),jn(()=>i.disabled,Je=>{Je&&$.value&&($.value=!1)});const Ae=()=>{var Je,Xe;const Ue=(Xe=(Je=D.value)==null?void 0:Je.contentRef)==null?void 0:Xe.popperContentRef;return Ue&&Ue.contains(document.activeElement)};return e2(()=>$.value&&re()),{compatShowAfter:g,compatShowArrow:m,popperRef:A,contentRef:D,open:$,hide:re,isFocusInsideContent:Ae,updatePopper:x,onOpen:W,onClose:Y}}}),gB=["innerHTML"],mB={key:1};function vB(i,s,g,m,R,A){const D=Jo("el-tooltip-trigger"),x=Jo("el-popper-arrow"),$=Jo("el-tooltip-content"),B=Jo("el-popper");return pt(),nr(B,{ref:"popperRef",role:i.role},{default:Zn(()=>[jr(D,{disabled:i.disabled,trigger:i.trigger,"trigger-keys":i.triggerKeys,"virtual-ref":i.virtualRef,"virtual-triggering":i.virtualTriggering},{default:Zn(()=>[i.$slots.default?br(i.$slots,"default",{key:0}):wn("v-if",!0)]),_:3},8,["disabled","trigger","trigger-keys","virtual-ref","virtual-triggering"]),jr($,{ref:"contentRef","aria-label":i.ariaLabel,"boundaries-padding":i.boundariesPadding,content:i.content,disabled:i.disabled,effect:i.effect,enterable:i.enterable,"fallback-placements":i.fallbackPlacements,"hide-after":i.hideAfter,"gpu-acceleration":i.gpuAcceleration,offset:i.offset,persistent:i.persistent,"popper-class":i.popperClass,"popper-style":i.popperStyle,placement:i.placement,"popper-options":i.popperOptions,pure:i.pure,"raw-content":i.rawContent,"reference-el":i.referenceEl,"trigger-target-el":i.triggerTargetEl,"show-after":i.compatShowAfter,strategy:i.strategy,teleported:i.teleported,transition:i.transition,"virtual-triggering":i.virtualTriggering,"z-index":i.zIndex,"append-to":i.appendTo},{default:Zn(()=>[br(i.$slots,"content",{},()=>[i.rawContent?(pt(),qt("span",{key:0,innerHTML:i.content},null,8,gB)):(pt(),qt("span",mB,lo(i.content),1))]),i.compatShowArrow?(pt(),nr(x,{key:0,"arrow-offset":i.arrowOffset},null,8,["arrow-offset"])):wn("v-if",!0)]),_:3},8,["aria-label","boundaries-padding","content","disabled","effect","enterable","fallback-placements","hide-after","gpu-acceleration","offset","persistent","popper-class","popper-style","placement","popper-options","pure","raw-content","reference-el","trigger-target-el","show-after","strategy","teleported","transition","virtual-triggering","z-index","append-to"])]),_:3},8,["role"])}var _B=$i(fB,[["render",vB],["__file","/home/runner/work/element-plus/element-plus/packages/components/tooltip/src/tooltip.vue"]]);const yB=cp(_B);var rc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function SB(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}const ng=new Map;let FO;Mo&&(document.addEventListener("mousedown",i=>FO=i),document.addEventListener("mouseup",i=>{for(const s of ng.values())for(const{documentHandler:g}of s)g(i,FO)}));function VO(i,s){let g=[];return Array.isArray(s.arg)?g=s.arg:fT(s.arg)&&g.push(s.arg),function(m,R){const A=s.instance.popperRef,D=m.target,x=R==null?void 0:R.target,$=!s||!s.instance,B=!D||!x,te=i.contains(D)||i.contains(x),re=i===D,ie=g.length&&g.some(Y=>Y==null?void 0:Y.contains(D))||g.length&&g.includes(x),W=A&&(A.contains(D)||A.contains(x));$||B||te||re||ie||W||s.value(m,R)}}const IB={beforeMount(i,s){ng.has(i)||ng.set(i,[]),ng.get(i).push({documentHandler:VO(i,s),bindingFn:s.value})},updated(i,s){ng.has(i)||ng.set(i,[]);const g=ng.get(i),m=g.findIndex(A=>A.bindingFn===s.oldValue),R={documentHandler:VO(i,s),bindingFn:s.value};m>=0?g.splice(m,1,R):g.push(R)},unmounted(i){ng.delete(i)}},EB={modelValue:{type:Array,default:()=>[]},disabled:Boolean,min:{type:Number,default:void 0},max:{type:Number,default:void 0},size:Ww,id:{type:String,default:void 0},label:{type:String,default:void 0},fill:{type:String,default:void 0},textColor:{type:String,default:void 0},tag:{type:String,default:"div"},validateEvent:{type:Boolean,default:!0}},iL={modelValue:{type:[Number,String,Boolean],default:()=>{}},label:{type:[String,Boolean,Number,Object]},indeterminate:Boolean,disabled:Boolean,checked:Boolean,name:{type:String,default:void 0},trueLabel:{type:[String,Number],default:void 0},falseLabel:{type:[String,Number],default:void 0},id:{type:String,default:void 0},controls:{type:String,default:void 0},border:Boolean,size:Ww,tabindex:[String,Number],validateEvent:{type:Boolean,default:!0}},n0=()=>{const i=Ci(MT,{}),s=Ci(KS,{}),g=Ci("CheckboxGroup",{}),m=It(()=>g&&(g==null?void 0:g.name)==="ElCheckboxGroup"),R=It(()=>s.size);return{isGroup:m,checkboxGroup:g,elForm:i,elFormItemSize:R,elFormItem:s}},TB=(i,{elFormItem:s})=>{const{inputId:g,isLabeledByFormItem:m}=zw(i,{formItemContext:s});return{isLabeledByFormItem:m,groupId:g}},MB=i=>{const s=Ft(!1),{emit:g}=cu(),{isGroup:m,checkboxGroup:R,elFormItem:A}=n0(),D=Ft(!1);return{model:It({get(){var $,B;return m.value?($=R.modelValue)==null?void 0:$.value:(B=i.modelValue)!=null?B:s.value},set($){var B;m.value&&Array.isArray($)?(D.value=R.max!==void 0&&$.length>R.max.value,D.value===!1&&((B=R==null?void 0:R.changeEvent)==null||B.call(R,$))):(g(Xo,$),s.value=$)}}),isGroup:m,isLimitExceeded:D,elFormItem:A}},RB=(i,s,{model:g})=>{const{isGroup:m,checkboxGroup:R}=n0(),A=Ft(!1),D=WS(R==null?void 0:R.checkboxGroupSize,{prop:!0}),x=It(()=>{const te=g.value;return t2(te)==="[object Boolean]"?te:Array.isArray(te)?te.includes(i.label):te!=null?te===i.trueLabel:!!te}),$=WS(It(()=>{var te;return m.value?(te=R==null?void 0:R.checkboxGroupSize)==null?void 0:te.value:void 0})),B=It(()=>!!(s.default||i.label));return{isChecked:x,focus:A,size:D,checkboxSize:$,hasOwnLabel:B}},CB=(i,{model:s,isChecked:g})=>{const{elForm:m,isGroup:R,checkboxGroup:A}=n0(),D=It(()=>{var $,B;const te=($=A.max)==null?void 0:$.value,re=(B=A.min)==null?void 0:B.value;return!!(te||re)&&s.value.length>=te&&!g.value||s.value.length<=re&&g.value});return{isDisabled:It(()=>{var $,B;const te=i.disabled||(m==null?void 0:m.disabled);return(B=R.value?(($=A.disabled)==null?void 0:$.value)||te||D.value:te)!=null?B:!1}),isLimitDisabled:D}},bB=(i,{model:s})=>{function g(){Array.isArray(s.value)&&!s.value.includes(i.label)?s.value.push(i.label):s.value=i.trueLabel||!0}i.checked&&g()},AB=(i,{model:s,isLimitExceeded:g,hasOwnLabel:m,isDisabled:R,isLabeledByFormItem:A})=>{const{elFormItem:D,checkboxGroup:x}=n0(),{emit:$}=cu();function B(Y){var se,Ae;return Y===i.trueLabel||Y===!0?(se=i.trueLabel)!=null?se:!0:(Ae=i.falseLabel)!=null?Ae:!1}function te(Y,se){$("change",B(Y),se)}function re(Y){if(g.value)return;const se=Y.target;$("change",B(se.checked),Y)}async function ie(Y){g.value||!m.value&&!R.value&&A.value&&(s.value=B([!1,i.falseLabel].includes(s.value)),await oi(),te(s.value,Y))}const W=It(()=>{var Y;return((Y=x.validateEvent)==null?void 0:Y.value)||i.validateEvent});return jn(()=>i.modelValue,()=>{var Y;W.value&&((Y=D==null?void 0:D.validate)==null||Y.call(D,"change").catch(se=>void 0))}),{handleChange:re,onClickRoot:ie}},oL={[Xo]:i=>Gv(i)||Id(i)||$S(i),change:i=>Gv(i)||Id(i)||$S(i)},kB={[Xo]:i=>Rw(i),change:i=>Rw(i)},aL=(i,s)=>{const{model:g,isGroup:m,isLimitExceeded:R,elFormItem:A}=MB(i),{focus:D,size:x,isChecked:$,checkboxSize:B,hasOwnLabel:te}=RB(i,s,{model:g}),{isDisabled:re}=CB(i,{model:g,isChecked:$}),{inputId:ie,isLabeledByFormItem:W}=zw(i,{formItemContext:A,disableIdGeneration:te,disableIdManagement:m}),{handleChange:Y,onClickRoot:se}=AB(i,{model:g,isLimitExceeded:R,hasOwnLabel:te,isDisabled:re,isLabeledByFormItem:W});return bB(i,{model:g}),{elFormItem:A,inputId:ie,isLabeledByFormItem:W,isChecked:$,isDisabled:re,isGroup:m,checkboxSize:B,hasOwnLabel:te,model:g,handleChange:Y,onClickRoot:se,focus:D,size:x}},wB=["tabindex","role","aria-checked"],DB=["id","aria-hidden","name","tabindex","disabled","true-value","false-value"],OB=["id","aria-hidden","disabled","value","name","tabindex"],NB={name:"ElCheckbox"},LB=Ar({...NB,props:iL,emits:oL,setup(i){const s=i,g=Bw(),{inputId:m,isLabeledByFormItem:R,isChecked:A,isDisabled:D,checkboxSize:x,hasOwnLabel:$,model:B,handleChange:te,onClickRoot:re,focus:ie}=aL(s,g),W=Hi("checkbox");return(Y,se)=>(pt(),nr(rp(!_e($)&&_e(R)?"span":"label"),{class:Nt([_e(W).b(),_e(W).m(_e(x)),_e(W).is("disabled",_e(D)),_e(W).is("bordered",Y.border),_e(W).is("checked",_e(A))]),"aria-controls":Y.indeterminate?Y.controls:null,onClick:_e(re)},{default:Zn(()=>[Kt("span",{class:Nt([_e(W).e("input"),_e(W).is("disabled",_e(D)),_e(W).is("checked",_e(A)),_e(W).is("indeterminate",Y.indeterminate),_e(W).is("focus",_e(ie))]),tabindex:Y.indeterminate?0:void 0,role:Y.indeterminate?"checkbox":void 0,"aria-checked":Y.indeterminate?"mixed":void 0},[Y.trueLabel||Y.falseLabel?Rs((pt(),qt("input",{key:0,id:_e(m),"onUpdate:modelValue":se[0]||(se[0]=Ae=>jS(B)?B.value=Ae:null),class:Nt(_e(W).e("original")),type:"checkbox","aria-hidden":Y.indeterminate?"true":"false",name:Y.name,tabindex:Y.tabindex,disabled:_e(D),"true-value":Y.trueLabel,"false-value":Y.falseLabel,onChange:se[1]||(se[1]=(...Ae)=>_e(te)&&_e(te)(...Ae)),onFocus:se[2]||(se[2]=Ae=>ie.value=!0),onBlur:se[3]||(se[3]=Ae=>ie.value=!1)},null,42,DB)),[[ub,_e(B)]]):Rs((pt(),qt("input",{key:1,id:_e(m),"onUpdate:modelValue":se[4]||(se[4]=Ae=>jS(B)?B.value=Ae:null),class:Nt(_e(W).e("original")),type:"checkbox","aria-hidden":Y.indeterminate?"true":"false",disabled:_e(D),value:Y.label,name:Y.name,tabindex:Y.tabindex,onChange:se[5]||(se[5]=(...Ae)=>_e(te)&&_e(te)(...Ae)),onFocus:se[6]||(se[6]=Ae=>ie.value=!0),onBlur:se[7]||(se[7]=Ae=>ie.value=!1)},null,42,OB)),[[ub,_e(B)]]),Kt("span",{class:Nt(_e(W).e("inner"))},null,2)],10,wB),_e($)?(pt(),qt("span",{key:0,class:Nt(_e(W).e("label"))},[br(Y.$slots,"default"),Y.$slots.default?wn("v-if",!0):(pt(),qt(ic,{key:0},[nN(lo(Y.label),1)],64))],2)):wn("v-if",!0)]),_:3},8,["class","aria-controls","onClick"]))}});var PB=$i(LB,[["__file","/home/runner/work/element-plus/element-plus/packages/components/checkbox/src/checkbox.vue"]]);const xB=["name","tabindex","disabled","true-value","false-value"],UB=["name","tabindex","disabled","value"],GB={name:"ElCheckboxButton"},FB=Ar({...GB,props:iL,emits:oL,setup(i){const s=i,g=Bw(),{focus:m,isChecked:R,isDisabled:A,size:D,model:x,handleChange:$}=aL(s,g),{checkboxGroup:B}=n0(),te=Hi("checkbox"),re=It(()=>{var ie,W,Y,se;const Ae=(W=(ie=B==null?void 0:B.fill)==null?void 0:ie.value)!=null?W:"";return{backgroundColor:Ae,borderColor:Ae,color:(se=(Y=B==null?void 0:B.textColor)==null?void 0:Y.value)!=null?se:"",boxShadow:Ae?`-1px 0 0 0 ${Ae}`:void 0}});return(ie,W)=>(pt(),qt("label",{class:Nt([_e(te).b("button"),_e(te).bm("button",_e(D)),_e(te).is("disabled",_e(A)),_e(te).is("checked",_e(R)),_e(te).is("focus",_e(m))])},[ie.trueLabel||ie.falseLabel?Rs((pt(),qt("input",{key:0,"onUpdate:modelValue":W[0]||(W[0]=Y=>jS(x)?x.value=Y:null),class:Nt(_e(te).be("button","original")),type:"checkbox",name:ie.name,tabindex:ie.tabindex,disabled:_e(A),"true-value":ie.trueLabel,"false-value":ie.falseLabel,onChange:W[1]||(W[1]=(...Y)=>_e($)&&_e($)(...Y)),onFocus:W[2]||(W[2]=Y=>m.value=!0),onBlur:W[3]||(W[3]=Y=>m.value=!1)},null,42,xB)),[[ub,_e(x)]]):Rs((pt(),qt("input",{key:1,"onUpdate:modelValue":W[4]||(W[4]=Y=>jS(x)?x.value=Y:null),class:Nt(_e(te).be("button","original")),type:"checkbox",name:ie.name,tabindex:ie.tabindex,disabled:_e(A),value:ie.label,onChange:W[5]||(W[5]=(...Y)=>_e($)&&_e($)(...Y)),onFocus:W[6]||(W[6]=Y=>m.value=!0),onBlur:W[7]||(W[7]=Y=>m.value=!1)},null,42,UB)),[[ub,_e(x)]]),ie.$slots.default||ie.label?(pt(),qt("span",{key:2,class:Nt(_e(te).be("button","inner")),style:Va(_e(R)?_e(re):void 0)},[br(ie.$slots,"default",{},()=>[nN(lo(ie.label),1)])],6)):wn("v-if",!0)],2))}});var sL=$i(FB,[["__file","/home/runner/work/element-plus/element-plus/packages/components/checkbox/src/checkbox-button.vue"]]);const VB={name:"ElCheckboxGroup"},BB=Ar({...VB,props:EB,emits:kB,setup(i,{emit:s}){const g=i,{elFormItem:m}=n0(),{groupId:R,isLabeledByFormItem:A}=TB(g,{elFormItem:m}),D=WS(),x=Hi("checkbox"),$=te=>{s(Xo,te),oi(()=>{s("change",te)})},B=It({get(){return g.modelValue},set(te){$(te)}});return ll("CheckboxGroup",{name:"ElCheckboxGroup",...TT(g),modelValue:B,checkboxGroupSize:D,changeEvent:$}),jn(()=>g.modelValue,()=>{var te;g.validateEvent&&((te=m.validate)==null||te.call(m,"change").catch(re=>void 0))}),(te,re)=>(pt(),nr(rp(te.tag),{id:_e(R),class:Nt(_e(x).b("group")),role:"group","aria-label":_e(A)?void 0:te.label||"checkbox-group","aria-labelledby":_e(A)?_e(m).labelId:void 0},{default:Zn(()=>[br(te.$slots,"default")]),_:3},8,["id","class","aria-label","aria-labelledby"]))}});var cL=$i(BB,[["__file","/home/runner/work/element-plus/element-plus/packages/components/checkbox/src/checkbox-group.vue"]]);const jB=cp(PB,{CheckboxButton:sL,CheckboxGroup:cL});bb(sL);bb(cL);const uL=Ro({closable:Boolean,type:{type:String,values:["success","info","warning","danger",""],default:""},hit:Boolean,disableTransitions:Boolean,color:{type:String,default:""},size:{type:String,values:$w,default:""},effect:{type:String,values:["dark","light","plain"],default:"light"},round:Boolean}),qB={close:i=>i instanceof MouseEvent,click:i=>i instanceof MouseEvent},HB={name:"ElTag"},$B=Ar({...HB,props:uL,emits:qB,setup(i,{emit:s}){const g=i,m=WS(),R=Hi("tag"),A=It(()=>{const{type:$,hit:B,effect:te,closable:re,round:ie}=g;return[R.b(),R.is("closable",re),R.m($),R.m(m.value),R.m(te),R.is("hit",B),R.is("round",ie)]}),D=$=>{s("close",$)},x=$=>{s("click",$)};return($,B)=>$.disableTransitions?(pt(),qt("span",{key:0,class:Nt(_e(A)),style:Va({backgroundColor:$.color}),onClick:x},[Kt("span",{class:Nt(_e(R).e("content"))},[br($.$slots,"default")],2),$.closable?(pt(),nr(_e(np),{key:0,class:Nt(_e(R).e("close")),onClick:tu(D,["stop"])},{default:Zn(()=>[jr(_e(mT))]),_:1},8,["class","onClick"])):wn("v-if",!0)],6)):(pt(),nr(IT,{key:1,name:`${_e(R).namespace.value}-zoom-in-center`,appear:""},{default:Zn(()=>[Kt("span",{class:Nt(_e(A)),style:Va({backgroundColor:$.color}),onClick:x},[Kt("span",{class:Nt(_e(R).e("content"))},[br($.$slots,"default")],2),$.closable?(pt(),nr(_e(np),{key:0,class:Nt(_e(R).e("close")),onClick:tu(D,["stop"])},{default:Zn(()=>[jr(_e(mT))]),_:1},8,["class","onClick"])):wn("v-if",!0)],6)]),_:3},8,["name"]))}});var KB=$i($B,[["__file","/home/runner/work/element-plus/element-plus/packages/components/tag/src/tag.vue"]]);const WB=cp(KB),zB=Ro({mask:{type:Boolean,default:!0},customMaskEvent:{type:Boolean,default:!1},overlayClass:{type:Ri([String,Array,Object])},zIndex:{type:Ri([String,Number])}}),YB={click:i=>i instanceof MouseEvent};var JB=Ar({name:"ElOverlay",props:zB,emits:YB,setup(i,{slots:s,emit:g}){const m=Hi("overlay"),R=$=>{g("click",$)},{onClick:A,onMousedown:D,onMouseup:x}=F3(i.customMaskEvent?void 0:R);return()=>i.mask?jr("div",{class:[m.b(),i.overlayClass],style:{zIndex:i.zIndex},onClick:A,onMousedown:D,onMouseup:x},[br(s,"default")],QC.STYLE|QC.CLASS|QC.PROPS,["onClick","onMouseup","onMousedown"]):n2("div",{class:i.overlayClass,style:{zIndex:i.zIndex,position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}},[br(s,"default")])}});const XB=JB,QB=Ro({center:{type:Boolean,default:!1},closeIcon:{type:Lw,default:""},customClass:{type:String,default:""},draggable:{type:Boolean,default:!1},fullscreen:{type:Boolean,default:!1},showClose:{type:Boolean,default:!0},title:{type:String,default:""}}),q8={close:()=>!0},ZB=Ro({...QB,appendToBody:{type:Boolean,default:!1},beforeClose:{type:Ri(Function)},destroyOnClose:{type:Boolean,default:!1},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},modal:{type:Boolean,default:!0},openDelay:{type:Number,default:0},closeDelay:{type:Number,default:0},top:{type:String},modelValue:{type:Boolean,default:!1},modalClass:String,width:{type:[String,Number]},zIndex:{type:Number},trapFocus:{type:Boolean,default:!1}}),e5={open:()=>!0,opened:()=>!0,close:()=>!0,closed:()=>!0,[Xo]:i=>$S(i),openAutoFocus:()=>!0,closeAutoFocus:()=>!0},t5=(i,s)=>{const m=cu().emit,{nextZIndex:R}=GN();let A="";const D=pb(),x=pb(),$=Ft(!1),B=Ft(!1),te=Ft(!1),re=Ft(i.zIndex||R());let ie,W;const Y=t0("namespace",LN),se=It(()=>{const vt={},ft=`--${Y.value}-dialog`;return i.fullscreen||(i.top&&(vt[`${ft}-margin-top`]=i.top),i.width&&(vt[`${ft}-width`]=gT(i.width))),vt});function Ae(){m("opened")}function Je(){m("closed"),m(Xo,!1),i.destroyOnClose&&(te.value=!1)}function Xe(){m("close")}function Ue(){W==null||W(),ie==null||ie(),i.openDelay&&i.openDelay>0?{stop:ie}=dO(()=>Se(),i.openDelay):Se()}function Be(){ie==null||ie(),W==null||W(),i.closeDelay&&i.closeDelay>0?{stop:W}=dO(()=>Ee(),i.closeDelay):Ee()}function Pe(){function vt(ft){ft||(B.value=!0,$.value=!1)}i.beforeClose?i.beforeClose(vt):Be()}function de(){i.closeOnClickModal&&Pe()}function Se(){!Mo||($.value=!0)}function Ee(){$.value=!1}function ke(){m("openAutoFocus")}function De(){m("closeAutoFocus")}i.lockScroll&&P3($);function Qe(){i.closeOnPressEscape&&Pe()}return jn(()=>i.modelValue,vt=>{vt?(B.value=!1,Ue(),te.value=!0,m("open"),re.value=i.zIndex?re.value++:R(),oi(()=>{s.value&&(s.value.scrollTop=0)})):$.value&&Be()}),jn(()=>i.fullscreen,vt=>{!s.value||(vt?(A=s.value.style.transform,s.value.style.transform=""):s.value.style.transform=A)}),Ba(()=>{i.modelValue&&($.value=!0,te.value=!0,Ue())}),{afterEnter:Ae,afterLeave:Je,beforeLeave:Xe,handleClose:Pe,onModalClick:de,close:Be,doClose:Ee,onOpenAutoFocus:ke,onCloseAutoFocus:De,onCloseRequested:Qe,titleId:D,bodyId:x,closed:B,style:se,rendered:te,visible:$,zIndex:re}},n5=Ro({...ZB,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0}}),r5=e5,i5=Ar({name:"ElDrawer",components:{ElOverlay:XB,ElFocusTrap:tL,ElIcon:np,Close:mT},props:n5,emits:r5,setup(i,{slots:s}){R3({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},It(()=>!!s.title));const g=Ft(),m=Ft(),R=Hi("drawer"),{t:A}=Ab(),D=It(()=>i.direction==="rtl"||i.direction==="ltr"),x=It(()=>gT(i.size));return{...t5(i,g),drawerRef:g,focusStartRef:m,isHorizontal:D,drawerSize:x,ns:R,t:A}}}),o5=["aria-label","aria-labelledby","aria-describedby"],a5=["id"],s5=["aria-label"],c5=["id"];function u5(i,s,g,m,R,A){const D=Jo("close"),x=Jo("el-icon"),$=Jo("el-focus-trap"),B=Jo("el-overlay");return pt(),nr(tN,{to:"body",disabled:!i.appendToBody},[jr(IT,{name:i.ns.b("fade"),onAfterEnter:i.afterEnter,onAfterLeave:i.afterLeave,onBeforeLeave:i.beforeLeave,persisted:""},{default:Zn(()=>[Rs(jr(B,{mask:i.modal,"overlay-class":i.modalClass,"z-index":i.zIndex,onClick:i.onModalClick},{default:Zn(()=>[jr($,{loop:"",trapped:i.visible,"focus-trap-el":i.drawerRef,"focus-start-el":i.focusStartRef,onReleaseRequested:i.onCloseRequested},{default:Zn(()=>[Kt("div",{ref:"drawerRef","aria-modal":"true","aria-label":i.title||void 0,"aria-labelledby":i.title?void 0:i.titleId,"aria-describedby":i.bodyId,class:Nt([i.ns.b(),i.direction,i.visible&&"open",i.customClass]),style:Va(i.isHorizontal?"width: "+i.drawerSize:"height: "+i.drawerSize),role:"dialog",onClick:s[1]||(s[1]=tu(()=>{},["stop"]))},[Kt("span",{ref:"focusStartRef",class:Nt(i.ns.e("sr-focus")),tabindex:"-1"},null,2),i.withHeader?(pt(),qt("header",{key:0,class:Nt(i.ns.e("header"))},[i.$slots.title?br(i.$slots,"title",{key:1},()=>[wn(" DEPRECATED SLOT ")]):br(i.$slots,"header",{key:0,close:i.handleClose,titleId:i.titleId,titleClass:i.ns.e("title")},()=>[i.$slots.title?wn("v-if",!0):(pt(),qt("span",{key:0,id:i.titleId,role:"heading",class:Nt(i.ns.e("title"))},lo(i.title),11,a5))]),i.showClose?(pt(),qt("button",{key:2,"aria-label":i.t("el.drawer.close"),class:Nt(i.ns.e("close-btn")),type:"button",onClick:s[0]||(s[0]=(...te)=>i.handleClose&&i.handleClose(...te))},[jr(x,{class:Nt(i.ns.e("close"))},{default:Zn(()=>[jr(D)]),_:1},8,["class"])],10,s5)):wn("v-if",!0)],2)):wn("v-if",!0),i.rendered?(pt(),qt("div",{key:1,id:i.bodyId,class:Nt(i.ns.e("body"))},[br(i.$slots,"default")],10,c5)):wn("v-if",!0),i.$slots.footer?(pt(),qt("div",{key:2,class:Nt(i.ns.e("footer"))},[br(i.$slots,"footer")],2)):wn("v-if",!0)],14,o5)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[Hv,i.visible]])]),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"])}var l5=$i(i5,[["render",u5],["__file","/home/runner/work/element-plus/element-plus/packages/components/drawer/src/drawer.vue"]]);const H8=cp(l5),lL="ElSelectGroup",wb="ElSelect";function d5(i,s){const g=Ci(wb),m=Ci(lL,{disabled:!1}),R=It(()=>Object.prototype.toString.call(i.value).toLowerCase()==="[object object]"),A=It(()=>g.props.multiple?re(g.props.modelValue,i.value):ie(i.value,g.props.modelValue)),D=It(()=>{if(g.props.multiple){const se=g.props.modelValue||[];return!A.value&&se.length>=g.props.multipleLimit&&g.props.multipleLimit>0}else return!1}),x=It(()=>i.label||(R.value?"":i.value)),$=It(()=>i.value||i.label||""),B=It(()=>i.disabled||s.groupDisabled||D.value),te=cu(),re=(se=[],Ae)=>{if(R.value){const Je=g.props.valueKey;return se&&se.some(Xe=>nu(Xe,Je)===nu(Ae,Je))}else return se&&se.includes(Ae)},ie=(se,Ae)=>{if(R.value){const{valueKey:Je}=g.props;return nu(se,Je)===nu(Ae,Je)}else return se===Ae},W=()=>{!i.disabled&&!m.disabled&&(g.hoverIndex=g.optionsArray.indexOf(te.proxy))};jn(()=>x.value,()=>{!i.created&&!g.props.remote&&g.setSelected()}),jn(()=>i.value,(se,Ae)=>{const{remote:Je,valueKey:Xe}=g.props;if(!i.created&&!Je){if(Xe&&typeof se=="object"&&typeof Ae=="object"&&se[Xe]===Ae[Xe])return;g.setSelected()}}),jn(()=>m.disabled,()=>{s.groupDisabled=m.disabled},{immediate:!0});const{queryChange:Y}=rN(g);return jn(Y,se=>{const{query:Ae}=_e(se),Je=new RegExp(QF(Ae),"i");s.visible=Je.test(x.value)||i.created,s.visible||g.filteredOptionsCount--}),{select:g,currentLabel:x,currentValue:$,itemSelected:A,isDisabled:B,hoverItem:W}}const h5=Ar({name:"ElOption",componentName:"ElOption",props:{value:{required:!0,type:[String,Number,Boolean,Object]},label:[String,Number],created:Boolean,disabled:{type:Boolean,default:!1}},setup(i){const s=Hi("select"),g=ET({index:-1,groupDisabled:!1,visible:!0,hitState:!1,hover:!1}),{currentLabel:m,itemSelected:R,isDisabled:A,select:D,hoverItem:x}=d5(i,g),{visible:$,hover:B}=TT(g),te=cu().proxy,re=te.value;D.onOptionCreate(te),op(()=>{const{selected:W}=D,se=(D.props.multiple?W:[W]).some(Ae=>Ae.value===te.value);oi(()=>{D.cachedOptions.get(re)===te&&!se&&D.cachedOptions.delete(re)}),D.onOptionDestroy(re,te)});function ie(){i.disabled!==!0&&g.groupDisabled!==!0&&D.handleOptionSelect(te,!0)}return{ns:s,currentLabel:m,itemSelected:R,isDisabled:A,select:D,hoverItem:x,visible:$,hover:B,selectOptionClick:ie,states:g}}});function p5(i,s,g,m,R,A){return Rs((pt(),qt("li",{class:Nt([i.ns.be("dropdown","item"),i.ns.is("disabled",i.isDisabled),{selected:i.itemSelected,hover:i.hover}]),onMouseenter:s[0]||(s[0]=(...D)=>i.hoverItem&&i.hoverItem(...D)),onClick:s[1]||(s[1]=tu((...D)=>i.selectOptionClick&&i.selectOptionClick(...D),["stop"]))},[br(i.$slots,"default",{},()=>[Kt("span",null,lo(i.currentLabel),1)])],34)),[[Hv,i.visible]])}var a1=$i(h5,[["render",p5],["__file","/home/runner/work/element-plus/element-plus/packages/components/select/src/option.vue"]]);const f5=Ar({name:"ElSelectDropdown",componentName:"ElSelectDropdown",setup(){const i=Ci(wb),s=Hi("select"),g=It(()=>i.props.popperClass),m=It(()=>i.props.multiple),R=It(()=>i.props.fitInputWidth),A=Ft("");function D(){var x;A.value=`${(x=i.selectWrapper)==null?void 0:x.offsetWidth}px`}return Ba(()=>{D(),Rb(i.selectWrapper,D)}),{ns:s,minWidth:A,popperClass:g,isMultiple:m,isFitInputWidth:R}}});function g5(i,s,g,m,R,A){return pt(),qt("div",{class:Nt([i.ns.b("dropdown"),i.ns.is("multiple",i.isMultiple),i.popperClass]),style:Va({[i.isFitInputWidth?"width":"minWidth"]:i.minWidth})},[br(i.$slots,"default")],6)}var m5=$i(f5,[["render",g5],["__file","/home/runner/work/element-plus/element-plus/packages/components/select/src/select-dropdown.vue"]]);function v5(i){const{t:s}=Ab();return ET({options:new Map,cachedOptions:new Map,createdLabel:null,createdSelected:!1,selected:i.multiple?[]:{},inputLength:20,inputWidth:0,optionsCount:0,filteredOptionsCount:0,visible:!1,softFocus:!1,selectedLabel:"",hoverIndex:-1,query:"",previousQuery:null,inputHovering:!1,cachedPlaceHolder:"",currentPlaceholder:s("el.select.placeholder"),menuVisibleOnFocus:!1,isOnComposition:!1,isSilentBlur:!1,prefixWidth:11,tagInMultiLine:!1})}const _5=(i,s,g)=>{const{t:m}=Ab(),R=Hi("select"),A=Ft(null),D=Ft(null),x=Ft(null),$=Ft(null),B=Ft(null),te=Ft(null),re=Ft(-1),ie=oT({query:""}),W=oT(""),Y=Ci(MT,{}),se=Ci(KS,{}),Ae=It(()=>!i.filterable||i.multiple||!s.visible),Je=It(()=>i.disabled||Y.disabled),Xe=It(()=>{const Ge=i.multiple?Array.isArray(i.modelValue)&&i.modelValue.length>0:i.modelValue!==void 0&&i.modelValue!==null&&i.modelValue!=="";return i.clearable&&!Je.value&&s.inputHovering&&Ge}),Ue=It(()=>i.remote&&i.filterable?"":i.suffixIcon),Be=It(()=>R.is("reverse",Ue.value&&s.visible)),Pe=It(()=>i.remote?300:0),de=It(()=>i.loading?i.loadingText||m("el.select.loading"):i.remote&&s.query===""&&s.options.size===0?!1:i.filterable&&s.query&&s.options.size>0&&s.filteredOptionsCount===0?i.noMatchText||m("el.select.noMatch"):s.options.size===0?i.noDataText||m("el.select.noData"):null),Se=It(()=>Array.from(s.options.values())),Ee=It(()=>Array.from(s.cachedOptions.values())),ke=It(()=>{const Ge=Se.value.filter(ct=>!ct.created).some(ct=>ct.currentLabel===s.query);return i.filterable&&i.allowCreate&&s.query!==""&&!Ge}),De=WS(),Qe=It(()=>["small"].includes(De.value)?"small":"default"),vt=It({get(){return s.visible&&de.value!==!1},set(Ge){s.visible=Ge}});jn([()=>Je.value,()=>De.value,()=>Y.size],()=>{oi(()=>{ft()})}),jn(()=>i.placeholder,Ge=>{s.cachedPlaceHolder=s.currentPlaceholder=Ge}),jn(()=>i.modelValue,(Ge,ct)=>{var Mn;i.multiple&&(ft(),Ge&&Ge.length>0||D.value&&s.query!==""?s.currentPlaceholder="":s.currentPlaceholder=s.cachedPlaceHolder,i.filterable&&!i.reserveKeyword&&(s.query="",it(s.query))),xe(),i.filterable&&!i.multiple&&(s.inputLength=20),!uO(Ge,ct)&&i.validateEvent&&((Mn=se.validate)==null||Mn.call(se,"change").catch(Vn=>void 0))},{flush:"post",deep:!0}),jn(()=>s.visible,Ge=>{var ct,Mn,Vn;Ge?((Mn=(ct=x.value)==null?void 0:ct.updatePopper)==null||Mn.call(ct),i.filterable&&(s.filteredOptionsCount=s.optionsCount,s.query=i.remote?"":s.selectedLabel,i.multiple?(Vn=D.value)==null||Vn.focus():s.selectedLabel&&(s.currentPlaceholder=`${s.selectedLabel}`,s.selectedLabel=""),it(s.query),!i.multiple&&!i.remote&&(ie.value.query="",eT(ie),eT(W)))):(D.value&&D.value.blur(),s.query="",s.previousQuery=null,s.selectedLabel="",s.inputLength=20,s.menuVisibleOnFocus=!1,Fn(),oi(()=>{D.value&&D.value.value===""&&s.selected.length===0&&(s.currentPlaceholder=s.cachedPlaceHolder)}),i.multiple||(s.selected&&(i.filterable&&i.allowCreate&&s.createdSelected&&s.createdLabel?s.selectedLabel=s.createdLabel:s.selectedLabel=s.selected.currentLabel,i.filterable&&(s.query=s.selectedLabel)),i.filterable&&(s.currentPlaceholder=s.cachedPlaceHolder))),g.emit("visible-change",Ge)}),jn(()=>s.options.entries(),()=>{var Ge,ct,Mn;if(!Mo)return;(ct=(Ge=x.value)==null?void 0:Ge.updatePopper)==null||ct.call(Ge),i.multiple&&ft();const Vn=((Mn=B.value)==null?void 0:Mn.querySelectorAll("input"))||[];Array.from(Vn).includes(document.activeElement)||xe(),i.defaultFirstOption&&(i.filterable||i.remote)&&s.filteredOptionsCount&&ee()},{flush:"post"}),jn(()=>s.hoverIndex,Ge=>{typeof Ge=="number"&&Ge>-1&&(re.value=Se.value[Ge]||{}),Se.value.forEach(ct=>{ct.hover=re.value===ct})});const ft=()=>{i.collapseTags&&!i.filterable||oi(()=>{var Ge,ct;if(!A.value)return;const Mn=A.value.$el.querySelector("input"),Vn=$.value,rr=m3(De.value||Y.size);Mn.style.height=`${(s.selected.length===0?rr:Math.max(Vn?Vn.clientHeight+(Vn.clientHeight>rr?6:0):0,rr))-2}px`,s.tagInMultiLine=Number.parseFloat(Mn.style.height)>=rr,s.visible&&de.value!==!1&&((ct=(Ge=x.value)==null?void 0:Ge.updatePopper)==null||ct.call(Ge))})},it=Ge=>{if(!(s.previousQuery===Ge||s.isOnComposition)){if(s.previousQuery===null&&(typeof i.filterMethod=="function"||typeof i.remoteMethod=="function")){s.previousQuery=Ge;return}s.previousQuery=Ge,oi(()=>{var ct,Mn;s.visible&&((Mn=(ct=x.value)==null?void 0:ct.updatePopper)==null||Mn.call(ct))}),s.hoverIndex=-1,i.multiple&&i.filterable&&oi(()=>{const ct=D.value.value.length*15+20;s.inputLength=i.collapseTags?Math.min(50,ct):ct,ut(),ft()}),i.remote&&typeof i.remoteMethod=="function"?(s.hoverIndex=-1,i.remoteMethod(Ge)):typeof i.filterMethod=="function"?(i.filterMethod(Ge),eT(W)):(s.filteredOptionsCount=s.optionsCount,ie.value.query=Ge,eT(ie),eT(W)),i.defaultFirstOption&&(i.filterable||i.remote)&&s.filteredOptionsCount&&ee()}},ut=()=>{s.currentPlaceholder!==""&&(s.currentPlaceholder=D.value.value?"":s.cachedPlaceHolder)},ee=()=>{const Ge=Se.value.filter(Vn=>Vn.visible&&!Vn.disabled&&!Vn.states.groupDisabled),ct=Ge.find(Vn=>Vn.created),Mn=Ge[0];s.hoverIndex=ve(Se.value,ct||Mn)},xe=()=>{var Ge;if(i.multiple)s.selectedLabel="";else{const Mn=Et(i.modelValue);(Ge=Mn.props)!=null&&Ge.created?(s.createdLabel=Mn.props.value,s.createdSelected=!0):s.createdSelected=!1,s.selectedLabel=Mn.currentLabel,s.selected=Mn,i.filterable&&(s.query=s.selectedLabel);return}const ct=[];Array.isArray(i.modelValue)&&i.modelValue.forEach(Mn=>{ct.push(Et(Mn))}),s.selected=ct,oi(()=>{ft()})},Et=Ge=>{let ct;const Mn=fw(Ge).toLowerCase()==="object",Vn=fw(Ge).toLowerCase()==="null",rr=fw(Ge).toLowerCase()==="undefined";for(let Zo=s.cachedOptions.size-1;Zo>=0;Zo--){const er=Ee.value[Zo];if(Mn?nu(er.value,i.valueKey)===nu(Ge,i.valueKey):er.value===Ge){ct={value:Ge,currentLabel:er.currentLabel,isDisabled:er.isDisabled};break}}if(ct)return ct;const No=Mn?Ge.label:!Vn&&!rr?Ge:"",ci={value:Ge,currentLabel:No};return i.multiple&&(ci.hitState=!1),ci},Fn=()=>{setTimeout(()=>{const Ge=i.valueKey;i.multiple?s.selected.length>0?s.hoverIndex=Math.min.apply(null,s.selected.map(ct=>Se.value.findIndex(Mn=>nu(Mn,Ge)===nu(ct,Ge)))):s.hoverIndex=-1:s.hoverIndex=Se.value.findIndex(ct=>Lr(ct)===Lr(s.selected))},300)},Fr=()=>{var Ge,ct;dt(),(ct=(Ge=x.value)==null?void 0:Ge.updatePopper)==null||ct.call(Ge),i.multiple&&!i.filterable&&ft()},dt=()=>{var Ge;s.inputWidth=(Ge=A.value)==null?void 0:Ge.$el.getBoundingClientRect().width},ai=()=>{i.filterable&&s.query!==s.selectedLabel&&(s.query=s.selectedLabel,it(s.query))},bi=cO(()=>{ai()},Pe.value),dr=cO(Ge=>{it(Ge.target.value)},Pe.value),Gn=Ge=>{uO(i.modelValue,Ge)||g.emit(AN,Ge)},Ai=Ge=>{if(Ge.target.value.length<=0&&!qr()){const ct=i.modelValue.slice();ct.pop(),g.emit(Xo,ct),Gn(ct)}Ge.target.value.length===1&&i.modelValue.length===0&&(s.currentPlaceholder=s.cachedPlaceHolder)},si=(Ge,ct)=>{const Mn=s.selected.indexOf(ct);if(Mn>-1&&!Je.value){const Vn=i.modelValue.slice();Vn.splice(Mn,1),g.emit(Xo,Vn),Gn(Vn),g.emit("remove-tag",ct.value)}Ge.stopPropagation()},Nr=Ge=>{Ge.stopPropagation();const ct=i.multiple?[]:"";if(typeof ct!="string")for(const Mn of s.selected)Mn.isDisabled&&ct.push(Mn.value);g.emit(Xo,ct),Gn(ct),s.visible=!1,g.emit("clear")},_i=(Ge,ct)=>{var Mn;if(i.multiple){const Vn=(i.modelValue||[]).slice(),rr=ve(Vn,Ge.value);rr>-1?Vn.splice(rr,1):(i.multipleLimit<=0||Vn.length<i.multipleLimit)&&Vn.push(Ge.value),g.emit(Xo,Vn),Gn(Vn),Ge.created&&(s.query="",it(""),s.inputLength=20),i.filterable&&((Mn=D.value)==null||Mn.focus())}else g.emit(Xo,Ge.value),Gn(Ge.value),s.visible=!1;s.isSilentBlur=ct,qn(),!s.visible&&oi(()=>{ho(Ge)})},ve=(Ge=[],ct)=>{if(!dg(ct))return Ge.indexOf(ct);const Mn=i.valueKey;let Vn=-1;return Ge.some((rr,No)=>nu(rr,Mn)===nu(ct,Mn)?(Vn=No,!0):!1),Vn},qn=()=>{s.softFocus=!0;const Ge=D.value||A.value;Ge&&(Ge==null||Ge.focus())},ho=Ge=>{var ct,Mn,Vn,rr,No;const ci=Array.isArray(Ge)?Ge[0]:Ge;let Zo=null;if(ci!=null&&ci.value){const er=Se.value.filter(Ir=>Ir.value===ci.value);er.length>0&&(Zo=er[0].$el)}if(x.value&&Zo){const er=(rr=(Vn=(Mn=(ct=x.value)==null?void 0:ct.popperRef)==null?void 0:Mn.contentRef)==null?void 0:Vn.querySelector)==null?void 0:rr.call(Vn,`.${R.be("dropdown","wrap")}`);er&&rV(er,Zo)}(No=te.value)==null||No.handleScroll()},hr=Ge=>{s.optionsCount++,s.filteredOptionsCount++,s.options.set(Ge.value,Ge),s.cachedOptions.set(Ge.value,Ge)},Ki=(Ge,ct)=>{s.options.get(Ge)===ct&&(s.optionsCount--,s.filteredOptionsCount--,s.options.delete(Ge))},Co=Ge=>{Ge.code!==vT.backspace&&qr(!1),s.inputLength=D.value.value.length*15+20,ft()},qr=Ge=>{if(!Array.isArray(s.selected))return;const ct=s.selected[s.selected.length-1];if(!!ct)return Ge===!0||Ge===!1?(ct.hitState=Ge,Ge):(ct.hitState=!ct.hitState,ct.hitState)},Oo=Ge=>{const ct=Ge.target.value;if(Ge.type==="compositionend")s.isOnComposition=!1,oi(()=>it(ct));else{const Mn=ct[ct.length-1]||"";s.isOnComposition=!kN(Mn)}},an=()=>{oi(()=>ho(s.selected))},ur=Ge=>{s.softFocus?s.softFocus=!1:((i.automaticDropdown||i.filterable)&&(i.filterable&&!s.visible&&(s.menuVisibleOnFocus=!0),s.visible=!0),g.emit("focus",Ge))},bt=()=>{var Ge;s.visible=!1,(Ge=A.value)==null||Ge.blur()},xt=Ge=>{oi(()=>{s.isSilentBlur?s.isSilentBlur=!1:g.emit("blur",Ge)}),s.softFocus=!1},Qo=Ge=>{Nr(Ge)},_r=()=>{s.visible=!1},nt=Ge=>{s.visible&&(Ge.preventDefault(),Ge.stopPropagation(),s.visible=!1)},nn=()=>{var Ge;Je.value||(s.menuVisibleOnFocus?s.menuVisibleOnFocus=!1:s.visible=!s.visible,s.visible&&((Ge=D.value||A.value)==null||Ge.focus()))},yi=()=>{s.visible?Se.value[s.hoverIndex]&&_i(Se.value[s.hoverIndex],void 0):nn()},Lr=Ge=>dg(Ge.value)?nu(Ge.value,i.valueKey):Ge.value,pr=It(()=>Se.value.filter(Ge=>Ge.visible).every(Ge=>Ge.disabled)),ma=Ge=>{if(!s.visible){s.visible=!0;return}if(!(s.options.size===0||s.filteredOptionsCount===0)&&!s.isOnComposition&&!pr.value){Ge==="next"?(s.hoverIndex++,s.hoverIndex===s.options.size&&(s.hoverIndex=0)):Ge==="prev"&&(s.hoverIndex--,s.hoverIndex<0&&(s.hoverIndex=s.options.size-1));const ct=Se.value[s.hoverIndex];(ct.disabled===!0||ct.states.groupDisabled===!0||!ct.visible)&&ma(Ge),oi(()=>ho(re.value))}};return{optionsArray:Se,selectSize:De,handleResize:Fr,debouncedOnInputChange:bi,debouncedQueryChange:dr,deletePrevTag:Ai,deleteTag:si,deleteSelected:Nr,handleOptionSelect:_i,scrollToOption:ho,readonly:Ae,resetInputHeight:ft,showClose:Xe,iconComponent:Ue,iconReverse:Be,showNewOption:ke,collapseTagSize:Qe,setSelected:xe,managePlaceholder:ut,selectDisabled:Je,emptyText:de,toggleLastOptionHitState:qr,resetInputState:Co,handleComposition:Oo,onOptionCreate:hr,onOptionDestroy:Ki,handleMenuEnter:an,handleFocus:ur,blur:bt,handleBlur:xt,handleClearClick:Qo,handleClose:_r,handleKeydownEscape:nt,toggleMenu:nn,selectOption:yi,getValueKey:Lr,navigateOptions:ma,dropMenuVisible:vt,queryChange:ie,groupQueryChange:W,reference:A,input:D,tooltipRef:x,tags:$,selectWrapper:B,scrollbar:te}},BO="ElSelect",y5=Ar({name:BO,componentName:BO,components:{ElInput:l4,ElSelectMenu:m5,ElOption:a1,ElTag:WB,ElScrollbar:T4,ElTooltip:yB,ElIcon:np},directives:{ClickOutside:IB},props:{name:String,id:String,modelValue:{type:[Array,String,Number,Boolean,Object],default:void 0},autocomplete:{type:String,default:"off"},automaticDropdown:Boolean,size:{type:String,validator:v3},effect:{type:String,default:"light"},disabled:Boolean,clearable:Boolean,filterable:Boolean,allowCreate:Boolean,loading:Boolean,popperClass:{type:String,default:""},remote:Boolean,loadingText:String,noMatchText:String,noDataText:String,remoteMethod:Function,filterMethod:Function,multiple:Boolean,multipleLimit:{type:Number,default:0},placeholder:{type:String},defaultFirstOption:Boolean,reserveKeyword:{type:Boolean,default:!0},valueKey:{type:String,default:"value"},collapseTags:Boolean,collapseTagsTooltip:{type:Boolean,default:!1},teleported:i1.teleported,persistent:{type:Boolean,default:!0},clearIcon:{type:[String,Object],default:Hw},fitInputWidth:{type:Boolean,default:!1},suffixIcon:{type:[String,Object],default:uV},tagType:{...uL.type,default:"info"},validateEvent:{type:Boolean,default:!0}},emits:[Xo,AN,"remove-tag","clear","visible-change","focus","blur"],setup(i,s){const g=Hi("select"),m=Hi("input"),{t:R}=Ab(),A=v5(i),{optionsArray:D,selectSize:x,readonly:$,handleResize:B,collapseTagSize:te,debouncedOnInputChange:re,debouncedQueryChange:ie,deletePrevTag:W,deleteTag:Y,deleteSelected:se,handleOptionSelect:Ae,scrollToOption:Je,setSelected:Xe,resetInputHeight:Ue,managePlaceholder:Be,showClose:Pe,selectDisabled:de,iconComponent:Se,iconReverse:Ee,showNewOption:ke,emptyText:De,toggleLastOptionHitState:Qe,resetInputState:vt,handleComposition:ft,onOptionCreate:it,onOptionDestroy:ut,handleMenuEnter:ee,handleFocus:xe,blur:Et,handleBlur:Fn,handleClearClick:Fr,handleClose:dt,handleKeydownEscape:ai,toggleMenu:bi,selectOption:dr,getValueKey:Gn,navigateOptions:Ai,dropMenuVisible:si,reference:Nr,input:_i,tooltipRef:ve,tags:qn,selectWrapper:ho,scrollbar:hr,queryChange:Ki,groupQueryChange:Co}=_5(i,A,s),{focus:qr}=C3(Nr),{inputWidth:Oo,selected:an,inputLength:ur,filteredOptionsCount:bt,visible:xt,softFocus:Qo,selectedLabel:_r,hoverIndex:nt,query:nn,inputHovering:yi,currentPlaceholder:Lr,menuVisibleOnFocus:pr,isOnComposition:ma,isSilentBlur:Ge,options:ct,cachedOptions:Mn,optionsCount:Vn,prefixWidth:rr,tagInMultiLine:No}=TT(A),ci=It(()=>{const Ir=[g.b()],va=_e(x);return va&&Ir.push(g.m(va)),i.disabled&&Ir.push(g.m("disabled")),Ir}),Zo=It(()=>({maxWidth:`${_e(Oo)-32}px`,width:"100%"}));ll(wb,ET({props:i,options:ct,optionsArray:D,cachedOptions:Mn,optionsCount:Vn,filteredOptionsCount:bt,hoverIndex:nt,handleOptionSelect:Ae,onOptionCreate:it,onOptionDestroy:ut,selectWrapper:ho,selected:an,setSelected:Xe,queryChange:Ki,groupQueryChange:Co})),Ba(()=>{A.cachedPlaceHolder=Lr.value=i.placeholder||R("el.select.placeholder"),i.multiple&&Array.isArray(i.modelValue)&&i.modelValue.length>0&&(Lr.value=""),Rb(ho,B),i.remote&&i.multiple&&Ue(),oi(()=>{const Ir=Nr.value&&Nr.value.$el;if(!!Ir&&(Oo.value=Ir.getBoundingClientRect().width,s.slots.prefix)){const va=Ir.querySelector(`.${m.e("prefix")}`);rr.value=Math.max(va.getBoundingClientRect().width+5,30)}}),Xe()}),i.multiple&&!Array.isArray(i.modelValue)&&s.emit(Xo,[]),!i.multiple&&Array.isArray(i.modelValue)&&s.emit(Xo,"");const er=It(()=>{var Ir,va;return(va=(Ir=ve.value)==null?void 0:Ir.popperRef)==null?void 0:va.contentRef});return{tagInMultiLine:No,prefixWidth:rr,selectSize:x,readonly:$,handleResize:B,collapseTagSize:te,debouncedOnInputChange:re,debouncedQueryChange:ie,deletePrevTag:W,deleteTag:Y,deleteSelected:se,handleOptionSelect:Ae,scrollToOption:Je,inputWidth:Oo,selected:an,inputLength:ur,filteredOptionsCount:bt,visible:xt,softFocus:Qo,selectedLabel:_r,hoverIndex:nt,query:nn,inputHovering:yi,currentPlaceholder:Lr,menuVisibleOnFocus:pr,isOnComposition:ma,isSilentBlur:Ge,options:ct,resetInputHeight:Ue,managePlaceholder:Be,showClose:Pe,selectDisabled:de,iconComponent:Se,iconReverse:Ee,showNewOption:ke,emptyText:De,toggleLastOptionHitState:Qe,resetInputState:vt,handleComposition:ft,handleMenuEnter:ee,handleFocus:xe,blur:Et,handleBlur:Fn,handleClearClick:Fr,handleClose:dt,handleKeydownEscape:ai,toggleMenu:bi,selectOption:dr,getValueKey:Gn,navigateOptions:Ai,dropMenuVisible:si,focus:qr,reference:Nr,input:_i,tooltipRef:ve,popperPaneRef:er,tags:qn,selectWrapper:ho,scrollbar:hr,wrapperKls:ci,selectTagsStyle:Zo,nsSelect:g}}}),S5={class:"select-trigger"},I5=["disabled","autocomplete"],E5={style:{height:"100%",display:"flex","justify-content":"center","align-items":"center"}};function T5(i,s,g,m,R,A){const D=Jo("el-tag"),x=Jo("el-tooltip"),$=Jo("el-icon"),B=Jo("el-input"),te=Jo("el-option"),re=Jo("el-scrollbar"),ie=Jo("el-select-menu"),W=r2("click-outside");return Rs((pt(),qt("div",{ref:"selectWrapper",class:Nt(i.wrapperKls),onClick:s[22]||(s[22]=tu((...Y)=>i.toggleMenu&&i.toggleMenu(...Y),["stop"]))},[jr(x,{ref:"tooltipRef",visible:i.dropMenuVisible,placement:"bottom-start",teleported:i.teleported,"popper-class":[i.nsSelect.e("popper"),i.popperClass],"fallback-placements":["bottom-start","top-start","right","left"],effect:i.effect,pure:"",trigger:"click",transition:`${i.nsSelect.namespace.value}-zoom-in-top`,"stop-popper-mouse-event":!1,"gpu-acceleration":!1,persistent:i.persistent,onShow:i.handleMenuEnter},{default:Zn(()=>[Kt("div",S5,[i.multiple?(pt(),qt("div",{key:0,ref:"tags",class:Nt(i.nsSelect.e("tags")),style:Va(i.selectTagsStyle)},[i.collapseTags&&i.selected.length?(pt(),qt("span",{key:0,class:Nt([i.nsSelect.b("tags-wrapper"),{"has-prefix":i.prefixWidth&&i.selected.length}])},[jr(D,{closable:!i.selectDisabled&&!i.selected[0].isDisabled,size:i.collapseTagSize,hit:i.selected[0].hitState,type:i.tagType,"disable-transitions":"",onClose:s[0]||(s[0]=Y=>i.deleteTag(Y,i.selected[0]))},{default:Zn(()=>[Kt("span",{class:Nt(i.nsSelect.e("tags-text")),style:Va({maxWidth:i.inputWidth-123+"px"})},lo(i.selected[0].currentLabel),7)]),_:1},8,["closable","size","hit","type"]),i.selected.length>1?(pt(),nr(D,{key:0,closable:!1,size:i.collapseTagSize,type:i.tagType,"disable-transitions":""},{default:Zn(()=>[i.collapseTagsTooltip?(pt(),nr(x,{key:0,disabled:i.dropMenuVisible,"fallback-placements":["bottom","top","right","left"],effect:i.effect,placement:"bottom",teleported:i.teleported},{default:Zn(()=>[Kt("span",{class:Nt(i.nsSelect.e("tags-text"))},"+ "+lo(i.selected.length-1),3)]),content:Zn(()=>[Kt("div",{class:Nt(i.nsSelect.e("collapse-tags"))},[(pt(!0),qt(ic,null,qS(i.selected.slice(1),(Y,se)=>(pt(),qt("div",{key:se,class:Nt(i.nsSelect.e("collapse-tag"))},[(pt(),nr(D,{key:i.getValueKey(Y),class:"in-tooltip",closable:!i.selectDisabled&&!Y.isDisabled,size:i.collapseTagSize,hit:Y.hitState,type:i.tagType,"disable-transitions":"",style:{margin:"2px"},onClose:Ae=>i.deleteTag(Ae,Y)},{default:Zn(()=>[Kt("span",{class:Nt(i.nsSelect.e("tags-text")),style:Va({maxWidth:i.inputWidth-75+"px"})},lo(Y.currentLabel),7)]),_:2},1032,["closable","size","hit","type","onClose"]))],2))),128))],2)]),_:1},8,["disabled","effect","teleported"])):(pt(),qt("span",{key:1,class:Nt(i.nsSelect.e("tags-text"))},"+ "+lo(i.selected.length-1),3))]),_:1},8,["size","type"])):wn("v-if",!0)],2)):wn("v-if",!0),wn(" <div> "),i.collapseTags?wn("v-if",!0):(pt(),nr(IT,{key:1,onAfterLeave:i.resetInputHeight},{default:Zn(()=>[Kt("span",{class:Nt([i.nsSelect.b("tags-wrapper"),{"has-prefix":i.prefixWidth&&i.selected.length}])},[(pt(!0),qt(ic,null,qS(i.selected,Y=>(pt(),nr(D,{key:i.getValueKey(Y),closable:!i.selectDisabled&&!Y.isDisabled,size:i.collapseTagSize,hit:Y.hitState,type:i.tagType,"disable-transitions":"",onClose:se=>i.deleteTag(se,Y)},{default:Zn(()=>[Kt("span",{class:Nt(i.nsSelect.e("tags-text")),style:Va({maxWidth:i.inputWidth-75+"px"})},lo(Y.currentLabel),7)]),_:2},1032,["closable","size","hit","type","onClose"]))),128))],2)]),_:1},8,["onAfterLeave"])),wn(" </div> "),i.filterable?Rs((pt(),qt("input",{key:2,ref:"input","onUpdate:modelValue":s[1]||(s[1]=Y=>i.query=Y),type:"text",class:Nt([i.nsSelect.e("input"),i.nsSelect.is(i.selectSize)]),disabled:i.selectDisabled,autocomplete:i.autocomplete,style:Va({marginLeft:i.prefixWidth&&!i.selected.length||i.tagInMultiLine?`${i.prefixWidth}px`:"",flexGrow:1,width:`${i.inputLength/(i.inputWidth-32)}%`,maxWidth:`${i.inputWidth-42}px`}),onFocus:s[2]||(s[2]=(...Y)=>i.handleFocus&&i.handleFocus(...Y)),onBlur:s[3]||(s[3]=(...Y)=>i.handleBlur&&i.handleBlur(...Y)),onKeyup:s[4]||(s[4]=(...Y)=>i.managePlaceholder&&i.managePlaceholder(...Y)),onKeydown:[s[5]||(s[5]=(...Y)=>i.resetInputState&&i.resetInputState(...Y)),s[6]||(s[6]=al(tu(Y=>i.navigateOptions("next"),["prevent"]),["down"])),s[7]||(s[7]=al(tu(Y=>i.navigateOptions("prev"),["prevent"]),["up"])),s[8]||(s[8]=al((...Y)=>i.handleKeydownEscape&&i.handleKeydownEscape(...Y),["esc"])),s[9]||(s[9]=al(tu((...Y)=>i.selectOption&&i.selectOption(...Y),["stop","prevent"]),["enter"])),s[10]||(s[10]=al((...Y)=>i.deletePrevTag&&i.deletePrevTag(...Y),["delete"])),s[11]||(s[11]=al(Y=>i.visible=!1,["tab"]))],onCompositionstart:s[12]||(s[12]=(...Y)=>i.handleComposition&&i.handleComposition(...Y)),onCompositionupdate:s[13]||(s[13]=(...Y)=>i.handleComposition&&i.handleComposition(...Y)),onCompositionend:s[14]||(s[14]=(...Y)=>i.handleComposition&&i.handleComposition(...Y)),onInput:s[15]||(s[15]=(...Y)=>i.debouncedQueryChange&&i.debouncedQueryChange(...Y))},null,46,I5)),[[i2,i.query]]):wn("v-if",!0)],6)):wn("v-if",!0),jr(B,{id:i.id,ref:"reference",modelValue:i.selectedLabel,"onUpdate:modelValue":s[16]||(s[16]=Y=>i.selectedLabel=Y),type:"text",placeholder:i.currentPlaceholder,name:i.name,autocomplete:i.autocomplete,size:i.selectSize,disabled:i.selectDisabled,readonly:i.readonly,"validate-event":!1,class:Nt([i.nsSelect.is("focus",i.visible)]),tabindex:i.multiple&&i.filterable?-1:void 0,onFocus:i.handleFocus,onBlur:i.handleBlur,onInput:i.debouncedOnInputChange,onPaste:i.debouncedOnInputChange,onCompositionstart:i.handleComposition,onCompositionupdate:i.handleComposition,onCompositionend:i.handleComposition,onKeydown:[s[17]||(s[17]=al(tu(Y=>i.navigateOptions("next"),["stop","prevent"]),["down"])),s[18]||(s[18]=al(tu(Y=>i.navigateOptions("prev"),["stop","prevent"]),["up"])),al(tu(i.selectOption,["stop","prevent"]),["enter"]),al(i.handleKeydownEscape,["esc"]),s[19]||(s[19]=al(Y=>i.visible=!1,["tab"]))],onMouseenter:s[20]||(s[20]=Y=>i.inputHovering=!0),onMouseleave:s[21]||(s[21]=Y=>i.inputHovering=!1)},o2({suffix:Zn(()=>[i.iconComponent&&!i.showClose?(pt(),nr($,{key:0,class:Nt([i.nsSelect.e("caret"),i.nsSelect.e("icon"),i.iconReverse])},{default:Zn(()=>[(pt(),nr(rp(i.iconComponent)))]),_:1},8,["class"])):wn("v-if",!0),i.showClose&&i.clearIcon?(pt(),nr($,{key:1,class:Nt([i.nsSelect.e("caret"),i.nsSelect.e("icon")]),onClick:i.handleClearClick},{default:Zn(()=>[(pt(),nr(rp(i.clearIcon)))]),_:1},8,["class","onClick"])):wn("v-if",!0)]),_:2},[i.$slots.prefix?{name:"prefix",fn:Zn(()=>[Kt("div",E5,[br(i.$slots,"prefix")])])}:void 0]),1032,["id","modelValue","placeholder","name","autocomplete","size","disabled","readonly","class","tabindex","onFocus","onBlur","onInput","onPaste","onCompositionstart","onCompositionupdate","onCompositionend","onKeydown"])])]),content:Zn(()=>[jr(ie,null,{default:Zn(()=>[Rs(jr(re,{ref:"scrollbar",tag:"ul","wrap-class":i.nsSelect.be("dropdown","wrap"),"view-class":i.nsSelect.be("dropdown","list"),class:Nt([i.nsSelect.is("empty",!i.allowCreate&&Boolean(i.query)&&i.filteredOptionsCount===0)])},{default:Zn(()=>[i.showNewOption?(pt(),nr(te,{key:0,value:i.query,created:!0},null,8,["value"])):wn("v-if",!0),br(i.$slots,"default")]),_:3},8,["wrap-class","view-class","class"]),[[Hv,i.options.size>0&&!i.loading]]),i.emptyText&&(!i.allowCreate||i.loading||i.allowCreate&&i.options.size===0)?(pt(),qt(ic,{key:0},[i.$slots.empty?br(i.$slots,"empty",{key:0}):(pt(),qt("p",{key:1,class:Nt(i.nsSelect.be("dropdown","empty"))},lo(i.emptyText),3))],64)):wn("v-if",!0)]),_:3})]),_:3},8,["visible","teleported","popper-class","effect","transition","persistent","onShow"])],2)),[[W,i.handleClose,i.popperPaneRef]])}var M5=$i(y5,[["render",T5],["__file","/home/runner/work/element-plus/element-plus/packages/components/select/src/select.vue"]]);const R5=Ar({name:"ElOptionGroup",componentName:"ElOptionGroup",props:{label:String,disabled:{type:Boolean,default:!1}},setup(i){const s=Hi("select"),g=Ft(!0),m=cu(),R=Ft([]);ll(lL,ET({...TT(i)}));const A=Ci(wb);Ba(()=>{R.value=D(m.subTree)});const D=$=>{const B=[];return Array.isArray($.children)&&$.children.forEach(te=>{var re;te.type&&te.type.name==="ElOption"&&te.component&&te.component.proxy?B.push(te.component.proxy):(re=te.children)!=null&&re.length&&B.push(...D(te))}),B},{groupQueryChange:x}=rN(A);return jn(x,()=>{g.value=R.value.some($=>$.visible===!0)}),{visible:g,ns:s}}});function C5(i,s,g,m,R,A){return Rs((pt(),qt("ul",{class:Nt(i.ns.be("group","wrap"))},[Kt("li",{class:Nt(i.ns.be("group","title"))},lo(i.label),3),Kt("li",null,[Kt("ul",{class:Nt(i.ns.b("group"))},[br(i.$slots,"default")],2)])],2)),[[Hv,i.visible]])}var dL=$i(R5,[["render",C5],["__file","/home/runner/work/element-plus/element-plus/packages/components/select/src/option-group.vue"]]);const hL=cp(M5,{Option:a1,OptionGroup:dL}),pL=bb(a1);bb(dL);class Ot{constructor(s,g,m){we(this,"code",0);we(this,"message");we(this,"data");this.code=s,this.message=g,this.data=m}static success(s){return new Ot(0,"",s||null)}static fail(s,g,m){return new Ot(s,g,m||null)}}class Ht extends Error{constructor(g,m,R){super(m);we(this,"code");we(this,"message");we(this,"data");this.code=g,this.message=m,this.data=R}static error(g,m,R){return R?new Ht(g,m,R):new Ht(g,m)}}var zr=(i=>(i[i.MASTER=1]="MASTER",i[i.MANAGER=2]="MANAGER",i[i.ANCHOR=3]="ANCHOR",i[i.AUDIENCE=4]="AUDIENCE",i))(zr||{}),iu=(i=>(i.FREE_SPEECH="FreeSpeech",i.APPLY_SPEECH="ApplySpeech",i))(iu||{}),rT=(i=>(i[i.ACCEPTED=0]="ACCEPTED",i[i.REJECTED=1]="REJECTED",i[i.CANCELLED=2]="CANCELLED",i[i.TIMEOUT=3]="TIMEOUT",i))(rT||{}),ru=(i=>(i[i.CAMERA=1]="CAMERA",i[i.SCREEN=2]="SCREEN",i))(ru||{}),ze=(i=>(i.onError="onError",i.onRoomDestroyed="onRoomDestroyed",i.onRoomExited="onRoomExited",i.onRoomMasterChanged="onRoomMasterChanged",i.onUserEnterRoom="onUserEnterRoom",i.onUserLeaveRoom="onUserLeaveRoom",i.onUserVideoAvailable="onUserVideoAvailable",i.onUserAudioAvailable="onUserAudioAvailable",i.onFirstVideoFrame="onFirstVideoFrame",i.onUserVoiceVolume="onUserVoiceVolume",i.onUserStateChange="onUserStateChange",i.onDeviceChange="onDeviceChange",i.onWebScreenSharingStopped="onWebScreenSharingStopped",i.onNetworkQuality="onNetworkQuality",i.onStatistics="onStatistics",i.onReceiveChatMessage="onReceiveChatMessage",i.onReceiveCustomMessage="onReceiveCustomMessage",i.onUserEnterSpeechState="onUserEnterSpeechState",i.onUserExitSpeechState="onUserExitSpeechState",i.onReceiveSpeechInvitation="onReceiveSpeechInvitation",i.onReceiveInvitationCancelled="onReceiveInvitationCancelled",i.onReceiveInvitationTimeout="onReceiveInvitationTimeout",i.onReceiveSpeechApplication="onReceiveSpeechApplication",i.onSpeechApplicationCancelled="onSpeechApplicationCancelled",i.onSpeechApplicationTimeout="onSpeechApplicationTimeout",i.onSpeechApplicationForbidden="onSpeechApplicationForbidden",i.onOrderedToExitSpeechState="onOrderedToExitSpeechState",i.onCallingRollStarted="onCallingRollStarted",i.onCallingRollStopped="onCallingRollStopped",i.onUserReplyCallingRoll="onUserReplyCallingRoll",i.onChatRoomMuted="onChatRoomMuted",i.onMicrophoneMuted="onMicrophoneMuted",i.onCameraMuted="onCameraMuted",i.onUserChatRoomMuted="onUserChatRoomMuted",i.onUserKickOff="onUserKickOff",i.onUserAVEnabled="onUserAVEnabled",i.onUserAVDisabled="onUserAVDisabled",i.onUserKickOffStage="onUserKickOffStage",i))(ze||{}),eb=(i=>(i.isCallingRoll="isCallingRoll",i.speechMode="speechMode",i.isChatRoomMuted="isChatRoomMuted",i.isAllCameraMuted="isAllCameraMuted",i.isAllMicMuted="isAllMicMuted",i.startTime="startTime",i.isSpeechApplicationForbidden="isSpeechApplicationForbidden",i))(eb||{}),Qn=(i=>(i.MuteUserMicrophone="MuteUserMicrophone",i.MuteUserCamera="MuteUserCamera",i.MuteUserChatRoom="MuteUserChatRoom",i.ReplyCallingRoll="ReplyCallingRoll",i.KickOffUser="KickOffUser",i.TakeSeat="TakeSeat",i.PickSeat="PickSeat",i.KickSeat="KickSeat",i))(Qn||{}),rg=(i=>(i.MasterMuteAll="MasterMuteAll",i.MasterMuteCurrentUser="MasterMuteCurrentUser",i))(rg||{});class b5{constructor(){we(this,"speechMode",iu.APPLY_SPEECH);we(this,"isChatRoomMuted",!1);we(this,"isSpeechApplicationForbidden",!1);we(this,"isAllCameraMuted",!1);we(this,"isAllMicMuted",!1);we(this,"isCallingRoll",!1);we(this,"startTime",0)}reset(){this.speechMode=iu.APPLY_SPEECH,this.isChatRoomMuted=!1,this.isSpeechApplicationForbidden=!1,this.isAllCameraMuted=!1,this.isAllMicMuted=!1,this.isCallingRoll=!1,this.startTime=0}}class A5{constructor(){we(this,"roomId","");we(this,"ownerId","");we(this,"roomName","");we(this,"roomMemberNum",0);we(this,"roomConfig",new b5)}reset(){this.roomId="",this.ownerId="",this.roomName="",this.roomMemberNum=0,this.roomConfig.reset()}}class xv{constructor(){we(this,"userId","");we(this,"name","");we(this,"avatar","");we(this,"role",zr.AUDIENCE);we(this,"isVideoStreamAvailable",!1);we(this,"isAudioStreamAvailable",!1);we(this,"isScreenStreamAvailable",!1);we(this,"isVideoStreamSubscribed",!1);we(this,"isAudioStreamSubscribed",!1);we(this,"isScreenStreamSubscribed",!1);we(this,"isLocal",!1)}reset(){this.userId="",this.name="",this.avatar="",this.role=zr.AUDIENCE,this.isVideoStreamAvailable=!1,this.isAudioStreamAvailable=!1,this.isScreenStreamAvailable=!1,this.isVideoStreamSubscribed=!1,this.isAudioStreamSubscribed=!1,this.isScreenStreamSubscribed=!1,this.isLocal=!1}}var iT=(i=>(i[i.TRTCVideoResolution_120_120=1]="TRTCVideoResolution_120_120",i[i.TRTCVideoResolution_160_160=3]="TRTCVideoResolution_160_160",i[i.TRTCVideoResolution_270_270=5]="TRTCVideoResolution_270_270",i[i.TRTCVideoResolution_480_480=7]="TRTCVideoResolution_480_480",i[i.TRTCVideoResolution_160_120=50]="TRTCVideoResolution_160_120",i[i.TRTCVideoResolution_240_180=52]="TRTCVideoResolution_240_180",i[i.TRTCVideoResolution_280_210=54]="TRTCVideoResolution_280_210",i[i.TRTCVideoResolution_320_240=56]="TRTCVideoResolution_320_240",i[i.TRTCVideoResolution_400_300=58]="TRTCVideoResolution_400_300",i[i.TRTCVideoResolution_480_360=60]="TRTCVideoResolution_480_360",i[i.TRTCVideoResolution_640_480=62]="TRTCVideoResolution_640_480",i[i.TRTCVideoResolution_960_720=64]="TRTCVideoResolution_960_720",i[i.TRTCVideoResolution_160_90=100]="TRTCVideoResolution_160_90",i[i.TRTCVideoResolution_256_144=102]="TRTCVideoResolution_256_144",i[i.TRTCVideoResolution_320_180=104]="TRTCVideoResolution_320_180",i[i.TRTCVideoResolution_480_270=106]="TRTCVideoResolution_480_270",i[i.TRTCVideoResolution_640_360=108]="TRTCVideoResolution_640_360",i[i.TRTCVideoResolution_960_540=110]="TRTCVideoResolution_960_540",i[i.TRTCVideoResolution_1280_720=112]="TRTCVideoResolution_1280_720",i[i.TRTCVideoResolution_1920_1080=114]="TRTCVideoResolution_1920_1080",i))(iT||{}),k5=(i=>(i[i.TRTCVideoResolutionModeLandscape=0]="TRTCVideoResolutionModeLandscape",i[i.TRTCVideoResolutionModePortrait=1]="TRTCVideoResolutionModePortrait",i))(k5||{}),gb=(i=>(i[i.TRTCVideoStreamTypeBig=0]="TRTCVideoStreamTypeBig",i[i.TRTCVideoStreamTypeSmall=1]="TRTCVideoStreamTypeSmall",i[i.TRTCVideoStreamTypeSub=2]="TRTCVideoStreamTypeSub",i))(gb||{}),w5=(i=>(i[i.TRTCVideoFillMode_Fill=0]="TRTCVideoFillMode_Fill",i[i.TRTCVideoFillMode_Fit=1]="TRTCVideoFillMode_Fit",i))(w5||{}),DS=(i=>(i[i.TRTCAppSceneVideoCall=0]="TRTCAppSceneVideoCall",i[i.TRTCAppSceneLIVE=1]="TRTCAppSceneLIVE",i[i.TRTCAppSceneAudioCall=2]="TRTCAppSceneAudioCall",i[i.TRTCAppSceneVoiceChatRoom=3]="TRTCAppSceneVoiceChatRoom",i))(DS||{}),tb=(i=>(i[i.TRTCRoleAnchor=20]="TRTCRoleAnchor",i[i.TRTCRoleAudience=21]="TRTCRoleAudience",i))(tb||{});class $8{constructor(s=108,g=0,m=15,R=550,A=0,D=!1){we(this,"videoResolution");we(this,"resMode");we(this,"videoFps");we(this,"videoBitrate");we(this,"minVideoBitrate");we(this,"enableAdjustRes");this.videoResolution=s,this.resMode=g,this.videoFps=m,this.videoBitrate=R,this.minVideoBitrate=A,this.enableAdjustRes=D}}var s1={exports:{}};(function(i,s){(function(g,m){i.exports=m()})(rc,function(){function g(a,t){var o=Object.keys(a);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(a);t&&(e=e.filter(function(n){return Object.getOwnPropertyDescriptor(a,n).enumerable})),o.push.apply(o,e)}return o}function m(a){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?g(Object(o),!0).forEach(function(e){$(a,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(o)):g(Object(o)).forEach(function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(o,e))})}return a}function R(a){return(R=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(a)}function A(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function D(a,t){for(var o=0;o<t.length;o++){var e=t[o];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(a,e.key,e)}}function x(a,t,o){return t&&D(a.prototype,t),o&&D(a,o),Object.defineProperty(a,"prototype",{writable:!1}),a}function $(a,t,o){return t in a?Object.defineProperty(a,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):a[t]=o,a}function B(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(t&&t.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),t&&re(a,t)}function te(a){return(te=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(a)}function re(a,t){return(re=Object.setPrototypeOf||function(o,e){return o.__proto__=e,o})(a,t)}function ie(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function W(a,t,o){return(W=ie()?Reflect.construct:function(e,n,l){var h=[null];h.push.apply(h,n);var _=new(Function.bind.apply(e,h));return l&&re(_,l.prototype),_}).apply(null,arguments)}function Y(a){var t=typeof Map=="function"?new Map:void 0;return(Y=function(o){if(o===null||(e=o,Function.toString.call(e).indexOf("[native code]")===-1))return o;var e;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(o))return t.get(o);t.set(o,n)}function n(){return W(o,arguments,te(this).constructor)}return n.prototype=Object.create(o.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),re(n,o)})(a)}function se(a,t){if(a==null)return{};var o,e,n=function(h,_){if(h==null)return{};var S,E,M={},w=Object.keys(h);for(E=0;E<w.length;E++)S=w[E],_.indexOf(S)>=0||(M[S]=h[S]);return M}(a,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(a);for(e=0;e<l.length;e++)o=l[e],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(a,o)&&(n[o]=a[o])}return n}function Ae(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Je(a,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ae(a)}function Xe(a){var t=ie();return function(){var o,e=te(a);if(t){var n=te(this).constructor;o=Reflect.construct(e,arguments,n)}else o=e.apply(this,arguments);return Je(this,o)}}function Ue(a,t){return Pe(a)||function(o,e){var n=o==null?null:typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(n!=null){var l,h,_=[],S=!0,E=!1;try{for(n=n.call(o);!(S=(l=n.next()).done)&&(_.push(l.value),!e||_.length!==e);S=!0);}catch(M){E=!0,h=M}finally{try{S||n.return==null||n.return()}finally{if(E)throw h}}return _}}(a,t)||Se(a,t)||ke()}function Be(a){return function(t){if(Array.isArray(t))return Ee(t)}(a)||de(a)||Se(a)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Pe(a){if(Array.isArray(a))return a}function de(a){if(typeof Symbol<"u"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)}function Se(a,t){if(a){if(typeof a=="string")return Ee(a,t);var o=Object.prototype.toString.call(a).slice(8,-1);return o==="Object"&&a.constructor&&(o=a.constructor.name),o==="Map"||o==="Set"?Array.from(a):o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?Ee(a,t):void 0}}function Ee(a,t){(t==null||t>a.length)&&(t=a.length);for(var o=0,e=new Array(t);o<t;o++)e[o]=a[o];return e}function ke(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function De(a,t){var o=typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(!o){if(Array.isArray(a)||(o=Se(a))||t&&a&&typeof a.length=="number"){o&&(a=o);var e=0,n=function(){};return{s:n,n:function(){return e>=a.length?{done:!0}:{done:!1,value:a[e++]}},e:function(S){throw S},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var l,h=!0,_=!1;return{s:function(){o=o.call(a)},n:function(){var S=o.next();return h=S.done,S},e:function(S){_=!0,l=S},f:function(){try{h||o.return==null||o.return()}finally{if(_)throw l}}}}var Qe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof rc<"u"?rc:typeof self<"u"?self:{};function vt(a,t){return a(t={exports:{}},t.exports),t.exports}var ft,it,ut=function(a){return a&&a.Math==Math&&a},ee=ut(typeof globalThis=="object"&&globalThis)||ut(typeof window=="object"&&window)||ut(typeof self=="object"&&self)||ut(typeof Qe=="object"&&Qe)||function(){return this}()||Function("return this")(),xe=function(a){try{return!!a()}catch{return!0}},Et=!xe(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Fn=!xe(function(){var a=function(){}.bind();return typeof a!="function"||a.hasOwnProperty("prototype")}),Fr=Function.prototype.call,dt=Fn?Fr.bind(Fr):function(){return Fr.apply(Fr,arguments)},ai={}.propertyIsEnumerable,bi=Object.getOwnPropertyDescriptor,dr={f:bi&&!ai.call({1:2},1)?function(a){var t=bi(this,a);return!!t&&t.enumerable}:ai},Gn=function(a,t){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:t}},Ai=Function.prototype,si=Ai.bind,Nr=Ai.call,_i=Fn&&si.bind(Nr,Nr),ve=Fn?function(a){return a&&_i(a)}:function(a){return a&&function(){return Nr.apply(a,arguments)}},qn=ve({}.toString),ho=ve("".slice),hr=function(a){return ho(qn(a),8,-1)},Ki=ee.Object,Co=ve("".split),qr=xe(function(){return!Ki("z").propertyIsEnumerable(0)})?function(a){return hr(a)=="String"?Co(a,""):Ki(a)}:Ki,Oo=ee.TypeError,an=function(a){if(a==null)throw Oo("Can't call method on "+a);return a},ur=function(a){return qr(an(a))},bt=function(a){return typeof a=="function"},xt=function(a){return typeof a=="object"?a!==null:bt(a)},Qo=function(a){return bt(a)?a:void 0},_r=function(a,t){return arguments.length<2?Qo(ee[a]):ee[a]&&ee[a][t]},nt=ve({}.isPrototypeOf),nn=_r("navigator","userAgent")||"",yi=ee.process,Lr=ee.Deno,pr=yi&&yi.versions||Lr&&Lr.version,ma=pr&&pr.v8;ma&&(it=(ft=ma.split("."))[0]>0&&ft[0]<4?1:+(ft[0]+ft[1])),!it&&nn&&(!(ft=nn.match(/Edge\/(\d+)/))||ft[1]>=74)&&(ft=nn.match(/Chrome\/(\d+)/))&&(it=+ft[1]);var Ge=it,ct=!!Object.getOwnPropertySymbols&&!xe(function(){var a=Symbol();return!String(a)||!(Object(a)instanceof Symbol)||!Symbol.sham&&Ge&&Ge<41}),Mn=ct&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Vn=ee.Object,rr=Mn?function(a){return typeof a=="symbol"}:function(a){var t=_r("Symbol");return bt(t)&&nt(t.prototype,Vn(a))},No=ee.String,ci=function(a){try{return No(a)}catch{return"Object"}},Zo=ee.TypeError,er=function(a){if(bt(a))return a;throw Zo(ci(a)+" is not a function")},Ir=function(a,t){var o=a[t];return o==null?void 0:er(o)},va=ee.TypeError,up=Object.defineProperty,Cd=function(a,t){try{up(ee,a,{value:t,configurable:!0,writable:!0})}catch{ee[a]=t}return t},ui=ee["__core-js_shared__"]||Cd("__core-js_shared__",{}),ja=vt(function(a){(a.exports=function(t,o){return ui[t]||(ui[t]=o!==void 0?o:{})})("versions",[]).push({version:"3.21.0",mode:"global",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.21.0/LICENSE",source:"https://github.com/zloirock/core-js"})}),Kv=ee.Object,fr=function(a){return Kv(an(a))},pl=ve({}.hasOwnProperty),st=Object.hasOwn||function(a,t){return pl(fr(a),t)},Wv=0,r0=Math.random(),vg=ve(1 .toString),Wi=function(a){return"Symbol("+(a===void 0?"":a)+")_"+vg(++Wv+r0,36)},Pr=ja("wks"),Lo=ee.Symbol,_g=Lo&&Lo.for,oc=Mn?Lo:Lo&&Lo.withoutSetter||Wi,Qt=function(a){if(!st(Pr,a)||!ct&&typeof Pr[a]!="string"){var t="Symbol."+a;ct&&st(Lo,a)?Pr[a]=Lo[a]:Pr[a]=Mn&&_g?_g(t):oc(t)}return Pr[a]},i0=ee.TypeError,qa=Qt("toPrimitive"),bd=function(a,t){if(!xt(a)||rr(a))return a;var o,e=Ir(a,qa);if(e){if(t===void 0&&(t="default"),o=dt(e,a,t),!xt(o)||rr(o))return o;throw i0("Can't convert object to primitive value")}return t===void 0&&(t="number"),function(n,l){var h,_;if(l==="string"&&bt(h=n.toString)&&!xt(_=dt(h,n))||bt(h=n.valueOf)&&!xt(_=dt(h,n))||l!=="string"&&bt(h=n.toString)&&!xt(_=dt(h,n)))return _;throw va("Can't convert object to primitive value")}(a,t)},Si=function(a){var t=bd(a,"string");return rr(t)?t:t+""},bo=ee.document,zv=xt(bo)&&xt(bo.createElement),_a=function(a){return zv?bo.createElement(a):{}},yg=!Et&&!xe(function(){return Object.defineProperty(_a("div"),"a",{get:function(){return 7}}).a!=7}),lp=Object.getOwnPropertyDescriptor,ki={f:Et?lp:function(a,t){if(a=ur(a),t=Si(t),yg)try{return lp(a,t)}catch{}if(st(a,t))return Gn(!dt(dr.f,a,t),a[t])}},Sg=Et&&xe(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),uu=ee.String,o0=ee.TypeError,Sn=function(a){if(xt(a))return a;throw o0(uu(a)+" is not an object")},a0=ee.TypeError,Ad=Object.defineProperty,kd=Object.getOwnPropertyDescriptor,Yn={f:Et?Sg?function(a,t,o){if(Sn(a),t=Si(t),Sn(o),typeof a=="function"&&t==="prototype"&&"value"in o&&"writable"in o&&!o.writable){var e=kd(a,t);e&&e.writable&&(a[t]=o.value,o={configurable:"configurable"in o?o.configurable:e.configurable,enumerable:"enumerable"in o?o.enumerable:e.enumerable,writable:!1})}return Ad(a,t,o)}:Ad:function(a,t,o){if(Sn(a),t=Si(t),Sn(o),yg)try{return Ad(a,t,o)}catch{}if("get"in o||"set"in o)throw a0("Accessors not supported");return"value"in o&&(a[t]=o.value),a}},Hn=Et?function(a,t,o){return Yn.f(a,t,Gn(1,o))}:function(a,t,o){return a[t]=o,a},Yv=ve(Function.toString);bt(ui.inspectSource)||(ui.inspectSource=function(a){return Yv(a)});var dp,ya,Sa,wi=ui.inspectSource,As=ee.WeakMap,fl=bt(As)&&/native code/.test(wi(As)),gl=ja("keys"),ac=function(a){return gl[a]||(gl[a]=Wi(a))},ks={},Ig=ee.TypeError,Jv=ee.WeakMap;if(fl||ui.state){var to=ui.state||(ui.state=new Jv),hp=ve(to.get),wd=ve(to.has),Eg=ve(to.set);dp=function(a,t){if(wd(to,a))throw new Ig("Object already initialized");return t.facade=a,Eg(to,a,t),t},ya=function(a){return hp(to,a)||{}},Sa=function(a){return wd(to,a)}}else{var ea=ac("state");ks[ea]=!0,dp=function(a,t){if(st(a,ea))throw new Ig("Object already initialized");return t.facade=a,Hn(a,ea,t),t},ya=function(a){return st(a,ea)?a[ea]:{}},Sa=function(a){return st(a,ea)}}var Jr={set:dp,get:ya,has:Sa,enforce:function(a){return Sa(a)?ya(a):dp(a,{})},getterFor:function(a){return function(t){var o;if(!xt(t)||(o=ya(t)).type!==a)throw Ig("Incompatible receiver, "+a+" required");return o}}},lu=Function.prototype,Xv=Et&&Object.getOwnPropertyDescriptor,sc=st(lu,"name"),Tr={EXISTS:sc,PROPER:sc&&function(){}.name==="something",CONFIGURABLE:sc&&(!Et||Et&&Xv(lu,"name").configurable)},lr=vt(function(a){var t=Tr.CONFIGURABLE,o=Jr.get,e=Jr.enforce,n=String(String).split("String");(a.exports=function(l,h,_,S){var E,M=!!S&&!!S.unsafe,w=!!S&&!!S.enumerable,L=!!S&&!!S.noTargetGet,H=S&&S.name!==void 0?S.name:h;bt(_)&&(String(H).slice(0,7)==="Symbol("&&(H="["+String(H).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!st(_,"name")||t&&_.name!==H)&&Hn(_,"name",H),(E=e(_)).source||(E.source=n.join(typeof H=="string"?H:""))),l!==ee?(M?!L&&l[h]&&(w=!0):delete l[h],w?l[h]=_:Hn(l,h,_)):w?l[h]=_:Cd(h,_)})(Function.prototype,"toString",function(){return bt(this)&&o(this).source||wi(this)})}),sr=Math.ceil,Ha=Math.floor,$a=function(a){var t=+a;return t!=t||t===0?0:(t>0?Ha:sr)(t)},Ia=Math.max,s0=Math.min,Li=function(a,t){var o=$a(a);return o<0?Ia(o+t,0):s0(o,t)},po=Math.min,Ea=function(a){return a>0?po($a(a),9007199254740991):0},xr=function(a){return Ea(a.length)},Pi=function(a){return function(t,o,e){var n,l=ur(t),h=xr(l),_=Li(e,h);if(a&&o!=o){for(;h>_;)if((n=l[_++])!=n)return!0}else for(;h>_;_++)if((a||_ in l)&&l[_]===o)return a||_||0;return!a&&-1}},ml={includes:Pi(!0),indexOf:Pi(!1)},Dd=ml.indexOf,Qv=ve([].push),Tg=function(a,t){var o,e=ur(a),n=0,l=[];for(o in e)!st(ks,o)&&st(e,o)&&Qv(l,o);for(;t.length>n;)st(e,o=t[n++])&&(~Dd(l,o)||Qv(l,o));return l},vl=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],du=vl.concat("length","prototype"),cc={f:Object.getOwnPropertyNames||function(a){return Tg(a,du)}},ta={f:Object.getOwnPropertySymbols},pp=ve([].concat),Zv=_r("Reflect","ownKeys")||function(a){var t=cc.f(Sn(a)),o=ta.f;return o?pp(t,o(a)):t},fp=function(a,t,o){for(var e=Zv(t),n=Yn.f,l=ki.f,h=0;h<e.length;h++){var _=e[h];st(a,_)||o&&st(o,_)||n(a,_,l(t,_))}},e_=/#|\.prototype\./,_l=function(a,t){var o=Od[uc(a)];return o==Rg||o!=Mg&&(bt(t)?xe(t):!!t)},uc=_l.normalize=function(a){return String(a).replace(e_,".").toLowerCase()},Od=_l.data={},Mg=_l.NATIVE="N",Rg=_l.POLYFILL="P",Ta=_l,hu=ki.f,sn=function(a,t){var o,e,n,l,h,_=a.target,S=a.global,E=a.stat;if(o=S?ee:E?ee[_]||Cd(_,{}):(ee[_]||{}).prototype)for(e in t){if(l=t[e],n=a.noTargetGet?(h=hu(o,e))&&h.value:o[e],!Ta(S?e:_+(E?".":"#")+e,a.forced)&&n!==void 0){if(typeof l==typeof n)continue;fp(l,n)}(a.sham||n&&n.sham)&&Hn(l,"sham",!0),lr(o,e,l,a)}},cn={};cn[Qt("toStringTag")]="z";var lc=String(cn)==="[object z]",Ma=Qt("toStringTag"),dc=ee.Object,t_=hr(function(){return arguments}())=="Arguments",xi=lc?hr:function(a){var t,o,e;return a===void 0?"Undefined":a===null?"Null":typeof(o=function(n,l){try{return n[l]}catch{}}(t=dc(a),Ma))=="string"?o:t_?hr(t):(e=hr(t))=="Object"&&bt(t.callee)?"Arguments":e},Cg=ee.String,fn=function(a){if(xi(a)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return Cg(a)},hc=`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF`,Ka=ve("".replace),yl="["+hc+"]",Sl=RegExp("^"+yl+yl+"*"),n_=RegExp(yl+yl+"*$"),Nd=function(a){return function(t){var o=fn(an(t));return 1&a&&(o=Ka(o,Sl,"")),2&a&&(o=Ka(o,n_,"")),o}},li={start:Nd(1),end:Nd(2),trim:Nd(3)},c0=li.trim,ws=ee.parseInt,gp=ee.Symbol,pc=gp&&gp.iterator,Il=/^[+-]?0x/i,r_=ve(Il.exec),El=ws(hc+"08")!==8||ws(hc+"0x16")!==22||pc&&!xe(function(){ws(Object(pc))})?function(a,t){var o=c0(fn(a));return ws(o,t>>>0||(r_(Il,o)?16:10))}:ws;sn({global:!0,forced:parseInt!=El},{parseInt:El});var Ld,no=Object.keys||function(a){return Tg(a,vl)},Zr={f:Et&&!Sg?Object.defineProperties:function(a,t){Sn(a);for(var o,e=ur(t),n=no(t),l=n.length,h=0;l>h;)Yn.f(a,o=n[h++],e[o]);return a}},mp=_r("document","documentElement"),Tl=ac("IE_PROTO"),vp=function(){},i_=function(a){return"<script>"+a+"<\/script>"},o_=function(a){a.write(i_("")),a.close();var t=a.parentWindow.Object;return a=null,t},Ds=function(){try{Ld=new ActiveXObject("htmlfile")}catch{}var a,t;Ds=typeof document<"u"?document.domain&&Ld?o_(Ld):((t=_a("iframe")).style.display="none",mp.appendChild(t),t.src=String("javascript:"),(a=t.contentWindow.document).open(),a.write(i_("document.F=Object")),a.close(),a.F):o_(Ld);for(var o=vl.length;o--;)delete Ds.prototype[vl[o]];return Ds()};ks[Tl]=!0;var na=Object.create||function(a,t){var o;return a!==null?(vp.prototype=Sn(a),o=new vp,vp.prototype=null,o[Tl]=a):o=Ds(),t===void 0?o:Zr.f(o,t)};sn({target:"Object",stat:!0,sham:!Et},{create:na});var a_=ve(ve.bind),ra=function(a,t){return er(a),t===void 0?a:Fn?a_(a,t):function(){return a.apply(t,arguments)}},fc=Array.isArray||function(a){return hr(a)=="Array"},Pd=function(){},Ml=[],gc=_r("Reflect","construct"),pu=/^\s*(?:class|function)\b/,_p=ve(pu.exec),Ra=!pu.exec(Pd),Os=function(a){if(!bt(a))return!1;try{return gc(Pd,Ml,a),!0}catch{return!1}},yp=function(a){if(!bt(a))return!1;switch(xi(a)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ra||!!_p(pu,wi(a))}catch{return!0}};yp.sham=!0;var xd=!gc||xe(function(){var a;return Os(Os.call)||!Os(Object)||!Os(function(){a=!0})||a})?yp:Os,bg=Qt("species"),Ud=ee.Array,Rl=function(a,t){return new(function(o){var e;return fc(o)&&(e=o.constructor,(xd(e)&&(e===Ud||fc(e.prototype))||xt(e)&&(e=e[bg])===null)&&(e=void 0)),e===void 0?Ud:e}(a))(t===0?0:t)},fu=ve([].push),Wa=function(a){var t=a==1,o=a==2,e=a==3,n=a==4,l=a==6,h=a==7,_=a==5||l;return function(S,E,M,w){for(var L,H,ne=fr(S),ae=qr(ne),he=ra(E,M),ge=xr(ae),Te=0,Ze=w||Rl,Ct=t?Ze(S,ge):o||h?Ze(S,0):void 0;ge>Te;Te++)if((_||Te in ae)&&(H=he(L=ae[Te],Te,ne),a))if(t)Ct[Te]=H;else if(H)switch(a){case 3:return!0;case 5:return L;case 6:return Te;case 2:fu(Ct,L)}else switch(a){case 4:return!1;case 7:fu(Ct,L)}return l?-1:e||n?n:Ct}},Ui={forEach:Wa(0),map:Wa(1),filter:Wa(2),some:Wa(3),every:Wa(4),find:Wa(5),findIndex:Wa(6),filterReject:Wa(7)},Cl=function(a,t){var o=[][a];return!!o&&xe(function(){o.call(null,t||function(){throw 1},1)})},Ag=Ui.forEach,gu=Cl("forEach")?[].forEach:function(a){return Ag(this,a,arguments.length>1?arguments[1]:void 0)};sn({target:"Array",proto:!0,forced:[].forEach!=gu},{forEach:gu});var Sp=lc?{}.toString:function(){return"[object "+xi(this)+"]"};lc||lr(Object.prototype,"toString",Sp,{unsafe:!0});var bl={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},ro=_a("span").classList,Ip=ro&&ro.constructor&&ro.constructor.prototype,gn=Ip===Object.prototype?void 0:Ip,kg=function(a){if(a&&a.forEach!==gu)try{Hn(a,"forEach",gu)}catch{a.forEach=gu}};for(var Al in bl)bl[Al]&&kg(ee[Al]&&ee[Al].prototype);kg(gn);var s_=xe(function(){no(1)});sn({target:"Object",stat:!0,forced:s_},{keys:function(a){return no(fr(a))}});var mc=function(a,t,o){var e,n;Sn(a);try{if(!(e=Ir(a,"return"))){if(t==="throw")throw o;return o}e=dt(e,a)}catch(l){n=!0,e=l}if(t==="throw")throw o;if(n)throw e;return Sn(e),o},Gi=function(a,t,o,e){try{return e?t(Sn(o)[0],o[1]):t(o)}catch(n){mc(a,"throw",n)}},mu={},wg=Qt("iterator"),Ep=Array.prototype,kl=function(a){return a!==void 0&&(mu.Array===a||Ep[wg]===a)},za=function(a,t,o){var e=Si(t);e in a?Yn.f(a,e,Gn(0,o)):a[e]=o},Dg=Qt("iterator"),vc=function(a){if(a!=null)return Ir(a,Dg)||Ir(a,"@@iterator")||mu[xi(a)]},Og=ee.TypeError,Po=function(a,t){var o=arguments.length<2?vc(a):t;if(er(o))return Sn(dt(o,a));throw Og(ci(a)+" is not iterable")},Ng=ee.Array,io=function(a){var t=fr(a),o=xd(this),e=arguments.length,n=e>1?arguments[1]:void 0,l=n!==void 0;l&&(n=ra(n,e>2?arguments[2]:void 0));var h,_,S,E,M,w,L=vc(t),H=0;if(!L||this==Ng&&kl(L))for(h=xr(t),_=o?new this(h):Ng(h);h>H;H++)w=l?n(t[H],H):t[H],za(_,H,w);else for(M=(E=Po(t,L)).next,_=o?new this:[];!(S=dt(M,E)).done;H++)w=l?Gi(E,n,[S.value,H],!0):S.value,za(_,H,w);return _.length=H,_},Lg=Qt("iterator"),Pg=!1;try{var c_=0,xg={next:function(){return{done:!!c_++}},return:function(){Pg=!0}};xg[Lg]=function(){return this},Array.from(xg,function(){throw 2})}catch{}var Gd=function(a,t){if(!t&&!Pg)return!1;var o=!1;try{var e={};e[Lg]=function(){return{next:function(){return{done:o=!0}}}},a(e)}catch{}return o},Ug=!Gd(function(a){Array.from(a)});sn({target:"Array",stat:!0,forced:Ug},{from:io});var _c,Gg,Fg,Vg=ve("".charAt),yc=ve("".charCodeAt),Bg=ve("".slice),Ao=function(a){return function(t,o){var e,n,l=fn(an(t)),h=$a(o),_=l.length;return h<0||h>=_?a?"":void 0:(e=yc(l,h))<55296||e>56319||h+1===_||(n=yc(l,h+1))<56320||n>57343?a?Vg(l,h):e:a?Bg(l,h,h+2):n-56320+(e-55296<<10)+65536}},oo={codeAt:Ao(!1),charAt:Ao(!0)},xo=!xe(function(){function a(){}return a.prototype.constructor=null,Object.getPrototypeOf(new a)!==a.prototype}),wl=ac("IE_PROTO"),Fd=ee.Object,vu=Fd.prototype,fo=xo?Fd.getPrototypeOf:function(a){var t=fr(a);if(st(t,wl))return t[wl];var o=t.constructor;return bt(o)&&t instanceof o?o.prototype:t instanceof Fd?vu:null},Sc=Qt("iterator"),Vd=!1;[].keys&&("next"in(Fg=[].keys())?(Gg=fo(fo(Fg)))!==Object.prototype&&(_c=Gg):Vd=!0),(_c==null||xe(function(){var a={};return _c[Sc].call(a)!==a}))&&(_c={}),bt(_c[Sc])||lr(_c,Sc,function(){return this});var Dl={IteratorPrototype:_c,BUGGY_SAFARI_ITERATORS:Vd},Bd=Yn.f,jg=Qt("toStringTag"),ia=function(a,t,o){a&&!o&&(a=a.prototype),a&&!st(a,jg)&&Bd(a,jg,{configurable:!0,value:t})},_u=Dl.IteratorPrototype,Tp=function(){return this},Ca=function(a,t,o,e){var n=t+" Iterator";return a.prototype=na(_u,{next:Gn(+!e,o)}),ia(a,n,!1),mu[n]=Tp,a},Ns=ee.String,Mp=ee.TypeError,di=Object.setPrototypeOf||("__proto__"in{}?function(){var a,t=!1,o={};try{(a=ve(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(o,[]),t=o instanceof Array}catch{}return function(e,n){return Sn(e),function(l){if(typeof l=="object"||bt(l))return l;throw Mp("Can't set "+Ns(l)+" as a prototype")}(n),t?a(e,n):e.__proto__=n,e}}():void 0),u_=Tr.PROPER,jd=Tr.CONFIGURABLE,Ic=Dl.IteratorPrototype,Ls=Dl.BUGGY_SAFARI_ITERATORS,Ec=Qt("iterator"),Ya=function(){return this},qd=function(a,t,o,e,n,l,h){Ca(o,t,e);var _,S,E,M=function(ge){if(ge===n&&ae)return ae;if(!Ls&&ge in H)return H[ge];switch(ge){case"keys":case"values":case"entries":return function(){return new o(this,ge)}}return function(){return new o(this)}},w=t+" Iterator",L=!1,H=a.prototype,ne=H[Ec]||H["@@iterator"]||n&&H[n],ae=!Ls&&ne||M(n),he=t=="Array"&&H.entries||ne;if(he&&(_=fo(he.call(new a)))!==Object.prototype&&_.next&&(fo(_)!==Ic&&(di?di(_,Ic):bt(_[Ec])||lr(_,Ec,Ya)),ia(_,w,!0)),u_&&n=="values"&&ne&&ne.name!=="values"&&(jd?Hn(H,"name","values"):(L=!0,ae=function(){return dt(ne,this)})),n)if(S={values:M("values"),keys:l?ae:M("keys"),entries:M("entries")},h)for(E in S)(Ls||L||!(E in H))&&lr(H,E,S[E]);else sn({target:t,proto:!0,forced:Ls||L},S);return H[Ec]!==ae&&lr(H,Ec,ae,{name:n}),mu[t]=ae,S},l_=oo.charAt,Tc=Jr.set,Mc=Jr.getterFor("String Iterator");qd(String,"String",function(a){Tc(this,{type:"String Iterator",string:fn(a),index:0})},function(){var a,t=Mc(this),o=t.string,e=t.index;return e>=o.length?{value:void 0,done:!0}:(a=l_(o,e),t.index+=a.length,{value:a,done:!1})});var mn={SDK_READY:"sdkStateReady",SDK_NOT_READY:"sdkStateNotReady",SDK_DESTROY:"sdkDestroy",MESSAGE_RECEIVED:"onMessageReceived",MESSAGE_MODIFIED:"onMessageModified",MESSAGE_REVOKED:"onMessageRevoked",MESSAGE_READ_BY_PEER:"onMessageReadByPeer",MESSAGE_READ_RECEIPT_RECEIVED:"onMessageReadReceiptReceived",CONVERSATION_LIST_UPDATED:"onConversationListUpdated",GROUP_LIST_UPDATED:"onGroupListUpdated",GROUP_SYSTEM_NOTICE_RECEIVED:"receiveGroupSystemNotice",GROUP_ATTRIBUTES_UPDATED:"groupAttributesUpdated",TOPIC_CREATED:"onTopicCreated",TOPIC_DELETED:"onTopicDeleted",TOPIC_UPDATED:"onTopicUpdated",PROFILE_UPDATED:"onProfileUpdated",USER_STATUS_UPDATED:"onUserStatusUpdated",BLACKLIST_UPDATED:"blacklistUpdated",FRIEND_LIST_UPDATED:"onFriendListUpdated",FRIEND_GROUP_LIST_UPDATED:"onFriendGroupListUpdated",FRIEND_APPLICATION_LIST_UPDATED:"onFriendApplicationListUpdated",KICKED_OUT:"kickedOut",ERROR:"error",NET_STATE_CHANGE:"netStateChange",SDK_RELOAD:"sdkReload"},Z={MSG_TEXT:"TIMTextElem",MSG_IMAGE:"TIMImageElem",MSG_SOUND:"TIMSoundElem",MSG_AUDIO:"TIMSoundElem",MSG_FILE:"TIMFileElem",MSG_FACE:"TIMFaceElem",MSG_VIDEO:"TIMVideoFileElem",MSG_GEO:"TIMLocationElem",MSG_LOCATION:"TIMLocationElem",MSG_GRP_TIP:"TIMGroupTipElem",MSG_GRP_SYS_NOTICE:"TIMGroupSystemNoticeElem",MSG_CUSTOM:"TIMCustomElem",MSG_MERGER:"TIMRelayElem",MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",CONV_C2C:"C2C",CONV_GROUP:"GROUP",CONV_TOPIC:"TOPIC",CONV_SYSTEM:"@TIM#SYSTEM",CONV_AT_ME:1,CONV_AT_ALL:2,CONV_AT_ALL_AT_ME:3,GRP_PRIVATE:"Private",GRP_WORK:"Private",GRP_PUBLIC:"Public",GRP_CHATROOM:"ChatRoom",GRP_MEETING:"ChatRoom",GRP_AVCHATROOM:"AVChatRoom",GRP_COMMUNITY:"Community",GRP_MBR_ROLE_OWNER:"Owner",GRP_MBR_ROLE_ADMIN:"Admin",GRP_MBR_ROLE_MEMBER:"Member",GRP_MBR_ROLE_CUSTOM:"Custom",GRP_TIP_MBR_JOIN:1,GRP_TIP_MBR_QUIT:2,GRP_TIP_MBR_KICKED_OUT:3,GRP_TIP_MBR_SET_ADMIN:4,GRP_TIP_MBR_CANCELED_ADMIN:5,GRP_TIP_GRP_PROFILE_UPDATED:6,GRP_TIP_MBR_PROFILE_UPDATED:7,MSG_REMIND_ACPT_AND_NOTE:"AcceptAndNotify",MSG_REMIND_ACPT_NOT_NOTE:"AcceptNotNotify",MSG_REMIND_DISCARD:"Discard",GENDER_UNKNOWN:"Gender_Type_Unknown",GENDER_FEMALE:"Gender_Type_Female",GENDER_MALE:"Gender_Type_Male",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",KICKED_OUT_REST_API:"REST_API_Kick",ALLOW_TYPE_ALLOW_ANY:"AllowType_Type_AllowAny",ALLOW_TYPE_NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_TYPE_DENY_ANY:"AllowType_Type_DenyAny",FORBID_TYPE_NONE:"AdminForbid_Type_None",FORBID_TYPE_SEND_OUT:"AdminForbid_Type_SendOut",JOIN_OPTIONS_FREE_ACCESS:"FreeAccess",JOIN_OPTIONS_NEED_PERMISSION:"NeedPermission",JOIN_OPTIONS_DISABLE_APPLY:"DisableApply",JOIN_STATUS_SUCCESS:"JoinedSuccess",JOIN_STATUS_ALREADY_IN_GROUP:"AlreadyInGroup",JOIN_STATUS_WAIT_APPROVAL:"WaitAdminApproval",GRP_PROFILE_OWNER_ID:"ownerID",GRP_PROFILE_CREATE_TIME:"createTime",GRP_PROFILE_LAST_INFO_TIME:"lastInfoTime",GRP_PROFILE_MEMBER_NUM:"memberNum",GRP_PROFILE_MAX_MEMBER_NUM:"maxMemberNum",GRP_PROFILE_JOIN_OPTION:"joinOption",GRP_PROFILE_INTRODUCTION:"introduction",GRP_PROFILE_NOTIFICATION:"notification",GRP_PROFILE_MUTE_ALL_MBRS:"muteAllMembers",SNS_ADD_TYPE_SINGLE:"Add_Type_Single",SNS_ADD_TYPE_BOTH:"Add_Type_Both",SNS_DELETE_TYPE_SINGLE:"Delete_Type_Single",SNS_DELETE_TYPE_BOTH:"Delete_Type_Both",SNS_APPLICATION_TYPE_BOTH:"Pendency_Type_Both",SNS_APPLICATION_SENT_TO_ME:"Pendency_Type_ComeIn",SNS_APPLICATION_SENT_BY_ME:"Pendency_Type_SendOut",SNS_APPLICATION_AGREE:"Response_Action_Agree",SNS_APPLICATION_AGREE_AND_ADD:"Response_Action_AgreeAndAdd",SNS_CHECK_TYPE_BOTH:"CheckResult_Type_Both",SNS_CHECK_TYPE_SINGLE:"CheckResult_Type_Single",SNS_TYPE_NO_RELATION:"CheckResult_Type_NoRelation",SNS_TYPE_A_WITH_B:"CheckResult_Type_AWithB",SNS_TYPE_B_WITH_A:"CheckResult_Type_BWithA",SNS_TYPE_BOTH_WAY:"CheckResult_Type_BothWay",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected",MSG_AT_ALL:"__kImSDK_MesssageAtALL__",READ_ALL_C2C_MSG:"readAllC2CMessage",READ_ALL_GROUP_MSG:"readAllGroupMessage",READ_ALL_MSG:"readAllMessage",USER_STATUS_UNKNOWN:0,USER_STATUS_ONLINE:1,USER_STATUS_OFFLINE:2,USER_STATUS_UNLOGINED:3},ba=ve([].slice),go=ee.Function,mo=ve([].concat),Ol=ve([].join),Rp={},Nl=function(a,t,o){if(!st(Rp,t)){for(var e=[],n=0;n<t;n++)e[n]="a["+n+"]";Rp[t]=go("C,a","return new C("+Ol(e,",")+")")}return Rp[t](a,o)},Cp=Fn?go.bind:function(a){var t=er(this),o=t.prototype,e=ba(arguments,1),n=function(){var l=mo(e,ba(arguments));return this instanceof n?Nl(t,l.length,l):t.apply(a,l)};return xt(o)&&(n.prototype=o),n};sn({target:"Function",proto:!0,forced:Function.bind!==Cp},{bind:Cp});var qg=Qt("species"),Uo=function(a){return Ge>=51||!xe(function(){var t=[];return(t.constructor={})[qg]=function(){return{foo:1}},t[a](Boolean).foo!==1})},Ja=Ui.map,Aa=Uo("map");sn({target:"Array",proto:!0,forced:!Aa},{map:function(a){return Ja(this,a,arguments.length>1?arguments[1]:void 0)}});var Hg=function(){function a(){A(this,a),this.cache=[],this.options=null}return x(a,[{key:"use",value:function(t){if(typeof t!="function")throw"middleware must be a function";return this.cache.push(t),this}},{key:"next",value:function(t){if(this.middlewares&&this.middlewares.length>0)return this.middlewares.shift().call(this,this.options,this.next.bind(this))}},{key:"run",value:function(t){return this.middlewares=this.cache.map(function(o){return o}),this.options=t,this.next()}}]),a}(),u0=Tr.EXISTS,d_=Yn.f,hi=Function.prototype,$g=ve(hi.toString),Xa=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,Kg=ve(Xa.exec);Et&&!u0&&d_(hi,"name",{configurable:!0,get:function(){try{return Kg(Xa,$g(this))[1]}catch{return""}}});var Go=Qt("isConcatSpreadable"),Rc=ee.TypeError,h_=Ge>=51||!xe(function(){var a=[];return a[Go]=!1,a.concat()[0]!==a}),rn=Uo("concat"),l0=function(a){if(!xt(a))return!1;var t=a[Go];return t!==void 0?!!t:fc(a)};sn({target:"Array",proto:!0,forced:!h_||!rn},{concat:function(a){var t,o,e,n,l,h=fr(this),_=Rl(h,0),S=0;for(t=-1,e=arguments.length;t<e;t++)if(l0(l=t===-1?h:arguments[t])){if(S+(n=xr(l))>9007199254740991)throw Rc("Maximum allowed index exceeded");for(o=0;o<n;o++,S++)o in l&&za(_,S,l[o])}else{if(S>=9007199254740991)throw Rc("Maximum allowed index exceeded");za(_,S++,l)}return _.length=S,_}});var Wg=vt(function(a,t){var o,e,n,l,h,_,S,E,M,w,L,H,ne,ae,he,ge,Te,Ze;a.exports=(o=typeof Promise=="function",e=typeof self=="object"?self:Qe,n=typeof Symbol<"u",l=typeof Map<"u",h=typeof Set<"u",_=typeof WeakMap<"u",S=typeof WeakSet<"u",E=typeof DataView<"u",M=n&&Symbol.iterator!==void 0,w=n&&Symbol.toStringTag!==void 0,L=h&&typeof Set.prototype.entries=="function",H=l&&typeof Map.prototype.entries=="function",ne=L&&Object.getPrototypeOf(new Set().entries()),ae=H&&Object.getPrototypeOf(new Map().entries()),he=M&&typeof Array.prototype[Symbol.iterator]=="function",ge=he&&Object.getPrototypeOf([][Symbol.iterator]()),Te=M&&typeof String.prototype[Symbol.iterator]=="function",Ze=Te&&Object.getPrototypeOf(""[Symbol.iterator]()),function(Ct){var wt=typeof Ct;if(wt!=="object")return wt;if(Ct===null)return"null";if(Ct===e)return"global";if(Array.isArray(Ct)&&(w===!1||!(Symbol.toStringTag in Ct)))return"Array";if(typeof window=="object"&&window!==null){if(typeof window.location=="object"&&Ct===window.location)return"Location";if(typeof window.document=="object"&&Ct===window.document)return"Document";if(typeof window.navigator=="object"){if(typeof window.navigator.mimeTypes=="object"&&Ct===window.navigator.mimeTypes)return"MimeTypeArray";if(typeof window.navigator.plugins=="object"&&Ct===window.navigator.plugins)return"PluginArray"}if((typeof window.HTMLElement=="function"||typeof window.HTMLElement=="object")&&Ct instanceof window.HTMLElement){if(Ct.tagName==="BLOCKQUOTE")return"HTMLQuoteElement";if(Ct.tagName==="TD")return"HTMLTableDataCellElement";if(Ct.tagName==="TH")return"HTMLTableHeaderCellElement"}}var dn=w&&Ct[Symbol.toStringTag];if(typeof dn=="string")return dn;var $t=Object.getPrototypeOf(Ct);return $t===RegExp.prototype?"RegExp":$t===Date.prototype?"Date":o&&$t===Promise.prototype?"Promise":h&&$t===Set.prototype?"Set":l&&$t===Map.prototype?"Map":S&&$t===WeakSet.prototype?"WeakSet":_&&$t===WeakMap.prototype?"WeakMap":E&&$t===DataView.prototype?"DataView":l&&$t===ae?"Map Iterator":h&&$t===ne?"Set Iterator":he&&$t===ge?"Array Iterator":Te&&$t===Ze?"String Iterator":$t===null?"Object":Object.prototype.toString.call(Ct).slice(8,-1)})});sn({target:"Array",stat:!0},{isArray:fc});var Ps=function(a,t,o){var e,n;return di&&bt(e=t.constructor)&&e!==o&&xt(n=e.prototype)&&n!==o.prototype&&di(a,n),a},Cc=ve(1 .valueOf),p_=cc.f,yu=ki.f,bp=Yn.f,d0=li.trim,Vr=ee.Number,Ap=Vr.prototype,f_=ee.TypeError,g_=ve("".slice),Hd=ve("".charCodeAt),kp=function(a){var t=bd(a,"number");return typeof t=="bigint"?t:zg(t)},zg=function(a){var t,o,e,n,l,h,_,S,E=bd(a,"number");if(rr(E))throw f_("Cannot convert a Symbol value to a number");if(typeof E=="string"&&E.length>2){if(E=d0(E),(t=Hd(E,0))===43||t===45){if((o=Hd(E,2))===88||o===120)return NaN}else if(t===48){switch(Hd(E,1)){case 66:case 98:e=2,n=49;break;case 79:case 111:e=8,n=55;break;default:return+E}for(h=(l=g_(E,2)).length,_=0;_<h;_++)if((S=Hd(l,_))<48||S>n)return NaN;return parseInt(l,e)}}return+E};if(Ta("Number",!Vr(" 0o1")||!Vr("0b1")||Vr("+0x1"))){for(var wp,ka=function(a){var t=arguments.length<1?0:Vr(kp(a)),o=this;return nt(Ap,o)&&xe(function(){Cc(o)})?Ps(Object(t),o,ka):t},$d=Et?p_(Vr):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),Yg=0;$d.length>Yg;Yg++)st(Vr,wp=$d[Yg])&&!st(ka,wp)&&bp(ka,wp,yu(Vr,wp));ka.prototype=Ap,Ap.constructor=ka,lr(ee,"Number",ka)}var Jg=xe(function(){fo(1)});sn({target:"Object",stat:!0,forced:Jg,sham:!xo},{getPrototypeOf:function(a){return fo(fr(a))}});var m_,Su,v_=function(){var a=Sn(this),t="";return a.global&&(t+="g"),a.ignoreCase&&(t+="i"),a.multiline&&(t+="m"),a.dotAll&&(t+="s"),a.unicode&&(t+="u"),a.sticky&&(t+="y"),t},bc=ee.RegExp,Kd=xe(function(){var a=bc("a","y");return a.lastIndex=2,a.exec("abcd")!=null}),h0=Kd||xe(function(){return!bc("a","y").sticky}),Wd={BROKEN_CARET:Kd||xe(function(){var a=bc("^r","gy");return a.lastIndex=2,a.exec("str")!=null}),MISSED_STICKY:h0,UNSUPPORTED_Y:Kd},__=ee.RegExp,Dp=xe(function(){var a=__(".","s");return!(a.dotAll&&a.exec(`
`)&&a.flags==="s")}),p0=ee.RegExp,oa=xe(function(){var a=p0("(?<a>b)","g");return a.exec("b").groups.a!=="b"||"b".replace(a,"$<a>c")!=="bc"}),Xg=Jr.get,Qg=ja("native-string-replace",String.prototype.replace),zd=RegExp.prototype.exec,Op=zd,Zg=ve("".charAt),Np=ve("".indexOf),Lp=ve("".replace),Qa=ve("".slice),Yd=(Su=/b*/g,dt(zd,m_=/a/,"a"),dt(zd,Su,"a"),m_.lastIndex!==0||Su.lastIndex!==0),Iu=Wd.BROKEN_CARET,Pp=/()??/.exec("")[1]!==void 0;(Yd||Pp||Iu||Dp||oa)&&(Op=function(a){var t,o,e,n,l,h,_,S=this,E=Xg(S),M=fn(a),w=E.raw;if(w)return w.lastIndex=S.lastIndex,t=dt(Op,w,M),S.lastIndex=w.lastIndex,t;var L=E.groups,H=Iu&&S.sticky,ne=dt(v_,S),ae=S.source,he=0,ge=M;if(H&&(ne=Lp(ne,"y",""),Np(ne,"g")===-1&&(ne+="g"),ge=Qa(M,S.lastIndex),S.lastIndex>0&&(!S.multiline||S.multiline&&Zg(M,S.lastIndex-1)!==`
`)&&(ae="(?: "+ae+")",ge=" "+ge,he++),o=new RegExp("^(?:"+ae+")",ne)),Pp&&(o=new RegExp("^"+ae+"$(?!\\s)",ne)),Yd&&(e=S.lastIndex),n=dt(zd,H?o:S,ge),H?n?(n.input=Qa(n.input,he),n[0]=Qa(n[0],he),n.index=S.lastIndex,S.lastIndex+=n[0].length):S.lastIndex=0:Yd&&n&&(S.lastIndex=S.global?n.index+n[0].length:e),Pp&&n&&n.length>1&&dt(Qg,n[0],o,function(){for(l=1;l<arguments.length-2;l++)arguments[l]===void 0&&(n[l]=void 0)}),n&&L)for(n.groups=h=na(null),l=0;l<L.length;l++)h[(_=L[l])[0]]=n[_[1]];return n});var Ll=Op;sn({target:"RegExp",proto:!0,forced:/./.exec!==Ll},{exec:Ll});var xp=Date.prototype,Jd=ve(xp.toString),y_=ve(xp.getTime);String(new Date(NaN))!="Invalid Date"&&lr(xp,"toString",function(){var a=y_(this);return a==a?Jd(this):"Invalid Date"});var em=Tr.PROPER,hn=RegExp.prototype,S_=hn.toString,I_=ve(v_),f0=xe(function(){return S_.call({source:"a",flags:"b"})!="/a/b"}),E_=em&&S_.name!="toString";(f0||E_)&&lr(RegExp.prototype,"toString",function(){var a=Sn(this),t=fn(a.source),o=a.flags;return"/"+t+"/"+fn(o===void 0&&nt(hn,a)&&!("flags"in hn)?I_(a):o)},{unsafe:!0});var tm=Qt("species"),Up=RegExp.prototype,Gp=function(a,t,o,e){var n=Qt(a),l=!xe(function(){var E={};return E[n]=function(){return 7},""[a](E)!=7}),h=l&&!xe(function(){var E=!1,M=/a/;return a==="split"&&((M={}).constructor={},M.constructor[tm]=function(){return M},M.flags="",M[n]=/./[n]),M.exec=function(){return E=!0,null},M[n](""),!E});if(!l||!h||o){var _=ve(/./[n]),S=t(n,""[a],function(E,M,w,L,H){var ne=ve(E),ae=M.exec;return ae===Ll||ae===Up.exec?l&&!H?{done:!0,value:_(M,w,L)}:{done:!0,value:ne(w,M,L)}:{done:!1}});lr(String.prototype,a,S[0]),lr(Up,n,S[1])}e&&Hn(Up[n],"sham",!0)},g0=oo.charAt,Pl=function(a,t,o){return t+(o?g0(a,t).length:1)},nm=ee.TypeError,xl=function(a,t){var o=a.exec;if(bt(o)){var e=dt(o,a,t);return e!==null&&Sn(e),e}if(hr(a)==="RegExp")return dt(Ll,a,t);throw nm("RegExp#exec called on incompatible receiver")};Gp("match",function(a,t,o){return[function(e){var n=an(this),l=e==null?void 0:Ir(e,a);return l?dt(l,e,n):new RegExp(e)[a](fn(n))},function(e){var n=Sn(this),l=fn(e),h=o(t,n,l);if(h.done)return h.value;if(!n.global)return xl(n,l);var _=n.unicode;n.lastIndex=0;for(var S,E=[],M=0;(S=xl(n,l))!==null;){var w=fn(S[0]);E[M]=w,w===""&&(n.lastIndex=Pl(l,Ea(n.lastIndex),_)),M++}return M===0?null:E}]});var rm=ee.Date,im=ve(rm.prototype.getTime);sn({target:"Date",stat:!0},{now:function(){return im(new rm)}});var Fp=Qt("unscopables"),Xd=Array.prototype;Xd[Fp]==null&&Yn.f(Xd,Fp,{configurable:!0,value:na(null)});var Eu=function(a){Xd[Fp][a]=!0},om=ml.includes;sn({target:"Array",proto:!0},{includes:function(a){return om(this,a,arguments.length>1?arguments[1]:void 0)}}),Eu("includes");var T_=Qt("match"),am=function(a){var t;return xt(a)&&((t=a[T_])!==void 0?!!t:hr(a)=="RegExp")},M_=ee.TypeError,wa=function(a){if(am(a))throw M_("The method doesn't accept regular expressions");return a},Ac=Qt("match"),R_=function(a){var t=/./;try{"/./"[a](t)}catch{try{return t[Ac]=!1,"/./"[a](t)}catch{}}return!1},xs=ve("".indexOf);sn({target:"String",proto:!0,forced:!R_("includes")},{includes:function(a){return!!~xs(fn(an(this)),fn(wa(a)),arguments.length>1?arguments[1]:void 0)}});var C_=ee.RangeError,b_=ve(function(a){var t=fn(an(this)),o="",e=$a(a);if(e<0||e==1/0)throw C_("Wrong number of repetitions");for(;e>0;(e>>>=1)&&(t+=t))1&e&&(o+=t);return o}),A_=ve("".slice),sm=Math.ceil,Vp=function(a){return function(t,o,e){var n,l,h=fn(an(t)),_=Ea(o),S=h.length,E=e===void 0?" ":fn(e);return _<=S||E==""?h:((l=b_(E,sm((n=_-S)/E.length))).length>n&&(l=A_(l,0,n)),a?h+l:l+h)}},kc={start:Vp(!1),end:Vp(!0)}.start,m0=ee.RangeError,Bp=Math.abs,Da=Date.prototype,cm=Da.toISOString,Ul=ve(Da.getTime),v0=ve(Da.getUTCDate),wc=ve(Da.getUTCFullYear),um=ve(Da.getUTCHours),lm=ve(Da.getUTCMilliseconds),k_=ve(Da.getUTCMinutes),_0=ve(Da.getUTCMonth),y0=ve(Da.getUTCSeconds),dm=xe(function(){return cm.call(new Date(-50000000000001))!="0385-07-25T07:06:39.999Z"})||!xe(function(){cm.call(new Date(NaN))})?function(){if(!isFinite(Ul(this)))throw m0("Invalid time value");var a=wc(this),t=lm(this),o=a<0?"-":a>9999?"+":"";return o+kc(Bp(a),o?6:4,0)+"-"+kc(_0(this)+1,2,0)+"-"+kc(v0(this),2,0)+"T"+kc(um(this),2,0)+":"+kc(k_(this),2,0)+":"+kc(y0(this),2,0)+"."+kc(t,3,0)+"Z"}:cm;sn({target:"Date",proto:!0,forced:Date.prototype.toISOString!==dm},{toISOString:dm});var jp=Function.prototype,w_=jp.apply,Qd=jp.call,Dc=typeof Reflect=="object"&&Reflect.apply||(Fn?Qd.bind(w_):function(){return Qd.apply(w_,arguments)}),hm=Math.floor,Zd=ve("".charAt),D_=ve("".replace),Gl=ve("".slice),pm=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,eh=/\$([$&'`]|\d{1,2})/g,S0=function(a,t,o,e,n,l){var h=o+a.length,_=e.length,S=eh;return n!==void 0&&(n=fr(n),S=pm),D_(l,S,function(E,M){var w;switch(Zd(M,0)){case"$":return"$";case"&":return a;case"`":return Gl(t,0,o);case"'":return Gl(t,h);case"<":w=n[Gl(M,1,-1)];break;default:var L=+M;if(L===0)return E;if(L>_){var H=hm(L/10);return H===0?E:H<=_?e[H-1]===void 0?Zd(M,1):e[H-1]+Zd(M,1):E}w=e[L-1]}return w===void 0?"":w})},Oc=Qt("replace"),I0=Math.max,Fl=Math.min,E0=ve([].concat),Tu=ve([].push),qp=ve("".indexOf),fm=ve("".slice),Vl="a".replace(/./,"$0")==="$0",Mu=!!/./[Oc]&&/./[Oc]("a","$0")==="";Gp("replace",function(a,t,o){var e=Mu?"$":"$0";return[function(n,l){var h=an(this),_=n==null?void 0:Ir(n,Oc);return _?dt(_,n,h,l):dt(t,fn(h),n,l)},function(n,l){var h=Sn(this),_=fn(n);if(typeof l=="string"&&qp(l,e)===-1&&qp(l,"$<")===-1){var S=o(t,h,_,l);if(S.done)return S.value}var E=bt(l);E||(l=fn(l));var M=h.global;if(M){var w=h.unicode;h.lastIndex=0}for(var L=[];;){var H=xl(h,_);if(H===null||(Tu(L,H),!M))break;fn(H[0])===""&&(h.lastIndex=Pl(_,Ea(h.lastIndex),w))}for(var ne,ae="",he=0,ge=0;ge<L.length;ge++){for(var Te=fn((H=L[ge])[0]),Ze=I0(Fl($a(H.index),_.length),0),Ct=[],wt=1;wt<H.length;wt++)Tu(Ct,(ne=H[wt])===void 0?ne:String(ne));var dn=H.groups;if(E){var $t=E0([Te],Ct,Ze,_);dn!==void 0&&Tu($t,dn);var Kn=fn(Dc(l,void 0,$t))}else Kn=S0(Te,_,Ze,Ct,dn,l);Ze>=he&&(ae+=fm(_,he,Ze)+Kn,he=Ze+Te.length)}return ae+fm(_,he)}]},!!xe(function(){var a=/./;return a.exec=function(){var t=[];return t.groups={a:"7"},t},"".replace(a,"$<a>")!=="7"})||!Vl||Mu);var T0=Yn.f,gm=Jr.set,M0=Jr.getterFor("Array Iterator"),Za=qd(Array,"Array",function(a,t){gm(this,{type:"Array Iterator",target:ur(a),index:0,kind:t})},function(){var a=M0(this),t=a.target,o=a.kind,e=a.index++;return!t||e>=t.length?(a.target=void 0,{value:void 0,done:!0}):o=="keys"?{value:e,done:!1}:o=="values"?{value:t[e],done:!1}:{value:[e,t[e]],done:!1}},"values"),Hp=mu.Arguments=mu.Array;if(Eu("keys"),Eu("values"),Eu("entries"),Et&&Hp.name!=="values")try{T0(Hp,"name",{value:"values"})}catch{}var $p=Qt("iterator"),Kp=Qt("toStringTag"),Ru=Za.values,O_=function(a,t){if(a){if(a[$p]!==Ru)try{Hn(a,$p,Ru)}catch{a[$p]=Ru}if(a[Kp]||Hn(a,Kp,t),bl[t]){for(var o in Za)if(a[o]!==Za[o])try{Hn(a,o,Za[o])}catch{a[o]=Za[o]}}}};for(var th in bl)O_(ee[th]&&ee[th].prototype,th);O_(gn,"DOMTokenList");var Bl=Uo("slice"),R0=Qt("species"),nh=ee.Array,C0=Math.max;sn({target:"Array",proto:!0,forced:!Bl},{slice:function(a,t){var o,e,n,l=ur(this),h=xr(l),_=Li(a,h),S=Li(t===void 0?h:t,h);if(fc(l)&&(o=l.constructor,(xd(o)&&(o===nh||fc(o.prototype))||xt(o)&&(o=o[R0])===null)&&(o=void 0),o===nh||o===void 0))return ba(l,_,S);for(e=new(o===void 0?nh:o)(C0(S-_,0)),n=0;_<S;_++,n++)_ in l&&za(e,n,l[_]);return e.length=n,e}});var Wp=ve([].join),b0=qr!=Object,zp=Cl("join",",");sn({target:"Array",proto:!0,forced:b0||!zp},{join:function(a){return Wp(ur(this),a===void 0?",":a)}});var N_=ml.indexOf,mm=ve([].indexOf),L_=!!mm&&1/mm([1],1,-0)<0,A0=Cl("indexOf");sn({target:"Array",proto:!0,forced:L_||!A0},{indexOf:function(a){var t=arguments.length>1?arguments[1]:void 0;return L_?mm(this,a,t)||0:N_(this,a,t)}});var jl=ee.Array,vm=Math.max,zi=function(a,t,o){for(var e=xr(a),n=Li(t,e),l=Li(o===void 0?e:o,e),h=jl(vm(l-n,0)),_=0;n<l;n++,_++)za(h,_,a[n]);return h.length=_,h},P_=cc.f,es=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Nc={f:function(a){return es&&hr(a)=="Window"?function(t){try{return P_(t)}catch{return zi(es)}}(a):P_(ur(a))}},x_=Nc.f,Lc=xe(function(){return!Object.getOwnPropertyNames(1)});sn({target:"Object",stat:!0,forced:Lc},{getOwnPropertyNames:x_});var _m=Ui.find,ym=!0;"find"in[]&&Array(1).find(function(){ym=!1}),sn({target:"Array",proto:!0,forced:ym},{find:function(a){return _m(this,a,arguments.length>1?arguments[1]:void 0)}}),Eu("find");var Yp,Sm=ki.f,Oa=ve("".startsWith),Im=ve("".slice),U_=Math.min,Em=R_("startsWith"),G_=!(Em||(Yp=Sm(String.prototype,"startsWith"),!Yp||Yp.writable));sn({target:"String",proto:!0,forced:!G_&&!Em},{startsWith:function(a){var t=fn(an(this));wa(a);var o=Ea(U_(arguments.length>1?arguments[1]:void 0,t.length)),e=fn(a);return Oa?Oa(t,e,o):Im(t,o,o+e.length)===e}});var rh,Cu,aa,bu,ts=ee.Promise,ns=function(a,t,o){for(var e in t)lr(a,e,t[e],o);return a},Tm=Qt("species"),Au=function(a){var t=_r(a),o=Yn.f;Et&&t&&!t[Tm]&&o(t,Tm,{configurable:!0,get:function(){return this}})},ih=ee.TypeError,ko=function(a,t){if(nt(t,a))return a;throw ih("Incorrect invocation")},ql=ee.TypeError,Us=function(a,t){this.stopped=a,this.result=t},Mm=Us.prototype,ku=function(a,t,o){var e,n,l,h,_,S,E,M=o&&o.that,w=!(!o||!o.AS_ENTRIES),L=!(!o||!o.IS_ITERATOR),H=!(!o||!o.INTERRUPTED),ne=ra(t,M),ae=function(ge){return e&&mc(e,"normal",ge),new Us(!0,ge)},he=function(ge){return w?(Sn(ge),H?ne(ge[0],ge[1],ae):ne(ge[0],ge[1])):H?ne(ge,ae):ne(ge)};if(L)e=a;else{if(!(n=vc(a)))throw ql(ci(a)+" is not iterable");if(kl(n)){for(l=0,h=xr(a);h>l;l++)if((_=he(a[l]))&&nt(Mm,_))return _;return new Us(!1)}e=Po(a,n)}for(S=e.next;!(E=dt(S,e)).done;){try{_=he(E.value)}catch(ge){mc(e,"throw",ge)}if(typeof _=="object"&&_&&nt(Mm,_))return _}return new Us(!1)},k0=ee.TypeError,F_=function(a){if(xd(a))return a;throw k0(ci(a)+" is not a constructor")},oh=Qt("species"),sa=function(a,t){var o,e=Sn(a).constructor;return e===void 0||(o=Sn(e)[oh])==null?t:F_(o)},rs=ee.TypeError,Na=function(a,t){if(a<t)throw rs("Not enough arguments");return a},ah=/(?:ipad|iphone|ipod).*applewebkit/i.test(nn),Gs=hr(ee.process)=="process",Jp=ee.setImmediate,sh=ee.clearImmediate,Xp=ee.process,wu=ee.Dispatch,Rm=ee.Function,ch=ee.MessageChannel,V_=ee.String,Qp=0,Fs={};try{rh=ee.location}catch{}var is=function(a){if(st(Fs,a)){var t=Fs[a];delete Fs[a],t()}},Vs=function(a){return function(){is(a)}},Du=function(a){is(a.data)},Ou=function(a){ee.postMessage(V_(a),rh.protocol+"//"+rh.host)};Jp&&sh||(Jp=function(a){Na(arguments.length,1);var t=bt(a)?a:Rm(a),o=ba(arguments,1);return Fs[++Qp]=function(){Dc(t,void 0,o)},Cu(Qp),Qp},sh=function(a){delete Fs[a]},Gs?Cu=function(a){Xp.nextTick(Vs(a))}:wu&&wu.now?Cu=function(a){wu.now(Vs(a))}:ch&&!ah?(bu=(aa=new ch).port2,aa.port1.onmessage=Du,Cu=ra(bu.postMessage,bu)):ee.addEventListener&&bt(ee.postMessage)&&!ee.importScripts&&rh&&rh.protocol!=="file:"&&!xe(Ou)?(Cu=Ou,ee.addEventListener("message",Du,!1)):Cu="onreadystatechange"in _a("script")?function(a){mp.appendChild(_a("script")).onreadystatechange=function(){mp.removeChild(this),is(a)}}:function(a){setTimeout(Vs(a),0)});var La,Bs,Hl,Pc,uh,Zp,ef,tf,Yi={set:Jp,clear:sh},Cm=/ipad|iphone|ipod/i.test(nn)&&ee.Pebble!==void 0,B_=/web0s(?!.*chrome)/i.test(nn),$l=ki.f,lh=Yi.set,nf=ee.MutationObserver||ee.WebKitMutationObserver,rf=ee.document,bm=ee.process,dh=ee.Promise,Am=$l(ee,"queueMicrotask"),km=Am&&Am.value;km||(La=function(){var a,t;for(Gs&&(a=bm.domain)&&a.exit();Bs;){t=Bs.fn,Bs=Bs.next;try{t()}catch(o){throw Bs?Pc():Hl=void 0,o}}Hl=void 0,a&&a.enter()},ah||Gs||B_||!nf||!rf?!Cm&&dh&&dh.resolve?((ef=dh.resolve(void 0)).constructor=dh,tf=ra(ef.then,ef),Pc=function(){tf(La)}):Gs?Pc=function(){bm.nextTick(La)}:(lh=ra(lh,ee),Pc=function(){lh(La)}):(uh=!0,Zp=rf.createTextNode(""),new nf(La).observe(Zp,{characterData:!0}),Pc=function(){Zp.data=uh=!uh}));var os=km||function(a){var t={fn:a,next:void 0};Hl&&(Hl.next=t),Bs||(Bs=t,Pc()),Hl=t},xc=function(a){var t,o;this.promise=new a(function(e,n){if(t!==void 0||o!==void 0)throw TypeError("Bad Promise constructor");t=e,o=n}),this.resolve=er(t),this.reject=er(o)},hh={f:function(a){return new xc(a)}},wm=function(a,t){if(Sn(a),xt(t)&&t.constructor===a)return t;var o=hh.f(a);return(0,o.resolve)(t),o.promise},Nu=function(a){try{return{error:!1,value:a()}}catch(t){return{error:!0,value:t}}},Dm=function(){this.head=null,this.tail=null};Dm.prototype={add:function(a){var t={item:a,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var a=this.head;if(a)return this.head=a.next,this.tail===a&&(this.tail=null),a.item}};var Fo,Om,j_,Uc,js=Dm,Pa=typeof window=="object",Kl=Yi.set,q_=Qt("species"),ca="Promise",as=Jr.getterFor(ca),Lu=Jr.set,H_=Jr.getterFor(ca),Pu=ts&&ts.prototype,ua=ts,Wl=Pu,zl=ee.TypeError,of=ee.document,qs=ee.process,Hs=hh.f,ph=Hs,w0=!!(of&&of.createEvent&&ee.dispatchEvent),Nm=bt(ee.PromiseRejectionEvent),af=!1,Vo=Ta(ca,function(){var a=wi(ua),t=a!==String(ua);if(!t&&Ge===66)return!0;if(Ge>=51&&/native code/.test(a))return!1;var o=new ua(function(n){n(1)}),e=function(n){n(function(){},function(){})};return(o.constructor={})[q_]=e,!(af=o.then(function(){})instanceof e)||!t&&Pa&&!Nm}),Yl=Vo||!Gd(function(a){ua.all(a).catch(function(){})}),sf=function(a){var t;return!(!xt(a)||!bt(t=a.then))&&t},$_=function(a,t){var o,e,n,l=t.value,h=t.state==1,_=h?a.ok:a.fail,S=a.resolve,E=a.reject,M=a.domain;try{_?(h||(t.rejection===2&&q(t),t.rejection=1),_===!0?o=l:(M&&M.enter(),o=_(l),M&&(M.exit(),n=!0)),o===a.promise?E(zl("Promise-chain cycle")):(e=sf(o))?dt(e,o,S,E):S(o)):E(l)}catch(w){M&&!n&&M.exit(),E(w)}},cf=function(a,t){a.notified||(a.notified=!0,os(function(){for(var o,e=a.reactions;o=e.get();)$_(o,a);a.notified=!1,t&&!a.rejection&&C(a)}))},ss=function(a,t,o){var e,n;w0?((e=of.createEvent("Event")).promise=t,e.reason=o,e.initEvent(a,!1,!0),ee.dispatchEvent(e)):e={promise:t,reason:o},!Nm&&(n=ee["on"+a])?n(e):a==="unhandledrejection"&&function(l,h){var _=ee.console;_&&_.error&&(arguments.length==1?_.error(l):_.error(l,h))}("Unhandled promise rejection",o)},C=function(a){dt(Kl,ee,function(){var t,o=a.facade,e=a.value;if(U(a)&&(t=Nu(function(){Gs?qs.emit("unhandledRejection",e,o):ss("unhandledrejection",o,e)}),a.rejection=Gs||U(a)?2:1,t.error))throw t.value})},U=function(a){return a.rejection!==1&&!a.parent},q=function(a){dt(Kl,ee,function(){var t=a.facade;Gs?qs.emit("rejectionHandled",t):ss("rejectionhandled",t,a.value)})},J=function(a,t,o){return function(e){a(t,e,o)}},ce=function(a,t,o){a.done||(a.done=!0,o&&(a=o),a.value=t,a.state=2,cf(a,!0))},z=function(a,t,o){if(!a.done){a.done=!0,o&&(a=o);try{if(a.facade===t)throw zl("Promise can't be resolved itself");var e=sf(t);e?os(function(){var n={done:!1};try{dt(e,t,J(z,n,a),J(ce,n,a))}catch(l){ce(n,l,a)}}):(a.value=t,a.state=1,cf(a,!1))}catch(n){ce({done:!1},n,a)}}};if(Vo&&(Wl=(ua=function(a){ko(this,Wl),er(a),dt(Fo,this);var t=as(this);try{a(J(z,t),J(ce,t))}catch(o){ce(t,o)}}).prototype,(Fo=function(a){Lu(this,{type:ca,done:!1,notified:!1,parent:!1,reactions:new js,rejection:!1,state:0,value:void 0})}).prototype=ns(Wl,{then:function(a,t){var o=H_(this),e=Hs(sa(this,ua));return o.parent=!0,e.ok=!bt(a)||a,e.fail=bt(t)&&t,e.domain=Gs?qs.domain:void 0,o.state==0?o.reactions.add(e):os(function(){$_(e,o)}),e.promise},catch:function(a){return this.then(void 0,a)}}),Om=function(){var a=new Fo,t=as(a);this.promise=a,this.resolve=J(z,t),this.reject=J(ce,t)},hh.f=Hs=function(a){return a===ua||a===j_?new Om(a):ph(a)},bt(ts)&&Pu!==Object.prototype)){Uc=Pu.then,af||(lr(Pu,"then",function(a,t){var o=this;return new ua(function(e,n){dt(Uc,o,e,n)}).then(a,t)},{unsafe:!0}),lr(Pu,"catch",Wl.catch,{unsafe:!0}));try{delete Pu.constructor}catch{}di&&di(Pu,Wl)}sn({global:!0,wrap:!0,forced:Vo},{Promise:ua}),ia(ua,ca,!1),Au(ca),j_=_r(ca),sn({target:ca,stat:!0,forced:Vo},{reject:function(a){var t=Hs(this);return dt(t.reject,void 0,a),t.promise}}),sn({target:ca,stat:!0,forced:Vo},{resolve:function(a){return wm(this,a)}}),sn({target:ca,stat:!0,forced:Yl},{all:function(a){var t=this,o=Hs(t),e=o.resolve,n=o.reject,l=Nu(function(){var h=er(t.resolve),_=[],S=0,E=1;ku(a,function(M){var w=S++,L=!1;E++,dt(h,t,M).then(function(H){L||(L=!0,_[w]=H,--E||e(_))},n)}),--E||e(_)});return l.error&&n(l.value),o.promise},race:function(a){var t=this,o=Hs(t),e=o.reject,n=Nu(function(){var l=er(t.resolve);ku(a,function(h){dt(l,t,h).then(o.resolve,e)})});return n.error&&e(n.value),o.promise}});var pe=Wd.UNSUPPORTED_Y,ye=Math.min,ue=[].push,be=ve(/./.exec),He=ve(ue),gt=ve("".slice);Gp("split",function(a,t,o){var e;return e="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||".".split(/()()/).length>1||"".split(/.?/).length?function(n,l){var h=fn(an(this)),_=l===void 0?4294967295:l>>>0;if(_===0)return[];if(n===void 0)return[h];if(!am(n))return dt(t,h,n,_);for(var S,E,M,w=[],L=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(n.sticky?"y":""),H=0,ne=new RegExp(n.source,L+"g");(S=dt(Ll,ne,h))&&!((E=ne.lastIndex)>H&&(He(w,gt(h,H,S.index)),S.length>1&&S.index<h.length&&Dc(ue,w,zi(S,1)),M=S[0].length,H=E,w.length>=_));)ne.lastIndex===S.index&&ne.lastIndex++;return H===h.length?!M&&be(ne,"")||He(w,""):He(w,gt(h,H)),w.length>_?zi(w,0,_):w}:"0".split(void 0,0).length?function(n,l){return n===void 0&&l===0?[]:dt(t,this,n,l)}:t,[function(n,l){var h=an(this),_=n==null?void 0:Ir(n,a);return _?dt(_,n,h,l):dt(e,fn(h),n,l)},function(n,l){var h=Sn(this),_=fn(n),S=o(e,h,_,l,e!==t);if(S.done)return S.value;var E=sa(h,RegExp),M=h.unicode,w=(h.ignoreCase?"i":"")+(h.multiline?"m":"")+(h.unicode?"u":"")+(pe?"g":"y"),L=new E(pe?"^(?:"+h.source+")":h,w),H=l===void 0?4294967295:l>>>0;if(H===0)return[];if(_.length===0)return xl(L,_)===null?[_]:[];for(var ne=0,ae=0,he=[];ae<_.length;){L.lastIndex=pe?0:ae;var ge,Te=xl(L,pe?gt(_,ae):_);if(Te===null||(ge=ye(Ea(L.lastIndex+(pe?ae:0)),_.length))===ne)ae=Pl(_,ae,M);else{if(He(he,gt(_,ne,ae)),he.length===H)return he;for(var Ze=1;Ze<=Te.length-1;Ze++)if(He(he,Te[Ze]),he.length===H)return he;ae=ne=ge}}return He(he,gt(_,ne)),he}]},!!xe(function(){var a=/(?:)/,t=a.exec;a.exec=function(){return t.apply(this,arguments)};var o="ab".split(a);return o.length!==2||o[0]!=="a"||o[1]!=="b"}),pe);var mt=oo.codeAt;sn({target:"String",proto:!0},{codePointAt:function(a){return mt(this,a)}});var ot=li.trim,Zt=ve("".charAt),In=ee.parseFloat,un=ee.Symbol,zt=un&&un.iterator,en=1/In(hc+"-0")!=-1/0||zt&&!xe(function(){In(Object(zt))})?function(a){var t=ot(fn(a)),o=In(t);return o===0&&Zt(t,0)=="-"?-0:o}:In;sn({global:!0,forced:parseFloat!=en},{parseFloat:en});var Pn=function(){function a(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;A(this,a),this.high=t,this.low=o}return x(a,[{key:"equal",value:function(t){return t!==null&&this.low===t.low&&this.high===t.high}},{key:"toString",value:function(){var t=Number(this.high).toString(16),o=Number(this.low).toString(16);if(o.length<8)for(var e=8-o.length;e;)o="0"+o,e--;return t+o}}]),a}(),cr={TEST:{CHINA:{DEFAULT:"wss://wss-dev.tim.qq.com"},OVERSEA:{DEFAULT:"wss://wss-dev.tim.qq.com"},SINGAPORE:{DEFAULT:"wss://wsssgp-dev.im.qcloud.com"},KOREA:{DEFAULT:"wss://wsskr-dev.im.qcloud.com"},GERMANY:{DEFAULT:"wss://wssger-dev.im.qcloud.com"},IND:{DEFAULT:"wss://wssind-dev.im.qcloud.com"}},PRODUCTION:{CHINA:{DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.tim.qq.com",STAT:"https://api.im.qcloud.com"},OVERSEA:{DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.my-imcloud.com",STAT:"https://api.my-imcloud.com"},SINGAPORE:{DEFAULT:"wss://wsssgp.im.qcloud.com",BACKUP:"wss://wsssgp.my-imcloud.com",STAT:"https://apisgp.my-imcloud.com"},KOREA:{DEFAULT:"wss://wsskr.im.qcloud.com",BACKUP:"wss://wsskr.my-imcloud.com",STAT:"https://apikr.my-imcloud.com"},GERMANY:{DEFAULT:"wss://wssger.im.qcloud.com",BACKUP:"wss://wssger.my-imcloud.com",STAT:"https://apiger.my-imcloud.com"},IND:{DEFAULT:"wss://wssind.im.qcloud.com",BACKUP:"wss://wssind.my-imcloud.com",STAT:"https://apiind.my-imcloud.com"}}},ao={WEB:7,WX_MP:8,QQ_MP:9,TT_MP:10,BAIDU_MP:11,ALI_MP:12,UNI_NATIVE_APP:15},Fi="1.7.3",so=537048168,Jn="CHINA",Bn="OVERSEA",Hr="SINGAPORE",ei="KOREA",_t="GERMANY",Rt="IND",me={HOST:{CURRENT:{DEFAULT:"wss://wss.im.qcloud.com",STAT:"https://api.im.qcloud.com"},setCurrent:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Jn;this.CURRENT=cr.PRODUCTION[a]}},NAME:{OPEN_IM:"openim",GROUP:"group_open_http_svc",GROUP_COMMUNITY:"million_group_open_http_svc",GROUP_ATTR:"group_open_attr_http_svc",FRIEND:"sns",PROFILE:"profile",RECENT_CONTACT:"recentcontact",PIC:"openpic",BIG_GROUP_NO_AUTH:"group_open_http_noauth_svc",BIG_GROUP_LONG_POLLING:"group_open_long_polling_http_svc",BIG_GROUP_LONG_POLLING_NO_AUTH:"group_open_long_polling_http_noauth_svc",IM_OPEN_STAT:"imopenstat",WEB_IM:"webim",IM_COS_SIGN:"im_cos_sign_svr",CUSTOM_UPLOAD:"im_cos_msg",HEARTBEAT:"heartbeat",IM_OPEN_PUSH:"im_open_push",IM_OPEN_STATUS:"im_open_status",IM_LONG_MESSAGE:"im_long_msg",IM_CONFIG_MANAGER:"im_sdk_config_mgr",STAT_SERVICE:"StatSvc",OVERLOAD_PUSH:"OverLoadPush"},CMD:{ACCESS_LAYER:"accesslayer",LOGIN:"wslogin",LOGOUT_LONG_POLL:"longpollinglogout",LOGOUT:"wslogout",HELLO:"wshello",PORTRAIT_GET:"portrait_get_all",PORTRAIT_SET:"portrait_set",GET_LONG_POLL_ID:"getlongpollingid",LONG_POLL:"longpolling",AVCHATROOM_LONG_POLL:"get_msg",ADD_FRIEND:"friend_add",UPDATE_FRIEND:"friend_update",GET_FRIEND_LIST:"friend_get",GET_FRIEND_PROFILE:"friend_get_list",DELETE_FRIEND:"friend_delete",CHECK_FRIEND:"friend_check",GET_FRIEND_GROUP_LIST:"group_get",RESPOND_FRIEND_APPLICATION:"friend_response",GET_FRIEND_APPLICATION_LIST:"pendency_get",DELETE_FRIEND_APPLICATION:"pendency_delete",REPORT_FRIEND_APPLICATION:"pendency_report",GET_GROUP_APPLICATION:"get_pendency",CREATE_FRIEND_GROUP:"group_add",DELETE_FRIEND_GROUP:"group_delete",UPDATE_FRIEND_GROUP:"group_update",GET_BLACKLIST:"black_list_get",ADD_BLACKLIST:"black_list_add",DELETE_BLACKLIST:"black_list_delete",CREATE_GROUP:"create_group",GET_JOINED_GROUPS:"get_joined_group_list",SET_GROUP_ATTRIBUTES:"set_group_attr",MODIFY_GROUP_ATTRIBUTES:"modify_group_attr",DELETE_GROUP_ATTRIBUTES:"delete_group_attr",CLEAR_GROUP_ATTRIBUTES:"clear_group_attr",GET_GROUP_ATTRIBUTES:"get_group_attr",SEND_MESSAGE:"sendmsg",REVOKE_C2C_MESSAGE:"msgwithdraw",DELETE_C2C_MESSAGE:"delete_c2c_msg_ramble",MODIFY_C2C_MESSAGE:"modify_c2c_msg",SEND_GROUP_MESSAGE:"send_group_msg",REVOKE_GROUP_MESSAGE:"group_msg_recall",DELETE_GROUP_MESSAGE:"delete_group_ramble_msg_by_seq",MODIFY_GROUP_MESSAGE:"modify_group_msg",GET_GROUP_INFO:"get_group_self_member_info",GET_GROUP_MEMBER_INFO:"get_specified_group_member_info",GET_GROUP_MEMBER_LIST:"get_group_member_info",QUIT_GROUP:"quit_group",CHANGE_GROUP_OWNER:"change_group_owner",DESTROY_GROUP:"destroy_group",ADD_GROUP_MEMBER:"add_group_member",DELETE_GROUP_MEMBER:"delete_group_member",SEARCH_GROUP_BY_ID:"get_group_public_info",APPLY_JOIN_GROUP:"apply_join_group",HANDLE_APPLY_JOIN_GROUP:"handle_apply_join_group",HANDLE_GROUP_INVITATION:"handle_invite_join_group",MODIFY_GROUP_INFO:"modify_group_base_info",MODIFY_GROUP_MEMBER_INFO:"modify_group_member_info",DELETE_GROUP_SYSTEM_MESSAGE:"deletemsg",DELETE_GROUP_AT_TIPS:"deletemsg",GET_CONVERSATION_LIST:"get",PAGING_GET_CONVERSATION_LIST:"page_get",DELETE_CONVERSATION:"delete",PIN_CONVERSATION:"top",GET_MESSAGES:"getmsg",GET_C2C_ROAM_MESSAGES:"getroammsg",SET_C2C_PEER_MUTE_NOTIFICATIONS:"set_c2c_peer_mute_notifications",GET_C2C_PEER_MUTE_NOTIFICATIONS:"get_c2c_peer_mute_notifications",GET_GROUP_ROAM_MESSAGES:"group_msg_get",GET_READ_RECEIPT:"get_group_msg_receipt",GET_READ_RECEIPT_DETAIL:"get_group_msg_receipt_detail",SEND_READ_RECEIPT:"group_msg_receipt",SEND_C2C_READ_RECEIPT:"c2c_msg_read_receipt",SET_C2C_MESSAGE_READ:"msgreaded",GET_PEER_READ_TIME:"get_peer_read_time",SET_GROUP_MESSAGE_READ:"msg_read_report",FILE_READ_AND_WRITE_AUTHKEY:"authkey",FILE_UPLOAD:"pic_up",COS_SIGN:"cos",COS_PRE_SIG:"pre_sig",VIDEO_COVER:"video_cover",TIM_WEB_REPORT_V2:"tim_web_report_v2",BIG_DATA_HALLWAY_AUTH_KEY:"authkey",GET_ONLINE_MEMBER_NUM:"get_online_member_num",ALIVE:"alive",MESSAGE_PUSH:"msg_push",MULTI_MESSAGE_PUSH:"multi_msg_push_ws",MESSAGE_PUSH_ACK:"ws_msg_push_ack",STATUS_FORCE_OFFLINE:"stat_forceoffline",DOWNLOAD_MERGER_MESSAGE:"get_relay_json_msg",UPLOAD_MERGER_MESSAGE:"save_relay_json_msg",FETCH_CLOUD_CONTROL_CONFIG:"fetch_config",PUSHED_CLOUD_CONTROL_CONFIG:"push_configv2",FETCH_COMMERCIAL_CONFIG:"fetch_imsdk_purchase_bitsv2",PUSHED_COMMERCIAL_CONFIG:"push_imsdk_purchase_bitsv2",KICK_OTHER:"KickOther",OVERLOAD_NOTIFY:"notify2",SET_ALL_MESSAGE_READ:"read_all_unread_msg",CREATE_TOPIC:"create_topic",DELETE_TOPIC:"destroy_topic",UPDATE_TOPIC_PROFILE:"modify_topic",GET_TOPIC_LIST:"get_topic",SET_SELF_STATUS:"ws_set_custom_status",GET_USER_STATUS:"ws_get_user_status",SUBSCRIBE_USER_STATUS:"ws_status_subscribe",UNSUBSCRIBE_USER_STATUS:"ws_status_unsubscribe"},CHANNEL:{SOCKET:1,XHR:2,AUTO:0},NAME_VERSION:{openim:"v4",group_open_http_svc:"v4",sns:"v4",profile:"v4",recentcontact:"v4",openpic:"v4",group_open_http_noauth_svc:"v4",group_open_long_polling_http_svc:"v4",group_open_long_polling_http_noauth_svc:"v4",imopenstat:"v4",im_cos_sign_svr:"v4",im_cos_msg:"v4",webim:"v4",im_open_push:"v4",im_open_status:"v4"}},Nn={SEARCH_MSG:new Pn(0,Math.pow(2,0)).toString(),SEARCH_GRP_SNS:new Pn(0,Math.pow(2,1)).toString(),AVCHATROOM_HISTORY_MSG:new Pn(0,Math.pow(2,2)).toString(),GRP_COMMUNITY:new Pn(0,Math.pow(2,3)).toString(),MSG_TO_SPECIFIED_GRP_MBR:new Pn(0,Math.pow(2,4)).toString(),USER_STATUS:new Pn(0,Math.pow(2,7)).toString()};me.HOST.setCurrent(Jn);var At,Wn=typeof wx<"u"&&typeof wx.getSystemInfoSync=="function"&&Boolean(wx.getSystemInfoSync().fontSizeSetting),$r=typeof qq<"u"&&typeof qq.getSystemInfoSync=="function"&&Boolean(qq.getSystemInfoSync().fontSizeSetting),Di=typeof tt<"u"&&typeof tt.getSystemInfoSync=="function"&&Boolean(tt.getSystemInfoSync().fontSizeSetting),Kr=typeof swan<"u"&&typeof swan.getSystemInfoSync=="function"&&Boolean(swan.getSystemInfoSync().fontSizeSetting),Xt=typeof my<"u"&&typeof my.getSystemInfoSync=="function"&&Boolean(my.getSystemInfoSync().fontSizeSetting),tr=typeof uni<"u"&&typeof window>"u",Oi=typeof uni<"u",tn=Wn||$r||Di||Kr||Xt||tr,Xn=(typeof uni<"u"||typeof window<"u")&&!tn,Rn=$r?qq:Di?tt:Kr?swan:Xt?my:Wn?wx:tr?uni:{},co=(At="WEB",N0?At="WEB":$r?At="QQ_MP":Di?At="TT_MP":Kr?At="BAIDU_MP":Xt?At="ALI_MP":Wn?At="WX_MP":tr&&(At="UNI_NATIVE_APP"),ao[At]),$n=Xn&&window&&window.navigator&&window.navigator.userAgent||"",fh=/AppleWebKit\/([\d.]+)/i.exec($n),AT=(fh&&parseFloat(fh.pop()),/iPad/i.test($n)),D0=/iPhone/i.test($n)&&!AT,Lm=/iPod/i.test($n),K_=D0||AT||Lm,O0=function(){var a=$n.match(/OS (\d+)_/i);return a&&a[1]?a[1]:null}(),W_=/Android/i.test($n),kT=function(){var a=$n.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!a)return null;var t=a[1]&&parseFloat(a[1]),o=a[2]&&parseFloat(a[2]);return t&&o?parseFloat(a[1]+"."+a[2]):t||null}(),Pm=(W_&&/webkit/i.test($n),/Firefox/i.test($n),/Edge/i.test($n));!Pm&&/Chrome/i.test($n);var Jl=(function(){var a=$n.match(/Chrome\/(\d+)/);a&&a[1]&&parseFloat(a[1])}(),/MSIE/.test($n)||$n.indexOf("Trident")>-1&&$n.indexOf("rv:11.0")>-1),xm=(/MSIE\s8\.0/.test($n),function(){var a=/MSIE\s(\d+)\.\d/.exec($n),t=a&&parseFloat(a[1]);return!t&&/Trident\/7.0/i.test($n)&&/rv:11.0/.test($n)&&(t=11),t}()),gh=(/Safari/i.test($n),/TBS\/\d+/i.test($n)),N0=(function(){var a=$n.match(/TBS\/(\d+)/i);a&&a[1]&&a[1]}(),!gh&&/MQQBrowser\/\d+/i.test($n),!gh&&/ QQBrowser\/\d+/i.test($n),/(micromessenger|webbrowser)/i.test($n)),L0=/Windows/i.test($n),P0=/MAC OS X/i.test($n),mh=(/MicroMessenger/i.test($n),Xn&&typeof Worker<"u"&&!Jl),wT=W_||K_,DT=xe(function(){if(typeof ArrayBuffer=="function"){var a=new ArrayBuffer(8);Object.isExtensible(a)&&Object.defineProperty(a,"a",{value:8})}}),z_=Object.isExtensible,x0=xe(function(){z_(1)})||DT?function(a){return!!xt(a)&&(!DT||hr(a)!="ArrayBuffer")&&(!z_||z_(a))}:z_,U0=!xe(function(){return Object.isExtensible(Object.preventExtensions({}))}),vh=vt(function(a){var t=Yn.f,o=!1,e=Wi("meta"),n=0,l=function(_){t(_,e,{value:{objectID:"O"+n++,weakData:{}}})},h=a.exports={enable:function(){h.enable=function(){},o=!0;var _=cc.f,S=ve([].splice),E={};E[e]=1,_(E).length&&(cc.f=function(M){for(var w=_(M),L=0,H=w.length;L<H;L++)if(w[L]===e){S(w,L,1);break}return w},sn({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Nc.f}))},fastKey:function(_,S){if(!xt(_))return typeof _=="symbol"?_:(typeof _=="string"?"S":"P")+_;if(!st(_,e)){if(!x0(_))return"F";if(!S)return"E";l(_)}return _[e].objectID},getWeakData:function(_,S){if(!st(_,e)){if(!x0(_))return!0;if(!S)return!1;l(_)}return _[e].weakData},onFreeze:function(_){return U0&&o&&x0(_)&&!st(_,e)&&l(_),_}};ks[e]=!0}),OT=(vh.enable,vh.fastKey,vh.getWeakData,vh.onFreeze,Yn.f),G0=vh.fastKey,Um=Jr.set,Y_=Jr.getterFor;(function(a,t,o){var e=a.indexOf("Map")!==-1,n=a.indexOf("Weak")!==-1,l=e?"set":"add",h=ee[a],_=h&&h.prototype,S=h,E={},M=function(he){var ge=ve(_[he]);lr(_,he,he=="add"?function(Te){return ge(this,Te===0?0:Te),this}:he=="delete"?function(Te){return!(n&&!xt(Te))&&ge(this,Te===0?0:Te)}:he=="get"?function(Te){return n&&!xt(Te)?void 0:ge(this,Te===0?0:Te)}:he=="has"?function(Te){return!(n&&!xt(Te))&&ge(this,Te===0?0:Te)}:function(Te,Ze){return ge(this,Te===0?0:Te,Ze),this})};if(Ta(a,!bt(h)||!(n||_.forEach&&!xe(function(){new h().entries().next()}))))S=o.getConstructor(t,a,e,l),vh.enable();else if(Ta(a,!0)){var w=new S,L=w[l](n?{}:-0,1)!=w,H=xe(function(){w.has(1)}),ne=Gd(function(he){new h(he)}),ae=!n&&xe(function(){for(var he=new h,ge=5;ge--;)he[l](ge,ge);return!he.has(-0)});ne||((S=t(function(he,ge){ko(he,_);var Te=Ps(new h,he,S);return ge!=null&&ku(ge,Te[l],{that:Te,AS_ENTRIES:e}),Te})).prototype=_,_.constructor=S),(H||ae)&&(M("delete"),M("has"),e&&M("get")),(ae||L)&&M(l),n&&_.clear&&delete _.clear}E[a]=S,sn({global:!0,forced:S!=h},E),ia(S,a),n||o.setStrong(S,a,e)})("Map",function(a){return function(){return a(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(a,t,o,e){var n=a(function(E,M){ko(E,l),Um(E,{type:t,index:na(null),first:void 0,last:void 0,size:0}),Et||(E.size=0),M!=null&&ku(M,E[e],{that:E,AS_ENTRIES:o})}),l=n.prototype,h=Y_(t),_=function(E,M,w){var L,H,ne=h(E),ae=S(E,M);return ae?ae.value=w:(ne.last=ae={index:H=G0(M,!0),key:M,value:w,previous:L=ne.last,next:void 0,removed:!1},ne.first||(ne.first=ae),L&&(L.next=ae),Et?ne.size++:E.size++,H!=="F"&&(ne.index[H]=ae)),E},S=function(E,M){var w,L=h(E),H=G0(M);if(H!=="F")return L.index[H];for(w=L.first;w;w=w.next)if(w.key==M)return w};return ns(l,{clear:function(){for(var E=h(this),M=E.index,w=E.first;w;)w.removed=!0,w.previous&&(w.previous=w.previous.next=void 0),delete M[w.index],w=w.next;E.first=E.last=void 0,Et?E.size=0:this.size=0},delete:function(E){var M=h(this),w=S(this,E);if(w){var L=w.next,H=w.previous;delete M.index[w.index],w.removed=!0,H&&(H.next=L),L&&(L.previous=H),M.first==w&&(M.first=L),M.last==w&&(M.last=H),Et?M.size--:this.size--}return!!w},forEach:function(E){for(var M,w=h(this),L=ra(E,arguments.length>1?arguments[1]:void 0);M=M?M.next:w.first;)for(L(M.value,M.key,this);M&&M.removed;)M=M.previous},has:function(E){return!!S(this,E)}}),ns(l,o?{get:function(E){var M=S(this,E);return M&&M.value},set:function(E,M){return _(this,E===0?0:E,M)}}:{add:function(E){return _(this,E=E===0?0:E,E)}}),Et&&OT(l,"size",{get:function(){return h(this).size}}),n},setStrong:function(a,t,o){var e=t+" Iterator",n=Y_(t),l=Y_(e);qd(a,t,function(h,_){Um(this,{type:e,target:h,state:n(h),kind:_,last:void 0})},function(){for(var h=l(this),_=h.kind,S=h.last;S&&S.removed;)S=S.previous;return h.target&&(h.last=S=S?S.next:h.state.first)?_=="keys"?{value:S.key,done:!1}:_=="values"?{value:S.value,done:!1}:{value:[S.key,S.value],done:!1}:(h.target=void 0,{value:void 0,done:!0})},o?"entries":"values",!o,!0),Au(t)}});var J_,Gm,Fm=typeof rc<"u"?rc:typeof self<"u"?self:typeof window<"u"?window:{};J_=typeof console<"u"?console:Fm!==void 0&&Fm.console?Fm.console:typeof window<"u"&&window.console?window.console:{};for(var NT=function(){},X_=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],F0=X_.length;F0--;)Gm=X_[F0],console[Gm]||(J_[Gm]=NT);var $s=J_,Vm=0,Ji=function(){return new Date().getTime()+Vm},LT=function(){Vm=0},PT=function(){return Math.floor(Ji()/1e3)},xu=0,Bm=new Map;function Uu(){var a,t=((a=new Date).setTime(Ji()),a);return"TIM "+t.toLocaleTimeString("en-US",{hour12:!1})+"."+function(o){var e;switch(o.toString().length){case 1:e="00"+o;break;case 2:e="0"+o;break;default:e=o}return e}(t.getMilliseconds())+":"}var V={arguments2String:function(a){var t;if(a.length===1)t=Uu()+a[0];else{t=Uu();for(var o=0,e=a.length;o<e;o++)uf(a[o])?GT(a[o])?t+=Z_(a[o]):t+=JSON.stringify(a[o]):t+=a[o],t+=" "}return t},debug:function(){if(xu<=-1){var a=this.arguments2String(arguments);$s.debug(a)}},log:function(){if(xu<=0){var a=this.arguments2String(arguments);$s.log(a)}},info:function(){if(xu<=1){var a=this.arguments2String(arguments);$s.info(a)}},warn:function(){if(xu<=2){var a=this.arguments2String(arguments);$s.warn(a)}},error:function(){if(xu<=3){var a=this.arguments2String(arguments);$s.error(a)}},time:function(a){Bm.set(a,Fu.now())},timeEnd:function(a){if(Bm.has(a)){var t=Fu.now()-Bm.get(a);return Bm.delete(a),t}return $s.warn("\u672A\u627E\u5230\u5BF9\u5E94label: ".concat(a,", \u8BF7\u5728\u8C03\u7528 logger.timeEnd \u524D\uFF0C\u8C03\u7528 logger.time")),0},setLevel:function(a){a<4&&$s.log(Uu()+"set level from "+xu+" to "+a),xu=a},getLevel:function(){return xu}},Gu={JPG:1,JPEG:1,GIF:2,PNG:3,BMP:4,UNKNOWN:255},Ii={NICK:"Tag_Profile_IM_Nick",GENDER:"Tag_Profile_IM_Gender",BIRTHDAY:"Tag_Profile_IM_BirthDay",LOCATION:"Tag_Profile_IM_Location",SELFSIGNATURE:"Tag_Profile_IM_SelfSignature",ALLOWTYPE:"Tag_Profile_IM_AllowType",LANGUAGE:"Tag_Profile_IM_Language",AVATAR:"Tag_Profile_IM_Image",MESSAGESETTINGS:"Tag_Profile_IM_MsgSettings",ADMINFORBIDTYPE:"Tag_Profile_IM_AdminForbidType",LEVEL:"Tag_Profile_IM_Level",ROLE:"Tag_Profile_IM_Role"},xT={UNKNOWN:"Gender_Type_Unknown",FEMALE:"Gender_Type_Female",MALE:"Gender_Type_Male"},Nb={NONE:"AdminForbid_Type_None",SEND_OUT:"AdminForbid_Type_SendOut"},Lb={NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_ANY:"AllowType_Type_AllowAny",DENY_ANY:"AllowType_Type_DenyAny"},Xl="JoinedSuccess",UT="WaitAdminApproval",_h="@TGS#_",Ql="@TOPIC#_",Q_=["url"],Ks=function(a){return jm(a)==="file"},gr=function(a){return a!==null&&(typeof a=="number"&&!isNaN(a-0)||R(a)==="object"&&a.constructor===Number)},Ln=function(a){return typeof a=="string"},Gc=function(a){return a!==null&&R(a)==="object"},Br=function(a){if(R(a)!=="object"||a===null)return!1;var t=Object.getPrototypeOf(a);if(t===null)return!0;for(var o=t;Object.getPrototypeOf(o)!==null;)o=Object.getPrototypeOf(o);return t===o},Yt=function(a){return typeof Array.isArray=="function"?Array.isArray(a):jm(a)==="array"},Ke=function(a){return a===void 0},uf=function(a){return Yt(a)||Gc(a)},Fc=function(a){return typeof a=="function"},GT=function(a){return a instanceof Error},jm=function(a){return Object.prototype.toString.call(a).match(/^\[object (.*)\]$/)[1].toLowerCase()},V0=function(a){if(typeof a!="string")return!1;var t=a[0];return!/[^a-zA-Z0-9]/.test(t)},qm=0;Date.now||(Date.now=function(){return new Date().getTime()});var Fu={now:function(){qm===0&&(qm=Date.now()-1);var a=Date.now()-qm;return a>4294967295?(qm+=4294967295,Date.now()-qm):a},utc:function(){return Math.round(Date.now()/1e3)}},Bo=function a(t,o,e,n){if(!uf(t)||!uf(o))return 0;for(var l,h=0,_=Object.keys(o),S=0,E=_.length;S<E;S++)if(l=_[S],!(Ke(o[l])||e&&e.includes(l)))if(uf(t[l])&&uf(o[l]))h+=a(t[l],o[l],e,n);else{if(n&&n.includes(o[l]))continue;t[l]!==o[l]&&(t[l]=o[l],h+=1)}return h},Z_=function(a){return JSON.stringify(a,["message","code"])},B0=function(a){if(a.length===0)return 0;for(var t=0,o=0,e=typeof document<"u"&&document.characterSet!==void 0?document.characterSet:"UTF-8";a[t]!==void 0;)o+=a[t++].charCodeAt[t]<=255?1:e===!1?3:2;return o},cs=function(a){var t=a||99999999;return Math.round(Math.random()*t)},j0="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",FT=j0.length,q0=function(a,t){for(var o in a)if(a[o]===t)return!0;return!1},ey={},VT=function(){if(tn||Xn&&typeof window>"u")return"https:";var a=window.location.protocol;return["http:","https:"].indexOf(a)<0&&(a="http:"),a},yh=function(a){return a.indexOf("http://")===-1||a.indexOf("https://")===-1?"https://"+a:a.replace(/https|http/,"https")},H0=function a(t){if(Object.getOwnPropertyNames(t).length===0)return Object.create(null);var o=Array.isArray(t)?[]:Object.create(null),e="";for(var n in t)t[n]!==null?t[n]!==void 0?(e=R(t[n]),["string","number","function","boolean"].indexOf(e)>=0?o[n]=t[n]:o[n]=a(t[n])):o[n]=void 0:o[n]=null;return o};function Hm(a,t){Yt(a)&&Yt(t)?t.forEach(function(o){var e=o.key,n=o.value,l=a.find(function(h){return h.key===e});l?l.value=n:a.push({key:e,value:n})}):V.warn("updateCustomField target \u6216 source \u4E0D\u662F\u6570\u7EC4\uFF0C\u5FFD\u7565\u6B64\u6B21\u66F4\u65B0\u3002")}var $0=function(a){return a===Z.GRP_PUBLIC},Ws=function(a){return a===Z.GRP_AVCHATROOM},vo=function(a){var t=a.type,o=a.groupID;return t===Z.GRP_COMMUNITY||"".concat(o).startsWith(_h)&&!"".concat(o).includes(Ql)},Lt=function(a){return"".concat(a).startsWith(_h)&&"".concat(a).includes(Ql)},$m=function(a){return Ln(a)&&a.slice(0,3)===Z.CONV_C2C},Zl=function(a){return Ln(a)&&a.slice(0,5)===Z.CONV_GROUP},ty=function(a){return Ln(a)&&a===Z.CONV_SYSTEM};function ny(a,t){var o={};return Object.keys(a).forEach(function(e){o[e]=t(a[e],e)}),o}function K0(a){return tn?new Promise(function(t,o){Rn.getImageInfo({src:a,success:function(e){t({width:e.width,height:e.height})},fail:function(){t({width:0,height:0})}})}):Jl&&xm===9?Promise.resolve({width:0,height:0}):new Promise(function(t,o){var e=new Image;e.onload=function(){t({width:this.width,height:this.height}),e=null},e.onerror=function(){t({width:0,height:0}),e=null},e.src=a})}function Sh(){function a(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return"".concat(a()+a()).concat(a()).concat(a()).concat(a()).concat(a()).concat(a()).concat(a())}function ed(){var a="unknown";if(P0&&(a="mac"),L0&&(a="windows"),K_&&(a="ios"),W_&&(a="android"),tn)try{var t=Rn.getSystemInfoSync().platform;t!==void 0&&(a=t)}catch{}return a}function Vc(a,t){a=a.split("."),t=t.split(".");for(var o=Math.max(a.length,t.length);a.length<o;)a.push("0");for(;t.length<o;)t.push("0");for(var e=0;e<o;e++){var n=parseInt(a[e]),l=parseInt(t[e]);if(n>l)return 1;if(n<l)return-1}return 0}function ry(a){var t=a.originUrl,o=t===void 0?void 0:t,e=a.originWidth,n=a.originHeight,l=a.min,h=l===void 0?198:l,_=parseInt(e),S=parseInt(n),E={url:void 0,width:0,height:0};if((_<=S?_:S)<=h)E.url=o,E.width=_,E.height=S;else{S<=_?(E.width=Math.ceil(_*h/S),E.height=h):(E.width=h,E.height=Math.ceil(S*h/_));var M=o&&o.indexOf("?")>-1?"".concat(o,"&"):"".concat(o,"?");E.url="".concat(M,h===198?"imageView2/3/w/198/h/198":"imageView2/3/w/720/h/720")}return Ke(o)?se(E,Q_):E}function Km(a){var t=a[2];a[2]=a[1],a[1]=t;for(var o=0;o<a.length;o++)a[o].setType(o)}function W0(a){var t=a.servcmd;return t.slice(t.indexOf(".")+1)}function xa(a,t){return Math.round(Number(a)*Math.pow(10,t))/Math.pow(10,t)}function z0(a,t){return a.includes(t)}function iy(a,t){return a.includes(t)}function wo(a){return a.split(Ql)[0]}var Ih=function(a,t){if(Ke(t))return"";switch(a){case Z.MSG_TEXT:return t.text;case Z.MSG_IMAGE:return"[\u56FE\u7247]";case Z.MSG_LOCATION:return"[\u4F4D\u7F6E]";case Z.MSG_AUDIO:return"[\u8BED\u97F3]";case Z.MSG_VIDEO:return"[\u89C6\u9891]";case Z.MSG_FILE:return"[\u6587\u4EF6]";case Z.MSG_CUSTOM:return"[\u81EA\u5B9A\u4E49\u6D88\u606F]";case Z.MSG_GRP_TIP:return"[\u7FA4\u63D0\u793A\u6D88\u606F]";case Z.MSG_GRP_SYS_NOTICE:return"[\u7FA4\u7CFB\u7EDF\u901A\u77E5]";case Z.MSG_FACE:return"[\u52A8\u753B\u8868\u60C5]";case Z.MSG_MERGER:return"[\u804A\u5929\u8BB0\u5F55]";default:return""}};function BT(a){return a===Z.MSG_TEXT||a===Z.MSG_CUSTOM||a===Z.MSG_LOCATION||a===Z.MSG_FACE}var Vu=Object.prototype.hasOwnProperty;function Mt(a){if(a==null)return!0;if(typeof a=="boolean")return!1;if(typeof a=="number")return a===0;if(typeof a=="string"||typeof a=="function"||Array.isArray(a))return a.length===0;if(a instanceof Error)return a.message==="";if(Br(a)){for(var t in a)if(Vu.call(a,t))return!1;return!0}return!(jm(a)!=="map"&&!function(o){return jm(o)==="set"}(a)&&!Ks(a))&&a.size===0}function Y0(a,t,o){if(t===void 0)return!0;var e=!0;if(Wg(t).toLowerCase()==="object")Object.keys(t).forEach(function(l){var h=a.length===1?a[0][l]:void 0;e=!!jT(h,t[l],o,l)&&e});else if(Wg(t).toLowerCase()==="array")for(var n=0;n<t.length;n++)e=!!jT(a[n],t[n],o,t[n].name)&&e;if(e)return e;throw new Error("Params validate failed.")}function jT(a,t,o,e){if(t===void 0)return!0;var n=!0;return t.required&&Mt(a)&&($s.error("TIM [".concat(o,'] Missing required params: "').concat(e,'".')),n=!1),Mt(a)||Wg(a).toLowerCase()===t.type.toLowerCase()||($s.error("TIM [".concat(o,'] Invalid params: type check failed for "').concat(e,'".Expected ').concat(t.type,".")),n=!1),t.validator&&!t.validator(a)&&($s.error("TIM [".concat(o,"] Invalid params: custom validator check failed for params.")),n=!1),n}var oy={f:Qt},qT=ee,J0=Yn.f,lf=Ui.forEach,jo=ac("hidden"),ay=Qt("toPrimitive"),Pb=Jr.set,sy=Jr.getterFor("Symbol"),us=Object.prototype,Bc=ee.Symbol,td=Bc&&Bc.prototype,X0=ee.TypeError,cy=ee.QObject,df=_r("JSON","stringify"),HT=ki.f,jc=Yn.f,$T=Nc.f,Q0=dr.f,uy=ve([].push),Bu=ja("symbols"),Eh=ja("op-symbols"),Z0=ja("string-to-symbol-registry"),hf=ja("symbol-to-string-registry"),xb=ja("wks"),pf=!cy||!cy.prototype||!cy.prototype.findChild,eI=Et&&xe(function(){return na(jc({},"a",{get:function(){return jc(this,"a",{value:7}).a}})).a!=7})?function(a,t,o){var e=HT(us,t);e&&delete us[t],jc(a,t,o),e&&a!==us&&jc(us,t,e)}:jc,ff=function(a,t){var o=Bu[a]=na(td);return Pb(o,{type:"Symbol",tag:a,description:t}),Et||(o.description=t),o},ly=function(a,t,o){a===us&&ly(Eh,t,o),Sn(a);var e=Si(t);return Sn(o),st(Bu,e)?(o.enumerable?(st(a,jo)&&a[jo][e]&&(a[jo][e]=!1),o=na(o,{enumerable:Gn(0,!1)})):(st(a,jo)||jc(a,jo,Gn(1,{})),a[jo][e]=!0),eI(a,e,o)):jc(a,e,o)},gf=function(a,t){Sn(a);var o=ur(t),e=no(o).concat(Wm(o));return lf(e,function(n){Et&&!dt(tI,o,n)||ly(a,n,o[n])}),a},tI=function(a){var t=Si(a),o=dt(Q0,this,t);return!(this===us&&st(Bu,t)&&!st(Eh,t))&&(!(o||!st(this,t)||!st(Bu,t)||st(this,jo)&&this[jo][t])||o)},KT=function(a,t){var o=ur(a),e=Si(t);if(o!==us||!st(Bu,e)||st(Eh,e)){var n=HT(o,e);return!n||!st(Bu,e)||st(o,jo)&&o[jo][e]||(n.enumerable=!0),n}},Th=function(a){var t=$T(ur(a)),o=[];return lf(t,function(e){st(Bu,e)||st(ks,e)||uy(o,e)}),o},Wm=function(a){var t=a===us,o=$T(t?Eh:ur(a)),e=[];return lf(o,function(n){!st(Bu,n)||t&&!st(us,n)||uy(e,Bu[n])}),e};if(ct||(td=(Bc=function(){if(nt(td,this))throw X0("Symbol is not a constructor");var a=arguments.length&&arguments[0]!==void 0?fn(arguments[0]):void 0,t=Wi(a),o=function(e){this===us&&dt(o,Eh,e),st(this,jo)&&st(this[jo],t)&&(this[jo][t]=!1),eI(this,t,Gn(1,e))};return Et&&pf&&eI(us,t,{configurable:!0,set:o}),ff(t,a)}).prototype,lr(td,"toString",function(){return sy(this).tag}),lr(Bc,"withoutSetter",function(a){return ff(Wi(a),a)}),dr.f=tI,Yn.f=ly,Zr.f=gf,ki.f=KT,cc.f=Nc.f=Th,ta.f=Wm,oy.f=function(a){return ff(Qt(a),a)},Et&&(jc(td,"description",{configurable:!0,get:function(){return sy(this).description}}),lr(us,"propertyIsEnumerable",tI,{unsafe:!0}))),sn({global:!0,wrap:!0,forced:!ct,sham:!ct},{Symbol:Bc}),lf(no(xb),function(a){(function(t){var o=qT.Symbol||(qT.Symbol={});st(o,t)||J0(o,t,{value:oy.f(t)})})(a)}),sn({target:"Symbol",stat:!0,forced:!ct},{for:function(a){var t=fn(a);if(st(Z0,t))return Z0[t];var o=Bc(t);return Z0[t]=o,hf[o]=t,o},keyFor:function(a){if(!rr(a))throw X0(a+" is not a symbol");if(st(hf,a))return hf[a]},useSetter:function(){pf=!0},useSimple:function(){pf=!1}}),sn({target:"Object",stat:!0,forced:!ct,sham:!Et},{create:function(a,t){return t===void 0?na(a):gf(na(a),t)},defineProperty:ly,defineProperties:gf,getOwnPropertyDescriptor:KT}),sn({target:"Object",stat:!0,forced:!ct},{getOwnPropertyNames:Th,getOwnPropertySymbols:Wm}),sn({target:"Object",stat:!0,forced:xe(function(){ta.f(1)})},{getOwnPropertySymbols:function(a){return ta.f(fr(a))}}),df){var Ub=!ct||xe(function(){var a=Bc();return df([a])!="[null]"||df({a})!="{}"||df(Object(a))!="{}"});sn({target:"JSON",stat:!0,forced:Ub},{stringify:function(a,t,o){var e=ba(arguments),n=t;if((xt(t)||a!==void 0)&&!rr(a))return fc(t)||(t=function(l,h){if(bt(n)&&(h=dt(n,this,l,h)),!rr(h))return h}),e[1]=t,Dc(df,null,e)}})}if(!td[ay]){var zm=td.valueOf;lr(td,ay,function(a){return dt(zm,this)})}ia(Bc,"Symbol"),ks[jo]=!0;var dy=Yn.f,ls=ee.Symbol,Mh=ls&&ls.prototype;if(Et&&bt(ls)&&(!("description"in Mh)||ls().description!==void 0)){var Rh={},qc=function(){var a=arguments.length<1||arguments[0]===void 0?void 0:fn(arguments[0]),t=nt(Mh,this)?new ls(a):a===void 0?ls():ls(a);return a===""&&(Rh[t]=!0),t};fp(qc,ls),qc.prototype=Mh,Mh.constructor=qc;var nI=String(ls("test"))=="Symbol(test)",Ch=ve(Mh.toString),Gb=ve(Mh.valueOf),Fb=/^Symbol\((.*)\)[^)]+$/,ln=ve("".replace),An=ve("".slice);dy(Mh,"description",{configurable:!0,get:function(){var a=Gb(this),t=Ch(a);if(st(Rh,a))return"";var o=nI?An(t,7,-1):ln(t,Fb,"$1");return o===""?void 0:o}}),sn({global:!0,forced:!0},{Symbol:qc})}var Xi={UNSEND:"unSend",SUCCESS:"success",FAIL:"fail"},ju={NOT_START:"notStart",PENDING:"pengding",RESOLVED:"resolved",REJECTED:"rejected"},bh=function(a){return!!a&&(!!($m(a)||Zl(a)||ty(a))||(console.warn("\u975E\u6CD5\u7684\u4F1A\u8BDD ID:".concat(a,"\u3002\u4F1A\u8BDD ID \u7EC4\u6210\u65B9\u5F0F\uFF1AC2C + userID\uFF08\u5355\u804A\uFF09GROUP + groupID\uFF08\u7FA4\u804A\uFF09@TIM#SYSTEM\uFF08\u7CFB\u7EDF\u901A\u77E5\u4F1A\u8BDD\uFF09")),!1))},rI="\u8BF7\u53C2\u8003 https://web.sdk.qcloud.com/im/doc/zh-cn/SDK.html#",Tt=function(a){return a.param?"".concat(a.api," ").concat(a.param," ").concat(a.desc,"\u3002").concat(rI).concat(a.api):"".concat(a.api," ").concat(a.desc,"\u3002").concat(rI).concat(a.api)},Pt={type:"String",required:!0},Mr={type:"Array",required:!0},pi={type:"Object",required:!0},nd={login:{userID:Pt,userSig:Pt},addToBlacklist:{userIDList:Mr},on:[{name:"eventName",type:"String",validator:function(a){return typeof a=="string"&&a.length!==0||(console.warn(Tt({api:"on",param:"eventName",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A String\uFF0C\u4E14\u4E0D\u80FD\u4E3A\u7A7A"})),!1)}},{name:"handler",type:"Function",validator:function(a){return typeof a!="function"?(console.warn(Tt({api:"on",param:"handler",desc:"\u53C2\u6570\u5FC5\u987B\u4E3A Function"})),!1):(a.name===""&&console.warn("on \u63A5\u53E3\u7684 handler \u53C2\u6570\u63A8\u8350\u4F7F\u7528\u5177\u540D\u51FD\u6570\u3002\u5177\u540D\u51FD\u6570\u53EF\u4EE5\u4F7F\u7528 off \u63A5\u53E3\u53D6\u6D88\u8BA2\u9605\uFF0C\u533F\u540D\u51FD\u6570\u65E0\u6CD5\u53D6\u6D88\u8BA2\u9605\u3002"),!0)}}],once:[{name:"eventName",type:"String",validator:function(a){return typeof a=="string"&&a.length!==0||(console.warn(Tt({api:"once",param:"eventName",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A String\uFF0C\u4E14\u4E0D\u80FD\u4E3A\u7A7A"})),!1)}},{name:"handler",type:"Function",validator:function(a){return typeof a!="function"?(console.warn(Tt({api:"once",param:"handler",desc:"\u53C2\u6570\u5FC5\u987B\u4E3A Function"})),!1):(a.name===""&&console.warn("once \u63A5\u53E3\u7684 handler \u53C2\u6570\u63A8\u8350\u4F7F\u7528\u5177\u540D\u51FD\u6570\u3002"),!0)}}],off:[{name:"eventName",type:"String",validator:function(a){return typeof a=="string"&&a.length!==0||(console.warn(Tt({api:"off",param:"eventName",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A String\uFF0C\u4E14\u4E0D\u80FD\u4E3A\u7A7A"})),!1)}},{name:"handler",type:"Function",validator:function(a){return typeof a!="function"?(console.warn(Tt({api:"off",param:"handler",desc:"\u53C2\u6570\u5FC5\u987B\u4E3A Function"})),!1):(a.name===""&&console.warn("off \u63A5\u53E3\u65E0\u6CD5\u4E3A\u533F\u540D\u51FD\u6570\u53D6\u6D88\u76D1\u542C\u4E8B\u4EF6\u3002"),!0)}}],sendMessage:[m({name:"message"},pi)],getMessageList:{conversationID:m(m({},Pt),{},{validator:function(a){return bh(a)}}),nextReqMessageID:{type:"String"},count:{type:"Number",validator:function(a){return!(!Ke(a)&&!/^[1-9][0-9]*$/.test(a))||(console.warn(Tt({api:"getMessageList",param:"count",desc:"\u5FC5\u987B\u4E3A\u6B63\u6574\u6570"})),!1)}}},getMessageListHopping:{conversationID:m(m({},Pt),{},{validator:function(a){return bh(a)}}),sequence:{type:"Number"},time:{type:"Number"},direction:{type:"Number",validator:function(a){return!(!Ke(a)&&a!==0&&a!==1)||(console.warn(Tt({api:"getMessageListHopping",param:"direction",desc:"\u5FC5\u987B\u4F20 0 \u6216 1"})),!1)}},count:{type:"Number",validator:function(a){return!(!Ke(a)&&!/^[1-9][0-9]*$/.test(a))||(console.warn(Tt({api:"getMessageListHopping",param:"count",desc:"\u5FC5\u987B\u4E3A\u6B63\u6574\u6570"})),!1)}}},setMessageRead:{conversationID:m(m({},Pt),{},{validator:function(a){return bh(a)}})},setAllMessageRead:{scope:{type:"String",required:!1,validator:function(a){return!a||[Z.READ_ALL_C2C_MSG,Z.READ_ALL_GROUP_MSG,Z.READ_ALL_MSG].indexOf(a)!==-1||(console.warn(Tt({api:"setAllMessageRead",param:"scope",desc:"\u53D6\u503C\u5FC5\u987B\u4E3A TIM.TYPES.READ_ALL_C2C_MSG, TIM.TYPES.READ_ALL_GROUP_MSG \u6216 TIM.TYPES.READ_ALL_MSG"})),!1)}}},getConversationProfile:[m(m({name:"conversationID"},Pt),{},{validator:function(a){return bh(a)}})],deleteConversation:[m(m({name:"conversationID"},Pt),{},{validator:function(a){return bh(a)}})],pinConversation:{conversationID:m(m({},Pt),{},{validator:function(a){return bh(a)}}),isPinned:m({},{type:"Boolean",required:!0})},getConversationList:[{name:"options",type:"Array",validator:function(a){return!!Ke(a)||a.length!==0||(console.warn(Tt({api:"getConversationList",desc:"\u83B7\u53D6\u6307\u5B9A\u4F1A\u8BDD\u65F6\u4E0D\u80FD\u4F20\u5165\u7A7A\u6570\u7EC4"})),!1)}}],getGroupList:{groupProfileFilter:{type:"Array"}},getGroupProfile:{groupID:Pt,groupCustomFieldFilter:{type:"Array"},memberCustomFieldFilter:{type:"Array"}},getGroupProfileAdvance:{groupIDList:Mr},createGroup:{name:Pt},joinGroup:{groupID:Pt,type:{type:"String"},applyMessage:{type:"String"}},quitGroup:[m({name:"groupID"},Pt)],handleApplication:{message:pi,handleAction:Pt,handleMessage:{type:"String"}},changeGroupOwner:{groupID:Pt,newOwnerID:Pt},updateGroupProfile:{groupID:Pt,muteAllMembers:{type:"Boolean"}},dismissGroup:[m({name:"groupID"},Pt)],searchGroupByID:[m({name:"groupID"},Pt)],initGroupAttributes:{groupID:Pt,groupAttributes:m(m({},pi),{},{validator:function(a){var t=!0;return Object.keys(a).forEach(function(o){if(!Ln(a[o]))return console.warn(Tt({api:"initGroupAttributes",desc:"\u7FA4\u5C5E\u6027 value \u5FC5\u987B\u662F\u5B57\u7B26\u4E32"})),t=!1}),t}})},setGroupAttributes:{groupID:Pt,groupAttributes:m(m({},pi),{},{validator:function(a){var t=!0;return Object.keys(a).forEach(function(o){if(!Ln(a[o]))return console.warn(Tt({api:"setGroupAttributes",desc:"\u7FA4\u5C5E\u6027 value \u5FC5\u987B\u662F\u5B57\u7B26\u4E32"})),t=!1}),t}})},deleteGroupAttributes:{groupID:Pt,keyList:{type:"Array",validator:function(a){if(Ke(a))return console.warn(Tt({api:"deleteGroupAttributes",desc:"\u7F3A\u5C11\u5FC5\u586B\u53C2\u6570\uFF1AkeyList"})),!1;if(!Yt(a))return!1;if(!Mt(a)){var t=!0;return a.forEach(function(o){if(!Ln(o))return console.warn(Tt({api:"deleteGroupAttributes",desc:"\u7FA4\u5C5E\u6027 key \u5FC5\u987B\u662F\u5B57\u7B26\u4E32"})),t=!1}),t}return!0}}},getGroupAttributes:{groupID:Pt,keyList:{type:"Array",validator:function(a){if(Ke(a))return console.warn(Tt({api:"getGroupAttributes",desc:"\u7F3A\u5C11\u5FC5\u586B\u53C2\u6570\uFF1AkeyList"})),!1;if(!Yt(a))return!1;if(!Mt(a)){var t=!0;return a.forEach(function(o){if(!Ln(o))return console.warn(Tt({api:"getGroupAttributes",desc:"\u7FA4\u5C5E\u6027 key \u5FC5\u987B\u662F\u5B57\u7B26\u4E32"})),t=!1}),t}return!0}}},getGroupMemberList:{groupID:Pt,count:{type:"Number"}},getGroupMemberProfile:{groupID:Pt,userIDList:Mr,memberCustomFieldFilter:{type:"Array"}},addGroupMember:{groupID:Pt,userIDList:Mr},setGroupMemberRole:{groupID:Pt,userID:Pt,role:Pt},setGroupMemberMuteTime:{groupID:Pt,userID:Pt,muteTime:{type:"Number",validator:function(a){return a>=0}}},setGroupMemberNameCard:{groupID:Pt,userID:{type:"String"},nameCard:{type:"String",validator:function(a){return Ln(a)?(a.length,!0):(console.warn(Tt({api:"setGroupMemberNameCard",param:"nameCard",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A String"})),!1)}}},setGroupMemberCustomField:{groupID:Pt,userID:{type:"String"},memberCustomField:Mr},deleteGroupMember:{groupID:Pt},createTextMessage:{to:Pt,conversationType:Pt,payload:m(m({},pi),{},{validator:function(a){return Br(a)?Ln(a.text)?a.text.length!==0||(console.warn(Tt({api:"createTextMessage",desc:"\u6D88\u606F\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A"})),!1):(console.warn(Tt({api:"createTextMessage",param:"payload.text",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A String"})),!1):(console.warn(Tt({api:"createTextMessage",param:"payload",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A plain object"})),!1)}})},createTextAtMessage:{to:Pt,conversationType:Pt,payload:m(m({},pi),{},{validator:function(a){return Br(a)?Ln(a.text)?a.text.length===0?(console.warn(Tt({api:"createTextAtMessage",desc:"\u6D88\u606F\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A"})),!1):!(a.atUserList&&!Yt(a.atUserList))||(console.warn(Tt({api:"createTextAtMessage",desc:"payload.atUserList \u7C7B\u578B\u5FC5\u987B\u4E3A\u6570\u7EC4"})),!1):(console.warn(Tt({api:"createTextAtMessage",param:"payload.text",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A String"})),!1):(console.warn(Tt({api:"createTextAtMessage",param:"payload",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A plain object"})),!1)}})},createCustomMessage:{to:Pt,conversationType:Pt,payload:m(m({},pi),{},{validator:function(a){return Br(a)?a.data&&!Ln(a.data)?(console.warn(Tt({api:"createCustomMessage",param:"payload.data",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A String"})),!1):a.description&&!Ln(a.description)?(console.warn(Tt({api:"createCustomMessage",param:"payload.description",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A String"})),!1):!(a.extension&&!Ln(a.extension))||(console.warn(Tt({api:"createCustomMessage",param:"payload.extension",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A String"})),!1):(console.warn(Tt({api:"createCustomMessage",param:"payload",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A plain object"})),!1)}})},createImageMessage:{to:Pt,conversationType:Pt,payload:m(m({},pi),{},{validator:function(a){if(!Br(a))return console.warn(Tt({api:"createImageMessage",param:"payload",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A plain object"})),!1;if(Ke(a.file))return console.warn(Tt({api:"createImageMessage",param:"payload.file",desc:"\u4E0D\u80FD\u4E3A undefined"})),!1;if(Xn){if(!(a.file instanceof HTMLInputElement||Ks(a.file)))return Br(a.file)&&typeof uni<"u"?a.file.tempFilePaths.length!==0&&a.file.tempFiles.length!==0||(console.warn(Tt({api:"createImageMessage",param:"payload.file",desc:"\u60A8\u6CA1\u6709\u9009\u62E9\u6587\u4EF6\uFF0C\u65E0\u6CD5\u53D1\u9001"})),!1):(console.warn(Tt({api:"createImageMessage",param:"payload.file",desc:"\u7C7B\u578B\u5FC5\u987B\u662F HTMLInputElement \u6216 File"})),!1);if(a.file instanceof HTMLInputElement&&a.file.files.length===0)return console.warn(Tt({api:"createImageMessage",param:"payload.file",desc:"\u60A8\u6CA1\u6709\u9009\u62E9\u6587\u4EF6\uFF0C\u65E0\u6CD5\u53D1\u9001"})),!1}return!0},onProgress:{type:"Function",required:!1,validator:function(a){return Ke(a)&&console.warn(Tt({api:"createImageMessage",desc:"\u6CA1\u6709 onProgress \u56DE\u8C03\uFF0C\u60A8\u5C06\u65E0\u6CD5\u83B7\u53D6\u4E0A\u4F20\u8FDB\u5EA6"})),!0}}})},createAudioMessage:{to:Pt,conversationType:Pt,payload:m(m({},pi),{},{validator:function(a){return!!Br(a)||(console.warn(Tt({api:"createAudioMessage",param:"payload",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A plain object"})),!1)}}),onProgress:{type:"Function",required:!1,validator:function(a){return Ke(a)&&console.warn(Tt({api:"createAudioMessage",desc:"\u6CA1\u6709 onProgress \u56DE\u8C03\uFF0C\u60A8\u5C06\u65E0\u6CD5\u83B7\u53D6\u4E0A\u4F20\u8FDB\u5EA6"})),!0}}},createVideoMessage:{to:Pt,conversationType:Pt,payload:m(m({},pi),{},{validator:function(a){if(!Br(a))return console.warn(Tt({api:"createVideoMessage",param:"payload",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A plain object"})),!1;if(Ke(a.file))return console.warn(Tt({api:"createVideoMessage",param:"payload.file",desc:"\u4E0D\u80FD\u4E3A undefined"})),!1;if(Xn){if(!(a.file instanceof HTMLInputElement||Ks(a.file)))return Br(a.file)&&typeof uni<"u"?!!Ks(a.file.tempFile)||(console.warn(Tt({api:"createVideoMessage",param:"payload.file",desc:"\u60A8\u6CA1\u6709\u9009\u62E9\u6587\u4EF6\uFF0C\u65E0\u6CD5\u53D1\u9001"})),!1):(console.warn(Tt({api:"createVideoMessage",param:"payload.file",desc:"\u7C7B\u578B\u5FC5\u987B\u662F HTMLInputElement \u6216 File"})),!1);if(a.file instanceof HTMLInputElement&&a.file.files.length===0)return console.warn(Tt({api:"createVideoMessage",param:"payload.file",desc:"\u60A8\u6CA1\u6709\u9009\u62E9\u6587\u4EF6\uFF0C\u65E0\u6CD5\u53D1\u9001"})),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(a){return Ke(a)&&console.warn(Tt({api:"createVideoMessage",desc:"\u6CA1\u6709 onProgress \u56DE\u8C03\uFF0C\u60A8\u5C06\u65E0\u6CD5\u83B7\u53D6\u4E0A\u4F20\u8FDB\u5EA6"})),!0}}},createFaceMessage:{to:Pt,conversationType:Pt,payload:m(m({},pi),{},{validator:function(a){return Br(a)?gr(a.index)?!!Ln(a.data)||(console.warn(Tt({api:"createFaceMessage",param:"payload.data",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A String"})),!1):(console.warn(Tt({api:"createFaceMessage",param:"payload.index",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A Number"})),!1):(console.warn(Tt({api:"createFaceMessage",param:"payload",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A plain object"})),!1)}})},createFileMessage:{to:Pt,conversationType:Pt,payload:m(m({},pi),{},{validator:function(a){if(!Br(a))return console.warn(Tt({api:"createFileMessage",param:"payload",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A plain object"})),!1;if(Ke(a.file))return console.warn(Tt({api:"createFileMessage",param:"payload.file",desc:"\u4E0D\u80FD\u4E3A undefined"})),!1;if(Xn){if(!(a.file instanceof HTMLInputElement||Ks(a.file)))return Br(a.file)&&typeof uni<"u"?a.file.tempFilePaths.length!==0&&a.file.tempFiles.length!==0||(console.warn(Tt({api:"createFileMessage",param:"payload.file",desc:"\u60A8\u6CA1\u6709\u9009\u62E9\u6587\u4EF6\uFF0C\u65E0\u6CD5\u53D1\u9001"})),!1):(console.warn(Tt({api:"createFileMessage",param:"payload.file",desc:"\u7C7B\u578B\u5FC5\u987B\u662F HTMLInputElement \u6216 File"})),!1);if(a.file instanceof HTMLInputElement&&a.file.files.length===0)return console.warn(Tt({api:"createFileMessage",desc:"\u60A8\u6CA1\u6709\u9009\u62E9\u6587\u4EF6\uFF0C\u65E0\u6CD5\u53D1\u9001"})),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(a){return Ke(a)&&console.warn(Tt({api:"createFileMessage",desc:"\u6CA1\u6709 onProgress \u56DE\u8C03\uFF0C\u60A8\u5C06\u65E0\u6CD5\u83B7\u53D6\u4E0A\u4F20\u8FDB\u5EA6"})),!0}}},createLocationMessage:{to:Pt,conversationType:Pt,payload:m(m({},pi),{},{validator:function(a){return Br(a)?Ln(a.description)?gr(a.longitude)?!!gr(a.latitude)||(console.warn(Tt({api:"createLocationMessage",param:"payload.latitude",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A Number"})),!1):(console.warn(Tt({api:"createLocationMessage",param:"payload.longitude",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A Number"})),!1):(console.warn(Tt({api:"createLocationMessage",param:"payload.description",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A String"})),!1):(console.warn(Tt({api:"createLocationMessage",param:"payload",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A plain object"})),!1)}})},createMergerMessage:{to:Pt,conversationType:Pt,payload:m(m({},pi),{},{validator:function(a){if(Mt(a.messageList))return console.warn(Tt({api:"createMergerMessage",desc:"\u4E0D\u80FD\u4E3A\u7A7A\u6570\u7EC4"})),!1;if(Mt(a.compatibleText))return console.warn(Tt({api:"createMergerMessage",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A String\uFF0C\u4E14\u4E0D\u80FD\u4E3A\u7A7A"})),!1;var t=!1;return a.messageList.forEach(function(o){o.status===Xi.FAIL&&(t=!0)}),!t||(console.warn(Tt({api:"createMergerMessage",desc:"\u4E0D\u652F\u6301\u5408\u5E76\u5DF2\u53D1\u9001\u5931\u8D25\u7684\u6D88\u606F"})),!1)}})},revokeMessage:[m(m({name:"message"},pi),{},{validator:function(a){return Mt(a)?(console.warn(Tt({api:"revokeMessage",desc:"\u8BF7\u4F20\u5165\u6D88\u606F\uFF08Message\uFF09\u5B9E\u4F8B"})),!1):a.conversationType===Z.CONV_SYSTEM?(console.warn(Tt({api:"revokeMessage",desc:"\u4E0D\u80FD\u64A4\u56DE\u7CFB\u7EDF\u4F1A\u8BDD\u6D88\u606F\uFF0C\u53EA\u80FD\u64A4\u56DE\u5355\u804A\u6D88\u606F\u6216\u7FA4\u6D88\u606F"})),!1):a.isRevoked!==!0||(console.warn(Tt({api:"revokeMessage",desc:"\u6D88\u606F\u5DF2\u7ECF\u88AB\u64A4\u56DE\uFF0C\u8BF7\u52FF\u91CD\u590D\u64CD\u4F5C"})),!1)}})],deleteMessage:[m(m({name:"messageList"},Mr),{},{validator:function(a){return!Mt(a)||(console.warn(Tt({api:"deleteMessage",param:"messageList",desc:"\u4E0D\u80FD\u4E3A\u7A7A\u6570\u7EC4"})),!1)}})],modifyMessage:[m(m({name:"message"},pi),{},{validator:function(a){return Mt(a)?(console.warn(Tt({api:"modifyMessage",desc:"\u8BF7\u4F20\u5165\u6D88\u606F\uFF08Message\uFF09\u5B9E\u4F8B"})),!1):a.conversationType===Z.CONV_SYSTEM?(console.warn(Tt({api:"modifyMessage",desc:"\u4E0D\u652F\u6301\u4FEE\u6539\u7CFB\u7EDF\u4F1A\u8BDD\u6D88\u606F\uFF0C\u53EA\u80FD\u4FEE\u6539\u5355\u804A\u6D88\u606F\u6216\u7FA4\u6D88\u606F"})),!1):a._onlineOnlyFlag!==!0||(console.warn(Tt({api:"modifyMessage",desc:"\u4E0D\u652F\u6301\u4FEE\u6539\u5728\u7EBF\u6D88\u606F"})),!1)}})],getUserProfile:{userIDList:{type:"Array",validator:function(a){return Yt(a)?(a.length===0&&console.warn(Tt({api:"getUserProfile",param:"userIDList",desc:"\u4E0D\u80FD\u4E3A\u7A7A\u6570\u7EC4"})),!0):(console.warn(Tt({api:"getUserProfile",param:"userIDList",desc:"\u5FC5\u987B\u4E3A\u6570\u7EC4"})),!1)}}},updateMyProfile:{profileCustomField:{type:"Array",validator:function(a){return!!Ke(a)||!!Yt(a)||(console.warn(Tt({api:"updateMyProfile",param:"profileCustomField",desc:"\u5FC5\u987B\u4E3A\u6570\u7EC4"})),!1)}}},setSelfStatus:{customStatus:{type:"String",validator:function(a){return!!Ln(a)||(console.warn(Tt({api:"setSelfStatus",param:"customStatus",desc:Pt})),!1)}}},getUserStatus:{userIDList:{type:"Array",validator:function(a){return Yt(a)?a.length!==0||(console.warn(Tt({api:"getUserStatus",param:"userIDList",desc:"\u4E0D\u80FD\u4E3A\u7A7A\u6570\u7EC4"})),!1):(console.warn(Tt({api:"getUserStatus",param:"userIDList",desc:"\u5FC5\u987B\u4E3A\u6570\u7EC4"})),!1)}}},subscribeUserStatus:{userIDList:{type:"Array",validator:function(a){return Yt(a)?a.length!==0||(console.warn(Tt({api:"subscribeUserStatus",param:"userIDList",desc:"\u4E0D\u80FD\u4E3A\u7A7A\u6570\u7EC4"})),!1):(console.warn(Tt({api:"subscribeUserStatus",param:"userIDList",desc:"\u5FC5\u987B\u4E3A\u6570\u7EC4"})),!1)}}},unsubscribeUserStatus:{userIDList:{type:"Array",validator:function(a){return!a||!!Yt(a)||(console.warn(Tt({api:"subscribeUserStatus",param:"userIDList",desc:"\u5FC5\u987B\u4E3A\u6570\u7EC4"})),!1)}}},addFriend:{to:Pt,source:{type:"String",required:!0,validator:function(a){return!!a&&(a.startsWith("AddSource_Type_")?!(a.replace("AddSource_Type_","").length>8)||(console.warn(Tt({api:"addFriend",desc:"\u52A0\u597D\u53CB\u6765\u6E90\u5B57\u6BB5\u7684\u5173\u952E\u5B57\u957F\u5EA6\u4E0D\u5F97\u8D85\u8FC78\u5B57\u8282"})),!1):(console.warn(Tt({api:"addFriend",desc:"\u52A0\u597D\u53CB\u6765\u6E90\u5B57\u6BB5\u7684\u524D\u7F00\u5FC5\u987B\u662F\uFF1AAddSource_Type_"})),!1))}},remark:{type:"String",required:!1,validator:function(a){return!(Ln(a)&&a.length>96)||(console.warn(Tt({api:"updateFriend",desc:" \u5907\u6CE8\u957F\u5EA6\u6700\u957F\u4E0D\u5F97\u8D85\u8FC7 96 \u4E2A\u5B57\u8282"})),!1)}}},deleteFriend:{userIDList:Mr},checkFriend:{userIDList:Mr},getFriendProfile:{userIDList:Mr},updateFriend:{userID:Pt,remark:{type:"String",required:!1,validator:function(a){return!(Ln(a)&&a.length>96)||(console.warn(Tt({api:"updateFriend",desc:" \u5907\u6CE8\u957F\u5EA6\u6700\u957F\u4E0D\u5F97\u8D85\u8FC7 96 \u4E2A\u5B57\u8282"})),!1)}},friendCustomField:{type:"Array",required:!1,validator:function(a){if(a){if(!Yt(a))return console.warn(Tt({api:"updateFriend",param:"friendCustomField",desc:"\u5FC5\u987B\u4E3A\u6570\u7EC4"})),!1;var t=!0;return a.forEach(function(o){return Ln(o.key)&&o.key.indexOf("Tag_SNS_Custom")!==-1?Ln(o.value)?o.value.length>8?(console.warn(Tt({api:"updateFriend",desc:"\u597D\u53CB\u81EA\u5B9A\u4E49\u5B57\u6BB5\u7684\u5173\u952E\u5B57\u957F\u5EA6\u4E0D\u5F97\u8D85\u8FC78\u5B57\u8282"})),t=!1):void 0:(console.warn(Tt({api:"updateFriend",desc:"\u7C7B\u578B\u5FC5\u987B\u4E3A String"})),t=!1):(console.warn(Tt({api:"updateFriend",desc:"\u597D\u53CB\u81EA\u5B9A\u4E49\u5B57\u6BB5\u7684\u524D\u7F00\u5FC5\u987B\u662F Tag_SNS_Custom"})),t=!1)}),t}return!0}}},acceptFriendApplication:{userID:Pt},refuseFriendApplication:{userID:Pt},deleteFriendApplication:{userID:Pt},createFriendGroup:{name:Pt},deleteFriendGroup:{name:Pt},addToFriendGroup:{name:Pt,userIDList:Mr},removeFromFriendGroup:{name:Pt,userIDList:Mr},renameFriendGroup:{oldName:Pt,newName:Pt},sendMessageReadReceipt:[{name:"messageList",type:"Array",validator:function(a){return Yt(a)?a.length!==0||(console.warn(Tt({api:"sendMessageReadReceipt",param:"messageList",desc:"\u4E0D\u80FD\u4E3A\u7A7A\u6570\u7EC4"})),!1):(console.warn(Tt({api:"sendMessageReadReceipt",param:"messageList",desc:"\u5FC5\u987B\u4E3A\u6570\u7EC4"})),!1)}}],getMessageReadReceiptList:[{name:"messageList",type:"Array",validator:function(a){return Yt(a)?a.length!==0||(console.warn(Tt({api:"getMessageReadReceiptList",param:"messageList",desc:"\u4E0D\u80FD\u4E3A\u7A7A\u6570\u7EC4"})),!1):(console.warn(Tt({api:"getMessageReadReceiptList",param:"messageList",desc:"\u5FC5\u987B\u4E3A\u6570\u7EC4"})),!1)}}],createTopicInCommunity:{groupID:Pt,topicName:Pt},deleteTopicFromCommunity:{groupID:Pt,topicIDList:{type:"Array",validator:function(a){return!a||!!Yt(a)||(console.warn(Tt({api:"deleteTopicFromCommunity",param:"topicIDList",desc:"\u5FC5\u987B\u4E3A\u6570\u7EC4"})),!1)}}},updateTopicProfile:{groupID:Pt,topicID:Pt},getTopicList:{groupID:Pt,topicIDList:{type:"Array",validator:function(a){return!a||!!Yt(a)||(console.warn(Tt({api:"getTopicList",param:"topicIDList",desc:"\u5FC5\u987B\u4E3A\u6570\u7EC4"})),!1)}}}},Ah={login:"login",logout:"logout",on:"on",once:"once",off:"off",setLogLevel:"setLogLevel",registerPlugin:"registerPlugin",destroy:"destroy",createTextMessage:"createTextMessage",createTextAtMessage:"createTextAtMessage",createImageMessage:"createImageMessage",createAudioMessage:"createAudioMessage",createVideoMessage:"createVideoMessage",createCustomMessage:"createCustomMessage",createFaceMessage:"createFaceMessage",createFileMessage:"createFileMessage",createLocationMessage:"createLocationMessage",createMergerMessage:"createMergerMessage",downloadMergerMessage:"downloadMergerMessage",createForwardMessage:"createForwardMessage",sendMessage:"sendMessage",resendMessage:"resendMessage",revokeMessage:"revokeMessage",deleteMessage:"deleteMessage",modifyMessage:"modifyMessage",sendMessageReadReceipt:"sendMessageReadReceipt",getGroupMessageReadMemberList:"getGroupMessageReadMemberList",getMessageReadReceiptList:"getMessageReadReceiptList",getMessageList:"getMessageList",findMessage:"findMessage",getMessageListHopping:"getMessageListHopping",setMessageRead:"setMessageRead",setAllMessageRead:"setAllMessageRead",getConversationList:"getConversationList",getConversationProfile:"getConversationProfile",deleteConversation:"deleteConversation",pinConversation:"pinConversation",getGroupList:"getGroupList",getGroupProfile:"getGroupProfile",createGroup:"createGroup",joinGroup:"joinGroup",updateGroupProfile:"updateGroupProfile",quitGroup:"quitGroup",dismissGroup:"dismissGroup",changeGroupOwner:"changeGroupOwner",searchGroupByID:"searchGroupByID",setMessageRemindType:"setMessageRemindType",handleGroupApplication:"handleGroupApplication",initGroupAttributes:"initGroupAttributes",setGroupAttributes:"setGroupAttributes",deleteGroupAttributes:"deleteGroupAttributes",getGroupAttributes:"getGroupAttributes",getJoinedCommunityList:"getJoinedCommunityList",createTopicInCommunity:"createTopicInCommunity",deleteTopicFromCommunity:"deleteTopicFromCommunity",updateTopicProfile:"updateTopicProfile",getTopicList:"getTopicList",getGroupMemberProfile:"getGroupMemberProfile",getGroupMemberList:"getGroupMemberList",addGroupMember:"addGroupMember",deleteGroupMember:"deleteGroupMember",setGroupMemberNameCard:"setGroupMemberNameCard",setGroupMemberMuteTime:"setGroupMemberMuteTime",setGroupMemberRole:"setGroupMemberRole",setGroupMemberCustomField:"setGroupMemberCustomField",getGroupOnlineMemberCount:"getGroupOnlineMemberCount",getMyProfile:"getMyProfile",getUserProfile:"getUserProfile",updateMyProfile:"updateMyProfile",setSelfStatus:"setSelfStatus",getUserStatus:"getUserStatus",subscribeUserStatus:"subscribeUserStatus",unsubscribeUserStatus:"unsubscribeUserStatus",getBlacklist:"getBlacklist",addToBlacklist:"addToBlacklist",removeFromBlacklist:"removeFromBlacklist",getFriendList:"getFriendList",addFriend:"addFriend",deleteFriend:"deleteFriend",checkFriend:"checkFriend",updateFriend:"updateFriend",getFriendProfile:"getFriendProfile",getFriendApplicationList:"getFriendApplicationList",refuseFriendApplication:"refuseFriendApplication",deleteFriendApplication:"deleteFriendApplication",acceptFriendApplication:"acceptFriendApplication",setFriendApplicationRead:"setFriendApplicationRead",getFriendGroupList:"getFriendGroupList",createFriendGroup:"createFriendGroup",renameFriendGroup:"renameFriendGroup",deleteFriendGroup:"deleteFriendGroup",addToFriendGroup:"addToFriendGroup",removeFromFriendGroup:"removeFromFriendGroup",callExperimentalAPI:"callExperimentalAPI"},iI=!!ts&&xe(function(){ts.prototype.finally.call({then:function(){}},function(){})});if(sn({target:"Promise",proto:!0,real:!0,forced:iI},{finally:function(a){var t=sa(this,_r("Promise")),o=bt(a);return this.then(o?function(e){return wm(t,a()).then(function(){return e})}:a,o?function(e){return wm(t,a()).then(function(){throw e})}:a)}}),bt(ts)){var mf=_r("Promise").prototype.finally;ts.prototype.finally!==mf&&lr(ts.prototype,"finally",mf,{unsafe:!0})}var oI=/MSIE .\./.test(nn),WT=ee.Function,zT=function(a){return function(t,o){var e=Na(arguments.length,1)>2,n=bt(t)?t:WT(t),l=e?ba(arguments,2):void 0;return a(e?function(){Dc(n,this,l)}:n,o)}};sn({global:!0,bind:!0,forced:oI},{setTimeout:zT(ee.setTimeout),setInterval:zT(ee.setInterval)});var ti=Ui.filter,kh=Uo("filter");sn({target:"Array",proto:!0,forced:!kh},{filter:function(a){return ti(this,a,arguments.length>1?arguments[1]:void 0)}});var zs,qu="sign",fi="message",Ei="user",Vi="c2c",pn="group",ni="sns",gi="groupMember",ri="Topic",Vt="conversation",ir="context",ds="storage",aI="eventStat",wh="netMonitor",Ym="bigDataChannel",YT="upload",sI="plugin",rd="syncUnreadMessage",Ua="session",uo="channel",Hu="message_loss_detection",hy="cloudControl",kr="workerTimer",Ni="pullGroupMessage",Ur="qualityStat",vf="commercialConfig",Ti=function(){function a(t){A(this,a),this._moduleManager=t,this._className=""}return x(a,[{key:"isLoggedIn",value:function(){return this._moduleManager.getModule(ir).isLoggedIn()}},{key:"isOversea",value:function(){return this._moduleManager.getModule(ir).isOversea()}},{key:"isPrivateNetWork",value:function(){return this._moduleManager.getModule(ir).isPrivateNetWork()}},{key:"getMyUserID",value:function(){return this._moduleManager.getModule(ir).getUserID()}},{key:"getMyTinyID",value:function(){return this._moduleManager.getModule(ir).getTinyID()}},{key:"getModule",value:function(t){return this._moduleManager.getModule(t)}},{key:"getPlatform",value:function(){return co}},{key:"getNetworkType",value:function(){return this._moduleManager.getModule(wh).getNetworkType()}},{key:"probeNetwork",value:function(t){return this.isPrivateNetWork()?Promise.resolve([!0,this.getNetworkType()]):this._moduleManager.getModule(wh).probe(t)}},{key:"getCloudConfig",value:function(t){return this._moduleManager.getModule(hy).getCloudConfig(t)}},{key:"emitOuterEvent",value:function(t,o){this._moduleManager.getOuterEmitterInstance().emit(t,o)}},{key:"emitInnerEvent",value:function(t,o){this._moduleManager.getInnerEmitterInstance().emit(t,o)}},{key:"getInnerEmitterInstance",value:function(){return this._moduleManager.getInnerEmitterInstance()}},{key:"generateTjgID",value:function(t){return this._moduleManager.getModule(ir).getTinyID()+"-"+t.random}},{key:"filterModifiedMessage",value:function(t){if(!Mt(t)){var o=t.filter(function(e){return e.isModified===!0});o.length>0&&this.emitOuterEvent(mn.MESSAGE_MODIFIED,o)}}},{key:"filterUnmodifiedMessage",value:function(t){return Mt(t)?[]:t.filter(function(o){return o.isModified===!1})}},{key:"request",value:function(t){return this._moduleManager.getModule(Ua).request(t)}}]),a}(),_o="wslogin",JT="wslogout",Jm="wshello",XT="KickOther",py="getmsg",QT="authkey",fy="sendmsg",cI="send_group_msg",uI="portrait_get_all",ZT="portrait_set",lI="black_list_get",eM="black_list_add",tM="black_list_delete",dI="msgwithdraw",nM="msgreaded",hI="set_c2c_peer_mute_notifications",pI="get_c2c_peer_mute_notifications",gy="getroammsg",fI="get_peer_read_time",gI="delete_c2c_msg_ramble",mI="modify_c2c_msg",vI="page_get",vy="get",_I="delete",yI="top",_f="deletemsg",Xm="get_joined_group_list",SI="get_group_self_member_info",II="create_group",EI="destroy_group",TI="modify_group_base_info",MI="apply_join_group",RI="apply_join_group_noauth",CI="quit_group",bI="get_group_public_info",_y="change_group_owner",yy="handle_apply_join_group",Sy="handle_invite_join_group",AI="group_msg_recall",kI="msg_read_report",Xr="read_all_unread_msg",Wr="group_msg_get",la="get_group_msg_receipt",rM="group_msg_receipt",$u="c2c_msg_read_receipt",Ku="get_group_msg_receipt_detail",id="get_pendency",Iy="deletemsg",wI="get_msg",yf="get_msg_noauth",iM="get_online_member_num",oM="delete_group_ramble_msg_by_seq",aM="modify_group_msg",sM="set_group_attr",cM="modify_group_attr",uM="delete_group_attr",lM="clear_group_attr",Ey="get_group_attr",Ty="get_group_member_info",dM="get_specified_group_member_info",DI="add_group_member",hM="delete_group_member",pM="modify_group_member_info",Dh="cos",My="pre_sig",Ga="video_cover",Wu="tim_web_report_v2",fM="alive",Vb="msg_push",Bb="multi_msg_push_ws",Ry="ws_msg_push_ack",gM="stat_forceoffline",mM="save_relay_json_msg",vM="get_relay_json_msg",OI="fetch_config",jb="push_configv2",NI="fetch_imsdk_purchase_bitsv2",qb="push_imsdk_purchase_bitsv2",Hb="notify2",_M="create_topic",yM="destroy_topic",SM="modify_topic",IM="get_topic",EM="ws_set_custom_status",TM="ws_get_user_status",MM="ws_status_subscribe",RM="ws_status_unsubscribe",We={NO_SDKAPPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USERSIG:2003,NO_TINYID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,REPEAT_LOGIN:2025,COS_UNDETECTED:2040,COS_GET_SIG_FAIL:2041,MESSAGE_SEND_FAIL:2100,MESSAGE_LIST_CONSTRUCTOR_NEED_OPTIONS:2103,MESSAGE_SEND_NEED_MESSAGE_INSTANCE:2105,MESSAGE_SEND_INVALID_CONVERSATION_TYPE:2106,MESSAGE_FILE_IS_EMPTY:2108,MESSAGE_ONPROGRESS_FUNCTION_ERROR:2109,MESSAGE_REVOKE_FAIL:2110,MESSAGE_DELETE_FAIL:2111,MESSAGE_UNREAD_ALL_FAIL:2112,MESSAGE_CONTROL_INFO_FAIL:2113,READ_RECEIPT_MESSAGE_LIST_EMPTY:2114,MESSAGE_SEND_GROUP_WITH_TOPIC_FAIL:2115,CANNOT_DELETE_GROUP_SYSTEM_NOTICE:2116,MESSAGE_IMAGE_SELECT_FILE_FIRST:2251,MESSAGE_IMAGE_TYPES_LIMIT:2252,MESSAGE_IMAGE_SIZE_LIMIT:2253,MESSAGE_AUDIO_UPLOAD_FAIL:2300,MESSAGE_AUDIO_SIZE_LIMIT:2301,MESSAGE_VIDEO_UPLOAD_FAIL:2350,MESSAGE_VIDEO_SIZE_LIMIT:2351,MESSAGE_VIDEO_TYPES_LIMIT:2352,MESSAGE_FILE_UPLOAD_FAIL:2400,MESSAGE_FILE_SELECT_FILE_FIRST:2401,MESSAGE_FILE_SIZE_LIMIT:2402,MESSAGE_FILE_URL_IS_EMPTY:2403,MESSAGE_MERGER_TYPE_INVALID:2450,MESSAGE_MERGER_KEY_INVALID:2451,MESSAGE_MERGER_DOWNLOAD_FAIL:2452,MESSAGE_FORWARD_TYPE_INVALID:2453,MESSAGE_MODIFY_CONFLICT:2480,MESSAGE_MODIFY_DISABLED_IN_AVCHATROOM:2481,CONVERSATION_NOT_FOUND:2500,USER_OR_GROUP_NOT_FOUND:2501,CONVERSATION_UN_RECORDED_TYPE:2502,ILLEGAL_GROUP_TYPE:2600,CANNOT_JOIN_WORK:2601,ILLEGAL_GROUP_ID:2602,CANNOT_CHANGE_OWNER_IN_AVCHATROOM:2620,CANNOT_CHANGE_OWNER_TO_SELF:2621,CANNOT_DISMISS_Work:2622,MEMBER_NOT_IN_GROUP:2623,CANNOT_USE_GRP_ATTR_NOT_AVCHATROOM:2641,CANNOT_USE_GRP_ATTR_AVCHATROOM_UNJOIN:2642,JOIN_GROUP_FAIL:2660,CANNOT_ADD_MEMBER_IN_AVCHATROOM:2661,CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN:2662,CANNOT_KICK_MEMBER_IN_AVCHATROOM:2680,NOT_OWNER:2681,CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM:2682,INVALID_MEMBER_ROLE:2683,CANNOT_SET_SELF_MEMBER_ROLE:2684,CANNOT_MUTE_SELF:2685,NOT_MY_FRIEND:2700,ALREADY_MY_FRIEND:2701,FRIEND_GROUP_EXISTED:2710,FRIEND_GROUP_NOT_EXIST:2711,FRIEND_APPLICATION_NOT_EXIST:2716,UPDATE_PROFILE_INVALID_PARAM:2721,UPDATE_PROFILE_NO_KEY:2722,ADD_BLACKLIST_INVALID_PARAM:2740,DEL_BLACKLIST_INVALID_PARAM:2741,CANNOT_ADD_SELF_TO_BLACKLIST:2742,ADD_FRIEND_INVALID_PARAM:2760,NETWORK_ERROR:2800,NETWORK_TIMEOUT:2801,NETWORK_BASE_OPTIONS_NO_URL:2802,NETWORK_UNDEFINED_SERVER_NAME:2803,NETWORK_PACKAGE_UNDEFINED:2804,NO_NETWORK:2805,CONVERTOR_IRREGULAR_PARAMS:2900,NOTICE_RUNLOOP_UNEXPECTED_CONDITION:2901,NOTICE_RUNLOOP_OFFSET_LOST:2902,UNCAUGHT_ERROR:2903,GET_LONGPOLL_ID_FAILED:2904,INVALID_OPERATION:2905,OVER_FREQUENCY_LIMIT:2996,CANNOT_FIND_PROTOCOL:2997,CANNOT_FIND_MODULE:2998,SDK_IS_NOT_READY:2999,LOGGING_IN:3e3,LOGIN_FAILED:3001,KICKED_OUT_MULT_DEVICE:3002,KICKED_OUT_MULT_ACCOUNT:3003,KICKED_OUT_USERSIG_EXPIRED:3004,LOGGED_OUT:3005,KICKED_OUT_REST_API:3006,ILLEGAL_TOPIC_ID:3021,CANNOT_USE_COMMERCIAL_ABILITY:3122,LONG_POLL_KICK_OUT:91101,MESSAGE_A2KEY_EXPIRED:20002,ACCOUNT_A2KEY_EXPIRED:70001,LONG_POLL_API_PARAM_ERROR:90001,HELLO_ANSWER_KICKED_OUT:1002,OPEN_SERVICE_OVERLOAD_ERROR:60022},at={NO_SDKAPPID:"\u65E0 SDKAppID",NO_ACCOUNT_TYPE:"\u65E0 accountType",NO_IDENTIFIER:"\u65E0 userID",NO_USERSIG:"\u65E0 userSig",NO_TINYID:"\u65E0 tinyID",NO_A2KEY:"\u65E0 a2key",USER_NOT_LOGGED_IN:"\u7528\u6237\u672A\u767B\u5F55",REPEAT_LOGIN:"\u91CD\u590D\u767B\u5F55",COS_UNDETECTED:"\u672A\u68C0\u6D4B\u5230 COS \u4E0A\u4F20\u63D2\u4EF6",COS_GET_SIG_FAIL:"\u83B7\u53D6 COS \u9884\u7B7E\u540D URL \u5931\u8D25",MESSAGE_SEND_FAIL:"\u6D88\u606F\u53D1\u9001\u5931\u8D25",MESSAGE_LIST_CONSTRUCTOR_NEED_OPTIONS:"MessageController.constructor() \u9700\u8981\u53C2\u6570 options",MESSAGE_SEND_NEED_MESSAGE_INSTANCE:"\u9700\u8981 Message \u7684\u5B9E\u4F8B",MESSAGE_SEND_INVALID_CONVERSATION_TYPE:'Message.conversationType \u53EA\u80FD\u4E3A "C2C" \u6216 "GROUP"',MESSAGE_FILE_IS_EMPTY:"\u65E0\u6CD5\u53D1\u9001\u7A7A\u6587\u4EF6",MESSAGE_ONPROGRESS_FUNCTION_ERROR:"\u56DE\u8C03\u51FD\u6570\u8FD0\u884C\u65F6\u9047\u5230\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u63A5\u5165\u4FA7\u4EE3\u7801",MESSAGE_REVOKE_FAIL:"\u6D88\u606F\u64A4\u56DE\u5931\u8D25",MESSAGE_DELETE_FAIL:"\u6D88\u606F\u5220\u9664\u5931\u8D25",MESSAGE_UNREAD_ALL_FAIL:"\u8BBE\u7F6E\u6240\u6709\u672A\u8BFB\u6D88\u606F\u4E3A\u5DF2\u8BFB\u5904\u7406\u5931\u8D25",MESSAGE_CONTROL_INFO_FAIL:"\u793E\u7FA4\u4E0D\u652F\u6301\u6D88\u606F\u53D1\u9001\u63A7\u5236\u9009\u9879",READ_RECEIPT_MESSAGE_LIST_EMPTY:"\u6D88\u606F\u5217\u8868\u4E2D\u6CA1\u6709\u9700\u8981\u53D1\u9001\u5DF2\u8BFB\u56DE\u6267\u7684\u6D88\u606F",MESSAGE_SEND_GROUP_WITH_TOPIC_FAIL:"\u4E0D\u80FD\u5728\u652F\u6301\u8BDD\u9898\u7684\u7FA4\u7EC4\u4E2D\u53D1\u6D88\u606F\uFF0C\u8BF7\u68C0\u67E5\u7FA4\u7EC4 isSupportTopic \u5C5E\u6027",CANNOT_DELETE_GROUP_SYSTEM_NOTICE:"\u4E0D\u652F\u6301\u5220\u9664\u7FA4\u7CFB\u7EDF\u901A\u77E5",MESSAGE_IMAGE_SELECT_FILE_FIRST:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u56FE\u7247",MESSAGE_IMAGE_TYPES_LIMIT:"\u53EA\u5141\u8BB8\u4E0A\u4F20 jpg png jpeg gif bmp image webp \u683C\u5F0F\u7684\u56FE\u7247",MESSAGE_IMAGE_SIZE_LIMIT:"\u56FE\u7247\u5927\u5C0F\u8D85\u8FC720M\uFF0C\u65E0\u6CD5\u53D1\u9001",MESSAGE_AUDIO_UPLOAD_FAIL:"\u8BED\u97F3\u4E0A\u4F20\u5931\u8D25",MESSAGE_AUDIO_SIZE_LIMIT:"\u8BED\u97F3\u5927\u5C0F\u5927\u4E8E20M\uFF0C\u65E0\u6CD5\u53D1\u9001",MESSAGE_VIDEO_UPLOAD_FAIL:"\u89C6\u9891\u4E0A\u4F20\u5931\u8D25",MESSAGE_VIDEO_SIZE_LIMIT:"\u89C6\u9891\u5927\u5C0F\u8D85\u8FC7100M\uFF0C\u65E0\u6CD5\u53D1\u9001",MESSAGE_VIDEO_TYPES_LIMIT:"\u53EA\u5141\u8BB8\u4E0A\u4F20 mp4 \u683C\u5F0F\u7684\u89C6\u9891",MESSAGE_FILE_UPLOAD_FAIL:"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25",MESSAGE_FILE_SELECT_FILE_FIRST:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u6587\u4EF6",MESSAGE_FILE_SIZE_LIMIT:"\u6587\u4EF6\u5927\u5C0F\u8D85\u8FC7100M\uFF0C\u65E0\u6CD5\u53D1\u9001 ",MESSAGE_FILE_URL_IS_EMPTY:"\u7F3A\u5C11\u5FC5\u8981\u7684\u53C2\u6570\u6587\u4EF6 URL",MESSAGE_MERGER_TYPE_INVALID:"\u975E\u5408\u5E76\u6D88\u606F",MESSAGE_MERGER_KEY_INVALID:"\u5408\u5E76\u6D88\u606F\u7684 messageKey \u65E0\u6548",MESSAGE_MERGER_DOWNLOAD_FAIL:"\u4E0B\u8F7D\u5408\u5E76\u6D88\u606F\u5931\u8D25",MESSAGE_FORWARD_TYPE_INVALID:"\u9009\u62E9\u7684\u6D88\u606F\u7C7B\u578B\uFF08\u5982\u7FA4\u63D0\u793A\u6D88\u606F\uFF09\u4E0D\u53EF\u4EE5\u8F6C\u53D1",MESSAGE_MODIFY_CONFLICT:"\u4FEE\u6539\u6D88\u606F\u65F6\u53D1\u751F\u51B2\u7A81",MESSAGE_MODIFY_DISABLED_IN_AVCHATROOM:"\u76F4\u64AD\u7FA4\u4E0D\u652F\u6301\u4FEE\u6539\u6D88\u606F",CONVERSATION_NOT_FOUND:"\u6CA1\u6709\u627E\u5230\u76F8\u5E94\u7684\u4F1A\u8BDD\uFF0C\u8BF7\u68C0\u67E5\u4F20\u5165\u53C2\u6570",USER_OR_GROUP_NOT_FOUND:"\u6CA1\u6709\u627E\u5230\u76F8\u5E94\u7684\u7528\u6237\u6216\u7FA4\u7EC4\uFF0C\u8BF7\u68C0\u67E5\u4F20\u5165\u53C2\u6570",CONVERSATION_UN_RECORDED_TYPE:"\u672A\u8BB0\u5F55\u7684\u4F1A\u8BDD\u7C7B\u578B",ILLEGAL_GROUP_TYPE:"\u975E\u6CD5\u7684\u7FA4\u7C7B\u578B\uFF0C\u8BF7\u68C0\u67E5\u4F20\u5165\u53C2\u6570",CANNOT_JOIN_WORK:"\u4E0D\u80FD\u52A0\u5165 Work \u7C7B\u578B\u7684\u7FA4\u7EC4",ILLEGAL_GROUP_ID:"\u7FA4\u7EC4 ID \u975E\u6CD5\uFF0C\u975E Community \u7C7B\u578B\u7FA4\u7EC4\u4E0D\u80FD\u4EE5 @TGS#_ \u4E3A\u524D\u7F00\uFF0CCommunity \u7C7B\u578B\u7FA4\u7EC4\u5FC5\u987B\u4EE5 @TGS#_ \u4E3A\u524D\u7F00\u4E14\u4E0D\u80FD\u5305\u542B @TOPIC#_ \u5B57\u7B26\u4E32",CANNOT_CHANGE_OWNER_IN_AVCHATROOM:"AVChatRoom \u7C7B\u578B\u7684\u7FA4\u7EC4\u4E0D\u80FD\u8F6C\u8BA9\u7FA4\u4E3B",CANNOT_CHANGE_OWNER_TO_SELF:"\u4E0D\u80FD\u628A\u7FA4\u4E3B\u8F6C\u8BA9\u7ED9\u81EA\u5DF1",CANNOT_DISMISS_WORK:"\u4E0D\u80FD\u89E3\u6563 Work \u7C7B\u578B\u7684\u7FA4\u7EC4",MEMBER_NOT_IN_GROUP:"\u7528\u6237\u4E0D\u5728\u8BE5\u7FA4\u7EC4\u5185",JOIN_GROUP_FAIL:"\u52A0\u7FA4\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u4F20\u5165\u53C2\u6570\u6216\u91CD\u8BD5",CANNOT_ADD_MEMBER_IN_AVCHATROOM:"AVChatRoom \u7C7B\u578B\u7684\u7FA4\u4E0D\u652F\u6301\u9080\u8BF7\u7FA4\u6210\u5458",CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN:"\u975E AVChatRoom \u7C7B\u578B\u7684\u7FA4\u7EC4\u4E0D\u5141\u8BB8\u533F\u540D\u52A0\u7FA4\uFF0C\u8BF7\u5148\u767B\u5F55\u540E\u518D\u52A0\u7FA4",CANNOT_KICK_MEMBER_IN_AVCHATROOM:"\u4E0D\u80FD\u5728 AVChatRoom \u7C7B\u578B\u7684\u7FA4\u7EC4\u8E22\u4EBA",NOT_OWNER:"\u4F60\u4E0D\u662F\u7FA4\u4E3B\uFF0C\u53EA\u6709\u7FA4\u4E3B\u624D\u6709\u6743\u9650\u64CD\u4F5C",CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM:"\u4E0D\u80FD\u5728 Work / AVChatRoom \u7C7B\u578B\u7684\u7FA4\u4E2D\u8BBE\u7F6E\u7FA4\u6210\u5458\u8EAB\u4EFD",INVALID_MEMBER_ROLE:"\u4E0D\u5408\u6CD5\u7684\u7FA4\u6210\u5458\u8EAB\u4EFD\uFF0C\u8BF7\u68C0\u67E5\u4F20\u5165\u53C2\u6570",CANNOT_SET_SELF_MEMBER_ROLE:"\u4E0D\u80FD\u8BBE\u7F6E\u81EA\u5DF1\u7684\u7FA4\u6210\u5458\u8EAB\u4EFD\uFF0C\u8BF7\u68C0\u67E5\u4F20\u5165\u53C2\u6570",CANNOT_MUTE_SELF:"\u4E0D\u80FD\u5C06\u81EA\u5DF1\u7981\u8A00\uFF0C\u8BF7\u68C0\u67E5\u4F20\u5165\u53C2\u6570",NOT_MY_FRIEND:"\u975E\u597D\u53CB\u5173\u7CFB",ALREADY_MY_FRIEND:"\u5DF2\u7ECF\u662F\u597D\u53CB\u5173\u7CFB",FRIEND_GROUP_EXISTED:"\u597D\u53CB\u5206\u7EC4\u5DF2\u5B58\u5728",FRIEND_GROUP_NOT_EXIST:"\u597D\u53CB\u5206\u7EC4\u4E0D\u5B58\u5728",FRIEND_APPLICATION_NOT_EXIST:"\u597D\u53CB\u7533\u8BF7\u4E0D\u5B58\u5728",UPDATE_PROFILE_INVALID_PARAM:"\u4F20\u5165 updateMyProfile \u63A5\u53E3\u7684\u53C2\u6570\u65E0\u6548",UPDATE_PROFILE_NO_KEY:"updateMyProfile \u65E0\u6807\u914D\u8D44\u6599\u5B57\u6BB5\u6216\u81EA\u5B9A\u4E49\u8D44\u6599\u5B57\u6BB5",ADD_BLACKLIST_INVALID_PARAM:"\u4F20\u5165 addToBlacklist \u63A5\u53E3\u7684\u53C2\u6570\u65E0\u6548",DEL_BLACKLIST_INVALID_PARAM:"\u4F20\u5165 removeFromBlacklist \u63A5\u53E3\u7684\u53C2\u6570\u65E0\u6548",CANNOT_ADD_SELF_TO_BLACKLIST:"\u4E0D\u80FD\u62C9\u9ED1\u81EA\u5DF1",ADD_FRIEND_INVALID_PARAM:"\u4F20\u5165 addFriend \u63A5\u53E3\u7684\u53C2\u6570\u65E0\u6548",NETWORK_ERROR:"\u7F51\u7EDC\u9519\u8BEF",NETWORK_TIMEOUT:"\u8BF7\u6C42\u8D85\u65F6",NETWORK_BASE_OPTIONS_NO_URL:"\u7F51\u7EDC\u5C42\u521D\u59CB\u5316\u9519\u8BEF\uFF0C\u7F3A\u5C11 URL \u53C2\u6570",NETWORK_UNDEFINED_SERVER_NAME:"\u6253\u5305\u9519\u8BEF\uFF0C\u672A\u5B9A\u4E49\u7684 serverName",NETWORK_PACKAGE_UNDEFINED:"\u672A\u5B9A\u4E49\u7684 packageConfig",NO_NETWORK:"\u672A\u8FDE\u63A5\u5230\u7F51\u7EDC",CONVERTOR_IRREGULAR_PARAMS:"\u4E0D\u89C4\u8303\u7684\u53C2\u6570\u540D\u79F0",NOTICE_RUNLOOP_UNEXPECTED_CONDITION:"\u610F\u6599\u5916\u7684\u901A\u77E5\u6761\u4EF6",NOTICE_RUNLOOP_OFFSET_LOST:"_syncOffset \u4E22\u5931",GET_LONGPOLL_ID_FAILED:"\u83B7\u53D6 longpolling id \u5931\u8D25",UNCAUGHT_ERROR:"\u672A\u7ECF\u660E\u786E\u5B9A\u4E49\u7684\u9519\u8BEF",INVALID_OPERATION:"\u65E0\u6548\u64CD\u4F5C\uFF0C\u5982\u8C03\u7528\u4E86\u672A\u5B9A\u4E49\u6216\u8005\u672A\u5B9E\u73B0\u7684\u65B9\u6CD5\u7B49",CANNOT_FIND_PROTOCOL:"\u65E0\u6CD5\u627E\u5230\u534F\u8BAE",CANNOT_FIND_MODULE:"\u65E0\u6CD5\u627E\u5230\u6A21\u5757\uFF0C\u8BF7\u53C2\u8003\uFF1Ahttps://web.sdk.qcloud.com/im/doc/zh-cn/tutorial-03-sns.html",SDK_IS_NOT_READY:"\u63A5\u53E3\u9700\u8981 SDK \u5904\u4E8E ready \u72B6\u6001\u540E\u624D\u80FD\u8C03\u7528",LOGGING_IN:"\u7528\u6237\u6B63\u5728\u767B\u5F55\u4E2D",LOGIN_FAILED:"\u7528\u6237\u767B\u5F55\u5931\u8D25",KICKED_OUT_MULT_DEVICE:"\u7528\u6237\u591A\u7EC8\u7AEF\u767B\u5F55\u88AB\u8E22\u51FA",KICKED_OUT_MULT_ACCOUNT:"\u7528\u6237\u591A\u5B9E\u4F8B\u767B\u5F55\u88AB\u8E22\u51FA",KICKED_OUT_USERSIG_EXPIRED:"\u7528\u6237 userSig \u8FC7\u671F\u88AB\u8E22\u51FA",LOGGED_OUT:"\u7528\u6237\u5DF2\u767B\u51FA",KICKED_OUT_REST_API:"\u7528\u6237\u88AB REST API - kick \u63A5\u53E3: https://cloud.tencent.com/document/product/269/3853 \u8E22\u51FA",OVER_FREQUENCY_LIMIT:"\u8D85\u51FA SDK \u9891\u7387\u63A7\u5236",LONG_POLL_KICK_OUT:"\u68C0\u6D4B\u5230\u591A\u4E2A web \u5B9E\u4F8B\u767B\u5F55\uFF0C\u6D88\u606F\u901A\u9053\u4E0B\u7EBF",OPEN_SERVICE_OVERLOAD_ERROR:"\u540E\u53F0\u670D\u52A1\u6B63\u5FD9\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5",MESSAGE_A2KEY_EXPIRED:"\u6D88\u606F\u9519\u8BEF\u7801\uFF1AUserSig \u6216 A2 \u5931\u6548\u3002",ACCOUNT_A2KEY_EXPIRED:"\u5E10\u53F7\u9519\u8BEF\u7801\uFF1AUserSig \u5DF2\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u751F\u6210\u3002\u5EFA\u8BAE UserSig \u6709\u6548\u671F\u8BBE\u7F6E\u4E0D\u5C0F\u4E8E24\u5C0F\u65F6\u3002",LONG_POLL_API_PARAM_ERROR:"longPoll API parameters error",ILLEGAL_TOPIC_ID:"topicID \u975E\u6CD5",CANNOT_USE_COMMERCIAL_ABILITY:"\u5957\u9910\u5305\u4E0D\u652F\u6301\u8BE5\u63A5\u53E3\u7684\u4F7F\u7528\uFF0C\u8BF7\u5347\u7EA7\u5230\u65D7\u8230\u7248\u5957\u9910"},LI="networkRTT",PI="messageE2EDelay",Qm="sendMessageC2C",Zm="sendMessageGroup",ev="sendMessageGroupAV",Oh="sendMessageRichMedia",qo="cosUpload",Sf="messageReceivedGroup",If="messageReceivedGroupAVPush",tv="messageReceivedGroupAVPull",$b=($(zs={},LI,2),$(zs,PI,3),$(zs,Qm,4),$(zs,Zm,5),$(zs,ev,6),$(zs,Oh,7),$(zs,Sf,8),$(zs,If,9),$(zs,tv,10),$(zs,qo,11),zs),Kb={info:4,warning:5,error:6},CM={wifi:1,"2g":2,"3g":3,"4g":4,"5g":5,unknown:6,none:7,online:8},Wb={login:4},ht=function(){function a(t){A(this,a),this.eventType=Wb[t]||0,this.timestamp=0,this.networkType=8,this.code=0,this.message="",this.moreMessage="",this.extension=t,this.costTime=0,this.duplicate=!1,this.level=4,this.uiPlatform=void 0,this._sentFlag=!1,this._startts=Ji()}return x(a,[{key:"updateTimeStamp",value:function(){this.timestamp=Ji()}},{key:"start",value:function(t){return this._startts=t,this}},{key:"end",value:function(){var t=this,o=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(!this._sentFlag){var e=Ji();this.costTime===0&&(this.costTime=e-this._startts),this.setMoreMessage("startts:".concat(this._startts," endts:").concat(e)),o?(this._sentFlag=!0,this._eventStatModule&&this._eventStatModule.pushIn(this)):setTimeout(function(){t._sentFlag=!0,t._eventStatModule&&t._eventStatModule.pushIn(t)},0)}}},{key:"setError",value:function(t,o,e){return t instanceof Error?(this._sentFlag||(this.setNetworkType(e),o?(t.code&&this.setCode(t.code),t.message&&this.setMoreMessage(t.message)):(this.setCode(We.NO_NETWORK),this.setMoreMessage(at.NO_NETWORK)),this.setLevel("error")),this):(V.warn("SSOLogData.setError value not instanceof Error, please check!"),this)}},{key:"setCode",value:function(t){return Ke(t)||this._sentFlag||(t==="ECONNABORTED"&&(this.code=103),gr(t)?this.code=t:V.warn("SSOLogData.setCode value not a number, please check!",t,R(t))),this}},{key:"setMessage",value:function(t){return Ke(t)||this._sentFlag||(gr(t)&&(this.message=t.toString()),Ln(t)&&(this.message=t)),this}},{key:"setCostTime",value:function(t){return this.costTime=t,this}},{key:"setLevel",value:function(t){return Ke(t)||this._sentFlag||(this.level=Kb[t]),this}},{key:"setMoreMessage",value:function(t){return Mt(this.moreMessage)?this.moreMessage="".concat(t):this.moreMessage+=" ".concat(t),this}},{key:"setNetworkType",value:function(t){if(Ke(t))V.warn("SSOLogData.setNetworkType value is undefined, please check!");else{var o=CM[t.toLowerCase()];Ke(o)||(this.networkType=o)}return this}},{key:"getStartTs",value:function(){return this._startts}},{key:"setUIPlatform",value:function(t){this.uiPlatform=t}}],[{key:"bindEventStatModule",value:function(t){a.prototype._eventStatModule=t}}]),a}(),yt={SDK_CONSTRUCT:"sdkConstruct",SDK_READY:"sdkReady",LOGIN:"login",LOGOUT:"logout",KICKED_OUT:"kickedOut",REGISTER_PLUGIN:"registerPlugin",KICK_OTHER:"kickOther",WS_CONNECT:"wsConnect",WS_ON_OPEN:"wsOnOpen",WS_ON_CLOSE:"wsOnClose",WS_ON_ERROR:"wsOnError",NETWORK_CHANGE:"networkChange",GET_COS_AUTH_KEY:"getCosAuthKey",GET_COS_PRE_SIG_URL:"getCosPreSigUrl",GET_SNAPSHOT_INFO:"getSnapshotInfo",UPLOAD:"upload",SEND_MESSAGE:"sendMessage",SEND_MESSAGE_WITH_RECEIPT:"sendMessageWithReceipt",SEND_COMBO_MESSAGE:"sendComboMessage",GET_C2C_ROAMING_MESSAGES:"getC2CRoamingMessages",GET_GROUP_ROAMING_MESSAGES:"getGroupRoamingMessages",GET_C2C_ROAMING_MESSAGES_HOPPING:"getC2CRoamingMessagesHopping",GET_GROUP_ROAMING_MESSAGES_HOPPING:"getGroupRoamingMessagesHopping",GET_READ_RECEIPT:"getReadReceipt",GET_READ_RECEIPT_DETAIL:"getReadReceiptDetail",SEND_READ_RECEIPT:"sendReadReceipt",SEND_C2C_READ_RECEIPT:"sendC2CReadReceipt",REVOKE_MESSAGE:"revokeMessage",DELETE_MESSAGE:"deleteMessage",EDIT_MESSAGE:"modifyMessage",SET_C2C_MESSAGE_READ:"setC2CMessageRead",SET_GROUP_MESSAGE_READ:"setGroupMessageRead",EMPTY_MESSAGE_BODY:"emptyMessageBody",GET_PEER_READ_TIME:"getPeerReadTime",UPLOAD_MERGER_MESSAGE:"uploadMergerMessage",DOWNLOAD_MERGER_MESSAGE:"downloadMergerMessage",JSON_PARSE_ERROR:"jsonParseError",MESSAGE_E2E_DELAY_EXCEPTION:"messageE2EDelayException",GET_CONVERSATION_LIST:"getConversationList",GET_CONVERSATION_PROFILE:"getConversationProfile",DELETE_CONVERSATION:"deleteConversation",PIN_CONVERSATION:"pinConversation",GET_CONVERSATION_LIST_IN_STORAGE:"getConversationListInStorage",SYNC_CONVERSATION_LIST:"syncConversationList",SET_ALL_MESSAGE_READ:"setAllMessageRead",CREATE_GROUP:"createGroup",APPLY_JOIN_GROUP:"applyJoinGroup",QUIT_GROUP:"quitGroup",SEARCH_GROUP_BY_ID:"searchGroupByID",CHANGE_GROUP_OWNER:"changeGroupOwner",HANDLE_GROUP_APPLICATION:"handleGroupApplication",HANDLE_GROUP_INVITATION:"handleGroupInvitation",SET_MESSAGE_REMIND_TYPE:"setMessageRemindType",DISMISS_GROUP:"dismissGroup",UPDATE_GROUP_PROFILE:"updateGroupProfile",GET_GROUP_LIST:"getGroupList",GET_GROUP_PROFILE:"getGroupProfile",GET_GROUP_LIST_IN_STORAGE:"getGroupListInStorage",GET_GROUP_LAST_SEQUENCE:"getGroupLastSequence",GET_GROUP_MISSING_MESSAGE:"getGroupMissingMessage",PAGING_GET_GROUP_LIST:"pagingGetGroupList",PAGING_GET_GROUP_LIST_WITH_TOPIC:"pagingGetGroupListWithTopic",GET_GROUP_SIMPLIFIED_INFO:"getGroupSimplifiedInfo",JOIN_WITHOUT_AUTH:"joinWithoutAuth",INIT_GROUP_ATTRIBUTES:"initGroupAttributes",SET_GROUP_ATTRIBUTES:"setGroupAttributes",DELETE_GROUP_ATTRIBUTES:"deleteGroupAttributes",GET_GROUP_ATTRIBUTES:"getGroupAttributes",GET_GROUP_MEMBER_LIST:"getGroupMemberList",GET_GROUP_MEMBER_PROFILE:"getGroupMemberProfile",ADD_GROUP_MEMBER:"addGroupMember",DELETE_GROUP_MEMBER:"deleteGroupMember",SET_GROUP_MEMBER_MUTE_TIME:"setGroupMemberMuteTime",SET_GROUP_MEMBER_NAME_CARD:"setGroupMemberNameCard",SET_GROUP_MEMBER_ROLE:"setGroupMemberRole",SET_GROUP_MEMBER_CUSTOM_FIELD:"setGroupMemberCustomField",GET_GROUP_ONLINE_MEMBER_COUNT:"getGroupOnlineMemberCount",SYNC_MESSAGE:"syncMessage",LONG_POLLING_AV_ERROR:"longPollingAVError",MESSAGE_LOSS:"messageLoss",MESSAGE_STACKED:"messageStacked",GET_USER_PROFILE:"getUserProfile",UPDATE_MY_PROFILE:"updateMyProfile",GET_BLACKLIST:"getBlacklist",ADD_TO_BLACKLIST:"addToBlacklist",REMOVE_FROM_BLACKLIST:"removeFromBlacklist",SET_SELF_STATUS:"ws_set_custom_status",GET_USER_STATUS:"ws_get_user_status",SUBSCRIBE_USER_STATUS:"ws_status_subscribe",UNSUBSCRIBE_USER_STATUS:"ws_status_unsubscribe",ADD_FRIEND:"addFriend",CHECK_FRIEND:"checkFriend",DELETE_FRIEND:"removeFromFriendList",GET_FRIEND_PROFILE:"getFriendProfile",GET_FRIEND_LIST:"getFriendList",UPDATE_FRIEND:"updateFriend",GET_FRIEND_APPLICATION_LIST:"getFriendApplicationList",DELETE_FRIEND_APPLICATION:"deleteFriendApplication",ACCEPT_FRIEND_APPLICATION:"acceptFriendApplication",REFUSE_FRIEND_APPLICATION:"refuseFriendApplication",SET_FRIEND_APPLICATION_READ:"setFriendApplicationRead",CREATE_FRIEND_GROUP:"createFriendGroup",DELETE_FRIEND_GROUP:"deleteFriendGroup",RENAME_FRIEND_GROUP:"renameFriendGroup",ADD_TO_FRIEND_GROUP:"addToFriendGroup",REMOVE_FROM_FRIEND_GROUP:"removeFromFriendGroup",GET_FRIEND_GROUP_LIST:"getFriendGroupList",CREATE_TOPIC:"createTopic",DELETE_TOPIC:"deleteTopic",UPDATE_TOPIC_PROFILE:"updateTopicProfile",GET_TOPIC_LIST:"getTopicList",RELAY_GET_TOPIC_LIST:"relayGetTopicList",GET_TOPIC_LAST_SEQUENCE:"getTopicLastSequence",MP_HIDE_TO_SHOW:"mpHideToShow",CALLBACK_FUNCTION_ERROR:"callbackFunctionError",FETCH_CLOUD_CONTROL_CONFIG:"fetchCloudControlConfig",PUSHED_CLOUD_CONTROL_CONFIG:"pushedCloudControlConfig",FETCH_COMMERCIAL_CONFIG:"fetchCommercialConfig",PUSHED_COMMERCIAL_CONFIG:"pushedCommercialConfig",ERROR:"error",LAST_MESSAGE_NOT_EXIST:"lastMessageNotExist"},xI=dr.f,zb=ve(xI),Yb=ve([].push),bM=function(a){return function(t){for(var o,e=ur(t),n=no(e),l=n.length,h=0,_=[];l>h;)o=n[h++],Et&&!zb(e,o)||Yb(_,a?[o,e[o]]:e[o]);return _}},Jb={entries:bM(!0),values:bM(!1)}.values;sn({target:"Object",stat:!0},{values:function(a){return Jb(a)}});var UI=function(){function a(t){A(this,a),this.type=Z.MSG_TEXT,this.content={text:t.text||""}}return x(a,[{key:"setText",value:function(t){this.content.text=t}},{key:"sendable",value:function(){return this.content.text.length!==0}}]),a}(),Xb=Qt("iterator"),GI=!xe(function(){var a=new URL("b?a=1&b=2&c=3","http://a"),t=a.searchParams,o="";return a.pathname="c%20d",t.forEach(function(e,n){t.delete("b"),o+=n+e}),!t.sort||a.href!=="http://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[Xb]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://\u0442\u0435\u0441\u0442").host!=="xn--e1aybc"||new URL("http://a#\u0431").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Ef=Object.assign,AM=Object.defineProperty,kM=ve([].concat),Tf=!Ef||xe(function(){if(Et&&Ef({b:1},Ef(AM({},"a",{enumerable:!0,get:function(){AM(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var a={},t={},o=Symbol();return a[o]=7,"abcdefghijklmnopqrst".split("").forEach(function(e){t[e]=e}),Ef({},a)[o]!=7||no(Ef({},t)).join("")!="abcdefghijklmnopqrst"})?function(a,t){for(var o=fr(a),e=arguments.length,n=1,l=ta.f,h=dr.f;e>n;)for(var _,S=qr(arguments[n++]),E=l?kM(no(S),l(S)):no(S),M=E.length,w=0;M>w;)_=E[w++],Et&&!dt(h,S,_)||(o[_]=S[_]);return o}:Ef,Qb=/[^\0-\u007E]/,wM=/[.\u3002\uFF0E\uFF61]/g,DM="Overflow: input needs wider integers to process",OM=ee.RangeError,Zb=ve(wM.exec),Mf=Math.floor,FI=String.fromCharCode,NM=ve("".charCodeAt),LM=ve([].join),od=ve([].push),VI=ve("".replace),eA=ve("".split),tA=ve("".toLowerCase),PM=function(a){return a+22+75*(a<26)},nA=function(a,t,o){var e=0;for(a=o?Mf(a/700):a>>1,a+=Mf(a/t);a>455;)a=Mf(a/35),e+=36;return Mf(e+36*a/(a+38))},xM=function(a){var t,o,e=[],n=(a=function(ge){for(var Te=[],Ze=0,Ct=ge.length;Ze<Ct;){var wt=NM(ge,Ze++);if(wt>=55296&&wt<=56319&&Ze<Ct){var dn=NM(ge,Ze++);(64512&dn)==56320?od(Te,((1023&wt)<<10)+(1023&dn)+65536):(od(Te,wt),Ze--)}else od(Te,wt)}return Te}(a)).length,l=128,h=0,_=72;for(t=0;t<a.length;t++)(o=a[t])<128&&od(e,FI(o));var S=e.length,E=S;for(S&&od(e,"-");E<n;){var M=2147483647;for(t=0;t<a.length;t++)(o=a[t])>=l&&o<M&&(M=o);var w=E+1;if(M-l>Mf((2147483647-h)/w))throw OM(DM);for(h+=(M-l)*w,l=M,t=0;t<a.length;t++){if((o=a[t])<l&&++h>2147483647)throw OM(DM);if(o==l){for(var L=h,H=36;;){var ne=H<=_?1:H>=_+26?26:H-_;if(L<ne)break;var ae=L-ne,he=36-ne;od(e,FI(PM(ne+ae%he))),L=Mf(ae/he),H+=36}od(e,FI(PM(L))),_=nA(h,w,E==S),h=0,E++}}h++,l++}return LM(e,"")},rA=Math.floor,BI=function(a,t){var o=a.length,e=rA(o/2);return o<8?iA(a,t):oA(a,BI(zi(a,0,e),t),BI(zi(a,e),t),t)},iA=function(a,t){for(var o,e,n=a.length,l=1;l<n;){for(e=l,o=a[l];e&&t(a[e-1],o)>0;)a[e]=a[--e];e!==l++&&(a[e]=o)}return a},oA=function(a,t,o,e){for(var n=t.length,l=o.length,h=0,_=0;h<n||_<l;)a[h+_]=h<n&&_<l?e(t[h],o[_])<=0?t[h++]:o[_++]:h<n?t[h++]:o[_++];return a},jI=BI,aA=Qt("iterator"),UM=Jr.set,Ys=Jr.getterFor("URLSearchParams"),sA=Jr.getterFor("URLSearchParamsIterator"),Cy=_r("fetch"),by=_r("Request"),nv=_r("Headers"),qI=by&&by.prototype,GM=nv&&nv.prototype,cA=ee.RegExp,uA=ee.TypeError,FM=ee.decodeURIComponent,lA=ee.encodeURIComponent,dA=ve("".charAt),VM=ve([].join),Nh=ve([].push),HI=ve("".replace),hA=ve([].shift),BM=ve([].splice),jM=ve("".split),pA=ve("".slice),qM=/\+/g,$I=Array(4),fA=function(a){return $I[a-1]||($I[a-1]=cA("((?:%[\\da-f]{2}){"+a+"})","gi"))},HM=function(a){try{return FM(a)}catch{return a}},KI=function(a){var t=HI(a,qM," "),o=4;try{return FM(t)}catch{for(;o;)t=HI(t,fA(o--),HM);return t}},gA=/[!'()~]|%20/g,mA={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},vA=function(a){return mA[a]},$M=function(a){return HI(lA(a),gA,vA)},Ay=Ca(function(a,t){UM(this,{type:"URLSearchParamsIterator",iterator:Po(Ys(a).entries),kind:t})},"Iterator",function(){var a=sA(this),t=a.kind,o=a.iterator.next(),e=o.value;return o.done||(o.value=t==="keys"?e.key:t==="values"?e.value:[e.key,e.value]),o},!0),KM=function(a){this.entries=[],this.url=null,a!==void 0&&(xt(a)?this.parseObject(a):this.parseQuery(typeof a=="string"?dA(a,0)==="?"?pA(a,1):a:fn(a)))};KM.prototype={type:"URLSearchParams",bindURL:function(a){this.url=a,this.update()},parseObject:function(a){var t,o,e,n,l,h,_,S=vc(a);if(S)for(o=(t=Po(a,S)).next;!(e=dt(o,t)).done;){if(l=(n=Po(Sn(e.value))).next,(h=dt(l,n)).done||(_=dt(l,n)).done||!dt(l,n).done)throw uA("Expected sequence with length 2");Nh(this.entries,{key:fn(h.value),value:fn(_.value)})}else for(var E in a)st(a,E)&&Nh(this.entries,{key:E,value:fn(a[E])})},parseQuery:function(a){if(a)for(var t,o,e=jM(a,"&"),n=0;n<e.length;)(t=e[n++]).length&&(o=jM(t,"="),Nh(this.entries,{key:KI(hA(o)),value:KI(VM(o,"="))}))},serialize:function(){for(var a,t=this.entries,o=[],e=0;e<t.length;)a=t[e++],Nh(o,$M(a.key)+"="+$M(a.value));return VM(o,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ky=function(){ko(this,rv);var a=arguments.length>0?arguments[0]:void 0;UM(this,new KM(a))},rv=ky.prototype;if(ns(rv,{append:function(a,t){Na(arguments.length,2);var o=Ys(this);Nh(o.entries,{key:fn(a),value:fn(t)}),o.updateURL()},delete:function(a){Na(arguments.length,1);for(var t=Ys(this),o=t.entries,e=fn(a),n=0;n<o.length;)o[n].key===e?BM(o,n,1):n++;t.updateURL()},get:function(a){Na(arguments.length,1);for(var t=Ys(this).entries,o=fn(a),e=0;e<t.length;e++)if(t[e].key===o)return t[e].value;return null},getAll:function(a){Na(arguments.length,1);for(var t=Ys(this).entries,o=fn(a),e=[],n=0;n<t.length;n++)t[n].key===o&&Nh(e,t[n].value);return e},has:function(a){Na(arguments.length,1);for(var t=Ys(this).entries,o=fn(a),e=0;e<t.length;)if(t[e++].key===o)return!0;return!1},set:function(a,t){Na(arguments.length,1);for(var o,e=Ys(this),n=e.entries,l=!1,h=fn(a),_=fn(t),S=0;S<n.length;S++)(o=n[S]).key===h&&(l?BM(n,S--,1):(l=!0,o.value=_));l||Nh(n,{key:h,value:_}),e.updateURL()},sort:function(){var a=Ys(this);jI(a.entries,function(t,o){return t.key>o.key?1:-1}),a.updateURL()},forEach:function(a){for(var t,o=Ys(this).entries,e=ra(a,arguments.length>1?arguments[1]:void 0),n=0;n<o.length;)e((t=o[n++]).value,t.key,this)},keys:function(){return new Ay(this,"keys")},values:function(){return new Ay(this,"values")},entries:function(){return new Ay(this,"entries")}},{enumerable:!0}),lr(rv,aA,rv.entries,{name:"entries"}),lr(rv,"toString",function(){return Ys(this).serialize()},{enumerable:!0}),ia(ky,"URLSearchParams"),sn({global:!0,forced:!GI},{URLSearchParams:ky}),!GI&&bt(nv)){var _A=ve(GM.has),WM=ve(GM.set),zM=function(a){if(xt(a)){var t,o=a.body;if(xi(o)==="URLSearchParams")return t=a.headers?new nv(a.headers):new nv,_A(t,"content-type")||WM(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),na(a,{body:Gn(0,fn(o)),headers:Gn(0,t)})}return a};if(bt(Cy)&&sn({global:!0,enumerable:!0,forced:!0},{fetch:function(a){return Cy(a,arguments.length>1?zM(arguments[1]):{})}}),bt(by)){var WI=function(a){return ko(this,qI),new by(a,arguments.length>1?zM(arguments[1]):{})};qI.constructor=WI,WI.prototype=qI,sn({global:!0,forced:!0},{Request:WI})}}var hs,YM={URLSearchParams:ky,getState:Ys},yA=Zr.f,SA=oo.codeAt,ad=Jr.set,iv=Jr.getterFor("URL"),IA=YM.URLSearchParams,rt=YM.getState,Rf=ee.URL,wy=ee.TypeError,Lh=ee.parseInt,zI=Math.floor,sd=Math.pow,Ho=ve("".charAt),Fa=ve(/./.exec),da=ve([].join),kt=ve(1 .toString),yo=ve([].pop),ha=ve([].push),YI=ve("".replace),JM=ve([].shift),XM=ve("".split),ps=ve("".slice),ov=ve("".toLowerCase),So=ve([].unshift),Dy=/[a-z]/i,JI=/[\d+-.a-z]/i,av=/\d/,Ph=/^0x/i,QM=/^[0-7]+$/,ZM=/^\d+$/,eR=/^[\da-f]+$/i,tR=/[\0\t\n\r #%/:<>?@[\\\]^|]/,nR=/[\0\t\n\r #/:<>?@[\\\]^|]/,EA=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,rR=/[\t\n\r]/g,Hc=function(a){var t,o,e,n;if(typeof a=="number"){for(t=[],o=0;o<4;o++)So(t,a%256),a=zI(a/256);return da(t,".")}if(typeof a=="object"){for(t="",e=function(l){for(var h=null,_=1,S=null,E=0,M=0;M<8;M++)l[M]!==0?(E>_&&(h=S,_=E),S=null,E=0):(S===null&&(S=M),++E);return E>_&&(h=S,_=E),h}(a),o=0;o<8;o++)n&&a[o]===0||(n&&(n=!1),e===o?(t+=o?":":"::",n=!0):(t+=kt(a[o],16),o<7&&(t+=":")));return"["+t+"]"}return a},sv={},Oy=Tf({},sv,{" ":1,'"':1,"<":1,">":1,"`":1}),XI=Tf({},Oy,{"#":1,"?":1,"{":1,"}":1}),Ny=Tf({},XI,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Js=function(a,t){var o=SA(a,0);return o>32&&o<127&&!st(t,a)?a:encodeURIComponent(a)},Cn={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Cf=function(a,t){var o;return a.length==2&&Fa(Dy,Ho(a,0))&&((o=Ho(a,1))==":"||!t&&o=="|")},QI=function(a){var t;return a.length>1&&Cf(ps(a,0,2))&&(a.length==2||(t=Ho(a,2))==="/"||t==="\\"||t==="?"||t==="#")},Ly=function(a){return a==="."||ov(a)==="%2e"},Py={},xy={},Uy={},Gy={},ZI={},Fy={},zu={},Yu={},cv={},$c={},Xs={},cd={},bf={},eE={},tE={},Vy={},fs={},Kc={},iR={},xh={},Ju={},nE=function(a,t,o){var e,n,l,h=fn(a);if(t){if(n=this.parse(h))throw wy(n);this.searchParams=null}else{if(o!==void 0&&(e=new nE(o,!0)),n=this.parse(h,null,e))throw wy(n);(l=rt(new IA)).bindURL(this),this.searchParams=l}};nE.prototype={type:"URL",parse:function(a,t,o){var e,n,l,h,_,S=this,E=t||Py,M=0,w="",L=!1,H=!1,ne=!1;for(a=fn(a),t||(S.scheme="",S.username="",S.password="",S.host=null,S.port=null,S.path=[],S.query=null,S.fragment=null,S.cannotBeABaseURL=!1,a=YI(a,EA,"")),a=YI(a,rR,""),e=io(a);M<=e.length;){switch(n=e[M],E){case Py:if(!n||!Fa(Dy,n)){if(t)return"Invalid scheme";E=Uy;continue}w+=ov(n),E=xy;break;case xy:if(n&&(Fa(JI,n)||n=="+"||n=="-"||n=="."))w+=ov(n);else{if(n!=":"){if(t)return"Invalid scheme";w="",E=Uy,M=0;continue}if(t&&(S.isSpecial()!=st(Cn,w)||w=="file"&&(S.includesCredentials()||S.port!==null)||S.scheme=="file"&&!S.host))return;if(S.scheme=w,t)return void(S.isSpecial()&&Cn[S.scheme]==S.port&&(S.port=null));w="",S.scheme=="file"?E=eE:S.isSpecial()&&o&&o.scheme==S.scheme?E=Gy:S.isSpecial()?E=Yu:e[M+1]=="/"?(E=ZI,M++):(S.cannotBeABaseURL=!0,ha(S.path,""),E=iR)}break;case Uy:if(!o||o.cannotBeABaseURL&&n!="#")return"Invalid scheme";if(o.cannotBeABaseURL&&n=="#"){S.scheme=o.scheme,S.path=zi(o.path),S.query=o.query,S.fragment="",S.cannotBeABaseURL=!0,E=Ju;break}E=o.scheme=="file"?eE:Fy;continue;case Gy:if(n!="/"||e[M+1]!="/"){E=Fy;continue}E=cv,M++;break;case ZI:if(n=="/"){E=$c;break}E=Kc;continue;case Fy:if(S.scheme=o.scheme,n==hs)S.username=o.username,S.password=o.password,S.host=o.host,S.port=o.port,S.path=zi(o.path),S.query=o.query;else if(n=="/"||n=="\\"&&S.isSpecial())E=zu;else if(n=="?")S.username=o.username,S.password=o.password,S.host=o.host,S.port=o.port,S.path=zi(o.path),S.query="",E=xh;else{if(n!="#"){S.username=o.username,S.password=o.password,S.host=o.host,S.port=o.port,S.path=zi(o.path),S.path.length--,E=Kc;continue}S.username=o.username,S.password=o.password,S.host=o.host,S.port=o.port,S.path=zi(o.path),S.query=o.query,S.fragment="",E=Ju}break;case zu:if(!S.isSpecial()||n!="/"&&n!="\\"){if(n!="/"){S.username=o.username,S.password=o.password,S.host=o.host,S.port=o.port,E=Kc;continue}E=$c}else E=cv;break;case Yu:if(E=cv,n!="/"||Ho(w,M+1)!="/")continue;M++;break;case cv:if(n!="/"&&n!="\\"){E=$c;continue}break;case $c:if(n=="@"){L&&(w="%40"+w),L=!0,l=io(w);for(var ae=0;ae<l.length;ae++){var he=l[ae];if(he!=":"||ne){var ge=Js(he,Ny);ne?S.password+=ge:S.username+=ge}else ne=!0}w=""}else if(n==hs||n=="/"||n=="?"||n=="#"||n=="\\"&&S.isSpecial()){if(L&&w=="")return"Invalid authority";M-=io(w).length+1,w="",E=Xs}else w+=n;break;case Xs:case cd:if(t&&S.scheme=="file"){E=Vy;continue}if(n!=":"||H){if(n==hs||n=="/"||n=="?"||n=="#"||n=="\\"&&S.isSpecial()){if(S.isSpecial()&&w=="")return"Invalid host";if(t&&w==""&&(S.includesCredentials()||S.port!==null))return;if(h=S.parseHost(w))return h;if(w="",E=fs,t)return;continue}n=="["?H=!0:n=="]"&&(H=!1),w+=n}else{if(w=="")return"Invalid host";if(h=S.parseHost(w))return h;if(w="",E=bf,t==cd)return}break;case bf:if(!Fa(av,n)){if(n==hs||n=="/"||n=="?"||n=="#"||n=="\\"&&S.isSpecial()||t){if(w!=""){var Te=Lh(w,10);if(Te>65535)return"Invalid port";S.port=S.isSpecial()&&Te===Cn[S.scheme]?null:Te,w=""}if(t)return;E=fs;continue}return"Invalid port"}w+=n;break;case eE:if(S.scheme="file",n=="/"||n=="\\")E=tE;else{if(!o||o.scheme!="file"){E=Kc;continue}if(n==hs)S.host=o.host,S.path=zi(o.path),S.query=o.query;else if(n=="?")S.host=o.host,S.path=zi(o.path),S.query="",E=xh;else{if(n!="#"){QI(da(zi(e,M),""))||(S.host=o.host,S.path=zi(o.path),S.shortenPath()),E=Kc;continue}S.host=o.host,S.path=zi(o.path),S.query=o.query,S.fragment="",E=Ju}}break;case tE:if(n=="/"||n=="\\"){E=Vy;break}o&&o.scheme=="file"&&!QI(da(zi(e,M),""))&&(Cf(o.path[0],!0)?ha(S.path,o.path[0]):S.host=o.host),E=Kc;continue;case Vy:if(n==hs||n=="/"||n=="\\"||n=="?"||n=="#"){if(!t&&Cf(w))E=Kc;else if(w==""){if(S.host="",t)return;E=fs}else{if(h=S.parseHost(w))return h;if(S.host=="localhost"&&(S.host=""),t)return;w="",E=fs}continue}w+=n;break;case fs:if(S.isSpecial()){if(E=Kc,n!="/"&&n!="\\")continue}else if(t||n!="?")if(t||n!="#"){if(n!=hs&&(E=Kc,n!="/"))continue}else S.fragment="",E=Ju;else S.query="",E=xh;break;case Kc:if(n==hs||n=="/"||n=="\\"&&S.isSpecial()||!t&&(n=="?"||n=="#")){if((_=ov(_=w))===".."||_==="%2e."||_===".%2e"||_==="%2e%2e"?(S.shortenPath(),n=="/"||n=="\\"&&S.isSpecial()||ha(S.path,"")):Ly(w)?n=="/"||n=="\\"&&S.isSpecial()||ha(S.path,""):(S.scheme=="file"&&!S.path.length&&Cf(w)&&(S.host&&(S.host=""),w=Ho(w,0)+":"),ha(S.path,w)),w="",S.scheme=="file"&&(n==hs||n=="?"||n=="#"))for(;S.path.length>1&&S.path[0]==="";)JM(S.path);n=="?"?(S.query="",E=xh):n=="#"&&(S.fragment="",E=Ju)}else w+=Js(n,XI);break;case iR:n=="?"?(S.query="",E=xh):n=="#"?(S.fragment="",E=Ju):n!=hs&&(S.path[0]+=Js(n,sv));break;case xh:t||n!="#"?n!=hs&&(n=="'"&&S.isSpecial()?S.query+="%27":S.query+=n=="#"?"%23":Js(n,sv)):(S.fragment="",E=Ju);break;case Ju:n!=hs&&(S.fragment+=Js(n,Oy))}M++}},parseHost:function(a){var t,o,e;if(Ho(a,0)=="["){if(Ho(a,a.length-1)!="]"||!(t=function(n){var l,h,_,S,E,M,w,L=[0,0,0,0,0,0,0,0],H=0,ne=null,ae=0,he=function(){return Ho(n,ae)};if(he()==":"){if(Ho(n,1)!=":")return;ae+=2,ne=++H}for(;he();){if(H==8)return;if(he()!=":"){for(l=h=0;h<4&&Fa(eR,he());)l=16*l+Lh(he(),16),ae++,h++;if(he()=="."){if(h==0||(ae-=h,H>6))return;for(_=0;he();){if(S=null,_>0){if(!(he()=="."&&_<4))return;ae++}if(!Fa(av,he()))return;for(;Fa(av,he());){if(E=Lh(he(),10),S===null)S=E;else{if(S==0)return;S=10*S+E}if(S>255)return;ae++}L[H]=256*L[H]+S,++_!=2&&_!=4||H++}if(_!=4)return;break}if(he()==":"){if(ae++,!he())return}else if(he())return;L[H++]=l}else{if(ne!==null)return;ae++,ne=++H}}if(ne!==null)for(M=H-ne,H=7;H!=0&&M>0;)w=L[H],L[H--]=L[ne+M-1],L[ne+--M]=w;else if(H!=8)return;return L}(ps(a,1,-1))))return"Invalid host";this.host=t}else if(this.isSpecial()){if(a=function(n){var l,h,_=[],S=eA(VI(tA(n),wM,"."),".");for(l=0;l<S.length;l++)h=S[l],od(_,Zb(Qb,h)?"xn--"+xM(h):h);return LM(_,".")}(a),Fa(tR,a)||(t=function(n){var l,h,_,S,E,M,w,L=XM(n,".");if(L.length&&L[L.length-1]==""&&L.length--,(l=L.length)>4)return n;for(h=[],_=0;_<l;_++){if((S=L[_])=="")return n;if(E=10,S.length>1&&Ho(S,0)=="0"&&(E=Fa(Ph,S)?16:8,S=ps(S,E==8?1:2)),S==="")M=0;else{if(!Fa(E==10?ZM:E==8?QM:eR,S))return n;M=Lh(S,E)}ha(h,M)}for(_=0;_<l;_++)if(M=h[_],_==l-1){if(M>=sd(256,5-l))return null}else if(M>255)return null;for(w=yo(h),_=0;_<h.length;_++)w+=h[_]*sd(256,3-_);return w}(a))===null)return"Invalid host";this.host=t}else{if(Fa(nR,a))return"Invalid host";for(t="",o=io(a),e=0;e<o.length;e++)t+=Js(o[e],sv);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return st(Cn,this.scheme)},shortenPath:function(){var a=this.path,t=a.length;!t||this.scheme=="file"&&t==1&&Cf(a[0],!0)||a.length--},serialize:function(){var a=this,t=a.scheme,o=a.username,e=a.password,n=a.host,l=a.port,h=a.path,_=a.query,S=a.fragment,E=t+":";return n!==null?(E+="//",a.includesCredentials()&&(E+=o+(e?":"+e:"")+"@"),E+=Hc(n),l!==null&&(E+=":"+l)):t=="file"&&(E+="//"),E+=a.cannotBeABaseURL?h[0]:h.length?"/"+da(h,"/"):"",_!==null&&(E+="?"+_),S!==null&&(E+="#"+S),E},setHref:function(a){var t=this.parse(a);if(t)throw wy(t);this.searchParams.update()},getOrigin:function(){var a=this.scheme,t=this.port;if(a=="blob")try{return new Af(a.path[0]).origin}catch{return"null"}return a!="file"&&this.isSpecial()?a+"://"+Hc(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(a){this.parse(fn(a)+":",Py)},getUsername:function(){return this.username},setUsername:function(a){var t=io(fn(a));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var o=0;o<t.length;o++)this.username+=Js(t[o],Ny)}},getPassword:function(){return this.password},setPassword:function(a){var t=io(fn(a));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var o=0;o<t.length;o++)this.password+=Js(t[o],Ny)}},getHost:function(){var a=this.host,t=this.port;return a===null?"":t===null?Hc(a):Hc(a)+":"+t},setHost:function(a){this.cannotBeABaseURL||this.parse(a,Xs)},getHostname:function(){var a=this.host;return a===null?"":Hc(a)},setHostname:function(a){this.cannotBeABaseURL||this.parse(a,cd)},getPort:function(){var a=this.port;return a===null?"":fn(a)},setPort:function(a){this.cannotHaveUsernamePasswordPort()||((a=fn(a))==""?this.port=null:this.parse(a,bf))},getPathname:function(){var a=this.path;return this.cannotBeABaseURL?a[0]:a.length?"/"+da(a,"/"):""},setPathname:function(a){this.cannotBeABaseURL||(this.path=[],this.parse(a,fs))},getSearch:function(){var a=this.query;return a?"?"+a:""},setSearch:function(a){(a=fn(a))==""?this.query=null:(Ho(a,0)=="?"&&(a=ps(a,1)),this.query="",this.parse(a,xh)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var a=this.fragment;return a?"#"+a:""},setHash:function(a){(a=fn(a))!=""?(Ho(a,0)=="#"&&(a=ps(a,1)),this.fragment="",this.parse(a,Ju)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Af=function(a){var t=ko(this,By),o=Na(arguments.length,1)>1?arguments[1]:void 0,e=ad(t,new nE(a,!1,o));Et||(t.href=e.serialize(),t.origin=e.getOrigin(),t.protocol=e.getProtocol(),t.username=e.getUsername(),t.password=e.getPassword(),t.host=e.getHost(),t.hostname=e.getHostname(),t.port=e.getPort(),t.pathname=e.getPathname(),t.search=e.getSearch(),t.searchParams=e.getSearchParams(),t.hash=e.getHash())},By=Af.prototype,Io=function(a,t){return{get:function(){return iv(this)[a]()},set:t&&function(o){return iv(this)[t](o)},configurable:!0,enumerable:!0}};if(Et&&yA(By,{href:Io("serialize","setHref"),origin:Io("getOrigin"),protocol:Io("getProtocol","setProtocol"),username:Io("getUsername","setUsername"),password:Io("getPassword","setPassword"),host:Io("getHost","setHost"),hostname:Io("getHostname","setHostname"),port:Io("getPort","setPort"),pathname:Io("getPathname","setPathname"),search:Io("getSearch","setSearch"),searchParams:Io("getSearchParams"),hash:Io("getHash","setHash")}),lr(By,"toJSON",function(){return iv(this).serialize()},{enumerable:!0}),lr(By,"toString",function(){return iv(this).serialize()},{enumerable:!0}),Rf){var oR=Rf.createObjectURL,aR=Rf.revokeObjectURL;oR&&lr(Af,"createObjectURL",ra(oR,Rf)),aR&&lr(Af,"revokeObjectURL",ra(aR,Rf))}ia(Af,"URL"),sn({global:!0,forced:!GI,sham:!Et},{URL:Af}),sn({target:"Object",stat:!0,forced:Object.assign!==Tf},{assign:Tf});var jy=function(){function a(t){A(this,a),this._imageMemoryURL="",tn?this.createImageDataASURLInWXMiniApp(t.file):this.createImageDataASURLInWeb(t.file),this._initImageInfoModel(),this.type=Z.MSG_IMAGE,this._percent=0,this.content={imageFormat:t.imageFormat||Gu.UNKNOWN,uuid:t.uuid,imageInfoArray:[]},this.initImageInfoArray(t.imageInfoArray),this._defaultImage="http://imgcache.qq.com/open/qcloud/video/act/webim-images/default.jpg",this._autoFixUrl()}return x(a,[{key:"_initImageInfoModel",value:function(){var t=this;this._ImageInfoModel=function(o){this.instanceID=cs(9999999),this.sizeType=o.type||0,this.type=0,this.size=o.size||0,this.width=o.width||0,this.height=o.height||0,this.imageUrl=o.url||"",this.url=o.url||t._imageMemoryURL||t._defaultImage},this._ImageInfoModel.prototype={setSizeType:function(o){this.sizeType=o},setType:function(o){this.type=o},setImageUrl:function(o){o&&(this.imageUrl=o)},getImageUrl:function(){return this.imageUrl}}}},{key:"initImageInfoArray",value:function(t){for(var o=0,e=null,n=null;o<=2;)n=Ke(t)||Ke(t[o])?{type:0,size:0,width:0,height:0,url:""}:t[o],(e=new this._ImageInfoModel(n)).setSizeType(o+1),e.setType(o),this.addImageInfo(e),o++;this.updateAccessSideImageInfoArray()}},{key:"updateImageInfoArray",value:function(t){for(var o,e=this.content.imageInfoArray.length,n=0;n<e;n++)o=this.content.imageInfoArray[n],t[n].size&&(o.size=t[n].size),t[n].url&&o.setImageUrl(t[n].url),t[n].width&&(o.width=t[n].width),t[n].height&&(o.height=t[n].height)}},{key:"_autoFixUrl",value:function(){for(var t=this.content.imageInfoArray.length,o="",e="",n=["http","https"],l=null,h=0;h<t;h++)this.content.imageInfoArray[h].url&&(l=this.content.imageInfoArray[h]).imageUrl!==""&&(e=l.imageUrl.slice(0,l.imageUrl.indexOf("://")+1),o=l.imageUrl.slice(l.imageUrl.indexOf("://")+1),n.indexOf(e)<0&&(e="https:"),this.content.imageInfoArray[h].setImageUrl([e,o].join("")))}},{key:"updatePercent",value:function(t){this._percent=t,this._percent>1&&(this._percent=1)}},{key:"updateImageFormat",value:function(t){this.content.imageFormat=Gu[t.toUpperCase()]||Gu.UNKNOWN}},{key:"createImageDataASURLInWeb",value:function(t){t!==void 0&&t.files.length>0&&(this._imageMemoryURL=window.URL.createObjectURL(t.files[0]))}},{key:"createImageDataASURLInWXMiniApp",value:function(t){t&&t.url&&(this._imageMemoryURL=t.url)}},{key:"replaceImageInfo",value:function(t,o){this.content.imageInfoArray[o]instanceof this._ImageInfoModel||(this.content.imageInfoArray[o]=t)}},{key:"addImageInfo",value:function(t){this.content.imageInfoArray.length>=3||this.content.imageInfoArray.push(t)}},{key:"updateAccessSideImageInfoArray",value:function(){var t=this.content.imageInfoArray,o=t[0],e=o.width,n=e===void 0?0:e,l=o.height,h=l===void 0?0:l;n!==0&&h!==0&&(Km(t),Object.assign(t[2],ry({originWidth:n,originHeight:h,min:720})))}},{key:"sendable",value:function(){return this.content.imageInfoArray.length!==0&&this.content.imageInfoArray[0].imageUrl!==""&&this.content.imageInfoArray[0].size!==0}}]),a}(),qy=function(){function a(t){A(this,a),this.type=Z.MSG_FACE,this.content=t||null}return x(a,[{key:"sendable",value:function(){return this.content!==null}}]),a}(),kf=function(){function a(t){A(this,a),this.type=Z.MSG_AUDIO,this._percent=0,this.content={downloadFlag:2,second:t.second,size:t.size,url:t.url,remoteAudioUrl:t.url||"",uuid:t.uuid}}return x(a,[{key:"updatePercent",value:function(t){this._percent=t,this._percent>1&&(this._percent=1)}},{key:"updateAudioUrl",value:function(t){this.content.remoteAudioUrl=t}},{key:"sendable",value:function(){return this.content.remoteAudioUrl!==""}}]),a}(),TA={from:!0,groupID:!0,groupName:!0,to:!0},sR=function(){function a(t){A(this,a),this.type=Z.MSG_GRP_TIP,this.content={},this._initContent(t)}return x(a,[{key:"_initContent",value:function(t){var o=this;Object.keys(t).forEach(function(e){switch(e){case"remarkInfo":break;case"groupProfile":o.content.groupProfile={},o._initGroupProfile(t[e]);break;case"operatorInfo":break;case"memberInfoList":case"msgMemberInfo":o._updateMemberList(t[e]);break;case"onlineMemberInfo":break;case"memberNum":o.content[e]=t[e],o.content.memberCount=t[e];break;case"newGroupProfile":o.content.newGroupProfile={},o._initNewGroupProfile(t[e]);break;default:o.content[e]=t[e]}}),this.content.userIDList||(this.content.userIDList=[this.content.operatorID])}},{key:"_initGroupProfile",value:function(t){for(var o=Object.keys(t),e=0;e<o.length;e++){var n=o[e];TA[n]&&(this.content.groupProfile[n]=t[n])}}},{key:"_updateMemberList",value:function(t){Mt(this.content.memberList)?this.content.memberList=t:this.content.memberList.forEach(function(o){t.forEach(function(e){o.userID===e.userID&&Object.assign(o,e)})})}},{key:"_initNewGroupProfile",value:function(t){for(var o=Object.keys(t),e=0;e<o.length;e++){var n=o[e];n!=="muteAllMembers"?this.content.newGroupProfile[n]=t[n]:this.content.newGroupProfile[n]=t[n]===1}}}]),a}(),MA={from:!0,groupID:!0,groupName:!0,to:!0},cR=function(){function a(t){A(this,a),this.type=Z.MSG_GRP_SYS_NOTICE,this.content={},this._initContent(t)}return x(a,[{key:"_initContent",value:function(t){var o=this;Object.keys(t).forEach(function(e){switch(e){case"memberInfoList":break;case"remarkInfo":o.content.handleMessage=t[e];break;case"groupProfile":o.content.groupProfile={},o._initGroupProfile(t[e]);break;default:o.content[e]=t[e]}})}},{key:"_initGroupProfile",value:function(t){for(var o=Object.keys(t),e=0;e<o.length;e++){var n=o[e];MA[n]&&(n==="groupName"?this.content.groupProfile.name=t[n]:this.content.groupProfile[n]=t[n])}}}]),a}(),RA=Math.min,Hy=[].lastIndexOf,$y=!!Hy&&1/[1].lastIndexOf(1,-0)<0,uR=Cl("lastIndexOf"),uv=$y||!uR?function(a){if($y)return Dc(Hy,this,arguments)||0;var t=ur(this),o=xr(t),e=o-1;for(arguments.length>1&&(e=RA(e,$a(arguments[1]))),e<0&&(e=o+e);e>=0;e--)if(e in t&&t[e]===a)return e||0;return-1}:Hy;sn({target:"Array",proto:!0,forced:uv!==[].lastIndexOf},{lastIndexOf:uv});var rE=function(){function a(t){A(this,a),this.type=Z.MSG_FILE,this._percent=0;var o=this._getFileInfo(t);this.content={downloadFlag:2,fileUrl:t.url||"",uuid:t.uuid,fileName:o.name||"",fileSize:o.size||0}}return x(a,[{key:"_getFileInfo",value:function(t){if(!Ke(t.fileName)&&!Ke(t.fileSize))return{size:t.fileSize,name:t.fileName};var o=t.file.files[0];if(tr){if(o.path&&o.path.indexOf(".")!==-1){var e=o.path.slice(o.path.lastIndexOf(".")+1).toLowerCase();o.type=e,o.name||(o.name="".concat(cs(999999),".").concat(e))}o.name||(o.type="",o.name=o.path.slice(o.path.lastIndexOf("/")+1).toLowerCase()),o.suffix&&(o.type=o.suffix),o.url||(o.url=o.path)}return{size:o.size,name:o.name}}},{key:"updatePercent",value:function(t){this._percent=t,this._percent>1&&(this._percent=1)}},{key:"updateFileUrl",value:function(t){this.content.fileUrl=t}},{key:"sendable",value:function(){return this.content.fileUrl!==""&&this.content.fileName!==""&&this.content.fileSize!==0}}]),a}(),lv=function(){function a(t){A(this,a),this.type=Z.MSG_CUSTOM,this.content={data:t.data||"",description:t.description||"",extension:t.extension||""}}return x(a,[{key:"setData",value:function(t){return this.content.data=t,this}},{key:"setDescription",value:function(t){return this.content.description=t,this}},{key:"setExtension",value:function(t){return this.content.extension=t,this}},{key:"sendable",value:function(){return this.content.data.length!==0||this.content.description.length!==0||this.content.extension.length!==0}}]),a}(),Uh=function(){function a(t){A(this,a),this.type=Z.MSG_VIDEO,this._percent=0,this.content={remoteVideoUrl:t.remoteVideoUrl||t.videoUrl||"",videoFormat:t.videoFormat,videoSecond:parseInt(t.videoSecond,10),videoSize:t.videoSize,videoUrl:t.videoUrl,videoDownloadFlag:2,videoUUID:t.videoUUID,thumbUUID:t.thumbUUID,thumbFormat:t.thumbFormat,thumbWidth:t.thumbWidth,snapshotWidth:t.thumbWidth,thumbHeight:t.thumbHeight,snapshotHeight:t.thumbHeight,thumbSize:t.thumbSize,snapshotSize:t.thumbSize,thumbDownloadFlag:2,thumbUrl:t.thumbUrl,snapshotUrl:t.thumbUrl}}return x(a,[{key:"updatePercent",value:function(t){this._percent=t,this._percent>1&&(this._percent=1)}},{key:"updateVideoUrl",value:function(t){t&&(this.content.remoteVideoUrl=t)}},{key:"updateSnapshotInfo",value:function(t){var o=t.snapshotUrl,e=t.snapshotWidth,n=t.snapshotHeight;Mt(o)||(this.content.thumbUrl=this.content.snapshotUrl=o),Mt(e)||(this.content.thumbWidth=this.content.snapshotWidth=Number(e)),Mt(n)||(this.content.thumbHeight=this.content.snapshotHeight=Number(n))}},{key:"sendable",value:function(){return this.content.remoteVideoUrl!==""}}]),a}(),wf=function(){function a(t){A(this,a),this.type=Z.MSG_LOCATION;var o=t.description,e=t.longitude,n=t.latitude;this.content={description:o,longitude:e,latitude:n}}return x(a,[{key:"sendable",value:function(){return!0}}]),a}(),Ky=function(){function a(t){if(A(this,a),this.from=t.from,this.messageSender=t.from,this.time=t.time,this.messageSequence=t.sequence,this.clientSequence=t.clientSequence||t.sequence,this.messageRandom=t.random,this.cloudCustomData=t.cloudCustomData||"",this.clientTime=t.clientTime||void 0,t.ID)this.ID=t.ID||"",this.nick=t.nick||"",this.avatar=t.avatar||"",this.messageBody=[{type:t.type,payload:t.payload}],t.conversationType.startsWith(Z.CONV_C2C)?this.receiverUserID=t.to:t.conversationType.startsWith(Z.CONV_GROUP)&&(this.receiverGroupID=t.to),this.messageReceiver=t.to;else{this.nick=t.nick||"",this.avatar=t.avatar||"",this.messageBody=[];var o=t.elements[0].type,e=t.elements[0].content;this._patchRichMediaPayload(o,e),o===Z.MSG_MERGER?this.messageBody.push({type:o,payload:new dv(e).content}):this.messageBody.push({type:o,payload:e}),t.groupID&&(this.receiverGroupID=t.groupID,this.messageReceiver=t.groupID),t.to&&(this.receiverUserID=t.to,this.messageReceiver=t.to),this.ID="".concat(t.tinyID,"-").concat(t.clientTime,"-").concat(t.random)}}return x(a,[{key:"_patchRichMediaPayload",value:function(t,o){t===Z.MSG_IMAGE?o.imageInfoArray.forEach(function(e){!e.imageUrl&&e.url&&(e.imageUrl=e.url,e.sizeType=e.type,e.type===1?e.type=0:e.type===3&&(e.type=1))}):t===Z.MSG_VIDEO?!o.remoteVideoUrl&&o.videoUrl&&(o.remoteVideoUrl=o.videoUrl):t===Z.MSG_AUDIO?!o.remoteAudioUrl&&o.url&&(o.remoteAudioUrl=o.url):t===Z.MSG_FILE&&!o.fileUrl&&o.url&&(o.fileUrl=o.url,o.url=void 0)}}]),a}(),dv=function(){function a(t){if(A(this,a),this.type=Z.MSG_MERGER,this.content={downloadKey:"",pbDownloadKey:"",messageList:[],title:"",abstractList:[],compatibleText:"",version:0,layersOverLimit:!1},t.downloadKey){var o=t.downloadKey,e=t.pbDownloadKey,n=t.title,l=t.abstractList,h=t.compatibleText,_=t.version;this.content.downloadKey=o,this.content.pbDownloadKey=e,this.content.title=n,this.content.abstractList=l,this.content.compatibleText=h,this.content.version=_||0}else if(Mt(t.messageList))t.layersOverLimit===1&&(this.content.layersOverLimit=!0);else{var S=t.messageList,E=t.title,M=t.abstractList,w=t.compatibleText,L=t.version,H=[];S.forEach(function(ne){if(!Mt(ne)){var ae=new Ky(ne);H.push(ae)}}),this.content.messageList=H,this.content.title=E,this.content.abstractList=M,this.content.compatibleText=w,this.content.version=L||0}V.debug("MergerElement.content:",this.content)}return x(a,[{key:"sendable",value:function(){return!Mt(this.content.messageList)||!Mt(this.content.downloadKey)}}]),a}(),Df={1:Z.MSG_PRIORITY_HIGH,2:Z.MSG_PRIORITY_NORMAL,3:Z.MSG_PRIORITY_LOW,4:Z.MSG_PRIORITY_LOWEST},Bi=function(){function a(t){A(this,a),this.ID="",this.conversationID=t.conversationID||null,this.conversationType=t.conversationType||Z.CONV_C2C,this.conversationSubType=t.conversationSubType,this.time=t.time||Math.ceil(Date.now()/1e3),this.sequence=t.sequence||0,this.clientSequence=t.clientSequence||t.sequence||0,this.random=t.random||t.random===0?t.random:cs(),this.priority=this._computePriority(t.priority),this.nick=t.nick||"",this.avatar=t.avatar||"",this.isPeerRead=t.isPeerRead===1||!1,this.nameCard="",this._elements=[],this.isPlaceMessage=t.isPlaceMessage||0,this.isRevoked=t.isPlaceMessage===2||t.msgFlagBits===8,this.from=t.from||null,this.to=t.to||null,this.flow="",this.isSystemMessage=t.isSystemMessage||!1,this.protocol=t.protocol||"JSON",this.isResend=!1,this.isRead=!1,this.status=t.status||Xi.SUCCESS,this._onlineOnlyFlag=!1,this._groupAtInfoList=[],this._relayFlag=!1,this.atUserList=[],this.cloudCustomData=t.cloudCustomData||"",this.isDeleted=!1,this.isModified=!1,this._isExcludedFromUnreadCount=!(!t.messageControlInfo||t.messageControlInfo.excludedFromUnreadCount!==1),this._isExcludedFromLastMessage=!(!t.messageControlInfo||t.messageControlInfo.excludedFromLastMessage!==1),this.clientTime=t.clientTime||PT()||0,this.senderTinyID=t.senderTinyID||t.tinyID||"",this.readReceiptInfo=t.readReceiptInfo||{readCount:void 0,unreadCount:void 0},this.needReadReceipt=t.needReadReceipt===!0||t.needReadReceipt===1,this.version=t.messageVersion||0,this.isBroadcastMessage=t.isBroadcastMessage||!1,this.reInitialize(t.currentUser),this.extractGroupInfo(t.groupProfile||null),this.handleGroupAtInfo(t)}return x(a,[{key:"elements",get:function(){return V.warn("\uFF01\uFF01\uFF01Message \u5B9E\u4F8B\u7684 elements \u5C5E\u6027\u5373\u5C06\u5E9F\u5F03\uFF0C\u8BF7\u5C3D\u5FEB\u4FEE\u6539\u3002\u4F7F\u7528 type \u548C payload \u5C5E\u6027\u5904\u7406\u5355\u6761\u6D88\u606F\uFF0C\u517C\u5BB9\u7EC4\u5408\u6D88\u606F\u4F7F\u7528 _elements \u5C5E\u6027\uFF01\uFF01\uFF01"),this._elements}},{key:"getElements",value:function(){return this._elements}},{key:"extractGroupInfo",value:function(t){if(t!==null){Ln(t.nick)&&(this.nick=t.nick),Ln(t.avatar)&&(this.avatar=t.avatar);var o=t.messageFromAccountExtraInformation;Br(o)&&Ln(o.nameCard)&&(this.nameCard=o.nameCard)}}},{key:"handleGroupAtInfo",value:function(t){var o=this;t.payload&&t.payload.atUserList&&t.payload.atUserList.forEach(function(e){e!==Z.MSG_AT_ALL?(o._groupAtInfoList.push({groupAtAllFlag:0,groupAtUserID:e}),o.atUserList.push(e)):(o._groupAtInfoList.push({groupAtAllFlag:1}),o.atUserList.push(Z.MSG_AT_ALL))}),Yt(t.groupAtInfo)&&t.groupAtInfo.forEach(function(e){e.groupAtAllFlag===0?o.atUserList.push(e.groupAtUserID):e.groupAtAllFlag===1&&o.atUserList.push(Z.MSG_AT_ALL)})}},{key:"getGroupAtInfoList",value:function(){return this._groupAtInfoList}},{key:"_initProxy",value:function(){this._elements[0]&&(this.payload=this._elements[0].content,this.type=this._elements[0].type)}},{key:"reInitialize",value:function(t){t&&(this.status=this.from?Xi.SUCCESS:Xi.UNSEND,!this.from&&(this.from=t)),this._initFlow(t),this._initSequence(t),this._concatConversationID(t),this.generateMessageID()}},{key:"isSendable",value:function(){return this._elements.length!==0&&(typeof this._elements[0].sendable!="function"?(V.warn("".concat(this._elements[0].type,' need "boolean : sendable()" method')),!1):this._elements[0].sendable())}},{key:"_initTo",value:function(t){this.conversationType===Z.CONV_GROUP&&(this.to=t.groupID)}},{key:"_initSequence",value:function(t){this.clientSequence===0&&t&&(this.clientSequence=function(o){if(!o)return V.error("autoIncrementIndex(string: key) need key parameter"),!1;if(ey[o]===void 0){var e=new Date,n="3".concat(e.getHours()).slice(-2),l="0".concat(e.getMinutes()).slice(-2),h="0".concat(e.getSeconds()).slice(-2);ey[o]=parseInt([n,l,h,"0001"].join("")),n=null,l=null,h=null,V.log("autoIncrementIndex start index:".concat(ey[o]))}return ey[o]++}(t)),this.sequence===0&&this.conversationType===Z.CONV_C2C&&(this.sequence=this.clientSequence)}},{key:"generateMessageID",value:function(){this.from===Z.CONV_SYSTEM&&(this.senderTinyID="144115198244471703"),this.ID="".concat(this.senderTinyID,"-").concat(this.clientTime,"-").concat(this.random)}},{key:"_initFlow",value:function(t){t!==""&&(t===this.from?(this.flow="out",this.isRead=!0):this.flow="in")}},{key:"_concatConversationID",value:function(t){var o=this.to,e="",n=this.conversationType;n!==Z.CONV_SYSTEM?(e=n===Z.CONV_C2C?t===this.from?o:this.from:this.to,this.conversationID="".concat(n).concat(e)):this.conversationID=Z.CONV_SYSTEM}},{key:"isElement",value:function(t){return t instanceof UI||t instanceof jy||t instanceof qy||t instanceof kf||t instanceof rE||t instanceof Uh||t instanceof sR||t instanceof cR||t instanceof lv||t instanceof wf||t instanceof dv}},{key:"setElement",value:function(t){var o=this;if(this.isElement(t))return this._elements=[t],void this._initProxy();var e=function(l){if(l.type&&l.content)switch(l.type){case Z.MSG_TEXT:o.setTextElement(l.content);break;case Z.MSG_IMAGE:o.setImageElement(l.content);break;case Z.MSG_AUDIO:o.setAudioElement(l.content);break;case Z.MSG_FILE:o.setFileElement(l.content);break;case Z.MSG_VIDEO:o.setVideoElement(l.content);break;case Z.MSG_CUSTOM:o.setCustomElement(l.content);break;case Z.MSG_LOCATION:o.setLocationElement(l.content);break;case Z.MSG_GRP_TIP:o.setGroupTipElement(l.content);break;case Z.MSG_GRP_SYS_NOTICE:o.setGroupSystemNoticeElement(l.content);break;case Z.MSG_FACE:o.setFaceElement(l.content);break;case Z.MSG_MERGER:o.setMergerElement(l.content);break;default:V.warn(l.type,l.content,"no operation......")}};if(Yt(t))for(var n=0;n<t.length;n++)e(t[n]);else e(t);this._initProxy()}},{key:"clearElement",value:function(){this._elements.length=0}},{key:"setTextElement",value:function(t){var o=typeof t=="string"?t:t.text,e=new UI({text:o});this._elements.push(e)}},{key:"setImageElement",value:function(t){var o=new jy(t);this._elements.push(o)}},{key:"setAudioElement",value:function(t){var o=new kf(t);this._elements.push(o)}},{key:"setFileElement",value:function(t){var o=new rE(t);this._elements.push(o)}},{key:"setVideoElement",value:function(t){var o=new Uh(t);this._elements.push(o)}},{key:"setLocationElement",value:function(t){var o=new wf(t);this._elements.push(o)}},{key:"setCustomElement",value:function(t){var o=new lv(t);this._elements.push(o)}},{key:"setGroupTipElement",value:function(t){var o={},e=t.operationType;Mt(t.memberInfoList)?t.operatorInfo&&(o=t.operatorInfo):e!==Z.GRP_TIP_MBR_JOIN&&e!==Z.GRP_TIP_MBR_KICKED_OUT&&e!==Z.GRP_TIP_MBR_SET_ADMIN&&e!==Z.GRP_TIP_MBR_CANCELED_ADMIN||(o=t.memberInfoList[0]);var n=o,l=n.nick,h=n.avatar;Ln(l)&&(this.nick=l),Ln(h)&&(this.avatar=h);var _=new sR(t);this._elements.push(_)}},{key:"setGroupSystemNoticeElement",value:function(t){var o=new cR(t);this._elements.push(o)}},{key:"setFaceElement",value:function(t){var o=new qy(t);this._elements.push(o)}},{key:"setMergerElement",value:function(t){var o=new dv(t);this._elements.push(o)}},{key:"setIsRead",value:function(t){this.isRead=t}},{key:"setRelayFlag",value:function(t){this._relayFlag=t}},{key:"getRelayFlag",value:function(){return this._relayFlag}},{key:"_computePriority",value:function(t){if(Ke(t))return Z.MSG_PRIORITY_NORMAL;if(Ln(t)&&Object.values(Df).indexOf(t)!==-1)return t;if(gr(t)){var o=""+t;if(Object.keys(Df).indexOf(o)!==-1)return Df[o]}return Z.MSG_PRIORITY_NORMAL}},{key:"setNickAndAvatar",value:function(t){var o=t.nick,e=t.avatar;Ln(o)&&(this.nick=o),Ln(e)&&(this.avatar=e)}},{key:"setNameCard",value:function(t){Ln(t)&&(this.nameCard=t)}}]),a}(),Wt=function(a){return{code:0,data:a||{}}},Qi="https://cloud.tencent.com/document/product/",Wy="\u60A8\u53EF\u4EE5\u5728\u5373\u65F6\u901A\u4FE1 IM \u63A7\u5236\u53F0\u7684\u3010\u5F00\u53D1\u8F85\u52A9\u5DE5\u5177(https://console.cloud.tencent.com/im-detail/tool-usersig)\u3011 \u9875\u9762\u6821\u9A8C UserSig\u3002",lR="UserSig \u975E\u6CD5\uFF0C\u8BF7\u4F7F\u7528\u5B98\u7F51\u63D0\u4F9B\u7684 API \u91CD\u65B0\u751F\u6210 UserSig(".concat(Qi,"269/32688)\u3002"),hv="#.E6.B6.88.E6.81.AF.E5.85.83.E7.B4.A0-timmsgelement",Wc={70001:"UserSig \u5DF2\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u751F\u6210\u3002\u5EFA\u8BAE UserSig \u6709\u6548\u671F\u8BBE\u7F6E\u4E0D\u5C0F\u4E8E24\u5C0F\u65F6\u3002",70002:"UserSig \u957F\u5EA6\u4E3A0\uFF0C\u8BF7\u68C0\u67E5\u4F20\u5165\u7684 UserSig \u662F\u5426\u6B63\u786E\u3002",70003:lR,70005:lR,70009:"UserSig \u9A8C\u8BC1\u5931\u8D25\uFF0C\u53EF\u80FD\u56E0\u4E3A\u751F\u6210 UserSig \u65F6\u6DF7\u7528\u4E86\u5176\u4ED6 SDKAppID \u7684\u79C1\u94A5\u6216\u5BC6\u94A5\u5BFC\u81F4\uFF0C\u8BF7\u4F7F\u7528\u5BF9\u5E94 SDKAppID \u4E0B\u7684\u79C1\u94A5\u6216\u5BC6\u94A5\u91CD\u65B0\u751F\u6210 UserSig(".concat(Qi,"269/32688)\u3002"),70013:"\u8BF7\u6C42\u4E2D\u7684 UserID \u4E0E\u751F\u6210 UserSig \u65F6\u4F7F\u7528\u7684 UserID \u4E0D\u5339\u914D\u3002".concat(Wy),70014:"\u8BF7\u6C42\u4E2D\u7684 SDKAppID \u4E0E\u751F\u6210 UserSig \u65F6\u4F7F\u7528\u7684 SDKAppID \u4E0D\u5339\u914D\u3002".concat(Wy),70016:"\u5BC6\u94A5\u4E0D\u5B58\u5728\uFF0CUserSig \u9A8C\u8BC1\u5931\u8D25\uFF0C\u8BF7\u5728\u5373\u65F6\u901A\u4FE1 IM \u63A7\u5236\u53F0\u83B7\u53D6\u5BC6\u94A5(".concat(Qi,"269/32578#.E8.8E.B7.E5.8F.96.E5.AF.86.E9.92.A5)\u3002"),70020:"SDKAppID \u672A\u627E\u5230\uFF0C\u8BF7\u5728\u5373\u65F6\u901A\u4FE1 IM \u63A7\u5236\u53F0\u786E\u8BA4\u5E94\u7528\u4FE1\u606F\u3002",70050:"UserSig \u9A8C\u8BC1\u6B21\u6570\u8FC7\u4E8E\u9891\u7E41\u3002\u8BF7\u68C0\u67E5 UserSig \u662F\u5426\u6B63\u786E\uFF0C\u5E76\u4E8E1\u5206\u949F\u540E\u91CD\u65B0\u9A8C\u8BC1\u3002".concat(Wy),70051:"\u5E10\u53F7\u88AB\u62C9\u5165\u9ED1\u540D\u5355\u3002",70052:"UserSig \u5DF2\u7ECF\u5931\u6548\uFF0C\u8BF7\u91CD\u65B0\u751F\u6210\uFF0C\u518D\u6B21\u5C1D\u8BD5\u3002",70107:"\u56E0\u5B89\u5168\u539F\u56E0\u88AB\u9650\u5236\u767B\u5F55\uFF0C\u8BF7\u4E0D\u8981\u9891\u7E41\u767B\u5F55\u3002",70169:"\u8BF7\u6C42\u7684\u7528\u6237\u5E10\u53F7\u4E0D\u5B58\u5728\u3002",70114:"".concat("\u670D\u52A1\u7AEF\u5185\u90E8\u8D85\u65F6\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5\u3002"),70202:"".concat("\u670D\u52A1\u7AEF\u5185\u90E8\u8D85\u65F6\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5\u3002"),70206:"\u8BF7\u6C42\u4E2D\u6279\u91CF\u6570\u91CF\u4E0D\u5408\u6CD5\u3002",70402:"\u53C2\u6570\u975E\u6CD5\uFF0C\u8BF7\u68C0\u67E5\u5FC5\u586B\u5B57\u6BB5\u662F\u5426\u586B\u5145\uFF0C\u6216\u8005\u5B57\u6BB5\u7684\u586B\u5145\u662F\u5426\u6EE1\u8DB3\u534F\u8BAE\u8981\u6C42\u3002",70403:"\u8BF7\u6C42\u5931\u8D25\uFF0C\u9700\u8981 App \u7BA1\u7406\u5458\u6743\u9650\u3002",70398:"\u5E10\u53F7\u6570\u8D85\u9650\u3002\u5982\u9700\u521B\u5EFA\u591A\u4E8E100\u4E2A\u5E10\u53F7\uFF0C\u8BF7\u5C06\u5E94\u7528\u5347\u7EA7\u4E3A\u4E13\u4E1A\u7248\uFF0C\u5177\u4F53\u64CD\u4F5C\u6307\u5F15\u8BF7\u53C2\u89C1\u8D2D\u4E70\u6307\u5F15(".concat(Qi,"269/32458)\u3002"),70500:"".concat("\u670D\u52A1\u7AEF\u5185\u90E8\u9519\u8BEF\uFF0C\u8BF7\u91CD\u8BD5\u3002"),71e3:"\u5220\u9664\u5E10\u53F7\u5931\u8D25\u3002\u4EC5\u652F\u6301\u5220\u9664\u4F53\u9A8C\u7248\u5E10\u53F7\uFF0C\u60A8\u5F53\u524D\u5E94\u7528\u4E3A\u4E13\u4E1A\u7248\uFF0C\u6682\u4E0D\u652F\u6301\u5E10\u53F7\u5220\u9664\u3002",20001:"\u8BF7\u6C42\u5305\u975E\u6CD5\u3002",20002:"UserSig \u6216 A2 \u5931\u6548\u3002",20003:"\u6D88\u606F\u53D1\u9001\u65B9\u6216\u63A5\u6536\u65B9 UserID \u65E0\u6548\u6216\u4E0D\u5B58\u5728\uFF0C\u8BF7\u68C0\u67E5 UserID \u662F\u5426\u5DF2\u5BFC\u5165\u5373\u65F6\u901A\u4FE1 IM\u3002",20004:"\u7F51\u7EDC\u5F02\u5E38\uFF0C\u8BF7\u91CD\u8BD5\u3002",20005:"".concat("\u670D\u52A1\u7AEF\u5185\u90E8\u9519\u8BEF\uFF0C\u8BF7\u91CD\u8BD5\u3002"),20006:"\u89E6\u53D1\u53D1\u9001".concat("\u5355\u804A\u6D88\u606F","\u4E4B\u524D\u56DE\u8C03\uFF0CApp \u540E\u53F0\u8FD4\u56DE\u7981\u6B62\u4E0B\u53D1\u8BE5\u6D88\u606F\u3002"),20007:"\u53D1\u9001".concat("\u5355\u804A\u6D88\u606F","\uFF0C\u88AB\u5BF9\u65B9\u62C9\u9ED1\uFF0C\u7981\u6B62\u53D1\u9001\u3002\u6D88\u606F\u53D1\u9001\u72B6\u6001\u9ED8\u8BA4\u5C55\u793A\u4E3A\u5931\u8D25\uFF0C\u60A8\u53EF\u4EE5\u767B\u5F55\u63A7\u5236\u53F0\u4FEE\u6539\u8BE5\u573A\u666F\u4E0B\u7684\u6D88\u606F\u53D1\u9001\u72B6\u6001\u5C55\u793A\u7ED3\u679C\uFF0C\u5177\u4F53\u64CD\u4F5C\u8BF7\u53C2\u89C1\u6D88\u606F\u4FDD\u7559\u8BBE\u7F6E(").concat(Qi,"269/38656)\u3002"),20009:"\u6D88\u606F\u53D1\u9001\u53CC\u65B9\u4E92\u76F8\u4E0D\u662F\u597D\u53CB\uFF0C\u7981\u6B62\u53D1\u9001\uFF08\u914D\u7F6E".concat("\u5355\u804A\u6D88\u606F","\u6821\u9A8C\u597D\u53CB\u5173\u7CFB\u624D\u4F1A\u51FA\u73B0\uFF09\u3002"),20010:"\u53D1\u9001".concat("\u5355\u804A\u6D88\u606F","\uFF0C\u81EA\u5DF1\u4E0D\u662F\u5BF9\u65B9\u7684\u597D\u53CB\uFF08\u5355\u5411\u5173\u7CFB\uFF09\uFF0C\u7981\u6B62\u53D1\u9001\u3002"),20011:"\u53D1\u9001".concat("\u5355\u804A\u6D88\u606F","\uFF0C\u5BF9\u65B9\u4E0D\u662F\u81EA\u5DF1\u7684\u597D\u53CB\uFF08\u5355\u5411\u5173\u7CFB\uFF09\uFF0C\u7981\u6B62\u53D1\u9001\u3002"),20012:"\u53D1\u9001\u65B9\u88AB\u7981\u8A00\uFF0C\u8BE5\u6761\u6D88\u606F\u88AB\u7981\u6B62\u53D1\u9001\u3002",20016:"\u6D88\u606F\u64A4\u56DE\u8D85\u8FC7\u4E86\u65F6\u95F4\u9650\u5236\uFF08\u9ED8\u8BA42\u5206\u949F\uFF09\u3002",20018:"\u5220\u9664\u6F2B\u6E38\u5185\u90E8\u9519\u8BEF\u3002",90001:"JSON \u683C\u5F0F\u89E3\u6790\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u8BF7\u6C42\u5305\u662F\u5426\u7B26\u5408 JSON \u89C4\u8303\u3002",90002:"".concat("JSON \u683C\u5F0F\u8BF7\u6C42\u5305\u4F53","\u4E2D MsgBody \u4E0D\u7B26\u5408\u6D88\u606F\u683C\u5F0F\u63CF\u8FF0\uFF0C\u6216\u8005 MsgBody \u4E0D\u662F Array \u7C7B\u578B\uFF0C\u8BF7\u53C2\u8003 TIMMsgElement \u5BF9\u8C61\u7684\u5B9A\u4E49(").concat(Qi,"269/2720").concat(hv,")\u3002"),90003:"".concat("JSON \u683C\u5F0F\u8BF7\u6C42\u5305\u4F53","\u4E2D\u7F3A\u5C11 To_Account \u5B57\u6BB5\u6216\u8005 To_Account \u5E10\u53F7\u4E0D\u5B58\u5728\u3002"),90005:"".concat("JSON \u683C\u5F0F\u8BF7\u6C42\u5305\u4F53","\u4E2D\u7F3A\u5C11 MsgRandom \u5B57\u6BB5\u6216\u8005 MsgRandom \u5B57\u6BB5\u4E0D\u662F Integer \u7C7B\u578B\u3002"),90006:"".concat("JSON \u683C\u5F0F\u8BF7\u6C42\u5305\u4F53","\u4E2D\u7F3A\u5C11 MsgTimeStamp \u5B57\u6BB5\u6216\u8005 MsgTimeStamp \u5B57\u6BB5\u4E0D\u662F Integer \u7C7B\u578B\u3002"),90007:"".concat("JSON \u683C\u5F0F\u8BF7\u6C42\u5305\u4F53","\u4E2D MsgBody \u7C7B\u578B\u4E0D\u662F Array \u7C7B\u578B\uFF0C\u8BF7\u5C06\u5176\u4FEE\u6539\u4E3A Array \u7C7B\u578B\u3002"),90008:"".concat("JSON \u683C\u5F0F\u8BF7\u6C42\u5305\u4F53","\u4E2D\u7F3A\u5C11 From_Account \u5B57\u6BB5\u6216\u8005 From_Account \u5E10\u53F7\u4E0D\u5B58\u5728\u3002"),90009:"\u8BF7\u6C42\u9700\u8981 App \u7BA1\u7406\u5458\u6743\u9650\u3002",90010:"".concat("JSON \u683C\u5F0F\u8BF7\u6C42\u5305\u4F53","\u4E0D\u7B26\u5408\u6D88\u606F\u683C\u5F0F\u63CF\u8FF0\uFF0C\u8BF7\u53C2\u8003 TIMMsgElement \u5BF9\u8C61\u7684\u5B9A\u4E49(").concat(Qi,"269/2720").concat(hv,")\u3002"),90011:"\u6279\u91CF\u53D1\u6D88\u606F\u76EE\u6807\u5E10\u53F7\u8D85\u8FC7500\uFF0C\u8BF7\u51CF\u5C11 To_Account \u4E2D\u76EE\u6807\u5E10\u53F7\u6570\u91CF\u3002",90012:"To_Account \u6CA1\u6709\u6CE8\u518C\u6216\u4E0D\u5B58\u5728\uFF0C\u8BF7\u786E\u8BA4 To_Account \u662F\u5426\u5BFC\u5165\u5373\u65F6\u901A\u4FE1 IM \u6216\u8005\u662F\u5426\u62FC\u5199\u9519\u8BEF\u3002",90026:"\u6D88\u606F\u79BB\u7EBF\u5B58\u50A8\u65F6\u95F4\u9519\u8BEF\uFF08\u6700\u591A\u4E0D\u80FD\u8D85\u8FC77\u5929\uFF09\u3002",90031:"".concat("JSON \u683C\u5F0F\u8BF7\u6C42\u5305\u4F53","\u4E2D SyncOtherMachine \u5B57\u6BB5\u4E0D\u662F Integer \u7C7B\u578B\u3002"),90044:"".concat("JSON \u683C\u5F0F\u8BF7\u6C42\u5305\u4F53","\u4E2D MsgLifeTime \u5B57\u6BB5\u4E0D\u662F Integer \u7C7B\u578B\u3002"),90048:"\u8BF7\u6C42\u7684\u7528\u6237\u5E10\u53F7\u4E0D\u5B58\u5728\u3002",90054:"\u64A4\u56DE\u8BF7\u6C42\u4E2D\u7684 MsgKey \u4E0D\u5408\u6CD5\u3002",90994:"".concat("\u670D\u52A1\u7AEF\u5185\u90E8\u9519\u8BEF\uFF0C\u8BF7\u91CD\u8BD5\u3002"),90995:"".concat("\u670D\u52A1\u7AEF\u5185\u90E8\u9519\u8BEF\uFF0C\u8BF7\u91CD\u8BD5\u3002"),91e3:"".concat("\u670D\u52A1\u7AEF\u5185\u90E8\u9519\u8BEF\uFF0C\u8BF7\u91CD\u8BD5\u3002"),90992:"".concat("\u670D\u52A1\u7AEF\u5185\u90E8\u9519\u8BEF\uFF0C\u8BF7\u91CD\u8BD5\u3002","\u5982\u679C\u6240\u6709\u8BF7\u6C42\u90FD\u8FD4\u56DE\u8BE5\u9519\u8BEF\u7801\uFF0C\u4E14 App \u914D\u7F6E\u4E86\u7B2C\u4E09\u65B9\u56DE\u8C03\uFF0C\u8BF7\u68C0\u67E5 App \u670D\u52A1\u7AEF\u662F\u5426\u6B63\u5E38\u5411\u5373\u65F6\u901A\u4FE1 IM \u540E\u53F0\u670D\u52A1\u7AEF\u8FD4\u56DE\u56DE\u8C03\u7ED3\u679C\u3002"),93e3:"JSON \u6570\u636E\u5305\u8D85\u957F\uFF0C\u6D88\u606F\u5305\u4F53\u8BF7\u4E0D\u8981\u8D85\u8FC78k\u3002",91101:"Web \u7AEF\u957F\u8F6E\u8BE2\u88AB\u8E22\uFF08Web \u7AEF\u540C\u65F6\u5728\u7EBF\u5B9E\u4F8B\u4E2A\u6570\u8D85\u51FA\u9650\u5236\uFF09\u3002",10002:"".concat("\u670D\u52A1\u7AEF\u5185\u90E8\u9519\u8BEF\uFF0C\u8BF7\u91CD\u8BD5\u3002"),10003:"\u8BF7\u6C42\u4E2D\u7684\u63A5\u53E3\u540D\u79F0\u9519\u8BEF\uFF0C\u8BF7\u6838\u5BF9\u63A5\u53E3\u540D\u79F0\u5E76\u91CD\u8BD5\u3002",10004:"\u53C2\u6570\u975E\u6CD5\uFF0C\u8BF7\u6839\u636E\u9519\u8BEF\u63CF\u8FF0\u68C0\u67E5\u8BF7\u6C42\u662F\u5426\u6B63\u786E\u3002",10005:"\u8BF7\u6C42\u5305\u4F53\u4E2D\u643A\u5E26\u7684\u5E10\u53F7\u6570\u91CF\u8FC7\u591A\u3002",10006:"\u64CD\u4F5C\u9891\u7387\u9650\u5236\uFF0C\u8BF7\u5C1D\u8BD5\u964D\u4F4E\u8C03\u7528\u7684\u9891\u7387\u3002",10007:"\u64CD\u4F5C\u6743\u9650\u4E0D\u8DB3\uFF0C\u4F8B\u5982 Work ".concat("\u7FA4\u7EC4","\u4E2D\u666E\u901A\u6210\u5458\u5C1D\u8BD5\u6267\u884C\u8E22\u4EBA\u64CD\u4F5C\uFF0C\u4F46\u53EA\u6709 App \u7BA1\u7406\u5458\u624D\u6709\u6743\u9650\u3002"),10008:"\u8BF7\u6C42\u975E\u6CD5\uFF0C\u53EF\u80FD\u662F\u8BF7\u6C42\u4E2D\u643A\u5E26\u7684\u7B7E\u540D\u4FE1\u606F\u9A8C\u8BC1\u4E0D\u6B63\u786E\uFF0C\u8BF7\u518D\u6B21\u5C1D\u8BD5\u3002",10009:"\u8BE5\u7FA4\u4E0D\u5141\u8BB8\u7FA4\u4E3B\u4E3B\u52A8\u9000\u51FA\u3002",10010:"".concat("\u7FA4\u7EC4","\u4E0D\u5B58\u5728\uFF0C\u6216\u8005\u66FE\u7ECF\u5B58\u5728\u8FC7\uFF0C\u4F46\u662F\u76EE\u524D\u5DF2\u7ECF\u88AB\u89E3\u6563\u3002"),10011:"\u89E3\u6790 JSON \u5305\u4F53\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u5305\u4F53\u7684\u683C\u5F0F\u662F\u5426\u7B26\u5408 JSON \u683C\u5F0F\u3002",10012:"\u53D1\u8D77\u64CD\u4F5C\u7684 UserID \u975E\u6CD5\uFF0C\u8BF7\u68C0\u67E5\u53D1\u8D77\u64CD\u4F5C\u7684\u7528\u6237 UserID \u662F\u5426\u586B\u5199\u6B63\u786E\u3002",10013:"\u88AB\u9080\u8BF7\u52A0\u5165\u7684\u7528\u6237\u5DF2\u7ECF\u662F\u7FA4\u6210\u5458\u3002",10014:"\u7FA4\u5DF2\u6EE1\u5458\uFF0C\u65E0\u6CD5\u5C06\u8BF7\u6C42\u4E2D\u7684\u7528\u6237\u52A0\u5165".concat("\u7FA4\u7EC4","\uFF0C\u5982\u679C\u662F\u6279\u91CF\u52A0\u4EBA\uFF0C\u53EF\u4EE5\u5C1D\u8BD5\u51CF\u5C11\u52A0\u5165\u7528\u6237\u7684\u6570\u91CF\u3002"),10015:"\u627E\u4E0D\u5230\u6307\u5B9A ID \u7684".concat("\u7FA4\u7EC4","\u3002"),10016:"App \u540E\u53F0\u901A\u8FC7\u7B2C\u4E09\u65B9\u56DE\u8C03\u62D2\u7EDD\u672C\u6B21\u64CD\u4F5C\u3002",10017:"\u56E0\u88AB\u7981\u8A00\u800C\u4E0D\u80FD\u53D1\u9001\u6D88\u606F\uFF0C\u8BF7\u68C0\u67E5\u53D1\u9001\u8005\u662F\u5426\u88AB\u8BBE\u7F6E\u7981\u8A00\u3002",10018:"\u5E94\u7B54\u5305\u957F\u5EA6\u8D85\u8FC7\u6700\u5927\u5305\u957F\uFF081MB\uFF09\uFF0C\u8BF7\u6C42\u7684\u5185\u5BB9\u8FC7\u591A\uFF0C\u8BF7\u5C1D\u8BD5\u51CF\u5C11\u5355\u6B21\u8BF7\u6C42\u7684\u6570\u636E\u91CF\u3002",10019:"\u8BF7\u6C42\u7684\u7528\u6237\u5E10\u53F7\u4E0D\u5B58\u5728\u3002",10021:"".concat("\u7FA4\u7EC4"," ID \u5DF2\u88AB\u4F7F\u7528\uFF0C\u8BF7\u9009\u62E9\u5176\u4ED6\u7684").concat("\u7FA4\u7EC4"," ID\u3002"),10023:"\u53D1\u6D88\u606F\u7684\u9891\u7387\u8D85\u9650\uFF0C\u8BF7\u5EF6\u957F\u4E24\u6B21\u53D1\u6D88\u606F\u65F6\u95F4\u7684\u95F4\u9694\u3002",10024:"\u6B64\u9080\u8BF7\u6216\u8005\u7533\u8BF7\u8BF7\u6C42\u5DF2\u7ECF\u88AB\u5904\u7406\u3002",10025:"".concat("\u7FA4\u7EC4"," ID \u5DF2\u88AB\u4F7F\u7528\uFF0C\u5E76\u4E14\u64CD\u4F5C\u8005\u4E3A\u7FA4\u4E3B\uFF0C\u53EF\u4EE5\u76F4\u63A5\u4F7F\u7528\u3002"),10026:"\u8BE5 SDKAppID \u8BF7\u6C42\u7684\u547D\u4EE4\u5B57\u5DF2\u88AB\u7981\u7528\u3002",10030:"\u8BF7\u6C42\u64A4\u56DE\u7684\u6D88\u606F\u4E0D\u5B58\u5728\u3002",10031:"\u6D88\u606F\u64A4\u56DE\u8D85\u8FC7\u4E86\u65F6\u95F4\u9650\u5236\uFF08\u9ED8\u8BA42\u5206\u949F\uFF09\u3002",10032:"\u8BF7\u6C42\u64A4\u56DE\u7684\u6D88\u606F\u4E0D\u652F\u6301\u64A4\u56DE\u64CD\u4F5C\u3002",10033:"".concat("\u7FA4\u7EC4","\u7C7B\u578B\u4E0D\u652F\u6301\u6D88\u606F\u64A4\u56DE\u64CD\u4F5C\u3002"),10034:"\u8BE5\u6D88\u606F\u7C7B\u578B\u4E0D\u652F\u6301\u5220\u9664\u64CD\u4F5C\u3002",10035:"\u76F4\u64AD\u7FA4\u548C\u5728\u7EBF\u6210\u5458\u5E7F\u64AD\u5927\u7FA4\u4E0D\u652F\u6301\u5220\u9664\u6D88\u606F\u3002",10036:"\u76F4\u64AD\u7FA4\u521B\u5EFA\u6570\u91CF\u8D85\u8FC7\u4E86\u9650\u5236\uFF0C\u8BF7\u53C2\u8003\u4EF7\u683C\u8BF4\u660E(".concat(Qi,"269/11673)\u8D2D\u4E70\u9884\u4ED8\u8D39\u5957\u9910\u201CIM\u76F4\u64AD\u7FA4\u201D\u3002"),10037:"\u5355\u4E2A\u7528\u6237\u53EF\u521B\u5EFA\u548C\u52A0\u5165\u7684".concat("\u7FA4\u7EC4","\u6570\u91CF\u8D85\u8FC7\u4E86\u9650\u5236\uFF0C\u8BF7\u53C2\u8003\u4EF7\u683C\u8BF4\u660E(").concat(Qi,"269/11673)\u8D2D\u4E70\u6216\u5347\u7EA7\u9884\u4ED8\u8D39\u5957\u9910\u201C\u5355\u4EBA\u53EF\u521B\u5EFA\u4E0E\u52A0\u5165").concat("\u7FA4\u7EC4","\u6570\u201D\u3002"),10038:"\u7FA4\u6210\u5458\u6570\u91CF\u8D85\u8FC7\u9650\u5236\uFF0C\u8BF7\u53C2\u8003\u4EF7\u683C\u8BF4\u660E(".concat(Qi,"269/11673)\u8D2D\u4E70\u6216\u5347\u7EA7\u9884\u4ED8\u8D39\u5957\u9910\u201C\u6269\u5C55\u7FA4\u4EBA\u6570\u4E0A\u9650\u201D\u3002"),10041:"\u8BE5\u5E94\u7528\uFF08SDKAppID\uFF09\u5DF2\u914D\u7F6E\u4E0D\u652F\u6301\u7FA4\u6D88\u606F\u64A4\u56DE\u3002",10050:"\u7FA4\u5C5E\u6027 key \u4E0D\u5B58\u5728",10056:"\u8BF7\u5728\u5199\u5165\u7FA4\u5C5E\u6027\u524D\u5148\u4F7F\u7528 getGroupAttributes \u63A5\u53E3\u66F4\u65B0\u672C\u5730\u7FA4\u5C5E\u6027\uFF0C\u907F\u514D\u51B2\u7A81\u3002",10059:"\u975E\u65D7\u8230\u7248",10060:"\u7FA4\u4EBA\u6570\u8D85\u8FC7\u5DF2\u8BFB\u56DE\u6267\u4EBA\u6570\u4E0A\u9650",10061:"\u5728\u7EBF\u6D88\u606F\u4E0D\u652F\u6301\u5DF2\u8BFB\u56DE\u6267",10062:"\u627E\u4E0D\u5230\u7FA4\u6D88\u606F\u7684\u5DF2\u8BFB\u56DE\u6267\u4FE1\u606F",20026:"\u6D88\u606F\u4E0D\u5B58\u5728",20029:"\u8BE5\u7FA4\u7C7B\u578B\u4E0D\u652F\u6301\u4FEE\u6539\u6D88\u606F\u3002",30001:"\u8BF7\u6C42\u53C2\u6570\u9519\u8BEF\uFF0C\u8BF7\u6839\u636E\u9519\u8BEF\u63CF\u8FF0\u68C0\u67E5\u8BF7\u6C42\u53C2\u6570",30002:"SDKAppID \u4E0D\u5339\u914D",30003:"\u8BF7\u6C42\u7684\u7528\u6237\u5E10\u53F7\u4E0D\u5B58\u5728",30004:"\u8BF7\u6C42\u9700\u8981 App \u7BA1\u7406\u5458\u6743\u9650",30005:"\u5173\u7CFB\u94FE\u5B57\u6BB5\u4E2D\u5305\u542B\u654F\u611F\u8BCD",30006:"".concat("\u670D\u52A1\u7AEF\u5185\u90E8\u9519\u8BEF\uFF0C\u8BF7\u91CD\u8BD5\u3002"),30007:"".concat("\u7F51\u7EDC\u8D85\u65F6\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5. "),30008:"\u5E76\u53D1\u5199\u5BFC\u81F4\u5199\u51B2\u7A81\uFF0C\u5EFA\u8BAE\u4F7F\u7528\u6279\u91CF\u65B9\u5F0F",30009:"\u540E\u53F0\u7981\u6B62\u8BE5\u7528\u6237\u53D1\u8D77\u52A0\u597D\u53CB\u8BF7\u6C42",30010:"\u81EA\u5DF1\u7684\u597D\u53CB\u6570\u5DF2\u8FBE\u7CFB\u7EDF\u4E0A\u9650",30011:"\u5206\u7EC4\u5DF2\u8FBE\u7CFB\u7EDF\u4E0A\u9650",30012:"\u672A\u51B3\u6570\u5DF2\u8FBE\u7CFB\u7EDF\u4E0A\u9650",30014:"\u5BF9\u65B9\u7684\u597D\u53CB\u6570\u5DF2\u8FBE\u7CFB\u7EDF\u4E0A\u9650",30515:"\u8BF7\u6C42\u6DFB\u52A0\u597D\u53CB\u65F6\uFF0C\u5BF9\u65B9\u5728\u81EA\u5DF1\u7684\u9ED1\u540D\u5355\u4E2D\uFF0C\u4E0D\u5141\u8BB8\u52A0\u597D\u53CB",30516:"\u8BF7\u6C42\u6DFB\u52A0\u597D\u53CB\u65F6\uFF0C\u5BF9\u65B9\u7684\u52A0\u597D\u53CB\u9A8C\u8BC1\u65B9\u5F0F\u662F\u4E0D\u5141\u8BB8\u4EFB\u4F55\u4EBA\u6DFB\u52A0\u81EA\u5DF1\u4E3A\u597D\u53CB",30525:"\u8BF7\u6C42\u6DFB\u52A0\u597D\u53CB\u65F6\uFF0C\u81EA\u5DF1\u5728\u5BF9\u65B9\u7684\u9ED1\u540D\u5355\u4E2D\uFF0C\u4E0D\u5141\u8BB8\u52A0\u597D\u53CB",30539:"\u7B49\u5F85\u5BF9\u65B9\u540C\u610F",30540:"\u6DFB\u52A0\u597D\u53CB\u8BF7\u6C42\u88AB\u5B89\u5168\u7B56\u7565\u6253\u51FB\uFF0C\u8BF7\u52FF\u9891\u7E41\u53D1\u8D77\u6DFB\u52A0\u597D\u53CB\u8BF7\u6C42",31704:"\u4E0E\u8BF7\u6C42\u5220\u9664\u7684\u5E10\u53F7\u4E4B\u95F4\u4E0D\u5B58\u5728\u597D\u53CB\u5173\u7CFB",31707:"\u5220\u9664\u597D\u53CB\u8BF7\u6C42\u88AB\u5B89\u5168\u7B56\u7565\u6253\u51FB\uFF0C\u8BF7\u52FF\u9891\u7E41\u53D1\u8D77\u5220\u9664\u597D\u53CB\u8BF7\u6C42"},Me=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this)).code=e.code,n.message=Wc[e.code]||e.message,n.data=e.data||{},n}return x(o)}(Y(Error)),zc=null,iE=function(a){zc=a},En=function(a){return Promise.resolve(Wt(a))},Le=function(a){var t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(a instanceof Me)return t&&zc!==null&&zc.emit(mn.ERROR,a),Promise.reject(a);if(a instanceof Error){var o=new Me({code:We.UNCAUGHT_ERROR,message:a.message});return t&&zc!==null&&zc.emit(mn.ERROR,o),Promise.reject(o)}if(Ke(a)||Ke(a.code)||Ke(a.message))V.error("IMPromise.reject \u5FC5\u987B\u6307\u5B9Acode(\u9519\u8BEF\u7801)\u548Cmessage(\u9519\u8BEF\u4FE1\u606F)!!!");else{if(gr(a.code)&&Ln(a.message)){var e=new Me(a);return t&&zc!==null&&zc.emit(mn.ERROR,e),Promise.reject(e)}V.error("IMPromise.reject code(\u9519\u8BEF\u7801)\u5FC5\u987B\u4E3A\u6570\u5B57\uFF0Cmessage(\u9519\u8BEF\u4FE1\u606F)\u5FC5\u987B\u4E3A\u5B57\u7B26\u4E32!!!")}},Of=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this,e))._className="C2CModule",n._messageFromUnreadDBMap=new Map,n}return x(o,[{key:"onNewC2CMessage",value:function(e){var n=e.dataList,l=e.isInstantMessage,h=e.C2CRemainingUnreadList,_=e.C2CPairUnreadList;V.debug("".concat(this._className,".onNewC2CMessage count:").concat(n.length," isInstantMessage:").concat(l));var S=this._newC2CMessageStoredAndSummary({dataList:n,C2CRemainingUnreadList:h,C2CPairUnreadList:_,isInstantMessage:l}),E=S.conversationOptionsList,M=S.messageList,w=S.isUnreadC2CMessage;this.filterModifiedMessage(M),E.length>0&&this.getModule(Vt).onNewMessage({conversationOptionsList:E,isInstantMessage:l,isUnreadC2CMessage:w});var L=this.filterUnmodifiedMessage(M);l&&L.length>0&&this.emitOuterEvent(mn.MESSAGE_RECEIVED,L),M.length=0}},{key:"_newC2CMessageStoredAndSummary",value:function(e){for(var n=e.dataList,l=e.C2CRemainingUnreadList,h=e.C2CPairUnreadList,_=e.isInstantMessage,S=null,E=[],M=[],w={},L=this.getModule(Ym),H=this.getModule(Ur),ne=!1,ae=this.getModule(Vt),he=0,ge=n.length;he<ge;he++){var Te=n[he];Te.currentUser=this.getMyUserID(),Te.conversationType=Z.CONV_C2C,Te.isSystemMessage=!!Te.isSystemMessage,(Ke(Te.nick)||Ke(Te.avatar))&&(ne=!0,V.debug("".concat(this._className,"._newC2CMessageStoredAndSummary nick or avatar missing!"))),S=new Bi(Te),Te.elements=L.parseElements(Te.elements,Te.from),S.setElement(Te.elements),S.setNickAndAvatar({nick:Te.nick,avatar:Te.avatar});var Ze=S.conversationID;if(_){if(this._messageFromUnreadDBMap.get(S.ID)===1)continue;var Ct=!1;if(S.from!==this.getMyUserID()){var wt=ae.getLatestMessageSentByPeer(Ze);if(wt){var dn=wt.nick,$t=wt.avatar;ne?S.setNickAndAvatar({nick:dn,avatar:$t}):dn===S.nick&&$t===S.avatar||(Ct=!0)}}else{var Kn=ae.getLatestMessageSentByMe(Ze);if(Kn){var xn=Kn.nick,On=Kn.avatar;xn===S.nick&&On===S.avatar||ae.modifyMessageSentByMe({conversationID:Ze,latestNick:S.nick,latestAvatar:S.avatar})}}var ar=n[he].isModified===1;if(ae.isMessageSentByCurrentInstance(S)?S.isModified=ar:ar=!1,Te.msgLifeTime===0)S._onlineOnlyFlag=!0,ae.isMessageSentByCurrentInstance(S)||M.push(S);else{if(!ae.pushIntoMessageList(M,S,ar))continue;Ct&&(ae.modifyMessageSentByPeer({conversationID:Ze,latestNick:S.nick,latestAvatar:S.avatar}),ae.updateUserProfileSpecifiedKey({conversationID:Ze,nick:S.nick,avatar:S.avatar}))}_&&S.clientTime>0&&H.addMessageDelay(S.clientTime)}else this._messageFromUnreadDBMap.set(S.ID,1);if(Te.msgLifeTime!==0){if(S._onlineOnlyFlag===!1){var yr=ae.getLastMessageTime(Ze);if(gr(yr)&&S.time<yr)continue;if(Ke(w[Ze])){var Mi=0;S.flow==="in"&&(S._isExcludedFromUnreadCount||(Mi=1)),w[Ze]=E.push({conversationID:Ze,unreadCount:Mi,type:S.conversationType,subType:S.conversationSubType,lastMessage:S._isExcludedFromLastMessage?"":S})-1}else{var Ko=w[Ze];E[Ko].type=S.conversationType,E[Ko].subType=S.conversationSubType,E[Ko].lastMessage=S._isExcludedFromLastMessage?"":S,S.flow==="in"&&(S._isExcludedFromUnreadCount||E[Ko].unreadCount++)}}}else S._onlineOnlyFlag=!0}var fa=!1;if(Yt(h))for(var To=function(mr,tc){if(h[mr].unreadCount>0){fa=!0;var Yo=E.find(function(Is){return Is.conversationID==="C2C".concat(h[mr].from)});Yo?Yo.unreadCount=h[mr].unreadCount:E.push({conversationID:"C2C".concat(h[mr].from),unreadCount:h[mr].unreadCount,type:Z.CONV_C2C})}},Dr=0,Wo=h.length;Dr<Wo;Dr++)To(Dr);if(Yt(l))for(var eu=function(mr,tc){E.find(function(Yo){return Yo.conversationID==="C2C".concat(l[mr].from)})||E.push({conversationID:"C2C".concat(l[mr].from),type:Z.CONV_C2C,lastMsgTime:l[mr].lastMsgTime})},Jf=0,zo=l.length;Jf<zo;Jf++)eu(Jf);return{conversationOptionsList:E,messageList:M,isUnreadC2CMessage:fa}}},{key:"onC2CMessageRevoked",value:function(e){var n=this;V.debug("".concat(this._className,".onC2CMessageRevoked count:").concat(e.dataList.length));var l=this.getModule(Vt),h=[],_=null;e.dataList.forEach(function(S){if(S.c2cMessageRevokedNotify){var E=S.c2cMessageRevokedNotify.revokedInfos;Ke(E)||E.forEach(function(M){var w=n.getMyUserID()===M.from?"".concat(Z.CONV_C2C).concat(M.to):"".concat(Z.CONV_C2C).concat(M.from);(_=l.revoke(w,M.sequence,M.random))&&h.push(_)})}}),h.length!==0&&(l.onMessageRevoked(h),this.emitOuterEvent(mn.MESSAGE_REVOKED,h))}},{key:"onC2CMessageReadReceipt",value:function(e){var n=this;e.dataList.forEach(function(l){if(!Mt(l.c2cMessageReadReceipt)){var h=l.c2cMessageReadReceipt.to;l.c2cMessageReadReceipt.uinPairReadArray.forEach(function(_){var S=_.peerReadTime;V.debug("".concat(n._className,"._onC2CMessageReadReceipt to:").concat(h," peerReadTime:").concat(S));var E="".concat(Z.CONV_C2C).concat(h),M=n.getModule(Vt);M.recordPeerReadTime(E,S),M.updateMessageIsPeerReadProperty(E,S)})}})}},{key:"onC2CMessageReadNotice",value:function(e){var n=this;e.dataList.forEach(function(l){if(!Mt(l.c2cMessageReadNotice)){var h=n.getModule(Vt);l.c2cMessageReadNotice.uinPairReadArray.forEach(function(_){var S=_.from,E=_.peerReadTime;V.debug("".concat(n._className,".onC2CMessageReadNotice from:").concat(S," lastReadTime:").concat(E));var M="".concat(Z.CONV_C2C).concat(S);h.updateIsReadAfterReadReport({conversationID:M,lastMessageTime:E}),h.updateUnreadCount(M)})}})}},{key:"onC2CMessageModified",value:function(e){V.debug("".concat(this._className,".onC2CMessageModified options:"),JSON.stringify(e));var n=this.getModule(Vt);e.dataList.forEach(function(l){n.onMessageModified(m(m({},l),{},{conversationType:Z.CONV_C2C}))})}},{key:"onReadReceiptList",value:function(e){V.debug("".concat(this._className,".onReadReceiptList options:"),JSON.stringify(e));var n=e.dataList,l=n.userID,h=n.readReceiptList;this.getModule(Vt).updateReadReceiptInfo({userID:l,readReceiptList:h})}},{key:"sendMessage",value:function(e,n){var l=this._createC2CMessagePack(e,n);return this.request(l)}},{key:"_createC2CMessagePack",value:function(e,n){var l=null;n&&(n.offlinePushInfo&&(l=n.offlinePushInfo),n.onlineUserOnly===!0&&(l?l.disablePush=!0:l={disablePush:!0}));var h="";Ln(e.cloudCustomData)&&e.cloudCustomData.length>0&&(h=e.cloudCustomData);var _=[];if(Br(n)&&Br(n.messageControlInfo)){var S=n.messageControlInfo,E=S.excludedFromUnreadCount,M=S.excludedFromLastMessage;E===!0&&_.push("NoUnread"),M===!0&&_.push("NoLastMsg")}return{protocolName:fy,tjgID:this.generateTjgID(e),requestData:{fromAccount:this.getMyUserID(),toAccount:e.to,msgBody:e.getElements(),cloudCustomData:h,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:this.isOnlineMessage(e,n)?0:void 0,nick:e.nick,avatar:e.avatar,offlinePushInfo:l?{pushFlag:l.disablePush===!0?1:0,title:l.title||"",desc:l.description||"",ext:l.extension||"",apnsInfo:{badgeMode:l.ignoreIOSBadge===!0?1:0},androidInfo:{OPPOChannelID:l.androidOPPOChannelID||""}}:void 0,messageControlInfo:_,clientTime:e.clientTime,needReadReceipt:e.needReadReceipt===!0?1:0}}}},{key:"isOnlineMessage",value:function(e,n){return!(!n||n.onlineUserOnly!==!0)}},{key:"revokeMessage",value:function(e){return this.request({protocolName:dI,requestData:{msgInfo:{fromAccount:e.from,toAccount:e.to,msgSeq:e.sequence,msgRandom:e.random,msgTimeStamp:e.time}}})}},{key:"deleteMessage",value:function(e){var n=e.to,l=e.keyList;return V.log("".concat(this._className,".deleteMessage toAccount:").concat(n," count:").concat(l.length)),this.request({protocolName:gI,requestData:{fromAccount:this.getMyUserID(),to:n,keyList:l}})}},{key:"modifyRemoteMessage",value:function(e){var n=e.from,l=e.to,h=e.version,_=h===void 0?0:h,S=e.sequence,E=e.random,M=e.time,w=e.payload,L=e.type,H=e.cloudCustomData,ne=void 0;return BT(L)&&(ne=[]).push({type:L,content:w}),this.request({protocolName:mI,requestData:{from:n,to:l,version:_,sequence:S,random:E,time:M,elements:ne,cloudCustomData:H}})}},{key:"setMessageRead",value:function(e){var n=this,l=e.conversationID,h=e.lastMessageTime,_="".concat(this._className,".setMessageRead");V.log("".concat(_," conversationID:").concat(l," lastMessageTime:").concat(h)),gr(h)||V.warn("".concat(_," \u8BF7\u52FF\u4FEE\u6539 Conversation.lastMessage.lastTime\uFF0C\u5426\u5219\u53EF\u80FD\u4F1A\u5BFC\u81F4\u5DF2\u8BFB\u4E0A\u62A5\u7ED3\u679C\u4E0D\u51C6\u786E"));var S=new ht(yt.SET_C2C_MESSAGE_READ);return S.setMessage("conversationID:".concat(l," lastMessageTime:").concat(h)),this.request({protocolName:nM,requestData:{C2CMsgReaded:{cookie:"",C2CMsgReadedItem:[{toAccount:l.replace("C2C",""),lastMessageTime:h,receipt:1}]}}}).then(function(){S.setNetworkType(n.getNetworkType()).end(),V.log("".concat(_," ok"));var E=n.getModule(Vt);return E.updateIsReadAfterReadReport({conversationID:l,lastMessageTime:h}),E.updateUnreadCount(l),Wt()}).catch(function(E){return n.probeNetwork().then(function(M){var w=Ue(M,2),L=w[0],H=w[1];S.setError(E,L,H).end()}),V.log("".concat(_," failed. error:"),E),Le(E)})}},{key:"getRoamingMessage",value:function(e){var n=this,l="".concat(this._className,".getRoamingMessage"),h=e.peerAccount,_=e.conversationID,S=e.count,E=e.lastMessageTime,M=e.messageKey,w="peerAccount:".concat(h," count:").concat(S||15," lastMessageTime:").concat(E||0," messageKey:").concat(M);V.log("".concat(l," ").concat(w));var L=new ht(yt.GET_C2C_ROAMING_MESSAGES);return this.request({protocolName:gy,requestData:{peerAccount:h,count:S||15,lastMessageTime:E||0,messageKey:M}}).then(function(H){var ne=H.data,ae=ne.complete,he=ne.messageList,ge=ne.messageKey,Te=ne.lastMessageTime;Ke(he)?V.log("".concat(l," ok. complete:").concat(ae," but messageList is undefined!")):V.log("".concat(l," ok. complete:").concat(ae," count:").concat(he.length)),L.setNetworkType(n.getNetworkType()).setMessage("".concat(w," complete:").concat(ae," length:").concat(he.length)).end();var Ze=n.getModule(Vt);ae===1&&Ze.setCompleted(_);var Ct=Ze.onRoamingMessage(he,_);Ze.modifyMessageList(_),Ze.updateIsRead(_),Ze.updateRoamingMessageKeyAndTime(_,ge,Te);var wt=Ze.getPeerReadTime(_);if(V.log("".concat(l," update isPeerRead property. conversationID:").concat(_," peerReadTime:").concat(wt)),wt)Ze.updateMessageIsPeerReadProperty(_,wt);else{var dn=_.replace(Z.CONV_C2C,"");n.getRemotePeerReadTime([dn]).then(function(){Ze.updateMessageIsPeerReadProperty(_,Ze.getPeerReadTime(_))})}var $t="";if(Ct.length>0)$t=Ct[0].ID;else{var Kn=Ze.getLocalOldestMessage(_);Kn&&($t=Kn.ID)}return V.log("".concat(l," nextReqID:").concat($t," stored message count:").concat(Ct.length)),{nextReqID:$t,storedMessageList:Ct}}).catch(function(H){return n.probeNetwork().then(function(ne){var ae=Ue(ne,2),he=ae[0],ge=ae[1];L.setMessage(w).setError(H,he,ge).end()}),V.warn("".concat(l," failed. error:"),H),Le(H)})}},{key:"getRoamingMessagesHopping",value:function(e){var n=this,l="".concat(this._className,".getRoamingMessagesHopping"),h=e.peerAccount,_=e.time,S=_===void 0?0:_,E=e.count,M=e.direction,w="".concat(Z.CONV_C2C).concat(h),L="peerAccount:".concat(h," count:").concat(E," time:").concat(S," direction:").concat(M);V.log("".concat(l," ").concat(L));var H=new ht(yt.GET_C2C_ROAMING_MESSAGES_HOPPING);return this.request({protocolName:gy,requestData:{peerAccount:h,count:E+1,lastMessageTime:S,direction:M}}).then(function(ne){var ae=ne.data,he=ae.complete,ge=ae.messageList,Te=ge===void 0?[]:ge,Ze=ae.lastMessageTime;V.log("".concat(l," ok. complete:").concat(he," count:").concat(Te.length)),H.setNetworkType(n.getNetworkType()).setMessage("".concat(L," complete:").concat(he," length:").concat(Te.length)).end(),he!==1&&(M===1?Te.pop():Te.shift());var Ct=n.getModule(Vt).onRoamingMessage(Te,w,!1);n._modifyMessageList(w,Ct);var wt=n._computeResult({complete:he,lastMessageTime:Ze,resultList:Ct});return Wt(wt)}).catch(function(ne){return n.probeNetwork().then(function(ae){var he=Ue(ae,2),ge=he[0],Te=he[1];H.setMessage(L).setError(ne,ge,Te).end()}),V.warn("".concat(l," failed. error:"),ne),Le(ne)})}},{key:"_computeResult",value:function(e){var n=e.complete,l=n===void 0?0:n,h=e.lastMessageTime,_=e.resultList,S={messageList:Be(_===void 0?[]:_),isCompleted:!1,nextMessageTime:""};return l===1?(S.isCompleted=!0,S):(S.nextMessageTime=h,S)}},{key:"_modifyMessageList",value:function(e,n){var l=this.getModule(Vt).getLocalConversation(e);if(l)for(var h=l.userProfile.nick,_=l.userProfile.avatar,S=this.getModule(Ei).getNickAndAvatarByUserID(this.getMyUserID()),E=S.nick,M=S.avatar,w=n.length-1;w>=0;w--){var L=n[w];L.flow==="in"&&(L.nick!==h&&L.setNickAndAvatar({nick:h}),L.avatar!==_&&L.setNickAndAvatar({avatar:_})),L.flow==="out"&&(L.nick!==E&&L.setNickAndAvatar({nick:E}),L.avatar!==M&&L.setNickAndAvatar({avatar:M}))}}},{key:"getRemotePeerReadTime",value:function(e){var n=this,l="".concat(this._className,".getRemotePeerReadTime");if(Mt(e))return V.warn("".concat(l," userIDList is empty!")),Promise.resolve();var h=new ht(yt.GET_PEER_READ_TIME);return V.log("".concat(l," userIDList:").concat(e)),this.request({protocolName:fI,requestData:{userIDList:e}}).then(function(_){var S=_.data.peerReadTimeList;V.log("".concat(l," ok. peerReadTimeList:").concat(S));for(var E="",M=n.getModule(Vt),w=0;w<e.length;w++)E+="".concat(e[w],"-").concat(S[w]," "),S[w]>0&&M.recordPeerReadTime("C2C".concat(e[w]),S[w]);h.setNetworkType(n.getNetworkType()).setMessage(E).end()}).catch(function(_){n.probeNetwork().then(function(S){var E=Ue(S,2),M=E[0],w=E[1];h.setError(_,M,w).end()}),V.warn("".concat(l," failed. error:"),_)})}},{key:"sendReadReceipt",value:function(e){var n=this,l=e[0].conversationID.replace(Z.CONV_C2C,""),h=new ht(yt.SEND_C2C_READ_RECEIPT);h.setMessage("peerAccount:".concat(l));var _=this.getMyUserID(),S=e.filter(function(M){return M.from!==_&&M.needReadReceipt===!0}).map(function(M){return{fromAccount:M.from,toAccount:M.to,sequence:M.sequence,random:M.random,time:M.time,clientTime:M.clientTime}});if(S.length===0)return Le({code:We.READ_RECEIPT_MESSAGE_LIST_EMPTY,message:at.READ_RECEIPT_MESSAGE_LIST_EMPTY});var E="".concat(this._className,".sendReadReceipt");return V.log("".concat(E,". peerAccount:").concat(l," messageInfoList length:").concat(S.length)),this.request({protocolName:$u,requestData:{peerAccount:l,messageInfoList:S}}).then(function(M){return h.end(),V.log("".concat(E," ok")),Wt()}).catch(function(M){return n.probeNetwork().then(function(w){var L=Ue(w,2),H=L[0],ne=L[1];h.setError(M,H,ne).end()}),V.warn("".concat(E," failed. error:"),M),Le(M)})}},{key:"getReadReceiptList",value:function(e){var n="".concat(this._className,".getReadReceiptList"),l=this.getMyUserID(),h=e.filter(function(_){return _.from===l&&_.needReadReceipt===!0});return V.log("".concat(n," userID:").concat(l," messageList length:").concat(h.length)),En({messageList:h})}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),this._messageFromUnreadDBMap.clear()}}]),o}(Ti),zy=nn.match(/firefox\/(\d+)/i),Nf=!!zy&&+zy[1],pv=/MSIE|Trident/.test(nn),Yy=nn.match(/AppleWebKit\/(\d+)\./),Lf=!!Yy&&+Yy[1],Yc=[],Jy=ve(Yc.sort),Xy=ve(Yc.push),dR=xe(function(){Yc.sort(void 0)}),oE=xe(function(){Yc.sort(null)}),hR=Cl("sort"),Qy=!xe(function(){if(Ge)return Ge<70;if(!(Nf&&Nf>3)){if(pv)return!0;if(Lf)return Lf<603;var a,t,o,e,n="";for(a=65;a<76;a++){switch(t=String.fromCharCode(a),a){case 66:case 69:case 70:case 72:o=3;break;case 68:case 71:o=4;break;default:o=2}for(e=0;e<47;e++)Yc.push({k:t+e,v:o})}for(Yc.sort(function(l,h){return h.v-l.v}),e=0;e<Yc.length;e++)t=Yc[e].k.charAt(0),n.charAt(n.length-1)!==t&&(n+=t);return n!=="DGBEFHACIJK"}});sn({target:"Array",proto:!0,forced:dR||!oE||!hR||!Qy},{sort:function(a){a!==void 0&&er(a);var t=fr(this);if(Qy)return a===void 0?Jy(t):Jy(t,a);var o,e,n=[],l=xr(t);for(e=0;e<l;e++)e in t&&Xy(n,t[e]);for(jI(n,function(h){return function(_,S){return S===void 0?-1:_===void 0?1:h!==void 0?+h(_,S)||0:fn(_)>fn(S)?1:-1}}(a)),o=n.length,e=0;e<o;)t[e]=n[e++];for(;e<l;)delete t[e++];return t}});var CA=Ui.findIndex,aE=!0;"findIndex"in[]&&Array(1).findIndex(function(){aE=!1}),sn({target:"Array",proto:!0,forced:aE},{findIndex:function(a){return CA(this,a,arguments.length>1?arguments[1]:void 0)}}),Eu("findIndex");var fv=function(){function a(){A(this,a),this.list=new Map,this._className="MessageListHandler",this._latestMessageSentByPeerMap=new Map,this._latestMessageSentByMeMap=new Map,this._groupLocalLastMessageSequenceMap=new Map}return x(a,[{key:"getLocalOldestMessageByConversationID",value:function(t){if(!t||!this.list.has(t))return null;var o=this.list.get(t).values();return o?o.next().value:null}},{key:"pushIn",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0&&arguments[1],e=t.conversationID,n=!0;this.list.has(e)||this.list.set(e,new Map);var l=this._getUniqueIDOfMessage(t),h=this.list.get(e).has(l);if(h){var _=this.list.get(e).get(l);if(!o||_.isModified===!0)return n=!1}return this.list.get(e).set(l,t),this._setLatestMessageSentByPeer(e,t),this._setLatestMessageSentByMe(e,t),this._setGroupLocalLastMessageSequence(e,t),n}},{key:"unshift",value:function(t,o){var e;if(Yt(t)){if(t.length>0){e=t[0].conversationID;var n=t.length;this._unshiftMultipleMessages(t,o),this._setGroupLocalLastMessageSequence(e,t[n-1])}}else e=t.conversationID,this._unshiftSingleMessage(t,o),this._setGroupLocalLastMessageSequence(e,t);if(e&&e.startsWith(Z.CONV_C2C)){var l=Array.from(this.list.get(e).values()),h=l.length;if(h===0)return;for(var _=h-1;_>=0;_--)if(l[_].flow==="out"){this._setLatestMessageSentByMe(e,l[_]);break}for(var S=h-1;S>=0;S--)if(l[S].flow==="in"){this._setLatestMessageSentByPeer(e,l[S]);break}}}},{key:"_unshiftSingleMessage",value:function(t,o){var e=t.conversationID,n=this._getUniqueIDOfMessage(t);if(!this.list.has(e))return this.list.set(e,new Map),this.list.get(e).set(n,t),void o.push(t);var l=this.list.get(e),h=Array.from(l);l.has(n)||(h.unshift([n,t]),this.list.set(e,new Map(h)),o.push(t))}},{key:"_unshiftMultipleMessages",value:function(t,o){for(var e=t.length,n=[],l=t[0].conversationID,h=this.list.get(l),_=this.list.has(l)?Array.from(h):[],S=0;S<e;S++){var E=this._getUniqueIDOfMessage(t[S]);h&&h.has(E)||(n.push([E,t[S]]),o.push(t[S]))}this.list.set(l,new Map(n.concat(_)))}},{key:"remove",value:function(t){var o=t.conversationID,e=this._getUniqueIDOfMessage(t);this.list.has(o)&&this.list.get(o).delete(e)}},{key:"revoke",value:function(t,o,e){if(V.debug("revoke message",t,o,e),this.list.has(t)){var n,l=De(this.list.get(t));try{for(l.s();!(n=l.n()).done;){var h=Ue(n.value,2)[1];if(h.sequence===o&&!h.isRevoked&&(Ke(e)||h.random===e))return h.isRevoked=!0,h}}catch(_){l.e(_)}finally{l.f()}}return null}},{key:"removeByConversationID",value:function(t){this.list.has(t)&&(this.list.delete(t),this._latestMessageSentByPeerMap.delete(t),this._latestMessageSentByMeMap.delete(t))}},{key:"findMessage",value:function(t){var o,e=null,n=De(this.list);try{for(n.s();!(o=n.n()).done;)for(var l=Be(Ue(o.value,2)[1].values()),h=l.length,_=0;_<h;_++)if(l[_].ID===t){e=l[_];break}}catch(S){n.e(S)}finally{n.f()}return e}},{key:"updateMessageIsPeerReadProperty",value:function(t,o){var e=[];if(this.list.has(t)){var n,l=De(this.list.get(t));try{for(l.s();!(n=l.n()).done;){var h=Ue(n.value,2)[1];h.time<=o&&!h.isPeerRead&&h.flow==="out"&&(h.isPeerRead=!0,e.push(h))}}catch(_){l.e(_)}finally{l.f()}V.log("".concat(this._className,".updateMessageIsPeerReadProperty conversationID:").concat(t," peerReadTime:").concat(o," count:").concat(e.length))}return e}},{key:"updateMessageIsModifiedProperty",value:function(t){var o=t.conversationID;if(this.list.has(o)){var e=this._getUniqueIDOfMessage(t),n=this.list.get(o).get(e);n&&(n.isModified=!0)}}},{key:"hasLocalMessageList",value:function(t){return this.list.has(t)}},{key:"getLocalMessageList",value:function(t){return this.hasLocalMessageList(t)?Be(this.list.get(t).values()):[]}},{key:"hasLocalMessage",value:function(t,o){for(var e=!1,n=this.getLocalMessageList(t),l=n.length,h=0;h<l;h++)n[h].ID===o&&(e=!0);return e}},{key:"getLocalMessage",value:function(t,o){for(var e=null,n=this.getLocalMessageList(t),l=n.length,h=0;h<l;h++)if(n[h].ID===o){e=n[h];break}return e}},{key:"getLocalLastMessage",value:function(t){var o=this.getLocalMessageList(t);return o[o.length-1]}},{key:"getLocalOldestMessage",value:function(t){return this.getLocalMessageList(t)[0]}},{key:"_setLatestMessageSentByPeer",value:function(t,o){t.startsWith(Z.CONV_C2C)&&o.flow==="in"&&this._latestMessageSentByPeerMap.set(t,o)}},{key:"_setLatestMessageSentByMe",value:function(t,o){t.startsWith(Z.CONV_C2C)&&o.flow==="out"&&this._latestMessageSentByMeMap.set(t,o)}},{key:"_setGroupLocalLastMessageSequence",value:function(t,o){t.startsWith(Z.CONV_GROUP)&&this._groupLocalLastMessageSequenceMap.set(t,o.sequence)}},{key:"getLatestMessageSentByPeer",value:function(t){return this._latestMessageSentByPeerMap.get(t)}},{key:"getLatestMessageSentByMe",value:function(t){return this._latestMessageSentByMeMap.get(t)}},{key:"getGroupLocalLastMessageSequence",value:function(t){return this._groupLocalLastMessageSequenceMap.get(t)||0}},{key:"modifyMessageSentByPeer",value:function(t){var o=t.conversationID,e=t.latestNick,n=t.latestAvatar,l=this.list.get(o);if(!Mt(l)){var h=Array.from(l.values()),_=h.length;if(_!==0){for(var S=null,E=0,M=!1,w=_-1;w>=0;w--)h[w].flow==="in"&&((S=h[w]).nick!==e&&(S.setNickAndAvatar({nick:e}),M=!0),S.avatar!==n&&(S.setNickAndAvatar({avatar:n}),M=!0),M&&(E+=1));V.log("".concat(this._className,".modifyMessageSentByPeer conversationID:").concat(o," count:").concat(E))}}}},{key:"modifyMessageSentByMe",value:function(t){var o=t.conversationID,e=t.latestNick,n=t.latestAvatar,l=this.list.get(o);if(!Mt(l)){var h=Array.from(l.values()),_=h.length;if(_!==0){for(var S=null,E=0,M=!1,w=_-1;w>=0;w--)h[w].flow==="out"&&((S=h[w]).nick!==e&&(S.setNickAndAvatar({nick:e}),M=!0),S.avatar!==n&&(S.setNickAndAvatar({avatar:n}),M=!0),M&&(E+=1));V.log("".concat(this._className,".modifyMessageSentByMe conversationID:").concat(o," count:").concat(E))}}}},{key:"getTopicConversationIDList",value:function(t){return Be(this.list.keys()).filter(function(o){return o.startsWith("".concat(Z.CONV_GROUP).concat(t))})}},{key:"traversal",value:function(){if(this.list.size!==0&&V.getLevel()===-1){console.group("conversationID-messageCount");var t,o=De(this.list);try{for(o.s();!(t=o.n()).done;){var e=Ue(t.value,2),n=e[0],l=e[1];console.log("".concat(n,"-").concat(l.size))}}catch(h){o.e(h)}finally{o.f()}console.groupEnd()}}},{key:"onMessageModified",value:function(t,o){if(!this.list.has(t))return{isUpdated:!1,message:null};var e=this._getUniqueIDOfMessage(o),n=this.list.get(t).has(e);if(V.debug("".concat(this._className,".onMessageModified conversationID:").concat(t," uniqueID:").concat(e," has:").concat(n)),n){var l=this.list.get(t).get(e),h=o.messageVersion,_=o.elements,S=o.cloudCustomData;return l.version<h?(l.version=h,l._elements=JSON.parse(JSON.stringify(_)),l.payload=JSON.parse(JSON.stringify(_[0].content)),l.type=_[0].type,l.cloudCustomData=S,l.isModified=!0,{isUpdated:!0,message:l}):{isUpdated:!1,message:l}}return{isUpdated:!1,message:null}}},{key:"_getUniqueIDOfMessage",value:function(t){var o=t.from,e=t.to,n=t.random,l=t.sequence,h=t.time;return"".concat(o,"-").concat(e,"-").concat(n,"-").concat(l,"-").concat(h)}},{key:"reset",value:function(){this.list.clear(),this._latestMessageSentByPeerMap.clear(),this._latestMessageSentByMeMap.clear(),this._groupLocalLastMessageSequenceMap.clear()}}]),a}(),gs="_a2KeyAndTinyIDUpdated",ji="_cloudConfigUpdated",Pf="_profileUpdated";function gv(a){this.mixin(a)}gv.mixin=function(a){var t=a.prototype||a;t._isReady=!1,t.ready=function(o){var e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(o)return this._isReady?void(e?o.call(this):setTimeout(o,1)):(this._readyQueue=this._readyQueue||[],void this._readyQueue.push(o))},t.triggerReady=function(){var o=this;this._isReady=!0,setTimeout(function(){var e=o._readyQueue;o._readyQueue=[],e&&e.length>0&&e.forEach(function(n){n.call(this)},o)},1)},t.resetReady=function(){this._isReady=!1,this._readyQueue=[]},t.isReady=function(){return this._isReady}};var Xu=["jpg","jpeg","gif","png","bmp","image","webp"],Qu=["mp4"],bA=1,mv=2,sE=3,cE=255,xf=function(){function a(t){var o=this;A(this,a),Mt(t)||(this.userID=t.userID||"",this.nick=t.nick||"",this.gender=t.gender||"",this.birthday=t.birthday||0,this.location=t.location||"",this.selfSignature=t.selfSignature||"",this.allowType=t.allowType||Z.ALLOW_TYPE_ALLOW_ANY,this.language=t.language||0,this.avatar=t.avatar||"",this.messageSettings=t.messageSettings||0,this.adminForbidType=t.adminForbidType||Z.FORBID_TYPE_NONE,this.level=t.level||0,this.role=t.role||0,this.lastUpdatedTime=0,this.profileCustomField=[],Mt(t.profileCustomField)||t.profileCustomField.forEach(function(e){o.profileCustomField.push({key:e.key,value:e.value})}))}return x(a,[{key:"validate",value:function(t){var o=!0,e="";if(Mt(t))return{valid:!1,tips:"empty options"};if(t.profileCustomField)for(var n=t.profileCustomField.length,l=null,h=0;h<n;h++){if(l=t.profileCustomField[h],!Ln(l.key)||l.key.indexOf("Tag_Profile_Custom")===-1)return{valid:!1,tips:"\u81EA\u5B9A\u4E49\u8D44\u6599\u5B57\u6BB5\u7684\u524D\u7F00\u5FC5\u987B\u662F Tag_Profile_Custom"};if(!Ln(l.value))return{valid:!1,tips:"\u81EA\u5B9A\u4E49\u8D44\u6599\u5B57\u6BB5\u7684 value \u5FC5\u987B\u662F\u5B57\u7B26\u4E32"}}for(var _ in t)if(Object.prototype.hasOwnProperty.call(t,_)){if(_==="profileCustomField")continue;if(Mt(t[_])&&!Ln(t[_])&&!gr(t[_])){e="key:"+_+", invalid value:"+t[_],o=!1;continue}switch(_){case"nick":Ln(t[_])||(e="nick should be a string",o=!1),B0(t[_])>500&&(e="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(B0(t[_])," bytes"),o=!1);break;case"gender":q0(xT,t.gender)||(e="key:gender, invalid value:"+t.gender,o=!1);break;case"birthday":gr(t.birthday)||(e="birthday should be a number",o=!1);break;case"location":Ln(t.location)||(e="location should be a string",o=!1);break;case"selfSignature":Ln(t.selfSignature)||(e="selfSignature should be a string",o=!1);break;case"allowType":q0(Lb,t.allowType)||(e="key:allowType, invalid value:"+t.allowType,o=!1);break;case"language":gr(t.language)||(e="language should be a number",o=!1);break;case"avatar":Ln(t.avatar)||(e="avatar should be a string",o=!1);break;case"messageSettings":t.messageSettings!==0&&t.messageSettings!==1&&(e="messageSettings should be 0 or 1",o=!1);break;case"adminForbidType":q0(Nb,t.adminForbidType)||(e="key:adminForbidType, invalid value:"+t.adminForbidType,o=!1);break;case"level":gr(t.level)||(e="level should be a number",o=!1);break;case"role":gr(t.role)||(e="role should be a number",o=!1);break;default:e="unknown key:"+_+"  "+t[_],o=!1}}return{valid:o,tips:e}}}]),a}(),uE=x(function a(t){A(this,a),this.value=t,this.next=null}),Gh=function(){function a(t){A(this,a),this.MAX_LENGTH=t,this.pTail=null,this.pNodeToDel=null,this.map=new Map,V.debug("SinglyLinkedList init MAX_LENGTH:".concat(this.MAX_LENGTH))}return x(a,[{key:"set",value:function(t){var o=new uE(t);if(this.map.size<this.MAX_LENGTH)this.pTail===null?(this.pTail=o,this.pNodeToDel=o):(this.pTail.next=o,this.pTail=o),this.map.set(t,1);else{var e=this.pNodeToDel;this.pNodeToDel=this.pNodeToDel.next,this.map.delete(e.value),e.next=null,e=null,this.pTail.next=o,this.pTail=o,this.map.set(t,1)}}},{key:"has",value:function(t){return this.map.has(t)}},{key:"delete",value:function(t){this.has(t)&&this.map.delete(t)}},{key:"tail",value:function(){return this.pTail}},{key:"size",value:function(){return this.map.size}},{key:"data",value:function(){return Array.from(this.map.keys())}},{key:"reset",value:function(){for(var t;this.pNodeToDel!==null;)t=this.pNodeToDel,this.pNodeToDel=this.pNodeToDel.next,t.next=null,t=null;this.pTail=null,this.map.clear()}}]),a}(),lE=["groupID","name","avatar","type","introduction","notification","ownerID","selfInfo","createTime","infoSequence","lastInfoTime","lastMessage","nextMessageSeq","memberNum","maxMemberNum","memberList","joinOption","groupCustomField","muteAllMembers","isSupportTopic"],Zu=function(){function a(t){A(this,a),this.groupID="",this.name="",this.avatar="",this.type="",this.introduction="",this.notification="",this.ownerID="",this.createTime="",this.infoSequence="",this.lastInfoTime="",this.selfInfo={messageRemindType:"",joinTime:"",nameCard:"",role:"",userID:"",memberCustomField:void 0,readedSequence:0,excludedUnreadSequenceList:void 0},this.lastMessage={lastTime:"",lastSequence:"",fromAccount:"",messageForShow:""},this.nextMessageSeq="",this.memberNum="",this.memberCount="",this.maxMemberNum="",this.maxMemberCount="",this.joinOption="",this.groupCustomField=[],this.muteAllMembers=!1,this.isSupportTopic=!1,this._initGroup(t)}return x(a,[{key:"memberNum",get:function(){return V.warn("\uFF01\uFF01\uFF01v2.8.0\u8D77\u5F03\u7528memberNum\uFF0C\u8BF7\u4F7F\u7528 memberCount"),this.memberCount},set:function(t){}},{key:"maxMemberNum",get:function(){return V.warn("\uFF01\uFF01\uFF01v2.8.0\u8D77\u5F03\u7528maxMemberNum\uFF0C\u8BF7\u4F7F\u7528 maxMemberCount"),this.maxMemberCount},set:function(t){}},{key:"_initGroup",value:function(t){for(var o in t)lE.indexOf(o)<0||(o!=="selfInfo"?(o==="memberNum"&&(this.memberCount=t[o]),o==="maxMemberNum"&&(this.maxMemberCount=t[o]),o!=="isSupportTopic"?this[o]=t[o]:this.isSupportTopic=t[o]===1):this.updateSelfInfo(t[o]))}},{key:"updateGroup",value:function(t){var o=this,e=JSON.parse(JSON.stringify(t));e.lastMsgTime&&(this.lastMessage.lastTime=e.lastMsgTime),Ke(e.muteAllMembers)||(e.muteAllMembers==="On"?e.muteAllMembers=!0:e.muteAllMembers=!1),e.groupCustomField&&Hm(this.groupCustomField,e.groupCustomField),Ke(e.memberNum)||(this.memberCount=e.memberNum),Ke(e.maxMemberNum)||(this.maxMemberCount=e.maxMemberNum),Ke(e.isSupportTopic)||(this.isSupportTopic=gr(e.isSupportTopic)?e.isSupportTopic===1:e.isSupportTopic),Bo(this,e,["members","errorCode","lastMsgTime","groupCustomField","memberNum","maxMemberNum","isSupportTopic"]),Yt(e.members)&&e.members.length>0&&e.members.forEach(function(n){n.userID===o.selfInfo.userID&&Bo(o.selfInfo,n,["sequence"])})}},{key:"updateSelfInfo",value:function(t){var o={nameCard:t.nameCard,joinTime:t.joinTime,role:t.role,messageRemindType:t.messageRemindType,readedSequence:t.readedSequence,excludedUnreadSequenceList:t.excludedUnreadSequenceList};Bo(this.selfInfo,m({},o),[],["",null,void 0,0,NaN])}},{key:"setSelfNameCard",value:function(t){this.selfInfo.nameCard=t}}]),a}(),Zy=function(a){return Ke(a)?{lastTime:0,lastSequence:0,fromAccount:0,messageForShow:"",payload:null,type:"",isRevoked:!1,cloudCustomData:"",onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:!1}:a instanceof Bi?{lastTime:a.time||0,lastSequence:a.sequence||0,fromAccount:a.from||"",messageForShow:Ih(a.type,a.payload),payload:a.payload||null,type:a.type||null,isRevoked:a.isRevoked||!1,cloudCustomData:a.cloudCustomData||"",onlineOnlyFlag:a._onlineOnlyFlag||!1,nick:a.nick||"",nameCard:a.nameCard||"",version:a.version||0,isPeerRead:a.isPeerRead||!1}:m(m({},a),{},{messageForShow:Ih(a.type,a.payload)})},Uf=function(){function a(t){A(this,a),this.conversationID=t.conversationID||"",this.unreadCount=t.unreadCount||0,this.type=t.type||"",this.lastMessage=Zy(t.lastMessage),t.lastMsgTime&&(this.lastMessage.lastTime=t.lastMsgTime),this._isInfoCompleted=!1,this.peerReadTime=t.peerReadTime||0,this.groupAtInfoList=[],this.remark="",this.isPinned=t.isPinned||!1,this.messageRemindType="",this._initProfile(t)}return x(a,[{key:"toAccount",get:function(){return this.conversationID.startsWith(Z.CONV_C2C)?this.conversationID.replace(Z.CONV_C2C,""):this.conversationID.startsWith(Z.CONV_GROUP)?this.conversationID.replace(Z.CONV_GROUP,""):""}},{key:"subType",get:function(){return this.groupProfile?this.groupProfile.type:""}},{key:"_initProfile",value:function(t){var o=this;Object.keys(t).forEach(function(e){switch(e){case"userProfile":o.userProfile=t.userProfile;break;case"groupProfile":o.groupProfile=t.groupProfile}}),Ke(this.userProfile)&&this.type===Z.CONV_C2C?this.userProfile=new xf({userID:t.conversationID.replace("C2C","")}):Ke(this.groupProfile)&&this.type===Z.CONV_GROUP&&(this.groupProfile=new Zu({groupID:t.conversationID.replace("GROUP","")}))}},{key:"updateUnreadCount",value:function(t){var o=t.nextUnreadCount,e=t.isFromGetConversations,n=t.isUnreadC2CMessage;Ke(o)||(Ws(this.subType)?this.unreadCount=0:e&&this.type===Z.CONV_GROUP||e&&this.type===Z.CONV_TOPIC||n&&this.type===Z.CONV_C2C?this.unreadCount=o:this.unreadCount=this.unreadCount+o)}},{key:"updateLastMessage",value:function(t){this.lastMessage=Zy(t)}},{key:"updateGroupAtInfoList",value:function(t){if(!this._isNeedMergeGroupAtInfo(t)){var o,e=(Pe(o=t.groupAtType)||de(o)||Se(o)||ke()).slice(0);e.indexOf(Z.CONV_AT_ME)!==-1&&e.indexOf(Z.CONV_AT_ALL)!==-1&&(e=[Z.CONV_AT_ALL_AT_ME]);var n={from:t.from,groupID:t.groupID,topicID:t.topicID,messageSequence:t.sequence,atTypeArray:e,__random:t.__random,__sequence:t.__sequence};this.groupAtInfoList.push(n),V.debug("Conversation.updateGroupAtInfoList conversationID:".concat(this.conversationID),this.groupAtInfoList)}}},{key:"_isNeedMergeGroupAtInfo",value:function(t){var o=t.groupID,e=t.sequence;if(!vo({groupID:o}))return!1;var n=!1;return this.groupAtInfoList.forEach(function(l){l.messageSequence===e&&(l.atTypeArray.indexOf(Z.CONV_AT_ME)>-1&&t.groupAtType.indexOf(Z.CONV_AT_ALL)>-1&&(l.atTypeArray=[Z.CONV_AT_ALL_AT_ME]),l.atTypeArray.indexOf(Z.CONV_AT_ALL)>-1&&t.groupAtType.indexOf(Z.CONV_AT_ME)>-1&&(l.atTypeArray=[Z.CONV_AT_ALL_AT_ME],l.__random=t.__random,l.__sequence=t.__sequence),n=!0)}),n}},{key:"clearGroupAtInfoList",value:function(){this.groupAtInfoList.length=0}},{key:"reduceUnreadCount",value:function(){this.unreadCount>=1&&(this.unreadCount-=1)}},{key:"isLastMessageRevoked",value:function(t){var o=t.sequence,e=t.time;return this.type===Z.CONV_C2C&&o===this.lastMessage.lastSequence&&e===this.lastMessage.lastTime||this.type===Z.CONV_GROUP&&o===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(t){this.lastMessage.isRevoked=t}}]),a}(),dE=function(){function a(t){A(this,a),this._conversationModule=t,this._className="MessageRemindHandler",this._updateSequence=0}return x(a,[{key:"getC2CMessageRemindType",value:function(){var t=this,o="".concat(this._className,".getC2CMessageRemindType");return this._conversationModule.request({protocolName:pI,updateSequence:this._updateSequence}).then(function(e){V.log("".concat(o," ok"));var n=e.data,l=n.updateSequence,h=n.muteFlagList;t._updateSequence=l,t._patchC2CMessageRemindType(h)}).catch(function(e){V.error("".concat(o," failed. error:"),e)})}},{key:"_patchC2CMessageRemindType",value:function(t){var o=this,e=0,n="";Yt(t)&&t.length>0&&t.forEach(function(l){var h=l.userID,_=l.muteFlag;_===0?n=Z.MSG_REMIND_ACPT_AND_NOTE:_===1?n=Z.MSG_REMIND_DISCARD:_===2&&(n=Z.MSG_REMIND_ACPT_NOT_NOTE),o._conversationModule.patchMessageRemindType({ID:h,isC2CConversation:!0,messageRemindType:n})===!0&&(e+=1)}),V.log("".concat(this._className,"._patchC2CMessageRemindType count:").concat(e))}},{key:"set",value:function(t){return t.groupID?this._setGroupMessageRemindType(t):Yt(t.userIDList)?this._setC2CMessageRemindType(t):void 0}},{key:"_setGroupMessageRemindType",value:function(t){var o=this,e="".concat(this._className,"._setGroupMessageRemindType"),n=t.groupID,l=t.messageRemindType,h="groupID:".concat(n," messageRemindType:").concat(l),_=new ht(yt.SET_MESSAGE_REMIND_TYPE);return _.setMessage(h),this._getModule(gi).modifyGroupMemberInfo({groupID:n,messageRemindType:l,userID:this._conversationModule.getMyUserID()}).then(function(){_.setNetworkType(o._conversationModule.getNetworkType()).end(),V.log("".concat(e," ok. ").concat(h));var S=o.onGroupMessageRemindTypeUpdated(t);return Wt(S)}).catch(function(S){return o._conversationModule.probeNetwork().then(function(E){var M=Ue(E,2),w=M[0],L=M[1];_.setError(S,w,L).end()}),V.error("".concat(e," failed. error:"),S),Le(S)})}},{key:"onGroupMessageRemindTypeUpdated",value:function(t){var o=t.groupID,e=t.messageRemindType,n=this._getModule(pn).getLocalGroupProfile(o);if(n&&(n.selfInfo.messageRemindType=e),Lt(o)){var l=o,h=wo(l),_=this._getModule(ri).getLocalTopic(h,l);return _&&(_.updateSelfInfo({messageRemindType:e}),this._conversationModule.emitOuterEvent(mn.TOPIC_UPDATED,{groupID:h,topic:_})),{topic:_}}return this._conversationModule.patchMessageRemindType({ID:o,isC2CConversation:!1,messageRemindType:e})&&this._emitConversationUpdate(),{group:n}}},{key:"_setC2CMessageRemindType",value:function(t){var o=this,e="".concat(this._className,"._setC2CMessageRemindType"),n=t.userIDList,l=t.messageRemindType,h=n.slice(0,30),_=0;l===Z.MSG_REMIND_DISCARD?_=1:l===Z.MSG_REMIND_ACPT_NOT_NOTE&&(_=2);var S="userIDList:".concat(h," messageRemindType:").concat(l),E=new ht(yt.SET_MESSAGE_REMIND_TYPE);return E.setMessage(S),this._conversationModule.request({protocolName:hI,requestData:{userIDList:h,muteFlag:_}}).then(function(M){E.setNetworkType(o._conversationModule.getNetworkType()).end();var w=M.data,L=w.updateSequence,H=w.errorList;o._updateSequence=L;var ne=[],ae=[];Yt(H)&&H.forEach(function(Te){ne.push(Te.userID),ae.push({userID:Te.userID,code:Te.errorCode})});var he=h.filter(function(Te){return ne.indexOf(Te)===-1});V.log("".concat(e," ok. successUserIDList:").concat(he," failureUserIDList:").concat(JSON.stringify(ae)));var ge=0;return he.forEach(function(Te){o._conversationModule.patchMessageRemindType({ID:Te,isC2CConversation:!0,messageRemindType:l})&&(ge+=1)}),ge>=1&&o._emitConversationUpdate(),h.length=ne.length=0,En({successUserIDList:he.map(function(Te){return{userID:Te}}),failureUserIDList:ae})}).catch(function(M){return o._conversationModule.probeNetwork().then(function(w){var L=Ue(w,2),H=L[0],ne=L[1];E.setError(M,H,ne).end()}),V.error("".concat(e," failed. error:"),M),Le(M)})}},{key:"_getModule",value:function(t){return this._conversationModule.getModule(t)}},{key:"_emitConversationUpdate",value:function(){this._conversationModule.emitConversationUpdate(!0,!1)}},{key:"setUpdateSequence",value:function(t){this._updateSequence=t}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),this._updateSequence=0}}]),a}(),hE=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this,e))._className="ConversationModule",gv.mixin(Ae(n)),n._messageListHandler=new fv,n._messageRemindHandler=new dE(Ae(n)),n.singlyLinkedList=new Gh(100),n._pagingStatus=ju.NOT_START,n._pagingTimeStamp=0,n._pagingStartIndex=0,n._pagingPinnedTimeStamp=0,n._pagingPinnedStartIndex=0,n._conversationMap=new Map,n._tmpGroupList=[],n._tmpGroupAtTipsList=[],n._peerReadTimeMap=new Map,n._completedMap=new Map,n._roamingMessageKeyAndTimeMap=new Map,n._roamingMessageSequenceMap=new Map,n._remoteGroupReadSequenceMap=new Map,n._initListeners(),n}return x(o,[{key:"_initListeners",value:function(){var e=this.getInnerEmitterInstance();e.on(gs,this._initLocalConversationList,this),e.on(Pf,this._onProfileUpdated,this)}},{key:"onCheckTimer",value:function(e){e%60==0&&this._messageListHandler.traversal()}},{key:"_initLocalConversationList",value:function(){var e=this,n=new ht(yt.GET_CONVERSATION_LIST_IN_STORAGE);V.log("".concat(this._className,"._initLocalConversationList."));var l="",h=this._getStorageConversationList();if(h){for(var _=h.length,S=0;S<_;S++){var E=h[S];if(E){if(E.conversationID==="".concat(Z.CONV_C2C,"@TLS#ERROR")||E.conversationID==="".concat(Z.CONV_C2C,"@TLS#NOT_FOUND"))continue;if(E.groupProfile){var M=E.groupProfile.type;if(Ws(M))continue}}this._conversationMap.set(h[S].conversationID,new Uf(h[S]))}this.emitConversationUpdate(!0,!1),l="count:".concat(_)}else l="count:0";n.setNetworkType(this.getNetworkType()).setMessage(l).end(),this.getModule(Vi)||this.triggerReady(),this.ready(function(){e._tmpGroupList.length>0&&(e.updateConversationGroupProfile(e._tmpGroupList),e._tmpGroupList.length=0)}),this.syncConversationList()}},{key:"onMessageSent",value:function(e){this._onSendOrReceiveMessage({conversationOptionsList:e.conversationOptionsList,isInstantMessage:!0})}},{key:"onNewMessage",value:function(e){this._onSendOrReceiveMessage(e)}},{key:"_onSendOrReceiveMessage",value:function(e){var n=this,l=e.conversationOptionsList,h=e.isInstantMessage,_=h===void 0||h,S=e.isUnreadC2CMessage,E=S!==void 0&&S;this._isReady?l.length!==0&&(this._getC2CPeerReadTime(l),this._updateLocalConversationList({conversationOptionsList:l,isInstantMessage:_,isUnreadC2CMessage:E,isFromGetConversations:!1}),this._setStorageConversationList(),l.filter(function(M){return M.type===Z.CONV_TOPIC}).length>0||this.emitConversationUpdate()):this.ready(function(){n._onSendOrReceiveMessage(e)})}},{key:"updateConversationGroupProfile",value:function(e){var n=this;if(!Yt(e)||e.length!==0)if(this._conversationMap.size!==0){var l=!1;e.forEach(function(h){var _="GROUP".concat(h.groupID);if(n._conversationMap.has(_)){l=!0;var S=n._conversationMap.get(_);S.groupProfile=JSON.parse(JSON.stringify(h)),S.lastMessage.lastSequence<h.nextMessageSeq&&(S.lastMessage.lastSequence=h.nextMessageSeq-1),S.subType||(S.subType=h.type)}}),l&&this.emitConversationUpdate(!0,!1)}else this._tmpGroupList=e}},{key:"_updateConversationUserProfile",value:function(e){var n=this;e.data.forEach(function(l){var h="C2C".concat(l.userID);n._conversationMap.has(h)&&(n._conversationMap.get(h).userProfile=l)}),this.emitConversationUpdate(!0,!1)}},{key:"onMessageRevoked",value:function(e){var n=this;if(e.length!==0){var l=null,h=!1;e.forEach(function(_){(l=n._conversationMap.get(_.conversationID))&&(l.reduceUnreadCount(),l.isLastMessageRevoked(_)&&(h=!0,l.setLastMessageRevoked(!0)))}),h&&this.emitConversationUpdate(!0,!1)}}},{key:"onMessageDeleted",value:function(e){var n=this;if(e.length!==0){var l=null;e.forEach(function(L){(l=n._messageListHandler.getLocalMessage(L.conversationID,L.ID))&&(l.isDeleted=!0),L!==l&&(L.isDeleted=!0)});for(var h=e[0].conversationID,_=this._messageListHandler.getLocalMessageList(h),S={},E=_.length-1;E>=0;E--)if(!_[E].isDeleted){S=_[E];break}var M=this._conversationMap.get(h);if(M){var w=!1;M.lastMessage.lastSequence===S.sequence&&M.lastMessage.lastTime===S.time||(Mt(S)&&(S=void 0),M.updateLastMessage(S),M.type!==Z.CONV_TOPIC&&(w=!0),V.log("".concat(this._className,".onMessageDeleted. update conversationID:").concat(h," with lastMessage:"),M.lastMessage)),h.startsWith(Z.CONV_C2C)&&this.updateUnreadCount(h),w&&this.emitConversationUpdate(!0,!1)}}}},{key:"onMessageModified",value:function(e){var n=e.conversationType,l=e.from,h=e.to,_=e.time,S=e.sequence,E=e.elements,M=e.cloudCustomData,w=e.messageVersion,L=this.getMyUserID(),H="".concat(n).concat(h);h===L&&n===Z.CONV_C2C&&(H="".concat(n).concat(l));var ne=this._messageListHandler.onMessageModified(H,e),ae=ne.isUpdated,he=ne.message;ae===!0&&this.emitOuterEvent(mn.MESSAGE_MODIFIED,[he]);var ge=this._isTopicConversation(H);if(V.log("".concat(this._className,".onMessageModified isUpdated:").concat(ae," isTopicMessage:").concat(ge," from:").concat(l," to:").concat(h)),ge)this.getModule(ri).onMessageModified(e);else{var Te=this._conversationMap.get(H);if(Te){var Ze=Te.lastMessage;V.debug("".concat(this._className.onMessageModified," lastMessage:"),JSON.stringify(Ze),"options:",JSON.stringify(e)),Ze&&Ze.lastTime===_&&Ze.lastSequence===S&&Ze.version!==w&&(Ze.type=E[0].type,Ze.payload=E[0].content,Ze.messageForShow=Ih(Ze.type,Ze.payload),Ze.cloudCustomData=M,Ze.version=w,this.emitConversationUpdate(!0,!1))}}return he}},{key:"onNewGroupAtTips",value:function(e){var n=this,l=e.dataList,h=null;l.forEach(function(_){_.groupAtTips?h=_.groupAtTips:_.elements?h=m(m({},_.elements),{},{sync:!0}):_.groupAtType&&(h=m(m({},_),{},{sync:!0})),h.__random=_.random,h.__sequence=_.clientSequence,n._tmpGroupAtTipsList.push(h)}),V.debug("".concat(this._className,".onNewGroupAtTips isReady:").concat(this._isReady),this._tmpGroupAtTipsList),this._isReady&&this._handleGroupAtTipsList()}},{key:"_handleGroupAtTipsList",value:function(){var e=this;if(this._tmpGroupAtTipsList.length!==0){var n=!1;this._tmpGroupAtTipsList.forEach(function(l){var h=l.groupID,_=l.from,S=l.topicID,E=S===void 0?void 0:S,M=l.sync,w=M!==void 0&&M;if(_!==e.getMyUserID())if(Ke(E)){var L=e._conversationMap.get("".concat(Z.CONV_GROUP).concat(h));L&&(L.updateGroupAtInfoList(l),n=!0)}else{var H=e._conversationMap.get("".concat(Z.CONV_GROUP).concat(E));if(H){H.updateGroupAtInfoList(l);var ne=e.getModule(ri),ae=H.groupAtInfoList;ne.onConversationProxy({topicID:E,groupAtInfoList:ae})}Mt(H)&&w&&(e.updateTopicConversation([{conversationID:"".concat(Z.CONV_GROUP).concat(E),type:Z.CONV_TOPIC}]),e._conversationMap.get("".concat(Z.CONV_GROUP).concat(E)).updateGroupAtInfoList(l))}}),n&&this.emitConversationUpdate(!0,!1),this._tmpGroupAtTipsList.length=0}}},{key:"_getC2CPeerReadTime",value:function(e){var n=this,l=[];if(e.forEach(function(_){n._conversationMap.has(_.conversationID)||_.type!==Z.CONV_C2C||l.push(_.conversationID.replace(Z.CONV_C2C,""))}),l.length>0){V.debug("".concat(this._className,"._getC2CPeerReadTime userIDList:").concat(l));var h=this.getModule(Vi);h&&h.getRemotePeerReadTime(l)}}},{key:"_getStorageConversationList",value:function(){return this.getModule(ds).getItem("conversationMap")}},{key:"_setStorageConversationList",value:function(){var e=this.getLocalConversationList().slice(0,20).map(function(n){return{conversationID:n.conversationID,type:n.type,subType:n.subType,lastMessage:n.lastMessage,groupProfile:n.groupProfile,userProfile:n.userProfile}});this.getModule(ds).setItem("conversationMap",e)}},{key:"emitConversationUpdate",value:function(){var e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],l=this.getLocalConversationList();if(n){var h=this.getModule(pn);h&&h.updateGroupLastMessage(l)}e&&this.emitOuterEvent(mn.CONVERSATION_LIST_UPDATED)}},{key:"getLocalConversationList",value:function(){return Be(this._conversationMap.values()).filter(function(e){return e.type!==Z.CONV_TOPIC})}},{key:"getLocalConversation",value:function(e){return this._conversationMap.get(e)}},{key:"getLocalOldestMessage",value:function(e){return this._messageListHandler.getLocalOldestMessage(e)}},{key:"syncConversationList",value:function(){var e=this,n=new ht(yt.SYNC_CONVERSATION_LIST);return this._pagingStatus===ju.NOT_START&&this._conversationMap.clear(),this._pagingGetConversationList().then(function(l){return e._pagingStatus=ju.RESOLVED,e._setStorageConversationList(),e._handleC2CPeerReadTime(),e._patchConversationProperties(),n.setMessage(e._conversationMap.size).setNetworkType(e.getNetworkType()).end(),l}).catch(function(l){return e._pagingStatus=ju.REJECTED,n.setMessage(e._pagingTimeStamp),e.probeNetwork().then(function(h){var _=Ue(h,2),S=_[0],E=_[1];n.setError(l,S,E).end()}),Le(l)})}},{key:"_patchConversationProperties",value:function(){var e=this,n=Date.now(),l=this.checkAndPatchRemark(),h=this._messageRemindHandler.getC2CMessageRemindType(),_=this.getModule(pn).getGroupList();Promise.all([l,h,_]).then(function(){var S=Date.now()-n;V.log("".concat(e._className,"._patchConversationProperties ok. cost ").concat(S," ms")),e.emitConversationUpdate(!0,!1)})}},{key:"_pagingGetConversationList",value:function(){var e=this,n="".concat(this._className,"._pagingGetConversationList");return V.log("".concat(n," timeStamp:").concat(this._pagingTimeStamp," startIndex:").concat(this._pagingStartIndex)+" pinnedTimeStamp:".concat(this._pagingPinnedTimeStamp," pinnedStartIndex:").concat(this._pagingPinnedStartIndex)),this._pagingStatus=ju.PENDING,this.request({protocolName:vI,requestData:{fromAccount:this.getMyUserID(),timeStamp:this._pagingTimeStamp,startIndex:this._pagingStartIndex,pinnedTimeStamp:this._pagingPinnedTimeStamp,pinnedStartIndex:this._pagingStartIndex,orderType:1}}).then(function(l){var h=l.data,_=h.completeFlag,S=h.conversations,E=S===void 0?[]:S,M=h.timeStamp,w=h.startIndex,L=h.pinnedTimeStamp,H=h.pinnedStartIndex;if(V.log("".concat(n," ok. completeFlag:").concat(_," count:").concat(E.length," isReady:").concat(e._isReady)),E.length>0){var ne=e._getConversationOptions(E);e._updateLocalConversationList({conversationOptionsList:ne,isFromGetConversations:!0}),e.isLoggedIn()&&e.emitConversationUpdate()}if(!e._isReady){if(!e.isLoggedIn())return En();e.triggerReady()}return e._pagingTimeStamp=M,e._pagingStartIndex=w,e._pagingPinnedTimeStamp=L,e._pagingPinnedStartIndex=H,_!==1?e._pagingGetConversationList():(e._handleGroupAtTipsList(),En())}).catch(function(l){throw e.isLoggedIn()&&(e._isReady||(V.warn("".concat(n," failed. error:"),l),e.triggerReady())),l})}},{key:"_updateLocalConversationList",value:function(e){var n,l=e.isFromGetConversations,h=Date.now();n=this._getTmpConversationListMapping(e),this._conversationMap=new Map(this._sortConversationList([].concat(Be(n.toBeUpdatedConversationList),Be(this._conversationMap)))),l||this._updateUserOrGroupProfile(n.newConversationList),V.debug("".concat(this._className,"._updateLocalConversationList cost ").concat(Date.now()-h," ms"))}},{key:"_getTmpConversationListMapping",value:function(e){for(var n=e.conversationOptionsList,l=e.isFromGetConversations,h=e.isInstantMessage,_=e.isUnreadC2CMessage,S=_!==void 0&&_,E=[],M=[],w=this.getModule(pn),L=this.getModule(ni),H=0,ne=n.length;H<ne;H++){var ae=new Uf(n[H]),he=ae.conversationID;if(he!=="".concat(Z.CONV_C2C,"@TLS#ERROR")&&he!=="".concat(Z.CONV_C2C,"@TLS#NOT_FOUND"))if(this._conversationMap.has(he)){var ge=this._conversationMap.get(he),Te=["unreadCount","allowType","adminForbidType","payload","isPinned"];h===!1&&Te.push("lastMessage");var Ze=n[H].lastMessage,Ct=!Ke(Ze);Ct||n[H].type===Z.CONV_TOPIC||this._onLastMessageNotExist(n[H]),Ke(h)&&Ct&&ge.lastMessage.payload===null&&(ge.lastMessage.payload=Ze.payload),Bo(ge,ae,Te,[null,void 0,"",0,NaN]),ge.updateUnreadCount({nextUnreadCount:ae.unreadCount,isFromGetConversations:l,isUnreadC2CMessage:S}),h&&Ct&&(Ze.payload&&(ge.lastMessage.payload=Ze.payload),ge.type===Z.CONV_GROUP&&(ge.lastMessage.nameCard=Ze.nameCard,ge.lastMessage.nick=Ze.nick)),Ct&&ge.lastMessage.cloudCustomData!==Ze.cloudCustomData&&(ge.lastMessage.cloudCustomData=Ze.cloudCustomData||""),this._conversationMap.delete(he),E.push([he,ge])}else{if(ae.type===Z.CONV_GROUP&&w){var wt=ae.groupProfile.groupID,dn=w.getLocalGroupProfile(wt);dn&&(ae.groupProfile=dn,ae.updateUnreadCount({nextUnreadCount:0}))}else if(ae.type===Z.CONV_C2C){var $t=he.replace(Z.CONV_C2C,"");L&&L.isMyFriend($t)&&(ae.remark=L.getFriendRemark($t))}M.push(ae),E.push([he,ae])}}var Kn=this.getModule(ri);return E.forEach(function(xn){if(xn[1].type===Z.CONV_TOPIC){var On=xn[1],ar=On.conversationID,yr=On.unreadCount,Mi=On.groupAtInfoList;Kn.onConversationProxy({topicID:ar.replace(Z.CONV_GROUP,""),unreadCount:yr,groupAtInfoList:Mt(Mi)?void 0:Mi})}}),{toBeUpdatedConversationList:E,newConversationList:M}}},{key:"_onLastMessageNotExist",value:function(e){new ht(yt.LAST_MESSAGE_NOT_EXIST).setMessage("".concat(JSON.stringify(e))).setNetworkType(this.getNetworkType()).end()}},{key:"_sortConversationList",value:function(e){var n=[],l=[];return e.forEach(function(h){h[1].isPinned===!0?n.push(h):l.push(h)}),n.sort(function(h,_){return _[1].lastMessage.lastTime-h[1].lastMessage.lastTime}).concat(l.sort(function(h,_){return _[1].lastMessage.lastTime-h[1].lastMessage.lastTime}))}},{key:"_sortConversationListAndEmitEvent",value:function(){this._conversationMap=new Map(this._sortConversationList(Be(this._conversationMap))),this.emitConversationUpdate(!0,!1)}},{key:"_updateUserOrGroupProfile",value:function(e){var n=this;if(e.length!==0){var l=[],h=[],_=this.getModule(Ei),S=this.getModule(pn);e.forEach(function(E){if(E.type===Z.CONV_C2C)l.push(E.toAccount);else if(E.type===Z.CONV_GROUP){var M=E.toAccount;S.hasLocalGroup(M)?E.groupProfile=S.getLocalGroupProfile(M):h.push(M)}}),V.log("".concat(this._className,"._updateUserOrGroupProfile c2cUserIDList:").concat(l," groupIDList:").concat(h)),l.length>0&&_.getUserProfile({userIDList:l}).then(function(E){var M=E.data;Yt(M)?M.forEach(function(w){n._conversationMap.get("C2C".concat(w.userID)).userProfile=w}):n._conversationMap.get("C2C".concat(M.userID)).userProfile=M}),h.length>0&&S.getGroupProfileAdvance({groupIDList:h,responseFilter:{groupBaseInfoFilter:["Type","Name","FaceUrl"]}}).then(function(E){E.data.successGroupList.forEach(function(M){var w="GROUP".concat(M.groupID);if(n._conversationMap.has(w)){var L=n._conversationMap.get(w);Bo(L.groupProfile,M,[],[null,void 0,"",0,NaN]),!L.subType&&M.type&&(L.subType=M.type)}})})}}},{key:"_getConversationOptions",value:function(e){var n=this,l=[],h=e.filter(function(E){var M=E.lastMsg;return Br(M)}).filter(function(E){var M=E.type,w=E.userID;return M===1&&w!=="@TLS#NOT_FOUND"&&w!=="@TLS#ERROR"||M===2}),_=this.getMyUserID(),S=h.map(function(E){if(E.type===1){var M={userID:E.userID,nick:E.peerNick,avatar:E.peerAvatar};return l.push(M),{conversationID:"C2C".concat(E.userID),type:"C2C",lastMessage:{lastTime:E.time,lastSequence:E.sequence,fromAccount:E.lastC2CMsgFromAccount,messageForShow:E.messageShow,type:E.lastMsg.elements[0]?E.lastMsg.elements[0].type:null,payload:E.lastMsg.elements[0]?E.lastMsg.elements[0].content:null,cloudCustomData:E.lastMsg.cloudCustomData||"",isRevoked:E.lastMessageFlag===8,onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:E.lastC2CMsgFromAccount===_&&E.time<=E.c2cPeerReadTime},userProfile:new xf(M),peerReadTime:E.c2cPeerReadTime,isPinned:E.isPinned===1,messageRemindType:""}}return{conversationID:"GROUP".concat(E.groupID),type:"GROUP",lastMessage:m(m({lastTime:E.time,lastSequence:E.messageReadSeq+E.unreadCount,fromAccount:E.msgGroupFromAccount,messageForShow:E.messageShow},n._patchTypeAndPayload(E)),{},{cloudCustomData:E.lastMsg.cloudCustomData||"",isRevoked:E.lastMessageFlag===2,onlineOnlyFlag:!1,nick:E.senderNick||"",nameCard:E.senderNameCard||""}),groupProfile:new Zu({groupID:E.groupID,name:E.groupNick,avatar:E.groupImage}),unreadCount:E.unreadCount,peerReadTime:0,isPinned:E.isPinned===1,messageRemindType:"",version:0}});return l.length>0&&this.getModule(Ei).onConversationsProfileUpdated(l),S}},{key:"_patchTypeAndPayload",value:function(e){var n=e.lastMsg,l=n.event,h=l===void 0?void 0:l,_=n.elements,S=_===void 0?[]:_,E=n.groupTips,M=E===void 0?{}:E;if(!Ke(h)&&!Mt(M)){var w=new Bi(M);w.setElement({type:Z.MSG_GRP_TIP,content:m(m({},M.elements),{},{groupProfile:M.groupProfile})});var L=JSON.parse(JSON.stringify(w.payload));return w=null,{type:Z.MSG_GRP_TIP,payload:L}}return{type:S[0]?S[0].type:null,payload:S[0]?S[0].content:null}}},{key:"getLocalMessageList",value:function(e){return this._messageListHandler.getLocalMessageList(e)}},{key:"deleteLocalMessage",value:function(e){e instanceof Bi&&this._messageListHandler.remove(e)}},{key:"onConversationDeleted",value:function(e){var n=this;V.log("".concat(this._className,".onConversationDeleted")),Yt(e)&&e.forEach(function(l){var h=l.type,_=l.userID,S=l.groupID,E="";h===1?E="".concat(Z.CONV_C2C).concat(_):h===2&&(E="".concat(Z.CONV_GROUP).concat(S)),n.deleteLocalConversation(E)})}},{key:"onConversationPinned",value:function(e){var n=this;if(Yt(e)){var l=!1;e.forEach(function(h){var _,S=h.type,E=h.userID,M=h.groupID;S===1?_=n.getLocalConversation("".concat(Z.CONV_C2C).concat(E)):S===2&&(_=n.getLocalConversation("".concat(Z.CONV_GROUP).concat(M))),_&&(V.log("".concat(n._className,".onConversationPinned conversationID:").concat(_.conversationID," isPinned:").concat(_.isPinned)),_.isPinned||(_.isPinned=!0,l=!0))}),l&&this._sortConversationListAndEmitEvent()}}},{key:"onConversationUnpinned",value:function(e){var n=this;if(Yt(e)){var l=!1;e.forEach(function(h){var _,S=h.type,E=h.userID,M=h.groupID;S===1?_=n.getLocalConversation("".concat(Z.CONV_C2C).concat(E)):S===2&&(_=n.getLocalConversation("".concat(Z.CONV_GROUP).concat(M))),_&&(V.log("".concat(n._className,".onConversationUnpinned conversationID:").concat(_.conversationID," isPinned:").concat(_.isPinned)),_.isPinned&&(_.isPinned=!1,l=!0))}),l&&this._sortConversationListAndEmitEvent()}}},{key:"getMessageList",value:function(e){var n=this,l=e.conversationID,h=e.nextReqMessageID,_=e.count,S="".concat(this._className,".getMessageList"),E=this.getLocalConversation(l),M="";if(E&&E.groupProfile&&(M=E.groupProfile.type),Ws(M))return V.log("".concat(S," not available in avchatroom. conversationID:").concat(l)),En({messageList:[],nextReqMessageID:"",isCompleted:!0});(Ke(_)||_>15)&&(_=15),!h&&this._isNotInCommunity(l)&&(this._messageListHandler.removeByConversationID(l),this._completedMap.delete(l),this._roamingMessageSequenceMap.delete(l));var w=this._computeRemainingCount({conversationID:l,nextReqMessageID:h}),L=this._completedMap.has(l);if(V.log("".concat(S," conversationID:").concat(l," nextReqMessageID:").concat(h)+" remainingCount:".concat(w," count:").concat(_," isCompleted:").concat(L)),this._needGetHistory({conversationID:l,remainingCount:w,count:_}))return this.getHistoryMessages({conversationID:l,nextReqMessageID:h,count:20}).then(function(ne){var ae=ne.nextReqID,he=ne.storedMessageList,ge=n._completedMap.has(l),Te=he;w>0&&(Te=n._messageListHandler.getLocalMessageList(l).slice(0,he.length+w));var Ze={nextReqMessageID:ge?"":ae,messageList:Te,isCompleted:ge};return V.log("".concat(S," ret.nextReqMessageID:").concat(Ze.nextReqMessageID," ret.isCompleted:").concat(Ze.isCompleted," ret.length:").concat(Te.length)),Wt(Ze)});this.modifyMessageList(l);var H=this._getMessageListFromMemory({conversationID:l,nextReqMessageID:h,count:_});return En(H)}},{key:"_getMessageListFromMemory",value:function(e){var n=e.conversationID,l=e.nextReqMessageID,h=e.count,_="".concat(this._className,"._getMessageListFromMemory"),S=this._messageListHandler.getLocalMessageList(n),E=S.length,M=0,w={isCompleted:!1,nextReqMessageID:"",messageList:[]};return l?(M=S.findIndex(function(L){return L.ID===l}))>h?(w.messageList=S.slice(M-h,M),w.nextReqMessageID=S[M-h].ID):(w.messageList=S.slice(0,M),w.isCompleted=!0):E>h?(M=E-h,w.messageList=S.slice(M,E),w.nextReqMessageID=S[M].ID):(w.messageList=S.slice(0,E),w.isCompleted=!0),V.log("".concat(_," conversationID:").concat(n)+" ret.nextReqMessageID:".concat(w.nextReqMessageID," ret.isCompleted:").concat(w.isCompleted," ret.length:").concat(w.messageList.length)),w}},{key:"getMessageListHopping",value:function(e){var n=e.conversationID,l=e.sequence,h=e.time,_=e.count,S=e.direction,E=S===void 0?0:S;if((Ke(_)||_>15)&&(_=15),n.startsWith(Z.CONV_C2C)){var M=this.getModule(Vi),w=n.replace(Z.CONV_C2C,"");return M.getRoamingMessagesHopping({peerAccount:w,time:h,count:_,direction:E})}if(n.startsWith(Z.CONV_GROUP)){var L=this.getModule(pn),H=n.replace(Z.CONV_GROUP,"");return L.getRoamingMessagesHopping({groupID:H,sequence:l,count:_,direction:E})}}},{key:"_computeRemainingCount",value:function(e){var n=e.conversationID,l=e.nextReqMessageID,h=this._messageListHandler.getLocalMessageList(n),_=h.length;if(!l)return _;var S=0;return $m(n)?S=h.findIndex(function(E){return E.ID===l}):Zl(n)&&(S=l.indexOf("-")!==-1?h.findIndex(function(E){return E.ID===l}):h.findIndex(function(E){return E.sequence===l})),S===-1&&(S=0),S}},{key:"_getMessageListSize",value:function(e){return this._messageListHandler.getLocalMessageList(e).length}},{key:"_needGetHistory",value:function(e){var n=e.conversationID,l=e.remainingCount,h=e.count,_=this.getLocalConversation(n),S="";return _&&_.groupProfile&&(S=_.groupProfile.type),!ty(n)&&!Ws(S)&&!(Zl(n)&&this._isPagingGetGroupListCompleted()&&!this._hasLocalGroup(n)&&!this._isTopicConversation(n))&&l<=h&&!this._completedMap.has(n)}},{key:"_isTopicConversation",value:function(e){var n=e.replace(Z.CONV_GROUP,"");return Lt(n)}},{key:"getHistoryMessages",value:function(e){var n=e.conversationID,l=e.count;if(n===Z.CONV_SYSTEM)return En();var h=15;l>20&&(h=20);var _=null;if($m(n)){var S=this._roamingMessageKeyAndTimeMap.has(n);return(_=this.getModule(Vi))?_.getRoamingMessage({conversationID:n,peerAccount:n.replace(Z.CONV_C2C,""),count:h,lastMessageTime:S?this._roamingMessageKeyAndTimeMap.get(n).lastMessageTime:0,messageKey:S?this._roamingMessageKeyAndTimeMap.get(n).messageKey:""}):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}if(Zl(n)){if(!(_=this.getModule(pn)))return Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE});var E=null;this._conversationMap.has(n)&&(E=this._conversationMap.get(n).lastMessage);var M=0;E&&(M=E.lastSequence);var w=this._roamingMessageSequenceMap.get(n);return _.getRoamingMessage({conversationID:n,groupID:n.replace(Z.CONV_GROUP,""),count:h,sequence:w||M})}return En()}},{key:"patchConversationLastMessage",value:function(e){var n=this.getLocalConversation(e);if(n){var l=n.lastMessage,h=l.messageForShow,_=l.payload;if(Mt(h)||Mt(_)){var S=this._messageListHandler.getLocalMessageList(e);if(S.length===0)return;var E=S[S.length-1];V.log("".concat(this._className,".patchConversationLastMessage conversationID:").concat(e," payload:"),E.payload),n.updateLastMessage(E)}}}},{key:"onRoamingMessage",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,l=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],h=n.startsWith(Z.CONV_C2C)?Z.CONV_C2C:Z.CONV_GROUP,_=null,S=[],E=[],M=0,w=e.length,L=null,H=h===Z.CONV_GROUP,ne=this.getModule(Ym),ae=function(){M=H?e.length-1:0,w=H?0:e.length},he=function(){H?--M:++M},ge=function(){return H?M>=w:M<w};for(ae();ge();he())if(H&&e[M].sequence===1&&l&&this.setCompleted(n),e[M].isPlaceMessage!==1)if((_=new Bi(e[M])).to=e[M].to,h!==Z.CONV_GROUP||Ke(e[M].topicID)||(_.to=e[M].topicID),_.isSystemMessage=!!e[M].isSystemMessage,_.conversationType=h,e[M].event===4?L={type:Z.MSG_GRP_TIP,content:m(m({},e[M].elements),{},{groupProfile:e[M].groupProfile})}:(e[M].elements=ne.parseElements(e[M].elements,e[M].from),L=e[M].elements),H||_.setNickAndAvatar({nick:e[M].nick,avatar:e[M].avatar}),Mt(L)){var Te=new ht(yt.EMPTY_MESSAGE_BODY);Te.setMessage("from:".concat(_.from," to:").concat(_.to," sequence:").concat(_.sequence," event:").concat(e[M].event)),Te.setNetworkType(this.getNetworkType()).setLevel("warning").end()}else _.setElement(L),_.reInitialize(this.getMyUserID()),S.push(_);return ae=he=ge=null,l?(this._messageListHandler.unshift(S,E),S=null,E):(E=null,S)}},{key:"findMessage",value:function(e){return this._messageListHandler.findMessage(e)}},{key:"_isNotInCommunity",value:function(e){var n=!1;if(e.startsWith(Z.CONV_GROUP)&&this._isTopicConversation(e)){var l=wo(e.replace(Z.CONV_GROUP,""));this.getModule(pn).hasLocalGroup(l)||(n=!0)}return n}},{key:"deleteTopicRoamingMessageInfo",value:function(e){var n=this;vo({groupID:e})&&this._messageListHandler.getTopicConversationIDList(e).forEach(function(l){n._messageListHandler.removeByConversationID(l),n._completedMap.delete(l),n._roamingMessageSequenceMap.delete(l)})}},{key:"deleteGroupRomaingMessageInfo",value:function(e){var n="".concat(Z.CONV_GROUP).concat(e);this._messageListHandler.removeByConversationID(n),this._completedMap.delete(n),this._roamingMessageSequenceMap.delete(n)}},{key:"setMessageRead",value:function(e){var n=e.conversationID,l=this.getLocalConversation(n);if(V.log("".concat(this._className,".setMessageRead conversationID:").concat(n," unreadCount:").concat(l?l.unreadCount:0)),!l||(l.type!==Z.CONV_GROUP&&l.type!==Z.CONV_TOPIC||Mt(l.groupAtInfoList)||this.deleteGroupAtTips(n),l.unreadCount===0))return En();if(l.type===Z.CONV_GROUP&&!this._hasLocalGroup(n))return l.unreadCount!==0&&(l.unreadCount=0,this.emitConversationUpdate(!0,!1)),En();var h=this._messageListHandler.getLocalLastMessage(n),_=l.lastMessage.lastTime;h&&_<h.time&&(_=h.time);var S=l.lastMessage.lastSequence;if(h&&S<h.sequence&&(S=h.sequence),l.type===Z.CONV_TOPIC&&Ke(h)){var E=this.getModule(ri),M=n.replace(Z.CONV_GROUP,""),w=wo(M),L=E.getLocalTopic(w,M);L&&(S=L.nextMessageSeq-1)}var H=null;switch(l.type){case Z.CONV_C2C:return(H=this.getModule(Vi))?H.setMessageRead({conversationID:n,lastMessageTime:_}):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE});case Z.CONV_GROUP:case Z.CONV_TOPIC:return(H=this.getModule(pn))?H.setMessageRead({conversationID:n,lastMessageSeq:S}):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE});case Z.CONV_SYSTEM:return l.unreadCount=0,this.emitConversationUpdate(!0,!1),En();default:return En()}}},{key:"setAllMessageRead",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l="".concat(this._className,".setAllMessageRead");n.scope||(n.scope=Z.READ_ALL_MSG),V.log("".concat(l," options:"),n);var h=this._createSetAllMessageReadPack(n);if(h.readAllC2CMessage===0&&h.groupMessageReadInfoList.length===0)return En();var _=new ht(yt.SET_ALL_MESSAGE_READ);return this.request({protocolName:Xr,requestData:h}).then(function(S){var E=S.data,M=e._handleAllMessageRead(E);return _.setMessage("scope:".concat(n.scope," failureGroups:").concat(JSON.stringify(M))).setNetworkType(e.getNetworkType()).end(),En()}).catch(function(S){return e.probeNetwork().then(function(E){var M=Ue(E,2),w=M[0],L=M[1];_.setError(S,w,L).end()}),V.warn("".concat(l," failed. error:"),S),Le({code:S&&S.code?S.code:We.MESSAGE_UNREAD_ALL_FAIL,message:S&&S.message?S.message:at.MESSAGE_UNREAD_ALL_FAIL})})}},{key:"_getConversationLastMessageSequence",value:function(e){var n=this._messageListHandler.getLocalLastMessage(e.conversationID),l=e.lastMessage.lastSequence;return n&&l<n.sequence&&(l=n.sequence),l}},{key:"_getConversationLastMessageTime",value:function(e){var n=this._messageListHandler.getLocalLastMessage(e.conversationID),l=e.lastMessage.lastTime;return n&&l<n.time&&(l=n.time),l}},{key:"_createSetAllMessageReadPack",value:function(e){var n,l={readAllC2CMessage:0,groupMessageReadInfoList:[]},h=e.scope,_=De(this._conversationMap);try{for(_.s();!(n=_.n()).done;){var S=Ue(n.value,2)[1];if(S.unreadCount>0){if(S.type===Z.CONV_C2C&&l.readAllC2CMessage===0){if(h===Z.READ_ALL_MSG)l.readAllC2CMessage=1;else if(h===Z.READ_ALL_C2C_MSG){l.readAllC2CMessage=1;break}}else if(S.type===Z.CONV_GROUP&&(h===Z.READ_ALL_GROUP_MSG||h===Z.READ_ALL_MSG)){var E=this._getConversationLastMessageSequence(S);l.groupMessageReadInfoList.push({groupID:S.groupProfile.groupID,messageSequence:E})}}}}catch(M){_.e(M)}finally{_.f()}return l}},{key:"onPushedAllMessageRead",value:function(e){this._handleAllMessageRead(e)}},{key:"_handleAllMessageRead",value:function(e){var n=e.groupMessageReadInfoList,l=e.readAllC2CMessage,h=this._parseGroupReadInfo(n);return this._updateAllConversationUnreadCount({readAllC2CMessage:l})>=1&&this.emitConversationUpdate(!0,!1),h}},{key:"_parseGroupReadInfo",value:function(e){var n=[];if(e&&e.length)for(var l=0,h=e.length;l<h;l++){var _=e[l],S=_.groupID,E=_.sequence,M=_.retCode,w=_.lastMessageSeq;Ke(M)?this._remoteGroupReadSequenceMap.set(S,w):(this._remoteGroupReadSequenceMap.set(S,E),M!==0&&n.push("".concat(S,"-").concat(E,"-").concat(M)))}return n}},{key:"_updateAllConversationUnreadCount",value:function(e){var n,l=e.readAllC2CMessage,h=0,_=De(this._conversationMap);try{for(_.s();!(n=_.n()).done;){var S=Ue(n.value,2),E=S[0],M=S[1];if(M.unreadCount>=1){if(l===1&&M.type===Z.CONV_C2C){var w=this._getConversationLastMessageTime(M);this.updateIsReadAfterReadReport({conversationID:E,lastMessageTime:w})}else if(M.type===Z.CONV_GROUP){var L=E.replace(Z.CONV_GROUP,"");if(this._remoteGroupReadSequenceMap.has(L)){var H=this._remoteGroupReadSequenceMap.get(L),ne=this._getConversationLastMessageSequence(M);this.updateIsReadAfterReadReport({conversationID:E,remoteReadSequence:H}),ne>=H&&this._remoteGroupReadSequenceMap.delete(L)}}this.updateUnreadCount(E,!1)&&(h+=1)}}}catch(ae){_.e(ae)}finally{_.f()}return h}},{key:"isRemoteRead",value:function(e){var n=e.conversationID,l=e.sequence,h=n.replace(Z.CONV_GROUP,""),_=!1;if(this._remoteGroupReadSequenceMap.has(h)){var S=this._remoteGroupReadSequenceMap.get(h);l<=S&&(_=!0,V.log("".concat(this._className,".isRemoteRead conversationID:").concat(n," messageSequence:").concat(l," remoteReadSequence:").concat(S))),l>=S+10&&this._remoteGroupReadSequenceMap.delete(h)}return _}},{key:"updateIsReadAfterReadReport",value:function(e){var n=e.conversationID,l=e.lastMessageSeq,h=e.lastMessageTime,_=this._messageListHandler.getLocalMessageList(n);if(_.length!==0){for(var S,E=_.length-1;E>=0;E--)if(S=_[E],!(h&&S.time>h||l&&S.sequence>l)){if(S.flow==="in"&&S.isRead)break;S.setIsRead(!0)}}}},{key:"updateUnreadCount",value:function(e){var n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],l=!1,h=this.getLocalConversation(e),_=this._messageListHandler.getLocalMessageList(e);if(h){var S=h.unreadCount,E=_.filter(function(H){return!H.isRead&&!H._onlineOnlyFlag&&!H.isDeleted}).length;if(S!==E&&(h.unreadCount=E,l=!0,V.log("".concat(this._className,".updateUnreadCount from ").concat(S," to ").concat(E,", conversationID:").concat(e)),n===!0&&this.emitConversationUpdate(!0,!1)),l&&h.type===Z.CONV_TOPIC){var M=h.unreadCount,w=this.getModule(ri),L=e.replace(Z.CONV_GROUP,"");w.onConversationProxy({topicID:L,unreadCount:M})}return l}}},{key:"clearGroupAtInfoList",value:function(e){var n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],l=this.getLocalConversation(e);if(l&&l.groupAtInfoList.length>0){if(l.clearGroupAtInfoList(),V.log("".concat(this._className,".clearGroupAtInfoList conversationID:").concat(e)),l.type===Z.CONV_TOPIC){var h=l.groupAtInfoList,_=this.getModule(ri),S=e.replace(Z.CONV_GROUP,"");_.onConversationProxy({topicID:S,groupAtInfoList:h})}n===!0&&this.emitConversationUpdate(!0,!1)}}},{key:"updateReadReceiptInfo",value:function(e){var n=this,l=e.userID,h=l===void 0?void 0:l,_=e.groupID,S=_===void 0?void 0:_,E=e.readReceiptList;if(!Mt(E)){var M=[];if(Ke(h)){if(!Ke(S)){var w="".concat(Z.CONV_GROUP).concat(S);E.forEach(function(H){var ne=H.tinyID,ae=H.clientTime,he=H.random,ge=H.readCount,Te=H.unreadCount,Ze="".concat(ne,"-").concat(ae,"-").concat(he),Ct=n._messageListHandler.getLocalMessage(w,Ze),wt={groupID:S,messageID:Ze,readCount:0,unreadCount:0};Ct&&(gr(ge)&&(Ct.readReceiptInfo.readCount=ge,wt.readCount=ge),gr(Te)&&(Ct.readReceiptInfo.unreadCount=Te,wt.unreadCount=Te),M.push(wt))})}}else{var L="".concat(Z.CONV_C2C).concat(h);E.forEach(function(H){var ne=H.tinyID,ae=H.clientTime,he=H.random,ge="".concat(ne,"-").concat(ae,"-").concat(he),Te=n._messageListHandler.getLocalMessage(L,ge);if(Te&&!Te.isPeerRead){Te.isPeerRead=!0;var Ze={userID:h,messageID:ge,isPeerRead:!0};M.push(Ze)}})}M.length>0&&this.emitOuterEvent(mn.MESSAGE_READ_RECEIPT_RECEIVED,M)}}},{key:"recomputeGroupUnreadCount",value:function(e){var n=e.conversationID,l=e.count,h=this.getLocalConversation(n);if(h){var _=h.unreadCount,S=_-l;S<0&&(S=0),h.unreadCount=S,V.log("".concat(this._className,".recomputeGroupUnreadCount from ").concat(_," to ").concat(S,", conversationID:").concat(n))}}},{key:"updateIsRead",value:function(e){var n=this.getLocalConversation(e),l=this.getLocalMessageList(e);if(n&&l.length!==0&&!ty(n.type)){for(var h=[],_=0,S=l.length;_<S;_++)l[_].flow!=="in"?l[_].flow!=="out"||l[_].isRead||l[_].setIsRead(!0):h.push(l[_]);var E=0;if(n.type===Z.CONV_C2C){var M=h.slice(-n.unreadCount).filter(function(L){return L.isRevoked}).length;E=h.length-n.unreadCount-M}else E=h.length-n.unreadCount;for(var w=0;w<E&&!h[w].isRead;w++)h[w].setIsRead(!0)}}},{key:"deleteGroupAtTips",value:function(e){var n=this,l="".concat(this._className,".deleteGroupAtTips");V.log("".concat(l));var h=this._conversationMap.get(e);if(!h)return Promise.resolve();var _=h.groupAtInfoList;if(_.length===0)return Promise.resolve();var S=void 0;e.startsWith(Z.CONV_GROUP)&&(S=e.replace(Z.CONV_GROUP,""));var E=Be(_);if((vo({groupID:S})||Lt(S))&&(E=_.filter(function(w){return!w.atTypeArray.includes(Z.CONV_AT_ALL)})).length===0)return this.clearGroupAtInfoList(e,!1),Promise.resolve();var M=this.getMyUserID();return this.request({protocolName:_f,requestData:{messageListToDelete:E.map(function(w){return{from:w.from,to:M,messageSeq:w.__sequence,messageRandom:w.__random,groupID:Ke(w.topicID)?w.groupID:w.topicID}})}}).then(function(){return V.log("".concat(l," ok. count:").concat(_.length)),n.clearGroupAtInfoList(e,!1),Promise.resolve()}).catch(function(w){return V.error("".concat(l," failed. error:"),w),Le(w)})}},{key:"appendToMessageList",value:function(e){this._messageListHandler.pushIn(e)}},{key:"setMessageRandom",value:function(e){this.singlyLinkedList.set(e.random)}},{key:"deleteMessageRandom",value:function(e){this.singlyLinkedList.delete(e.random)}},{key:"pushIntoMessageList",value:function(e,n,l){return!(!this._messageListHandler.pushIn(n,l)||this._isMessageFromCurrentInstance(n)&&!l)&&(e.push(n),!0)}},{key:"_isMessageFromCurrentInstance",value:function(e){return this.singlyLinkedList.has(e.random)}},{key:"revoke",value:function(e,n,l){return this._messageListHandler.revoke(e,n,l)}},{key:"getPeerReadTime",value:function(e){return this._peerReadTimeMap.get(e)}},{key:"recordPeerReadTime",value:function(e,n){this._peerReadTimeMap.has(e)?this._peerReadTimeMap.get(e)<n&&this._peerReadTimeMap.set(e,n):this._peerReadTimeMap.set(e,n)}},{key:"updateMessageIsPeerReadProperty",value:function(e,n){if(e.startsWith(Z.CONV_C2C)&&n>0){var l=this._messageListHandler.updateMessageIsPeerReadProperty(e,n);if(l.length>0&&this.emitOuterEvent(mn.MESSAGE_READ_BY_PEER,l),this._conversationMap.has(e)){var h=this._conversationMap.get(e).lastMessage;Mt(h)||h.fromAccount===this.getMyUserID()&&h.lastTime<=n&&!h.isPeerRead&&(h.isPeerRead=!0,this.emitConversationUpdate(!0,!1))}}}},{key:"updateMessageIsModifiedProperty",value:function(e){this._messageListHandler.updateMessageIsModifiedProperty(e)}},{key:"setCompleted",value:function(e){V.log("".concat(this._className,".setCompleted. conversationID:").concat(e)),this._completedMap.set(e,!0)}},{key:"updateRoamingMessageKeyAndTime",value:function(e,n,l){this._roamingMessageKeyAndTimeMap.set(e,{messageKey:n,lastMessageTime:l})}},{key:"updateRoamingMessageSequence",value:function(e,n){this._roamingMessageSequenceMap.set(e,n)}},{key:"getConversationList",value:function(e){var n=this,l="".concat(this._className,".getConversationList"),h="pagingStatus:".concat(this._pagingStatus,", local conversation count:").concat(this._conversationMap.size,", options:").concat(e);if(V.log("".concat(l,". ").concat(h)),this._pagingStatus===ju.REJECTED){var _=new ht(yt.GET_CONVERSATION_LIST);return _.setMessage(h),this.syncConversationList().then(function(){_.setNetworkType(n.getNetworkType()).end();var M=n._getConversationList(e);return Wt({conversationList:M})}).catch(function(M){return n.probeNetwork().then(function(w){var L=Ue(w,2),H=L[0],ne=L[1];_.setError(M,H,ne).end()}),V.error("".concat(l," failed. error:"),M),Le(M)})}if(this._conversationMap.size===0){var S=new ht(yt.GET_CONVERSATION_LIST);return S.setMessage(h),this.syncConversationList().then(function(){S.setNetworkType(n.getNetworkType()).end();var M=n._getConversationList(e);return Wt({conversationList:M})}).catch(function(M){return n.probeNetwork().then(function(w){var L=Ue(w,2),H=L[0],ne=L[1];S.setError(M,H,ne).end()}),V.error("".concat(l," failed. error:"),M),Le(M)})}var E=this._getConversationList(e);return V.log("".concat(l,". returned conversation count:").concat(E.length)),En({conversationList:E})}},{key:"_getConversationList",value:function(e){var n=this;if(Ke(e))return this.getLocalConversationList();if(Yt(e)){var l=[];return e.forEach(function(h){if(n._conversationMap.has(h)){var _=n.getLocalConversation(h);l.push(_)}}),l}}},{key:"_handleC2CPeerReadTime",value:function(){var e,n=De(this._conversationMap);try{for(n.s();!(e=n.n()).done;){var l=Ue(e.value,2),h=l[0],_=l[1];_.type===Z.CONV_C2C&&(V.debug("".concat(this._className,"._handleC2CPeerReadTime conversationID:").concat(h," peerReadTime:").concat(_.peerReadTime)),this.recordPeerReadTime(h,_.peerReadTime))}}catch(S){n.e(S)}finally{n.f()}}},{key:"_isPagingGetGroupListCompleted",value:function(){return this.getModule(pn).isPagingGetCompleted()}},{key:"_hasLocalGroup",value:function(e){return this.getModule(pn).hasLocalGroup(e.replace(Z.CONV_GROUP,""))}},{key:"getConversationProfile",value:function(e){var n,l=this;if((n=this._conversationMap.has(e)?this._conversationMap.get(e):new Uf({conversationID:e,type:e.slice(0,3)===Z.CONV_C2C?Z.CONV_C2C:Z.CONV_GROUP}))._isInfoCompleted||n.type===Z.CONV_SYSTEM)return En({conversation:n});if(Zl(e)&&!this._hasLocalGroup(e))return En({conversation:n});var h=new ht(yt.GET_CONVERSATION_PROFILE),_="".concat(this._className,".getConversationProfile");return V.log("".concat(_,". conversationID:").concat(e," remark:").concat(n.remark," lastMessage:"),n.lastMessage),this._updateUserOrGroupProfileCompletely(n).then(function(S){h.setNetworkType(l.getNetworkType()).setMessage("conversationID:".concat(e," unreadCount:").concat(S.data.conversation.unreadCount)).end();var E=l.getModule(ni);if(E&&n.type===Z.CONV_C2C){var M=e.replace(Z.CONV_C2C,"");if(E.isMyFriend(M)){var w=E.getFriendRemark(M);n.remark!==w&&(n.remark=w,V.log("".concat(_,". conversationID:").concat(e," patch remark:").concat(n.remark)))}}return V.log("".concat(_," ok. conversationID:").concat(e)),S}).catch(function(S){return l.probeNetwork().then(function(E){var M=Ue(E,2),w=M[0],L=M[1];h.setError(S,w,L).setMessage("conversationID:".concat(e)).end()}),V.error("".concat(_," failed. error:"),S),Le(S)})}},{key:"_updateUserOrGroupProfileCompletely",value:function(e){var n=this;return e.type===Z.CONV_C2C?this.getModule(Ei).getUserProfile({userIDList:[e.toAccount]}).then(function(l){var h=l.data;return h.length===0?Le(new Me({code:We.USER_OR_GROUP_NOT_FOUND,message:at.USER_OR_GROUP_NOT_FOUND})):(e.userProfile=h[0],e._isInfoCompleted=!0,n._unshiftConversation(e),En({conversation:e}))}):this.getModule(pn).getGroupProfile({groupID:e.toAccount}).then(function(l){return e.groupProfile=l.data.group,e._isInfoCompleted=!0,n._unshiftConversation(e),En({conversation:e})})}},{key:"_unshiftConversation",value:function(e){e instanceof Uf&&!this._conversationMap.has(e.conversationID)&&(this._conversationMap=new Map([[e.conversationID,e]].concat(Be(this._conversationMap))),this._setStorageConversationList(),this.emitConversationUpdate(!0,!1))}},{key:"_onProfileUpdated",value:function(e){var n=this;e.data.forEach(function(l){var h=l.userID;if(h===n.getMyUserID())n._onMyProfileModified({latestNick:l.nick,latestAvatar:l.avatar});else{var _=n._conversationMap.get("".concat(Z.CONV_C2C).concat(h));_&&(_.userProfile=l)}})}},{key:"deleteConversation",value:function(e){var n=this,l={fromAccount:this.getMyUserID(),toAccount:void 0,type:void 0,toGroupID:void 0};if(!this._conversationMap.has(e)){var h=new Me({code:We.CONVERSATION_NOT_FOUND,message:at.CONVERSATION_NOT_FOUND});return Le(h)}var _=this._conversationMap.get(e).type;if(_===Z.CONV_C2C)l.type=1,l.toAccount=e.replace(Z.CONV_C2C,"");else{if(_!==Z.CONV_GROUP){if(_===Z.CONV_SYSTEM)return this.getModule(pn).deleteGroupSystemNotice({messageList:this._messageListHandler.getLocalMessageList(e)}),this.deleteLocalConversation(e),En({conversationID:e});var S=new Me({code:We.CONVERSATION_UN_RECORDED_TYPE,message:at.CONVERSATION_UN_RECORDED_TYPE});return Le(S)}if(!this._hasLocalGroup(e))return this.deleteLocalConversation(e),En({conversationID:e});l.type=2,l.toGroupID=e.replace(Z.CONV_GROUP,"")}var E=new ht(yt.DELETE_CONVERSATION);E.setMessage("conversationID:".concat(e));var M="".concat(this._className,".deleteConversation");return V.log("".concat(M,". conversationID:").concat(e)),this.setMessageRead({conversationID:e}).then(function(){return n.request({protocolName:_I,requestData:l})}).then(function(){return E.setNetworkType(n.getNetworkType()).end(),V.log("".concat(M," ok")),n.deleteLocalConversation(e),En({conversationID:e})}).catch(function(w){return n.probeNetwork().then(function(L){var H=Ue(L,2),ne=H[0],ae=H[1];E.setError(w,ne,ae).end()}),V.error("".concat(M," failed. error:"),w),Le(w)})}},{key:"pinConversation",value:function(e){var n=this,l=e.conversationID,h=e.isPinned;if(!this._conversationMap.has(l))return Le({code:We.CONVERSATION_NOT_FOUND,message:at.CONVERSATION_NOT_FOUND});var _=this.getLocalConversation(l);if(_.isPinned===h)return En({conversationID:l});var S=new ht(yt.PIN_CONVERSATION);S.setMessage("conversationID:".concat(l," isPinned:").concat(h));var E="".concat(this._className,".pinConversation");V.log("".concat(E,". conversationID:").concat(l," isPinned:").concat(h));var M=null;return $m(l)?M={type:1,toAccount:l.replace(Z.CONV_C2C,"")}:Zl(l)&&(M={type:2,groupID:l.replace(Z.CONV_GROUP,"")}),this.request({protocolName:yI,requestData:{fromAccount:this.getMyUserID(),operationType:h===!0?1:2,itemList:[M]}}).then(function(){return S.setNetworkType(n.getNetworkType()).end(),V.log("".concat(E," ok")),_.isPinned!==h&&(_.isPinned=h,n._sortConversationListAndEmitEvent()),Wt({conversationID:l})}).catch(function(w){return n.probeNetwork().then(function(L){var H=Ue(L,2),ne=H[0],ae=H[1];S.setError(w,ne,ae).end()}),V.error("".concat(E," failed. error:"),w),Le(w)})}},{key:"setMessageRemindType",value:function(e){return this._messageRemindHandler.set(e)}},{key:"patchMessageRemindType",value:function(e){var n=e.ID,l=e.isC2CConversation,h=e.messageRemindType,_=!1,S=this.getLocalConversation(l?"".concat(Z.CONV_C2C).concat(n):"".concat(Z.CONV_GROUP).concat(n));return S&&S.messageRemindType!==h&&(S.messageRemindType=h,_=!0),V.debug("".concat(this._className,".patchMessageRemindType options:"),e,"ret:".concat(_)),_}},{key:"onC2CMessageRemindTypeSynced",value:function(e){var n=this;V.debug("".concat(this._className,".onC2CMessageRemindTypeSynced options:"),e),e.dataList.forEach(function(l){if(!Mt(l.muteNotificationsSync)){var h,_=l.muteNotificationsSync,S=_.to,E=_.updateSequence,M=_.muteFlag;n._messageRemindHandler.setUpdateSequence(E),M===0?h=Z.MSG_REMIND_ACPT_AND_NOTE:M===1?h=Z.MSG_REMIND_DISCARD:M===2&&(h=Z.MSG_REMIND_ACPT_NOT_NOTE);var w=0;n.patchMessageRemindType({ID:S,isC2CConversation:!0,messageRemindType:h})&&(w+=1),V.log("".concat(n._className,".onC2CMessageRemindTypeSynced updateCount:").concat(w)),w>=1&&n.emitConversationUpdate(!0,!1)}})}},{key:"onGroupMessageRemindTypeSynced",value:function(e){V.debug("".concat(this._className,".onGroupMessageRemindTypeSynced options:"),e),this._messageRemindHandler.onGroupMessageRemindTypeUpdated(e)}},{key:"deleteLocalConversation",value:function(e){var n=this._conversationMap.has(e);if(V.log("".concat(this._className,".deleteLocalConversation conversationID:").concat(e," has:").concat(n)),n){this._conversationMap.delete(e),this._roamingMessageKeyAndTimeMap.has(e)&&this._roamingMessageKeyAndTimeMap.delete(e),this._roamingMessageSequenceMap.has(e)&&this._roamingMessageSequenceMap.delete(e),this._setStorageConversationList(),this._messageListHandler.removeByConversationID(e),this._completedMap.delete(e);var l=!this._isTopicConversation(e);this.emitConversationUpdate(l,!1)}}},{key:"isMessageSentByCurrentInstance",value:function(e){return!(!this._messageListHandler.hasLocalMessage(e.conversationID,e.ID)&&!this.singlyLinkedList.has(e.random))}},{key:"modifyMessageList",value:function(e){if(e.startsWith(Z.CONV_C2C)&&this._conversationMap.has(e)){var n=this._conversationMap.get(e),l=Date.now();this._messageListHandler.modifyMessageSentByPeer({conversationID:e,latestNick:n.userProfile.nick,latestAvatar:n.userProfile.avatar});var h=this.getModule(Ei).getNickAndAvatarByUserID(this.getMyUserID());this._messageListHandler.modifyMessageSentByMe({conversationID:e,latestNick:h.nick,latestAvatar:h.avatar}),V.log("".concat(this._className,".modifyMessageList conversationID:").concat(e," cost ").concat(Date.now()-l," ms"))}}},{key:"updateUserProfileSpecifiedKey",value:function(e){V.log("".concat(this._className,".updateUserProfileSpecifiedKey options:"),e);var n=e.conversationID,l=e.nick,h=e.avatar;if(this._conversationMap.has(n)){var _=this._conversationMap.get(n).userProfile;Ln(l)&&_.nick!==l&&(_.nick=l),Ln(h)&&_.avatar!==h&&(_.avatar=h),this.emitConversationUpdate(!0,!1)}}},{key:"_onMyProfileModified",value:function(e){var n=this,l=this.getLocalConversationList(),h=Date.now();l.forEach(function(_){n.modifyMessageSentByMe(m({conversationID:_.conversationID},e))}),V.log("".concat(this._className,"._onMyProfileModified. modify all messages sent by me, cost ").concat(Date.now()-h," ms"))}},{key:"modifyMessageSentByMe",value:function(e){this._messageListHandler.modifyMessageSentByMe(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._messageListHandler.getLatestMessageSentByMe(e)}},{key:"modifyMessageSentByPeer",value:function(e){this._messageListHandler.modifyMessageSentByPeer(e)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._messageListHandler.getLatestMessageSentByPeer(e)}},{key:"pushIntoNoticeResult",value:function(e,n){return!(!this._messageListHandler.pushIn(n)||this.singlyLinkedList.has(n.random))&&(e.push(n),!0)}},{key:"getGroupLocalLastMessageSequence",value:function(e){return this._messageListHandler.getGroupLocalLastMessageSequence(e)}},{key:"checkAndPatchRemark",value:function(){var e=Promise.resolve();if(this._conversationMap.size===0)return e;var n=this.getModule(ni);if(!n)return e;var l=Be(this._conversationMap.values()).filter(function(_){return _.type===Z.CONV_C2C});if(l.length===0)return e;var h=0;return l.forEach(function(_){var S=_.conversationID.replace(Z.CONV_C2C,"");if(n.isMyFriend(S)){var E=n.getFriendRemark(S);_.remark!==E&&(_.remark=E,h+=1)}}),V.log("".concat(this._className,".checkAndPatchRemark. c2c conversation count:").concat(l.length,", patched count:").concat(h)),e}},{key:"updateTopicConversation",value:function(e){this._updateLocalConversationList({conversationOptionsList:e,isFromGetConversations:!0})}},{key:"sendReadReceipt",value:function(e){var n=e[0],l=null;return n.conversationType===Z.CONV_C2C?l=this._moduleManager.getModule(Vi):n.conversationType===Z.CONV_GROUP&&(l=this._moduleManager.getModule(pn)),l?l.sendReadReceipt(e):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"getReadReceiptList",value:function(e){var n=e[0],l=null;return n.conversationType===Z.CONV_C2C?l=this._moduleManager.getModule(Vi):n.conversationType===Z.CONV_GROUP&&(l=this._moduleManager.getModule(pn)),l?l.getReadReceiptList(e):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"getLastMessageTime",value:function(e){var n=this.getLocalConversation(e);return n?n.lastMessage.lastTime:0}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),this._pagingStatus=ju.NOT_START,this._messageListHandler.reset(),this._messageRemindHandler.reset(),this._roamingMessageKeyAndTimeMap.clear(),this._roamingMessageSequenceMap.clear(),this.singlyLinkedList.reset(),this._peerReadTimeMap.clear(),this._completedMap.clear(),this._conversationMap.clear(),this._pagingTimeStamp=0,this._pagingStartIndex=0,this._pagingPinnedTimeStamp=0,this._pagingPinnedStartIndex=0,this._remoteGroupReadSequenceMap.clear(),this.resetReady()}}]),o}(Ti),pE=function(){function a(t){A(this,a),this._groupModule=t,this._className="GroupTipsHandler",this._cachedGroupTipsMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this._getTopicPendingMap=new Map}return x(a,[{key:"onCheckTimer",value:function(t){t%1==0&&this._cachedGroupTipsMap.size>0&&this._checkCachedGroupTips()}},{key:"_checkCachedGroupTips",value:function(){var t=this;this._cachedGroupTipsMap.forEach(function(o,e){var n=t._checkCountMap.get(e),l=t._groupModule.hasLocalGroup(e);V.log("".concat(t._className,"._checkCachedGroupTips groupID:").concat(e," hasLocalGroup:").concat(l," checkCount:").concat(n)),l?(t._notifyCachedGroupTips(e),t._checkCountMap.delete(e),t._groupModule.deleteUnjoinedAVChatRoom(e)):n>=t.MAX_CHECK_COUNT?(t._deleteCachedGroupTips(e),t._checkCountMap.delete(e)):(n++,t._checkCountMap.set(e,n))})}},{key:"onNewGroupTips",value:function(t){V.debug("".concat(this._className,".onReceiveGroupTips count:").concat(t.dataList.length));var o=this.newGroupTipsStoredAndSummary(t),e=o.eventDataList,n=o.result,l=o.AVChatRoomMessageList;l.length>0&&this._groupModule.onAVChatRoomMessage(l),e.length>0&&(this._groupModule.updateNextMessageSeq(e),this._groupModule.getModule(Vt).onNewMessage({conversationOptionsList:e,isInstantMessage:!0})),n.length>0&&(this._groupModule.emitOuterEvent(mn.MESSAGE_RECEIVED,n),this.handleMessageList(n))}},{key:"newGroupTipsStoredAndSummary",value:function(t){for(var o=this,e=t.event,n=t.dataList,l=null,h=[],_=[],S={},E=[],M=function(H,ne){var ae=H0(n[H]),he=ae.groupProfile,ge=he.groupID,Te=he.communityType,Ze=Te===void 0?0:Te,Ct=he.topicID,wt=Ct===void 0?void 0:Ct,dn=void 0,$t=Ze===2&&!Mt(wt);if($t){dn=Z.CONV_TOPIC,ae.to=wt;var Kn=o._groupModule.getModule(ri);Kn.hasLocalTopic(ge,wt)||o._getTopicPendingMap.has(wt)||(o._getTopicPendingMap.set(wt,1),Kn.getTopicList({groupID:ge,topicIDList:[wt]}).finally(function(){o._getTopicPendingMap.delete(wt)}))}if(Ze===2&&Mt(wt))return"continue";var xn=o._groupModule.hasLocalGroup(ge);if(!xn&&o._groupModule.isUnjoinedAVChatRoom(ge))return"continue";if(!xn&&!$t)return o._cacheGroupTipsAndProbe({groupID:ge,event:e,item:ae}),"continue";if(o._groupModule.isMessageFromOrToAVChatroom(ge))return ae.event=e,E.push(ae),"continue";ae.currentUser=o._groupModule.getMyUserID(),ae.conversationType=Z.CONV_GROUP,(l=new Bi(ae)).setElement({type:Z.MSG_GRP_TIP,content:m(m({},ae.elements),{},{groupProfile:ae.groupProfile})}),l.isSystemMessage=!1;var On=o._groupModule.getModule(Vt),ar=l,yr=ar.conversationID,Mi=ar.sequence;if(e===6)l._onlineOnlyFlag=!0,_.push(l);else if(!On.pushIntoNoticeResult(_,l))return"continue";if(e===6&&On.getLocalConversation(yr))return"continue";e!==6&&o._groupModule.getModule(Ur).addMessageSequence({key:Sf,message:l});var Ko=On.isRemoteRead({conversationID:yr,sequence:Mi});if(Ke(S[yr])){var fa=0;l.flow==="in"&&(l._isExcludedFromUnreadCount||l._onlineOnlyFlag||Ko||(fa=1)),S[yr]=h.push({conversationID:yr,unreadCount:fa,type:Ke(dn)?l.conversationType:dn,subType:l.conversationSubType,lastMessage:l._isExcludedFromLastMessage?"":l})-1}else{var To=S[yr];h[To].type=l.conversationType,h[To].subType=l.conversationSubType,h[To].lastMessage=l._isExcludedFromLastMessage?"":l,l.flow==="in"&&(l._isExcludedFromUnreadCount||l._onlineOnlyFlag||Ko||h[To].unreadCount++)}},w=0,L=n.length;w<L;w++)M(w);return{eventDataList:h,result:_,AVChatRoomMessageList:E}}},{key:"handleMessageList",value:function(t){var o=this;t.forEach(function(e){switch(e.payload.operationType){case 1:o._onNewMemberComeIn(e);break;case 2:o._onMemberQuit(e);break;case 3:o._onMemberKickedOut(e);break;case 4:o._onMemberSetAdmin(e);break;case 5:o._onMemberCancelledAdmin(e);break;case 6:o._onGroupProfileModified(e);break;case 7:o._onMemberInfoModified(e);break;case 8:o._onTopicProfileUpdated(e);break;default:V.warn("".concat(o._className,".handleMessageList unknown operationType:").concat(e.payload.operationType))}})}},{key:"_onNewMemberComeIn",value:function(t){var o=t.payload,e=o.memberNum,n=o.groupProfile.groupID,l=this._groupModule.getLocalGroupProfile(n);l&&gr(e)&&l.memberCount!==e&&(l.memberCount=e,this._updateConversationGroupProfile(l))}},{key:"_onMemberQuit",value:function(t){var o=t.payload,e=o.memberNum,n=o.groupProfile.groupID,l=this._groupModule.getLocalGroupProfile(n);l&&gr(e)&&l.memberCount!==e&&(l.memberCount=e,this._updateConversationGroupProfile(l)),this._groupModule.getModule(gi).deleteLocalGroupMembers(n,t.payload.userIDList)}},{key:"_onMemberKickedOut",value:function(t){var o=t.payload,e=o.memberNum,n=o.groupProfile.groupID,l=this._groupModule.getLocalGroupProfile(n);l&&gr(e)&&l.memberCount!==e&&(l.memberCount=e,this._updateConversationGroupProfile(l)),this._groupModule.getModule(gi).deleteLocalGroupMembers(n,t.payload.userIDList)}},{key:"_updateConversationGroupProfile",value:function(t){this._groupModule.getModule(Vt).updateConversationGroupProfile([t])}},{key:"_onMemberSetAdmin",value:function(t){var o=t.payload.groupProfile.groupID,e=t.payload.userIDList,n=this._groupModule.getModule(gi);e.forEach(function(l){var h=n.getLocalGroupMemberInfo(o,l);h&&h.updateRole(Z.GRP_MBR_ROLE_ADMIN)})}},{key:"_onMemberCancelledAdmin",value:function(t){var o=t.payload.groupProfile.groupID,e=t.payload.userIDList,n=this._groupModule.getModule(gi);e.forEach(function(l){var h=n.getLocalGroupMemberInfo(o,l);h&&h.updateRole(Z.GRP_MBR_ROLE_MEMBER)})}},{key:"_onGroupProfileModified",value:function(t){var o=this,e=t.payload,n=e.newGroupProfile,l=e.groupProfile.groupID,h=this._groupModule.getLocalGroupProfile(l);Object.keys(n).forEach(function(S){switch(S){case"ownerID":o._ownerChanged(h,n);break;case"muteAllMembers":h.muteAllMembers=n.muteAllMembers;break;case"joinOption":h.joinOption=n.joinOption;break;default:h[S]=n[S]}});var _=!h.isSupportTopic;this._groupModule.emitGroupListUpdate(!0,_)}},{key:"_ownerChanged",value:function(t,o){var e=t.groupID,n=this._groupModule.getLocalGroupProfile(e),l=this._groupModule.getMyUserID();if(l===o.ownerID){n.updateGroup({selfInfo:{role:Z.GRP_MBR_ROLE_OWNER}});var h=this._groupModule.getModule(gi),_=h.getLocalGroupMemberInfo(e,l),S=this._groupModule.getLocalGroupProfile(e).ownerID,E=h.getLocalGroupMemberInfo(e,S);_&&_.updateRole(Z.GRP_MBR_ROLE_OWNER),E&&E.updateRole(Z.GRP_MBR_ROLE_MEMBER)}}},{key:"_onMemberInfoModified",value:function(t){var o=t.to,e=t.payload,n=e.groupProfile,l=e.memberList,h=n.groupID;Lt(o)&&this._updateTopicMuteTime(t);var _=this._groupModule.getModule(gi);l.forEach(function(S){var E=_.getLocalGroupMemberInfo(h,S.userID);E&&gr(S.muteTime)&&E.updateMuteUntil(S.muteTime)})}},{key:"_updateTopicMuteTime",value:function(t){var o=t.to,e=t.payload,n=e.groupProfile,l=e.memberList,h=l===void 0?[]:l,_=this._groupModule.getModule(ri),S=n.groupID,E=_.getLocalTopic(S,o);if(E){for(var M=!1,w=0;w<h.length;w++){var L=h[w];if(L.userID===this._groupModule.getMyUserID()&&L.muteTime>=0){E.updateSelfInfo({muteTime:L.muteTime}),M=!0;break}}M&&this._groupModule.emitOuterEvent(mn.TOPIC_UPDATED,{groupID:S,topic:E})}}},{key:"_onTopicProfileUpdated",value:function(t){var o=t.payload,e=o.groupProfile.groupID,n=o.newTopicInfo;this._groupModule.getModule(ri).onTopicProfileUpdated(m({groupID:e,topicID:t.to},n))}},{key:"_cacheGroupTips",value:function(t,o){this._cachedGroupTipsMap.has(t)||this._cachedGroupTipsMap.set(t,[]),this._cachedGroupTipsMap.get(t).push(o)}},{key:"_deleteCachedGroupTips",value:function(t){this._cachedGroupTipsMap.has(t)&&this._cachedGroupTipsMap.delete(t)}},{key:"_notifyCachedGroupTips",value:function(t){var o=this,e=this._cachedGroupTipsMap.get(t)||[];e.forEach(function(n){o.onNewGroupTips(n)}),this._deleteCachedGroupTips(t),V.log("".concat(this._className,"._notifyCachedGroupTips groupID:").concat(t," count:").concat(e.length))}},{key:"_cacheGroupTipsAndProbe",value:function(t){var o=this,e=t.groupID,n=t.event,l=t.item;this._cacheGroupTips(e,{event:n,dataList:[l]}),this._groupModule.getGroupSimplifiedInfo(e).then(function(h){h.type===Z.GRP_AVCHATROOM?o._groupModule.hasLocalGroup(e)?o._notifyCachedGroupTips(e):o._groupModule.setUnjoinedAVChatRoom(e):(o._groupModule.updateGroupMap([h]),o._notifyCachedGroupTips(e))}),this._checkCountMap.has(e)||this._checkCountMap.set(e,0),V.log("".concat(this._className,"._cacheGroupTipsAndProbe groupID:").concat(e))}},{key:"reset",value:function(){this._cachedGroupTipsMap.clear(),this._checkCountMap.clear(),this._getTopicPendingMap.clear()}}]),a}(),fE=function(){function a(t){A(this,a),this._groupModule=t,this._className="CommonGroupHandler",this.tempConversationList=null,this._cachedGroupMessageMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this._getTopicPendingMap=new Map,this._isPagingGetCompleted=!1,t.getInnerEmitterInstance().once(gs,this._initGroupList,this)}return x(a,[{key:"onCheckTimer",value:function(t){t%1==0&&this._cachedGroupMessageMap.size>0&&this._checkCachedGroupMessage()}},{key:"_checkCachedGroupMessage",value:function(){var t=this;this._cachedGroupMessageMap.forEach(function(o,e){var n=t._checkCountMap.get(e),l=t._groupModule.hasLocalGroup(e);V.log("".concat(t._className,"._checkCachedGroupMessage groupID:").concat(e," hasLocalGroup:").concat(l," checkCount:").concat(n)),l?(t._notifyCachedGroupMessage(e),t._checkCountMap.delete(e),t._groupModule.deleteUnjoinedAVChatRoom(e)):n>=t.MAX_CHECK_COUNT?(t._deleteCachedGroupMessage(e),t._checkCountMap.delete(e)):(n++,t._checkCountMap.set(e,n))})}},{key:"_initGroupList",value:function(){var t=this;V.log("".concat(this._className,"._initGroupList"));var o=new ht(yt.GET_GROUP_LIST_IN_STORAGE),e=this._groupModule.getStorageGroupList();if(Yt(e)&&e.length>0){e.forEach(function(l){t._groupModule.initGroupMap(l)}),this._groupModule.emitGroupListUpdate(!0,!1);var n=this._groupModule.getLocalGroupList().length;o.setNetworkType(this._groupModule.getNetworkType()).setMessage("group count:".concat(n)).end()}else o.setNetworkType(this._groupModule.getNetworkType()).setMessage("group count:0").end();V.log("".concat(this._className,"._initGroupList ok"))}},{key:"handleUpdateGroupLastMessage",value:function(t){var o="".concat(this._className,".handleUpdateGroupLastMessage");if(V.debug("".concat(o," conversation count:").concat(t.length,", local group count:").concat(this._groupModule.getLocalGroupList().length)),this._groupModule.getGroupMap().size!==0){for(var e,n,l,h=!1,_=0,S=t.length;_<S;_++)(e=t[_]).type===Z.CONV_GROUP&&(n=e.conversationID.split(/^GROUP/)[1],(l=this._groupModule.getLocalGroupProfile(n))&&(l.lastMessage=e.lastMessage,h=!0));h&&(this._groupModule.sortLocalGroupList(),this._groupModule.emitGroupListUpdate(!0,!1))}else this.tempConversationList=t}},{key:"onNewGroupMessage",value:function(t){V.debug("".concat(this._className,".onNewGroupMessage count:").concat(t.dataList.length));var o=this._newGroupMessageStoredAndSummary(t),e=o.conversationOptionsList,n=o.messageList,l=o.AVChatRoomMessageList;l.length>0&&this._groupModule.onAVChatRoomMessage(l),this._groupModule.filterModifiedMessage(n),e.length>0&&(this._groupModule.updateNextMessageSeq(e),this._groupModule.getModule(Vt).onNewMessage({conversationOptionsList:e,isInstantMessage:!0}));var h=this._groupModule.filterUnmodifiedMessage(n);h.length>0&&this._groupModule.emitOuterEvent(mn.MESSAGE_RECEIVED,h),n.length=0}},{key:"_newGroupMessageStoredAndSummary",value:function(t){var o=this,e=t.dataList,n=t.event,l=t.isInstantMessage,h=null,_=[],S=[],E=[],M={},w=this._groupModule.getModule(Ym),L=this._groupModule.getModule(Ur),H=e.length;H>1&&e.sort(function(he,ge){return he.sequence-ge.sequence});for(var ne=function(he){var ge=H0(e[he]),Te=ge.groupProfile,Ze=Te.groupID,Ct=Te.communityType,wt=Ct===void 0?0:Ct,dn=Te.topicID,$t=dn===void 0?void 0:dn,Kn=void 0,xn=wt===2&&!Mt($t);if(xn){Kn=Z.CONV_TOPIC,ge.to=$t;var On=o._groupModule.getModule(ri);On.hasLocalTopic(Ze,$t)||o._getTopicPendingMap.has($t)||(o._getTopicPendingMap.set($t,1),On.getTopicList({groupID:Ze,topicIDList:[$t]}).finally(function(){o._getTopicPendingMap.delete($t)}))}if(wt===2&&Mt($t))return"continue";var ar=o._groupModule.hasLocalGroup(Ze);if(!ar&&o._groupModule.isUnjoinedAVChatRoom(Ze))return"continue";if(!ar&&!xn)return o._cacheGroupMessageAndProbe({groupID:Ze,event:n,item:ge}),"continue";if(o._groupModule.isMessageFromOrToAVChatroom(Ze))return ge.event=n,E.push(ge),"continue";ge.currentUser=o._groupModule.getMyUserID(),ge.conversationType=Z.CONV_GROUP,ge.isSystemMessage=!!ge.isSystemMessage,h=new Bi(ge),ge.elements=w.parseElements(ge.elements,ge.from),h.setElement(ge.elements);var yr=e[he].isModified===1,Mi=o._groupModule.getModule(Vt);if(Mi.isMessageSentByCurrentInstance(h)?h.isModified=yr:yr=!1,ge.onlineOnlyFlag===1)h._onlineOnlyFlag=!0,Mi.isMessageSentByCurrentInstance(h)||S.push(h);else{if(!Mi.pushIntoMessageList(S,h,yr))return"continue";L.addMessageSequence({key:Sf,message:h}),l&&h.clientTime>0&&L.addMessageDelay(h.clientTime);var Ko=h,fa=Ko.conversationID,To=Ko.sequence,Dr=Mi.isRemoteRead({conversationID:fa,sequence:To});if(Ke(M[fa])){var Wo=0;h.flow==="in"&&(h._isExcludedFromUnreadCount||Dr||(Wo=1)),M[fa]=_.push({conversationID:fa,unreadCount:Wo,type:Ke(Kn)?h.conversationType:Kn,subType:h.conversationSubType,lastMessage:h._isExcludedFromLastMessage?"":h})-1}else{var eu=M[fa];_[eu].type=Ke(Kn)?h.conversationType:Kn,_[eu].subType=h.conversationSubType,_[eu].lastMessage=h._isExcludedFromLastMessage?"":h,h.flow==="in"&&(h._isExcludedFromUnreadCount||Dr||_[eu].unreadCount++)}}},ae=0;ae<H;ae++)ne(ae);return{conversationOptionsList:_,messageList:S,AVChatRoomMessageList:E}}},{key:"onGroupMessageRevoked",value:function(t){V.debug("".concat(this._className,".onGroupMessageRevoked nums:").concat(t.dataList.length));var o=this._groupModule.getModule(Vt),e=[],n=null;t.dataList.forEach(function(l){var h=l.elements.revokedInfos;Ke(h)||h.forEach(function(_){var S=Ke(_.topicID)?"GROUP".concat(_.groupID):"GROUP".concat(_.topicID);(n=o.revoke(S,_.sequence,_.random))&&e.push(n)})}),e.length!==0&&(o.onMessageRevoked(e),this._groupModule.emitOuterEvent(mn.MESSAGE_REVOKED,e))}},{key:"_groupListTreeShaking",value:function(t){for(var o=new Map(Be(this._groupModule.getGroupMap())),e=0,n=t.length;e<n;e++)o.delete(t[e].groupID);this._groupModule.hasJoinedAVChatRoom()&&this._groupModule.getJoinedAVChatRoom().forEach(function(S){o.delete(S)}),this._groupModule.getGroupMap().forEach(function(S,E){S.isSupportTopic&&o.delete(E)});for(var l=Be(o.keys()),h=0,_=l.length;h<_;h++)this._groupModule.deleteGroup(l[h])}},{key:"getGroupList",value:function(t){var o=this,e="".concat(this._className,".getGroupList"),n=new ht(yt.GET_GROUP_LIST);V.log("".concat(e));var l={introduction:"Introduction",notification:"Notification",createTime:"CreateTime",ownerID:"Owner_Account",lastInfoTime:"LastInfoTime",memberNum:"MemberNum",maxMemberNum:"MaxMemberNum",joinOption:"ApplyJoinOption",muteAllMembers:"ShutUpAllMember"},h=["Type","Name","FaceUrl","NextMsgSeq","LastMsgTime","AtInfoList"],_=[];t&&t.groupProfileFilter&&t.groupProfileFilter.forEach(function(M){l[M]&&h.push(l[M])});var S=(t||{}).isGroupWithTopicOnly,E=S!==void 0&&S;return this._pagingGetGroupList({limit:50,offset:0,groupBaseInfoFilter:h,groupList:_,isGroupWithTopicOnly:E}).then(function(){V.log("".concat(e," ok. count:").concat(_.length," isGroupWithTopicOnly:").concat(E)),E||o._groupListTreeShaking(_),o._groupModule.updateGroupMap(_);var M=o._groupModule.getLocalGroupList().length;n.setNetworkType(o._groupModule.getNetworkType()).setMessage("remote count:".concat(_.length,", after tree shaking, local count:").concat(M,", isGroupWithTopicOnly:").concat(E)).end(),o.tempConversationList&&(V.log("".concat(e," update last message with tempConversationList, count:").concat(o.tempConversationList.length)),o.handleUpdateGroupLastMessage({data:o.tempConversationList}),o.tempConversationList=null),o._groupModule.patchGroupMessageRemindType(),o._groupModule.recomputeUnreadCount(),o._groupModule.emitGroupListUpdate(!0,!E);var w=o._groupModule.getLocalGroupList();if(E){var L=w.filter(function(H){return H.isSupportTopic===!0});return Wt({groupList:L})}return o._isPagingGetCompleted=!0,Wt({groupList:w})}).catch(function(M){return o._groupModule.probeNetwork().then(function(w){var L=Ue(w,2),H=L[0],ne=L[1];n.setError(M,H,ne).end()}),V.error("".concat(e," failed. error:"),M),Le(M)})}},{key:"isPagingGetCompleted",value:function(){return this._isPagingGetCompleted}},{key:"_pagingGetGroupList",value:function(t){var o=this,e="".concat(this._className,"._pagingGetGroupList"),n=t.isCommunityRelay,l=n!==void 0&&n,h=t.isGroupWithTopicOnly,_=h!==void 0&&h,S=t.limit,E=t.offset,M=t.groupBaseInfoFilter,w=t.groupList;if(_)return this._pagingGetGroupListWithTopic({limit:S,offset:E,groupBaseInfoFilter:M,groupList:w});var L=new ht(yt.PAGING_GET_GROUP_LIST);return this._groupModule.request({protocolName:Xm,requestData:{type:l?Z.GRP_COMMUNITY:void 0,memberAccount:this._groupModule.getMyUserID(),limit:S,offset:E,responseFilter:{groupBaseInfoFilter:M,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]}}}).then(function(H){var ne=H.data,ae=ne.groups,he=ae===void 0?[]:ae,ge=ne.totalCount;w.push.apply(w,Be(he)),o._handleGroupAtInfoWithoutTopic(l,he);var Te=E+S,Ze=!(ge>Te),Ct="offset:".concat(E," totalCount:").concat(ge," isCompleted:").concat(Ze," ")+"currentCount:".concat(w.length," isCommunityRelay:").concat(l);return L.setNetworkType(o._groupModule.getNetworkType()).setMessage("".concat(Ct)).end(),l||Ze?!l&&Ze?(V.log("".concat(e," start to get community list")),E=0,o._pagingGetGroupList({limit:S,offset:E,groupBaseInfoFilter:M,groupList:w,isCommunityRelay:!0})):l&&!Ze?(E=Te,o._pagingGetGroupList({limit:S,offset:E,groupBaseInfoFilter:M,groupList:w,isCommunityRelay:!0})):(V.log("".concat(e," ok. totalCount:").concat(w.length)),Wt({groupList:w})):(E=Te,o._pagingGetGroupList({limit:S,offset:E,groupBaseInfoFilter:M,groupList:w}))}).catch(function(H){return H.code!==11e3&&o._groupModule.probeNetwork().then(function(ne){var ae=Ue(ne,2),he=ae[0],ge=ae[1];L.setMessage("isCommunityRelay:".concat(l)).setError(H,he,ge).end()}),l?(H.code===11e3&&(L=null,V.log("".concat(e," ok. community unavailable"))),En({groupList:w})):Le(H)})}},{key:"_pagingGetGroupListWithTopic",value:function(t){var o=this,e="".concat(this._className,"._pagingGetGroupListWithTopic"),n=t.limit,l=t.offset,h=t.groupBaseInfoFilter,_=t.groupList,S=new ht(yt.PAGING_GET_GROUP_LIST_WITH_TOPIC);return this._groupModule.request({protocolName:Xm,requestData:{type:Z.GRP_COMMUNITY,memberAccount:this._groupModule.getMyUserID(),limit:n,offset:l,responseFilter:{groupBaseInfoFilter:h,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]},isSupportTopic:1}}).then(function(E){var M=E.data,w=M.groups,L=w===void 0?[]:w,H=M.totalCount;_.push.apply(_,Be(L));var ne=l+n,ae=!(H>ne),he="offset:".concat(l," totalCount:").concat(H," isCompleted:").concat(ae," ")+"currentCount:".concat(_.length);return S.setNetworkType(o._groupModule.getNetworkType()).setMessage("".concat(he)).end(),ae?(V.log("".concat(e," ok. totalCount:").concat(_.length)),Wt({groupList:_})):(l=ne,o._pagingGetGroupListWithTopic({limit:n,offset:l,groupBaseInfoFilter:h,groupList:_}))}).catch(function(E){return o._groupModule.probeNetwork().then(function(M){var w=Ue(M,2),L=w[0],H=w[1];S.setError(E,L,H).end()}),Le(E)})}},{key:"_cacheGroupMessage",value:function(t,o){this._cachedGroupMessageMap.has(t)||this._cachedGroupMessageMap.set(t,[]),this._cachedGroupMessageMap.get(t).push(o)}},{key:"_deleteCachedGroupMessage",value:function(t){this._cachedGroupMessageMap.has(t)&&this._cachedGroupMessageMap.delete(t)}},{key:"_notifyCachedGroupMessage",value:function(t){var o=this,e=this._cachedGroupMessageMap.get(t)||[];e.forEach(function(n){o.onNewGroupMessage(n)}),this._deleteCachedGroupMessage(t),V.log("".concat(this._className,"._notifyCachedGroupMessage groupID:").concat(t," count:").concat(e.length))}},{key:"_cacheGroupMessageAndProbe",value:function(t){var o=this,e=t.groupID,n=t.event,l=t.item;this._cacheGroupMessage(e,{event:n,dataList:[l]}),this._groupModule.getGroupSimplifiedInfo(e).then(function(h){h.type===Z.GRP_AVCHATROOM?o._groupModule.hasLocalGroup(e)?o._notifyCachedGroupMessage(e):o._groupModule.setUnjoinedAVChatRoom(e):(o._groupModule.updateGroupMap([h]),o._notifyCachedGroupMessage(e))}),this._checkCountMap.has(e)||this._checkCountMap.set(e,0),V.log("".concat(this._className,"._cacheGroupMessageAndProbe groupID:").concat(e))}},{key:"_handleGroupAtInfoWithoutTopic",value:function(t,o){var e=this;t&&o.length!==0&&o.forEach(function(n){var l=n.groupID,h=n.groupAtInfoList,_=[];Ke(h)||(h.forEach(function(S){_.push(m(m({},S),{},{groupID:l}))}),e._groupModule.getModule(Vt).onNewGroupAtTips({dataList:_}))})}},{key:"reset",value:function(){this._cachedGroupMessageMap.clear(),this._checkCountMap.clear(),this._getTopicPendingMap.clear(),this._isPagingGetCompleted=!1,this._groupModule.getInnerEmitterInstance().once(gs,this._initGroupList,this)}}]),a}(),gE={1:"init",2:"modify",3:"clear",4:"delete"},mE=function(){function a(t){A(this,a),this._groupModule=t,this._className="GroupAttributesHandler",this._groupAttributesMap=new Map,this.CACHE_EXPIRE_TIME=3e4,this._groupModule.getInnerEmitterInstance().on(ji,this._onCloudConfigUpdated,this)}return x(a,[{key:"_onCloudConfigUpdated",value:function(){var t=this._groupModule.getCloudConfig("grp_attr_cache_time");Ke(t)||(this.CACHE_EXPIRE_TIME=Number(t))}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesMap.forEach(function(t){t.localMainSequence=0})}},{key:"onGroupAttributesUpdated",value:function(t){var o=this,e=t.groupID,n=t.groupAttributeOption,l=n.mainSequence,h=n.hasChangedAttributeInfo,_=n.groupAttributeList,S=_===void 0?[]:_,E=n.operationType;if(V.log("".concat(this._className,".onGroupAttributesUpdated. groupID:").concat(e," hasChangedAttributeInfo:").concat(h," operationType:").concat(E)),!Ke(E)){if(h===1){if(E===4){var M=[];S.forEach(function(L){M.push(L.key)}),S=Be(M),M=null}return this._refreshCachedGroupAttributes({groupID:e,remoteMainSequence:l,groupAttributeList:S,operationType:gE[E]}),void this._emitGroupAttributesUpdated(e)}if(this._groupAttributesMap.has(e)){var w=this._groupAttributesMap.get(e).avChatRoomKey;this._getGroupAttributes({groupID:e,avChatRoomKey:w}).then(function(){o._emitGroupAttributesUpdated(e)})}}}},{key:"initGroupAttributesCache",value:function(t){var o=t.groupID,e=t.avChatRoomKey;this._groupAttributesMap.set(o,{lastUpdateTime:0,localMainSequence:0,remoteMainSequence:0,attributes:new Map,avChatRoomKey:e}),V.log("".concat(this._className,".initGroupAttributesCache groupID:").concat(o," avChatRoomKey:").concat(e))}},{key:"initGroupAttributes",value:function(t){var o=this,e=t.groupID,n=t.groupAttributes,l=this._checkCachedGroupAttributes({groupID:e,funcName:"initGroupAttributes"});if(l!==!0)return Le(l);var h=this._groupAttributesMap.get(e),_=h.remoteMainSequence,S=h.avChatRoomKey,E=new ht(yt.INIT_GROUP_ATTRIBUTES);return E.setMessage("groupID:".concat(e," mainSequence:").concat(_," groupAttributes:").concat(JSON.stringify(n))),this._groupModule.request({protocolName:sM,requestData:{groupID:e,avChatRoomKey:S,mainSequence:_,groupAttributeList:this._transformGroupAttributes(n)}}).then(function(M){var w=M.data,L=w.mainSequence,H=Be(w.groupAttributeList);return H.forEach(function(ne){ne.value=n[ne.key]}),o._refreshCachedGroupAttributes({groupID:e,remoteMainSequence:L,groupAttributeList:H,operationType:"init"}),E.setNetworkType(o._groupModule.getNetworkType()).end(),V.log("".concat(o._className,".initGroupAttributes ok. groupID:").concat(e)),Wt({groupAttributes:n})}).catch(function(M){return o._groupModule.probeNetwork().then(function(w){var L=Ue(w,2),H=L[0],ne=L[1];E.setError(M,H,ne).end()}),Le(M)})}},{key:"setGroupAttributes",value:function(t){var o=this,e=t.groupID,n=t.groupAttributes,l=this._checkCachedGroupAttributes({groupID:e,funcName:"setGroupAttributes"});if(l!==!0)return Le(l);var h=this._groupAttributesMap.get(e),_=h.remoteMainSequence,S=h.avChatRoomKey,E=h.attributes,M=this._transformGroupAttributes(n);M.forEach(function(L){var H=L.key;L.sequence=0,E.has(H)&&(L.sequence=E.get(H).sequence)});var w=new ht(yt.SET_GROUP_ATTRIBUTES);return w.setMessage("groupID:".concat(e," mainSequence:").concat(_," groupAttributes:").concat(JSON.stringify(n))),this._groupModule.request({protocolName:cM,requestData:{groupID:e,avChatRoomKey:S,mainSequence:_,groupAttributeList:M}}).then(function(L){var H=L.data,ne=H.mainSequence,ae=Be(H.groupAttributeList);return ae.forEach(function(he){he.value=n[he.key]}),o._refreshCachedGroupAttributes({groupID:e,remoteMainSequence:ne,groupAttributeList:ae,operationType:"modify"}),w.setNetworkType(o._groupModule.getNetworkType()).end(),V.log("".concat(o._className,".setGroupAttributes ok. groupID:").concat(e)),Wt({groupAttributes:n})}).catch(function(L){return o._groupModule.probeNetwork().then(function(H){var ne=Ue(H,2),ae=ne[0],he=ne[1];w.setError(L,ae,he).end()}),Le(L)})}},{key:"deleteGroupAttributes",value:function(t){var o=this,e=t.groupID,n=t.keyList,l=n===void 0?[]:n,h=this._checkCachedGroupAttributes({groupID:e,funcName:"deleteGroupAttributes"});if(h!==!0)return Le(h);var _=this._groupAttributesMap.get(e),S=_.remoteMainSequence,E=_.avChatRoomKey,M=_.attributes,w=Be(M.keys()),L=lM,H="clear",ne={groupID:e,avChatRoomKey:E,mainSequence:S};if(l.length>0){var ae=[];w=[],L=uM,H="delete",l.forEach(function(ge){var Te=0;M.has(ge)&&(Te=M.get(ge).sequence,w.push(ge)),ae.push({key:ge,sequence:Te})}),ne.groupAttributeList=ae}var he=new ht(yt.DELETE_GROUP_ATTRIBUTES);return he.setMessage("groupID:".concat(e," mainSequence:").concat(S," keyList:").concat(l," protocolName:").concat(L)),this._groupModule.request({protocolName:L,requestData:ne}).then(function(ge){var Te=ge.data.mainSequence;return o._refreshCachedGroupAttributes({groupID:e,remoteMainSequence:Te,groupAttributeList:l,operationType:H}),he.setNetworkType(o._groupModule.getNetworkType()).end(),V.log("".concat(o._className,".deleteGroupAttributes ok. groupID:").concat(e)),Wt({keyList:w})}).catch(function(ge){return o._groupModule.probeNetwork().then(function(Te){var Ze=Ue(Te,2),Ct=Ze[0],wt=Ze[1];he.setError(ge,Ct,wt).end()}),Le(ge)})}},{key:"getGroupAttributes",value:function(t){var o=this,e=t.groupID,n=this._checkCachedGroupAttributes({groupID:e,funcName:"getGroupAttributes"});if(n!==!0)return Le(n);var l=this._groupAttributesMap.get(e),h=l.avChatRoomKey,_=l.lastUpdateTime,S=l.localMainSequence,E=l.remoteMainSequence,M=new ht(yt.GET_GROUP_ATTRIBUTES);if(M.setMessage("groupID:".concat(e," localMainSequence:").concat(S," remoteMainSequence:").concat(E," keyList:").concat(t.keyList)),Date.now()-_>=this.CACHE_EXPIRE_TIME||S<E)return this._getGroupAttributes({groupID:e,avChatRoomKey:h}).then(function(L){M.setMoreMessage("get attributes from remote. count:".concat(L.length)).setNetworkType(o._groupModule.getNetworkType()).end(),V.log("".concat(o._className,".getGroupAttributes from remote. groupID:").concat(e));var H=o._getLocalGroupAttributes(t);return Wt({groupAttributes:H})}).catch(function(L){return o._groupModule.probeNetwork().then(function(H){var ne=Ue(H,2),ae=ne[0],he=ne[1];M.setError(L,ae,he).end()}),Le(L)});M.setMoreMessage("get attributes from cache").setNetworkType(this._groupModule.getNetworkType()).end(),V.log("".concat(this._className,".getGroupAttributes from cache. groupID:").concat(e));var w=this._getLocalGroupAttributes(t);return En({groupAttributes:w})}},{key:"_getGroupAttributes",value:function(t){var o=this;return this._groupModule.request({protocolName:Ey,requestData:m({},t)}).then(function(e){var n=e.data,l=n.mainSequence,h=n.groupAttributeList,_=Be(h);return Ke(l)||o._refreshCachedGroupAttributes({groupID:t.groupID,remoteMainSequence:l,groupAttributeList:_,operationType:"get"}),V.log("".concat(o._className,"._getGroupAttributes ok. groupID:").concat(t.groupID)),h}).catch(function(e){return Le(e)})}},{key:"_getLocalGroupAttributes",value:function(t){var o=t.groupID,e=t.keyList,n=e===void 0?[]:e,l={};if(!this._groupAttributesMap.has(o))return l;var h=this._groupAttributesMap.get(o).attributes;if(n.length>0)n.forEach(function(M){h.has(M)&&(l[M]=h.get(M).value)});else{var _,S=De(h.keys());try{for(S.s();!(_=S.n()).done;){var E=_.value;l[E]=h.get(E).value}}catch(M){S.e(M)}finally{S.f()}}return l}},{key:"_refreshCachedGroupAttributes",value:function(t){var o=t.groupID,e=t.remoteMainSequence,n=t.groupAttributeList,l=t.operationType;if(this._groupAttributesMap.has(o)){var h=this._groupAttributesMap.get(o),_=h.localMainSequence;if(l==="get"||e-_==1)h.remoteMainSequence=e,h.localMainSequence=e,h.lastUpdateTime=Date.now(),this._updateCachedAttributes({groupAttributes:h,groupAttributeList:n,operationType:l});else{if(_===e)return;h.remoteMainSequence=e}this._groupAttributesMap.set(o,h);var S="operationType:".concat(l," localMainSequence:").concat(_," remoteMainSequence:").concat(e);V.log("".concat(this._className,"._refreshCachedGroupAttributes. ").concat(S))}}},{key:"_updateCachedAttributes",value:function(t){var o=t.groupAttributes,e=t.groupAttributeList,n=t.operationType;n!=="clear"?n!=="delete"?(n==="init"&&o.attributes.clear(),e.forEach(function(l){var h=l.key,_=l.value,S=l.sequence;o.attributes.set(h,{value:_,sequence:S})})):e.forEach(function(l){o.attributes.delete(l)}):o.attributes.clear()}},{key:"_checkCachedGroupAttributes",value:function(t){var o=t.groupID,e=t.funcName;if(this._groupModule.hasLocalGroup(o)&&this._groupModule.getLocalGroupProfile(o).type!==Z.GRP_AVCHATROOM)return V.warn("".concat(this._className,"._checkCachedGroupAttributes. ").concat("\u975E\u76F4\u64AD\u7FA4\u4E0D\u80FD\u4F7F\u7528\u7FA4\u5C5E\u6027 API")),new Me({code:We.CANNOT_USE_GRP_ATTR_NOT_AVCHATROOM,message:"\u975E\u76F4\u64AD\u7FA4\u4E0D\u80FD\u4F7F\u7528\u7FA4\u5C5E\u6027 API"});var n=this._groupAttributesMap.get(o);if(Ke(n)){var l="\u5982\u679C groupID:".concat(o," \u662F\u76F4\u64AD\u7FA4\uFF0C\u4F7F\u7528 ").concat(e," \u524D\u5148\u4F7F\u7528 joinGroup \u63A5\u53E3\u7533\u8BF7\u52A0\u5165\u7FA4\u7EC4\uFF0C\u8BE6\u7EC6\u8BF7\u53C2\u8003 https://web.sdk.qcloud.com/im/doc/zh-cn/SDK.html#joinGroup");return V.warn("".concat(this._className,"._checkCachedGroupAttributes. ").concat(l)),new Me({code:We.CANNOT_USE_GRP_ATTR_AVCHATROOM_UNJOIN,message:l})}return!0}},{key:"_transformGroupAttributes",value:function(t){var o=[];return Object.keys(t).forEach(function(e){o.push({key:e,value:t[e]})}),o}},{key:"_emitGroupAttributesUpdated",value:function(t){var o=this._getLocalGroupAttributes({groupID:t});this._groupModule.emitOuterEvent(mn.GROUP_ATTRIBUTES_UPDATED,{groupID:t,groupAttributes:o})}},{key:"reset",value:function(){this._groupAttributesMap.clear(),this.CACHE_EXPIRE_TIME=3e4}}]),a}(),vv=function(){function a(t){A(this,a);var o=t.manager,e=t.groupID,n=t.onInit,l=t.onSuccess,h=t.onFail;this._className="Polling",this._manager=o,this._groupModule=o._groupModule,this._onInit=n,this._onSuccess=l,this._onFail=h,this._groupID=e,this._timeoutID=-1,this._isRunning=!1,this._protocolName=wI}return x(a,[{key:"start",value:function(){var t=this._groupModule.isLoggedIn();t||(this._protocolName=yf),V.log("".concat(this._className,".start pollingInterval:").concat(this._manager.getPollingInterval()," isLoggedIn:").concat(t)),this._isRunning=!0,this._request()}},{key:"isRunning",value:function(){return this._isRunning}},{key:"_request",value:function(){var t=this,o=this._onInit(this._groupID);this._groupModule.request({protocolName:this._protocolName,requestData:o}).then(function(e){t._onSuccess(t._groupID,e),t.isRunning()&&(clearTimeout(t._timeoutID),t._timeoutID=setTimeout(t._request.bind(t),t._manager.getPollingInterval()))}).catch(function(e){t._onFail(t._groupID,e),t.isRunning()&&(clearTimeout(t._timeoutID),t._timeoutID=setTimeout(t._request.bind(t),t._manager.MAX_POLLING_INTERVAL))})}},{key:"stop",value:function(){V.log("".concat(this._className,".stop")),this._timeoutID>0&&(clearTimeout(this._timeoutID),this._timeoutID=-1),this._isRunning=!1}}]),a}(),eS={3:!0,4:!0,5:!0,6:!0,17:!0},vE=function(){function a(t){A(this,a),this._groupModule=t,this._className="AVChatRoomHandler",this._joinedGroupMap=new Map,this._pollingRequestInfoMap=new Map,this._pollingInstanceMap=new Map,this.sequencesLinkedList=new Gh(200),this.messageIDLinkedList=new Gh(100),this.receivedMessageCount=0,this._reportMessageStackedCount=0,this._onlineMemberCountMap=new Map,this.DEFAULT_EXPIRE_TIME=60,this.DEFAULT_POLLING_INTERVAL=300,this.MAX_POLLING_INTERVAL=2e3,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0,this._startBroadcastSeq=1,this._broadcastMessageIDMap=new Map}return x(a,[{key:"hasJoinedAVChatRoom",value:function(){return this._joinedGroupMap.size>0}},{key:"checkJoinedAVChatRoomByID",value:function(t){return this._joinedGroupMap.has(t)}},{key:"getJoinedAVChatRoom",value:function(){return this._joinedGroupMap.size>0?Be(this._joinedGroupMap.keys()):null}},{key:"_updateRequestData",value:function(t){var o=this._pollingRequestInfoMap.get(t);return t===Be(this._pollingInstanceMap.keys())[0]?m(m({},o),{},{startBroadcastSeq:this._startBroadcastSeq}):m({},o)}},{key:"_handleSuccess",value:function(t,o){var e=o.data,n=e.key,l=e.nextSeq,h=e.rspMsgList,_=e.errorCode,S=e.nextBroadcastSeq,E=e.broadcastMessageList;if(_!==0){var M=this._pollingRequestInfoMap.get(t),w=new ht(yt.LONG_POLLING_AV_ERROR),L=M?"".concat(M.key,"-").concat(M.startSeq):"requestInfo is undefined";w.setMessage("".concat(t,"-").concat(L,"-").concat(o.errorInfo)).setCode(o.errorCode).setNetworkType(this._groupModule.getNetworkType()).end(!0)}else{if(!this.checkJoinedAVChatRoomByID(t))return;Ln(n)&&gr(l)&&this._pollingRequestInfoMap.set(t,{key:n,startSeq:l}),gr(S)&&S>this._startBroadcastSeq&&(this._startBroadcastSeq=S),Yt(h)&&h.length>0?(h.forEach(function(H){H.to=H.groupID}),this.onMessage(h)):(this._pollingNoMessageCount+=1,this._pollingNoMessageCount===this.DEFAULT_POLLING_NO_MESSAGE_COUNT&&(this._pollingInterval=this.DEFAULT_POLLING_INTERVAL+this.DEFAULT_POLLING_INTERVAL_PLUS)),this._onBroadcastMessage(E)}}},{key:"_handleFailure",value:function(t,o){}},{key:"onMessage",value:function(t){if(Yt(t)&&t.length!==0){this._pollingNoMessageCount!==0&&(this._pollingNoMessageCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL);var o=null,e=[],n=this._getModule(Vt),l=this._getModule(Ur),h=t.length;h>1&&t.sort(function(Te,Ze){return Te.sequence-Ze.sequence});for(var _=this._getModule(ir),S=0;S<h;S++)if(eS[t[S].event]){this.receivedMessageCount+=1,o=this.packMessage(t[S],t[S].event);var E=t[S].isModified===1,M=t[S].isHistoryMessage===1;if((_.isUnlimitedAVChatRoom()||!this.sequencesLinkedList.has(o.sequence))&&!this.messageIDLinkedList.has(o.ID)){var w=o.conversationID;if(this.receivedMessageCount%50==0?this._getModule(Hu).detectFirstRound(w,this.sequencesLinkedList.data()):this.receivedMessageCount%80==0&&this._getModule(Hu).detectSecondRound(w,this.sequencesLinkedList.data()),this.sequencesLinkedList.tail()!==null){var L=this.sequencesLinkedList.tail().value,H=o.sequence-L;H>1&&H<=20?this._getModule(Hu).onMessageMaybeLost(w,L+1,H-1):H<-1&&H>=-20&&this._getModule(Hu).onMessageMaybeLost(w,o.sequence+1,Math.abs(H)-1)}this.sequencesLinkedList.set(o.sequence),this.messageIDLinkedList.set(o.ID);var ne=!1;if(this._isMessageSentByCurrentInstance(o)?E&&(ne=!0,o.isModified=E,n.updateMessageIsModifiedProperty(o)):ne=!0,ne){if(o.conversationType===Z.CONV_SYSTEM&&o.payload.operationType===5&&this._onGroupDismissed(o.payload.groupProfile.groupID),!M&&o.conversationType!==Z.CONV_SYSTEM){var ae=o.conversationID.replace(Z.CONV_GROUP,"");this._pollingInstanceMap.has(ae)?l.addMessageSequence({key:tv,message:o}):(o.type!==Z.MSG_GRP_TIP&&o.clientTime>0&&l.addMessageDelay(o.clientTime),l.addMessageSequence({key:If,message:o}))}e.push(o)}}}else V.warn("".concat(this._className,".onMessage \u672A\u5904\u7406\u7684 event \u7C7B\u578B: ").concat(t[S].event));if(e.length!==0){this._groupModule.filterModifiedMessage(e);var he=this.packConversationOption(e);he.length>0&&this._getModule(Vt).onNewMessage({conversationOptionsList:he,isInstantMessage:!0}),V.debug("".concat(this._className,".onMessage count:").concat(e.length)),this._checkMessageStacked(e);var ge=this._groupModule.filterUnmodifiedMessage(e);ge.length>0&&this._groupModule.emitOuterEvent(mn.MESSAGE_RECEIVED,ge),e.length=0}}}},{key:"_onGroupDismissed",value:function(t){V.log("".concat(this._className,"._onGroupDismissed groupID:").concat(t)),this._groupModule.deleteLocalGroupAndConversation(t),this.reset(t)}},{key:"_checkMessageStacked",value:function(t){var o=t.length;o>=100&&(V.warn("".concat(this._className,"._checkMessageStacked \u76F4\u64AD\u7FA4\u6D88\u606F\u5806\u79EF\u6570:").concat(t.length,'\uFF01\u53EF\u80FD\u4F1A\u5BFC\u81F4\u5FAE\u4FE1\u5C0F\u7A0B\u5E8F\u6E32\u67D3\u65F6\u9047\u5230 "Dom limit exceeded" \u7684\u9519\u8BEF\uFF0C\u5EFA\u8BAE\u63A5\u5165\u4FA7\u6B64\u65F6\u53EA\u6E32\u67D3\u6700\u8FD1\u768410\u6761\u6D88\u606F')),this._reportMessageStackedCount<5&&(new ht(yt.MESSAGE_STACKED).setNetworkType(this._groupModule.getNetworkType()).setMessage("count:".concat(o," groupID:").concat(Be(this._joinedGroupMap.keys()))).setLevel("warning").end(),this._reportMessageStackedCount+=1))}},{key:"_isMessageSentByCurrentInstance",value:function(t){return!!this._getModule(Vt).isMessageSentByCurrentInstance(t)}},{key:"packMessage",value:function(t,o){t.currentUser=this._groupModule.getMyUserID(),t.conversationType=o===5?Z.CONV_SYSTEM:Z.CONV_GROUP,t.isSystemMessage=!!t.isSystemMessage;var e=new Bi(t),n=this.packElements(t,o);return e.setElement(n),e}},{key:"packElements",value:function(t,o){return o===4||o===6?(this._updateMemberCountByGroupTips(t),this._onGroupAttributesUpdated(t),{type:Z.MSG_GRP_TIP,content:m(m({},t.elements),{},{groupProfile:t.groupProfile})}):o===5?{type:Z.MSG_GRP_SYS_NOTICE,content:m(m({},t.elements),{},{groupProfile:m(m({},t.groupProfile),{},{groupID:t.groupID})})}:this._getModule(Ym).parseElements(t.elements,t.from)}},{key:"packConversationOption",value:function(t){for(var o=new Map,e=0;e<t.length;e++){var n=t[e],l=n.conversationID;if(o.has(l)){var h=o.get(l);h.lastMessage=n,n.flow==="in"&&h.unreadCount++}else o.set(l,{conversationID:n.conversationID,unreadCount:n.flow==="out"?0:1,type:n.conversationType,subType:n.conversationSubType,lastMessage:n})}return Be(o.values())}},{key:"_updateMemberCountByGroupTips",value:function(t){var o=t.groupProfile.groupID,e=t.elements.onlineMemberInfo,n=e===void 0?void 0:e;if(!Mt(n)){var l=n.onlineMemberNum,h=l===void 0?0:l,_=n.expireTime,S=_===void 0?this.DEFAULT_EXPIRE_TIME:_,E=this._onlineMemberCountMap.get(o)||{},M=Date.now();Mt(E)?Object.assign(E,{lastReqTime:0,lastSyncTime:0,latestUpdateTime:M,memberCount:h,expireTime:S}):(E.latestUpdateTime=M,E.memberCount=h),V.debug("".concat(this._className,"._updateMemberCountByGroupTips info:"),E),this._onlineMemberCountMap.set(o,E)}}},{key:"_onBroadcastMessage",value:function(t){if(!Mt(t)){for(var o=[],e=t.length,n=null,l=0;l<e;l++)eS[t[l].event]?((n=this.packMessage(t[l],t[l].event)).isBroadcastMessage=!0,this._broadcastMessageIDMap.has(n.ID)||(o.push(n),this._broadcastMessageIDMap.set(n.ID,1))):V.warn("".concat(this._className,"._onBroadcastMessage \u672A\u5904\u7406\u7684 event \u7C7B\u578B: ").concat(t[l].event));o.length>0&&this._groupModule.emitOuterEvent(mn.MESSAGE_RECEIVED,o)}}},{key:"start",value:function(t){if(this._pollingInstanceMap.has(t)){var o=this._pollingInstanceMap.get(t);o.isRunning()||o.start()}else{var e=new vv({manager:this,groupID:t,onInit:this._updateRequestData.bind(this),onSuccess:this._handleSuccess.bind(this),onFail:this._handleFailure.bind(this)});e.start(),this._pollingInstanceMap.set(t,e),V.log("".concat(this._className,".start groupID:").concat(t))}}},{key:"handleJoinResult",value:function(t){var o=this;return this._preCheck().then(function(){var e=t.longPollingKey,n=t.group,l=n.groupID;return o._joinedGroupMap.set(l,n),o._groupModule.updateGroupMap([n]),o._groupModule.deleteUnjoinedAVChatRoom(l),o._groupModule.emitGroupListUpdate(!0,!1),Ke(e)?En({status:Xl,group:n}):Promise.resolve()})}},{key:"startRunLoop",value:function(t){var o=this;return this.handleJoinResult(t).then(function(){var e=t.longPollingKey,n=t.group,l=t.startSeq,h=l===void 0?0:l,_=n.groupID;return o._pollingRequestInfoMap.set(_,{key:e,startSeq:h}),o.start(_),o._groupModule.isLoggedIn()?En({status:Xl,group:n}):En({status:Xl})})}},{key:"_preCheck",value:function(){if(this._getModule(ir).isUnlimitedAVChatRoom()||!this.hasJoinedAVChatRoom())return Promise.resolve();var t=Ue(this._joinedGroupMap.entries().next().value,2),o=t[0],e=t[1];if(this._groupModule.isLoggedIn()){if(!(e.selfInfo.role===Z.GRP_MBR_ROLE_OWNER||e.ownerID===this._groupModule.getMyUserID()))return this._groupModule.quitGroup(o);this._groupModule.deleteLocalGroupAndConversation(o)}else this._groupModule.deleteLocalGroupAndConversation(o);return this.reset(o),Promise.resolve()}},{key:"joinWithoutAuth",value:function(t){var o=this,e=t.groupID,n="".concat(this._className,".joinWithoutAuth"),l=new ht(yt.JOIN_WITHOUT_AUTH);return this._groupModule.request({protocolName:RI,requestData:t}).then(function(h){var _=h.data.longPollingKey;if(o._groupModule.probeNetwork().then(function(E){var M=Ue(E,2),w=(M[0],M[1]);l.setNetworkType(w).setMessage("groupID:".concat(e," longPollingKey:").concat(_)).end(!0)}),Ke(_))return Le(new Me({code:We.CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN,message:at.CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN}));V.log("".concat(n," ok. groupID:").concat(e)),o._getModule(Vt).setCompleted("".concat(Z.CONV_GROUP).concat(e));var S=new Zu({groupID:e});return o.startRunLoop({group:S,longPollingKey:_}),Wt({status:Xl})}).catch(function(h){return V.error("".concat(n," failed. groupID:").concat(e," error:"),h),o._groupModule.probeNetwork().then(function(_){var S=Ue(_,2),E=S[0],M=S[1];l.setError(h,E,M).setMessage("groupID:".concat(e)).end(!0)}),Le(h)}).finally(function(){o._groupModule.getModule(aI).reportAtOnce()})}},{key:"getGroupOnlineMemberCount",value:function(t){var o=this._onlineMemberCountMap.get(t)||{},e=Date.now();return Mt(o)||e-o.lastSyncTime>1e3*o.expireTime&&e-o.latestUpdateTime>1e4&&e-o.lastReqTime>3e3?(o.lastReqTime=e,this._onlineMemberCountMap.set(t,o),this._getGroupOnlineMemberCount(t).then(function(n){return Wt({memberCount:n.memberCount})}).catch(function(n){return Le(n)})):En({memberCount:o.memberCount})}},{key:"_getGroupOnlineMemberCount",value:function(t){var o=this,e="".concat(this._className,"._getGroupOnlineMemberCount");return this._groupModule.request({protocolName:iM,requestData:{groupID:t}}).then(function(n){var l=o._onlineMemberCountMap.get(t)||{},h=n.data,_=h.onlineMemberNum,S=_===void 0?0:_,E=h.expireTime,M=E===void 0?o.DEFAULT_EXPIRE_TIME:E;V.log("".concat(e," ok. groupID:").concat(t," memberCount:").concat(S," expireTime:").concat(M));var w=Date.now();return Mt(l)&&(l.lastReqTime=w),o._onlineMemberCountMap.set(t,Object.assign(l,{lastSyncTime:w,latestUpdateTime:w,memberCount:S,expireTime:M})),{memberCount:S}}).catch(function(n){return V.warn("".concat(e," failed. error:"),n),new ht(yt.GET_GROUP_ONLINE_MEMBER_COUNT).setCode(n.code).setMessage("groupID:".concat(t," error:").concat(JSON.stringify(n))).setNetworkType(o._groupModule.getNetworkType()).end(),Promise.reject(n)})}},{key:"_onGroupAttributesUpdated",value:function(t){var o=t.groupID,e=t.elements,n=e.operationType,l=e.newGroupProfile;if(n===6){var h=(l===void 0?void 0:l).groupAttributeOption;Mt(h)||this._groupModule.onGroupAttributesUpdated({groupID:o,groupAttributeOption:h})}}},{key:"_getModule",value:function(t){return this._groupModule.getModule(t)}},{key:"setPollingInterval",value:function(t){Ke(t)||(gr(t)?this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=t:this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=parseInt(t,10))}},{key:"setPollingIntervalPlus",value:function(t){Ke(t)||(gr(t)?this.DEFAULT_POLLING_INTERVAL_PLUS=t:this.DEFAULT_POLLING_INTERVAL_PLUS=parseInt(t,10))}},{key:"setPollingNoMessageCount",value:function(t){Ke(t)||(gr(t)?this.DEFAULT_POLLING_NO_MESSAGE_COUNT=t:this.DEFAULT_POLLING_NO_MESSAGE_COUNT=parseInt(t,10))}},{key:"getPollingInterval",value:function(){return this._pollingInterval}},{key:"reset",value:function(t){if(t){V.log("".concat(this._className,".reset groupID:").concat(t));var o=this._pollingInstanceMap.get(t);o&&o.stop(),this._pollingInstanceMap.delete(t),this._joinedGroupMap.delete(t),this._pollingRequestInfoMap.delete(t),this._onlineMemberCountMap.delete(t)}else{V.log("".concat(this._className,".reset all"));var e,n=De(this._pollingInstanceMap.values());try{for(n.s();!(e=n.n()).done;)e.value.stop()}catch(l){n.e(l)}finally{n.f()}this._pollingInstanceMap.clear(),this._joinedGroupMap.clear(),this._pollingRequestInfoMap.clear(),this._onlineMemberCountMap.clear(),this._broadcastMessageIDMap.clear()}this.sequencesLinkedList.reset(),this.messageIDLinkedList.reset(),this.receivedMessageCount=0,this._reportMessageStackedCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=300,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0}}]),a}(),Gf=1,AA=15,kA=function(){function a(t){A(this,a),this._groupModule=t,this._className="GroupSystemNoticeHandler",this.pendencyMap=new Map}return x(a,[{key:"onNewGroupSystemNotice",value:function(t){var o=t.dataList,e=t.isSyncingEnded,n=t.isInstantMessage;V.debug("".concat(this._className,".onReceiveSystemNotice count:").concat(o.length));var l=this.newSystemNoticeStoredAndSummary({notifiesList:o,isInstantMessage:n}),h=l.eventDataList,_=l.result;h.length>0&&(this._groupModule.getModule(Vt).onNewMessage({conversationOptionsList:h,isInstantMessage:n}),this._onReceivedGroupSystemNotice({result:_,isInstantMessage:n})),n?_.length>0&&this._groupModule.emitOuterEvent(mn.MESSAGE_RECEIVED,_):e===!0&&this._clearGroupSystemNotice()}},{key:"newSystemNoticeStoredAndSummary",value:function(t){var o=t.notifiesList,e=t.isInstantMessage,n=null,l=o.length,h=0,_=[],S={conversationID:Z.CONV_SYSTEM,unreadCount:0,type:Z.CONV_SYSTEM,subType:null,lastMessage:null};for(h=0;h<l;h++){var E=o[h],M=E.groupProfile,w=M.communityType,L=w===void 0?0:w,H=M.topicID,ne=H===void 0?void 0:H,ae=E.elements,he=ae.topicIDList,ge=he===void 0?void 0:he,Te=ae.operationType;if(!(L!==2||Mt(ne)&&Mt(ge))){if([17,18,20].includes(Te)){this._handleTopicSystemNotice(E);continue}Mt(ne)||(E.to=ne)}E.elements.operationType!==AA&&(E.currentUser=this._groupModule.getMyUserID(),E.conversationType=Z.CONV_SYSTEM,E.conversationID=Z.CONV_SYSTEM,(n=new Bi(E)).setElement({type:Z.MSG_GRP_SYS_NOTICE,content:m(m({},E.elements),{},{groupProfile:m({},E.groupProfile)})}),n.isSystemMessage=!0,(n.sequence===1&&n.random===1||n.sequence===2&&n.random===2)&&(n.sequence=cs(),n.random=cs(),n.generateMessageID(),V.log("".concat(this._className,".newSystemNoticeStoredAndSummary sequence and random maybe duplicated, regenerate. ID:").concat(n.ID))),this._groupModule.getModule(Vt).pushIntoNoticeResult(_,n)&&(e?S.unreadCount++:n.setIsRead(!0),S.subType=n.conversationSubType))}return S.lastMessage=_[_.length-1],{eventDataList:_.length>0?[S]:[],result:_}}},{key:"_clearGroupSystemNotice",value:function(){var t=this;this.getPendencyList().then(function(o){o.forEach(function(l){t.pendencyMap.set("".concat(l.from,"_").concat(l.groupID,"_").concat(l.to),l)});var e=t._groupModule.getModule(Vt).getLocalMessageList(Z.CONV_SYSTEM),n=[];e.forEach(function(l){var h=l.payload,_=h.operatorID,S=h.operationType,E=h.groupProfile;if(S===Gf){var M="".concat(_,"_").concat(E.groupID,"_").concat(E.to),w=t.pendencyMap.get(M);w&&gr(w.handled)&&w.handled!==0&&n.push(l)}}),t.deleteGroupSystemNotice({messageList:n})})}},{key:"deleteGroupSystemNotice",value:function(t){var o=this,e="".concat(this._className,".deleteGroupSystemNotice");return Yt(t.messageList)&&t.messageList.length!==0?(V.log("".concat(e," ")+t.messageList.map(function(n){return n.ID})),this._groupModule.request({protocolName:Iy,requestData:{messageListToDelete:t.messageList.map(function(n){return{from:Z.CONV_SYSTEM,messageSeq:n.clientSequence,messageRandom:n.random}})}}).then(function(){V.log("".concat(e," ok"));var n=o._groupModule.getModule(Vt);return t.messageList.forEach(function(l){n.deleteLocalMessage(l)}),Wt()}).catch(function(n){return V.error("".concat(e," error:"),n),Le(n)})):En()}},{key:"getPendencyList",value:function(t){var o=this;return this._groupModule.request({protocolName:id,requestData:{startTime:t&&t.startTime?t.startTime:0,limit:t&&t.limit?t.limit:10,handleAccount:this._groupModule.getMyUserID()}}).then(function(e){var n=e.data.pendencyList;return e.data.nextStartTime!==0?o.getPendencyList({startTime:e.data.nextStartTime}).then(function(l){return[].concat(Be(n),Be(l))}):n})}},{key:"_onReceivedGroupSystemNotice",value:function(t){var o=this,e=t.result;t.isInstantMessage&&e.forEach(function(n){switch(n.payload.operationType){case 1:break;case 2:o._onApplyGroupRequestAgreed(n);break;case 3:break;case 4:o._onMemberKicked(n);break;case 5:o._onGroupDismissed(n);break;case 6:break;case 7:o._onInviteGroup(n);break;case 8:o._onQuitGroup(n);break;case 9:o._onSetManager(n);break;case 10:o._onDeleteManager(n);break;case 11:case 12:case 15:break;case 20:o._onMessageRemindTypeSynced(n)}})}},{key:"_onApplyGroupRequestAgreed",value:function(t){var o=this,e=t.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(e)||this._groupModule.getGroupProfile({groupID:e}).then(function(n){var l=n.data.group;if(l){o._groupModule.updateGroupMap([l]);var h=!l.isSupportTopic;o._groupModule.emitGroupListUpdate(!0,h)}})}},{key:"_onMemberKicked",value:function(t){var o=t.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(o)&&this._groupModule.deleteLocalGroupAndConversation(o)}},{key:"_onGroupDismissed",value:function(t){var o=t.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(o)&&this._groupModule.deleteLocalGroupAndConversation(o);var e=this._groupModule._AVChatRoomHandler;e&&e.checkJoinedAVChatRoomByID(o)&&e.reset(o)}},{key:"_onInviteGroup",value:function(t){var o=this,e=t.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(e)||this._groupModule.getGroupProfile({groupID:e}).then(function(n){var l=n.data.group;l&&(o._groupModule.updateGroupMap([l]),o._groupModule.emitGroupListUpdate())})}},{key:"_onQuitGroup",value:function(t){var o=t.payload.groupProfile.groupID;this._groupModule.hasLocalGroup(o)&&this._groupModule.deleteLocalGroupAndConversation(o)}},{key:"_onSetManager",value:function(t){var o=t.payload.groupProfile,e=o.to,n=o.groupID,l=this._groupModule.getModule(gi).getLocalGroupMemberInfo(n,e);l&&l.updateRole(Z.GRP_MBR_ROLE_ADMIN)}},{key:"_onDeleteManager",value:function(t){var o=t.payload.groupProfile,e=o.to,n=o.groupID,l=this._groupModule.getModule(gi).getLocalGroupMemberInfo(n,e);l&&l.updateRole(Z.GRP_MBR_ROLE_MEMBER)}},{key:"_onMessageRemindTypeSynced",value:function(t){var o=t.payload.groupProfile.groupID,e=t.payload.messageRemindType;this._groupModule.getModule(Vt).onGroupMessageRemindTypeSynced({groupID:o,messageRemindType:e})}},{key:"_handleTopicSystemNotice",value:function(t){var o=t.groupProfile,e=o.groupID,n=o.topicID,l=t.elements,h=l.operationType,_=l.topicIDList,S=l.messageRemindType,E=this._groupModule.getModule(ri);h===17?E.onTopicCreated({groupID:e,topicID:n}):h===18?E.onTopicDeleted({groupID:e,topicIDList:_}):h===20&&E.onTopicMessageRemindTypeUpdated({groupID:e,topicID:n,messageRemindType:S})}},{key:"reset",value:function(){this.pendencyMap.clear()}}]),a}(),Bt=["relayFlag"],pR=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this,e))._className="GroupModule",n._commonGroupHandler=null,n._AVChatRoomHandler=null,n._groupSystemNoticeHandler=null,n._commonGroupHandler=new fE(Ae(n)),n._groupAttributesHandler=new mE(Ae(n)),n._AVChatRoomHandler=new vE(Ae(n)),n._groupTipsHandler=new pE(Ae(n)),n._groupSystemNoticeHandler=new kA(Ae(n)),n.groupMap=new Map,n._unjoinedAVChatRoomList=new Map,n._receiptDetailCompleteMap=new Map,n.getInnerEmitterInstance().on(ji,n._onCloudConfigUpdated,Ae(n)),n}return x(o,[{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("polling_interval"),n=this.getCloudConfig("polling_interval_plus"),l=this.getCloudConfig("polling_no_msg_count");this._AVChatRoomHandler&&(V.log("".concat(this._className,"._onCloudConfigUpdated pollingInterval:").concat(e)+" pollingIntervalPlus:".concat(n," pollingNoMessageCount:").concat(l)),this._AVChatRoomHandler.setPollingInterval(e),this._AVChatRoomHandler.setPollingIntervalPlus(n),this._AVChatRoomHandler.setPollingNoMessageCount(l))}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&(this._commonGroupHandler.onCheckTimer(e),this._groupTipsHandler.onCheckTimer(e))}},{key:"guardForAVChatRoom",value:function(e){var n=this;if(e.conversationType===Z.CONV_GROUP){var l=Lt(e.to)?wo(e.to):e.to;return this.hasLocalGroup(l)?En():this.getGroupProfile({groupID:l}).then(function(h){var _=h.data.group.type;if(V.log("".concat(n._className,".guardForAVChatRoom. groupID:").concat(l," type:").concat(_)),_===Z.GRP_AVCHATROOM){var S="userId:".concat(e.from," \u672A\u52A0\u5165\u7FA4 groupID:").concat(l,"\u3002\u53D1\u6D88\u606F\u524D\u5148\u4F7F\u7528 joinGroup \u63A5\u53E3\u7533\u8BF7\u52A0\u7FA4\uFF0C\u8BE6\u7EC6\u8BF7\u53C2\u8003 https://web.sdk.qcloud.com/im/doc/zh-cn/SDK.html#joinGroup");return V.warn("".concat(n._className,".guardForAVChatRoom sendMessage not allowed. ").concat(S)),Le(new Me({code:We.MESSAGE_SEND_FAIL,message:S,data:{message:e}}))}return En()})}return En()}},{key:"checkJoinedAVChatRoomByID",value:function(e){return!!this._AVChatRoomHandler&&this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"onNewGroupMessage",value:function(e){this._commonGroupHandler&&this._commonGroupHandler.onNewGroupMessage(e)}},{key:"updateNextMessageSeq",value:function(e){var n=this;if(Yt(e)){var l=this.getModule(ri);e.forEach(function(h){var _=h.conversationID.replace(Z.CONV_GROUP,"");if(Lt(_)){var S=_,E=h.lastMessage.sequence+1;_=wo(S);var M=l.getLocalTopic(_,S);M&&(M.updateNextMessageSeq(E),M.updateLastMessage(h.lastMessage))}n.groupMap.has(_)&&(n.groupMap.get(_).nextMessageSeq=h.lastMessage.sequence+1)})}}},{key:"onNewGroupTips",value:function(e){this._groupTipsHandler&&this._groupTipsHandler.onNewGroupTips(e)}},{key:"onGroupMessageRevoked",value:function(e){this._commonGroupHandler&&this._commonGroupHandler.onGroupMessageRevoked(e)}},{key:"onNewGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler&&this._groupSystemNoticeHandler.onNewGroupSystemNotice(e)}},{key:"onGroupMessageReadNotice",value:function(e){var n=this;e.dataList.forEach(function(l){var h=l.elements.groupMessageReadNotice;if(!Ke(h)){var _=n.getModule(Vt);h.forEach(function(S){var E=S.groupID,M=S.topicID,w=M===void 0?void 0:M,L=S.lastMessageSeq;V.debug("".concat(n._className,".onGroupMessageReadNotice groupID:").concat(E," lastMessageSeq:").concat(L));var H="".concat(Z.CONV_GROUP).concat(E),ne=!0;Mt(w)||(H="".concat(Z.CONV_GROUP).concat(w),ne=!1),_.updateIsReadAfterReadReport({conversationID:H,lastMessageSeq:L}),_.updateUnreadCount(H,ne),_.clearGroupAtInfoList(H,ne)})}})}},{key:"onReadReceiptList",value:function(e){var n=this;V.debug("".concat(this._className,".onReadReceiptList options:"),JSON.stringify(e)),e.dataList.forEach(function(l){var h=l.groupProfile,_=l.elements,S=h.groupID,E=n.getModule(Vt),M=_.readReceiptList;E.updateReadReceiptInfo({groupID:S,readReceiptList:M})})}},{key:"onGroupMessageModified",value:function(e){V.debug("".concat(this._className,".onGroupMessageModified options:"),JSON.stringify(e));var n=this.getModule(Vt);e.dataList.forEach(function(l){n.onMessageModified(m(m({},l),{},{conversationType:Z.CONV_GROUP,to:l.topicID?l.topicID:l.groupID}))})}},{key:"deleteGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler&&this._groupSystemNoticeHandler.deleteGroupSystemNotice(e)}},{key:"initGroupMap",value:function(e){this.groupMap.set(e.groupID,new Zu(e))}},{key:"deleteGroup",value:function(e){this.groupMap.delete(e)}},{key:"updateGroupMap",value:function(e){var n,l=this,h=this.getModule(Vt);e.forEach(function(M){n=M.groupID,l.groupMap.has(n)?l.groupMap.get(n).updateGroup(M):(l.groupMap.set(n,new Zu(M)),h.deleteGroupRomaingMessageInfo(n))});var _,S=this.getMyUserID(),E=De(this.groupMap);try{for(E.s();!(_=E.n()).done;)Ue(_.value,2)[1].selfInfo.userID=S}catch(M){E.e(M)}finally{E.f()}this._setStorageGroupList()}},{key:"getStorageGroupList",value:function(){return this.getModule(ds).getItem("groupMap")}},{key:"_setStorageGroupList",value:function(){var e=this.getLocalGroupList().filter(function(n){var l=n.type;return!Ws(l)}).filter(function(n){return!n.isSupportTopic}).slice(0,20).map(function(n){return{groupID:n.groupID,name:n.name,avatar:n.avatar,type:n.type}});this.getModule(ds).setItem("groupMap",e)}},{key:"getGroupMap",value:function(){return this.groupMap}},{key:"getLocalGroupList",value:function(){return Be(this.groupMap.values())}},{key:"getLocalGroupProfile",value:function(e){return this.groupMap.get(e)}},{key:"sortLocalGroupList",value:function(){var e=Be(this.groupMap).filter(function(n){var l=Ue(n,2);return l[0],!Mt(l[1].lastMessage)});e.sort(function(n,l){return l[1].lastMessage.lastTime-n[1].lastMessage.lastTime}),this.groupMap=new Map(Be(e))}},{key:"updateGroupLastMessage",value:function(e){this._commonGroupHandler&&this._commonGroupHandler.handleUpdateGroupLastMessage(e)}},{key:"emitGroupListUpdate",value:function(){var e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],l=this.getLocalGroupList();if(e&&this.emitOuterEvent(mn.GROUP_LIST_UPDATED),n){var h=JSON.parse(JSON.stringify(l)),_=this.getModule(Vt);_.updateConversationGroupProfile(h)}}},{key:"patchGroupMessageRemindType",value:function(){var e=this.getLocalGroupList(),n=this.getModule(Vt),l=0;e.forEach(function(h){n.patchMessageRemindType({ID:h.groupID,isC2CConversation:!1,messageRemindType:h.selfInfo.messageRemindType})===!0&&(l+=1)}),V.log("".concat(this._className,".patchGroupMessageRemindType count:").concat(l))}},{key:"recomputeUnreadCount",value:function(){var e=this.getLocalGroupList(),n=this.getModule(Vt);e.forEach(function(l){var h=l.groupID,_=l.selfInfo,S=_.excludedUnreadSequenceList,E=_.readedSequence;if(Yt(S)){var M=0;S.forEach(function(w){w>=E&&w<=l.nextMessageSeq-1&&(M+=1)}),M>=1&&n.recomputeGroupUnreadCount({conversationID:"".concat(Z.CONV_GROUP).concat(h),count:M})}})}},{key:"getMyNameCardByGroupID",value:function(e){var n=this.getLocalGroupProfile(e);return n?n.selfInfo.nameCard:""}},{key:"isPagingGetCompleted",value:function(){return!!this._commonGroupHandler&&this._commonGroupHandler.isPagingGetCompleted()}},{key:"getGroupList",value:function(e){return this._commonGroupHandler?this._commonGroupHandler.getGroupList(e):En()}},{key:"getGroupProfile",value:function(e){var n=this,l=new ht(yt.GET_GROUP_PROFILE),h="".concat(this._className,".getGroupProfile"),_=e.groupID,S=e.groupCustomFieldFilter;V.log("".concat(h," groupID:").concat(_));var E={groupIDList:[_],responseFilter:{groupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember"],groupCustomFieldFilter:S,memberInfoFilter:["Role","JoinTime","MsgSeq","MsgFlag","NameCard"]}};return this.getGroupProfileAdvance(E).then(function(M){var w,L=M.data,H=L.successGroupList,ne=L.failureGroupList;return V.log("".concat(h," ok")),ne.length>0?Le(ne[0]):(Ws(H[0].type)&&!n.hasLocalGroup(_)?w=new Zu(H[0]):(n.updateGroupMap(H),w=n.getLocalGroupProfile(_)),w.isSupportTopic||n.getModule(Vt).updateConversationGroupProfile([w]),l.setNetworkType(n.getNetworkType()).setMessage("groupID:".concat(_," type:").concat(w.type," muteAllMembers:").concat(w.muteAllMembers," ownerID:").concat(w.ownerID)).end(),Wt({group:w}))}).catch(function(M){return n.probeNetwork().then(function(w){var L=Ue(w,2),H=L[0],ne=L[1];l.setError(M,H,ne).setMessage("groupID:".concat(e.groupID)).end()}),V.error("".concat(h," failed. error:"),M),Le(M)})}},{key:"getGroupProfileAdvance",value:function(e){var n=this,l="".concat(this._className,".getGroupProfileAdvance"),h=e.groupIDList;Yt(h)&&h.length>50&&(V.warn("".concat(l," \u83B7\u53D6\u7FA4\u8D44\u6599\u7684\u6570\u91CF\u4E0D\u80FD\u8D85\u8FC750\u4E2A")),h.length=50);var _=[],S=[];h.forEach(function(L){vo({groupID:L})?S.push(L):_.push(L)});var E=[];if(_.length>0){var M=this._getGroupProfileAdvance(m(m({},e),{},{groupIDList:_}));E.push(M)}if(S.length>0){var w=this._getGroupProfileAdvance(m(m({},e),{},{groupIDList:S,relayFlag:_.length>0}));E.push(w)}return Promise.all(E).then(function(L){var H=[],ne=[];return L.forEach(function(ae){H.push.apply(H,Be(ae.successGroupList)),ne.push.apply(ne,Be(ae.failureGroupList))}),Wt({successGroupList:H,failureGroupList:ne})}).catch(function(L){return V.error("".concat(n._className,"._getGroupProfileAdvance failed. error:"),L),Le(L)})}},{key:"_getGroupProfileAdvance",value:function(e){var n=this,l=e.relayFlag,h=l!==void 0&&l,_=se(e,Bt);return this.request({protocolName:SI,requestData:_}).then(function(S){V.log("".concat(n._className,"._getGroupProfileAdvance ok."));var E=S.data.groups;return{successGroupList:E.filter(function(M){return Ke(M.errorCode)||M.errorCode===0}),failureGroupList:E.filter(function(M){return M.errorCode&&M.errorCode!==0}).map(function(M){return new Me({code:M.errorCode,message:M.errorInfo,data:{groupID:M.groupID}})})}}).catch(function(S){return h&&vo({groupID:e.groupIDList[0]})?{successGroupList:[],failureGroupList:[]}:Le(S)})}},{key:"createGroup",value:function(e){var n=this,l="".concat(this._className,".createGroup"),h=e.type,_=e.groupID;if(!["Public","Private","ChatRoom","AVChatRoom","Community"].includes(h))return Le({code:We.ILLEGAL_GROUP_TYPE,message:at.ILLEGAL_GROUP_TYPE});if(!vo({type:h})){if(!Mt(_)&&vo({groupID:_}))return Le({code:We.ILLEGAL_GROUP_ID,message:at.ILLEGAL_GROUP_ID});e.isSupportTopic=void 0}if(Ws(h)&&!Ke(e.memberList)&&e.memberList.length>0&&(V.warn("".concat(l," \u521B\u5EFA AVChatRoom \u65F6\u4E0D\u80FD\u6DFB\u52A0\u7FA4\u6210\u5458\uFF0C\u81EA\u52A8\u5FFD\u7565\u8BE5\u5B57\u6BB5")),e.memberList=void 0),$0(h)||Ke(e.joinOption)||(V.warn("".concat(l," \u521B\u5EFA Work/Meeting/AVChatRoom/Community \u7FA4\u65F6\u4E0D\u80FD\u8BBE\u7F6E\u5B57\u6BB5 joinOption\uFF0C\u81EA\u52A8\u5FFD\u7565\u8BE5\u5B57\u6BB5")),e.joinOption=void 0),vo({type:h})){if(!Mt(_)&&!vo({groupID:_}))return Le({code:We.ILLEGAL_GROUP_ID,message:at.ILLEGAL_GROUP_ID});e.isSupportTopic=e.isSupportTopic===!0?1:0}var S=new ht(yt.CREATE_GROUP);V.log("".concat(l," options:"),e);var E=[];return this.request({protocolName:II,requestData:m(m({},e),{},{ownerID:this.getMyUserID(),webPushFlag:1})}).then(function(M){var w=M.data,L=w.groupID,H=w.overLimitUserIDList,ne=H===void 0?[]:H;if(E=ne,S.setNetworkType(n.getNetworkType()).setMessage("groupType:".concat(e.type," groupID:").concat(L," overLimitUserIDList=").concat(ne)).end(),V.log("".concat(l," ok groupID:").concat(L," overLimitUserIDList:"),ne),e.type===Z.GRP_AVCHATROOM)return n.getGroupProfile({groupID:L});if(e.type===Z.GRP_COMMUNITY&&e.isSupportTopic===1)return n.getGroupProfile({groupID:L});Mt(e.memberList)||Mt(ne)||(e.memberList=e.memberList.filter(function(ge){return ne.indexOf(ge.userID)===-1})),n.updateGroupMap([m(m({},e),{},{groupID:L})]);var ae=n.getModule(fi),he=ae.createCustomMessage({to:L,conversationType:Z.CONV_GROUP,payload:{data:"group_create",extension:"".concat(n.getMyUserID(),"\u521B\u5EFA\u7FA4\u7EC4")}});return ae.sendMessageInstance(he),n.emitGroupListUpdate(),n.getGroupProfile({groupID:L})}).then(function(M){var w=M.data.group,L=w.selfInfo,H=L.nameCard,ne=L.joinTime;return w.updateSelfInfo({nameCard:H,joinTime:ne,messageRemindType:Z.MSG_REMIND_ACPT_AND_NOTE,role:Z.GRP_MBR_ROLE_OWNER}),Wt({group:w,overLimitUserIDList:E})}).catch(function(M){return S.setMessage("groupType:".concat(e.type)),n.probeNetwork().then(function(w){var L=Ue(w,2),H=L[0],ne=L[1];S.setError(M,H,ne).end()}),V.error("".concat(l," failed. error:"),M),Le(M)})}},{key:"dismissGroup",value:function(e){var n=this,l="".concat(this._className,".dismissGroup");if(this.hasLocalGroup(e)&&this.getLocalGroupProfile(e).type===Z.GRP_WORK)return Le(new Me({code:We.CANNOT_DISMISS_WORK,message:at.CANNOT_DISMISS_WORK}));var h=new ht(yt.DISMISS_GROUP);return h.setMessage("groupID:".concat(e)),V.log("".concat(l," groupID:").concat(e)),this.request({protocolName:EI,requestData:{groupID:e}}).then(function(){return h.setNetworkType(n.getNetworkType()).end(),V.log("".concat(l," ok")),n.deleteLocalGroupAndConversation(e),n.checkJoinedAVChatRoomByID(e)&&n._AVChatRoomHandler.reset(e),Wt({groupID:e})}).catch(function(_){return n.probeNetwork().then(function(S){var E=Ue(S,2),M=E[0],w=E[1];h.setError(_,M,w).end()}),V.error("".concat(l," failed. error:"),_),Le(_)})}},{key:"updateGroupProfile",value:function(e){var n=this,l="".concat(this._className,".updateGroupProfile");!this.hasLocalGroup(e.groupID)||$0(this.getLocalGroupProfile(e.groupID).type)||Ke(e.joinOption)||(V.warn("".concat(l," Work/Meeting/AVChatRoom/Community \u7FA4\u4E0D\u80FD\u8BBE\u7F6E\u5B57\u6BB5 joinOption\uFF0C\u81EA\u52A8\u5FFD\u7565\u8BE5\u5B57\u6BB5")),e.joinOption=void 0),Ke(e.muteAllMembers)||(e.muteAllMembers?e.muteAllMembers="On":e.muteAllMembers="Off");var h=new ht(yt.UPDATE_GROUP_PROFILE);return h.setMessage(JSON.stringify(e)),V.log("".concat(l," groupID:").concat(e.groupID)),this.request({protocolName:TI,requestData:e}).then(function(){return h.setNetworkType(n.getNetworkType()).end(),V.log("".concat(l," ok")),n.hasLocalGroup(e.groupID)&&(n.groupMap.get(e.groupID).updateGroup(e),n._setStorageGroupList()),Wt({group:n.groupMap.get(e.groupID)})}).catch(function(_){return n.probeNetwork().then(function(S){var E=Ue(S,2),M=E[0],w=E[1];h.setError(_,M,w).end()}),V.log("".concat(l," failed. error:"),_),Le(_)})}},{key:"joinGroup",value:function(e){var n=this,l=e.groupID,h=e.type,_="".concat(this._className,".joinGroup");if(h===Z.GRP_WORK){var S=new Me({code:We.CANNOT_JOIN_WORK,message:at.CANNOT_JOIN_WORK});return Le(S)}if(this.deleteUnjoinedAVChatRoom(l),this.hasLocalGroup(l)){if(!this.isLoggedIn())return En({status:Z.JOIN_STATUS_ALREADY_IN_GROUP});var E=new ht(yt.APPLY_JOIN_GROUP);return this.getGroupProfile({groupID:l}).then(function(){return E.setNetworkType(n.getNetworkType()).setMessage("groupID:".concat(l," joinedStatus:").concat(Z.JOIN_STATUS_ALREADY_IN_GROUP)).end(),En({status:Z.JOIN_STATUS_ALREADY_IN_GROUP})}).catch(function(M){return E.setNetworkType(n.getNetworkType()).setMessage("groupID:".concat(l," unjoined")).end(),V.warn("".concat(_," ").concat(l," was unjoined, now join!")),n.groupMap.delete(l),n.applyJoinGroup(e)})}return V.log("".concat(_," groupID:").concat(l)),this.isLoggedIn()?this.applyJoinGroup(e):this._AVChatRoomHandler.joinWithoutAuth(e)}},{key:"applyJoinGroup",value:function(e){var n=this,l="".concat(this._className,".applyJoinGroup"),h=e.groupID,_=new ht(yt.APPLY_JOIN_GROUP),S=m({},e),E=this.getModule(vf).canIUse(Nn.AVCHATROOM_HISTORY_MSG);return E&&(S.historyMessageFlag=1),this.getModule(Vt).deleteTopicRoamingMessageInfo(h),this.request({protocolName:MI,requestData:S}).then(function(M){var w=M.data,L=w.joinedStatus,H=w.longPollingKey,ne=w.startSeq,ae=w.avChatRoomFlag,he=w.avChatRoomKey,ge=w.messageList,Te="groupID:".concat(h," joinedStatus:").concat(L," longPollingKey:").concat(H," startSeq:").concat(ne)+" avChatRoomFlag:".concat(ae," canGetAVChatRoomHistoryMessage:").concat(E,",")+" history message count:".concat(Mt(ge)?0:ge.length);switch(_.setNetworkType(n.getNetworkType()).setMessage("".concat(Te)).end(),V.log("".concat(l," ok. ").concat(Te)),L){case UT:return Wt({status:UT});case Xl:return n.getGroupProfile({groupID:h}).then(function(Ct){var wt,dn=Ct.data.group,$t={status:Xl,group:dn};return ae===1?(n.getModule(Vt).setCompleted("".concat(Z.CONV_GROUP).concat(h)),n._groupAttributesHandler.initGroupAttributesCache({groupID:h,avChatRoomKey:he}),(wt=Ke(H)?n._AVChatRoomHandler.handleJoinResult({group:dn}):n._AVChatRoomHandler.startRunLoop({longPollingKey:H,group:dn,startSeq:ne})).then(function(){n._onAVChatRoomHistoryMessage(ge)}),wt):(n.emitGroupListUpdate(!0,!1),Wt($t))});default:var Ze=new Me({code:We.JOIN_GROUP_FAIL,message:at.JOIN_GROUP_FAIL});return V.error("".concat(l," error:"),Ze),Le(Ze)}}).catch(function(M){return _.setMessage("groupID:".concat(e.groupID)),n.probeNetwork().then(function(w){var L=Ue(w,2),H=L[0],ne=L[1];_.setError(M,H,ne).end()}),V.error("".concat(l," error:"),M),Le(M)})}},{key:"quitGroup",value:function(e){var n=this,l="".concat(this._className,".quitGroup");V.log("".concat(l," groupID:").concat(e));var h=this.checkJoinedAVChatRoomByID(e);if(!h&&!this.hasLocalGroup(e)){var _=new Me({code:We.MEMBER_NOT_IN_GROUP,message:at.MEMBER_NOT_IN_GROUP});return Le(_)}if(h&&!this.isLoggedIn())return V.log("".concat(l," anonymously ok. groupID:").concat(e)),this.deleteLocalGroupAndConversation(e),this._AVChatRoomHandler.reset(e),En({groupID:e});var S=new ht(yt.QUIT_GROUP);return S.setMessage("groupID:".concat(e)),this.request({protocolName:CI,requestData:{groupID:e}}).then(function(){return S.setNetworkType(n.getNetworkType()).end(),V.log("".concat(l," ok")),n.deleteLocalGroupAndConversation(e),h&&n._AVChatRoomHandler.reset(e),Wt({groupID:e})}).catch(function(E){return n.probeNetwork().then(function(M){var w=Ue(M,2),L=w[0],H=w[1];S.setError(E,L,H).end()}),V.error("".concat(l," failed. error:"),E),Le(E)})}},{key:"searchGroupByID",value:function(e){var n=this,l="".concat(this._className,".searchGroupByID"),h={groupIDList:[e]},_=new ht(yt.SEARCH_GROUP_BY_ID);return _.setMessage("groupID:".concat(e)),V.log("".concat(l," groupID:").concat(e)),this.request({protocolName:bI,requestData:h}).then(function(S){var E=S.data.groupProfile;if(E[0].errorCode!==0)throw new Me({code:E[0].errorCode,message:E[0].errorInfo});return _.setNetworkType(n.getNetworkType()).end(),V.log("".concat(l," ok")),Wt({group:new Zu(E[0])})}).catch(function(S){return n.probeNetwork().then(function(E){var M=Ue(E,2),w=M[0],L=M[1];_.setError(S,w,L).end()}),V.warn("".concat(l," failed. error:"),S),Le(S)})}},{key:"changeGroupOwner",value:function(e){var n=this,l="".concat(this._className,".changeGroupOwner");if(this.hasLocalGroup(e.groupID)&&this.getLocalGroupProfile(e.groupID).type===Z.GRP_AVCHATROOM)return Le(new Me({code:We.CANNOT_CHANGE_OWNER_IN_AVCHATROOM,message:at.CANNOT_CHANGE_OWNER_IN_AVCHATROOM}));if(e.newOwnerID===this.getMyUserID())return Le(new Me({code:We.CANNOT_CHANGE_OWNER_TO_SELF,message:at.CANNOT_CHANGE_OWNER_TO_SELF}));var h=new ht(yt.CHANGE_GROUP_OWNER);return h.setMessage("groupID:".concat(e.groupID," newOwnerID:").concat(e.newOwnerID)),V.log("".concat(l," groupID:").concat(e.groupID)),this.request({protocolName:_y,requestData:e}).then(function(){h.setNetworkType(n.getNetworkType()).end(),V.log("".concat(l," ok"));var _=e.groupID,S=e.newOwnerID;n.groupMap.get(_).ownerID=S;var E=n.getModule(gi).getLocalGroupMemberList(_);if(E instanceof Map){var M=E.get(n.getMyUserID());Ke(M)||(M.updateRole("Member"),n.groupMap.get(_).selfInfo.role="Member");var w=E.get(S);Ke(w)||w.updateRole("Owner")}return n.emitGroupListUpdate(!0,!1),Wt({group:n.groupMap.get(_)})}).catch(function(_){return n.probeNetwork().then(function(S){var E=Ue(S,2),M=E[0],w=E[1];h.setError(_,M,w).end()}),V.error("".concat(l," failed. error:"),_),Le(_)})}},{key:"handleGroupApplication",value:function(e){var n=this,l="".concat(this._className,".handleGroupApplication"),h=e.message.payload,_=h.groupProfile.groupID,S=h.authentication,E=h.messageKey,M=h.operatorID,w=new ht(yt.HANDLE_GROUP_APPLICATION);return w.setMessage("groupID:".concat(_)),V.log("".concat(l," groupID:").concat(_)),this.request({protocolName:yy,requestData:m(m({},e),{},{applicant:M,groupID:_,authentication:S,messageKey:E})}).then(function(){return w.setNetworkType(n.getNetworkType()).end(),V.log("".concat(l," ok")),n._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),Wt({group:n.getLocalGroupProfile(_)})}).catch(function(L){return n.probeNetwork().then(function(H){var ne=Ue(H,2),ae=ne[0],he=ne[1];w.setError(L,ae,he).end()}),V.error("".concat(l," failed. error"),L),Le(L)})}},{key:"handleGroupInvitation",value:function(e){var n=this,l="".concat(this._className,".handleGroupInvitation"),h=e.message.payload,_=h.groupProfile.groupID,S=h.authentication,E=h.messageKey,M=h.operatorID,w=e.handleAction,L=new ht(yt.HANDLE_GROUP_INVITATION);return L.setMessage("groupID:".concat(_," inviter:").concat(M," handleAction:").concat(w)),V.log("".concat(l," groupID:").concat(_," inviter:").concat(M," handleAction:").concat(w)),this.request({protocolName:Sy,requestData:m(m({},e),{},{inviter:M,groupID:_,authentication:S,messageKey:E})}).then(function(){return L.setNetworkType(n.getNetworkType()).end(),V.log("".concat(l," ok")),n._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),Wt({group:n.getLocalGroupProfile(_)})}).catch(function(H){return n.probeNetwork().then(function(ne){var ae=Ue(ne,2),he=ae[0],ge=ae[1];L.setError(H,he,ge).end()}),V.error("".concat(l," failed. error"),H),Le(H)})}},{key:"getGroupOnlineMemberCount",value:function(e){return this._AVChatRoomHandler?this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)?this._AVChatRoomHandler.getGroupOnlineMemberCount(e):En({memberCount:0}):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"hasLocalGroup",value:function(e){return this.groupMap.has(e)}},{key:"deleteLocalGroupAndConversation",value:function(e){var n=this.checkJoinedAVChatRoomByID(e);if(V.log("".concat(this._className,".deleteLocalGroupAndConversation isJoinedAVChatRoom:").concat(n)),n&&this.getModule(Vt).deleteLocalConversation("".concat(Z.CONV_GROUP).concat(e)),vo({groupID:e})){var l=this.getLocalGroupProfile(e);l&&l.isSupportTopic===!0&&this.getModule(ri).deleteTopicListInCommunity(e)}this._deleteLocalGroup(e),this.emitGroupListUpdate(!0,!1)}},{key:"_deleteLocalGroup",value:function(e){this.groupMap.delete(e),this.getModule(gi).deleteGroupMemberList(e),this._setStorageGroupList()}},{key:"sendMessage",value:function(e,n){var l=this.createGroupMessagePack(e,n);return this.request(l)}},{key:"createGroupMessagePack",value:function(e,n){var l=null;n&&n.offlinePushInfo&&(l=n.offlinePushInfo);var h="";Ln(e.cloudCustomData)&&e.cloudCustomData.length>0&&(h=e.cloudCustomData);var _=[];if(Br(n)&&Br(n.messageControlInfo)){var S=n.messageControlInfo,E=S.excludedFromUnreadCount,M=S.excludedFromLastMessage;E===!0&&_.push("NoUnread"),M===!0&&_.push("NoLastMsg")}var w=e.getGroupAtInfoList(),L={fromAccount:this.getMyUserID(),groupID:e.to,msgBody:e.getElements(),cloudCustomData:h,random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:e.type!==Z.MSG_TEXT||Mt(w)?void 0:w,onlineOnlyFlag:this.isOnlineMessage(e,n)?1:0,clientTime:e.clientTime,offlinePushInfo:l?{pushFlag:l.disablePush===!0?1:0,title:l.title||"",desc:l.description||"",ext:l.extension||"",apnsInfo:{badgeMode:l.ignoreIOSBadge===!0?1:0},androidInfo:{OPPOChannelID:l.androidOPPOChannelID||""}}:void 0,messageControlInfo:_,needReadReceipt:e.needReadReceipt!==!0||this.isMessageFromOrToAVChatroom(e.to)?0:1};return Lt(e.to)&&(L.groupID=wo(e.to),L.topicID=e.to),{protocolName:cI,tjgID:this.generateTjgID(e),requestData:L}}},{key:"revokeMessage",value:function(e){var n={groupID:e.to,msgSeqList:[{msgSeq:e.sequence}]};return Lt(e.to)&&(n.groupID=wo(e.to),n.topicID=e.to),this.request({protocolName:AI,requestData:n})}},{key:"deleteMessage",value:function(e){var n=e.to,l=e.keyList;V.log("".concat(this._className,".deleteMessage groupID:").concat(n," count:").concat(l.length));var h={groupID:n,deleter:this.getMyUserID(),keyList:l};return Lt(n)&&(h.groupID=wo(n),h.topicID=n),this.request({protocolName:oM,requestData:h})}},{key:"modifyRemoteMessage",value:function(e){var n=e.to,l=e.sequence,h=e.payload,_=e.type,S=e.version,E=S===void 0?0:S,M=e.cloudCustomData,w=n,L=void 0;Lt(n)&&(w=wo(n),L=n);var H=void 0;return BT(_)&&(H=[]).push({type:_,content:h}),this.request({protocolName:aM,requestData:{groupID:w,topicID:L,sequence:l,version:E,elements:H,cloudCustomData:M}})}},{key:"getRoamingMessage",value:function(e){var n=this,l="".concat(this._className,".getRoamingMessage"),h=e.conversationID,_=e.groupID,S=e.sequence,E=new ht(yt.GET_GROUP_ROAMING_MESSAGES),M=0,w=void 0;return Lt(_)&&(_=wo(w=_)),this._computeLastSequence({groupID:_,topicID:w,sequence:S}).then(function(L){return M=L,V.log("".concat(l," groupID:").concat(_," startSequence:").concat(M)),n.request({protocolName:Wr,requestData:{groupID:_,count:21,sequence:M,topicID:w}})}).then(function(L){var H=L.data,ne=H.messageList,ae=H.complete;Ke(ne)?V.log("".concat(l," ok. complete:").concat(ae," but messageList is undefined!")):V.log("".concat(l," ok. complete:").concat(ae," count:").concat(ne.length)),E.setNetworkType(n.getNetworkType()).setMessage("groupID:".concat(_," topicID:").concat(w," startSequence:").concat(M," complete:").concat(ae," count:").concat(ne?ne.length:"undefined")).end();var he=n.getModule(Vt);if(ae===2||Mt(ne))return he.setCompleted(h),{nextReqID:"",storedMessageList:[]};var ge=ne[ne.length-1].sequence-1;he.updateRoamingMessageSequence(h,ge);var Te=he.onRoamingMessage(ne,h);return he.updateIsRead(h),he.patchConversationLastMessage(h),V.log("".concat(l," nextReqID:").concat(ge," stored message count:").concat(Te.length)),{nextReqID:ge+"",storedMessageList:Te}}).catch(function(L){return n.probeNetwork().then(function(H){var ne=Ue(H,2),ae=ne[0],he=ne[1];E.setError(L,ae,he).setMessage("groupID:".concat(_," topicID:").concat(w," startSequence:").concat(M)).end()}),V.warn("".concat(l," failed. error:"),L),Le(L)})}},{key:"_getGroupIDOfMessage",value:function(e){return e.conversationID.replace(Z.CONV_GROUP,"")}},{key:"getReadReceiptList",value:function(e){var n=this,l="".concat(this._className,".getReadReceiptList"),h=this._getGroupIDOfMessage(e[0]),_=this.getMyUserID(),S=e.filter(function(M){return M.from===_&&M.needReadReceipt===!0}).map(function(M){return{sequence:M.sequence}});if(V.log("".concat(l," groupID:").concat(h," sequenceList:").concat(JSON.stringify(S))),S.length===0)return En({messageList:e});var E=new ht(yt.GET_READ_RECEIPT);return E.setMessage("groupID:".concat(h)),this.request({protocolName:la,requestData:{groupID:h,sequenceList:S}}).then(function(M){E.end(),V.log("".concat(l," ok"));var w=M.data.readReceiptList;return Yt(w)&&w.forEach(function(L){e.forEach(function(H){L.code===0&&L.sequence===H.sequence&&(H.readReceiptInfo.readCount=L.readCount,H.readReceiptInfo.unreadCount=L.unreadCount)})}),Wt({messageList:e})}).catch(function(M){return n.probeNetwork().then(function(w){var L=Ue(w,2),H=L[0],ne=L[1];E.setError(M,H,ne).end()}),V.warn("".concat(l," failed. error:"),M),Le(M)})}},{key:"sendReadReceipt",value:function(e){var n=this,l=this._getGroupIDOfMessage(e[0]),h=new ht(yt.SEND_READ_RECEIPT);h.setMessage("groupID:".concat(l));var _=this.getMyUserID(),S=e.filter(function(M){return M.from!==_&&M.needReadReceipt===!0}).map(function(M){return{sequence:M.sequence}});if(S.length===0)return Le({code:We.READ_RECEIPT_MESSAGE_LIST_EMPTY,message:at.READ_RECEIPT_MESSAGE_LIST_EMPTY});var E="".concat(this._className,".sendReadReceipt");return V.log("".concat(E,". sequenceList:").concat(JSON.stringify(S))),this.request({protocolName:rM,requestData:{groupID:l,sequenceList:S}}).then(function(M){return h.end(),V.log("".concat(E," ok")),Wt()}).catch(function(M){return n.probeNetwork().then(function(w){var L=Ue(w,2),H=L[0],ne=L[1];h.setError(M,H,ne).end()}),V.warn("".concat(E," failed. error:"),M),Le(M)})}},{key:"getReadReceiptDetail",value:function(e){var n=this,l=e.message,h=e.filter,_=e.cursor,S=e.count,E=this._getGroupIDOfMessage(l),M=l.ID,w=l.sequence,L="".concat(this._className,".getReadReceiptDetail"),H=this._receiptDetailCompleteMap.get(M)||!1,ne=h!==0&&h!==1?0:h,ae=Ln(_)?_:"",he=!gr(S)||S<=0||S>=100?100:S,ge="groupID:".concat(E," sequence:").concat(w," cursor:").concat(ae," filter:").concat(ne," completeFlag:").concat(H);V.log("".concat(L," ").concat(ge));var Te={cursor:"",isCompleted:!1,messageID:M,unreadUserIDList:[],readUserIDList:[]},Ze=new ht(yt.GET_READ_RECEIPT_DETAIL);return Ze.setMessage(ge),this.request({protocolName:Ku,requestData:{groupID:E,sequence:w,flag:ne,cursor:ae,count:he}}).then(function(Ct){Ze.end();var wt=Ct.data,dn=wt.cursor,$t=wt.isCompleted,Kn=wt.unreadUserIDList,xn=wt.readUserIDList;return Te.cursor=dn,$t===1&&(Te.isCompleted=!0,n._receiptDetailCompleteMap.set(M,!0)),ne===0?Te.readUserIDList=xn.map(function(On){return On.userID}):ne===1&&(Te.unreadUserIDList=Kn.map(function(On){return On.userID})),V.log("".concat(L," ok")),Wt(Te)}).catch(function(Ct){return n.probeNetwork().then(function(wt){var dn=Ue(wt,2),$t=dn[0],Kn=dn[1];Ze.setError(Ct,$t,Kn).end()}),V.warn("".concat(L," failed. error:"),Ct),Le(Ct)})}},{key:"getRoamingMessagesHopping",value:function(e){var n=this,l="".concat(this._className,".getRoamingMessagesHopping"),h=new ht(yt.GET_GROUP_ROAMING_MESSAGES_HOPPING),_=e.groupID,S=e.count,E=e.sequence,M=e.direction,w=E;M===1&&(w=E+S-1);var L=void 0;Lt(_)&&(_=wo(L=_));var H="".concat(L?"topicID:".concat(L):"groupID:".concat(_)," sequence:").concat(E," direction:").concat(M);return V.log("".concat(l," ").concat(H)),this.request({protocolName:Wr,requestData:{groupID:_,topicID:L,count:S,sequence:w}}).then(function(ne){var ae=ne.data,he=ae.messageList,ge=ae.complete;if(V.log("".concat(l," ok. complete:").concat(ge," count:").concat(he?he.length:0)),h.setNetworkType(n.getNetworkType()).setMessage("".concat(H," complete:").concat(ge," count:").concat(he?he.length:0)).end(),ge===2||Mt(he)){var Te=n._computeResult();return Wt(Te)}var Ze="".concat(Z.CONV_GROUP).concat(e.groupID),Ct=n.getModule(Vt).onRoamingMessage(he,Ze,!1),wt=n._computeResult({direction:M,sequence:E,topicID:L,messageList:he,resultList:Ct});return Wt(wt)}).catch(function(ne){return n.probeNetwork().then(function(ae){var he=Ue(ae,2),ge=he[0],Te=he[1];h.setError(ne,ge,Te).setMessage("groupID:".concat(_," sequence:").concat(E," count:").concat(S)).end()}),V.warn("".concat(l," failed. error:"),ne),Le(ne)})}},{key:"_computeResult",value:function(e){var n={messageList:[],isCompleted:!1,nextMessageSeq:""};if(Ke(e))return n.isCompleted=!0,n;var l=e.direction,h=e.sequence,_=e.topicID,S=e.messageList,E=S===void 0?[]:S,M=e.resultList,w=M===void 0?[]:M,L=E.length;if(l===1){if(n.nextMessageSeq=E[0].sequence+1,!Ke(_)){var H=w.findIndex(function(ne){return ne.sequence===h});return H===-1?(w[w.length-1].sequence<h?(n.isCompleted=!0,n.nextMessageSeq=""):n.messageList=Be(w),n):(n.messageList=w.slice(H),n)}return n.messageList=Be(w),n}return n.nextMessageSeq=E[L-1].sequence-1,n.messageList=Be(w),n.nextMessageSeq===0&&(n.isCompleted=!0,n.nextMessageSeq=""),n}},{key:"setMessageRead",value:function(e){var n=this,l=e.conversationID,h=e.lastMessageSeq,_="".concat(this._className,".setMessageRead");V.log("".concat(_," conversationID:").concat(l," lastMessageSeq:").concat(h)),gr(h)||V.warn("".concat(_," \u8BF7\u52FF\u4FEE\u6539 Conversation.lastMessage.lastSequence\uFF0C\u5426\u5219\u53EF\u80FD\u4F1A\u5BFC\u81F4\u5DF2\u8BFB\u4E0A\u62A5\u7ED3\u679C\u4E0D\u51C6\u786E"));var S=new ht(yt.SET_GROUP_MESSAGE_READ);S.setMessage("".concat(l,"-").concat(h));var E=l.replace(Z.CONV_GROUP,""),M=void 0;return Lt(E)&&(E=wo(M=E)),this.request({protocolName:kI,requestData:{groupID:E,topicID:M,messageReadSeq:h}}).then(function(){S.setNetworkType(n.getNetworkType()).end(),V.log("".concat(_," ok."));var w=n.getModule(Vt);w.updateIsReadAfterReadReport({conversationID:l,lastMessageSeq:h});var L=!0;if(!Ke(M)){L=!1;var H=n.getModule(ri).getLocalTopic(E,M);H&&H.updateSelfInfo({readedSequence:h})}return w.updateUnreadCount(l,L),Wt()}).catch(function(w){return n.probeNetwork().then(function(L){var H=Ue(L,2),ne=H[0],ae=H[1];S.setError(w,ne,ae).end()}),V.log("".concat(_," failed. error:"),w),Le(w)})}},{key:"_computeLastSequence",value:function(e){var n=e.groupID,l=e.topicID,h=l===void 0?void 0:l,_=e.sequence;return _>0?Promise.resolve(_):Ke(h)||this.hasLocalGroup(n)?Ke(h)?this.getGroupLastSequence(n):this.getTopicLastSequence({groupID:n,topicID:h}):Promise.resolve(0)}},{key:"getGroupLastSequence",value:function(e){var n=this,l="".concat(this._className,".getGroupLastSequence"),h=new ht(yt.GET_GROUP_LAST_SEQUENCE),_=0,S="";if(this.hasLocalGroup(e)){var E=this.getLocalGroupProfile(e),M=E.lastMessage;if(M.lastSequence>0&&M.onlineOnlyFlag===!1)return _=M.lastSequence,S="got lastSequence:".concat(_," from local group profile[lastMessage.lastSequence]. groupID:").concat(e),V.log("".concat(l," ").concat(S)),h.setNetworkType(this.getNetworkType()).setMessage("".concat(S)).end(),Promise.resolve(_);if(E.nextMessageSeq>1)return _=E.nextMessageSeq-1,S="got lastSequence:".concat(_," from local group profile[nextMessageSeq]. groupID:").concat(e),V.log("".concat(l," ").concat(S)),h.setNetworkType(this.getNetworkType()).setMessage("".concat(S)).end(),Promise.resolve(_)}var w="GROUP".concat(e),L=this.getModule(Vt).getLocalConversation(w);if(L&&L.lastMessage.lastSequence&&L.lastMessage.onlineOnlyFlag===!1)return _=L.lastMessage.lastSequence,S="got lastSequence:".concat(_," from local conversation profile[lastMessage.lastSequence]. groupID:").concat(e),V.log("".concat(l," ").concat(S)),h.setNetworkType(this.getNetworkType()).setMessage("".concat(S)).end(),Promise.resolve(_);var H={groupIDList:[e],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}};return this.getGroupProfileAdvance(H).then(function(ne){var ae=ne.data.successGroupList;return Mt(ae)?V.log("".concat(l," successGroupList is empty. groupID:").concat(e)):(_=ae[0].nextMessageSeq-1,S="got lastSequence:".concat(_," from getGroupProfileAdvance. groupID:").concat(e),V.log("".concat(l," ").concat(S))),h.setNetworkType(n.getNetworkType()).setMessage("".concat(S)).end(),_}).catch(function(ne){return n.probeNetwork().then(function(ae){var he=Ue(ae,2),ge=he[0],Te=he[1];h.setError(ne,ge,Te).setMessage("get lastSequence failed from getGroupProfileAdvance. groupID:".concat(e)).end()}),V.warn("".concat(l," failed. error:"),ne),Le(ne)})}},{key:"getTopicLastSequence",value:function(e){var n=this,l=e.groupID,h=e.topicID,_="".concat(this._className,".getTopicLastSequence"),S=new ht(yt.GET_TOPIC_LAST_SEQUENCE),E=0,M="",w=this.getModule(ri);return w.hasLocalTopic(l,h)?(E=w.getLocalTopic(l,h).nextMessageSeq-1,M="get lastSequence:".concat(E," from local topic info[nextMessageSeq]. topicID:").concat(h),V.log("".concat(_," ").concat(M)),S.setNetworkType(this.getNetworkType()).setMessage("".concat(M)).end(),Promise.resolve(E)):w.getTopicList({groupID:l,topicIDList:[h]}).then(function(L){var H=L.data.successTopicList;return Mt(H)?V.log("".concat(_," successTopicList is empty. topicID:").concat(h)):(E=H[0].nextMessageSeq-1,M="get lastSequence:".concat(E," from getTopicList. topicID:").concat(h),V.log("".concat(_," ").concat(M))),S.setNetworkType(n.getNetworkType()).setMessage("".concat(M)).end(),E}).catch(function(L){return n.probeNetwork().then(function(H){var ne=Ue(H,2),ae=ne[0],he=ne[1];S.setError(L,ae,he).setMessage("get lastSequence failed from getTopicList. topicID:".concat(h)).end()}),V.warn("".concat(_," failed. error:"),L),Le(L)})}},{key:"isMessageFromOrToAVChatroom",value:function(e){return!!this._AVChatRoomHandler&&this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"hasJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler?this._AVChatRoomHandler.hasJoinedAVChatRoom():0}},{key:"getJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler?this._AVChatRoomHandler.getJoinedAVChatRoom():[]}},{key:"isOnlineMessage",value:function(e,n){return!(!this._canIUseOnlineOnlyFlag(e)||!n||n.onlineUserOnly!==!0)}},{key:"_canIUseOnlineOnlyFlag",value:function(e){var n=this.getJoinedAVChatRoom();return!n||!n.includes(e.to)||e.conversationType!==Z.CONV_GROUP}},{key:"_onAVChatRoomHistoryMessage",value:function(e){if(!Mt(e)){V.log("".concat(this._className,"._onAVChatRoomHistoryMessage count:").concat(e.length));var n=[];e.forEach(function(l){n.push(m(m({},l),{},{isHistoryMessage:1}))}),this.onAVChatRoomMessage(n)}}},{key:"onAVChatRoomMessage",value:function(e){this._AVChatRoomHandler&&this._AVChatRoomHandler.onMessage(e)}},{key:"getGroupSimplifiedInfo",value:function(e){var n=this,l=new ht(yt.GET_GROUP_SIMPLIFIED_INFO),h={groupIDList:[e],responseFilter:{groupBaseInfoFilter:["Type","Name"]}};return this.getGroupProfileAdvance(h).then(function(_){var S=_.data.successGroupList;return l.setNetworkType(n.getNetworkType()).setMessage("groupID:".concat(e," type:").concat(S[0].type)).end(),S[0]}).catch(function(_){n.probeNetwork().then(function(S){var E=Ue(S,2),M=E[0],w=E[1];l.setError(_,M,w).setMessage("groupID:".concat(e)).end()})})}},{key:"setUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.set(e,1)}},{key:"deleteUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.has(e)&&this._unjoinedAVChatRoomList.delete(e)}},{key:"isUnjoinedAVChatRoom",value:function(e){return this._unjoinedAVChatRoomList.has(e)}},{key:"onGroupAttributesUpdated",value:function(e){this._groupAttributesHandler&&this._groupAttributesHandler.onGroupAttributesUpdated(e)}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesHandler&&this._groupAttributesHandler.updateLocalMainSequenceOnReconnected()}},{key:"initGroupAttributes",value:function(e){return this._groupAttributesHandler.initGroupAttributes(e)}},{key:"setGroupAttributes",value:function(e){return this._groupAttributesHandler.setGroupAttributes(e)}},{key:"deleteGroupAttributes",value:function(e){return this._groupAttributesHandler.deleteGroupAttributes(e)}},{key:"getGroupAttributes",value:function(e){return this._groupAttributesHandler.getGroupAttributes(e)}},{key:"reset",value:function(){this.groupMap.clear(),this._unjoinedAVChatRoomList.clear(),this._receiptDetailCompleteMap.clear(),this._commonGroupHandler.reset(),this._groupSystemNoticeHandler.reset(),this._groupTipsHandler.reset(),this._AVChatRoomHandler&&this._AVChatRoomHandler.reset()}}]),o}(Ti),wA=function(){function a(t){A(this,a),this.userID="",this.avatar="",this.nick="",this.role="",this.joinTime="",this.lastSendMsgTime="",this.nameCard="",this.muteUntil=0,this.memberCustomField=[],this._initMember(t)}return x(a,[{key:"_initMember",value:function(t){this.updateMember(t)}},{key:"updateMember",value:function(t){var o=[null,void 0,"",0,NaN];t.memberCustomField&&Hm(this.memberCustomField,t.memberCustomField),Bo(this,t,["memberCustomField"],o)}},{key:"updateRole",value:function(t){["Owner","Admin","Member"].indexOf(t)<0||(this.role=t)}},{key:"updateMuteUntil",value:function(t){Ke(t)||(this.muteUntil=Math.floor((Date.now()+1e3*t)/1e3))}},{key:"updateNameCard",value:function(t){Ke(t)||(this.nameCard=t)}},{key:"updateMemberCustomField",value:function(t){t&&Hm(this.memberCustomField,t)}}]),a}(),fR=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this,e))._className="GroupMemberModule",n.groupMemberListMap=new Map,n.getInnerEmitterInstance().on(Pf,n._onProfileUpdated,Ae(n)),n}return x(o,[{key:"_onProfileUpdated",value:function(e){for(var n=this,l=e.data,h=function(S){var E=l[S];n.groupMemberListMap.forEach(function(M){M.has(E.userID)&&M.get(E.userID).updateMember({nick:E.nick,avatar:E.avatar})})},_=0;_<l.length;_++)h(_)}},{key:"deleteGroupMemberList",value:function(e){this.groupMemberListMap.delete(e)}},{key:"getGroupMemberList",value:function(e){var n=this,l=e.groupID,h=e.offset,_=h===void 0?0:h,S=e.count,E=S===void 0?15:S,M="".concat(this._className,".getGroupMemberList"),w=this.getModule(pn).hasLocalGroup(l);if(V.log("".concat(M," groupID:").concat(l," offset:").concat(_," count:").concat(E," hasLocalGroup:").concat(w)),!w)return En({memberList:[],offset:0});var L=new ht(yt.GET_GROUP_MEMBER_LIST),H=0,ne={groupID:l,limit:E>100?100:E};vo({groupID:l})?ne.next="".concat(_):(ne.offset=_,H=_+1);var ae=[];return this.request({protocolName:Ty,requestData:ne}).then(function(he){var ge=he.data,Te=ge.members,Ze=ge.memberNum,Ct=ge.next,wt=Ct===void 0?void 0:Ct;if(Ke(wt)||(H=Mt(wt)?0:wt),!Yt(Te)||Te.length===0)return H=0,Promise.resolve([]);var dn=n.getModule(pn);return dn.hasLocalGroup(l)&&(dn.getLocalGroupProfile(l).memberNum=Ze),ae=n._updateLocalGroupMemberMap(l,Te),n.getModule(Ei).getUserProfile({userIDList:Te.map(function($t){return $t.userID}),tagList:[Ii.NICK,Ii.AVATAR]})}).then(function(he){var ge=he.data;if(!Yt(ge)||ge.length===0)return En({memberList:[],offset:H});var Te=ge.map(function(Ze){return{userID:Ze.userID,nick:Ze.nick,avatar:Ze.avatar}});return n._updateLocalGroupMemberMap(l,Te),L.setNetworkType(n.getNetworkType()).setMessage("groupID:".concat(l," offset:").concat(H," count:").concat(E)).end(),V.log("".concat(M," ok.")),Wt({memberList:ae,offset:H})}).catch(function(he){return n.probeNetwork().then(function(ge){var Te=Ue(ge,2),Ze=Te[0],Ct=Te[1];L.setError(he,Ze,Ct).end()}),V.error("".concat(M," failed. error:"),he),Le(he)})}},{key:"getGroupMemberProfile",value:function(e){var n=this,l="".concat(this._className,".getGroupMemberProfile"),h=new ht(yt.GET_GROUP_MEMBER_PROFILE);h.setMessage(e.userIDList.length>5?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)),V.log("".concat(l," groupID:").concat(e.groupID," userIDList:").concat(e.userIDList.join(","))),e.userIDList.length>50&&(e.userIDList=e.userIDList.slice(0,50));var _=e.groupID,S=e.userIDList;return this._getGroupMemberProfileAdvance(m(m({},e),{},{userIDList:S})).then(function(E){var M=E.data.members;return Yt(M)&&M.length!==0?(n._updateLocalGroupMemberMap(_,M),n.getModule(Ei).getUserProfile({userIDList:M.map(function(w){return w.userID}),tagList:[Ii.NICK,Ii.AVATAR]})):En([])}).then(function(E){var M=E.data.map(function(L){return{userID:L.userID,nick:L.nick,avatar:L.avatar}});n._updateLocalGroupMemberMap(_,M);var w=S.filter(function(L){return n.hasLocalGroupMember(_,L)}).map(function(L){return n.getLocalGroupMemberInfo(_,L)});return h.setNetworkType(n.getNetworkType()).end(),Wt({memberList:w})})}},{key:"addGroupMember",value:function(e){var n=this,l="".concat(this._className,".addGroupMember"),h=e.groupID,_=this.getModule(pn).getLocalGroupProfile(h),S=_.type,E=new ht(yt.ADD_GROUP_MEMBER);if(E.setMessage("groupID:".concat(h," groupType:").concat(S)),Ws(S)){var M=new Me({code:We.CANNOT_ADD_MEMBER_IN_AVCHATROOM,message:at.CANNOT_ADD_MEMBER_IN_AVCHATROOM});return E.setCode(We.CANNOT_ADD_MEMBER_IN_AVCHATROOM).setError(at.CANNOT_ADD_MEMBER_IN_AVCHATROOM).setNetworkType(this.getNetworkType()).end(),Le(M)}return e.userIDList=e.userIDList.map(function(w){return{userID:w}}),V.log("".concat(l," groupID:").concat(h)),this.request({protocolName:DI,requestData:e}).then(function(w){var L=w.data.members;V.log("".concat(l," ok"));var H=L.filter(function(Te){return Te.result===1}).map(function(Te){return Te.userID}),ne=L.filter(function(Te){return Te.result===0}).map(function(Te){return Te.userID}),ae=L.filter(function(Te){return Te.result===2}).map(function(Te){return Te.userID}),he=L.filter(function(Te){return Te.result===4}).map(function(Te){return Te.userID}),ge="groupID:".concat(e.groupID,", ")+"successUserIDList:".concat(H,", ")+"failureUserIDList:".concat(ne,", ")+"existedUserIDList:".concat(ae,", ")+"overLimitUserIDList:".concat(he);return E.setNetworkType(n.getNetworkType()).setMoreMessage(ge).end(),H.length===0?Wt({successUserIDList:H,failureUserIDList:ne,existedUserIDList:ae,overLimitUserIDList:he}):(_.memberCount+=H.length,n._updateConversationGroupProfile(_),Wt({successUserIDList:H,failureUserIDList:ne,existedUserIDList:ae,overLimitUserIDList:he,group:_}))}).catch(function(w){return n.probeNetwork().then(function(L){var H=Ue(L,2),ne=H[0],ae=H[1];E.setError(w,ne,ae).end()}),V.error("".concat(l," failed. error:"),w),Le(w)})}},{key:"deleteGroupMember",value:function(e){var n=this,l="".concat(this._className,".deleteGroupMember"),h=e.groupID,_=e.userIDList,S=new ht(yt.DELETE_GROUP_MEMBER),E="groupID:".concat(h," ").concat(_.length>5?"userIDList.length:".concat(_.length):"userIDList:".concat(_));S.setMessage(E),V.log("".concat(l," groupID:").concat(h," userIDList:"),_);var M=this.getModule(pn).getLocalGroupProfile(h);return Ws(M.type)?Le(new Me({code:We.CANNOT_KICK_MEMBER_IN_AVCHATROOM,message:at.CANNOT_KICK_MEMBER_IN_AVCHATROOM})):this.request({protocolName:hM,requestData:e}).then(function(){return S.setNetworkType(n.getNetworkType()).end(),V.log("".concat(l," ok")),M.memberCount-=1,n._updateConversationGroupProfile(M),n.deleteLocalGroupMembers(h,_),Wt({group:M,userIDList:_})}).catch(function(w){return n.probeNetwork().then(function(L){var H=Ue(L,2),ne=H[0],ae=H[1];S.setError(w,ne,ae).end()}),V.error("".concat(l," failed. error:"),w),Le(w)})}},{key:"_updateConversationGroupProfile",value:function(e){this.getModule(Vt).updateConversationGroupProfile([e])}},{key:"setGroupMemberMuteTime",value:function(e){var n=this,l=e.groupID,h=e.userID,_=e.muteTime,S="".concat(this._className,".setGroupMemberMuteTime");if(h===this.getMyUserID())return Le(new Me({code:We.CANNOT_MUTE_SELF,message:at.CANNOT_MUTE_SELF}));V.log("".concat(S," groupID:").concat(l," userID:").concat(h));var E=new ht(yt.SET_GROUP_MEMBER_MUTE_TIME);return E.setMessage("groupID:".concat(l," userID:").concat(h," muteTime:").concat(_)),this.modifyGroupMemberInfo({groupID:l,userID:h,muteTime:_}).then(function(M){E.setNetworkType(n.getNetworkType()).end(),V.log("".concat(S," ok"));var w=n.getModule(pn);return Wt({group:w.getLocalGroupProfile(l),member:M})}).catch(function(M){return n.probeNetwork().then(function(w){var L=Ue(w,2),H=L[0],ne=L[1];E.setError(M,H,ne).end()}),V.error("".concat(S," failed. error:"),M),Le(M)})}},{key:"setGroupMemberRole",value:function(e){var n=this,l="".concat(this._className,".setGroupMemberRole"),h=e.groupID,_=e.userID,S=e.role,E=this.getModule(pn).getLocalGroupProfile(h);if(E.selfInfo.role!==Z.GRP_MBR_ROLE_OWNER)return Le({code:We.NOT_OWNER,message:at.NOT_OWNER});if([Z.GRP_WORK,Z.GRP_AVCHATROOM].includes(E.type))return Le({code:We.CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM,message:at.CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM});var M=[Z.GRP_MBR_ROLE_ADMIN,Z.GRP_MBR_ROLE_MEMBER];if(vo({groupID:h})&&M.push(Z.GRP_MBR_ROLE_CUSTOM),M.indexOf(S)<0)return Le({code:We.INVALID_MEMBER_ROLE,message:at.INVALID_MEMBER_ROLE});if(_===this.getMyUserID())return Le({code:We.CANNOT_SET_SELF_MEMBER_ROLE,message:at.CANNOT_SET_SELF_MEMBER_ROLE});var w=new ht(yt.SET_GROUP_MEMBER_ROLE);return w.setMessage("groupID:".concat(h," userID:").concat(_," role:").concat(S)),V.log("".concat(l," groupID:").concat(h," userID:").concat(_)),this.modifyGroupMemberInfo({groupID:h,userID:_,role:S}).then(function(L){return w.setNetworkType(n.getNetworkType()).end(),V.log("".concat(l," ok")),Wt({group:E,member:L})}).catch(function(L){return n.probeNetwork().then(function(H){var ne=Ue(H,2),ae=ne[0],he=ne[1];w.setError(L,ae,he).end()}),V.error("".concat(l," failed. error:"),L),Le(L)})}},{key:"setGroupMemberNameCard",value:function(e){var n=this,l="".concat(this._className,".setGroupMemberNameCard"),h=e.groupID,_=e.userID,S=_===void 0?this.getMyUserID():_,E=e.nameCard;V.log("".concat(l," groupID:").concat(h," userID:").concat(S));var M=new ht(yt.SET_GROUP_MEMBER_NAME_CARD);return M.setMessage("groupID:".concat(h," userID:").concat(S," nameCard:").concat(E)),this.modifyGroupMemberInfo({groupID:h,userID:S,nameCard:E}).then(function(w){V.log("".concat(l," ok")),M.setNetworkType(n.getNetworkType()).end();var L=n.getModule(pn).getLocalGroupProfile(h);return S===n.getMyUserID()&&L&&L.setSelfNameCard(E),Wt({group:L,member:w})}).catch(function(w){return n.probeNetwork().then(function(L){var H=Ue(L,2),ne=H[0],ae=H[1];M.setError(w,ne,ae).end()}),V.error("".concat(l," failed. error:"),w),Le(w)})}},{key:"setGroupMemberCustomField",value:function(e){var n=this,l="".concat(this._className,".setGroupMemberCustomField"),h=e.groupID,_=e.userID,S=_===void 0?this.getMyUserID():_,E=e.memberCustomField;V.log("".concat(l," groupID:").concat(h," userID:").concat(S));var M=new ht(yt.SET_GROUP_MEMBER_CUSTOM_FIELD);return M.setMessage("groupID:".concat(h," userID:").concat(S," memberCustomField:").concat(JSON.stringify(E))),this.modifyGroupMemberInfo({groupID:h,userID:S,memberCustomField:E}).then(function(w){M.setNetworkType(n.getNetworkType()).end(),V.log("".concat(l," ok"));var L=n.getModule(pn).getLocalGroupProfile(h);return Wt({group:L,member:w})}).catch(function(w){return n.probeNetwork().then(function(L){var H=Ue(L,2),ne=H[0],ae=H[1];M.setError(w,ne,ae).end()}),V.error("".concat(l," failed. error:"),w),Le(w)})}},{key:"modifyGroupMemberInfo",value:function(e){var n=this,l=e.groupID,h=e.userID,_=void 0;return Lt(l)&&(l=wo(_=l)),this.request({protocolName:pM,requestData:m(m({},e),{},{groupID:l,topicID:_})}).then(function(){if(n.hasLocalGroupMember(l,h)){var S=n.getLocalGroupMemberInfo(l,h);return Ke(e.muteTime)||S.updateMuteUntil(e.muteTime),Ke(e.role)||S.updateRole(e.role),Ke(e.nameCard)||S.updateNameCard(e.nameCard),Ke(e.memberCustomField)||S.updateMemberCustomField(e.memberCustomField),S}return n.getGroupMemberProfile({groupID:l,userIDList:[h]}).then(function(E){return Ue(E.data.memberList,1)[0]})})}},{key:"_getGroupMemberProfileAdvance",value:function(e){return this.request({protocolName:dM,requestData:m(m({},e),{},{memberInfoFilter:e.memberInfoFilter?e.memberInfoFilter:["Role","JoinTime","NameCard","ShutUpUntil"]})})}},{key:"_updateLocalGroupMemberMap",value:function(e,n){var l=this;return Yt(n)&&n.length!==0?n.map(function(h){return l.hasLocalGroupMember(e,h.userID)?l.getLocalGroupMemberInfo(e,h.userID).updateMember(h):l.setLocalGroupMember(e,new wA(h)),l.getLocalGroupMemberInfo(e,h.userID)}):[]}},{key:"deleteLocalGroupMembers",value:function(e,n){var l=this.groupMemberListMap.get(e);l&&n.forEach(function(h){l.delete(h)})}},{key:"getLocalGroupMemberInfo",value:function(e,n){return this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).get(n):null}},{key:"setLocalGroupMember",value:function(e,n){if(this.groupMemberListMap.has(e))this.groupMemberListMap.get(e).set(n.userID,n);else{var l=new Map().set(n.userID,n);this.groupMemberListMap.set(e,l)}}},{key:"getLocalGroupMemberList",value:function(e){return this.groupMemberListMap.get(e)}},{key:"hasLocalGroupMember",value:function(e,n){return this.groupMemberListMap.has(e)&&this.groupMemberListMap.get(e).has(n)}},{key:"hasLocalGroupMemberMap",value:function(e){return this.groupMemberListMap.has(e)}},{key:"reset",value:function(){this.groupMemberListMap.clear()}}]),o}(Ti),_E=["topicID","topicName","avatar","introduction","notification","unreadCount","muteAllMembers","customData","groupAtInfoList","nextMessageSeq","selfInfo"],gR=function(a){return Mt(a)?{lastTime:0,lastSequence:0,fromAccount:"",payload:null,type:"",messageForShow:"",nick:"",version:0,cloudCustomData:""}:{lastTime:a.time||0,lastSequence:a.sequence||0,fromAccount:a.from||"",payload:a.payload||null,type:a.type||"",messageForShow:Ih(a.type,a.payload),nick:a.nick||"",version:a.version||0,cloudCustomData:a.cloudCustomData||""}},mR=function(){function a(t){A(this,a),this.topicID="",this.topicName="",this.avatar="",this.introduction="",this.notification="",this.unreadCount=0,this.muteAllMembers=!1,this.customData="",this.groupAtInfoList=[],this.nextMessageSeq=0,this.lastMessage=gR(t.lastMessage),this.selfInfo={muteTime:0,readedSequence:0,messageRemindType:""},this._initTopic(t)}return x(a,[{key:"_initTopic",value:function(t){for(var o in t)_E.indexOf(o)<0||(o==="selfInfo"?this.updateSelfInfo(t[o]):this[o]=o==="muteAllMembers"?t[o]===1:t[o])}},{key:"updateUnreadCount",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this.unreadCount=t}},{key:"updateNextMessageSeq",value:function(t){this.nextMessageSeq=t}},{key:"updateLastMessage",value:function(t){this.lastMessage=gR(t)}},{key:"updateGroupAtInfoList",value:function(t){this.groupAtInfoList=JSON.parse(JSON.stringify(t))}},{key:"updateTopic",value:function(t){Ke(t.selfInfo)||this.updateSelfInfo(t.selfInfo),Ke(t.muteAllMembers)||(this.muteAllMembers=t.muteAllMembers===1),Bo(this,t,["groupID","lastMessageTime","selfInfo","muteAllMembers"])}},{key:"updateSelfInfo",value:function(t){return Bo(this.selfInfo,t,[],[""])!==0}}]),a}(),DA=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this,e))._className="TopicModule",n._topicMap=new Map,n._getTopicTimeMap=new Map,n.TOPIC_CACHE_TIME=300,n.TOPIC_LAST_ACTIVE_TIME=3600,n.getInnerEmitterInstance().on(ji,n._onCloudConfigUpdated,Ae(n)),n}return x(o,[{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("topic_cache_time"),n=this.getCloudConfig("topic_last_active_time");Ke(e)||(this.TOPIC_CACHE_TIME=Number(e)),Ke(n)||(this.TOPIC_LAST_ACTIVE_TIME=Number(n))}},{key:"onTopicCreated",value:function(e){var n=e.groupID;this.resetGetTopicTime(n),this.emitOuterEvent(mn.TOPIC_CREATED,e)}},{key:"onTopicDeleted",value:function(e){var n=this,l=e.groupID,h=e.topicIDList;(h===void 0?[]:h).forEach(function(_){n._deleteLocalTopic(l,_)}),this.emitOuterEvent(mn.TOPIC_DELETED,e)}},{key:"onTopicMessageRemindTypeUpdated",value:function(e){var n=e.groupID,l=e.topicID,h=e.messageRemindType,_=this.getLocalTopic(n,l);if(_){var S=_.updateSelfInfo({messageRemindType:h});S&&this.emitOuterEvent(mn.TOPIC_UPDATED,{groupID:n,topic:_}),V.debug("".concat(this._className,".onTopicMessageRemindTypeUpdated topicID:").concat(l)+" messageRemindType:".concat(h," isTopicUpdated:").concat(S))}}},{key:"onTopicProfileUpdated",value:function(e){var n=e.groupID,l=e.topicID,h=this.getLocalTopic(n,l);h&&(h.updateTopic(e),this.emitOuterEvent(mn.TOPIC_UPDATED,{groupID:n,topic:h}))}},{key:"onConversationProxy",value:function(e){var n=e.topicID,l=e.unreadCount,h=e.groupAtInfoList,_=wo(n),S=this.getLocalTopic(_,n),E=!1;S&&(Ke(l)||S.unreadCount===l||(S.updateUnreadCount(l),E=!0),Ke(h)||(S.updateGroupAtInfoList(h),E=!0)),E&&this.emitOuterEvent(mn.TOPIC_UPDATED,{groupID:_,topic:S})}},{key:"onMessageSent",value:function(e){var n=e.groupID,l=e.topicID,h=e.lastMessage,_=this.getLocalTopic(n,l);_&&(_.nextMessageSeq+=1,_.updateLastMessage(h),this.emitOuterEvent(mn.TOPIC_UPDATED,{groupID:n,topic:_}))}},{key:"onMessageModified",value:function(e){var n=e.to,l=e.time,h=e.sequence,_=e.elements,S=e.cloudCustomData,E=e.messageVersion,M=wo(n),w=this.getLocalTopic(M,n);if(w){var L=w.lastMessage;V.debug("".concat(this._className,".onMessageModified topicID:").concat(n," lastMessage:"),JSON.stringify(L),"options:",JSON.stringify(e)),L&&(L.payload===null||L.lastTime===l&&L.lastSequence===h&&L.version!==E)&&(L.type=_[0].type,L.payload=_[0].content,L.messageForShow=Ih(L.type,L.payload),L.cloudCustomData=S,L.version=E,L.lastSequence=h,L.lastTime=l,this.emitOuterEvent(mn.TOPIC_UPDATED,{groupID:M,topic:w}))}}},{key:"getJoinedCommunityList",value:function(){return this.getModule(pn).getGroupList({isGroupWithTopicOnly:!0}).then(function(e){var n=e.data.groupList;return Wt({groupList:n===void 0?[]:n})}).catch(function(e){return Le(e)})}},{key:"createTopicInCommunity",value:function(e){var n=this,l="".concat(this._className,".createTopicInCommunity"),h=e.topicID;if(!Ke(h)&&!Lt(h))return Le({code:We.ILLEGAL_TOPIC_ID,message:at.ILLEGAL_TOPIC_ID});var _=new ht(yt.CREATE_TOPIC);return this.request({protocolName:_M,requestData:m({},e)}).then(function(S){var E=S.data.topicID;return _.setMessage("topicID:".concat(E)).setNetworkType(n.getNetworkType()).end(),V.log("".concat(l," ok")),n._updateTopicMap([m(m({},e),{},{topicID:E})]),Wt({topicID:E})}).catch(function(S){return n.probeNetwork().then(function(E){var M=Ue(E,2),w=M[0],L=M[1];_.setError(S,w,L).end()}),V.error("".concat(l," failed. error:"),S),Le(S)})}},{key:"deleteTopicFromCommunity",value:function(e){var n=this,l="".concat(this._className,".deleteTopicFromCommunity"),h=e.groupID,_=e.topicIDList,S=_===void 0?[]:_,E=new ht(yt.DELETE_TOPIC);return E.setMessage("groupID:".concat(h," topicIDList:").concat(S)),this.request({protocolName:yM,requestData:{groupID:h,topicIDList:S}}).then(function(M){var w=M.data.resultList,L=[],H=[];(w===void 0?[]:w).forEach(function(ae){var he=ae.topicID,ge=ae.errorCode,Te=ae.errorInfo;ge===0?L.push({topicID:he}):H.push({topicID:he,code:ge,message:Te})});var ne="success count:".concat(L.length,", fail count:").concat(H.length);return E.setMoreMessage("".concat(ne)).setNetworkType(n.getNetworkType()).end(),V.log("".concat(ne)),L.forEach(function(ae){n._deleteLocalTopic(h,ae.topicID)}),Wt({successTopicList:L,failureTopicList:H})}).catch(function(M){return n.probeNetwork().then(function(w){var L=Ue(w,2),H=L[0],ne=L[1];E.setError(M,H,ne).end()}),V.error("".concat(l," failed. error:"),M),Le(M)})}},{key:"updateTopicProfile",value:function(e){var n=this,l="".concat(this._className,".updateTopicProfile"),h=new ht(yt.UPDATE_TOPIC_PROFILE);return h.setMessage("groupID:".concat(e.groupID," topicID:").concat(e.topicID)),V.log("".concat(l," options:"),e),Ke(e.muteAllMembers)||(e.muteAllMembers=e.muteAllMembers===!0?"On":"Off"),this.request({protocolName:SM,requestData:m({},e)}).then(function(){return h.setNetworkType(n.getNetworkType()).end(),V.log("".concat(l," ok")),n._updateTopicMap([e]),Wt({topic:n.getLocalTopic(e.groupID,e.topicID)})}).catch(function(_){return n.probeNetwork().then(function(S){var E=Ue(S,2),M=E[0],w=E[1];h.setError(_,M,w).end()}),V.error("".concat(l," failed. error:"),_),Le(_)})}},{key:"getTopicList",value:function(e){var n=this,l="".concat(this._className,".getTopicList"),h=e.groupID,_=e.topicIDList,S=_===void 0?[]:_,E=S.length===0,M=new ht(yt.GET_TOPIC_LIST);if(M.setMessage("groupID:".concat(h)),this._getTopicTimeMap.has(h)){var w=this._getTopicTimeMap.get(h),L=w.isGetAll,H=w.time;if((L||!L&&!E)&&Date.now()-H<1e3*this.TOPIC_CACHE_TIME){var ne=this._getLocalTopicList(h,S);if(E||ne.length===S.length)return M.setNetworkType(this.getNetworkType()).setMoreMessage("from cache, topic count:".concat(ne.length)).end(),V.log("".concat(l," groupID:").concat(h," from cache, topic count:").concat(ne.length)),En({successTopicList:ne,failureTopicList:[]})}}return this.request({protocolName:IM,requestData:{groupID:h,topicIDList:S}}).then(function(ae){var he=ae.data.topicInfoList,ge=[],Te=[],Ze=[];(he===void 0?[]:he).forEach(function(dn){var $t=dn.topic,Kn=dn.selfInfo,xn=dn.errorCode,On=dn.errorInfo,ar=$t.topicID;xn===0?(ge.push(m(m({},$t),{},{selfInfo:Kn})),Te.push(ar)):Ze.push({topicID:ar,code:xn,message:On})}),n._updateTopicMap(ge),n._handleTopicAtInfo(ge);var Ct="success count:".concat(Te.length,", fail count:").concat(Ze.length);M.setNetworkType(n.getNetworkType()).setMoreMessage("".concat(Ct)).end(),V.log("".concat(l," groupID:").concat(h," from remote, ").concat(Ct));var wt=[];return Mt(Te)||(n._getTopicTimeMap.set(h,{time:Date.now(),isGetAll:E}),wt=n._getLocalTopicList(h,Te)),Wt({successTopicList:wt,failureTopicList:Ze})}).catch(function(ae){return n.probeNetwork(ae).then(function(he){var ge=Ue(he,2),Te=ge[0],Ze=ge[1];M.setError(ae,Te,Ze).end()}),V.error("".concat(l," failed. error:"),ae),Le(ae)})}},{key:"hasLocalTopic",value:function(e,n){return!!this._topicMap.has(e)&&this._topicMap.get(e).has(n)}},{key:"getLocalTopic",value:function(e,n){var l=null;return this._topicMap.has(e)&&(l=this._topicMap.get(e).get(n)),l}},{key:"_getLocalTopicList",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],l=this._topicMap.get(e),h=[];return l&&(h=Be(l.values())),n.length===0?h:h.filter(function(_){return n.includes(_.topicID)})}},{key:"_deleteLocalTopic",value:function(e,n){this._topicMap.has(e)&&(this._topicMap.get(e).delete(n),V.log("".concat(this._className,"._deleteLocalTopic groupID:").concat(e," topicID:").concat(n)))}},{key:"_updateTopicMap",value:function(e){var n=this,l=[];e.forEach(function(h){var _=h.groupID,S=h.topicID,E=null;n._topicMap.has(_)||n._topicMap.set(_,new Map),n._topicMap.get(_).has(S)?(E=n._topicMap.get(_).get(S)).updateTopic(h):(n._getTopicLastMessage(h),E=new mR(h),n._topicMap.get(_).set(S,E));var M=E.nextMessageSeq-E.selfInfo.readedSequence-1,w=M>0?M:0;E.updateUnreadCount(w),l.push({conversationID:"".concat(Z.CONV_GROUP).concat(S),type:Z.CONV_TOPIC,unreadCount:w})}),l.length>0&&this.getModule(Vt).updateTopicConversation(l)}},{key:"resetGetTopicTime",value:function(e){var n=this;Ke(e)?Be(this._getTopicTimeMap.keys()).forEach(function(l){n._getTopicTimeMap.set(l,0)}):this._getTopicTimeMap.set(e,0)}},{key:"getTopicListOnReconnected",value:function(){var e=this,n=Be(this._topicMap.keys()),l=[];n.forEach(function(h){var _=[];e._getLocalTopicList(h).forEach(function(S){var E=S.lastMessage.lastTime,M=E===void 0?0:E;Date.now()-1e3*M<1e3*e.TOPIC_LAST_ACTIVE_TIME&&_.push(S.topicID)}),_.length>0&&l.push({groupID:h,topicIDList:_})}),V.log("".concat(this._className,".getTopicListOnReconnected. active community count:").concat(l.length)),this._relayGetTopicList(l)}},{key:"_relayGetTopicList",value:function(e){var n=this;if(e.length!==0){var l=e.shift(),h=l.topicIDList.length>5?"topicIDList.length:".concat(l.topicIDList.length):"topicIDList:".concat(l.topicIDList),_=new ht(yt.RELAY_GET_TOPIC_LIST);_.setMessage(h),V.log("".concat(this._className,"._relayGetTopicList. ").concat(h)),this.getTopicList(l).then(function(){_.setNetworkType(n.getNetworkType()).end(),n._relayGetTopicList(e)}).catch(function(S){n.probeNetwork().then(function(E){var M=Ue(E,2),w=M[0],L=M[1];_.setError(S,w,L).end()}),n._relayGetTopicList(e)})}}},{key:"_handleTopicAtInfo",value:function(e){var n=this;e.length!==0&&e.forEach(function(l){var h=l.groupID,_=l.topicID,S=l.groupAtInfoList,E=[];Ke(S)||(S.forEach(function(M){E.push(m(m({},M),{},{groupID:h,topicID:_}))}),n.getModule(Vt).onNewGroupAtTips({dataList:E}))})}},{key:"_getTopicLastMessage",value:function(e){if(!Ke(e.lastMsg)){var n={time:e.lastMsg.time,sequence:e.lastMsg.sequence,from:e.lastMsg.from,payload:e.lastMsg.elements[0]?e.lastMsg.elements[0].content:null,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:"",nick:e.lastMsg.nick,version:e.lastMsg.messageVersion,cloudCustomData:e.lastMsg.cloudCustomData};e.lastMessage=n}}},{key:"deleteTopicListInCommunity",value:function(e){var n=this,l=this._getLocalTopicList(e),h=this.getModule(Vt);l.forEach(function(_){var S=_.topicID;n._deleteLocalTopic(e,S),n._getTopicTimeMap.delete(e),h.deleteLocalConversation("".concat(Z.CONV_GROUP).concat(S))})}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),this._topicMap.clear(),this._getTopicTimeMap.clear(),this.TOPIC_CACHE_TIME=300,this.TOPIC_LAST_ACTIVE_TIME=3600}}]),o}(Ti),vR=function(){function a(t){A(this,a),this._userModule=t,this._className="ProfileHandler",this.TAG="profile",this.accountProfileMap=new Map,this.expirationTime=864e5}return x(a,[{key:"setExpirationTime",value:function(t){this.expirationTime=t}},{key:"getUserProfile",value:function(t){var o=this,e=t.userIDList;t.fromAccount=this._userModule.getMyAccount(),e.length>100&&(V.warn("".concat(this._className,".getUserProfile \u83B7\u53D6\u7528\u6237\u8D44\u6599\u4EBA\u6570\u4E0D\u80FD\u8D85\u8FC7100\u4EBA")),e.length=100);for(var n,l=[],h=[],_=0,S=e.length;_<S;_++)n=e[_],this._userModule.isMyFriend(n)&&this._containsAccount(n)?h.push(this._getProfileFromMap(n)):l.push(n);if(l.length===0)return En(h);t.toAccount=l;var E=t.bFromGetMyProfile||!1,M=[];t.toAccount.forEach(function(L){M.push({toAccount:L,standardSequence:0,customSequence:0})}),t.userItem=M;var w=new ht(yt.GET_USER_PROFILE);return w.setMessage(e.length>5?"userIDList.length:".concat(e.length):"userIDList:".concat(e)),this._userModule.request({protocolName:uI,requestData:t}).then(function(L){w.setNetworkType(o._userModule.getNetworkType()).end(),V.info("".concat(o._className,".getUserProfile ok"));var H=o._handleResponse(L).concat(h);return Wt(E?H[0]:H)}).catch(function(L){return o._userModule.probeNetwork().then(function(H){var ne=Ue(H,2),ae=ne[0],he=ne[1];w.setError(L,ae,he).end()}),V.error("".concat(o._className,".getUserProfile failed. error:"),L),Le(L)})}},{key:"getMyProfile",value:function(){var t=this._userModule.getMyAccount();if(V.log("".concat(this._className,".getMyProfile myAccount:").concat(t)),this._fillMap(),this._containsAccount(t)){var o=this._getProfileFromMap(t);return V.debug("".concat(this._className,".getMyProfile from cache, myProfile:")+JSON.stringify(o)),En(o)}return this.getUserProfile({fromAccount:t,userIDList:[t],bFromGetMyProfile:!0})}},{key:"_handleResponse",value:function(t){for(var o,e,n=Fu.now(),l=t.data.userProfileItem,h=[],_=0,S=l.length;_<S;_++)l[_].to!=="@TLS#NOT_FOUND"&&l[_].to!==""&&(o=l[_].to,e=this._updateMap(o,this._getLatestProfileFromResponse(o,l[_].profileItem)),h.push(e));return V.log("".concat(this._className,"._handleResponse cost ").concat(Fu.now()-n," ms")),h}},{key:"_getLatestProfileFromResponse",value:function(t,o){var e={};if(e.userID=t,e.profileCustomField=[],!Mt(o))for(var n=0,l=o.length;n<l;n++)if(o[n].tag.indexOf("Tag_Profile_Custom")>-1)e.profileCustomField.push({key:o[n].tag,value:o[n].value});else switch(o[n].tag){case Ii.NICK:e.nick=o[n].value;break;case Ii.GENDER:e.gender=o[n].value;break;case Ii.BIRTHDAY:e.birthday=o[n].value;break;case Ii.LOCATION:e.location=o[n].value;break;case Ii.SELFSIGNATURE:e.selfSignature=o[n].value;break;case Ii.ALLOWTYPE:e.allowType=o[n].value;break;case Ii.LANGUAGE:e.language=o[n].value;break;case Ii.AVATAR:e.avatar=o[n].value;break;case Ii.MESSAGESETTINGS:e.messageSettings=o[n].value;break;case Ii.ADMINFORBIDTYPE:e.adminForbidType=o[n].value;break;case Ii.LEVEL:e.level=o[n].value;break;case Ii.ROLE:e.role=o[n].value;break;default:V.warn("".concat(this._className,"._handleResponse unknown tag:"),o[n].tag,o[n].value)}return e}},{key:"updateMyProfile",value:function(t){var o=this,e="".concat(this._className,".updateMyProfile"),n=new ht(yt.UPDATE_MY_PROFILE);n.setMessage(JSON.stringify(t));var l=new xf().validate(t);if(!l.valid)return n.setCode(We.UPDATE_PROFILE_INVALID_PARAM).setMoreMessage("".concat(e," info:").concat(l.tips)).setNetworkType(this._userModule.getNetworkType()).end(),V.error("".concat(e," info:").concat(l.tips,"\uFF0C\u8BF7\u53C2\u8003 https://web.sdk.qcloud.com/im/doc/zh-cn/SDK.html#updateMyProfile")),Le({code:We.UPDATE_PROFILE_INVALID_PARAM,message:at.UPDATE_PROFILE_INVALID_PARAM});var h=[];for(var _ in t)Object.prototype.hasOwnProperty.call(t,_)&&(_==="profileCustomField"?t.profileCustomField.forEach(function(S){h.push({tag:S.key,value:S.value})}):h.push({tag:Ii[_.toUpperCase()],value:t[_]}));return h.length===0?(n.setCode(We.UPDATE_PROFILE_NO_KEY).setMoreMessage(at.UPDATE_PROFILE_NO_KEY).setNetworkType(this._userModule.getNetworkType()).end(),V.error("".concat(e," info:").concat(at.UPDATE_PROFILE_NO_KEY,"\uFF0C\u8BF7\u53C2\u8003 https://web.sdk.qcloud.com/im/doc/zh-cn/SDK.html#updateMyProfile")),Le({code:We.UPDATE_PROFILE_NO_KEY,message:at.UPDATE_PROFILE_NO_KEY})):this._userModule.request({protocolName:ZT,requestData:{fromAccount:this._userModule.getMyAccount(),profileItem:h}}).then(function(S){n.setNetworkType(o._userModule.getNetworkType()).end(),V.info("".concat(e," ok"));var E=o._updateMap(o._userModule.getMyAccount(),t);return o._userModule.emitOuterEvent(mn.PROFILE_UPDATED,[E]),En(E)}).catch(function(S){return o._userModule.probeNetwork().then(function(E){var M=Ue(E,2),w=M[0],L=M[1];n.setError(S,w,L).end()}),V.error("".concat(e," failed. error:"),S),Le(S)})}},{key:"onProfileModified",value:function(t){var o=t.dataList;if(!Mt(o)){var e,n,l=o.length;V.debug("".concat(this._className,".onProfileModified count:").concat(l," dataList:"),t.dataList);for(var h=[],_=0;_<l;_++)e=o[_].userID,n=this._updateMap(e,this._getLatestProfileFromResponse(e,o[_].profileList)),h.push(n);h.length>0&&(this._userModule.emitInnerEvent(Pf,h),this._userModule.emitOuterEvent(mn.PROFILE_UPDATED,h))}}},{key:"_fillMap",value:function(){if(this.accountProfileMap.size===0){for(var t=this._getCachedProfiles(),o=Date.now(),e=0,n=t.length;e<n;e++)o-t[e].lastUpdatedTime<this.expirationTime&&this.accountProfileMap.set(t[e].userID,t[e]);V.log("".concat(this._className,"._fillMap from cache, map.size:").concat(this.accountProfileMap.size))}}},{key:"_updateMap",value:function(t,o){var e,n=Date.now();return this._containsAccount(t)?(e=this._getProfileFromMap(t),o.profileCustomField&&Hm(e.profileCustomField,o.profileCustomField),Bo(e,o,["profileCustomField"]),e.lastUpdatedTime=n):(e=new xf(o),(this._userModule.isMyFriend(t)||t===this._userModule.getMyAccount())&&(e.lastUpdatedTime=n,this.accountProfileMap.set(t,e))),this._flushMap(t===this._userModule.getMyAccount()),e}},{key:"_flushMap",value:function(t){var o=Be(this.accountProfileMap.values()),e=this._userModule.getStorageModule();V.debug("".concat(this._className,"._flushMap length:").concat(o.length," flushAtOnce:").concat(t)),e.setItem(this.TAG,o,t)}},{key:"_containsAccount",value:function(t){return this.accountProfileMap.has(t)}},{key:"_getProfileFromMap",value:function(t){return this.accountProfileMap.get(t)}},{key:"_getCachedProfiles",value:function(){var t=this._userModule.getStorageModule().getItem(this.TAG);return Mt(t)?[]:t}},{key:"onConversationsProfileUpdated",value:function(t){for(var o,e,n,l=[],h=0,_=t.length;h<_;h++)e=(o=t[h]).userID,this._userModule.isMyFriend(e)||(this._containsAccount(e)?(n=this._getProfileFromMap(e),Bo(n,o)>0&&l.push(e)):l.push(o.userID));l.length!==0&&(V.info("".concat(this._className,".onConversationsProfileUpdated toAccountList:").concat(l)),this.getUserProfile({userIDList:l}))}},{key:"getNickAndAvatarByUserID",value:function(t){if(this._containsAccount(t)){var o=this._getProfileFromMap(t);return{nick:o.nick,avatar:o.avatar}}return{nick:"",avatar:""}}},{key:"reset",value:function(){this._flushMap(!0),this.accountProfileMap.clear()}}]),a}(),_R=x(function a(t){A(this,a),Mt||(this.userID=t.userID||"",this.timeStamp=t.timeStamp||0)}),yR=function(){function a(t){A(this,a),this._userModule=t,this._className="BlacklistHandler",this._blacklistMap=new Map,this.startIndex=0,this.maxLimited=100,this.currentSequence=0}return x(a,[{key:"getLocalBlacklist",value:function(){return Be(this._blacklistMap.keys())}},{key:"getBlacklist",value:function(){var t=this,o="".concat(this._className,".getBlacklist"),e={fromAccount:this._userModule.getMyAccount(),maxLimited:this.maxLimited,startIndex:0,lastSequence:this.currentSequence},n=new ht(yt.GET_BLACKLIST);return this._userModule.request({protocolName:lI,requestData:e}).then(function(l){var h=l.data,_=h.blackListItem,S=h.currentSequence,E=Mt(_)?0:_.length;n.setNetworkType(t._userModule.getNetworkType()).setMessage("blackList count:".concat(E)).end(),V.info("".concat(o," ok")),t.currentSequence=S,t._handleResponse(_,!0),t._userModule.emitOuterEvent(mn.BLACKLIST_UPDATED,Be(t._blacklistMap.keys()))}).catch(function(l){return t._userModule.probeNetwork().then(function(h){var _=Ue(h,2),S=_[0],E=_[1];n.setError(l,S,E).end()}),V.error("".concat(o," failed. error:"),l),Le(l)})}},{key:"addBlacklist",value:function(t){var o=this,e="".concat(this._className,".addBlacklist"),n=new ht(yt.ADD_TO_BLACKLIST);if(!Yt(t.userIDList))return n.setCode(We.ADD_BLACKLIST_INVALID_PARAM).setMessage(at.ADD_BLACKLIST_INVALID_PARAM).setNetworkType(this._userModule.getNetworkType()).end(),V.error("".concat(e," options.userIDList \u5FC5\u9700\u662F\u6570\u7EC4")),Le({code:We.ADD_BLACKLIST_INVALID_PARAM,message:at.ADD_BLACKLIST_INVALID_PARAM});var l=this._userModule.getMyAccount();return t.userIDList.length===1&&t.userIDList[0]===l?(n.setCode(We.CANNOT_ADD_SELF_TO_BLACKLIST).setMessage(at.CANNOT_ADD_SELF_TO_BLACKLIST).setNetworkType(this._userModule.getNetworkType()).end(),V.error("".concat(e," \u4E0D\u80FD\u628A\u81EA\u5DF1\u62C9\u9ED1")),Le({code:We.CANNOT_ADD_SELF_TO_BLACKLIST,message:at.CANNOT_ADD_SELF_TO_BLACKLIST})):(t.userIDList.includes(l)&&(t.userIDList=t.userIDList.filter(function(h){return h!==l}),V.warn("".concat(e," \u4E0D\u80FD\u628A\u81EA\u5DF1\u62C9\u9ED1\uFF0C\u5DF2\u8FC7\u6EE4"))),t.fromAccount=this._userModule.getMyAccount(),t.toAccount=t.userIDList,this._userModule.request({protocolName:eM,requestData:t}).then(function(h){return n.setNetworkType(o._userModule.getNetworkType()).setMessage(t.userIDList.length>5?"userIDList.length:".concat(t.userIDList.length):"userIDList:".concat(t.userIDList)).end(),V.info("".concat(e," ok")),o._handleResponse(h.resultItem,!0),Wt(Be(o._blacklistMap.keys()))}).catch(function(h){return o._userModule.probeNetwork().then(function(_){var S=Ue(_,2),E=S[0],M=S[1];n.setError(h,E,M).end()}),V.error("".concat(e," failed. error:"),h),Le(h)}))}},{key:"_handleResponse",value:function(t,o){if(!Mt(t))for(var e,n,l,h=0,_=t.length;h<_;h++)n=t[h].to,l=t[h].resultCode,(Ke(l)||l===0)&&(o?((e=this._blacklistMap.has(n)?this._blacklistMap.get(n):new _R).userID=n,!Mt(t[h].addBlackTimeStamp)&&(e.timeStamp=t[h].addBlackTimeStamp),this._blacklistMap.set(n,e)):this._blacklistMap.has(n)&&(e=this._blacklistMap.get(n),this._blacklistMap.delete(n)));V.log("".concat(this._className,"._handleResponse total:").concat(this._blacklistMap.size," bAdd:").concat(o))}},{key:"deleteBlacklist",value:function(t){var o=this,e="".concat(this._className,".deleteBlacklist"),n=new ht(yt.REMOVE_FROM_BLACKLIST);return Yt(t.userIDList)?(t.fromAccount=this._userModule.getMyAccount(),t.toAccount=t.userIDList,this._userModule.request({protocolName:tM,requestData:t}).then(function(l){return n.setNetworkType(o._userModule.getNetworkType()).setMessage(t.userIDList.length>5?"userIDList.length:".concat(t.userIDList.length):"userIDList:".concat(t.userIDList)).end(),V.info("".concat(e," ok")),o._handleResponse(l.data.resultItem,!1),Wt(Be(o._blacklistMap.keys()))}).catch(function(l){return o._userModule.probeNetwork().then(function(h){var _=Ue(h,2),S=_[0],E=_[1];n.setError(l,S,E).end()}),V.error("".concat(e," failed. error:"),l),Le(l)})):(n.setCode(We.DEL_BLACKLIST_INVALID_PARAM).setMessage(at.DEL_BLACKLIST_INVALID_PARAM).setNetworkType(this._userModule.getNetworkType()).end(),V.error("".concat(e," options.userIDList \u5FC5\u9700\u662F\u6570\u7EC4")),Le({code:We.DEL_BLACKLIST_INVALID_PARAM,message:at.DEL_BLACKLIST_INVALID_PARAM}))}},{key:"onAccountDeleted",value:function(t){for(var o,e=[],n=0,l=t.length;n<l;n++)o=t[n],this._blacklistMap.has(o)&&(this._blacklistMap.delete(o),e.push(o));e.length>0&&(V.log("".concat(this._className,".onAccountDeleted count:").concat(e.length," userIDList:"),e),this._userModule.emitOuterEvent(mn.BLACKLIST_UPDATED,Be(this._blacklistMap.keys())))}},{key:"onAccountAdded",value:function(t){for(var o,e=[],n=0,l=t.length;n<l;n++)o=t[n],this._blacklistMap.has(o)||(this._blacklistMap.set(o,new _R({userID:o})),e.push(o));e.length>0&&(V.log("".concat(this._className,".onAccountAdded count:").concat(e.length," userIDList:"),e),this._userModule.emitOuterEvent(mn.BLACKLIST_UPDATED,Be(this._blacklistMap.keys())))}},{key:"reset",value:function(){this._blacklistMap.clear(),this.startIndex=0,this.maxLimited=100,this.currentSequence=0}}]),a}(),OA=Uo("splice"),NA=ee.TypeError,SR=Math.max,LA=Math.min;sn({target:"Array",proto:!0,forced:!OA},{splice:function(a,t){var o,e,n,l,h,_,S=fr(this),E=xr(S),M=Li(a,E),w=arguments.length;if(w===0?o=e=0:w===1?(o=0,e=E-M):(o=w-2,e=LA(SR($a(t),0),E-M)),E+o-e>9007199254740991)throw NA("Maximum allowed length exceeded");for(n=Rl(S,e),l=0;l<e;l++)(h=M+l)in S&&za(n,l,S[h]);if(n.length=e,o<e){for(l=M;l<E-e;l++)_=l+o,(h=l+e)in S?S[_]=S[h]:delete S[_];for(l=E;l>E-e+o;l--)delete S[l-1]}else if(o>e)for(l=E-e;l>M;l--)_=l+o-1,(h=l+e-1)in S?S[_]=S[h]:delete S[_];for(l=0;l<o;l++)S[l+M]=arguments[l+2];return S.length=E-e+o,n}});var ud=function(a){var t=String(a).replace(/[=]+$/,""),o="";if(t.length%4==1)return V.warn("decodeBase64 failed: ".concat(a," to be decoded is not correctly encoded.")),"";for(var e,n,l=0,h=0;n=t.charAt(h++);~n&&(e=l%4?64*e+n:n,l++%4)?o+=String.fromCharCode(255&e>>(-2*l&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);try{return decodeURIComponent(escape(o))}catch{return V.warn("decodeBase64 failed: ".concat(a," to be decoded is not correctly encoded.")),""}},IR=function(){function a(t){A(this,a),this._userModule=t,this._className="UserStatusHandler",this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100,this._userModule.getInnerEmitterInstance().on(ji,this._onCloudConfigUpdated,this)}return x(a,[{key:"_onCloudConfigUpdated",value:function(){var t=this._userModule.getCloudConfig("status_query_count"),o=this._userModule.getCloudConfig("status_sub_count"),e=this._userModule.getCloudConfig("status_unsub_count");V.log("".concat(this._className,"._onCloudConfigUpdated statusQueryCount:").concat(t," statusSubscribeCount:").concat(o)+" statusUnsubscribeCount:".concat(e)),Ke(t)||(this.MAX_QUERY_USER_COUNT=parseInt(t,10)),Ke(t)||(this.MAX_SUBSCRIBE_USER_COUNT=parseInt(o,10)),Ke(t)||(this.MAX_UNSUBSCRIBE_USER_COUNT=parseInt(e,10))}},{key:"onUserStatusUpdated",value:function(t){var o=t.dataList,e=this._userModule.getMyUserID(),n=this._userModule.getModule(ir),l=o.map(function(h){var _=h.to,S=h.statusType,E=h.customStatus,M=ud(E);return _===e&&n.setCustomStatus(M),{userID:_,statusType:S,customStatus:M}});this._userModule.emitOuterEvent(mn.USER_STATUS_UPDATED,l)}},{key:"setSelfStatus",value:function(t){var o=this,e="".concat(this._className,".setSelfStatus"),n=t.customStatus,l=new ht(yt.SET_SELF_STATUS);return this._userModule.request({protocolName:EM,requestData:{customStatus:n}}).then(function(h){return l.setNetworkType(o._userModule.getNetworkType()).setMessage("customStatus:".concat(n)).end(),V.log("".concat(e," ok. customStatus:").concat(n)),o._userModule.getModule(ir).setCustomStatus(n),Wt({userID:o._userModule.getMyUserID(),statusType:1,customStatus:n})}).catch(function(h){return o._userModule.probeNetwork().then(function(_){var S=Ue(_,2),E=S[0],M=S[1];l.setError(h,E,M).end()}),V.error("".concat(e," failed. error:"),h),Le(h)})}},{key:"getUserStatus",value:function(t){var o=this,e="".concat(this._className,".getUserStatus"),n=t.userIDList,l=n===void 0?[]:n,h=this._userModule.getMyUserID(),_=Be(l),S=void 0,E=_.indexOf(h);if(E>-1){_.splice(E,1);var M=this._userModule.getModule(ir).getCustomStatus();S={userID:h,statusType:1,customStatus:M}}if(_.length===0)return En({successUserList:[S],failureUserList:[]});if(!this._canIUseUserStatus())return Le({code:We.CANNOT_USE_COMMERCIAL_ABILITY,message:at.CANNOT_USE_COMMERCIAL_ABILITY});_.length>this.MAX_QUERY_USER_COUNT&&(V.warn("".concat(e," \u67E5\u8BE2\u7528\u6237\u72B6\u6001\u5355\u6B21\u8BF7\u6C42\u4E0D\u80FD\u8D85\u8FC7").concat(this.MAX_QUERY_USER_COUNT,"\u4E2A\u7528\u6237")),_=l.slice(0,this.MAX_QUERY_USER_COUNT));var w=new ht(yt.GET_USER_STATUS);return this._userModule.request({protocolName:TM,requestData:{userIDList:_}}).then(function(L){var H=L.data,ne=H.successUserList,ae=ne===void 0?[]:ne,he=H.failureUserList,ge=he===void 0?[]:he,Te=ae.map(function(wt){var dn=wt.userID,$t=wt.statusType,Kn=wt.customStatus;return{userID:dn,statusType:$t,customStatus:ud(Kn)}}),Ze=ge.map(function(wt){var dn=wt.userID,$t=wt.invalidUserID,Kn=wt.errorCode,xn=wt.errorInfo;return{userID:Mt($t)?dn:$t,code:Kn,message:xn}});Ke(S)||Te.unshift(S);var Ct="userID count:".concat(l.length,", success count:").concat(Te.length,", fail count:").concat(Ze.length);return w.setNetworkType(o._userModule.getNetworkType()).setMessage("".concat(Ct)).end(),V.log("".concat(e," ok. ").concat(Ct,".")),Wt({successUserList:Te,failureUserList:Ze})}).catch(function(L){return o._userModule.probeNetwork().then(function(H){var ne=Ue(H,2),ae=ne[0],he=ne[1];w.setMessage("userID count:".concat(l.length)).setError(L,ae,he).end()}),V.error("".concat(e," failed. error:"),L),Le(L)})}},{key:"subscribeUserStatus",value:function(t){var o=this;if(!this._canIUseUserStatus())return Le({code:We.CANNOT_USE_COMMERCIAL_ABILITY,message:at.CANNOT_USE_COMMERCIAL_ABILITY});var e="".concat(this._className,".subscribeUserStatus"),n=t.userIDList,l=n===void 0?[]:n,h=Be(l);h.length>this.MAX_SUBSCRIBE_USER_COUNT&&(V.warn("".concat(e," \u8BA2\u9605\u7528\u6237\u72B6\u6001\u5355\u6B21\u8BF7\u6C42\u4E0D\u80FD\u8D85\u8FC7").concat(this.MAX_SUBSCRIBE_USER_COUNT,"\u4E2A\u7528\u6237")),h=l.slice(0,this.MAX_SUBSCRIBE_USER_COUNT));var _=new ht(yt.SUBSCRIBE_USER_STATUS),S="userID count:".concat(l.length);return V.log("".concat(e," ").concat(S)),this._userModule.request({protocolName:MM,requestData:{userIDList:h}}).then(function(E){var M=E.data.failureUserList,w=(M===void 0?[]:M).map(function(L){var H=L.userID,ne=L.invalidUserID,ae=L.errorCode,he=L.errorInfo;return{userID:Mt(ne)?H:ne,code:ae,message:he}});return _.setNetworkType(o._userModule.getNetworkType()).setMessage("".concat(S," fail count:").concat(w.length)).end(),V.log("".concat(e," ok. fail count:").concat(w.length,".")),Wt({failureUserList:w})}).catch(function(E){return o._userModule.probeNetwork().then(function(M){var w=Ue(M,2),L=w[0],H=w[1];_.setMessage("".concat(S)).setError(E,L,H).end()}),V.error("".concat(e," failed. error:"),E),Le(E)})}},{key:"unsubscribeUserStatus",value:function(t){var o=this;if(!this._canIUseUserStatus())return Le({code:We.CANNOT_USE_COMMERCIAL_ABILITY,message:at.CANNOT_USE_COMMERCIAL_ABILITY});var e="".concat(this._className,".unsubscribeUserStatus"),n=(t||{}).userIDList,l=n===void 0?[]:n,h=Be(l);l.length>this.MAX_UNSUBSCRIBE_USER_COUNT&&(V.warn("".concat(e," \u53D6\u6D88\u8BA2\u9605\u7528\u6237\u72B6\u6001\u5355\u6B21\u8BF7\u6C42\u4E0D\u80FD\u8D85\u8FC7").concat(this.MAX_UNSUBSCRIBE_USER_COUNT,"\u4E2A\u7528\u6237")),h=l.slice(0,this.MAX_UNSUBSCRIBE_USER_COUNT));var _=new ht(yt.UNSUBSCRIBE_USER_STATUS),S="userID count:".concat(l.length);V.log("".concat(e," ").concat(S));var E={userIDList:h};return h.length===0&&(E.userIDList=void 0,E.unsubscribeAll=1),this._userModule.request({protocolName:RM,requestData:E}).then(function(M){var w=M.data.failureUserList,L=(w===void 0?[]:w).map(function(H){var ne=H.userID,ae=H.invalidUserID,he=H.errorCode,ge=H.errorInfo;return{userID:Mt(ae)?ne:ae,code:he,message:ge}});return _.setNetworkType(o._userModule.getNetworkType()).setMessage("".concat(S," fail count:").concat(L.length)).end(),V.log("".concat(e," ok. fail count:").concat(L.length,".")),Wt({failureUserList:L})}).catch(function(M){return o._userModule.probeNetwork().then(function(w){var L=Ue(w,2),H=L[0],ne=L[1];_.setMessage("".concat(S)).setError(M,H,ne).end()}),V.error("".concat(e," failed. error:"),M),Le(M)})}},{key:"_canIUseUserStatus",value:function(){return this._userModule.getModule(vf).canIUse(Nn.USER_STATUS)}},{key:"reset",value:function(){this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100}}]),a}(),PA=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this,e))._className="UserModule",n._profileHandler=new vR(Ae(n)),n._blacklistHandler=new yR(Ae(n)),n._userStatusHandler=new IR(Ae(n)),n.getInnerEmitterInstance().on(gs,n.onContextUpdated,Ae(n)),n}return x(o,[{key:"onContextUpdated",value:function(e){this._profileHandler.getMyProfile(),this._blacklistHandler.getBlacklist()}},{key:"onProfileModified",value:function(e){this._profileHandler.onProfileModified(e)}},{key:"onRelationChainModified",value:function(e){var n=e.dataList;if(!Mt(n)){var l=[];n.forEach(function(_){_.blackListDelAccount&&l.push.apply(l,Be(_.blackListDelAccount))}),l.length>0&&this._blacklistHandler.onAccountDeleted(l);var h=[];n.forEach(function(_){_.blackListAddAccount&&h.push.apply(h,Be(_.blackListAddAccount))}),h.length>0&&this._blacklistHandler.onAccountAdded(h)}}},{key:"onConversationsProfileUpdated",value:function(e){this._profileHandler.onConversationsProfileUpdated(e)}},{key:"getMyAccount",value:function(){return this.getMyUserID()}},{key:"getMyProfile",value:function(){return this._profileHandler.getMyProfile()}},{key:"getStorageModule",value:function(){return this.getModule(ds)}},{key:"isMyFriend",value:function(e){var n=this.getModule(ni);return!!n&&n.isMyFriend(e)}},{key:"getUserProfile",value:function(e){return this._profileHandler.getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._profileHandler.updateMyProfile(e)}},{key:"getNickAndAvatarByUserID",value:function(e){return this._profileHandler.getNickAndAvatarByUserID(e)}},{key:"getLocalBlacklist",value:function(){var e=this._blacklistHandler.getLocalBlacklist();return En(e)}},{key:"addBlacklist",value:function(e){return this._blacklistHandler.addBlacklist(e)}},{key:"deleteBlacklist",value:function(e){return this._blacklistHandler.deleteBlacklist(e)}},{key:"onUserStatusUpdated",value:function(e){this._userStatusHandler.onUserStatusUpdated(e)}},{key:"setSelfStatus",value:function(e){return this._userStatusHandler.setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._userStatusHandler.getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._userStatusHandler.subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._userStatusHandler.unsubscribeUserStatus(e)}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),this._profileHandler.reset(),this._blacklistHandler.reset(),this._userStatusHandler.reset()}}]),o}(Ti),_v=function(){function a(t,o){A(this,a),this._moduleManager=t,this._isLoggedIn=!1,this._SDKAppID=o.SDKAppID,this._userID=o.userID||"",this._userSig=o.userSig||"",this._version="2.21.2",this._a2Key="",this._tinyID="",this._customStatus="",this._contentType="json",this._unlimitedAVChatRoom=o.unlimitedAVChatRoom,this._scene=o.scene||"",this._oversea=o.oversea,this._instanceID=o.instanceID,this._statusInstanceID=0,this._isDevMode=o.devMode,this._proxyServer=o.proxyServer}return x(a,[{key:"isLoggedIn",value:function(){return this._isLoggedIn}},{key:"isOversea",value:function(){return this._oversea}},{key:"isPrivateNetWork",value:function(){return this._proxyServer}},{key:"isDevMode",value:function(){return this._isDevMode}},{key:"isSingaporeSite",value:function(){return this._SDKAppID>=2e7&&this._SDKAppID<3e7}},{key:"isKoreaSite",value:function(){return this._SDKAppID>=3e7&&this._SDKAppID<4e7}},{key:"isGermanySite",value:function(){return this._SDKAppID>=4e7&&this._SDKAppID<5e7}},{key:"isIndiaSite",value:function(){return this._SDKAppID>=5e7&&this._SDKAppID<6e7}},{key:"isUnlimitedAVChatRoom",value:function(){return this._unlimitedAVChatRoom}},{key:"setUserID",value:function(t){this._userID=t}},{key:"getUserID",value:function(){return this._userID}},{key:"setUserSig",value:function(t){this._userSig=t}},{key:"getUserSig",value:function(){return this._userSig}},{key:"getSDKAppID",value:function(){return this._SDKAppID}},{key:"setTinyID",value:function(t){this._tinyID=t,this._isLoggedIn=!0}},{key:"getTinyID",value:function(){return this._tinyID}},{key:"setCustomStatus",value:function(t){this._customStatus=t}},{key:"getCustomStatus",value:function(){return this._customStatus}},{key:"getScene",value:function(){return this._isTUIKit()?"tuikit":this._scene}},{key:"getInstanceID",value:function(){return this._instanceID}},{key:"getStatusInstanceID",value:function(){return this._statusInstanceID}},{key:"setStatusInstanceID",value:function(t){this._statusInstanceID=t}},{key:"getVersion",value:function(){return this._version}},{key:"getA2Key",value:function(){return this._a2Key}},{key:"setA2Key",value:function(t){this._a2Key=t}},{key:"getContentType",value:function(){return this._contentType}},{key:"getProxyServer",value:function(){return this._proxyServer}},{key:"_isTUIKit",value:function(){var t=!1,o=!1,e=!1,n=!1,l=[];tn&&(l=Object.keys(Rn)),Xn&&(l=Object.keys(Oi?uni:window));for(var h=0,_=l.length;h<_;h++)if(l[h].toLowerCase().includes("uikit")){t=!0;break}if(l=null,tn&&Fc(getApp)){var S=getApp().globalData;Br(S)&&S.isTUIKit===!0&&(o=!0)}this._moduleManager.getModule(ds).getStorageSync("TIM_".concat(this._SDKAppID,"_isTUIKit"))===!0&&(e=!0);var E=null;if(Wn&&!Di&&typeof uni>"u"&&__wxConfig&&(E=__wxConfig.pages),$r&&typeof uni>"u"&&__qqConfig&&(E=__qqConfig.pages),Yt(E)&&E.length>0){for(var M=0,w=E.length;M<w;M++)if(E[M].toLowerCase().includes("tui")){n=!0;break}E=null}return t||o||e||n}},{key:"reset",value:function(){this._isLoggedIn=!1,this._userSig="",this._a2Key="",this._tinyID="",this._customStatus="",this._statusInstanceID=0}}]),a}(),ER=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this,e))._className="SignModule",n._helloInterval=120,n._lastLoginTs=0,n._lastWsHelloTs=0,gv.mixin(Ae(n)),n}return x(o,[{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this._helloInterval==0&&this._hello()}},{key:"login",value:function(e){if(this.isLoggedIn()){var n="\u60A8\u5DF2\u7ECF\u767B\u5F55\u5E10\u53F7".concat(e.userID,"\uFF01\u5982\u9700\u5207\u6362\u5E10\u53F7\u767B\u5F55\uFF0C\u8BF7\u5148\u8C03\u7528 logout \u63A5\u53E3\u767B\u51FA\uFF0C\u518D\u8C03\u7528 login \u63A5\u53E3\u767B\u5F55\u3002");return V.warn(n),En({actionStatus:"OK",errorCode:0,errorInfo:n,repeatLogin:!0})}if(Date.now()-this._lastLoginTs<=15e3)return V.warn("\u60A8\u6B63\u5728\u5C1D\u8BD5\u767B\u5F55\u5E10\u53F7".concat(e.userID,"\uFF01\u8BF7\u52FF\u91CD\u590D\u767B\u5F55\u3002")),Le({code:We.REPEAT_LOGIN,message:at.REPEAT_LOGIN});V.log("".concat(this._className,".login userID:").concat(e.userID));var l=this._checkLoginInfo(e);if(l.code!==0)return Le(l);var h=this.getModule(ir),_=e.userID,S=e.userSig;return h.setUserID(_),h.setUserSig(S),this.getModule(Ua).updateProtocolConfig(),this._login()}},{key:"_login",value:function(){var e=this,n=this.getModule(ir),l=n.getScene(),h=new ht(yt.LOGIN);return h.setMessage("".concat(l)).setMoreMessage("identifier:".concat(this.getMyUserID())),Oi?l==="tuikit"?h.setUIPlatform(4):h.setUIPlatform(3):tn?l==="tuikit"?h.setUIPlatform(12):h.setUIPlatform(11):Xn&&(wT?l==="tuikit"?h.setUIPlatform(17):h.setUIPlatform(16):l==="tuikit"?h.setUIPlatform(14):h.setUIPlatform(13)),this._lastLoginTs=Date.now(),this.request({protocolName:_o}).then(function(_){e._lastLoginTs=0;var S=Date.now(),E=null,M=_.data,w=M.a2Key,L=M.tinyID,H=M.helloInterval,ne=M.instanceID,ae=M.timeStamp,he=M.customStatus,ge=he===void 0?"":he;V.log("".concat(e._className,".login ok. scene:").concat(l," helloInterval:").concat(H," instanceID:").concat(ne," timeStamp:").concat(ae));var Te=1e3*ae,Ze=S-h.getStartTs(),Ct=Te+parseInt(Ze/2)-S,wt=h.getStartTs()+Ct;if(h.start(wt),function($t,Kn){Vm=Kn;var xn=new Date;xn.setTime($t),V.info("baseTime from server: ".concat(xn," offset: ").concat(Vm))}(Te,Ct),!L)throw E=new Me({code:We.NO_TINYID,message:at.NO_TINYID}),h.setError(E,!0,e.getNetworkType()).end(),E;if(!w)throw E=new Me({code:We.NO_A2KEY,message:at.NO_A2KEY}),h.setError(E,!0,e.getNetworkType()).end(),E;h.setNetworkType(e.getNetworkType()).setMoreMessage("helloInterval:".concat(H," instanceID:").concat(ne," offset:").concat(Ct)).end(),n.setA2Key(w),n.setTinyID(L),n.setStatusInstanceID(ne);var dn=ud(ge);return n.setCustomStatus(dn),e.getModule(Ua).updateProtocolConfig(),e.emitInnerEvent(gs),e._helloInterval=H,e.triggerReady(),e._fetchCloudControlConfig(),_}).catch(function(_){return e.probeNetwork().then(function(S){var E=Ue(S,2),M=E[0],w=E[1];h.setError(_,M,w).end(!0)}),e._moduleManager.setNotReadyReason(We.LOGIN_FAILED),V.error("".concat(e._className,".login failed. error:"),_),e._lastLoginTs=0,e._moduleManager.onLoginFailed(),Le(_)})}},{key:"logout",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(!this.isLoggedIn())return Le({code:We.USER_NOT_LOGGED_IN,message:at.USER_NOT_LOGGED_IN});var l=new ht(yt.LOGOUT);return l.setNetworkType(this.getNetworkType()).setMessage("identifier:".concat(this.getMyUserID())).end(!0),V.info("".concat(this._className,".logout type:").concat(n)),n===0&&this._moduleManager.setNotReadyReason(We.LOGGED_OUT),this.request({protocolName:JT,requestData:{type:n}}).then(function(){return e.resetReady(),En({})}).catch(function(h){return V.error("".concat(e._className,"._logout error:"),h),e.resetReady(),En({})})}},{key:"_fetchCloudControlConfig",value:function(){this.getModule(hy).fetchConfig()}},{key:"_hello",value:function(){var e=this;this._lastWsHelloTs=Date.now(),this.request({protocolName:Jm}).catch(function(n){V.warn("".concat(e._className,"._hello error:"),n)})}},{key:"getLastWsHelloTs",value:function(){return this._lastWsHelloTs}},{key:"_checkLoginInfo",value:function(e){var n=0,l="";return Mt(this.getModule(ir).getSDKAppID())?(n=We.NO_SDKAPPID,l=at.NO_SDKAPPID):Mt(e.userID)?(n=We.NO_IDENTIFIER,l=at.NO_IDENTIFIER):Mt(e.userSig)&&(n=We.NO_USERSIG,l=at.NO_USERSIG),{code:n,message:l}}},{key:"onMultipleAccountKickedOut",value:function(e){var n=this;new ht(yt.KICKED_OUT).setNetworkType(this.getNetworkType()).setMessage("type:".concat(Z.KICKED_OUT_MULT_ACCOUNT," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),V.warn("".concat(this._className,".onMultipleAccountKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then(function(){n.emitOuterEvent(mn.KICKED_OUT,{type:Z.KICKED_OUT_MULT_ACCOUNT}),n._moduleManager.setNotReadyReason(We.KICKED_OUT_MULT_ACCOUNT),n._moduleManager.reset()})}},{key:"onMultipleDeviceKickedOut",value:function(e){var n=this;new ht(yt.KICKED_OUT).setNetworkType(this.getNetworkType()).setMessage("type:".concat(Z.KICKED_OUT_MULT_DEVICE," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),V.warn("".concat(this._className,".onMultipleDeviceKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then(function(){n.emitOuterEvent(mn.KICKED_OUT,{type:Z.KICKED_OUT_MULT_DEVICE}),n._moduleManager.setNotReadyReason(We.KICKED_OUT_MULT_DEVICE),n._moduleManager.reset()})}},{key:"onUserSigExpired",value:function(){new ht(yt.KICKED_OUT).setNetworkType(this.getNetworkType()).setMessage(Z.KICKED_OUT_USERSIG_EXPIRED).end(!0),V.warn("".concat(this._className,".onUserSigExpired: userSig \u7B7E\u540D\u8FC7\u671F\u88AB\u8E22\u4E0B\u7EBF")),this.getModule(ir).getStatusInstanceID()!==0&&(this.emitOuterEvent(mn.KICKED_OUT,{type:Z.KICKED_OUT_USERSIG_EXPIRED}),this._moduleManager.setNotReadyReason(We.KICKED_OUT_USERSIG_EXPIRED),this._moduleManager.reset())}},{key:"onRestApiKickedOut",value:function(e){new ht(yt.KICKED_OUT).setNetworkType(this.getNetworkType()).setMessage("type:".concat(Z.KICKED_OUT_REST_API," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),V.warn("".concat(this._className,".onRestApiKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.getModule(ir).getStatusInstanceID()!==0&&(this.emitOuterEvent(mn.KICKED_OUT,{type:Z.KICKED_OUT_REST_API}),this._moduleManager.setNotReadyReason(We.KICKED_OUT_REST_API),this._moduleManager.reset(),this.getModule(uo).onRestApiKickedOut())}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),this.resetReady(),this._helloInterval=120,this._lastLoginTs=0,this._lastWsHelloTs=0}}]),o}(Ti),TR=Yn.f;function tS(){return null}sn({target:"Object",stat:!0,forced:Object.defineProperty!==TR,sham:!Et},{defineProperty:TR});var yE=function(){function a(t){A(this,a),this._moduleManager=t,this._className="StorageModule",this._storageQueue=new Map,this._errorTolerantHandle()}return x(a,[{key:"_errorTolerantHandle",value:function(){tn||!Ke(window)&&!Ke(window.localStorage)||(this.getItem=tS,this.setItem=tS,this.removeItem=tS,this.clear=tS)}},{key:"onCheckTimer",value:function(t){if(t%20==0){if(this._storageQueue.size===0)return;this._doFlush()}}},{key:"_doFlush",value:function(){try{var t,o=De(this._storageQueue);try{for(o.s();!(t=o.n()).done;){var e=Ue(t.value,2),n=e[0],l=e[1];this._setStorageSync(this._getKey(n),l)}}catch(h){o.e(h)}finally{o.f()}this._storageQueue.clear()}catch(h){V.warn("".concat(this._className,"._doFlush error:"),h)}}},{key:"_getPrefix",value:function(){var t=this._moduleManager.getModule(ir);return"TIM_".concat(t.getSDKAppID(),"_").concat(t.getUserID(),"_")}},{key:"_getKey",value:function(t){return"".concat(this._getPrefix()).concat(t)}},{key:"getItem",value:function(t){var o=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];try{var e=o?this._getKey(t):t;return this.getStorageSync(e)}catch(n){return V.warn("".concat(this._className,".getItem error:"),n),{}}}},{key:"setItem",value:function(t,o){var e=arguments.length>2&&arguments[2]!==void 0&&arguments[2],n=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];if(e){var l=n?this._getKey(t):t;this._setStorageSync(l,o)}else this._storageQueue.set(t,o)}},{key:"clear",value:function(){try{tn?Rn.clearStorageSync():localStorage&&localStorage.clear()}catch(t){V.warn("".concat(this._className,".clear error:"),t)}}},{key:"removeItem",value:function(t){var o=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];try{var e=o?this._getKey(t):t;this._removeStorageSync(e)}catch(n){V.warn("".concat(this._className,".removeItem error:"),n)}}},{key:"getSize",value:function(t){var o=this,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"b";try{var n={size:0,limitSize:5242880,unit:e};if(Object.defineProperty(n,"leftSize",{enumerable:!0,get:function(){return n.limitSize-n.size}}),tn&&(n.limitSize=1024*Rn.getStorageInfoSync().limitSize),t)n.size=JSON.stringify(this.getItem(t)).length+this._getKey(t).length;else if(tn){var l=Rn.getStorageInfoSync(),h=l.keys;h.forEach(function(S){n.size+=JSON.stringify(o.getStorageSync(S)).length+o._getKey(S).length})}else if(localStorage)for(var _ in localStorage)localStorage.hasOwnProperty(_)&&(n.size+=localStorage.getItem(_).length+_.length);return this._convertUnit(n)}catch(S){V.warn("".concat(this._className," error:"),S)}}},{key:"_convertUnit",value:function(t){var o={},e=t.unit;for(var n in o.unit=e,t)typeof t[n]=="number"&&(e.toLowerCase()==="kb"?o[n]=Math.round(t[n]/1024):e.toLowerCase()==="mb"?o[n]=Math.round(t[n]/1024/1024):o[n]=t[n]);return o}},{key:"_setStorageSync",value:function(t,o){tn?Xt?my.setStorageSync({key:t,data:o}):Rn.setStorageSync(t,o):localStorage&&localStorage.setItem(t,JSON.stringify(o))}},{key:"getStorageSync",value:function(t){return tn?Xt?my.getStorageSync({key:t}).data:Rn.getStorageSync(t):localStorage?JSON.parse(localStorage.getItem(t)):{}}},{key:"_removeStorageSync",value:function(t){tn?Xt?my.removeStorageSync({key:t}):Rn.removeStorageSync(t):localStorage&&localStorage.removeItem(t)}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),this._doFlush()}}]),a}(),xA=function(){function a(t){A(this,a),this._className="SSOLogBody",this._report=[]}return x(a,[{key:"pushIn",value:function(t){V.debug("".concat(this._className,".pushIn"),this._report.length,t),this._report.push(t)}},{key:"backfill",value:function(t){var o;Yt(t)&&t.length!==0&&(V.debug("".concat(this._className,".backfill"),this._report.length,t.length),(o=this._report).unshift.apply(o,Be(t)))}},{key:"getLogsNumInMemory",value:function(){return this._report.length}},{key:"isEmpty",value:function(){return this._report.length===0}},{key:"_reset",value:function(){this._report.length=0,this._report=[]}},{key:"getLogsInMemory",value:function(){var t=this._report.slice();return this._reset(),t}}]),a}(),SE=function(a){var t=a.getModule(ir);return{SDKType:10,SDKAppID:t.getSDKAppID(),SDKVersion:t.getVersion(),tinyID:Number(t.getTinyID()),userID:t.getUserID(),platform:a.getPlatform(),instanceID:t.getInstanceID(),traceID:Ji()}},UA=function(a){B(o,a);var t=Xe(o);function o(e){var n;A(this,o),(n=t.call(this,e))._className="EventStatModule",n.TAG="im-ssolog-event",n._reportBody=new xA,n.MIN_THRESHOLD=20,n.MAX_THRESHOLD=100,n.WAITING_TIME=6e4,n.REPORT_LEVEL=[4,5,6],n.REPORT_SDKAPPID_BLACKLIST=[],n.REPORT_TINYID_WHITELIST=[],n._lastReportTime=Date.now();var l=n.getInnerEmitterInstance();return l.on(gs,n._onLoginSuccess,Ae(n)),l.on(ji,n._onCloudConfigUpdated,Ae(n)),n}return x(o,[{key:"reportAtOnce",value:function(){V.debug("".concat(this._className,".reportAtOnce")),this._report()}},{key:"_onLoginSuccess",value:function(){var e=this,n=this.getModule(ds),l=n.getItem(this.TAG,!1);!Mt(l)&&Fc(l.forEach)&&(V.log("".concat(this._className,"._onLoginSuccess get ssolog in storage, count:").concat(l.length)),l.forEach(function(h){e._reportBody.pushIn(h)}),n.removeItem(this.TAG,!1))}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("evt_rpt_threshold"),n=this.getCloudConfig("evt_rpt_waiting"),l=this.getCloudConfig("evt_rpt_level"),h=this.getCloudConfig("evt_rpt_sdkappid_bl"),_=this.getCloudConfig("evt_rpt_tinyid_wl");Ke(e)||(this.MIN_THRESHOLD=Number(e)),Ke(n)||(this.WAITING_TIME=Number(n)),Ke(l)||(this.REPORT_LEVEL=l.split(",").map(function(S){return Number(S)})),Ke(h)||(this.REPORT_SDKAPPID_BLACKLIST=h.split(",").map(function(S){return Number(S)})),Ke(_)||(this.REPORT_TINYID_WHITELIST=_.split(","))}},{key:"pushIn",value:function(e){e instanceof ht&&(e.updateTimeStamp(),this._reportBody.pushIn(e),this._reportBody.getLogsNumInMemory()>=this.MIN_THRESHOLD&&this._report())}},{key:"onCheckTimer",value:function(){Date.now()<this._lastReportTime+this.WAITING_TIME||this._reportBody.isEmpty()||this._report()}},{key:"_filterLogs",value:function(e){var n=this,l=this.getModule(ir),h=l.getSDKAppID(),_=l.getTinyID();return z0(this.REPORT_SDKAPPID_BLACKLIST,h)&&!iy(this.REPORT_TINYID_WHITELIST,_)?[]:e.filter(function(S){return n.REPORT_LEVEL.includes(S.level)})}},{key:"_report",value:function(){var e=this;if(!this._reportBody.isEmpty()){var n=this._reportBody.getLogsInMemory(),l=this._filterLogs(n);if(l.length!==0){var h={header:SE(this),event:l};this.request({protocolName:Wu,requestData:m({},h)}).then(function(){e._lastReportTime=Date.now()}).catch(function(_){V.warn("".concat(e._className,".report failed. networkType:").concat(e.getNetworkType()," error:"),_),e._reportBody.backfill(n),e._reportBody.getLogsNumInMemory()>e.MAX_THRESHOLD&&e._flushAtOnce()})}else this._lastReportTime=Date.now()}}},{key:"_flushAtOnce",value:function(){var e=this.getModule(ds),n=e.getItem(this.TAG,!1),l=this._reportBody.getLogsInMemory();if(Mt(n))V.log("".concat(this._className,"._flushAtOnce count:").concat(l.length)),e.setItem(this.TAG,l,!0,!1);else{var h=l.concat(n);h.length>this.MAX_THRESHOLD&&(h=h.slice(0,this.MAX_THRESHOLD)),V.log("".concat(this._className,"._flushAtOnce count:").concat(h.length)),e.setItem(this.TAG,h,!0,!1)}}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),this._lastReportTime=0,this._report(),this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[]}}]),o}(Ti),Jc="none",yv="online",GA=[We.OVER_FREQUENCY_LIMIT,We.OPEN_SERVICE_OVERLOAD_ERROR],MR=function(){function a(t){A(this,a),this._moduleManager=t,this._networkType="",this._className="NetMonitorModule",this.MAX_WAIT_TIME=3e3,this._mpNetworkStatusCallback=null,this._webOnlineCallback=null,this._webOfflineCallback=null}return x(a,[{key:"start",value:function(){var t=this;tn?(Rn.getNetworkType({success:function(o){t._networkType=o.networkType,o.networkType===Jc?V.warn("".concat(t._className,".start no network, please check!")):V.info("".concat(t._className,".start networkType:").concat(o.networkType))}}),this._mpNetworkStatusCallback=this._onNetworkStatusChange.bind(this),Rn.onNetworkStatusChange(this._mpNetworkStatusCallback)):(this._networkType=yv,this._webOnlineCallback=this._onWebOnline.bind(this),this._webOfflineCallback=this._onWebOffline.bind(this),window&&(window.addEventListener("online",this._webOnlineCallback),window.addEventListener("offline",this._webOfflineCallback)))}},{key:"_onWebOnline",value:function(){this._onNetworkStatusChange({isConnected:!0,networkType:yv})}},{key:"_onWebOffline",value:function(){this._onNetworkStatusChange({isConnected:!1,networkType:Jc})}},{key:"_onNetworkStatusChange",value:function(t){var o=t.isConnected,e=t.networkType,n=!1;o?(V.info("".concat(this._className,"._onNetworkStatusChange previousNetworkType:").concat(this._networkType," currentNetworkType:").concat(e)),this._networkType!==e&&(n=!0,this._moduleManager.getModule(uo).reConnect(!0))):this._networkType!==e&&(n=!0,V.warn("".concat(this._className,"._onNetworkStatusChange no network, please check!")),this._moduleManager.getModule(uo).offline()),n&&(new ht(yt.NETWORK_CHANGE).setMessage("isConnected:".concat(o," previousNetworkType:").concat(this._networkType," networkType:").concat(e)).end(),this._networkType=e)}},{key:"probe",value:function(t){var o=this;return!Ke(t)&&GA.includes(t.code)?Promise.resolve([!0,this._networkType]):new Promise(function(e,n){if(tn)Rn.getNetworkType({success:function(_){o._networkType=_.networkType,_.networkType===Jc?(V.warn("".concat(o._className,".probe no network, please check!")),e([!1,_.networkType])):(V.info("".concat(o._className,".probe networkType:").concat(_.networkType)),e([!0,_.networkType]))}});else if(window&&window.fetch)fetch("".concat(VT(),"//web.sdk.qcloud.com/im/assets/speed.xml?random=").concat(Math.random())).then(function(_){_.ok?e([!0,yv]):e([!1,Jc])}).catch(function(_){e([!1,Jc])});else{var l=new XMLHttpRequest,h=setTimeout(function(){V.warn("".concat(o._className,".probe fetch timeout. Probably no network, please check!")),l.abort(),o._networkType=Jc,e([!1,Jc])},o.MAX_WAIT_TIME);l.onreadystatechange=function(){l.readyState===4&&(clearTimeout(h),l.status===200||l.status===304||l.status===514?(this._networkType=yv,e([!0,yv])):(V.warn("".concat(this.className,".probe fetch status:").concat(l.status,". Probably no network, please check!")),this._networkType=Jc,e([!1,Jc])))},l.open("GET","".concat(VT(),"//web.sdk.qcloud.com/im/assets/speed.xml?random=").concat(Math.random())),l.send()}})}},{key:"getNetworkType",value:function(){return this._networkType}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),tn?this._mpNetworkStatusCallback!==null&&(Rn.offNetworkStatusChange&&(tr||Di?Rn.offNetworkStatusChange(this._mpNetworkStatusCallback):Rn.offNetworkStatusChange()),this._mpNetworkStatusCallback=null):window&&(this._webOnlineCallback!==null&&(window.removeEventListener("online",this._webOnlineCallback),this._webOnlineCallback=null),this._onWebOffline!==null&&(window.removeEventListener("offline",this._webOfflineCallback),this._webOfflineCallback=null))}}]),a}(),RR=vt(function(a){var t=Object.prototype.hasOwnProperty,o="~";function e(){}function n(S,E,M){this.fn=S,this.context=E,this.once=M||!1}function l(S,E,M,w,L){if(typeof M!="function")throw new TypeError("The listener must be a function");var H=new n(M,w||S,L),ne=o?o+E:E;return S._events[ne]?S._events[ne].fn?S._events[ne]=[S._events[ne],H]:S._events[ne].push(H):(S._events[ne]=H,S._eventsCount++),S}function h(S,E){--S._eventsCount==0?S._events=new e:delete S._events[E]}function _(){this._events=new e,this._eventsCount=0}Object.create&&(e.prototype=Object.create(null),new e().__proto__||(o=!1)),_.prototype.eventNames=function(){var S,E,M=[];if(this._eventsCount===0)return M;for(E in S=this._events)t.call(S,E)&&M.push(o?E.slice(1):E);return Object.getOwnPropertySymbols?M.concat(Object.getOwnPropertySymbols(S)):M},_.prototype.listeners=function(S){var E=o?o+S:S,M=this._events[E];if(!M)return[];if(M.fn)return[M.fn];for(var w=0,L=M.length,H=new Array(L);w<L;w++)H[w]=M[w].fn;return H},_.prototype.listenerCount=function(S){var E=o?o+S:S,M=this._events[E];return M?M.fn?1:M.length:0},_.prototype.emit=function(S,E,M,w,L,H){var ne=o?o+S:S;if(!this._events[ne])return!1;var ae,he,ge=this._events[ne],Te=arguments.length;if(ge.fn){switch(ge.once&&this.removeListener(S,ge.fn,void 0,!0),Te){case 1:return ge.fn.call(ge.context),!0;case 2:return ge.fn.call(ge.context,E),!0;case 3:return ge.fn.call(ge.context,E,M),!0;case 4:return ge.fn.call(ge.context,E,M,w),!0;case 5:return ge.fn.call(ge.context,E,M,w,L),!0;case 6:return ge.fn.call(ge.context,E,M,w,L,H),!0}for(he=1,ae=new Array(Te-1);he<Te;he++)ae[he-1]=arguments[he];ge.fn.apply(ge.context,ae)}else{var Ze,Ct=ge.length;for(he=0;he<Ct;he++)switch(ge[he].once&&this.removeListener(S,ge[he].fn,void 0,!0),Te){case 1:ge[he].fn.call(ge[he].context);break;case 2:ge[he].fn.call(ge[he].context,E);break;case 3:ge[he].fn.call(ge[he].context,E,M);break;case 4:ge[he].fn.call(ge[he].context,E,M,w);break;default:if(!ae)for(Ze=1,ae=new Array(Te-1);Ze<Te;Ze++)ae[Ze-1]=arguments[Ze];ge[he].fn.apply(ge[he].context,ae)}}return!0},_.prototype.on=function(S,E,M){return l(this,S,E,M,!1)},_.prototype.once=function(S,E,M){return l(this,S,E,M,!0)},_.prototype.removeListener=function(S,E,M,w){var L=o?o+S:S;if(!this._events[L])return this;if(!E)return h(this,L),this;var H=this._events[L];if(H.fn)H.fn!==E||w&&!H.once||M&&H.context!==M||h(this,L);else{for(var ne=0,ae=[],he=H.length;ne<he;ne++)(H[ne].fn!==E||w&&!H[ne].once||M&&H[ne].context!==M)&&ae.push(H[ne]);ae.length?this._events[L]=ae.length===1?ae[0]:ae:h(this,L)}return this},_.prototype.removeAllListeners=function(S){var E;return S?(E=o?o+S:S,this._events[E]&&h(this,E)):(this._events=new e,this._eventsCount=0),this},_.prototype.off=_.prototype.removeListener,_.prototype.addListener=_.prototype.on,_.prefixed=o,_.EventEmitter=_,a.exports=_}),FA=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this,e))._className="BigDataChannelModule",n.FILETYPE={SOUND:2106,FILE:2107,VIDEO:2113},n._bdh_download_server="grouptalk.c2c.qq.com",n._BDHBizID=10001,n._authKey="",n._expireTime=0,n.getInnerEmitterInstance().on(gs,n._getAuthKey,Ae(n)),n}return x(o,[{key:"_getAuthKey",value:function(){var e=this;this.request({protocolName:QT}).then(function(n){n.data.authKey&&(e._authKey=n.data.authKey,e._expireTime=parseInt(n.data.expireTime))})}},{key:"_isFromOlderVersion",value:function(e){return!(!e.content||e.content.downloadFlag===2)}},{key:"parseElements",value:function(e,n){if(!Yt(e)||!n)return[];for(var l=[],h=null,_=0;_<e.length;_++)h=e[_],this._needParse(h)?l.push(this._parseElement(h,n)):l.push(e[_]);return l}},{key:"_needParse",value:function(e){return!e.cloudCustomData&&!(!this._isFromOlderVersion(e)||e.type!==Z.MSG_AUDIO&&e.type!==Z.MSG_FILE&&e.type!==Z.MSG_VIDEO)}},{key:"_parseElement",value:function(e,n){switch(e.type){case Z.MSG_AUDIO:return this._parseAudioElement(e,n);case Z.MSG_FILE:return this._parseFileElement(e,n);case Z.MSG_VIDEO:return this._parseVideoElement(e,n)}}},{key:"_parseAudioElement",value:function(e,n){return e.content.url=this._genAudioUrl(e.content.uuid,n),e}},{key:"_parseFileElement",value:function(e,n){return e.content.url=this._genFileUrl(e.content.uuid,n,e.content.fileName),e}},{key:"_parseVideoElement",value:function(e,n){return e.content.url=this._genVideoUrl(e.content.uuid,n),e}},{key:"_genAudioUrl",value:function(e,n){if(this._authKey==="")return V.warn("".concat(this._className,"._genAudioUrl no authKey!")),"";var l=this.getModule(ir).getSDKAppID();return"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(l,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.SOUND,"&openid=").concat(n,"&ver=0")}},{key:"_genFileUrl",value:function(e,n,l){if(this._authKey==="")return V.warn("".concat(this._className,"._genFileUrl no authKey!")),"";l||(l="".concat(Math.floor(1e5*Math.random()),"-").concat(Date.now()));var h=this.getModule(ir).getSDKAppID();return"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(h,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.FILE,"&openid=").concat(n,"&ver=0&filename=").concat(encodeURIComponent(l))}},{key:"_genVideoUrl",value:function(e,n){if(this._authKey==="")return V.warn("".concat(this._className,"._genVideoUrl no authKey!")),"";var l=this.getModule(ir).getSDKAppID();return"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(l,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.VIDEO,"&openid=").concat(n,"&ver=0")}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),this._authKey="",this.expireTime=0}}]),o}(Ti),VA=["requestSnapshotUrl"],BA=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this,e))._className="UploadModule",n.TIMUploadPlugin=null,n.timUploadPlugin=null,n.COSSDK=null,n._cosUploadMethod=null,n.expiredTimeLimit=600,n.appid=0,n.bucketName="",n.ciUrl="",n.directory="",n.downloadUrl="",n.uploadUrl="",n.region="ap-shanghai",n.cos=null,n.cosOptions={secretId:"",secretKey:"",sessionToken:"",expiredTime:0},n.uploadFileType="",n.duration=900,n.tryCount=0,n.getInnerEmitterInstance().on(gs,n._init,Ae(n)),n}return x(o,[{key:"_init",value:function(){var e="".concat(this._className,"._init"),n=this.getModule(sI);if(this.TIMUploadPlugin=n.getPlugin("tim-upload-plugin"),this.TIMUploadPlugin)this._initUploaderMethod();else{var l=tn?"cos-wx-sdk":"cos-js-sdk";this.COSSDK=n.getPlugin(l),this.COSSDK?(this._getAuthorizationKey(),V.warn("".concat(e," v2.9.2\u8D77\u63A8\u8350\u4F7F\u7528 tim-upload-plugin \u4EE3\u66FF ").concat(l,"\uFF0C\u4E0A\u4F20\u66F4\u5FEB\u66F4\u5B89\u5168\u3002\u8BE6\u7EC6\u8BF7\u53C2\u8003 https://web.sdk.qcloud.com/im/doc/zh-cn/SDK.html#registerPlugin"))):V.warn("".concat(e," \u6CA1\u6709\u68C0\u6D4B\u5230\u4E0A\u4F20\u63D2\u4EF6\uFF0C\u5C06\u65E0\u6CD5\u53D1\u9001\u56FE\u7247\u3001\u97F3\u9891\u3001\u89C6\u9891\u3001\u6587\u4EF6\u7B49\u7C7B\u578B\u7684\u6D88\u606F\u3002\u8BE6\u7EC6\u8BF7\u53C2\u8003 https://web.sdk.qcloud.com/im/doc/zh-cn/SDK.html#registerPlugin"))}}},{key:"_getAuthorizationKey",value:function(){var e=this,n=new ht(yt.GET_COS_AUTH_KEY),l=Math.ceil(Date.now()/1e3);this.request({protocolName:Dh,requestData:{duration:this.expiredTimeLimit}}).then(function(h){var _=h.data;V.log("".concat(e._className,"._getAuthorizationKey ok. data:"),_);var S=_.expiredTime-l;n.setMessage("requestId:".concat(_.requestId," requestTime:").concat(l," expiredTime:").concat(_.expiredTime," diff:").concat(S,"s")).setNetworkType(e.getNetworkType()).end(),!tn&&_.region&&(e.region=_.region),e.appid=_.appid,e.bucketName=_.bucketName,e.ciUrl=_.ciUrl,e.directory=_.directory,e.downloadUrl=_.downloadUrl,e.uploadUrl=_.uploadUrl,e.cosOptions={secretId:_.secretId,secretKey:_.secretKey,sessionToken:_.sessionToken,expiredTime:_.expiredTime},V.log("".concat(e._className,"._getAuthorizationKey ok. region:").concat(e.region," bucketName:").concat(e.bucketName)),e._initUploaderMethod()}).catch(function(h){e.probeNetwork().then(function(_){var S=Ue(_,2),E=S[0],M=S[1];n.setError(h,E,M).end()}),V.warn("".concat(e._className,"._getAuthorizationKey failed. error:"),h)})}},{key:"_getCosPreSigUrl",value:function(e){var n=this,l="".concat(this._className,"._getCosPreSigUrl"),h=Math.ceil(Date.now()/1e3),_=new ht(yt.GET_COS_PRE_SIG_URL);return this.request({protocolName:My,requestData:{fileType:e.fileType,fileName:e.fileName,uploadMethod:e.uploadMethod,duration:e.duration}}).then(function(S){n.tryCount=0;var E=S.data||{},M=E.expiredTime-h;return V.log("".concat(l," ok. data:"),E),_.setMessage("requestId:".concat(E.requestId," expiredTime:").concat(E.expiredTime," diff:").concat(M,"s")).setNetworkType(n.getNetworkType()).end(),E}).catch(function(S){return S.code===-1&&(S.code=We.COS_GET_SIG_FAIL),n.probeNetwork().then(function(E){var M=Ue(E,2),w=M[0],L=M[1];_.setError(S,w,L).end()}),V.warn("".concat(l," failed. error:"),S),n.tryCount<1?(n.tryCount++,n._getCosPreSigUrl(e)):(n.tryCount=0,Le({code:We.COS_GET_SIG_FAIL,message:at.COS_GET_SIG_FAIL}))})}},{key:"_initUploaderMethod",value:function(){var e=this;if(this.TIMUploadPlugin)return this.timUploadPlugin=new this.TIMUploadPlugin,void(this._cosUploadMethod=function(n,l){e.timUploadPlugin.uploadFile(n,l)});this.appid&&(this.cos=tn?new this.COSSDK({ForcePathStyle:!0,getAuthorization:this._getAuthorization.bind(this)}):new this.COSSDK({getAuthorization:this._getAuthorization.bind(this)}),this._cosUploadMethod=tn?function(n,l){e.cos.postObject(n,l)}:function(n,l){e.cos.uploadFiles(n,l)})}},{key:"onCheckTimer",value:function(e){this.COSSDK&&(this.TIMUploadPlugin||this.isLoggedIn()&&e%60==0&&Math.ceil(Date.now()/1e3)>=this.cosOptions.expiredTime-120&&this._getAuthorizationKey())}},{key:"_getAuthorization",value:function(e,n){n({TmpSecretId:this.cosOptions.secretId,TmpSecretKey:this.cosOptions.secretKey,XCosSecurityToken:this.cosOptions.sessionToken,ExpiredTime:this.cosOptions.expiredTime})}},{key:"upload",value:function(e){if(e.getRelayFlag()===!0)return Promise.resolve();var n=this.getModule(Ur);switch(e.type){case Z.MSG_IMAGE:return n.addTotalCount(qo),this._uploadImage(e);case Z.MSG_FILE:return n.addTotalCount(qo),this._uploadFile(e);case Z.MSG_AUDIO:return n.addTotalCount(qo),this._uploadAudio(e);case Z.MSG_VIDEO:return n.addTotalCount(qo),this._uploadVideo(e);default:return Promise.resolve()}}},{key:"_uploadImage",value:function(e){var n=this,l=this.getModule(fi),h=e.getElements()[0],_=l.getMessageOption(e.clientSequence);return this.doUploadImage({file:_.payload.file,to:_.to,onProgress:function(S){if(h.updatePercent(S),Fc(_.onProgress))try{_.onProgress(S)}catch{return Le({code:We.MESSAGE_ONPROGRESS_FUNCTION_ERROR,message:at.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then(function(S){var E=S.location,M=S.fileType,w=S.fileSize,L=S.width,H=S.height,ne=n.isPrivateNetWork()?E:yh(E);h.updateImageFormat(M);var ae=ry({originUrl:ne,originWidth:L,originHeight:H,min:198}),he=ry({originUrl:ne,originWidth:L,originHeight:H,min:720});return h.updateImageInfoArray([{size:w,url:ne,width:L,height:H},m({},he),m({},ae)]),e})}},{key:"_uploadFile",value:function(e){var n=this,l=this.getModule(fi),h=e.getElements()[0],_=l.getMessageOption(e.clientSequence);return this.doUploadFile({file:_.payload.file,to:_.to,onProgress:function(S){if(h.updatePercent(S),Fc(_.onProgress))try{_.onProgress(S)}catch{return Le({code:We.MESSAGE_ONPROGRESS_FUNCTION_ERROR,message:at.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then(function(S){var E=S.location,M=n.isPrivateNetWork()?E:yh(E);return h.updateFileUrl(M),e})}},{key:"_uploadAudio",value:function(e){var n=this,l=this.getModule(fi),h=e.getElements()[0],_=l.getMessageOption(e.clientSequence);return this.doUploadAudio({file:_.payload.file,to:_.to,onProgress:function(S){if(h.updatePercent(S),Fc(_.onProgress))try{_.onProgress(S)}catch{return Le({code:We.MESSAGE_ONPROGRESS_FUNCTION_ERROR,message:at.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then(function(S){var E=S.location,M=n.isPrivateNetWork()?E:yh(E);return h.updateAudioUrl(M),e})}},{key:"_uploadVideo",value:function(e){var n=this,l=this.getModule(fi),h=e.getElements()[0],_=l.getMessageOption(e.clientSequence);return this.doUploadVideo({file:_.payload.file,to:_.to,onProgress:function(S){if(h.updatePercent(S),Fc(_.onProgress))try{_.onProgress(S)}catch{return Le({code:We.MESSAGE_ONPROGRESS_FUNCTION_ERROR,message:at.MESSAGE_ONPROGRESS_FUNCTION_ERROR})}}}).then(function(S){var E=S.location,M=S.snapshotInfo,w=n.isPrivateNetWork()?E:yh(E);return h.updateVideoUrl(w),Mt(M)||h.updateSnapshotInfo(M),e})}},{key:"doUploadImage",value:function(e){var n=this;if(!e.file)return Le({code:We.MESSAGE_IMAGE_SELECT_FILE_FIRST,message:at.MESSAGE_IMAGE_SELECT_FILE_FIRST});var l=this._checkImageType(e.file);if(l!==!0)return l;var h=this._checkImageSize(e.file);if(h!==!0)return h;var _=null;return this._setUploadFileType(bA),this.uploadByCOS(e).then(function(S){return _=S,n.isPrivateNetWork()?K0(S.location):K0("https://".concat(S.location))}).then(function(S){return _.width=S.width,_.height=S.height,Promise.resolve(_)})}},{key:"_checkImageType",value:function(e){var n="";return n=tn?e.url.slice(e.url.lastIndexOf(".")+1):e.files[0].name.slice(e.files[0].name.lastIndexOf(".")+1),Xu.indexOf(n.toLowerCase())>=0||Le({code:We.MESSAGE_IMAGE_TYPES_LIMIT,message:at.MESSAGE_IMAGE_TYPES_LIMIT})}},{key:"_checkImageSize",value:function(e){var n=0;return(n=tn?e.size:e.files[0].size)===0?Le({code:We.MESSAGE_FILE_IS_EMPTY,message:"".concat(at.MESSAGE_FILE_IS_EMPTY)}):n<20971520||Le({code:We.MESSAGE_IMAGE_SIZE_LIMIT,message:"".concat(at.MESSAGE_IMAGE_SIZE_LIMIT)})}},{key:"doUploadFile",value:function(e){var n=null;return e.file?e.file.files[0].size>104857600?Le(n={code:We.MESSAGE_FILE_SIZE_LIMIT,message:at.MESSAGE_FILE_SIZE_LIMIT}):e.file.files[0].size===0?(n={code:We.MESSAGE_FILE_IS_EMPTY,message:"".concat(at.MESSAGE_FILE_IS_EMPTY)},Le(n)):(this._setUploadFileType(cE),this.uploadByCOS(e)):Le(n={code:We.MESSAGE_FILE_SELECT_FILE_FIRST,message:at.MESSAGE_FILE_SELECT_FILE_FIRST})}},{key:"doUploadVideo",value:function(e){return e.file.videoFile.size>104857600?Le({code:We.MESSAGE_VIDEO_SIZE_LIMIT,message:"".concat(at.MESSAGE_VIDEO_SIZE_LIMIT)}):e.file.videoFile.size===0?Le({code:We.MESSAGE_FILE_IS_EMPTY,message:"".concat(at.MESSAGE_FILE_IS_EMPTY)}):Qu.indexOf(e.file.videoFile.type)===-1?Le({code:We.MESSAGE_VIDEO_TYPES_LIMIT,message:"".concat(at.MESSAGE_VIDEO_TYPES_LIMIT)}):(this._setUploadFileType(mv),tn?this.handleVideoUpload({file:e.file.videoFile,onProgress:e.onProgress}):Xn?this.handleVideoUpload(e):void 0)}},{key:"handleVideoUpload",value:function(e){var n=this;return new Promise(function(l,h){n.uploadByCOS(e).then(function(_){l(_)}).catch(function(){n.uploadByCOS(e).then(function(_){l(_)}).catch(function(){h(new Me({code:We.MESSAGE_VIDEO_UPLOAD_FAIL,message:at.MESSAGE_VIDEO_UPLOAD_FAIL}))})})})}},{key:"doUploadAudio",value:function(e){return e.file?e.file.size>20971520?Le(new Me({code:We.MESSAGE_AUDIO_SIZE_LIMIT,message:"".concat(at.MESSAGE_AUDIO_SIZE_LIMIT)})):e.file.size===0?Le(new Me({code:We.MESSAGE_FILE_IS_EMPTY,message:"".concat(at.MESSAGE_FILE_IS_EMPTY)})):(this._setUploadFileType(sE),this.uploadByCOS(e)):Le(new Me({code:We.MESSAGE_AUDIO_UPLOAD_FAIL,message:at.MESSAGE_AUDIO_UPLOAD_FAIL}))}},{key:"uploadByCOS",value:function(e){var n=this,l="".concat(this._className,".uploadByCOS");if(!Fc(this._cosUploadMethod))return V.warn("".concat(l," \u6CA1\u6709\u68C0\u6D4B\u5230\u4E0A\u4F20\u63D2\u4EF6\uFF0C\u5C06\u65E0\u6CD5\u53D1\u9001\u56FE\u7247\u3001\u97F3\u9891\u3001\u89C6\u9891\u3001\u6587\u4EF6\u7B49\u7C7B\u578B\u7684\u6D88\u606F\u3002\u8BE6\u7EC6\u8BF7\u53C2\u8003 https://web.sdk.qcloud.com/im/doc/zh-cn/SDK.html#registerPlugin")),Le({code:We.COS_UNDETECTED,message:at.COS_UNDETECTED});if(this.timUploadPlugin)return this._uploadWithPreSigUrl(e);var h=new ht(yt.UPLOAD),_=Date.now(),S=this._getFile(e);return new Promise(function(E,M){var w=tn?n._createCosOptionsWXMiniApp(e):n._createCosOptionsWeb(e),L=n;n._cosUploadMethod(w,function(H,ne){var ae=Object.create(null);if(ne){if(H||Yt(ne.files)&&ne.files[0].error){var he=new Me({code:We.MESSAGE_FILE_UPLOAD_FAIL,message:at.MESSAGE_FILE_UPLOAD_FAIL});return h.setError(he,!0,n.getNetworkType()).end(),V.log("".concat(l," failed. error:"),ne.files[0].error),ne.files[0].error.statusCode===403&&(V.warn("".concat(l," failed. cos AccessKeyId was invalid, regain auth key!")),n._getAuthorizationKey()),void M(he)}ae.fileName=S.name,ae.fileSize=S.size,ae.fileType=S.type.slice(S.type.indexOf("/")+1).toLowerCase(),ae.location=tn?ne.Location:ne.files[0].data.Location;var ge=Date.now()-_,Te=L._formatFileSize(S.size),Ze=L._formatSpeed(1e3*S.size/ge),Ct="size:".concat(Te," time:").concat(ge,"ms speed:").concat(Ze);V.log("".concat(l," success. name:").concat(S.name," ").concat(Ct)),E(ae);var wt=n.getModule(Ur);return wt.addCost(qo,ge),wt.addFileSize(qo,S.size),void h.setNetworkType(n.getNetworkType()).setMessage(Ct).end()}var dn=new Me({code:We.MESSAGE_FILE_UPLOAD_FAIL,message:at.MESSAGE_FILE_UPLOAD_FAIL});h.setError(dn,!0,L.getNetworkType()).end(),V.warn("".concat(l," failed. error:"),H),H.statusCode===403&&(V.warn("".concat(l," failed. cos AccessKeyId was invalid, regain auth key!")),n._getAuthorizationKey()),M(dn)})})}},{key:"_uploadWithPreSigUrl",value:function(e){var n=this,l="".concat(this._className,"._uploadWithPreSigUrl"),h=this._getFile(e);return this._createCosOptionsPreSigUrl(e).then(function(_){return new Promise(function(S,E){var M=new ht(yt.UPLOAD),w=_.requestSnapshotUrl,L=w===void 0?void 0:w,H=se(_,VA),ne=Date.now();n._cosUploadMethod(H,function(ae,he){var ge=Object.create(null);if(ae||he.statusCode===403)return M.setError(new Me(ae),!0,n.getNetworkType()).end(),V.log("".concat(l," failed, error:"),ae),void E(new Me({code:We.MESSAGE_FILE_UPLOAD_FAIL,message:at.MESSAGE_FILE_UPLOAD_FAIL}));var Te=he.data.location||"";n.isPrivateNetWork()||Te.indexOf("https://")!==0&&Te.indexOf("http://")!==0||(Te=Te.split("//")[1]),ge.fileName=h.name,ge.fileSize=h.size,ge.fileType=h.type.slice(h.type.indexOf("/")+1).toLowerCase(),ge.location=Te;var Ze=Date.now()-ne,Ct=n._formatFileSize(h.size),wt=n._formatSpeed(1e3*h.size/Ze),dn="size:".concat(Ct,",time:").concat(Ze,"ms,speed:").concat(wt," res:").concat(JSON.stringify(he.data));V.log("".concat(l," success name:").concat(h.name,",").concat(dn)),M.setNetworkType(n.getNetworkType()).setMessage(dn).end();var $t=n.getModule(Ur);if($t.addCost(qo,Ze),$t.addFileSize(qo,h.size),!Mt(L))return n._getSnapshotInfoByUrl(L).then(function(Kn){ge.snapshotInfo=Kn,S(ge)});S(ge)})})})}},{key:"_getFile",value:function(e){var n;return Yt(e.file.files)||(n=e.file.files,jm(n)==="filelist")?e.file.files[0]:e.file}},{key:"_formatFileSize",value:function(e){return e<1024?e+"B":e<1048576?Math.floor(e/1024)+"KB":Math.floor(e/1048576)+"MB"}},{key:"_formatSpeed",value:function(e){return e<=1048576?xa(e/1024,1)+"KB/s":xa(e/1048576,1)+"MB/s"}},{key:"_createCosOptionsWeb",value:function(e){var n=this._getFile(e),l=n.name,h=l.slice(l.lastIndexOf(".")),_=this._genFileName("".concat(cs(999999)).concat(h));return{files:[{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(_),Body:n}],SliceSize:1048576,onProgress:function(S){if(typeof e.onProgress=="function")try{e.onProgress(S.percent)}catch(E){V.warn("onProgress callback error:",E)}},onFileFinish:function(S,E,M){}}}},{key:"_createCosOptionsWXMiniApp",value:function(e){var n=this._getFile(e),l=this._genFileName(n.name),h=n.url;return{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(l),FilePath:h,onProgress:function(_){if(V.log(JSON.stringify(_)),typeof e.onProgress=="function")try{e.onProgress(_.percent)}catch(S){V.warn("onProgress callback error:",S)}}}}},{key:"_createCosOptionsPreSigUrl",value:function(e){var n=this,l="",h="",_=0,S=this._getFile(e);if(tn)l=this._genFileName(S.name),h=S.url,_=1;else{var E=S.name,M=E.slice(E.lastIndexOf("."));l=this._genFileName("".concat(cs(999999)).concat(M)),h=S,_=0}return this._getCosPreSigUrl({fileType:this.uploadFileType,fileName:l,uploadMethod:_,duration:this.duration}).then(function(w){var L=w.uploadUrl,H=w.downloadUrl,ne=w.requestSnapshotUrl,ae=ne===void 0?void 0:ne;return{url:L,fileType:n.uploadFileType,fileName:l,resources:h,downloadUrl:H,requestSnapshotUrl:ae,onProgress:function(he){if(typeof e.onProgress=="function")try{e.onProgress(he.percent)}catch(ge){V.warn("onProgress callback error:",ge),V.error(ge)}}}})}},{key:"_genFileName",value:function(e){return"".concat(Sh(),"-").concat(e)}},{key:"_setUploadFileType",value:function(e){this.uploadFileType=e}},{key:"_getSnapshotInfoByUrl",value:function(e){var n=this,l=new ht(yt.GET_SNAPSHOT_INFO);return this.request({protocolName:Ga,requestData:{platform:this.getPlatform(),coverName:this._genFileName(cs(99999)),requestSnapshotUrl:e}}).then(function(h){var _=(h.data||{}).snapshotUrl;return l.setMessage("snapshotUrl:".concat(_)).end(),Mt(_)?{}:K0(_).then(function(S){return{snapshotUrl:_,snapshotWidth:S.width,snapshotHeight:S.height}})}).catch(function(h){return V.warn("".concat(n._className,"._getSnapshotInfoByUrl failed. error:"),h),l.setCode(h.errorCode).setMessage(h.errorInfo).end(),{}})}},{key:"reset",value:function(){V.log("".concat(this._className,".reset"))}}]),o}(Ti),CR=["downloadKey","pbDownloadKey","messageList"],bR=function(){function a(t){A(this,a),this._className="MergerMessageHandler",this._messageModule=t}return x(a,[{key:"uploadMergerMessage",value:function(t,o){var e=this;V.debug("".concat(this._className,".uploadMergerMessage message:"),t,"messageBytes:".concat(o));var n=t.payload.messageList,l=n.length,h=new ht(yt.UPLOAD_MERGER_MESSAGE);return this._messageModule.request({protocolName:mM,requestData:{messageList:n}}).then(function(_){V.debug("".concat(e._className,".uploadMergerMessage ok. response:"),_.data);var S=_.data,E=S.pbDownloadKey,M=S.downloadKey,w={pbDownloadKey:E,downloadKey:M,messageNumber:l};return h.setNetworkType(e._messageModule.getNetworkType()).setMessage("".concat(l,"-").concat(o,"-").concat(M)).end(),w}).catch(function(_){throw V.warn("".concat(e._className,".uploadMergerMessage failed. error:"),_),e._messageModule.probeNetwork().then(function(S){var E=Ue(S,2),M=E[0],w=E[1];h.setError(_,M,w).end()}),_})}},{key:"downloadMergerMessage",value:function(t){var o=this;V.debug("".concat(this._className,".downloadMergerMessage message:"),t);var e=t.payload.downloadKey,n=new ht(yt.DOWNLOAD_MERGER_MESSAGE);return n.setMessage("downloadKey:".concat(e)),this._messageModule.request({protocolName:vM,requestData:{downloadKey:e}}).then(function(l){if(V.debug("".concat(o._className,".downloadMergerMessage ok. response:"),l.data),Fc(t.clearElement)){var h=t.payload,_=(h.downloadKey,h.pbDownloadKey,h.messageList,se(h,CR));t.clearElement(),t.setElement({type:t.type,content:m({messageList:l.data.messageList},_)})}else{var S=[];l.data.messageList.forEach(function(E){if(!Mt(E)){var M=new Ky(E);S.push(M)}}),t.payload.messageList=S,t.payload.downloadKey="",t.payload.pbDownloadKey=""}return n.setNetworkType(o._messageModule.getNetworkType()).end(),t}).catch(function(l){throw V.warn("".concat(o._className,".downloadMergerMessage failed. key:").concat(e," error:"),l),o._messageModule.probeNetwork().then(function(h){var _=Ue(h,2),S=_[0],E=_[1];n.setError(l,S,E).end()}),l})}},{key:"createMergerMessagePack",value:function(t,o,e){return t.conversationType===Z.CONV_C2C?this._createC2CMergerMessagePack(t,o,e):this._createGroupMergerMessagePack(t,o,e)}},{key:"_createC2CMergerMessagePack",value:function(t,o,e){var n=null;o&&(o.offlinePushInfo&&(n=o.offlinePushInfo),o.onlineUserOnly===!0&&(n?n.disablePush=!0:n={disablePush:!0}));var l="";Ln(t.cloudCustomData)&&t.cloudCustomData.length>0&&(l=t.cloudCustomData);var h=e.pbDownloadKey,_=e.downloadKey,S=e.messageNumber,E=t.payload,M=E.title,w=E.abstractList,L=E.compatibleText,H=this._messageModule.getModule(Vi);return{protocolName:fy,tjgID:this._messageModule.generateTjgID(t),requestData:{fromAccount:this._messageModule.getMyUserID(),toAccount:t.to,msgBody:[{msgType:t.type,msgContent:{pbDownloadKey:h,downloadKey:_,title:M,abstractList:w,compatibleText:L,messageNumber:S}}],cloudCustomData:l,clientTime:t.clientTime,msgSeq:t.sequence,msgRandom:t.random,msgLifeTime:H&&H.isOnlineMessage(t,o)?0:void 0,offlinePushInfo:n?{pushFlag:n.disablePush===!0?1:0,title:n.title||"",desc:n.description||"",ext:n.extension||"",apnsInfo:{badgeMode:n.ignoreIOSBadge===!0?1:0},androidInfo:{OPPOChannelID:n.androidOPPOChannelID||""}}:void 0}}}},{key:"_createGroupMergerMessagePack",value:function(t,o,e){var n=null;o&&o.offlinePushInfo&&(n=o.offlinePushInfo);var l="";Ln(t.cloudCustomData)&&t.cloudCustomData.length>0&&(l=t.cloudCustomData);var h=e.pbDownloadKey,_=e.downloadKey,S=e.messageNumber,E=t.payload,M=E.title,w=E.abstractList,L=E.compatibleText,H=this._messageModule.getModule(pn);return{protocolName:cI,tjgID:this._messageModule.generateTjgID(t),requestData:{fromAccount:this._messageModule.getMyUserID(),groupID:t.to,msgBody:[{msgType:t.type,msgContent:{pbDownloadKey:h,downloadKey:_,title:M,abstractList:w,compatibleText:L,messageNumber:S}}],random:t.random,priority:t.priority,clientSequence:t.clientSequence,groupAtInfo:void 0,cloudCustomData:l,onlineOnlyFlag:H&&H.isOnlineMessage(t,o)?1:0,offlinePushInfo:n?{pushFlag:n.disablePush===!0?1:0,title:n.title||"",desc:n.description||"",ext:n.extension||"",apnsInfo:{badgeMode:n.ignoreIOSBadge===!0?1:0},androidInfo:{OPPOChannelID:n.androidOPPOChannelID||""}}:void 0,clientTime:t.clientTime,needReadReceipt:t.needReadReceipt!==!0||H.isMessageFromOrToAVChatroom(t.to)?0:1}}}}]),a}(),IE={ERR_SVR_COMM_SENSITIVE_TEXT:80001,ERR_SVR_COMM_BODY_SIZE_LIMIT:80002,OPEN_SERVICE_OVERLOAD_ERROR:60022,ERR_SVR_MSG_PKG_PARSE_FAILED:20001,ERR_SVR_MSG_INTERNAL_AUTH_FAILED:20002,ERR_SVR_MSG_INVALID_ID:20003,ERR_SVR_MSG_PUSH_DENY:20006,ERR_SVR_MSG_IN_PEER_BLACKLIST:20007,ERR_SVR_MSG_BOTH_NOT_FRIEND:20009,ERR_SVR_MSG_NOT_PEER_FRIEND:20010,ERR_SVR_MSG_NOT_SELF_FRIEND:20011,ERR_SVR_MSG_SHUTUP_DENY:20012,ERR_SVR_GROUP_INVALID_PARAMETERS:10004,ERR_SVR_GROUP_PERMISSION_DENY:10007,ERR_SVR_GROUP_NOT_FOUND:10010,ERR_SVR_GROUP_INVALID_GROUPID:10015,ERR_SVR_GROUP_REJECT_FROM_THIRDPARTY:10016,ERR_SVR_GROUP_SHUTUP_DENY:10017,MESSAGE_SEND_FAIL:2100,OVER_FREQUENCY_LIMIT:2996},Sv=[We.MESSAGE_ONPROGRESS_FUNCTION_ERROR,We.MESSAGE_IMAGE_SELECT_FILE_FIRST,We.MESSAGE_IMAGE_TYPES_LIMIT,We.MESSAGE_FILE_IS_EMPTY,We.MESSAGE_IMAGE_SIZE_LIMIT,We.MESSAGE_FILE_SELECT_FILE_FIRST,We.MESSAGE_FILE_SIZE_LIMIT,We.MESSAGE_VIDEO_SIZE_LIMIT,We.MESSAGE_VIDEO_TYPES_LIMIT,We.MESSAGE_AUDIO_UPLOAD_FAIL,We.MESSAGE_AUDIO_SIZE_LIMIT,We.COS_UNDETECTED],Fh,nS=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this,e))._className="MessageModule",n._messageOptionsMap=new Map,n._mergerMessageHandler=new bR(Ae(n)),n}return x(o,[{key:"createTextMessage",value:function(e){var n=this.getMyUserID();e.currentUser=n,e.senderTinyID=this.getMyTinyID();var l=new Bi(e),h=typeof e.payload=="string"?e.payload:e.payload.text,_=new UI({text:h}),S=this._getNickAndAvatarByUserID(n);return l.setElement(_),l.setNickAndAvatar(S),l.setNameCard(this._getNameCardByGroupID(l)),l}},{key:"createImageMessage",value:function(e){var n=this.getMyUserID();e.currentUser=n,e.senderTinyID=this.getMyTinyID();var l=new Bi(e);if(tn){var h=e.payload.file;if(Ks(h))return void V.warn("\u5C0F\u7A0B\u5E8F\u73AF\u5883\u4E0B\u8C03\u7528 createImageMessage \u63A5\u53E3\u65F6\uFF0Cpayload.file \u4E0D\u652F\u6301\u4F20\u5165 File \u5BF9\u8C61");var _=h.tempFilePaths[0],S={url:_,name:_.slice(_.lastIndexOf("/")+1),size:h.tempFiles&&h.tempFiles[0].size||1,type:_.slice(_.lastIndexOf(".")+1).toLowerCase()};e.payload.file=S}else if(Xn){if(Ks(e.payload.file)){var E=e.payload.file;e.payload.file={files:[E]}}else if(Br(e.payload.file)&&typeof uni<"u"){var M=e.payload.file.tempFiles[0];e.payload.file={files:[M]}}}var w=new jy({imageFormat:Gu.UNKNOWN,uuid:this._generateUUID(),file:e.payload.file}),L=this._getNickAndAvatarByUserID(n);return l.setElement(w),l.setNickAndAvatar(L),l.setNameCard(this._getNameCardByGroupID(l)),this._messageOptionsMap.set(l.clientSequence,e),l}},{key:"createAudioMessage",value:function(e){var n=e.payload.file;if(tn){var l={url:n.tempFilePath,name:n.tempFilePath.slice(n.tempFilePath.lastIndexOf("/")+1),size:n.fileSize,second:parseInt(n.duration)/1e3,type:n.tempFilePath.slice(n.tempFilePath.lastIndexOf(".")+1).toLowerCase()};e.payload.file=l}var h=this.getMyUserID();e.currentUser=h,e.senderTinyID=this.getMyTinyID();var _=new Bi(e),S=new kf({second:Math.floor(n.duration/1e3),size:n.fileSize||n.size,url:n.tempFilePath,uuid:this._generateUUID()}),E=this._getNickAndAvatarByUserID(h);return _.setElement(S),_.setNickAndAvatar(E),_.setNameCard(this._getNameCardByGroupID(_)),this._messageOptionsMap.set(_.clientSequence,e),_}},{key:"createVideoMessage",value:function(e){var n=this.getMyUserID();e.currentUser=n,e.senderTinyID=this.getMyTinyID(),e.payload.file.thumbUrl="https://web.sdk.qcloud.com/im/assets/images/transparent.png",e.payload.file.thumbSize=1668;var l={};if(tn){if(Xt)return void V.warn("createVideoMessage \u4E0D\u652F\u6301\u5728\u652F\u4ED8\u5B9D\u5C0F\u7A0B\u5E8F\u73AF\u5883\u4E0B\u4F7F\u7528");if(Ks(e.payload.file))return void V.warn("\u5C0F\u7A0B\u5E8F\u73AF\u5883\u4E0B\u8C03\u7528 createVideoMessage \u63A5\u53E3\u65F6\uFF0Cpayload.file \u4E0D\u652F\u6301\u4F20\u5165 File \u5BF9\u8C61");var h=e.payload.file;l.url=h.tempFilePath,l.name=h.tempFilePath.slice(h.tempFilePath.lastIndexOf("/")+1),l.size=h.size,l.second=h.duration,l.type=h.tempFilePath.slice(h.tempFilePath.lastIndexOf(".")+1).toLowerCase()}else if(Xn){if(Ks(e.payload.file)){var _=e.payload.file;e.payload.file.files=[_]}else if(Br(e.payload.file)&&typeof uni<"u"){var S=e.payload.file.tempFile;e.payload.file.files=[S]}var E=e.payload.file;l.url=window.URL.createObjectURL(E.files[0]),l.name=E.files[0].name,l.size=E.files[0].size,l.second=E.files[0].duration||0,l.type=E.files[0].type.split("/")[1]}e.payload.file.videoFile=l;var M=new Bi(e),w=new Uh({videoFormat:l.type,videoSecond:xa(l.second,0),videoSize:l.size,remoteVideoUrl:"",videoUrl:l.url,videoUUID:this._generateUUID(),thumbUUID:this._generateUUID(),thumbWidth:e.payload.file.width||200,thumbHeight:e.payload.file.height||200,thumbUrl:e.payload.file.thumbUrl,thumbSize:e.payload.file.thumbSize,thumbFormat:e.payload.file.thumbUrl.slice(e.payload.file.thumbUrl.lastIndexOf(".")+1).toLowerCase()}),L=this._getNickAndAvatarByUserID(n);return M.setElement(w),M.setNickAndAvatar(L),M.setNameCard(this._getNameCardByGroupID(M)),this._messageOptionsMap.set(M.clientSequence,e),M}},{key:"createCustomMessage",value:function(e){var n=this.getMyUserID();e.currentUser=n,e.senderTinyID=this.getMyTinyID();var l=new Bi(e),h=new lv({data:e.payload.data,description:e.payload.description,extension:e.payload.extension}),_=this._getNickAndAvatarByUserID(n);return l.setElement(h),l.setNickAndAvatar(_),l.setNameCard(this._getNameCardByGroupID(l)),l}},{key:"createFaceMessage",value:function(e){var n=this.getMyUserID();e.currentUser=n,e.senderTinyID=this.getMyTinyID();var l=new Bi(e),h=new qy(e.payload),_=this._getNickAndAvatarByUserID(n);return l.setElement(h),l.setNickAndAvatar(_),l.setNameCard(this._getNameCardByGroupID(l)),l}},{key:"createMergerMessage",value:function(e){var n=this.getMyUserID();e.currentUser=n,e.senderTinyID=this.getMyTinyID();var l=this._getNickAndAvatarByUserID(n),h=new Bi(e),_=new dv(e.payload);return h.setElement(_),h.setNickAndAvatar(l),h.setNameCard(this._getNameCardByGroupID(h)),h.setRelayFlag(!0),h}},{key:"createForwardMessage",value:function(e){var n=e.to,l=e.conversationType,h=e.priority,_=e.payload,S=e.needReadReceipt,E=this.getMyUserID(),M=this._getNickAndAvatarByUserID(E);if(_.type===Z.MSG_GRP_TIP)return Le(new Me({code:We.MESSAGE_FORWARD_TYPE_INVALID,message:at.MESSAGE_FORWARD_TYPE_INVALID}));var w={to:n,conversationType:l,conversationID:"".concat(l).concat(n),priority:h,isPlaceMessage:0,status:Xi.UNSEND,currentUser:E,senderTinyID:this.getMyTinyID(),cloudCustomData:e.cloudCustomData||_.cloudCustomData||"",needReadReceipt:S},L=new Bi(w);return L.setElement(_.getElements()[0]),L.setNickAndAvatar(M),L.setNameCard(this._getNameCardByGroupID(_)),L.setRelayFlag(!0),L}},{key:"downloadMergerMessage",value:function(e){return this._mergerMessageHandler.downloadMergerMessage(e)}},{key:"createFileMessage",value:function(e){if(tn){var n,l="createFileMessage \u63A5\u53E3\u4E0D\u53EF\u7528\uFF01";if(!Wn&&!$r&&!tr)return void V.warn("\u5C0F\u7A0B\u5E8F\u76EE\u524D\u4E0D\u652F\u6301\u9009\u62E9\u6587\u4EF6\uFF0C".concat(l));var h=Rn.getSystemInfoSync().SDKVersion;if(Wn&&Vc(h,n="2.5.0")<0)return void V.warn("wx.chooseMessageFile \u9700\u8981\u57FA\u7840\u5E93".concat(n,"\u6216\u66F4\u9AD8\u7248\u672C\uFF0C").concat(l));if($r&&Vc(h,n="1.18.0")<0)return void V.warn("qq.chooseMessageFile \u9700\u8981\u57FA\u7840\u5E93".concat(n,"\u6216\u66F4\u9AD8\u7248\u672C\uFF0C").concat(l))}if(Xn||tr){if(Ks(e.payload.file)){var _=e.payload.file;e.payload.file={files:[_]}}else if(Br(e.payload.file)&&typeof uni<"u"){var S=e.payload.file,E=S.tempFiles,M=S.files,w=null;Yt(E)?w=E[0]:Yt(M)&&(w=M[0]),e.payload.file={files:[w]}}}else if(Wn||$r){var L=e.payload.file.tempFiles,H=m(m({},L[0]),{},{url:L[0].path});e.payload.file={files:[H]}}var ne=this.getMyUserID();e.currentUser=ne,e.senderTinyID=this.getMyTinyID();var ae=new Bi(e),he=new rE({uuid:this._generateUUID(),file:e.payload.file}),ge=this._getNickAndAvatarByUserID(ne);return ae.setElement(he),ae.setNickAndAvatar(ge),ae.setNameCard(this._getNameCardByGroupID(ae)),this._messageOptionsMap.set(ae.clientSequence,e),ae}},{key:"createLocationMessage",value:function(e){var n=this.getMyUserID();e.currentUser=n,e.senderTinyID=this.getMyTinyID();var l=new Bi(e),h=new wf(e.payload),_=this._getNickAndAvatarByUserID(n);return l.setElement(h),l.setNickAndAvatar(_),l.setNameCard(this._getNameCardByGroupID(l)),l}},{key:"_onCannotFindModule",value:function(){return Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"sendMessageInstance",value:function(e,n){var l,h=this,_=null;switch(e.conversationType){case Z.CONV_C2C:if(!(_=this.getModule(Vi)))return this._onCannotFindModule();break;case Z.CONV_GROUP:if(!(_=this.getModule(pn)))return this._onCannotFindModule();if(vo({groupID:e.to})){var S=_.getLocalGroupProfile(e.to);if(S&&S.isSupportTopic)return Le({code:We.MESSAGE_SEND_GROUP_WITH_TOPIC_FAIL,message:at.MESSAGE_SEND_GROUP_WITH_TOPIC_FAIL});if(!Ke(n)&&!Ke(n.messageControlInfo))return Le({code:We.MESSAGE_CONTROL_INFO_FAIL,message:at.MESSAGE_CONTROL_INFO_FAIL})}break;default:return Le({code:We.MESSAGE_SEND_INVALID_CONVERSATION_TYPE,message:at.MESSAGE_SEND_INVALID_CONVERSATION_TYPE})}var E=this.getModule(YT),M=this.getModule(pn);return E.upload(e).then(function(){return h._getSendMessageSpecifiedKey(e)===Oh&&h.getModule(Ur).addSuccessCount(qo),M.guardForAVChatRoom(e).then(function(){if(!e.isSendable())return Le({code:We.MESSAGE_FILE_URL_IS_EMPTY,message:at.MESSAGE_FILE_URL_IS_EMPTY});h._addSendMessageTotalCount(e),l=Date.now();var w=function(L){var H="utf-8";Xn&&document&&(H=document.charset.toLowerCase());var ne,ae,he=0;if(ae=L.length,H==="utf-8"||H==="utf8")for(var ge=0;ge<ae;ge++)(ne=L.codePointAt(ge))<=127?he+=1:ne<=2047?he+=2:ne<=65535?he+=3:(he+=4,ge++);else if(H==="utf-16"||H==="utf16")for(var Te=0;Te<ae;Te++)(ne=L.codePointAt(Te))<=65535?he+=2:(he+=4,Te++);else he=L.replace(/[^\x00-\xff]/g,"aa").length;return he}(JSON.stringify(e));return e.type===Z.MSG_MERGER&&w>7e3?h._mergerMessageHandler.uploadMergerMessage(e,w).then(function(L){var H=h._mergerMessageHandler.createMergerMessagePack(e,n,L);return h.request(H)}):(h.getModule(Vt).setMessageRandom(e),e.conversationType===Z.CONV_C2C||e.conversationType===Z.CONV_GROUP?_.sendMessage(e,n):void 0)}).then(function(w){var L=w.data,H=L.time,ne=L.sequence,ae=L.readReceiptCode;gr(ae)&&ae!==0&&(new ht(yt.SEND_MESSAGE_WITH_RECEIPT).setMessage("from:".concat(e.from," to:").concat(e.to," sequence:").concat(ne," readReceiptCode:").concat(ae)).end(),V.warn("".concat(h._className,".sendMessageInstance readReceiptCode:").concat(ae," message:").concat(Wc[ae]))),h._addSendMessageSuccessCount(e,l),h._messageOptionsMap.delete(e.clientSequence);var he=h.getModule(Vt);e.status=Xi.SUCCESS,e.time=H;var ge=!1;if(e.conversationType===Z.CONV_GROUP)e.sequence=ne;else if(e.conversationType===Z.CONV_C2C){var Te=he.getLatestMessageSentByMe(e.conversationID);if(Te){var Ze=Te.nick,Ct=Te.avatar;Ze===e.nick&&Ct===e.avatar||(ge=!0)}}if(ge&&he.modifyMessageSentByMe({conversationID:e.conversationID,latestNick:e.nick,latestAvatar:e.avatar}),_.isOnlineMessage(e,n))e._onlineOnlyFlag=!0;else{he.appendToMessageList(e);var wt=e;Br(n)&&Br(n.messageControlInfo)&&(n.messageControlInfo.excludedFromLastMessage===!0&&(e._isExcludedFromLastMessage=!0,wt=""),n.messageControlInfo.excludedFromUnreadCount===!0&&(e._isExcludedFromUnreadCount=!0));var dn=e.conversationType;Lt(e.to)&&(dn=Z.CONV_TOPIC,h.getModule(ri).onMessageSent({groupID:wo(e.to),topicID:e.to,lastMessage:wt})),he.onMessageSent({conversationOptionsList:[{conversationID:e.conversationID,unreadCount:0,type:dn,subType:e.conversationSubType,lastMessage:wt}]})}return e.getRelayFlag()||e.type!=="TIMImageElem"||Km(e.payload.imageInfoArray),Wt({message:e})})}).catch(function(w){return h._onSendMessageFailed(e,w)})}},{key:"_onSendMessageFailed",value:function(e,n){e.status=Xi.FAIL,this.getModule(Vt).deleteMessageRandom(e),this._addSendMessageFailCountOnUser(e,n);var l=new ht(yt.SEND_MESSAGE);return l.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to)),this.probeNetwork().then(function(h){var _=Ue(h,2),S=_[0],E=_[1];l.setError(n,S,E).end()}),V.error("".concat(this._className,"._onSendMessageFailed error:"),n),Le(new Me({code:n&&n.code?n.code:We.MESSAGE_SEND_FAIL,message:n&&n.message?n.message:at.MESSAGE_SEND_FAIL,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if([Z.MSG_IMAGE,Z.MSG_AUDIO,Z.MSG_VIDEO,Z.MSG_FILE].includes(e.type))return Oh;if(e.conversationType===Z.CONV_C2C)return Qm;if(e.conversationType===Z.CONV_GROUP){var n=this.getModule(pn).getLocalGroupProfile(e.to);if(!n)return;var l=n.type;return Ws(l)?ev:Zm}}},{key:"_addSendMessageTotalCount",value:function(e){var n=this._getSendMessageSpecifiedKey(e);n&&this.getModule(Ur).addTotalCount(n)}},{key:"_addSendMessageSuccessCount",value:function(e,n){var l=Math.abs(Date.now()-n),h=this._getSendMessageSpecifiedKey(e);if(h){var _=this.getModule(Ur);_.addSuccessCount(h),_.addCost(h,l)}}},{key:"_addSendMessageFailCountOnUser",value:function(e,n){var l,h,_=n.code,S=_===void 0?-1:_,E=this.getModule(Ur),M=this._getSendMessageSpecifiedKey(e);M===Oh&&(l=S,h=!1,Sv.includes(l)&&(h=!0),h)?E.addFailedCountOfUserSide(qo):function(w){var L=!1;return Object.values(IE).includes(w)&&(L=!0),(w>=120001&&w<=13e4||w>=10100&&w<=10200)&&(L=!0),L}(S)&&M&&E.addFailedCountOfUserSide(M)}},{key:"resendMessage",value:function(e){return e.isResend=!0,e.status=Xi.UNSEND,this.sendMessageInstance(e)}},{key:"revokeMessage",value:function(e){var n=this,l=null;if(e.conversationType===Z.CONV_C2C){if(!(l=this.getModule(Vi)))return this._onCannotFindModule()}else if(e.conversationType===Z.CONV_GROUP&&!(l=this.getModule(pn)))return this._onCannotFindModule();var h=new ht(yt.REVOKE_MESSAGE);return h.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to)),l.revokeMessage(e).then(function(_){var S=_.data.recallRetList;if(!Mt(S)&&S[0].retCode!==0){var E=new Me({code:S[0].retCode,message:Wc[S[0].retCode]||at.MESSAGE_REVOKE_FAIL,data:{message:e}});return h.setCode(E.code).setMoreMessage(E.message).end(),Le(E)}return V.info("".concat(n._className,".revokeMessage ok. ID:").concat(e.ID)),e.isRevoked=!0,h.end(),n.getModule(Vt).onMessageRevoked([e]),Wt({message:e})}).catch(function(_){n.probeNetwork().then(function(E){var M=Ue(E,2),w=M[0],L=M[1];h.setError(_,w,L).end()});var S=new Me({code:_&&_.code?_.code:We.MESSAGE_REVOKE_FAIL,message:_&&_.message?_.message:at.MESSAGE_REVOKE_FAIL,data:{message:e}});return V.warn("".concat(n._className,".revokeMessage failed. error:"),_),Le(S)})}},{key:"deleteMessage",value:function(e){var n=this,l=null,h=e[0],_=h.conversationID,S="",E=[],M=[];if(h.conversationType===Z.CONV_C2C)l=this.getModule(Vi),S=_.replace(Z.CONV_C2C,""),e.forEach(function(L){L&&L.status===Xi.SUCCESS&&L.conversationID===_&&(L._onlineOnlyFlag||E.push("".concat(L.sequence,"_").concat(L.random,"_").concat(L.time)),M.push(L))});else if(h.conversationType===Z.CONV_GROUP)l=this.getModule(pn),S=_.replace(Z.CONV_GROUP,""),e.forEach(function(L){L&&L.status===Xi.SUCCESS&&L.conversationID===_&&(L._onlineOnlyFlag||E.push("".concat(L.sequence)),M.push(L))});else if(h.conversationType===Z.CONV_SYSTEM)return Le({code:We.CANNOT_DELETE_GROUP_SYSTEM_NOTICE,message:at.CANNOT_DELETE_GROUP_SYSTEM_NOTICE});if(!l)return this._onCannotFindModule();if(E.length===0)return this._onMessageDeleted(M);E.length>30&&(E=E.slice(0,30),M=M.slice(0,30));var w=new ht(yt.DELETE_MESSAGE);return w.setMessage("to:".concat(S," count:").concat(E.length)),l.deleteMessage({to:S,keyList:E}).then(function(L){return w.end(),V.info("".concat(n._className,".deleteMessage ok")),n._onMessageDeleted(M)}).catch(function(L){n.probeNetwork().then(function(ne){var ae=Ue(ne,2),he=ae[0],ge=ae[1];w.setError(L,he,ge).end()}),V.warn("".concat(n._className,".deleteMessage failed. error:"),L);var H=new Me({code:L&&L.code?L.code:We.MESSAGE_DELETE_FAIL,message:L&&L.message?L.message:at.MESSAGE_DELETE_FAIL});return Le(H)})}},{key:"_onMessageDeleted",value:function(e){return this.getModule(Vt).onMessageDeleted(e),En({messageList:e})}},{key:"modifyRemoteMessage",value:function(e){var n=this,l=null,h=e.conversationType,_=e.to;if(this.getModule(pn).isMessageFromOrToAVChatroom(_))return Le({code:We.MESSAGE_MODIFY_DISABLED_IN_AVCHATROOM,message:at.MESSAGE_MODIFY_DISABLED_IN_AVCHATROOM,data:{message:e}});h===Z.CONV_C2C?l=this.getModule(Vi):h===Z.CONV_GROUP&&(l=this.getModule(pn));var S=new ht(yt.MODIFY_MESSAGE);return S.setMessage("to:".concat(_)),l.modifyRemoteMessage(e).then(function(E){S.end(),V.info("".concat(n._className,".modifyRemoteMessage ok"));var M=n._onModifyRemoteMessageResp(e,E.data);return Wt({message:M})}).catch(function(E){if(S.setCode(E.code).setMoreMessage(E.message).end(),V.warn("".concat(n._className,".modifyRemoteMessage failed. error:"),E),E.code===20027){var M=n._onModifyRemoteMessageResp(e,E.data);return Le({code:We.MESSAGE_MODIFY_CONFLICT,message:at.MESSAGE_MODIFY_CONFLICT,data:{message:M}})}return Le({code:E.code,message:E.message,data:{message:e}})})}},{key:"_onModifyRemoteMessageResp",value:function(e,n){V.debug("".concat(this._className,"._onModifyRemoteMessageResp options:"),n);var l=e.conversationType,h=e.from,_=e.to,S=e.random,E=e.sequence,M=e.time,w=n.elements,L=n.messageVersion,H=n.cloudCustomData,ne=H===void 0?"":H;return this.getModule(Vt).onMessageModified({conversationType:l,from:h,to:_,time:M,random:S,sequence:E,elements:w,cloudCustomData:ne,messageVersion:L})}},{key:"_generateUUID",value:function(){var e=this.getModule(ir);return"".concat(e.getSDKAppID(),"-").concat(e.getUserID(),"-").concat(function(){for(var n="",l=32;l>0;--l)n+=j0[Math.floor(Math.random()*FT)];return n}())}},{key:"getMessageOption",value:function(e){return this._messageOptionsMap.get(e)}},{key:"_getNickAndAvatarByUserID",value:function(e){return this.getModule(Ei).getNickAndAvatarByUserID(e)}},{key:"_getNameCardByGroupID",value:function(e){if(e.conversationType===Z.CONV_GROUP){var n=this.getModule(pn);if(n)return n.getMyNameCardByGroupID(e.to)}return""}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),this._messageOptionsMap.clear()}}]),o}(Ti),AR=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this,e))._className="PluginModule",n.plugins={},n}return x(o,[{key:"registerPlugin",value:function(e){var n=this;Object.keys(e).forEach(function(l){n.plugins[l]=e[l]}),new ht(yt.REGISTER_PLUGIN).setMessage("key=".concat(Object.keys(e))).end()}},{key:"getPlugin",value:function(e){return this.plugins[e]}},{key:"reset",value:function(){V.log("".concat(this._className,".reset"))}}]),o}(Ti),EE=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this,e))._className="SyncUnreadMessageModule",n._cookie="",n._onlineSyncFlag=!1,n.getInnerEmitterInstance().on(gs,n._onLoginSuccess,Ae(n)),n}return x(o,[{key:"_onLoginSuccess",value:function(e){this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"_startSync",value:function(e){var n=this,l=e.cookie,h=e.syncFlag,_=e.isOnlineSync;V.log("".concat(this._className,"._startSync cookie:").concat(l," syncFlag:").concat(h," isOnlineSync:").concat(_)),this.request({protocolName:py,requestData:{cookie:l,syncFlag:h,isOnlineSync:_}}).then(function(S){var E=S.data,M=E.cookie,w=E.syncFlag,L=E.eventArray,H=E.messageList,ne=E.C2CRemainingUnreadList,ae=E.C2CPairUnreadList;n._cookie=M,Mt(M)||(w===0||w===1?(L&&n.getModule(Ua).onMessage({head:{},body:{eventArray:L,isInstantMessage:n._onlineSyncFlag,isSyncingEnded:!1}}),n.getModule(Vi).onNewC2CMessage({dataList:H,isInstantMessage:!1,C2CRemainingUnreadList:ne,C2CPairUnreadList:ae}),n._startSync({cookie:M,syncFlag:w,isOnlineSync:0})):w===2&&(L&&n.getModule(Ua).onMessage({head:{},body:{eventArray:L,isInstantMessage:n._onlineSyncFlag,isSyncingEnded:!0}}),n.getModule(Vi).onNewC2CMessage({dataList:H,isInstantMessage:n._onlineSyncFlag,C2CRemainingUnreadList:ne,C2CPairUnreadList:ae})))}).catch(function(S){V.error("".concat(n._className,"._startSync failed. error:"),S)})}},{key:"startOnlineSync",value:function(){V.log("".concat(this._className,".startOnlineSync")),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:1})}},{key:"startSyncOnReconnected",value:function(){V.log("".concat(this._className,".startSyncOnReconnected.")),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),this._onlineSyncFlag=!1,this._cookie=""}}]),o}(Ti),Vh={request:{toAccount:"To_Account",fromAccount:"From_Account",to:"To_Account",from:"From_Account",groupID:"GroupId",groupAtUserID:"GroupAt_Account",extension:"Ext",data:"Data",description:"Desc",elements:"MsgBody",sizeType:"Type",downloadFlag:"Download_Flag",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",videoUrl:"",imageUrl:"URL",fileUrl:"Url",uuid:"UUID",priority:"MsgPriority",receiverUserID:"To_Account",receiverGroupID:"GroupId",messageSender:"SenderId",messageReceiver:"ReceiverId",nick:"From_AccountNick",avatar:"From_AccountHeadurl",messageNumber:"MsgNum",pbDownloadKey:"PbMsgKey",downloadKey:"JsonMsgKey",applicationType:"PendencyType",userIDList:"To_Account",groupNameList:"GroupName",userID:"To_Account",groupAttributeList:"GroupAttr",mainSequence:"AttrMainSeq",avChatRoomKey:"BytesKey",attributeControl:"AttrControl",sequence:"seq",messageControlInfo:"SendMsgControl",updateSequence:"UpdateSeq",clientTime:"MsgClientTime",sequenceList:"MsgSeqList",topicID:"TopicId",customData:"CustomString",isSupportTopic:"SupportTopic"},response:{MsgPriority:"priority",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",Download_Flag:"downloadFlag",GroupId:"groupID",Member_Account:"userID",MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",MsgSeq:"sequence",MsgRandom:"random",MsgTime:"time",MsgTimeStamp:"time",MsgContent:"content",MsgBody:"elements",From_AccountNick:"nick",From_AccountHeadurl:"avatar",GroupWithdrawInfoArray:"revokedInfos",GroupReadInfoArray:"groupMessageReadNotice",LastReadMsgSeq:"lastMessageSeq",WithdrawC2cMsgNotify:"c2cMessageRevokedNotify",C2cWithdrawInfoArray:"revokedInfos",C2cReadedReceipt:"c2cMessageReadReceipt",ReadC2cMsgNotify:"c2cMessageReadNotice",LastReadTime:"peerReadTime",MsgRand:"random",MsgType:"type",MsgShow:"messageShow",NextMsgSeq:"nextMessageSeq",FaceUrl:"avatar",ProfileDataMod:"profileModify",Profile_Account:"userID",ValueBytes:"value",ValueNum:"value",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgFrom_AccountExtraInfo:"messageFromAccountExtraInformation",Operator_Account:"operatorID",OpType:"operationType",ReportType:"operationType",UserId:"userID",User_Account:"userID",List_Account:"userIDList",MsgOperatorMemberExtraInfo:"operatorInfo",MsgMemberExtraInfo:"memberInfoList",ImageUrl:"avatar",NickName:"nick",MsgGroupNewInfo:"newGroupProfile",MsgAppDefinedData:"groupCustomField",Owner_Account:"ownerID",GroupFaceUrl:"avatar",GroupIntroduction:"introduction",GroupNotification:"notification",GroupApplyJoinOption:"joinOption",MsgKey:"messageKey",GroupInfo:"groupProfile",ShutupTime:"muteTime",Desc:"description",Ext:"extension",GroupAt_Account:"groupAtUserID",MsgNum:"messageNumber",PbMsgKey:"pbDownloadKey",JsonMsgKey:"downloadKey",MsgModifiedFlag:"isModified",PendencyItem:"applicationItem",PendencyType:"applicationType",AddTime:"time",AddSource:"source",AddWording:"wording",ProfileImImage:"avatar",PendencyAdd:"friendApplicationAdded",FrienPencydDel_Account:"friendApplicationDeletedUserIDList",Peer_Account:"userID",GroupAttr:"groupAttributeList",GroupAttrAry:"groupAttributeList",AttrMainSeq:"mainSequence",seq:"sequence",GroupAttrOption:"groupAttributeOption",BytesChangedKeys:"changedKeyList",GroupAttrInfo:"groupAttributeList",GroupAttrSeq:"mainSequence",PushChangedAttrValFlag:"hasChangedAttributeInfo",SubKeySeq:"sequence",Val:"value",MsgGroupFromCardName:"senderNameCard",MsgGroupFromNickName:"senderNick",C2cNick:"peerNick",C2cImage:"peerAvatar",SendMsgControl:"messageControlInfo",NoLastMsg:"excludedFromLastMessage",NoUnread:"excludedFromUnreadCount",UpdateSeq:"updateSequence",MuteNotifications:"muteFlag",MsgClientTime:"clientTime",TinyId:"tinyID",GroupMsgReceiptList:"readReceiptList",ReadNum:"readCount",UnreadNum:"unreadCount",TopicId:"topicID",MillionGroupFlag:"communityType",SupportTopic:"isSupportTopic",MsgTopicNewInfo:"newTopicInfo",ShutupAll:"muteAllMembers",CustomString:"customData",TopicFaceUrl:"avatar",TopicIntroduction:"introduction",TopicNotification:"notification",TopicIdArray:"topicIDList",MsgVersion:"messageVersion",C2cMsgModNotifys:"c2cMessageModified",GroupMsgModNotifys:"groupMessageModified",ApplyJoinOption:"joinOption",MsgFlag:"messageRemindType",AtInfoList:"groupAtInfoList",AtFlagList:"groupAtType",AtMsgSeq:"sequence"},ignoreKeyWord:["C2C","ID","USP"]},el=Tr.PROPER,jA=li.trim;function wr(a,t){if(typeof a!="string"&&!Array.isArray(a))throw new TypeError("Expected the input to be `string | string[]`");t=Object.assign({pascalCase:!1},t);var o;return(a=Array.isArray(a)?a.map(function(e){return e.trim()}).filter(function(e){return e.length}).join("-"):a.trim()).length===0?"":a.length===1?t.pascalCase?a.toUpperCase():a.toLowerCase():(a!==a.toLowerCase()&&(a=qA(a)),a=a.replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,function(e,n){return n.toUpperCase()}).replace(/\d+(\w|$)/g,function(e){return e.toUpperCase()}),o=a,t.pascalCase?o.charAt(0).toUpperCase()+o.slice(1):o)}sn({target:"String",proto:!0,forced:(Fh="trim",xe(function(){return!!hc[Fh]()||"\u200B\x85\u180E"[Fh]()!=="\u200B\x85\u180E"||el&&hc[Fh].name!==Fh}))},{trim:function(){return jA(this)}});var qA=function(a){for(var t=!1,o=!1,e=!1,n=0;n<a.length;n++){var l=a[n];t&&/[a-zA-Z]/.test(l)&&l.toUpperCase()===l?(a=a.slice(0,n)+"-"+a.slice(n),t=!1,e=o,o=!0,n++):o&&e&&/[a-zA-Z]/.test(l)&&l.toLowerCase()===l?(a=a.slice(0,n-1)+"-"+a.slice(n-1),e=o,o=!1,t=!0):(t=l.toLowerCase()===l&&l.toUpperCase()!==l,e=o,o=l.toUpperCase()===l&&l.toLowerCase()!==l)}return a};function HA(a,t){var o=0;return function e(n,l){if(++o>100)return o--,n;if(Yt(n)){var h=n.map(function(w){return Gc(w)?e(w,l):w});return o--,h}if(Gc(n)){var _=(S=n,E=function(w,L){if(!V0(L))return!1;if((ne=L)!==wr(ne))for(var H=0;H<Vh.ignoreKeyWord.length&&!L.includes(Vh.ignoreKeyWord[H]);H++);var ne;return Ke(l[L])?function(ae){return ae==="OPPOChannelID"?ae:ae[0].toUpperCase()+wr(ae).slice(1)}(L):l[L]},M=Object.create(null),Object.keys(S).forEach(function(w){var L=E(S[w],w);L&&(M[L]=S[w])}),M);return _=ny(_,function(w,L){return Yt(w)||Gc(w)?e(w,l):w}),o--,_}var S,E,M}(a,t)}function TE(a,t){if(Yt(a))return a.map(function(h){return Gc(h)?TE(h,t):h});if(Gc(a)){var o=(e=a,n=function(h,_){return Ke(t[_])?wr(_):t[_]},l={},Object.keys(e).forEach(function(h){l[n(e[h],h)]=e[h]}),l);return o=ny(o,function(h){return Yt(h)||Gc(h)?TE(h,t):h})}var e,n,l}var kR=typeof ArrayBuffer<"u"&&typeof DataView<"u",$A=ee.RangeError,Ff=function(a){if(a===void 0)return 0;var t=$a(a),o=Ea(t);if(t!==o)throw $A("Wrong length or index");return o},wR=ee.Array,KA=Math.abs,tl=Math.pow,WA=Math.floor,zA=Math.log,YA=Math.LN2,JA=function(a,t,o){var e,n,l,h=wR(o),_=8*o-t-1,S=(1<<_)-1,E=S>>1,M=t===23?tl(2,-24)-tl(2,-77):0,w=a<0||a===0&&1/a<0?1:0,L=0;for((a=KA(a))!=a||a===1/0?(n=a!=a?1:0,e=S):(e=WA(zA(a)/YA),a*(l=tl(2,-e))<1&&(e--,l*=2),(a+=e+E>=1?M/l:M*tl(2,1-E))*l>=2&&(e++,l/=2),e+E>=S?(n=0,e=S):e+E>=1?(n=(a*l-1)*tl(2,t),e+=E):(n=a*tl(2,E-1)*tl(2,t),e=0));t>=8;)h[L++]=255&n,n/=256,t-=8;for(e=e<<t|n,_+=t;_>0;)h[L++]=255&e,e/=256,_-=8;return h[--L]|=128*w,h},XA=function(a,t){var o,e=a.length,n=8*e-t-1,l=(1<<n)-1,h=l>>1,_=n-7,S=e-1,E=a[S--],M=127&E;for(E>>=7;_>0;)M=256*M+a[S--],_-=8;for(o=M&(1<<-_)-1,M>>=-_,_+=t;_>0;)o=256*o+a[S--],_-=8;if(M===0)M=1-h;else{if(M===l)return o?NaN:E?-1/0:1/0;o+=tl(2,t),M-=h}return(E?-1:1)*o*tl(2,M-t)},DR=function(a){for(var t=fr(this),o=xr(t),e=arguments.length,n=Li(e>1?arguments[1]:void 0,o),l=e>2?arguments[2]:void 0,h=l===void 0?o:Li(l,o);h>n;)t[n++]=a;return t},QA=cc.f,ZA=Yn.f,ek=Tr.PROPER,OR=Tr.CONFIGURABLE,Ye=Jr.get,et=Jr.set,ms=ee.ArrayBuffer,vs=ms,Bh=vs&&vs.prototype,Xc=ee.DataView,jh=Xc&&Xc.prototype,NR=Object.prototype,tk=ee.Array,rS=ee.RangeError,LR=ve(DR),nk=ve([].reverse),iS=JA,PR=XA,xR=function(a){return[255&a]},UR=function(a){return[255&a,a>>8&255]},GR=function(a){return[255&a,a>>8&255,a>>16&255,a>>24&255]},FR=function(a){return a[3]<<24|a[2]<<16|a[1]<<8|a[0]},rk=function(a){return iS(a,23,4)},ik=function(a){return iS(a,52,8)},oS=function(a,t){ZA(a.prototype,t,{get:function(){return Ye(this)[t]}})},ld=function(a,t,o,e){var n=Ff(o),l=Ye(a);if(n+t>l.byteLength)throw rS("Wrong index");var h=Ye(l.buffer).bytes,_=n+l.byteOffset,S=zi(h,_,_+t);return e?S:nk(S)},dd=function(a,t,o,e,n,l){var h=Ff(o),_=Ye(a);if(h+t>_.byteLength)throw rS("Wrong index");for(var S=Ye(_.buffer).bytes,E=h+_.byteOffset,M=e(+n),w=0;w<t;w++)S[E+w]=M[l?w:t-w-1]};if(kR){var VR=ek&&ms.name!=="ArrayBuffer";if(xe(function(){ms(1)})&&xe(function(){new ms(-1)})&&!xe(function(){return new ms,new ms(1.5),new ms(NaN),VR&&!OR}))VR&&OR&&Hn(ms,"name","ArrayBuffer");else{(vs=function(a){return ko(this,Bh),new ms(Ff(a))}).prototype=Bh;for(var ME,BR=QA(ms),jR=0;BR.length>jR;)(ME=BR[jR++])in vs||Hn(vs,ME,ms[ME]);Bh.constructor=vs}di&&fo(jh)!==NR&&di(jh,NR);var aS=new Xc(new vs(2)),qR=ve(jh.setInt8);aS.setInt8(0,2147483648),aS.setInt8(1,2147483649),!aS.getInt8(0)&&aS.getInt8(1)||ns(jh,{setInt8:function(a,t){qR(this,a,t<<24>>24)},setUint8:function(a,t){qR(this,a,t<<24>>24)}},{unsafe:!0})}else Bh=(vs=function(a){ko(this,Bh);var t=Ff(a);et(this,{bytes:LR(tk(t),0),byteLength:t}),Et||(this.byteLength=t)}).prototype,jh=(Xc=function(a,t,o){ko(this,jh),ko(a,Bh);var e=Ye(a).byteLength,n=$a(t);if(n<0||n>e)throw rS("Wrong offset");if(n+(o=o===void 0?e-n:Ea(o))>e)throw rS("Wrong length");et(this,{buffer:a,byteLength:o,byteOffset:n}),Et||(this.buffer=a,this.byteLength=o,this.byteOffset=n)}).prototype,Et&&(oS(vs,"byteLength"),oS(Xc,"buffer"),oS(Xc,"byteLength"),oS(Xc,"byteOffset")),ns(jh,{getInt8:function(a){return ld(this,1,a)[0]<<24>>24},getUint8:function(a){return ld(this,1,a)[0]},getInt16:function(a){var t=ld(this,2,a,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(a){var t=ld(this,2,a,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(a){return FR(ld(this,4,a,arguments.length>1?arguments[1]:void 0))},getUint32:function(a){return FR(ld(this,4,a,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(a){return PR(ld(this,4,a,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(a){return PR(ld(this,8,a,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(a,t){dd(this,1,a,xR,t)},setUint8:function(a,t){dd(this,1,a,xR,t)},setInt16:function(a,t){dd(this,2,a,UR,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(a,t){dd(this,2,a,UR,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(a,t){dd(this,4,a,GR,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(a,t){dd(this,4,a,GR,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(a,t){dd(this,4,a,rk,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(a,t){dd(this,8,a,ik,t,arguments.length>2?arguments[2]:void 0)}});ia(vs,"ArrayBuffer"),ia(Xc,"DataView");var sS={ArrayBuffer:vs,DataView:Xc},RE=sS.ArrayBuffer,CE=sS.DataView,HR=CE.prototype,$R=ve(RE.prototype.slice),ok=ve(HR.getUint8),ak=ve(HR.setUint8),sk=xe(function(){return!new RE(2).slice(1,void 0).byteLength});sn({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:sk},{slice:function(a,t){if($R&&t===void 0)return $R(Sn(this),a);for(var o=Sn(this).byteLength,e=Li(a,o),n=Li(t===void 0?o:t,o),l=new(sa(this,RE))(Ea(n-e)),h=new CE(this),_=new CE(l),S=0;e<n;)ak(_,S++,ok(h,e++));return l}});var pa,Qc,Eo,ck=Yn.f,cS=ee.Int8Array,hd=cS&&cS.prototype,jt=ee.Uint8ClampedArray,KR=jt&&jt.prototype,Zc=cS&&fo(cS),_s=hd&&fo(hd),Zi=Object.prototype,Do=ee.TypeError,WR=Qt("toStringTag"),bE=Wi("TYPED_ARRAY_TAG"),qh=Wi("TYPED_ARRAY_CONSTRUCTOR"),nl=kR&&!!di&&xi(ee.opera)!=="Opera",zR=!1,Qs={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Zs={BigInt64Array:8,BigUint64Array:8},Hh=function(a){if(!xt(a))return!1;var t=xi(a);return st(Qs,t)||st(Zs,t)};for(pa in Qs)(Eo=(Qc=ee[pa])&&Qc.prototype)?Hn(Eo,qh,Qc):nl=!1;for(pa in Zs)(Eo=(Qc=ee[pa])&&Qc.prototype)&&Hn(Eo,qh,Qc);if((!nl||!bt(Zc)||Zc===Function.prototype)&&(Zc=function(){throw Do("Incorrect invocation")},nl))for(pa in Qs)ee[pa]&&di(ee[pa],Zc);if((!nl||!_s||_s===Zi)&&(_s=Zc.prototype,nl))for(pa in Qs)ee[pa]&&di(ee[pa].prototype,_s);if(nl&&fo(KR)!==_s&&di(KR,_s),Et&&!st(_s,WR))for(pa in zR=!0,ck(_s,WR,{get:function(){return xt(this)?this[bE]:void 0}}),Qs)ee[pa]&&Hn(ee[pa],bE,pa);var vn={NATIVE_ARRAY_BUFFER_VIEWS:nl,TYPED_ARRAY_CONSTRUCTOR:qh,TYPED_ARRAY_TAG:zR&&bE,aTypedArray:function(a){if(Hh(a))return a;throw Do("Target is not a typed array")},aTypedArrayConstructor:function(a){if(bt(a)&&(!di||nt(Zc,a)))return a;throw Do(ci(a)+" is not a typed array constructor")},exportTypedArrayMethod:function(a,t,o,e){if(Et){if(o)for(var n in Qs){var l=ee[n];if(l&&st(l.prototype,a))try{delete l.prototype[a]}catch{try{l.prototype[a]=t}catch{}}}_s[a]&&!o||lr(_s,a,o?t:nl&&hd[a]||t,e)}},exportTypedArrayStaticMethod:function(a,t,o){var e,n;if(Et){if(di){if(o){for(e in Qs)if((n=ee[e])&&st(n,a))try{delete n[a]}catch{}}if(Zc[a]&&!o)return;try{return lr(Zc,a,o?t:nl&&Zc[a]||t)}catch{}}for(e in Qs)!(n=ee[e])||n[a]&&!o||lr(n,a,t)}},isView:function(a){if(!xt(a))return!1;var t=xi(a);return t==="DataView"||st(Qs,t)||st(Zs,t)},isTypedArray:Hh,TypedArray:Zc,TypedArrayPrototype:_s},uk=vn.NATIVE_ARRAY_BUFFER_VIEWS,YR=ee.ArrayBuffer,ii=ee.Int8Array,Vf=!uk||!xe(function(){ii(1)})||!xe(function(){new ii(-1)})||!Gd(function(a){new ii,new ii(null),new ii(1.5),new ii(a)},!0)||xe(function(){return new ii(new YR(2),1,void 0).length!==1}),Gr=Math.floor,JR=Number.isInteger||function(a){return!xt(a)&&isFinite(a)&&Gr(a)===a},AE=ee.RangeError,lk=ee.RangeError,uS=function(a,t){var o=function(e){var n=$a(e);if(n<0)throw AE("The argument can't be less than 0");return n}(a);if(o%t)throw lk("Wrong offset");return o},dk=vn.aTypedArrayConstructor,kE=function(a){var t,o,e,n,l,h,_=F_(this),S=fr(a),E=arguments.length,M=E>1?arguments[1]:void 0,w=M!==void 0,L=vc(S);if(L&&!kl(L))for(h=(l=Po(S,L)).next,S=[];!(n=dt(h,l)).done;)S.push(n.value);for(w&&E>2&&(M=ra(M,arguments[2])),o=xr(S),e=new(dk(_))(o),t=0;o>t;t++)e[t]=w?M(S[t],t):S[t];return e};vt(function(a){var t=cc.f,o=Ui.forEach,e=Jr.get,n=Jr.set,l=Yn.f,h=ki.f,_=Math.round,S=ee.RangeError,E=sS.ArrayBuffer,M=E.prototype,w=sS.DataView,L=vn.NATIVE_ARRAY_BUFFER_VIEWS,H=vn.TYPED_ARRAY_CONSTRUCTOR,ne=vn.TYPED_ARRAY_TAG,ae=vn.TypedArray,he=vn.TypedArrayPrototype,ge=vn.aTypedArrayConstructor,Te=vn.isTypedArray,Ze=function(xn,On){ge(xn);for(var ar=0,yr=On.length,Mi=new xn(yr);yr>ar;)Mi[ar]=On[ar++];return Mi},Ct=function(xn,On){l(xn,On,{get:function(){return e(this)[On]}})},wt=function(xn){var On;return nt(M,xn)||(On=xi(xn))=="ArrayBuffer"||On=="SharedArrayBuffer"},dn=function(xn,On){return Te(xn)&&!rr(On)&&On in xn&&JR(+On)&&On>=0},$t=function(xn,On){return On=Si(On),dn(xn,On)?Gn(2,xn[On]):h(xn,On)},Kn=function(xn,On,ar){return On=Si(On),!(dn(xn,On)&&xt(ar)&&st(ar,"value"))||st(ar,"get")||st(ar,"set")||ar.configurable||st(ar,"writable")&&!ar.writable||st(ar,"enumerable")&&!ar.enumerable?l(xn,On,ar):(xn[On]=ar.value,xn)};Et?(L||(ki.f=$t,Yn.f=Kn,Ct(he,"buffer"),Ct(he,"byteOffset"),Ct(he,"byteLength"),Ct(he,"length")),sn({target:"Object",stat:!0,forced:!L},{getOwnPropertyDescriptor:$t,defineProperty:Kn}),a.exports=function(xn,On,ar){var yr=xn.match(/\d+$/)[0]/8,Mi=xn+(ar?"Clamped":"")+"Array",Ko="get"+xn,fa="set"+xn,To=ee[Mi],Dr=To,Wo=Dr&&Dr.prototype,eu={},Jf=function(zo,mr){l(zo,mr,{get:function(){return function(tc,Yo){var Is=e(tc);return Is.view[Ko](Yo*yr+Is.byteOffset,!0)}(this,mr)},set:function(tc){return function(Yo,Is,ga){var vd=e(Yo);ar&&(ga=(ga=_(ga))<0?0:ga>255?255:255&ga),vd.view[fa](Is*yr+vd.byteOffset,ga,!0)}(this,mr,tc)},enumerable:!0})};L?Vf&&(Dr=On(function(zo,mr,tc,Yo){return ko(zo,Wo),Ps(xt(mr)?wt(mr)?Yo!==void 0?new To(mr,uS(tc,yr),Yo):tc!==void 0?new To(mr,uS(tc,yr)):new To(mr):Te(mr)?Ze(Dr,mr):dt(kE,Dr,mr):new To(Ff(mr)),zo,Dr)}),di&&di(Dr,ae),o(t(To),function(zo){zo in Dr||Hn(Dr,zo,To[zo])}),Dr.prototype=Wo):(Dr=On(function(zo,mr,tc,Yo){ko(zo,Wo);var Is,ga,vd,Jh=0,SS=0;if(xt(mr)){if(!wt(mr))return Te(mr)?Ze(Dr,mr):dt(kE,Dr,mr);Is=mr,SS=uS(tc,yr);var JE=mr.byteLength;if(Yo===void 0){if(JE%yr||(ga=JE-SS)<0)throw S("Wrong length")}else if((ga=Ea(Yo)*yr)+SS>JE)throw S("Wrong length");vd=ga/yr}else vd=Ff(mr),Is=new E(ga=vd*yr);for(n(zo,{buffer:Is,byteOffset:SS,byteLength:ga,length:vd,view:new w(Is)});Jh<vd;)Jf(zo,Jh++)}),di&&di(Dr,ae),Wo=Dr.prototype=na(he)),Wo.constructor!==Dr&&Hn(Wo,"constructor",Dr),Hn(Wo,H,Dr),ne&&Hn(Wo,ne,Mi),eu[Mi]=Dr,sn({global:!0,forced:Dr!=To,sham:!L},eu),"BYTES_PER_ELEMENT"in Dr||Hn(Dr,"BYTES_PER_ELEMENT",yr),"BYTES_PER_ELEMENT"in Wo||Hn(Wo,"BYTES_PER_ELEMENT",yr),Au(Mi)}):a.exports=function(){}})("Uint8",function(a){return function(t,o,e){return a(this,t,o,e)}});var XR=Math.min,wE=ve([].copyWithin||function(a,t){var o=fr(this),e=xr(o),n=Li(a,e),l=Li(t,e),h=arguments.length>2?arguments[2]:void 0,_=XR((h===void 0?e:Li(h,e))-l,e-n),S=1;for(l<n&&n<l+_&&(S=-1,l+=_-1,n+=_-1);_-- >0;)l in o?o[n]=o[l]:delete o[n],n+=S,l+=S;return o}),hk=vn.aTypedArray;(0,vn.exportTypedArrayMethod)("copyWithin",function(a,t){return wE(hk(this),a,t,arguments.length>2?arguments[2]:void 0)});var QR=Ui.every,ZR=vn.aTypedArray;(0,vn.exportTypedArrayMethod)("every",function(a){return QR(ZR(this),a,arguments.length>1?arguments[1]:void 0)});var lS=vn.aTypedArray;(0,vn.exportTypedArrayMethod)("fill",function(a){var t=arguments.length;return dt(DR,lS(this),a,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)});var eC=vn.TYPED_ARRAY_CONSTRUCTOR,pk=vn.aTypedArrayConstructor,Iv=function(a){return pk(sa(a,a[eC]))},DE=function(a,t){return function(o,e){for(var n=0,l=xr(e),h=new o(l);l>n;)h[n]=e[n++];return h}(Iv(a),t)},Bf=Ui.filter,jf=vn.aTypedArray;(0,vn.exportTypedArrayMethod)("filter",function(a){var t=Bf(jf(this),a,arguments.length>1?arguments[1]:void 0);return DE(this,t)});var OE=Ui.find,NE=vn.aTypedArray;(0,vn.exportTypedArrayMethod)("find",function(a){return OE(NE(this),a,arguments.length>1?arguments[1]:void 0)});var tC=Ui.findIndex,LE=vn.aTypedArray;(0,vn.exportTypedArrayMethod)("findIndex",function(a){return tC(LE(this),a,arguments.length>1?arguments[1]:void 0)});var fk=Ui.forEach,gk=vn.aTypedArray;(0,vn.exportTypedArrayMethod)("forEach",function(a){fk(gk(this),a,arguments.length>1?arguments[1]:void 0)});var mk=ml.includes,nC=vn.aTypedArray;(0,vn.exportTypedArrayMethod)("includes",function(a){return mk(nC(this),a,arguments.length>1?arguments[1]:void 0)});var qf=ml.indexOf,vk=vn.aTypedArray;(0,vn.exportTypedArrayMethod)("indexOf",function(a){return qf(vk(this),a,arguments.length>1?arguments[1]:void 0)});var or=Qt("iterator"),Er=ee.Uint8Array,rC=ve(Za.values),_k=ve(Za.keys),yk=ve(Za.entries),PE=vn.aTypedArray,Hf=vn.exportTypedArrayMethod,eo=Er&&Er.prototype,dS=!xe(function(){eo[or].call([1])}),iC=!!eo&&eo.values&&eo[or]===eo.values&&eo.values.name==="values",oC=function(){return rC(PE(this))};Hf("entries",function(){return yk(PE(this))},dS),Hf("keys",function(){return _k(PE(this))},dS),Hf("values",oC,dS||!iC,{name:"values"}),Hf(or,oC,dS||!iC,{name:"values"});var Sk=vn.aTypedArray,Ik=vn.exportTypedArrayMethod,aC=ve([].join);Ik("join",function(a){return aC(Sk(this),a)});var sC=vn.aTypedArray;(0,vn.exportTypedArrayMethod)("lastIndexOf",function(a){var t=arguments.length;return Dc(uv,sC(this),t>1?[a,arguments[1]]:[a])});var xE=Ui.map,cC=vn.aTypedArray;(0,vn.exportTypedArrayMethod)("map",function(a){return xE(cC(this),a,arguments.length>1?arguments[1]:void 0,function(t,o){return new(Iv(t))(o)})});var Ev=ee.TypeError,$h=function(a){return function(t,o,e,n){er(o);var l=fr(t),h=qr(l),_=xr(l),S=a?_-1:0,E=a?-1:1;if(e<2)for(;;){if(S in h){n=h[S],S+=E;break}if(S+=E,a?S<0:_<=S)throw Ev("Reduce of empty array with no initial value")}for(;a?S>=0:_>S;S+=E)S in h&&(n=o(n,h[S],S,l));return n}},Kh={left:$h(!1),right:$h(!0)},UE=Kh.left,uC=vn.aTypedArray;(0,vn.exportTypedArrayMethod)("reduce",function(a){var t=arguments.length;return UE(uC(this),a,t,t>1?arguments[1]:void 0)});var Ek=Kh.right,ys=vn.aTypedArray;(0,vn.exportTypedArrayMethod)("reduceRight",function(a){var t=arguments.length;return Ek(ys(this),a,t,t>1?arguments[1]:void 0)});var Ss=vn.aTypedArray,Tk=vn.exportTypedArrayMethod,lC=Math.floor;Tk("reverse",function(){for(var a,t=Ss(this).length,o=lC(t/2),e=0;e<o;)a=this[e],this[e++]=this[--t],this[t]=a;return this});var $f=ee.RangeError,GE=ee.Int8Array,FE=GE&&GE.prototype,VE=FE&&FE.set,dC=vn.aTypedArray,Mk=vn.exportTypedArrayMethod,pd=!xe(function(){var a=new Uint8ClampedArray(2);return dt(VE,a,{length:1,0:3},1),a[1]!==3}),BE=pd&&vn.NATIVE_ARRAY_BUFFER_VIEWS&&xe(function(){var a=new GE(2);return a.set(1),a.set("2",1),a[0]!==0||a[1]!==2});Mk("set",function(a){dC(this);var t=uS(arguments.length>1?arguments[1]:void 0,1),o=fr(a);if(pd)return dt(VE,this,o,t);var e=this.length,n=xr(o),l=0;if(n+t>e)throw $f("Wrong length");for(;l<n;)this[t+l]=o[l++]},!pd||BE);var hC=vn.aTypedArray;(0,vn.exportTypedArrayMethod)("slice",function(a,t){for(var o=ba(hC(this),a,t),e=Iv(this),n=0,l=o.length,h=new e(l);l>n;)h[n]=o[n++];return h},xe(function(){new Int8Array(1).slice()}));var pC=Ui.some,fd=vn.aTypedArray;(0,vn.exportTypedArrayMethod)("some",function(a){return pC(fd(this),a,arguments.length>1?arguments[1]:void 0)});var Rk=ee.Array,Ck=vn.aTypedArray,bk=vn.exportTypedArrayMethod,Kf=ee.Uint16Array,Wf=Kf&&ve(Kf.prototype.sort),Ak=!(!Wf||xe(function(){Wf(new Kf(2),null)})&&xe(function(){Wf(new Kf(2),{})})),fC=!!Wf&&!xe(function(){if(Ge)return Ge<74;if(Nf)return Nf<67;if(pv)return!0;if(Lf)return Lf<602;var a,t,o=new Kf(516),e=Rk(516);for(a=0;a<516;a++)t=a%4,o[a]=515-a,e[a]=a-2*t+3;for(Wf(o,function(n,l){return(n/4|0)-(l/4|0)}),a=0;a<516;a++)if(o[a]!==e[a])return!0});bk("sort",function(a){return a!==void 0&&er(a),fC?Wf(this,a):jI(Ck(this),function(t){return function(o,e){return t!==void 0?+t(o,e)||0:e!=e?-1:o!=o?1:o===0&&e===0?1/o>0&&1/e<0?1:-1:o>e}}(a))},!fC||Ak);var kk=vn.aTypedArray;(0,vn.exportTypedArrayMethod)("subarray",function(a,t){var o=kk(this),e=o.length,n=Li(a,e);return new(Iv(o))(o.buffer,o.byteOffset+n*o.BYTES_PER_ELEMENT,Ea((t===void 0?e:Li(t,e))-n))});var Wh=ee.Int8Array,gC=vn.aTypedArray,wk=vn.exportTypedArrayMethod,zf=[].toLocaleString,jE=!!Wh&&xe(function(){zf.call(new Wh(1))});wk("toLocaleString",function(){return Dc(zf,jE?ba(gC(this)):gC(this),ba(arguments))},xe(function(){return[1,2].toLocaleString()!=new Wh([1,2]).toLocaleString()})||!xe(function(){Wh.prototype.toLocaleString.call([1,2])}));var hS=vn.exportTypedArrayMethod,mC=ee.Uint8Array,vC=mC&&mC.prototype||{},$o=[].toString,ec=ve([].join);xe(function(){$o.call({})})&&($o=function(){return ec(this)});var Tv=vC.toString!=$o;hS("toString",$o,Tv);var Dk=ee.RangeError,_C=String.fromCharCode,zh=String.fromCodePoint,yC=ve([].join),Ok=!!zh&&zh.length!=1;sn({target:"String",stat:!0,forced:Ok},{fromCodePoint:function(a){for(var t,o=[],e=arguments.length,n=0;e>n;){if(t=+arguments[n++],Li(t,1114111)!==t)throw Dk(t+" is not a valid code point");o[n]=t<65536?_C(t):_C(55296+((t-=65536)>>10),t%1024+56320)}return yC(o,"")}});var qE=String.fromCharCode,Mv=function(a){var t=0|a.charCodeAt(0);if(55296<=t)if(t<56320){var o=0|a.charCodeAt(1);if(56320<=o&&o<=57343){if((t=(t<<10)+o-56613888|0)>65535)return qE(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}else t=65533}else t<=57343&&(t=65533);return t<=2047?qE(192|t>>>6,128|63&t):qE(224|t>>>12,128|t>>>6&63,128|63&t)},Yf=function(a){for(var t=a===void 0?"":(""+a).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,Mv),o=0|t.length,e=new Uint8Array(o),n=0;n<o;n=n+1|0)e[n]=0|t.charCodeAt(n);return e},Nk=function(a){for(var t=new Uint8Array(a),o="",e=0,n=t.length;e<n;){var l=t[e],h=0,_=0;if(l<=127?(h=0,_=255&l):l<=223?(h=1,_=31&l):l<=239?(h=2,_=15&l):l<=244&&(h=3,_=7&l),n-e-h>0)for(var S=0;S<h;)_=_<<6|63&(l=t[e+S+1]),S+=1;else _=65533,h=n-e;o+=String.fromCodePoint(_),e+=h+1}return o},SC=function(){function a(t){A(this,a),this._handler=t;var o=t.getURL();if(this._socket=null,this._workerSocket=null,this._id=cs(),this._handler.getIsWorkerEnabled()){var e=URL.createObjectURL(new Blob([';let _socket = null;onmessage = function(event) {  if (event.data.cmd === "start") {    const url = event.data.url;    _socket = new WebSocket(url);    _socket.binaryType = "arraybuffer";    _socket.onopen = function() {      postMessage({ callback: "onOpen" });    };    _socket.onclose = function(e) {      postMessage({ callback: "onOpen", e: { code: e.code, reason: e.reason } });    };    _socket.onmessage = function(e) {      postMessage({ callback: "onMessage", data: e.data });    };    _socket.onerror = function(e) {      postMessage({ callback: "onError", e: { isTrusted: "true" } });    };  } else if (event.data.cmd === "sendMessage") {    if (_socket !== null) {      _socket.send(event.data.data);    }  } else if (event.data.cmd === "stop") {    if (_socket !== null) {      _socket.close(event.data.code);      _socket = null;    }  }};'],{type:"application/javascript; charset=utf-8"}));this._workerSocket=new Worker(e);var n=this;this._workerSocket.onmessage=function(l){var h=l.data,_=h.callback,S=h.e;_==="onOpen"?n._onOpen():_==="onClose"?n._onClose(S):_==="onError"?n._onError(S):_==="onMessage"&&n._onMessage(l.data)},this._workerSocket.postMessage({cmd:"start",id:this._id,url:o})}else tn?Xt?(Rn.connectSocket({url:o,header:{"content-type":"application/json"}}),Rn.onSocketClose(this._onClose.bind(this)),Rn.onSocketOpen(this._onOpen.bind(this)),Rn.onSocketMessage(this._onMessage.bind(this)),Rn.onSocketError(this._onError.bind(this))):(this._socket=Rn.connectSocket({url:o,header:{"content-type":"application/json"},complete:function(){}}),this._socket.onClose(this._onClose.bind(this)),this._socket.onOpen(this._onOpen.bind(this)),this._socket.onMessage(this._onMessage.bind(this)),this._socket.onError(this._onError.bind(this))):Xn&&(this._socket=new WebSocket(o),this._socket.binaryType="arraybuffer",this._socket.onopen=this._onOpen.bind(this),this._socket.onmessage=this._onMessage.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onerror=this._onError.bind(this));this._canIUseBinaryFrame=t.canIUseBinaryFrame()}return x(a,[{key:"getID",value:function(){return this._id}},{key:"_onOpen",value:function(){this._handler.onOpen({id:this._id})}},{key:"_onClose",value:function(t){this._handler.onClose({id:this._id,e:t})}},{key:"_onMessage",value:function(t){this._handler.onMessage({data:this._canIUseBinaryFrame?Nk(t.data):t.data})}},{key:"_onError",value:function(t){this._handler.onError({id:this._id,e:t})}},{key:"setIsWorkerEnabled",value:function(t){this._isWorkerEnabled=!0}},{key:"close",value:function(t){if(this._workerSocket&&(this._workerSocket.postMessage({cmd:"stop",code:t}),this._workerSocket.terminate(),this._workerSocket=null),Xt)return Rn.offSocketClose(),Rn.offSocketMessage(),Rn.offSocketOpen(),Rn.offSocketError(),void Rn.closeSocket();this._socket&&(tn?(this._socket.onClose(function(){}),this._socket.onOpen(function(){}),this._socket.onMessage(function(){}),this._socket.onError(function(){})):Xn&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null),Kr?this._socket.close({code:t}):this._socket.close(t),this._socket=null)}},{key:"send",value:function(t){if(this._workerSocket)this._workerSocket.postMessage({cmd:"sendMessage",data:this._canIUseBinaryFrame?Yf(t.data).buffer:t.data});else{if(Xt)return void Rn.sendSocketMessage({data:t.data,fail:function(){t.fail&&t.requestID&&t.fail(t.requestID)}});this._socket&&(tn?this._socket.send({data:this._canIUseBinaryFrame?Yf(t.data).buffer:t.data,fail:function(){t.fail&&t.requestID&&t.fail(t.requestID)}}):Xn&&this._socket.send(this._canIUseBinaryFrame?Yf(t.data).buffer:t.data))}}}]),a}(),Lk=4e3,pS=4001,Pk=["keyMap"],xk=["keyMap"],Rv="connected",HE="connecting",fS="disconnected",Uk=function(){function a(t){A(this,a),this._channelModule=t,this._className="SocketHandler",this._promiseMap=new Map,this._readyState=fS,this._simpleRequestMap=new Map,this.MAX_SIZE=100,this._startSequence=cs(),this._startTs=0,this._reConnectFlag=!1,this._nextPingTs=0,this._reConnectCount=0,this.MAX_RECONNECT_COUNT=3,this._socketID=-1,this._random=0,this._socket=null,this._url="",this._onOpenTs=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0,this._setWebsocketHost(),this._initConnection()}return x(a,[{key:"_setWebsocketHost",value:function(){var t=this._channelModule.getModule(ir),o=Jn;this._channelModule.isOversea()&&(o=Bn),t.isSingaporeSite()?o=Hr:t.isKoreaSite()?o=ei:t.isGermanySite()?o=_t:t.isIndiaSite()&&(o=Rt),me.HOST.setCurrent(o)}},{key:"_initConnection",value:function(){Ke(me.HOST.CURRENT.BACKUP)||this._url===""?this._url=me.HOST.CURRENT.DEFAULT:this._url===me.HOST.CURRENT.DEFAULT?this._url=me.HOST.CURRENT.BACKUP:this._url===me.HOST.CURRENT.BACKUP&&(this._url=me.HOST.CURRENT.DEFAULT);var t=this._channelModule.getModule(ir).getProxyServer();Mt(t)||(this._url=t),this._connect(),this._nextPingTs=0}},{key:"onCheckTimer",value:function(t){t%1==0&&this._checkPromiseMap()}},{key:"_checkPromiseMap",value:function(){var t=this;this._promiseMap.size!==0&&this._promiseMap.forEach(function(o,e){var n=o.reject,l=o.timestamp,h=15e3;e.indexOf(_o)!==-1&&(h=9e4),Date.now()-l>=h&&(V.log("".concat(t._className,"._checkPromiseMap request timeout, delete requestID:").concat(e)),t._promiseMap.delete(e),n(new Me({code:We.NETWORK_TIMEOUT,message:at.NETWORK_TIMEOUT})),t._channelModule.onRequestTimeout(e))})}},{key:"onOpen",value:function(t){if(this._readyState!==""){this._onOpenTs=Date.now();var o=t.id;this._socketID=o;var e=Date.now()-this._startTs;V.log("".concat(this._className,"._onOpen cost ").concat(e," ms. socketID:").concat(o)),new ht(yt.WS_ON_OPEN).setMessage(e).setCostTime(e).setMoreMessage("socketID:".concat(o)).end(),t.id===this._socketID&&(this._readyState=Rv,this._reConnectCount=0,this._resend(),this._reConnectFlag===!0&&(this._channelModule.onReconnected(),this._reConnectFlag=!1),this._channelModule.onOpen())}}},{key:"onClose",value:function(t){var o=new ht(yt.WS_ON_CLOSE),e=t.id,n=t.e,l="sourceSocketID:".concat(e," currentSocketID:").concat(this._socketID," code:").concat(n.code," reason:").concat(n.reason),h=0;this._onOpenTs!==0&&(h=Date.now()-this._onOpenTs),o.setMessage(h).setCostTime(h).setMoreMessage(l).setCode(n.code).end(),V.log("".concat(this._className,"._onClose ").concat(l," onlineTime:").concat(h)),e===this._socketID&&(this._readyState=fS,h<1e3?this._channelModule.onReconnectFailed():this._channelModule.onClose())}},{key:"onError",value:function(t){var o=t.id,e=t.e,n="sourceSocketID:".concat(o," currentSocketID:").concat(this._socketID);new ht(yt.WS_ON_ERROR).setMessage(e.errMsg||Z_(e)).setMoreMessage(n).setLevel("error").end(),V.warn("".concat(this._className,"._onError"),e,n),o===this._socketID&&(this._readyState="",this._channelModule.onError())}},{key:"onMessage",value:function(t){var o;try{o=JSON.parse(t.data)}catch{new ht(yt.JSON_PARSE_ERROR).setMessage(t.data).end()}if(o&&o.head){var e=this._getRequestIDFromHead(o.head),n=W0(o.head),l=TE(o.body,this._getResponseKeyMap(n));if(V.debug("".concat(this._className,".onMessage ret:").concat(JSON.stringify(l)," requestID:").concat(e," has:").concat(this._promiseMap.has(e))),this._setNextPingTs(),this._promiseMap.has(e)){var h=this._promiseMap.get(e),_=h.resolve,S=h.reject,E=h.timestamp;return this._promiseMap.delete(e),this._calcRTT(E),void(l.errorCode&&l.errorCode!==0?(this._channelModule.onErrorCodeNotZero(l),S(new Me({code:l.errorCode,message:l.errorInfo||"",data:{elements:l.elements,messageVersion:l.messageVersion,cloudCustomData:l.cloudCustomData}}))):_(Wt(l)))}this._channelModule.onMessage({head:o.head,body:l})}}},{key:"_calcRTT",value:function(t){var o=Date.now()-t;this._channelModule.getModule(Ur).addRTT(o)}},{key:"_connect",value:function(){this._startTs=Date.now(),this._onOpenTs=0,this._socket=new SC(this),this._socketID=this._socket.getID(),this._readyState=HE,V.log("".concat(this._className,"._connect isWorkerEnabled:").concat(this.getIsWorkerEnabled()," socketID:").concat(this._socketID," url:").concat(this.getURL())),new ht(yt.WS_CONNECT).setMessage("socketID:".concat(this._socketID," url:").concat(this.getURL())).end()}},{key:"getURL",value:function(){var t=this._channelModule.getModule(ir);t.isDevMode()&&(this._canIUseBinaryFrame=!1);var o=ed();(Xt||Wn&&o==="windows"||tr)&&(this._canIUseBinaryFrame=!1);var e=-1;o==="ios"?e=O0||-1:o==="android"&&(e=kT||-1);var n=this._channelModule.getPlatform(),l=t.getSDKAppID(),h=t.getInstanceID();return this._canIUseBinaryFrame?"".concat(this._url,"/binfo?sdkappid=").concat(l,"&instanceid=").concat(h,"&random=").concat(this._getRandom(),"&platform=").concat(n,"&host=").concat(o,"&version=").concat(e):"".concat(this._url,"/info?sdkappid=").concat(l,"&instanceid=").concat(h,"&random=").concat(this._getRandom(),"&platform=").concat(n,"&host=").concat(o,"&version=").concat(e)}},{key:"_closeConnection",value:function(t){V.log("".concat(this._className,"._closeConnection socketID:").concat(this._socketID)),this._socket&&(this._socket.close(t),this._socketID=-1,this._socket=null,this._readyState=fS)}},{key:"_resend",value:function(){var t=this;if(V.log("".concat(this._className,"._resend reConnectFlag:").concat(this._reConnectFlag),"promiseMap.size:".concat(this._promiseMap.size," simpleRequestMap.size:").concat(this._simpleRequestMap.size)),this._promiseMap.size>0&&this._promiseMap.forEach(function(_,S){var E=_.uplinkData,M=_.resolve,w=_.reject;t._promiseMap.set(S,{resolve:M,reject:w,timestamp:Date.now(),uplinkData:E}),t._execute(S,E)}),this._simpleRequestMap.size>0){var o,e=De(this._simpleRequestMap);try{for(e.s();!(o=e.n()).done;){var n=Ue(o.value,2),l=n[0],h=n[1];this._execute(l,h)}}catch(_){e.e(_)}finally{e.f()}this._simpleRequestMap.clear()}}},{key:"send",value:function(t){var o=this;t.head.seq=this._getSequence(),t.head.reqtime=Math.floor(Date.now()/1e3),t.keyMap;var e=se(t,Pk),n=this._getRequestIDFromHead(t.head),l=JSON.stringify(e);return new Promise(function(h,_){o._promiseMap.set(n,{resolve:h,reject:_,timestamp:Date.now(),uplinkData:l}),V.debug("".concat(o._className,".send uplinkData:").concat(JSON.stringify(e)," requestID:").concat(n," readyState:").concat(o._readyState)),o._readyState!==Rv?o._reConnect():(o._execute(n,l),o._channelModule.getModule(Ur).addRequestCount())})}},{key:"simplySend",value:function(t){t.head.seq=this._getSequence(),t.head.reqtime=Math.floor(Date.now()/1e3),t.keyMap;var o=se(t,xk),e=this._getRequestIDFromHead(t.head),n=JSON.stringify(o);this._readyState!==Rv?(this._simpleRequestMap.size<this.MAX_SIZE?this._simpleRequestMap.set(e,n):V.log("".concat(this._className,".simplySend. simpleRequestMap is full, drop request!")),this._reConnect()):this._execute(e,n)}},{key:"_execute",value:function(t,o){this._socket.send({data:o,fail:tn?this._onSendFail.bind(this):void 0,requestID:t})}},{key:"_onSendFail",value:function(t){V.log("".concat(this._className,"._onSendFail requestID:").concat(t))}},{key:"_getSequence",value:function(){var t;if(this._startSequence<2415919103)return t=this._startSequence,this._startSequence+=1,this._startSequence===2415919103&&(this._startSequence=cs()),t}},{key:"_getRequestIDFromHead",value:function(t){return t.servcmd+t.seq}},{key:"_getResponseKeyMap",value:function(t){var o=this._channelModule.getKeyMap(t);return m(m({},Vh.response),o.response)}},{key:"_reConnect",value:function(){this._readyState!==Rv&&this._readyState!==HE&&this.forcedReconnect()}},{key:"forcedReconnect",value:function(){var t=this;V.log("".concat(this._className,".forcedReconnect count:").concat(this._reConnectCount," readyState:").concat(this._readyState)),this._reConnectFlag=!0,this._resetRandom(),this._reConnectCount<this.MAX_RECONNECT_COUNT?(this._reConnectCount+=1,this._closeConnection(pS),this._initConnection()):(this._reConnectCount=0,this._channelModule.probeNetwork().then(function(o){var e=Ue(o,2),n=e[0];e[1],n?(V.warn("".concat(t._className,".forcedReconnect disconnected from wsserver but network is ok, continue...")),t._closeConnection(pS),t._initConnection()):t._channelModule.onReconnectFailed()}))}},{key:"getReconnectFlag",value:function(){return this._reConnectFlag}},{key:"_setNextPingTs",value:function(){this._nextPingTs=Date.now()+1e4}},{key:"getNextPingTs",value:function(){return this._nextPingTs}},{key:"isConnected",value:function(){return this._readyState===Rv}},{key:"canIUseBinaryFrame",value:function(){return this._canIUseBinaryFrame}},{key:"setIsWorkerEnabled",value:function(t){V.log("".concat(this._className,".setIsWorkerEnabled flag:").concat(t)),this._isWorkerEnabled=t}},{key:"getIsWorkerEnabled",value:function(){return this._isWorkerEnabled&&mh}},{key:"_getRandom",value:function(){return this._random===0&&(this._random=Math.random()),this._random}},{key:"_resetRandom",value:function(){this._random=0}},{key:"close",value:function(){V.log("".concat(this._className,".close")),this._closeConnection(Lk),this._promiseMap.clear(),this._startSequence=cs(),this._readyState=fS,this._simpleRequestMap.clear(),this._reConnectFlag=!1,this._reConnectCount=0,this._onOpenTs=0,this._url="",this._random=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0}}]),a}(),Gk=function(a){B(o,a);var t=Xe(o);function o(e){var n;if(A(this,o),(n=t.call(this,e))._className="ChannelModule",n._socketHandler=new Uk(Ae(n)),n._probing=!1,n._isAppShowing=!0,n._previousState=Z.NET_STATE_CONNECTED,tn&&typeof Rn.onAppShow=="function"&&typeof Rn.onAppHide=="function"){var l=n._onAppHide.bind(Ae(n)),h=n._onAppShow.bind(Ae(n));typeof Rn.offAppHide=="function"&&Rn.offAppHide(l),typeof Rn.offAppShow=="function"&&Rn.offAppShow(h),Rn.onAppHide(l),Rn.onAppShow(h)}return n._timerForNotLoggedIn=-1,n._timerForNotLoggedIn=setInterval(n.onCheckTimer.bind(Ae(n)),1e3),n._fatalErrorFlag=!1,n}return x(o,[{key:"onCheckTimer",value:function(e){this._socketHandler&&(this.isLoggedIn()?(this._timerForNotLoggedIn>0&&(clearInterval(this._timerForNotLoggedIn),this._timerForNotLoggedIn=-1),this._socketHandler.onCheckTimer(e)):this._socketHandler.onCheckTimer(1),this._checkNextPing())}},{key:"onErrorCodeNotZero",value:function(e){this.getModule(Ua).onErrorCodeNotZero(e)}},{key:"onMessage",value:function(e){this.getModule(Ua).onMessage(e)}},{key:"send",value:function(e){return this._socketHandler?this._previousState!==Z.NET_STATE_CONNECTED&&e.head.servcmd.includes(Wu)?(this.reConnect(),this._sendLogViaHTTP(e)):this._socketHandler.send(e):Promise.reject()}},{key:"_sendLogViaHTTP",value:function(e){var n=me.HOST.CURRENT.STAT;return new Promise(function(l,h){var _="".concat(n,"/v4/imopenstat/tim_web_report_v2?sdkappid=").concat(e.head.sdkappid,"&reqtime=").concat(Date.now()),S=JSON.stringify(e.body),E="application/x-www-form-urlencoded;charset=UTF-8";if(tn)Rn.request({url:_,data:S,method:"POST",timeout:3e3,header:{"content-type":E},success:function(){l()},fail:function(){h(new Me({code:We.NETWORK_ERROR,message:at.NETWORK_ERROR}))}});else{var M=new XMLHttpRequest,w=setTimeout(function(){M.abort(),h(new Me({code:We.NETWORK_TIMEOUT,message:at.NETWORK_TIMEOUT}))},3e3);M.onreadystatechange=function(){M.readyState===4&&(clearTimeout(w),M.status===200||M.status===304?l():h(new Me({code:We.NETWORK_ERROR,message:at.NETWORK_ERROR})))},M.open("POST",_,!0),M.setRequestHeader("Content-type",E),M.send(S)}})}},{key:"simplySend",value:function(e){return this._socketHandler?this._socketHandler.simplySend(e):Promise.reject()}},{key:"onOpen",value:function(){this._ping()}},{key:"onClose",value:function(){this._socketHandler&&this._socketHandler.getReconnectFlag()&&this._emitNetStateChangeEvent(Z.NET_STATE_DISCONNECTED),this.reConnect()}},{key:"onError",value:function(){tn&&!tr&&V.error("".concat(this._className,".onError \u4ECEv2.11.2\u8D77\uFF0CSDK \u652F\u6301\u4E86 WebSocket\uFF0C\u5982\u60A8\u672A\u6DFB\u52A0\u76F8\u5173\u53D7\u4FE1\u57DF\u540D\uFF0C\u8BF7\u5148\u6DFB\u52A0\uFF01(\u5982\u5DF2\u6DFB\u52A0\u8BF7\u5FFD\u7565)\uFF0C\u5347\u7EA7\u6307\u5F15: https://web.sdk.qcloud.com/im/doc/zh-cn/tutorial-02-upgradeguideline.html")),this._emitNetStateChangeEvent(Z.NET_STATE_DISCONNECTED)}},{key:"getKeyMap",value:function(e){return this.getModule(Ua).getKeyMap(e)}},{key:"_onAppHide",value:function(){this._isAppShowing=!1}},{key:"_onAppShow",value:function(){this._isAppShowing=!0}},{key:"onRequestTimeout",value:function(e){}},{key:"onReconnected",value:function(){V.log("".concat(this._className,".onReconnected")),this.getModule(Ua).onReconnected(),this._emitNetStateChangeEvent(Z.NET_STATE_CONNECTED)}},{key:"onReconnectFailed",value:function(){V.log("".concat(this._className,".onReconnectFailed")),this._emitNetStateChangeEvent(Z.NET_STATE_DISCONNECTED)}},{key:"setIsWorkerEnabled",value:function(e){this._socketHandler&&this._socketHandler.setIsWorkerEnabled(!1)}},{key:"offline",value:function(){this._emitNetStateChangeEvent(Z.NET_STATE_DISCONNECTED)}},{key:"reConnect",value:function(){var e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=!1;this._socketHandler&&(n=this._socketHandler.getReconnectFlag());var l="forcedFlag:".concat(e," fatalErrorFlag:").concat(this._fatalErrorFlag," previousState:").concat(this._previousState," reconnectFlag:").concat(n);if(V.log("".concat(this._className,".reConnect ").concat(l)),!this._fatalErrorFlag&&this._socketHandler){if(e===!0)this._socketHandler.forcedReconnect();else{if(this._previousState===Z.NET_STATE_CONNECTING&&n)return;this._socketHandler.forcedReconnect()}this._emitNetStateChangeEvent(Z.NET_STATE_CONNECTING)}}},{key:"_emitNetStateChangeEvent",value:function(e){this._previousState!==e&&(V.log("".concat(this._className,"._emitNetStateChangeEvent from ").concat(this._previousState," to ").concat(e)),this._previousState=e,this.emitOuterEvent(mn.NET_STATE_CHANGE,{state:e}))}},{key:"_ping",value:function(){var e=this;if(this._probing!==!0){this._probing=!0;var n=this.getModule(Ua).getProtocolData({protocolName:fM});this.send(n).then(function(){e._probing=!1}).catch(function(l){if(V.warn("".concat(e._className,"._ping failed. error:"),l),e._probing=!1,l&&l.code===60002)return new ht(yt.ERROR).setMessage("code:".concat(l.code," message:").concat(l.message)).setNetworkType(e.getModule(wh).getNetworkType()).end(),e._fatalErrorFlag=!0,void e._emitNetStateChangeEvent(Z.NET_STATE_DISCONNECTED);e.probeNetwork().then(function(h){var _=Ue(h,2),S=_[0],E=_[1];V.log("".concat(e._className,"._ping failed. probe network, isAppShowing:").concat(e._isAppShowing," online:").concat(S," networkType:").concat(E)),S?e.reConnect():e._emitNetStateChangeEvent(Z.NET_STATE_DISCONNECTED)})})}}},{key:"_checkNextPing",value:function(){this._socketHandler&&this._socketHandler.isConnected()&&Date.now()>=this._socketHandler.getNextPingTs()&&this._ping()}},{key:"dealloc",value:function(){this._socketHandler&&(this._socketHandler.close(),this._socketHandler=null),this._timerForNotLoggedIn>-1&&clearInterval(this._timerForNotLoggedIn)}},{key:"onRestApiKickedOut",value:function(){this._socketHandler&&(this._socketHandler.close(),this.reConnect(!0))}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),this._previousState=Z.NET_STATE_CONNECTED,this._probing=!1,this._fatalErrorFlag=!1,this._timerForNotLoggedIn=setInterval(this.onCheckTimer.bind(this),1e3)}}]),o}(Ti),Fk=["a2","tinyid"],Cv=["a2","tinyid"],gS=function(){function a(t){A(this,a),this._className="ProtocolHandler",this._sessionModule=t,this._configMap=new Map,this._fillConfigMap()}return x(a,[{key:"_fillConfigMap",value:function(){this._configMap.clear();var t=this._sessionModule.genCommonHead(),o=this._sessionModule.genCosSpecifiedHead(),e=this._sessionModule.genSSOReportHead();this._configMap.set(_o,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.IM_OPEN_STATUS,".").concat(me.CMD.LOGIN)}),body:{state:"Online"},keyMap:{response:{InstId:"instanceID",HelloInterval:"helloInterval"}}}}(t)),this._configMap.set(JT,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.IM_OPEN_STATUS,".").concat(me.CMD.LOGOUT)}),body:{type:0},keyMap:{request:{type:"wslogout_type"}}}}(t)),this._configMap.set(Jm,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.IM_OPEN_STATUS,".").concat(me.CMD.HELLO)}),body:{},keyMap:{response:{NewInstInfo:"newInstanceInfo"}}}}(t)),this._configMap.set(XT,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.STAT_SERVICE,".").concat(me.CMD.KICK_OTHER)}),body:{}}}(t)),this._configMap.set(Dh,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.IM_COS_SIGN,".").concat(me.CMD.COS_SIGN)}),body:{cmd:"open_im_cos_svc",subCmd:"get_cos_token",duration:300,version:2},keyMap:{request:{userSig:"usersig",subCmd:"sub_cmd",cmd:"cmd",duration:"duration",version:"version"},response:{expired_time:"expiredTime",bucket_name:"bucketName",session_token:"sessionToken",tmp_secret_id:"secretId",tmp_secret_key:"secretKey"}}}}(o)),this._configMap.set(My,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.CUSTOM_UPLOAD,".").concat(me.CMD.COS_PRE_SIG)}),body:{fileType:void 0,fileName:void 0,uploadMethod:0,duration:900},keyMap:{request:{userSig:"usersig",fileType:"file_type",fileName:"file_name",uploadMethod:"upload_method"},response:{expired_time:"expiredTime",request_id:"requestId",head_url:"headUrl",upload_url:"uploadUrl",download_url:"downloadUrl",ci_url:"ciUrl",snapshot_url:"requestSnapshotUrl"}}}}(o)),this._configMap.set(Ga,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.CUSTOM_UPLOAD,".").concat(me.CMD.VIDEO_COVER)}),body:{version:1,platform:void 0,coverName:void 0,requestSnapshotUrl:void 0},keyMap:{request:{version:"version",platform:"platform",coverName:"cover_name",requestSnapshotUrl:"snapshot_url"},response:{error_code:"errorCode",error_msg:"errorInfo",download_url:"snapshotUrl"}}}}(o)),this._configMap.set(NI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.IM_CONFIG_MANAGER,".").concat(me.CMD.FETCH_COMMERCIAL_CONFIG)}),body:{SDKAppID:0},keyMap:{request:{SDKAppID:"uint32_sdkappid"},response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}}(t)),this._configMap.set(qb,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.IM_CONFIG_MANAGER,".").concat(me.CMD.PUSHED_COMMERCIAL_CONFIG)}),body:{},keyMap:{response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}}(t)),this._configMap.set(OI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.IM_CONFIG_MANAGER,".").concat(me.CMD.FETCH_CLOUD_CONTROL_CONFIG)}),body:{SDKAppID:0,version:0},keyMap:{request:{SDKAppID:"uint32_sdkappid",version:"uint64_version"},response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}}(t)),this._configMap.set(jb,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.IM_CONFIG_MANAGER,".").concat(me.CMD.PUSHED_CLOUD_CONTROL_CONFIG)}),body:{},keyMap:{response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}}(t)),this._configMap.set(Hb,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.OVERLOAD_PUSH,".").concat(me.CMD.OVERLOAD_NOTIFY)}),body:{},keyMap:{response:{OverLoadServCmd:"overloadCommand",DelaySecs:"waitingTime"}}}}(t)),this._configMap.set(py,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.OPEN_IM,".").concat(me.CMD.GET_MESSAGES)}),body:{cookie:"",syncFlag:0,needAbstract:1,isOnlineSync:0},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",from:"From_Account",to:"To_Account",time:"MsgTimeStamp",sequence:"MsgSeq",random:"MsgRandom",elements:"MsgBody"},response:{MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",ClientSeq:"clientSequence",MsgSeq:"sequence",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgRandom:"random",MsgTimeStamp:"time",MsgContent:"content",ToGroupId:"groupID",MsgKey:"messageKey",GroupTips:"groupTips",MsgBody:"elements",MsgType:"type",C2CRemainingUnreadCount:"C2CRemainingUnreadList",C2CPairUnreadCount:"C2CPairUnreadList"}}}}(t)),this._configMap.set(QT,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.OPEN_IM,".").concat(me.CMD.BIG_DATA_HALLWAY_AUTH_KEY)}),body:{}}}(t)),this._configMap.set(fy,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.OPEN_IM,".").concat(me.CMD.SEND_MESSAGE)}),body:{fromAccount:"",toAccount:"",msgSeq:0,msgRandom:0,msgBody:[],cloudCustomData:void 0,nick:"",avatar:"",msgLifeTime:void 0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{badgeMode:0},androidInfo:{OPPOChannelID:""}},messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",count:"MaxCnt",lastMessageTime:"LastMsgTime",messageKey:"MsgKey",peerAccount:"Peer_Account",data:"Data",description:"Desc",extension:"Ext",type:"MsgType",content:"MsgContent",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",nick:"From_AccountNick",avatar:"From_AccountHeadurl",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"IsNeedReadReceipt"}}}}(t)),this._configMap.set(cI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.SEND_GROUP_MESSAGE)}),body:{fromAccount:"",groupID:"",random:0,clientSequence:0,priority:"",msgBody:[],cloudCustomData:void 0,onlineOnlyFlag:0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{badgeMode:0},androidInfo:{OPPOChannelID:""}},groupAtInfo:[],messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,topicID:void 0},keyMap:{request:{to:"GroupId",extension:"Ext",data:"Data",description:"Desc",random:"Random",sequence:"ReqMsgSeq",count:"ReqMsgNumber",type:"MsgType",priority:"MsgPriority",content:"MsgContent",elements:"MsgBody",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",clientSequence:"ClientSeq",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"NeedReadReceipt"},response:{MsgTime:"time",MsgSeq:"sequence"}}}}(t)),this._configMap.set(dI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.OPEN_IM,".").concat(me.CMD.REVOKE_C2C_MESSAGE)}),body:{msgInfo:{fromAccount:"",toAccount:"",msgTimeStamp:0,msgSeq:0,msgRandom:0}},keyMap:{request:{msgInfo:"MsgInfo",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom"}}}}(t)),this._configMap.set(AI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.REVOKE_GROUP_MESSAGE)}),body:{groupID:"",msgSeqList:void 0,topicID:""},keyMap:{request:{msgSeqList:"MsgSeqList",msgSeq:"MsgSeq"}}}}(t)),this._configMap.set(gy,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.OPEN_IM,".").concat(me.CMD.GET_C2C_ROAM_MESSAGES)}),body:{peerAccount:"",count:15,lastMessageTime:0,messageKey:"",withRecalledMessage:1,direction:0},keyMap:{request:{messageKey:"MsgKey",peerAccount:"Peer_Account",count:"MaxCnt",lastMessageTime:"LastMsgTime",withRecalledMessage:"WithRecalledMsg",direction:"GetDirection"},response:{LastMsgTime:"lastMessageTime",IsNeedReadReceipt:"needReadReceipt"}}}}(t)),this._configMap.set(mI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.OPEN_IM,".").concat(me.CMD.MODIFY_C2C_MESSAGE)}),body:{from:"",to:"",sequence:0,random:0,time:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{request:{sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}}(t)),this._configMap.set(Wr,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.GET_GROUP_ROAM_MESSAGES)}),body:{withRecalledMsg:1,groupID:"",count:15,sequence:"",topicID:void 0},keyMap:{request:{sequence:"ReqMsgSeq",count:"ReqMsgNumber",withRecalledMessage:"WithRecalledMsg"},response:{Random:"random",MsgTime:"time",MsgSeq:"sequence",ReqMsgSeq:"sequence",RspMsgList:"messageList",IsPlaceMsg:"isPlaceMessage",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgPriority:"priority",MsgBody:"elements",MsgType:"type",MsgContent:"content",IsFinished:"complete",Download_Flag:"downloadFlag",ClientSeq:"clientSequence",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",ToTopicId:"topicID"}}}}(t)),this._configMap.set(nM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.OPEN_IM,".").concat(me.CMD.SET_C2C_MESSAGE_READ)}),body:{C2CMsgReaded:void 0},keyMap:{request:{lastMessageTime:"LastedMsgTime"}}}}(t)),this._configMap.set(hI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.OPEN_IM,".").concat(me.CMD.SET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{userIDList:void 0,muteFlag:0},keyMap:{request:{userIDList:"Peer_Account",muteFlag:"Mute_Notifications"}}}}(t)),this._configMap.set(pI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.OPEN_IM,".").concat(me.CMD.GET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{updateSequence:0},keyMap:{response:{MuteNotificationsList:"muteFlagList"}}}}(t)),this._configMap.set(kI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.SET_GROUP_MESSAGE_READ)}),body:{groupID:void 0,messageReadSeq:void 0,topicID:void 0},keyMap:{request:{messageReadSeq:"MsgReadedSeq"}}}}(t)),this._configMap.set(Xr,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.OPEN_IM,".").concat(me.CMD.SET_ALL_MESSAGE_READ)}),body:{readAllC2CMessage:0,groupMessageReadInfoList:[]},keyMap:{request:{readAllC2CMessage:"C2CReadAllMsg",groupMessageReadInfoList:"GroupReadInfo",messageSequence:"MsgSeq"},response:{C2CReadAllMsg:"readAllC2CMessage",GroupReadInfoArray:"groupMessageReadInfoList"}}}}(t)),this._configMap.set(gI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.OPEN_IM,".").concat(me.CMD.DELETE_C2C_MESSAGE)}),body:{fromAccount:"",to:"",keyList:void 0},keyMap:{request:{keyList:"MsgKeyList"}}}}(t)),this._configMap.set(oM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.DELETE_GROUP_MESSAGE)}),body:{groupID:"",deleter:"",keyList:void 0,topicID:void 0},keyMap:{request:{deleter:"Deleter_Account",keyList:"Seqs"}}}}(t)),this._configMap.set(aM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.OPEN_IM,".").concat(me.CMD.MODIFY_GROUP_MESSAGE)}),body:{groupID:"",topicID:void 0,sequence:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{request:{sequence:"MsgSeq",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}}(t)),this._configMap.set(la,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.GET_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{request:{sequence:"MsgSeq"}}}}(t)),this._configMap.set($u,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.OPEN_IM,".").concat(me.CMD.SEND_C2C_READ_RECEIPT)}),body:{peerAccount:"",messageInfoList:void 0},keyMap:{request:{peerAccount:"Peer_Account",messageInfoList:"C2CMsgInfo",fromAccount:"From_Account",toAccount:"To_Account",sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",clientTime:"MsgClientTime"}}}}(t)),this._configMap.set(rM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.SEND_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{request:{sequenceList:"MsgSeqList",sequence:"MsgSeq"}}}}(t)),this._configMap.set(Ku,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.GET_READ_RECEIPT_DETAIL)}),body:{groupID:"",sequence:void 0,flag:0,cursor:0,count:0},keyMap:{request:{sequence:"MsgSeq",count:"Num"},response:{ReadList:"readUserIDList",Read_Account:"userID",UnreadList:"unreadUserIDList",Unread_Account:"userID",IsFinish:"isCompleted"}}}}(t)),this._configMap.set(fI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.OPEN_IM,".").concat(me.CMD.GET_PEER_READ_TIME)}),body:{userIDList:void 0},keyMap:{request:{userIDList:"To_Account"},response:{ReadTime:"peerReadTimeList"}}}}(t)),this._configMap.set(vy,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.RECENT_CONTACT,".").concat(me.CMD.GET_CONVERSATION_LIST)}),body:{fromAccount:void 0,count:0},keyMap:{request:{},response:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime"}}}}(t)),this._configMap.set(vI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.RECENT_CONTACT,".").concat(me.CMD.PAGING_GET_CONVERSATION_LIST)}),body:{fromAccount:void 0,timeStamp:void 0,startIndex:void 0,pinnedTimeStamp:void 0,pinnedStartIndex:void 0,orderType:void 0,messageAssistFlag:4,assistFlag:15},keyMap:{request:{messageAssistFlag:"MsgAssistFlags",assistFlag:"AssistFlags",pinnedTimeStamp:"TopTimeStamp",pinnedStartIndex:"TopStartIndex"},response:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime",LastMsgFlags:"lastMessageFlag",TopFlags:"isPinned",TopTimeStamp:"pinnedTimeStamp",TopStartIndex:"pinnedStartIndex"}}}}(t)),this._configMap.set(_I,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.RECENT_CONTACT,".").concat(me.CMD.DELETE_CONVERSATION)}),body:{fromAccount:"",toAccount:void 0,type:1,toGroupID:void 0,clearHistoryMessage:1},keyMap:{request:{toGroupID:"ToGroupid",clearHistoryMessage:"ClearRamble"}}}}(t)),this._configMap.set(yI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.RECENT_CONTACT,".").concat(me.CMD.PIN_CONVERSATION)}),body:{fromAccount:"",operationType:1,itemList:void 0},keyMap:{request:{itemList:"RecentContactItem"}}}}(t)),this._configMap.set(_f,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.OPEN_IM,".").concat(me.CMD.DELETE_GROUP_AT_TIPS)}),body:{messageListToDelete:void 0},keyMap:{request:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}}(t)),this._configMap.set(uI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.PROFILE,".").concat(me.CMD.PORTRAIT_GET)}),body:{fromAccount:"",userItem:[]},keyMap:{request:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}}(t)),this._configMap.set(ZT,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.PROFILE,".").concat(me.CMD.PORTRAIT_SET)}),body:{fromAccount:"",profileItem:[{tag:Ii.NICK,value:""},{tag:Ii.GENDER,value:""},{tag:Ii.ALLOWTYPE,value:""},{tag:Ii.AVATAR,value:""}]},keyMap:{request:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}}(t)),this._configMap.set(lI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.FRIEND,".").concat(me.CMD.GET_BLACKLIST)}),body:{fromAccount:"",startIndex:0,maxLimited:30,lastSequence:0},keyMap:{response:{CurruentSequence:"currentSequence"}}}}(t)),this._configMap.set(eM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.FRIEND,".").concat(me.CMD.ADD_BLACKLIST)}),body:{fromAccount:"",toAccount:[]}}}(t)),this._configMap.set(tM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.FRIEND,".").concat(me.CMD.DELETE_BLACKLIST)}),body:{fromAccount:"",toAccount:[]}}}(t)),this._configMap.set(EM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.IM_OPEN_STATUS,".").concat(me.CMD.SET_SELF_STATUS)}),body:{customStatus:""},keyMap:{}}}(t)),this._configMap.set(TM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.IM_OPEN_STATUS,".").concat(me.CMD.GET_USER_STATUS)}),body:{userIDList:void 0},keyMap:{response:{UserStatusList:"successUserList",ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID",Status:"statusType"}}}}(t)),this._configMap.set(MM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.IM_OPEN_STATUS,".").concat(me.CMD.SUBSCRIBE_USER_STATUS)}),body:{userIDList:void 0},keyMap:{response:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}}(t)),this._configMap.set(RM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.IM_OPEN_STATUS,".").concat(me.CMD.UNSUBSCRIBE_USER_STATUS)}),body:{userIDList:void 0,unsubscribeAll:void 0},keyMap:{response:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}}(t)),this._configMap.set(Xm,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.GET_JOINED_GROUPS)}),body:{memberAccount:"",limit:void 0,offset:void 0,groupType:void 0,responseFilter:{groupBaseInfoFilter:void 0,selfInfoFilter:void 0},isSupportTopic:0},keyMap:{request:{memberAccount:"Member_Account"},response:{GroupIdList:"groups",NoUnreadSeqList:"excludedUnreadSequenceList",MsgSeq:"readedSequence"}}}}(t)),this._configMap.set(SI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.GET_GROUP_INFO)}),body:{groupIDList:void 0,responseFilter:{groupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember"],groupCustomFieldFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0}},keyMap:{request:{groupIDList:"GroupIdList",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",groupCustomFieldFilter:"AppDefinedDataFilter_Group",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{GroupIdList:"groups",AppDefinedData:"groupCustomField",AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_Group:"groupCustomFieldFilter",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",InfoSeq:"infoSequence",MemberList:"members",GroupInfo:"groups",ShutUpUntil:"muteUntil",ShutUpAllMember:"muteAllMembers"}}}}(t)),this._configMap.set(II,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.CREATE_GROUP)}),body:{type:void 0,name:void 0,groupID:void 0,ownerID:void 0,introduction:void 0,notification:void 0,maxMemberNum:void 0,joinOption:void 0,memberList:void 0,groupCustomField:void 0,memberCustomField:void 0,webPushFlag:1,avatar:"",isSupportTopic:void 0},keyMap:{request:{ownerID:"Owner_Account",userID:"Member_Account",avatar:"FaceUrl",maxMemberNum:"MaxMemberCount",joinOption:"ApplyJoinOption",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData"},response:{HugeGroupFlag:"avChatRoomFlag",OverJoinedGroupLimit_Account:"overLimitUserIDList"}}}}(t)),this._configMap.set(EI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.DESTROY_GROUP)}),body:{groupID:void 0}}}(t)),this._configMap.set(TI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.MODIFY_GROUP_INFO)}),body:{groupID:void 0,name:void 0,introduction:void 0,notification:void 0,avatar:void 0,maxMemberNum:void 0,joinOption:void 0,groupCustomField:void 0,muteAllMembers:void 0},keyMap:{request:{maxMemberNum:"MaxMemberCount",groupCustomField:"AppDefinedData",muteAllMembers:"ShutUpAllMember",joinOption:"ApplyJoinOption",avatar:"FaceUrl"},response:{AppDefinedData:"groupCustomField",ShutUpAllMember:"muteAllMembers"}}}}(t)),this._configMap.set(MI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.APPLY_JOIN_GROUP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1,historyMessageFlag:void 0},keyMap:{request:{applyMessage:"ApplyMsg",historyMessageFlag:"HugeGroupHistoryMsgFlag"},response:{HugeGroupFlag:"avChatRoomFlag",AVChatRoomKey:"avChatRoomKey",RspMsgList:"messageList",ToGroupId:"to"}}}}(t)),this._configMap.set(RI,function(n){return n.a2,n.tinyid,{head:m(m({},se(n,Fk)),{},{servcmd:"".concat(me.NAME.BIG_GROUP_NO_AUTH,".").concat(me.CMD.APPLY_JOIN_GROUP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1},keyMap:{request:{applyMessage:"ApplyMsg"},response:{HugeGroupFlag:"avChatRoomFlag"}}}}(t)),this._configMap.set(CI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.QUIT_GROUP)}),body:{groupID:void 0}}}(t)),this._configMap.set(bI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.SEARCH_GROUP_BY_ID)}),body:{groupIDList:void 0,responseFilter:{groupBasePublicInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption"]}},keyMap:{response:{}}}}(t)),this._configMap.set(_y,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.CHANGE_GROUP_OWNER)}),body:{groupID:void 0,newOwnerID:void 0},keyMap:{request:{newOwnerID:"NewOwner_Account"}}}}(t)),this._configMap.set(yy,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.HANDLE_APPLY_JOIN_GROUP)}),body:{groupID:void 0,applicant:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{request:{applicant:"Applicant_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}}(t)),this._configMap.set(Sy,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.HANDLE_GROUP_INVITATION)}),body:{groupID:void 0,inviter:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{request:{inviter:"Inviter_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}}(t)),this._configMap.set(id,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.GET_GROUP_APPLICATION)}),body:{startTime:void 0,limit:void 0,handleAccount:void 0},keyMap:{request:{handleAccount:"Handle_Account"}}}}(t)),this._configMap.set(Iy,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.OPEN_IM,".").concat(me.CMD.DELETE_GROUP_SYSTEM_MESSAGE)}),body:{messageListToDelete:void 0},keyMap:{request:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}}(t)),this._configMap.set(wI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.BIG_GROUP_LONG_POLLING,".").concat(me.CMD.AVCHATROOM_LONG_POLL)}),body:{USP:1,startSeq:1,startBroadcastSeq:void 0,holdTime:90,key:void 0},keyMap:{request:{USP:"USP"},response:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}}}(t)),this._configMap.set(yf,function(n){return n.a2,n.tinyid,{head:m(m({},se(n,Cv)),{},{servcmd:"".concat(me.NAME.BIG_GROUP_LONG_POLLING_NO_AUTH,".").concat(me.CMD.AVCHATROOM_LONG_POLL)}),body:{USP:1,startSeq:1,holdTime:90,key:void 0},keyMap:{request:{USP:"USP"},response:{ToGroupId:"groupID"}}}}(t)),this._configMap.set(iM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.GET_ONLINE_MEMBER_NUM)}),body:{groupID:void 0}}}(t)),this._configMap.set(sM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.SET_GROUP_ATTRIBUTES)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key",value:"value"}}}}(t)),this._configMap.set(cM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.MODIFY_GROUP_ATTRIBUTES)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key",value:"value"}}}}(t)),this._configMap.set(uM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.DELETE_GROUP_ATTRIBUTES)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key"}}}}(t)),this._configMap.set(lM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.CLEAR_GROUP_ATTRIBUTES)}),body:{groupID:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]}}}(t)),this._configMap.set(Ey,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP_ATTR,".").concat(me.CMD.GET_GROUP_ATTRIBUTES)}),body:{groupID:void 0,avChatRoomKey:void 0,groupType:1},keyMap:{request:{avChatRoomKey:"Key",groupType:"GroupType"}}}}(t)),this._configMap.set(_M,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP_COMMUNITY,".").concat(me.CMD.CREATE_TOPIC)}),body:{groupID:void 0,topicName:void 0,avatar:void 0,customData:void 0,topicID:void 0,notification:void 0,introduction:void 0},keyMap:{request:{avatar:"FaceUrl"}}}}(t)),this._configMap.set(yM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP_COMMUNITY,".").concat(me.CMD.DELETE_TOPIC)}),body:{groupID:void 0,topicIDList:void 0},keyMap:{request:{topicIDList:"TopicIdList"},response:{DestroyResultItem:"resultList"}}}}(t)),this._configMap.set(SM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP_COMMUNITY,".").concat(me.CMD.UPDATE_TOPIC_PROFILE)}),body:{groupID:void 0,topicID:void 0,avatar:void 0,customData:void 0,notification:void 0,introduction:void 0,muteAllMembers:void 0,topicName:void 0},keyMap:{request:{avatar:"FaceUrl",muteAllMembers:"ShutUpAllMember"}}}}(t)),this._configMap.set(IM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP_COMMUNITY,".").concat(me.CMD.GET_TOPIC_LIST)}),body:{groupID:void 0,topicIDList:void 0},keyMap:{request:{topicIDList:"TopicIdList"},response:{TopicAndSelfInfo:"topicInfoList",TopicInfo:"topic",GroupID:"groupID",ShutUpTime:"muteTime",ShutUpAllFlag:"muteAllMembers",LastMsgTime:"lastMessageTime",MsgSeq:"readedSequence",LastMsgSeq:"sequence"}}}}(t)),this._configMap.set(Ty,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.GET_GROUP_MEMBER_LIST)}),body:{groupID:void 0,limit:0,offset:void 0,next:void 0,memberRoleFilter:void 0,memberInfoFilter:["Role","NameCard","ShutUpUntil","JoinTime"],memberCustomFieldFilter:void 0},keyMap:{request:{memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",MemberList:"members",ShutUpUntil:"muteUntil"}}}}(t)),this._configMap.set(dM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.GET_GROUP_MEMBER_INFO)}),body:{groupID:void 0,userIDList:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{request:{userIDList:"Member_List_Account",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{MemberList:"members",ShutUpUntil:"muteUntil",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",AppMemberDefinedData:"memberCustomField"}}}}(t)),this._configMap.set(DI,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.ADD_GROUP_MEMBER)}),body:{groupID:void 0,silence:void 0,userIDList:void 0},keyMap:{request:{userID:"Member_Account",userIDList:"MemberList"},response:{MemberList:"members"}}}}(t)),this._configMap.set(hM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.DELETE_GROUP_MEMBER)}),body:{groupID:void 0,userIDList:void 0,reason:void 0},keyMap:{request:{userIDList:"MemberToDel_Account"}}}}(t)),this._configMap.set(pM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.GROUP,".").concat(me.CMD.MODIFY_GROUP_MEMBER_INFO)}),body:{groupID:void 0,topicID:void 0,userID:void 0,messageRemindType:void 0,nameCard:void 0,role:void 0,memberCustomField:void 0,muteTime:void 0},keyMap:{request:{userID:"Member_Account",memberCustomField:"AppMemberDefinedData",muteTime:"ShutUpTime",messageRemindType:"MsgFlag"}}}}(t)),this._configMap.set(Wu,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.IM_OPEN_STAT,".").concat(me.CMD.TIM_WEB_REPORT_V2)}),body:{header:{},event:[],quality:[]},keyMap:{request:{SDKType:"sdk_type",SDKVersion:"sdk_version",deviceType:"device_type",platform:"platform",instanceID:"instance_id",traceID:"trace_id",SDKAppID:"sdk_app_id",userID:"user_id",tinyID:"tiny_id",extension:"extension",timestamp:"timestamp",networkType:"network_type",eventType:"event_type",code:"error_code",message:"error_message",moreMessage:"more_message",duplicate:"duplicate",costTime:"cost_time",level:"level",qualityType:"quality_type",reportIndex:"report_index",wholePeriod:"whole_period",totalCount:"total_count",rttCount:"success_count_business",successRateOfRequest:"percent_business",countLessThan1Second:"success_count_business",percentOfCountLessThan1Second:"percent_business",countLessThan3Second:"success_count_platform",percentOfCountLessThan3Second:"percent_platform",successCountOfBusiness:"success_count_business",successRateOfBusiness:"percent_business",successCountOfPlatform:"success_count_platform",successRateOfPlatform:"percent_platform",successCountOfMessageReceived:"success_count_business",successRateOfMessageReceived:"percent_business",avgRTT:"average_value",avgDelay:"average_value",avgValue:"average_value",uiPlatform:"ui_platform"}}}}(e)),this._configMap.set(fM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.HEARTBEAT,".").concat(me.CMD.ALIVE)}),body:{}}}(t)),this._configMap.set(Vb,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.IM_OPEN_PUSH,".").concat(me.CMD.MESSAGE_PUSH)}),body:{},keyMap:{response:{C2cMsgArray:"C2CMessageArray",GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",C2cNotifyMsgArray:"C2CNotifyMessageArray",C2cMsgInfo:"C2CReadReceiptArray",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyAdd_Account:"userID",ProfileImNick:"nick",PendencyType:"applicationType",C2CReadAllMsg:"readAllC2CMessage",IsNeedReadReceipt:"needReadReceipt",Status:"statusType"}}}}(t)),this._configMap.set(Bb,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.IM_OPEN_PUSH,".").concat(me.CMD.MULTI_MESSAGE_PUSH)}),body:{},keyMap:{response:{GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyType:"applicationType"}}}}(t)),this._configMap.set(Ry,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.OPEN_IM,".").concat(me.CMD.MESSAGE_PUSH_ACK)}),body:{sessionData:void 0},keyMap:{request:{sessionData:"SessionData"}}}}(t)),this._configMap.set(gM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.IM_OPEN_STATUS,".").concat(me.CMD.STATUS_FORCE_OFFLINE)}),body:{},keyMap:{response:{C2cNotifyMsgArray:"C2CNotifyMessageArray",NoticeSeq:"noticeSequence",KickoutMsgNotify:"kickoutMsgNotify",NewInstInfo:"newInstanceInfo"}}}}(t)),this._configMap.set(vM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.IM_LONG_MESSAGE,".").concat(me.CMD.DOWNLOAD_MERGER_MESSAGE)}),body:{downloadKey:""},keyMap:{response:{Data:"data",Desc:"description",Ext:"extension",Download_Flag:"downloadFlag",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID"}}}}(t)),this._configMap.set(mM,function(n){return{head:m(m({},n),{},{servcmd:"".concat(me.NAME.IM_LONG_MESSAGE,".").concat(me.CMD.UPLOAD_MERGER_MESSAGE)}),body:{messageList:[]},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",type:"MsgType",content:"MsgContent",data:"Data",description:"Desc",extension:"Ext",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody"}}}}(t))}},{key:"has",value:function(t){return this._configMap.has(t)}},{key:"get",value:function(t){return this._configMap.get(t)}},{key:"update",value:function(){this._fillConfigMap()}},{key:"getKeyMap",value:function(t){return this.has(t)?this.get(t).keyMap||{}:(V.warn("".concat(this._className,".getKeyMap unknown protocolName:").concat(t)),{})}},{key:"getProtocolData",value:function(t){var o=t.protocolName,e=t.requestData,n=this.get(o),l=null;if(e){var h=this._simpleDeepCopy(n),_=this._updateService(e,h),S=_.body,E=Object.create(null);for(var M in S)if(Object.prototype.hasOwnProperty.call(S,M)){if(E[M]=S[M],e[M]===void 0)continue;E[M]=e[M]}_.body=E,l=this._getUplinkData(_)}else l=this._getUplinkData(n);return l}},{key:"_getUplinkData",value:function(t){var o=this._requestDataCleaner(t),e=W0(o.head),n=HA(o.body,this._getRequestKeyMap(e));return o.body=n,o}},{key:"_updateService",value:function(t,o){var e=W0(o.head);if(o.head.servcmd.includes(me.NAME.GROUP)){var n=t.type,l=t.groupID,h=l===void 0?void 0:l,_=t.groupIDList,S=_===void 0?[]:_;Ke(h)&&(h=S[0]||""),vo({type:n,groupID:h})&&(o.head.servcmd="".concat(me.NAME.GROUP_COMMUNITY,".").concat(e))}return o}},{key:"_getRequestKeyMap",value:function(t){var o=this.getKeyMap(t);return m(m({},Vh.request),o.request)}},{key:"_requestDataCleaner",value:function(t){var o=Array.isArray(t)?[]:Object.create(null);for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&V0(e)&&t[e]!==null&&t[e]!==void 0&&(R(t[e])!=="object"?o[e]=t[e]:o[e]=this._requestDataCleaner.bind(this)(t[e]));return o}},{key:"_simpleDeepCopy",value:function(t){for(var o,e=Object.keys(t),n={},l=0,h=e.length;l<h;l++)o=e[l],Yt(t[o])?n[o]=Array.from(t[o]):Gc(t[o])?n[o]=this._simpleDeepCopy(t[o]):n[o]=t[o];return n}}]),a}(),IC=[Ry],EC=function(){function a(t){A(this,a),this._sessionModule=t,this._className="DownlinkHandler",this._eventHandlerMap=new Map,this._eventHandlerMap.set("C2CMessageArray",this._c2cMessageArrayHandler.bind(this)),this._eventHandlerMap.set("groupMessageArray",this._groupMessageArrayHandler.bind(this)),this._eventHandlerMap.set("groupTips",this._groupTipsHandler.bind(this)),this._eventHandlerMap.set("C2CNotifyMessageArray",this._C2CNotifyMessageArrayHandler.bind(this)),this._eventHandlerMap.set("C2CReadReceiptArray",this._C2CReadReceiptArrayHandler.bind(this)),this._eventHandlerMap.set("profileModify",this._profileHandler.bind(this)),this._eventHandlerMap.set("friendListMod",this._relationChainHandler.bind(this)),this._eventHandlerMap.set("recentContactMod",this._recentContactHandler.bind(this)),this._eventHandlerMap.set("readAllC2CMessage",this._allMessageReadHandler.bind(this)),this._eventHandlerMap.set("c2cMessageModified",this._c2cMessageModifiedHandler.bind(this)),this._eventHandlerMap.set("groupMessageModified",this._groupMessageModifiedHandler.bind(this)),this._eventHandlerMap.set("userStatusList",this._userStatusListHandler.bind(this)),this._keys=Be(this._eventHandlerMap.keys())}return x(a,[{key:"_c2cMessageArrayHandler",value:function(t){var o=this._sessionModule.getModule(Vi);o&&(t.dataList.forEach(function(e){if(e.isSyncMessage===1){var n=e.from;e.from=e.to,e.to=n}}),t.needSync===1&&this._sessionModule.getModule(rd).startOnlineSync(),o.onNewC2CMessage({dataList:t.dataList,isInstantMessage:!0}))}},{key:"_c2cMessageModifiedHandler",value:function(t){var o=this._sessionModule.getModule(Vi);o&&o.onC2CMessageModified(t)}},{key:"_groupMessageArrayHandler",value:function(t){var o=this._sessionModule.getModule(pn);o&&o.onNewGroupMessage({event:t.event,dataList:t.dataList,isInstantMessage:!0})}},{key:"_groupMessageModifiedHandler",value:function(t){var o=this._sessionModule.getModule(pn);o&&o.onGroupMessageModified(t)}},{key:"_groupTipsHandler",value:function(t){var o=this._sessionModule.getModule(pn);if(o){var e=t.event,n=t.dataList,l=t.isInstantMessage,h=l===void 0||l,_=t.isSyncingEnded;switch(e){case 4:case 6:o.onNewGroupTips({event:e,dataList:n});break;case 5:n.forEach(function(S){Yt(S.elements.revokedInfos)?o.onGroupMessageRevoked({dataList:n}):Yt(S.elements.groupMessageReadNotice)?o.onGroupMessageReadNotice({dataList:n}):Yt(S.elements.readReceiptList)?o.onReadReceiptList({dataList:n}):o.onNewGroupSystemNotice({dataList:n,isInstantMessage:h,isSyncingEnded:_})});break;case 12:this._sessionModule.getModule(Vt).onNewGroupAtTips({dataList:n});break;default:V.log("".concat(this._className,"._groupTipsHandler unknown event:").concat(e," dataList:"),n)}}}},{key:"_C2CNotifyMessageArrayHandler",value:function(t){var o=this,e=t.dataList;if(Yt(e)){var n=this._sessionModule.getModule(Vi);e.forEach(function(l){if(Br(l))if(l.hasOwnProperty("kickoutMsgNotify")){var h=l.kickoutMsgNotify,_=h.kickType,S=h.newInstanceInfo,E=S===void 0?{}:S;_===1?o._sessionModule.onMultipleAccountKickedOut(E):_===2?o._sessionModule.onMultipleDeviceKickedOut(E):_===3&&o._sessionModule.onRestApiKickedOut(E)}else l.hasOwnProperty("c2cMessageRevokedNotify")?n&&n.onC2CMessageRevoked({dataList:e}):l.hasOwnProperty("c2cMessageReadReceipt")?n&&n.onC2CMessageReadReceipt({dataList:e}):l.hasOwnProperty("c2cMessageReadNotice")?n&&n.onC2CMessageReadNotice({dataList:e}):l.hasOwnProperty("muteNotificationsSync")&&o._sessionModule.getModule(Vt).onC2CMessageRemindTypeSynced({dataList:e})})}}},{key:"_C2CReadReceiptArrayHandler",value:function(t){this._sessionModule.getModule(Vi).onReadReceiptList(t)}},{key:"_profileHandler",value:function(t){this._sessionModule.getModule(Ei).onProfileModified({dataList:t.dataList});var o=this._sessionModule.getModule(ni);o&&o.onFriendProfileModified({dataList:t.dataList})}},{key:"_relationChainHandler",value:function(t){this._sessionModule.getModule(Ei).onRelationChainModified({dataList:t.dataList});var o=this._sessionModule.getModule(ni);o&&o.onRelationChainModified({dataList:t.dataList})}},{key:"_recentContactHandler",value:function(t){var o=t.dataList;if(Yt(o)){var e=this._sessionModule.getModule(Vt);e&&o.forEach(function(n){var l=n.pushType,h=n.recentContactTopItem,_=n.recentContactDeleteItem;l===1?e.onConversationDeleted(_.recentContactList):l===2?e.onConversationPinned(h.recentContactList):l===3&&e.onConversationUnpinned(h.recentContactList)})}}},{key:"_allMessageReadHandler",value:function(t){var o=t.dataList,e=this._sessionModule.getModule(Vt);e&&e.onPushedAllMessageRead(o)}},{key:"_userStatusListHandler",value:function(t){this._sessionModule.getModule(Ei).onUserStatusUpdated(t)}},{key:"onMessage",value:function(t){var o=this,e=t.body;if(this._filterMessageFromIMOpenPush(t)){var n=e.eventArray,l=e.isInstantMessage,h=e.isSyncingEnded,_=e.needSync;if(Yt(n))for(var S=null,E=null,M=0,w=0,L=n.length;w<L;w++){M=(S=n[w]).event;var H=Object.keys(S).find(function(ne){return o._keys.indexOf(ne)!==-1});H?(E=M===14?{readAllC2CMessage:S[H],groupMessageReadInfoList:S.groupMessageReadNotice||[]}:M===16?{userID:S.userID,readReceiptList:S[H]}:S[H],this._eventHandlerMap.get(H)({event:M,dataList:E,isInstantMessage:l,isSyncingEnded:h,needSync:_})):V.log("".concat(this._className,".onMessage unknown eventItem:").concat(S))}}}},{key:"_filterMessageFromIMOpenPush",value:function(t){var o=t.head,e=t.body,n=o.servcmd,l=!1;if(Ke(n)||(l=n.includes(me.NAME.IM_CONFIG_MANAGER)||n.includes(me.NAME.OVERLOAD_PUSH)||n.includes(me.NAME.STAT_SERVICE)),!l)return!0;if(n.includes(me.CMD.PUSHED_CLOUD_CONTROL_CONFIG))this._sessionModule.getModule(hy).onPushedCloudControlConfig(e);else if(n.includes(me.CMD.PUSHED_COMMERCIAL_CONFIG))this._sessionModule.getModule(vf).onPushedConfig(e);else if(n.includes(me.CMD.OVERLOAD_NOTIFY))this._sessionModule.onPushedServerOverload(e);else if(n.includes(me.CMD.KICK_OTHER)){var h=Date.now();this._sessionModule.reLoginOnKickOther();var _=new ht(yt.KICK_OTHER),S=this._sessionModule.getModule(qu).getLastWsHelloTs(),E=h-S;_.setMessage("last wshello time:".concat(S," diff:").concat(E,"ms")).setNetworkType(this._sessionModule.getNetworkType()).end()}return!1}}]),a}(),mS=[{cmd:me.CMD.GET_GROUP_INFO,interval:1,count:20},{cmd:me.CMD.GET_TOPIC_LIST,interval:1,count:10},{cmd:me.CMD.SET_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:me.CMD.MODIFY_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:me.CMD.DELETE_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:me.CMD.CLEAR_GROUP_ATTRIBUTES,interval:5,count:10},{cmd:me.CMD.GET_GROUP_ATTRIBUTES,interval:5,count:20},{cmd:me.CMD.SET_ALL_MESSAGE_READ,interval:1,count:1},{cmd:me.CMD.GET_USER_STATUS,interval:5,count:20},{cmd:me.CMD.SUBSCRIBE_USER_STATUS,interval:5,count:20},{cmd:me.CMD.UNSUBSCRIBE_USER_STATUS,interval:5,count:20}],gd=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this,e))._className="SessionModule",n._platform=n.getPlatform(),n._protocolHandler=new gS(Ae(n)),n._messageDispatcher=new EC(Ae(n)),n._commandFrequencyLimitMap=new Map,n._commandRequestInfoMap=new Map,n._serverOverloadInfoMap=new Map,n._init(),n.getInnerEmitterInstance().on(ji,n._onCloudConfigUpdated,Ae(n)),n}return x(o,[{key:"_init",value:function(){this._updateCommandFrequencyLimitMap(mS)}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("cmd_frequency_limit");Ke(e)||(e=JSON.parse(e),this._updateCommandFrequencyLimitMap(e))}},{key:"_updateCommandFrequencyLimitMap",value:function(e){var n=this;e.forEach(function(l){n._commandFrequencyLimitMap.set(l.cmd,{interval:l.interval,count:l.count})})}},{key:"updateProtocolConfig",value:function(){this._protocolHandler.update()}},{key:"request",value:function(e){V.debug("".concat(this._className,".request options:"),e);var n=e.protocolName,l=e.tjgID;if(!this._protocolHandler.has(n))return V.warn("".concat(this._className,".request unknown protocol:").concat(n)),Le({code:We.CANNOT_FIND_PROTOCOL,message:at.CANNOT_FIND_PROTOCOL});var h=this.getProtocolData(e),_=h.head.servcmd;if(this._isFrequencyOverLimit(_))return Le({code:We.OVER_FREQUENCY_LIMIT,message:at.OVER_FREQUENCY_LIMIT});if(this._isServerOverload(_))return Le({code:We.OPEN_SERVICE_OVERLOAD_ERROR,message:at.OPEN_SERVICE_OVERLOAD_ERROR});Mt(l)||(h.head.tjgID=l);var S=this.getModule(uo);return IC.includes(n)?S.simplySend(h):S.send(h)}},{key:"getKeyMap",value:function(e){return this._protocolHandler.getKeyMap(e)}},{key:"genCommonHead",value:function(){var e=this.getModule(ir);return{ver:"v4",platform:this._platform,websdkappid:so,websdkversion:Fi,a2:e.getA2Key()||void 0,tinyid:e.getTinyID()||void 0,status_instid:e.getStatusInstanceID(),sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getA2Key()?void 0:e.getUserID(),usersig:e.getA2Key()?void 0:e.getUserSig(),sdkability:3635,tjgID:""}}},{key:"genCosSpecifiedHead",value:function(){var e=this.getModule(ir);return{ver:"v4",platform:this._platform,websdkappid:so,websdkversion:Fi,sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getUserID(),usersig:e.getUserSig(),status_instid:e.getStatusInstanceID(),sdkability:3635}}},{key:"genSSOReportHead",value:function(){var e=this.getModule(ir);return{ver:"v4",platform:this._platform,websdkappid:so,websdkversion:Fi,sdkappid:e.getSDKAppID(),contenttype:"",reqtime:0,identifier:"",usersig:"",status_instid:e.getStatusInstanceID(),sdkability:3635}}},{key:"getProtocolData",value:function(e){return this._protocolHandler.getProtocolData(e)}},{key:"onErrorCodeNotZero",value:function(e){var n=e.errorCode;if(n===We.HELLO_ANSWER_KICKED_OUT){var l=e.kickType,h=e.newInstanceInfo,_=h===void 0?{}:h;l===1?this.onMultipleAccountKickedOut(_):l===2?this.onMultipleDeviceKickedOut(_):l===3&&this.onRestApiKickedOut(_)}n!==We.MESSAGE_A2KEY_EXPIRED&&n!==We.ACCOUNT_A2KEY_EXPIRED||(this._onUserSigExpired(),this.getModule(uo).reConnect())}},{key:"onMessage",value:function(e){var n=e.body,l=n.needAck,h=l===void 0?0:l,_=n.sessionData;h===1&&this._sendACK(_),this._messageDispatcher.onMessage(e)}},{key:"onReconnected",value:function(){this._reLoginOnReconnected()}},{key:"reLoginOnKickOther",value:function(){V.log("".concat(this._className,".reLoginOnKickOther")),this._reLogin()}},{key:"_reLoginOnReconnected",value:function(){V.log("".concat(this._className,"._reLoginOnReconnected")),this._reLogin()}},{key:"_reLogin",value:function(){var e=this;this.isLoggedIn()&&this.request({protocolName:_o}).then(function(n){var l=n.data.instanceID;e.getModule(ir).setStatusInstanceID(l),V.log("".concat(e._className,"._reLogin ok. start to sync unread messages")),e.getModule(rd).startSyncOnReconnected(),e.getModule(Vt).syncConversationList(),e.getModule(Ni).startPull(),e.getModule(pn).updateLocalMainSequenceOnReconnected();var h=e.getModule(ri);h.resetGetTopicTime(),h.getTopicListOnReconnected()})}},{key:"onMultipleAccountKickedOut",value:function(e){this.getModule(qu).onMultipleAccountKickedOut(e)}},{key:"onMultipleDeviceKickedOut",value:function(e){this.getModule(qu).onMultipleDeviceKickedOut(e)}},{key:"_onUserSigExpired",value:function(){this.getModule(qu).onUserSigExpired()}},{key:"onRestApiKickedOut",value:function(e){this.getModule(qu).onRestApiKickedOut(e)}},{key:"_sendACK",value:function(e){this.request({protocolName:Ry,requestData:{sessionData:e}})}},{key:"_isFrequencyOverLimit",value:function(e){var n=e.split(".")[1];if(!this._commandFrequencyLimitMap.has(n))return!1;if(!this._commandRequestInfoMap.has(n))return this._commandRequestInfoMap.set(n,{startTime:Date.now(),requestCount:1}),!1;var l=this._commandFrequencyLimitMap.get(n),h=l.count,_=l.interval,S=this._commandRequestInfoMap.get(n),E=S.startTime,M=S.requestCount;if(Date.now()-E>1e3*_)return this._commandRequestInfoMap.set(n,{startTime:Date.now(),requestCount:1}),!1;M+=1,this._commandRequestInfoMap.set(n,{startTime:E,requestCount:M});var w=!1;return M>h&&(w=!0),w}},{key:"_isServerOverload",value:function(e){if(!this._serverOverloadInfoMap.has(e))return!1;var n=this._serverOverloadInfoMap.get(e),l=n.overloadTime,h=n.waitingTime,_=!1;return Date.now()-l<=1e3*h?_=!0:(this._serverOverloadInfoMap.delete(e),_=!1),_}},{key:"onPushedServerOverload",value:function(e){var n=e.overloadCommand,l=e.waitingTime;this._serverOverloadInfoMap.set(n,{overloadTime:Date.now(),waitingTime:l}),V.warn("".concat(this._className,".onPushedServerOverload waitingTime:").concat(l,"s"))}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),this._updateCommandFrequencyLimitMap(mS),this._commandRequestInfoMap.clear(),this._serverOverloadInfoMap.clear()}}]),o}(Ti),vS=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this,e))._className="MessageLossDetectionModule",n._maybeLostSequencesMap=new Map,n._firstRoundRet=[],n}return x(o,[{key:"onMessageMaybeLost",value:function(e,n,l){this._maybeLostSequencesMap.has(e)||this._maybeLostSequencesMap.set(e,[]);for(var h=this._maybeLostSequencesMap.get(e),_=0;_<l;_++)h.indexOf(n+_)===-1&&h.push(n+_)}},{key:"detectFirstRound",value:function(e,n){var l=this._maybeLostSequencesMap.get(e);if(!Mt(l)&&!Mt(n)){var h=l.filter(function(_){return n.indexOf(_)===-1});h.length===0?V.info("".concat(this._className,".detectFirstRound no message loss. conversationID:").concat(e)):this._firstRoundRet=this._firstRoundRet.concat(h),l.length=0}}},{key:"detectSecondRound",value:function(e,n){if(!Mt(this._firstRoundRet)&&!Mt(n)){var l=this._firstRoundRet.filter(function(S){return n.indexOf(S)===-1});this._firstRoundRet.length=0;var h,_=l.length;_!==0&&(_<=5?h=e+"-"+l.join("-"):(l.sort(function(S,E){return S-E}),h=e+" start:"+l[0]+" end:"+l[_-1]+" count:"+_),new ht(yt.MESSAGE_LOSS).setMessage(h).setNetworkType(this.getNetworkType()).setLevel("warning").end(),V.info("".concat(this._className,".detectSecondRound message loss detected. conversationID:").concat(e," lostSequences:").concat(l)))}}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),this._maybeLostSequencesMap.clear(),this._firstRoundRet.length=0}}]),o}(Ti),bv=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this,e))._className="CloudControlModule",n._cloudConfig=new Map,n._expiredTime=0,n._version=0,n._isFetching=!1,n}return x(o,[{key:"getCloudConfig",value:function(e){return Ke(e)?this._cloudConfig:this._cloudConfig.has(e)?this._cloudConfig.get(e):void 0}},{key:"_canFetchConfig",value:function(){return this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime}},{key:"fetchConfig",value:function(){var e=this,n=this._canFetchConfig();if(V.log("".concat(this._className,".fetchConfig canFetchConfig:").concat(n)),n){var l=new ht(yt.FETCH_CLOUD_CONTROL_CONFIG),h=this.getModule(ir).getSDKAppID();this._isFetching=!0,this.request({protocolName:OI,requestData:{SDKAppID:h,version:this._version}}).then(function(_){e._isFetching=!1,l.setMessage("version:".concat(e._version," newVersion:").concat(_.data.version," config:").concat(_.data.cloudControlConfig)).setNetworkType(e.getNetworkType()).end(),V.log("".concat(e._className,".fetchConfig ok")),e._parseCloudControlConfig(_.data)}).catch(function(_){e._isFetching=!1,e.probeNetwork().then(function(S){var E=Ue(S,2),M=E[0],w=E[1];l.setError(_,M,w).end()}),V.log("".concat(e._className,".fetchConfig failed. error:"),_),e._setExpiredTimeOnResponseError(12e4)})}}},{key:"onPushedCloudControlConfig",value:function(e){V.log("".concat(this._className,".onPushedCloudControlConfig")),new ht(yt.PUSHED_CLOUD_CONTROL_CONFIG).setNetworkType(this.getNetworkType()).setMessage("newVersion:".concat(e.version," config:").concat(e.cloudControlConfig)).end(),this._parseCloudControlConfig(e)}},{key:"onCheckTimer",value:function(e){this._canFetchConfig()&&this.fetchConfig()}},{key:"_parseCloudControlConfig",value:function(e){var n=this,l="".concat(this._className,"._parseCloudControlConfig"),h=e.errorCode,_=e.errorMessage,S=e.cloudControlConfig,E=e.version,M=e.expiredTime;if(h===0){if(this._version!==E){var w=null;try{w=JSON.parse(S)}catch{V.error("".concat(l," JSON parse error:").concat(S))}w&&(this._cloudConfig.clear(),Object.keys(w).forEach(function(L){n._cloudConfig.set(L,w[L])}),this._version=E,this.emitInnerEvent(ji))}this._expiredTime=Date.now()+1e3*M}else Ke(h)?(V.log("".concat(l," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(V.error("".concat(l," errorCode:").concat(h," errorMessage:").concat(_)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),this._cloudConfig.clear(),this._expiredTime=0,this._version=0,this._isFetching=!1}}]),o}(Ti),TC=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this,e))._className="PullGroupMessageModule",n._remoteLastMessageSequenceMap=new Map,n.PULL_LIMIT_COUNT=15,n}return x(o,[{key:"startPull",value:function(){var e=this,n=this._getNeedPullConversationList();this._getRemoteLastMessageSequenceList().then(function(){var l=e.getModule(Vt);n.forEach(function(h){var _=h.conversationID,S=_.replace(Z.CONV_GROUP,""),E=l.getGroupLocalLastMessageSequence(_),M=e._remoteLastMessageSequenceMap.get(S)||0,w=M-E;V.log("".concat(e._className,".startPull groupID:").concat(S," localLastMessageSequence:").concat(E," ")+"remoteLastMessageSequence:".concat(M," diff:").concat(w)),E>0&&w>=1&&w<300&&e._pullMissingMessage({groupID:S,localLastMessageSequence:E,remoteLastMessageSequence:M,diff:w})})})}},{key:"_getNeedPullConversationList",value:function(){return this.getModule(Vt).getLocalConversationList().filter(function(e){return e.type===Z.CONV_GROUP&&e.groupProfile.type!==Z.GRP_AVCHATROOM})}},{key:"_getRemoteLastMessageSequenceList",value:function(){var e=this;return this.getModule(pn).getGroupList().then(function(n){for(var l=n.data.groupList,h=l===void 0?[]:l,_=0;_<h.length;_++){var S=h[_],E=S.groupID,M=S.nextMessageSeq;if(S.type!==Z.GRP_AVCHATROOM){var w=M-1;e._remoteLastMessageSequenceMap.set(E,w)}}})}},{key:"_pullMissingMessage",value:function(e){var n=this,l=e.localLastMessageSequence,h=e.remoteLastMessageSequence,_=e.diff;e.count=_>this.PULL_LIMIT_COUNT?this.PULL_LIMIT_COUNT:_,e.sequence=_>this.PULL_LIMIT_COUNT?l+this.PULL_LIMIT_COUNT:l+_,this._getGroupMissingMessage(e).then(function(S){S.length>0&&(S[0].sequence+1<=h&&(e.localLastMessageSequence=l+n.PULL_LIMIT_COUNT,e.diff=_-n.PULL_LIMIT_COUNT,n._pullMissingMessage(e)),n.getModule(pn).onNewGroupMessage({dataList:S,isInstantMessage:!1}))})}},{key:"_getGroupMissingMessage",value:function(e){var n=this,l=new ht(yt.GET_GROUP_MISSING_MESSAGE);return this.request({protocolName:Wr,requestData:{groupID:e.groupID,count:e.count,sequence:e.sequence}}).then(function(h){var _=h.data.messageList,S=_===void 0?[]:_;return l.setNetworkType(n.getNetworkType()).setMessage("groupID:".concat(e.groupID," count:").concat(e.count," sequence:").concat(e.sequence," messageList length:").concat(S.length)).end(),S}).catch(function(h){n.probeNetwork().then(function(_){var S=Ue(_,2),E=S[0],M=S[1];l.setError(h,E,M).end()})})}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),this._remoteLastMessageSequenceMap.clear()}}]),o}(Ti),Vk=function(){function a(){A(this,a),this._className="AvgE2EDelay",this._e2eDelayArray=[]}return x(a,[{key:"addMessageDelay",value:function(t){var o=PT()-t;o>=0&&this._e2eDelayArray.push(o)}},{key:"_calcAvg",value:function(t,o){if(o===0)return 0;var e=0;return t.forEach(function(n){e+=n}),xa(e/o,1)}},{key:"_calcCountWithLimit",value:function(t){var o=t.e2eDelayArray,e=t.min,n=t.max;return o.filter(function(l){return e<=l&&l<n}).length}},{key:"_calcPercent",value:function(t,o){var e=xa(t/o*100,2);return e>100&&(e=100),e}},{key:"_checkE2EDelayException",value:function(t,o){var e=t.filter(function(E){return E>o});if(e.length>0){var n=e.length,l=Math.min.apply(Math,Be(e)),h=Math.max.apply(Math,Be(e)),_=this._calcAvg(e,n),S=xa(n/t.length*100,2);S>50&&new ht(yt.MESSAGE_E2E_DELAY_EXCEPTION).setMessage("message e2e delay exception. count:".concat(n," min:").concat(l," max:").concat(h," avg:").concat(_," percent:").concat(S)).setLevel("warning").end()}}},{key:"getStatResult",value:function(){var t=this._e2eDelayArray.length;if(t===0)return null;var o=Be(this._e2eDelayArray),e=this._calcCountWithLimit({e2eDelayArray:o,min:0,max:1}),n=this._calcCountWithLimit({e2eDelayArray:o,min:1,max:3}),l=this._calcPercent(e,t),h=this._calcPercent(n,t),_=this._calcAvg(o,t);return this._checkE2EDelayException(o,3),o.length=0,this.reset(),{totalCount:t,countLessThan1Second:e,percentOfCountLessThan1Second:l,countLessThan3Second:n,percentOfCountLessThan3Second:h,avgDelay:_}}},{key:"reset",value:function(){this._e2eDelayArray.length=0}}]),a}(),$E=function(){function a(){A(this,a),this._className="AvgRTT",this._requestCount=0,this._rttArray=[]}return x(a,[{key:"addRequestCount",value:function(){this._requestCount+=1}},{key:"addRTT",value:function(t){this._rttArray.push(t)}},{key:"_calcTotalCount",value:function(){return this._requestCount}},{key:"_calcRTTCount",value:function(t){return t.length}},{key:"_calcSuccessRateOfRequest",value:function(t,o){if(o===0)return 0;var e=xa(t/o*100,2);return e>100&&(e=100),e}},{key:"_calcAvg",value:function(t,o){if(o===0)return 0;var e=0;return t.forEach(function(n){e+=n}),parseInt(e/o)}},{key:"_calcMax",value:function(){return Math.max.apply(Math,Be(this._rttArray))}},{key:"_calcMin",value:function(){return Math.min.apply(Math,Be(this._rttArray))}},{key:"getStatResult",value:function(){var t=this._calcTotalCount(),o=Be(this._rttArray);if(t===0)return null;var e=this._calcRTTCount(o),n=this._calcSuccessRateOfRequest(e,t),l=this._calcAvg(o,e);return V.log("".concat(this._className,".getStatResult max:").concat(this._calcMax()," min:").concat(this._calcMin()," avg:").concat(l)),this.reset(),{totalCount:t,rttCount:e,successRateOfRequest:n,avgRTT:l}}},{key:"reset",value:function(){this._requestCount=0,this._rttArray.length=0}}]),a}(),MC=function(){function a(){A(this,a),this._map=new Map}return x(a,[{key:"initMap",value:function(t){var o=this;t.forEach(function(e){o._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})})}},{key:"addTotalCount",value:function(t){return!(Ke(t)||!this._map.has(t))&&(this._map.get(t).totalCount+=1,!0)}},{key:"addSuccessCount",value:function(t){return!(Ke(t)||!this._map.has(t))&&(this._map.get(t).successCount+=1,!0)}},{key:"addFailedCountOfUserSide",value:function(t){return!(Ke(t)||!this._map.has(t))&&(this._map.get(t).failedCountOfUserSide+=1,!0)}},{key:"addCost",value:function(t,o){return!(Ke(t)||!this._map.has(t))&&(this._map.get(t).costArray.push(o),!0)}},{key:"addFileSize",value:function(t,o){return!(Ke(t)||!this._map.has(t))&&(this._map.get(t).fileSizeArray.push(o),!0)}},{key:"_calcSuccessRateOfBusiness",value:function(t){if(Ke(t)||!this._map.has(t))return-1;var o=this._map.get(t),e=xa(o.successCount/o.totalCount*100,2);return e>100&&(e=100),e}},{key:"_calcSuccessRateOfPlatform",value:function(t){if(Ke(t)||!this._map.has(t))return-1;var o=this._map.get(t),e=this._calcSuccessCountOfPlatform(t)/o.totalCount*100;return(e=xa(e,2))>100&&(e=100),e}},{key:"_calcTotalCount",value:function(t){return Ke(t)||!this._map.has(t)?-1:this._map.get(t).totalCount}},{key:"_calcSuccessCountOfBusiness",value:function(t){return Ke(t)||!this._map.has(t)?-1:this._map.get(t).successCount}},{key:"_calcSuccessCountOfPlatform",value:function(t){if(Ke(t)||!this._map.has(t))return-1;var o=this._map.get(t);return o.successCount+o.failedCountOfUserSide}},{key:"_calcAvg",value:function(t){return Ke(t)||!this._map.has(t)?-1:t===qo?this._calcAvgSpeed(t):this._calcAvgCost(t)}},{key:"_calcAvgCost",value:function(t){var o=this._map.get(t).costArray.length;if(o===0)return 0;var e=0;return this._map.get(t).costArray.forEach(function(n){e+=n}),parseInt(e/o)}},{key:"_calcAvgSpeed",value:function(t){var o=0,e=0;return this._map.get(t).costArray.forEach(function(n){o+=n}),this._map.get(t).fileSizeArray.forEach(function(n){e+=n}),parseInt(1e3*e/o)}},{key:"getStatResult",value:function(t){var o=this._calcTotalCount(t);if(o===0)return null;var e=this._calcSuccessCountOfBusiness(t),n=this._calcSuccessRateOfBusiness(t),l=this._calcSuccessCountOfPlatform(t),h=this._calcSuccessRateOfPlatform(t),_=this._calcAvg(t);return this.reset(t),{totalCount:o,successCountOfBusiness:e,successRateOfBusiness:n,successCountOfPlatform:l,successRateOfPlatform:h,avgValue:_}}},{key:"reset",value:function(t){Ke(t)?this._map.clear():this._map.set(t,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}}]),a}(),KE=function(){function a(){A(this,a),this._lastMap=new Map,this._currentMap=new Map}return x(a,[{key:"initMap",value:function(t){var o=this;t.forEach(function(e){o._lastMap.set(e,new Map),o._currentMap.set(e,new Map)})}},{key:"addMessageSequence",value:function(t){var o=t.key,e=t.message;if(Ke(o)||!this._lastMap.has(o)||!this._currentMap.has(o))return!1;var n=e.conversationID,l=e.sequence,h=n.replace(Z.CONV_GROUP,"");if(this._lastMap.get(o).size===0)this._addCurrentMap(t);else if(this._lastMap.get(o).has(h)){var _=this._lastMap.get(o).get(h),S=_.length-1;l>_[0]&&l<_[S]?(_.push(l),_.sort(),this._lastMap.get(o).set(h,_)):this._addCurrentMap(t)}else this._addCurrentMap(t);return!0}},{key:"_addCurrentMap",value:function(t){var o=t.key,e=t.message,n=e.conversationID,l=e.sequence,h=n.replace(Z.CONV_GROUP,"");this._currentMap.get(o).has(h)||this._currentMap.get(o).set(h,[]),this._currentMap.get(o).get(h).push(l)}},{key:"_copyData",value:function(t){if(!Ke(t)){this._lastMap.set(t,new Map);var o,e=this._lastMap.get(t),n=De(this._currentMap.get(t));try{for(n.s();!(o=n.n()).done;){var l=Ue(o.value,2),h=l[0],_=l[1];e.set(h,_)}}catch(S){n.e(S)}finally{n.f()}e=null,this._currentMap.set(t,new Map)}}},{key:"getStatResult",value:function(t){if(Ke(this._currentMap.get(t))||Ke(this._lastMap.get(t)))return null;if(this._lastMap.get(t).size===0)return this._copyData(t),null;var o=0,e=0;if(this._lastMap.get(t).forEach(function(l,h){var _=Be(l.values()),S=_.length,E=_[S-1]-_[0]+1;o+=E,e+=S}),o===0)return null;var n=xa(e/o*100,2);return n>100&&(n=100),this._copyData(t),{totalCount:o,successCountOfMessageReceived:e,successRateOfMessageReceived:n}}},{key:"reset",value:function(){this._currentMap.clear(),this._lastMap.clear()}}]),a}(),RC=function(a){B(o,a);var t=Xe(o);function o(e){var n;A(this,o),(n=t.call(this,e))._className="QualityStatModule",n.TAG="im-ssolog-quality-stat",n.reportIndex=0,n.wholePeriod=!1,n._qualityItems=[LI,PI,Qm,Zm,ev,Oh,qo,Sf,If,tv],n._messageSentItems=[Qm,Zm,ev,Oh,qo],n._messageReceivedItems=[Sf,If,tv],n.REPORT_INTERVAL=120,n.REPORT_SDKAPPID_BLACKLIST=[],n.REPORT_TINYID_WHITELIST=[],n._statInfoArr=[],n._avgRTT=new $E,n._avgE2EDelay=new Vk,n._rateMessageSent=new MC,n._rateMessageReceived=new KE;var l=n.getInnerEmitterInstance();return l.on(gs,n._onLoginSuccess,Ae(n)),l.on(ji,n._onCloudConfigUpdated,Ae(n)),n}return x(o,[{key:"_onLoginSuccess",value:function(){var e=this;this._rateMessageSent.initMap(this._messageSentItems),this._rateMessageReceived.initMap(this._messageReceivedItems);var n=this.getModule(ds),l=n.getItem(this.TAG,!1);!Mt(l)&&Fc(l.forEach)&&(V.log("".concat(this._className,"._onLoginSuccess.get quality stat log in storage, nums=").concat(l.length)),l.forEach(function(h){e._statInfoArr.push(h)}),n.removeItem(this.TAG,!1))}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("q_rpt_interval"),n=this.getCloudConfig("q_rpt_sdkappid_bl"),l=this.getCloudConfig("q_rpt_tinyid_wl");Ke(e)||(this.REPORT_INTERVAL=Number(e)),Ke(n)||(this.REPORT_SDKAPPID_BLACKLIST=n.split(",").map(function(h){return Number(h)})),Ke(l)||(this.REPORT_TINYID_WHITELIST=l.split(","))}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this.REPORT_INTERVAL==0&&(this.wholePeriod=!0,this._report())}},{key:"addRequestCount",value:function(){this._avgRTT.addRequestCount()}},{key:"addRTT",value:function(e){this._avgRTT.addRTT(e)}},{key:"addMessageDelay",value:function(e){this._avgE2EDelay.addMessageDelay(e)}},{key:"addTotalCount",value:function(e){this._rateMessageSent.addTotalCount(e)||V.warn("".concat(this._className,".addTotalCount invalid key:"),e)}},{key:"addSuccessCount",value:function(e){this._rateMessageSent.addSuccessCount(e)||V.warn("".concat(this._className,".addSuccessCount invalid key:"),e)}},{key:"addFailedCountOfUserSide",value:function(e){this._rateMessageSent.addFailedCountOfUserSide(e)||V.warn("".concat(this._className,".addFailedCountOfUserSide invalid key:"),e)}},{key:"addCost",value:function(e,n){this._rateMessageSent.addCost(e,n)||V.warn("".concat(this._className,".addCost invalid key or cost:"),e,n)}},{key:"addFileSize",value:function(e,n){this._rateMessageSent.addFileSize(e,n)||V.warn("".concat(this._className,".addFileSize invalid key or size:"),e,n)}},{key:"addMessageSequence",value:function(e){this._rateMessageReceived.addMessageSequence(e)||V.warn("".concat(this._className,".addMessageSequence invalid key:"),e.key)}},{key:"_getQualityItem",value:function(e){var n={},l=CM[this.getNetworkType()];Ke(l)&&(l=8);var h={qualityType:$b[e],timestamp:Ji(),networkType:l,extension:""};switch(e){case LI:n=this._avgRTT.getStatResult();break;case PI:n=this._avgE2EDelay.getStatResult();break;case Qm:case Zm:case ev:case Oh:case qo:n=this._rateMessageSent.getStatResult(e);break;case Sf:case If:case tv:n=this._rateMessageReceived.getStatResult(e)}return n===null?null:m(m({},h),n)}},{key:"_report",value:function(e){var n=this,l=[],h=null;Ke(e)?this._qualityItems.forEach(function(M){(h=n._getQualityItem(M))!==null&&(h.reportIndex=n.reportIndex,h.wholePeriod=n.wholePeriod,l.push(h))}):(h=this._getQualityItem(e))!==null&&(h.reportIndex=this.reportIndex,h.wholePeriod=this.wholePeriod,l.push(h)),V.debug("".concat(this._className,"._report"),l),this._statInfoArr.length>0&&(l=l.concat(this._statInfoArr),this._statInfoArr=[]);var _=this.getModule(ir),S=_.getSDKAppID(),E=_.getTinyID();z0(this.REPORT_SDKAPPID_BLACKLIST,S)&&!iy(this.REPORT_TINYID_WHITELIST,E)&&(l=[]),l.length>0&&this._doReport(l)}},{key:"_doReport",value:function(e){var n=this,l={header:SE(this),quality:e};this.request({protocolName:Wu,requestData:m({},l)}).then(function(){n.reportIndex++,n.wholePeriod=!1}).catch(function(h){V.warn("".concat(n._className,"._doReport, online:").concat(n.getNetworkType()," error:"),h),n._statInfoArr=n._statInfoArr.concat(e),n._flushAtOnce()})}},{key:"_flushAtOnce",value:function(){var e=this.getModule(ds),n=e.getItem(this.TAG,!1),l=this._statInfoArr;if(Mt(n))V.log("".concat(this._className,"._flushAtOnce count:").concat(l.length)),e.setItem(this.TAG,l,!0,!1);else{var h=l.concat(n);h.length>10&&(h=h.slice(0,10)),V.log("".concat(this.className,"._flushAtOnce count:").concat(h.length)),e.setItem(this.TAG,h,!0,!1)}this._statInfoArr=[]}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),this._report(),this.reportIndex=0,this.wholePeriod=!1,this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[],this._avgRTT.reset(),this._avgE2EDelay.reset(),this._rateMessageSent.reset(),this._rateMessageReceived.reset()}}]),o}(Ti),CC=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this,e))._className="WorkerTimerModule",n._isWorkerEnabled=!0,n._workerTimer=null,n._init(),n.getInnerEmitterInstance().on(ji,n._onCloudConfigUpdated,Ae(n)),n}return x(o,[{key:"isWorkerEnabled",value:function(){return this._isWorkerEnabled&&mh}},{key:"startWorkerTimer",value:function(){V.log("".concat(this._className,".startWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("start")}},{key:"stopWorkerTimer",value:function(){V.log("".concat(this._className,".stopWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("stop")}},{key:"_init",value:function(){if(mh){var e=URL.createObjectURL(new Blob(['let interval = -1;onmessage = function(event) {  if (event.data === "start") {    if (interval > 0) {      clearInterval(interval);    }    interval = setInterval(() => {      postMessage("");    }, 1000)  } else if (event.data === "stop") {    clearInterval(interval);    interval = -1;  }};'],{type:"application/javascript; charset=utf-8"}));this._workerTimer=new Worker(e);var n=this;this._workerTimer.onmessage=function(){n._moduleManager.onCheckTimer()}}}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("enable_worker");V.log("".concat(this._className,"._onCloudConfigUpdated enableWorker:").concat(e)),Ke(e)||e==="1"?!this._isWorkerEnabled&&mh&&(this._isWorkerEnabled=!0,this.startWorkerTimer(),this._moduleManager.onWorkerTimerEnabled()):this._isWorkerEnabled&&mh&&(this._isWorkerEnabled=!1,this.stopWorkerTimer(),this._moduleManager.onWorkerTimerDisabled())}},{key:"terminate",value:function(){V.log("".concat(this._className,".terminate")),this._workerTimer&&(this._workerTimer.terminate(),this._workerTimer=null)}},{key:"reset",value:function(){V.log("".concat(this._className,".reset"))}}]),o}(Ti),WE=function(){function a(){A(this,a),this._className="PurchasedFeatureHandler",this._purchasedFeatureMap=new Map}return x(a,[{key:"isValidPurchaseBits",value:function(t){return t&&typeof t=="string"&&t.length>=1&&t.length<=64&&/[01]{1,64}/.test(t)}},{key:"parsePurchaseBits",value:function(t){var o="".concat(this._className,".parsePurchaseBits");if(this.isValidPurchaseBits(t)){this._purchasedFeatureMap.clear();for(var e=null,n=t.length-1,l=0;n>=0;n--,l++)e=l<32?new Pn(0,Math.pow(2,l)).toString():new Pn(Math.pow(2,l-32),0).toString(),t[n]==="1"?this._purchasedFeatureMap.set(e,!0):this._purchasedFeatureMap.set(e,!1)}else V.warn("".concat(o," invalid purchase bits:").concat(t))}},{key:"hasPurchasedFeature",value:function(t){return!!this._purchasedFeatureMap.get(t)}},{key:"isFeatureEnabled",value:function(t){for(var o=parseInt(t).toString(2),e=void 0,n=!0,l=o.length-1,h=0;l>=0;l--,h++)if(o.charAt(l)==="1"&&(e=h<32?new Pn(0,Math.pow(2,h)).toString():new Pn(Math.pow(2,h-32),0).toString(),!this._purchasedFeatureMap.get(e))){n=!1;break}return V.log("".concat(this._className,".isFeatureEnabled decimalNumber:").concat(t," binaryString:").concat(o," ret:").concat(n)),En({enabled:n})}},{key:"clear",value:function(){this._purchasedFeatureMap.clear()}}]),a}(),bC=function(a){B(o,a);var t=Xe(o);function o(e){var n;return A(this,o),(n=t.call(this,e))._className="CommercialConfigModule",n._expiredTime=0,n._isFetching=!1,n._purchasedFeatureHandler=new WE,n}return x(o,[{key:"_canFetch",value:function(){return this.isLoggedIn()?!this._isFetching&&Date.now()>=this._expiredTime:(this._expiredTime=Date.now()+2e3,!1)}},{key:"onCheckTimer",value:function(e){this._canFetch()&&this.fetchConfig()}},{key:"fetchConfig",value:function(){var e=this,n=this._canFetch(),l="".concat(this._className,".fetchConfig");if(V.log("".concat(l," canFetch:").concat(n)),n){var h=new ht(yt.FETCH_COMMERCIAL_CONFIG);h.setNetworkType(this.getNetworkType());var _=this.getModule(ir).getSDKAppID();this._isFetching=!0,this.request({protocolName:NI,requestData:{SDKAppID:_}}).then(function(S){h.setMessage("purchaseBits:".concat(S.data.purchaseBits)).end(),V.log("".concat(l," ok.")),e._parseConfig(S.data),e._isFetching=!1}).catch(function(S){e.probeNetwork().then(function(E){var M=Ue(E,2),w=M[0],L=M[1];h.setError(S,w,L).end()}),e._isFetching=!1})}}},{key:"onPushedConfig",value:function(e){var n="".concat(this._className,".onPushedConfig");V.log("".concat(n)),new ht(yt.PUSHED_COMMERCIAL_CONFIG).setNetworkType(this.getNetworkType()).setMessage("purchaseBits:".concat(e.purchaseBits)).end(),this._parseConfig(e)}},{key:"_parseConfig",value:function(e){var n="".concat(this._className,"._parseConfig"),l=e.errorCode,h=e.errorMessage,_=e.purchaseBits,S=e.expiredTime;l===0?(this._purchasedFeatureHandler.parsePurchaseBits(_),this._expiredTime=Date.now()+1e3*S):Ke(l)?(V.log("".concat(n," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(V.error("".concat(n," errorCode:").concat(l," errorMessage:").concat(h)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"canIUse",value:function(e){return this._purchasedFeatureHandler.hasPurchasedFeature(e)}},{key:"isFeatureEnabled",value:function(e){return this._purchasedFeatureHandler.isFeatureEnabled(e)}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler.clear()}}]),o}(Ti),AC=function(){function a(t){A(this,a);var o=new ht(yt.SDK_CONSTRUCT);this._className="ModuleManager",this._isReady=!1,this._reason=We.USER_NOT_LOGGED_IN,this._startLoginTs=0,this._moduleMap=new Map,this._innerEmitter=null,this._outerEmitter=null,this._checkCount=0,this._checkTimer=-1,this._moduleMap.set(ir,new _v(this,t)),this._moduleMap.set(vf,new bC(this)),this._moduleMap.set(hy,new bv(this)),this._moduleMap.set(kr,new CC(this)),this._moduleMap.set(Ur,new RC(this)),this._moduleMap.set(uo,new Gk(this)),this._moduleMap.set(Ua,new gd(this)),this._moduleMap.set(qu,new ER(this)),this._moduleMap.set(fi,new nS(this)),this._moduleMap.set(Ei,new PA(this)),this._moduleMap.set(Vi,new Of(this)),this._moduleMap.set(Vt,new hE(this)),this._moduleMap.set(pn,new pR(this)),this._moduleMap.set(gi,new fR(this)),this._moduleMap.set(ri,new DA(this)),this._moduleMap.set(ds,new yE(this)),this._moduleMap.set(aI,new UA(this)),this._moduleMap.set(wh,new MR(this)),this._moduleMap.set(Ym,new FA(this)),this._moduleMap.set(YT,new BA(this)),this._moduleMap.set(sI,new AR(this)),this._moduleMap.set(rd,new EE(this)),this._moduleMap.set(Hu,new vS(this)),this._moduleMap.set(Ni,new TC(this)),this._eventThrottleMap=new Map;var e=t.instanceID,n=t.oversea,l=t.SDKAppID,h="instanceID:".concat(e," SDKAppID:").concat(l," host:").concat(ed()," oversea:").concat(n," inBrowser:").concat(Xn," inMiniApp:").concat(tn)+" workerAvailable:".concat(mh," UserAgent:").concat($n);ht.bindEventStatModule(this._moduleMap.get(aI)),o.setMessage("".concat(h," ").concat(function(){var _="";if(tn)try{var S=Rn.getSystemInfoSync(),E=S.model,M=S.version,w=S.system,L=S.platform,H=S.SDKVersion;_="model:".concat(E," version:").concat(M," system:").concat(w," platform:").concat(L," SDKVersion:").concat(H)}catch{_=""}return _}())).end(),V.info("SDK ".concat(h)),this._readyList=void 0,this._ssoLogForReady=null,this._initReadyList()}return x(a,[{key:"_startTimer",value:function(){var t=this._moduleMap.get(kr),o=t.isWorkerEnabled();V.log("".concat(this._className,".startTimer isWorkerEnabled:").concat(o," seed:").concat(this._checkTimer)),o?t.startWorkerTimer():this._startMainThreadTimer()}},{key:"_startMainThreadTimer",value:function(){V.log("".concat(this._className,"._startMainThreadTimer")),this._checkTimer<0&&(this._checkTimer=setInterval(this.onCheckTimer.bind(this),1e3))}},{key:"stopTimer",value:function(){var t=this._moduleMap.get(kr),o=t.isWorkerEnabled();V.log("".concat(this._className,".stopTimer isWorkerEnabled:").concat(o," seed:").concat(this._checkTimer)),o?t.stopWorkerTimer():this._stopMainThreadTimer()}},{key:"_stopMainThreadTimer",value:function(){V.log("".concat(this._className,"._stopMainThreadTimer")),this._checkTimer>0&&(clearInterval(this._checkTimer),this._checkTimer=-1,this._checkCount=0)}},{key:"_stopMainThreadSocket",value:function(){V.log("".concat(this._className,"._stopMainThreadSocket"));var t=this._moduleMap.get(uo);t.setIsWorkerEnabled(!0),t.reConnect()}},{key:"_startMainThreadSocket",value:function(){V.log("".concat(this._className,"._startMainThreadSocket"));var t=this._moduleMap.get(uo);t.setIsWorkerEnabled(!1),t.reConnect()}},{key:"onWorkerTimerEnabled",value:function(){V.log("".concat(this._className,".onWorkerTimerEnabled, disable main thread timer and socket")),this._stopMainThreadTimer(),this._stopMainThreadSocket()}},{key:"onWorkerTimerDisabled",value:function(){V.log("".concat(this._className,".onWorkerTimerDisabled, enable main thread timer and socket")),this._startMainThreadTimer(),this._startMainThreadSocket()}},{key:"onCheckTimer",value:function(){this._checkCount+=1;var t,o=De(this._moduleMap);try{for(o.s();!(t=o.n()).done;){var e=Ue(t.value,2)[1];e.onCheckTimer&&e.onCheckTimer(this._checkCount)}}catch(n){o.e(n)}finally{o.f()}}},{key:"_initReadyList",value:function(){var t=this;this._readyList=[this._moduleMap.get(qu),this._moduleMap.get(Vt)],this._readyList.forEach(function(o){o.ready(function(){return t._onModuleReady()})})}},{key:"_onModuleReady",value:function(){var t=!0;if(this._readyList.forEach(function(l){l.isReady()||(t=!1)}),t&&!this._isReady){this._isReady=!0,this._outerEmitter.emit(mn.SDK_READY);var o=Date.now()-this._startLoginTs;V.warn("SDK is ready. cost ".concat(o," ms")),this._startLoginTs=Date.now();var e=this._moduleMap.get(wh).getNetworkType(),n=this._ssoLogForReady.getStartTs()+Vm;this._ssoLogForReady.setNetworkType(e).setMessage(o).start(n).end()}}},{key:"login",value:function(){this._startLoginTs===0&&(LT(),this._startLoginTs=Date.now(),this._startTimer(),this._moduleMap.get(wh).start(),this._ssoLogForReady=new ht(yt.SDK_READY),this._reason=We.LOGGING_IN)}},{key:"onLoginFailed",value:function(){this._startLoginTs=0}},{key:"getOuterEmitterInstance",value:function(){return this._outerEmitter===null&&(this._outerEmitter=new RR,iE(this._outerEmitter),this._outerEmitter._emit=this._outerEmitter.emit,this._outerEmitter.emit=function(t,o){var e=this;if(t===mn.CONVERSATION_LIST_UPDATED||t===mn.FRIEND_LIST_UPDATED||t===mn.GROUP_LIST_UPDATED)if(this._eventThrottleMap.has(t)){var n=Date.now(),l=this._eventThrottleMap.get(t);n-l.last<1e3?(l.timeoutID&&clearTimeout(l.timeoutID),l.timeoutID=setTimeout(function(){l.last=n,e._outerEmitter._emit.apply(e._outerEmitter,[t,{name:t,data:e._getEventData(t)}])},500)):(l.last=n,this._outerEmitter._emit.apply(this._outerEmitter,[t,{name:t,data:this._getEventData(t)}]))}else this._eventThrottleMap.set(t,{last:Date.now(),timeoutID:-1}),this._outerEmitter._emit.apply(this._outerEmitter,[t,{name:t,data:this._getEventData(t)}]);else this._outerEmitter._emit.apply(this._outerEmitter,[t,{name:t,data:arguments[1]}])}.bind(this)),this._outerEmitter}},{key:"_getEventData",value:function(t){return t===mn.CONVERSATION_LIST_UPDATED?this._moduleMap.get(Vt).getLocalConversationList():t===mn.FRIEND_LIST_UPDATED?this._moduleMap.get(ni).getLocalFriendList(!1):t===mn.GROUP_LIST_UPDATED?this._moduleMap.get(pn).getLocalGroupList():void 0}},{key:"getInnerEmitterInstance",value:function(){return this._innerEmitter===null&&(this._innerEmitter=new RR,this._innerEmitter._emit=this._innerEmitter.emit,this._innerEmitter.emit=function(t,o){var e;Br(arguments[1])&&arguments[1].data?(V.warn("inner eventData has data property, please check!"),e=[t,{name:arguments[0],data:arguments[1].data}]):e=[t,{name:arguments[0],data:arguments[1]}],this._innerEmitter._emit.apply(this._innerEmitter,e)}.bind(this)),this._innerEmitter}},{key:"hasModule",value:function(t){return this._moduleMap.has(t)}},{key:"getModule",value:function(t){return this._moduleMap.get(t)}},{key:"isReady",value:function(){return this._isReady}},{key:"getNotReadyReason",value:function(){return this._reason}},{key:"setNotReadyReason",value:function(t){this._reason=t}},{key:"onError",value:function(t){V.warn("Oops! code:".concat(t.code," message:").concat(t.message)),new ht(yt.ERROR).setMessage("code:".concat(t.code," message:").concat(t.message)).setNetworkType(this.getModule(wh).getNetworkType()).setLevel("error").end(),this.getOuterEmitterInstance().emit(mn.ERROR,t)}},{key:"reset",value:function(){V.log("".concat(this._className,".reset")),LT();var t,o=De(this._moduleMap);try{for(o.s();!(t=o.n()).done;){var e=Ue(t.value,2)[1];e.reset&&e.reset()}}catch(_){o.e(_)}finally{o.f()}this._startLoginTs=0,this._initReadyList(),this._isReady=!1,this.stopTimer(),this._outerEmitter.emit(mn.SDK_NOT_READY);var n,l=De(this._eventThrottleMap);try{for(l.s();!(n=l.n()).done;){var h=Ue(n.value,2)[1];h.timeoutID&&clearTimeout(h.timeoutID)}}catch(_){l.e(_)}finally{l.f()}this._eventThrottleMap.clear()}}]),a}(),_S=function(){function a(){A(this,a),this._funcMap=new Map}return x(a,[{key:"defense",value:function(t,o){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;if(typeof t!="string"||t.length===0||typeof o!="function")return null;if(this._funcMap.has(t)&&this._funcMap.get(t).has(o))return this._funcMap.get(t).get(o);this._funcMap.has(t)||this._funcMap.set(t,new Map);var n=null;return this._funcMap.get(t).has(o)?n=this._funcMap.get(t).get(o):(n=this._pack(t,o,e),this._funcMap.get(t).set(o,n)),n}},{key:"defenseOnce",value:function(t,o){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;return typeof o!="function"?null:this._pack(t,o,e)}},{key:"find",value:function(t,o){return typeof t!="string"||t.length===0||typeof o!="function"?null:this._funcMap.has(t)?this._funcMap.get(t).has(o)?this._funcMap.get(t).get(o):(V.log("SafetyCallback.find: \u627E\u4E0D\u5230 func \u2014\u2014 ".concat(t,"/").concat(o.name!==""?o.name:"[anonymous]")),null):(V.log("SafetyCallback.find: \u627E\u4E0D\u5230 eventName-".concat(t," \u5BF9\u5E94\u7684 func")),null)}},{key:"delete",value:function(t,o){return typeof o=="function"&&!!this._funcMap.has(t)&&!!this._funcMap.get(t).has(o)&&(this._funcMap.get(t).delete(o),this._funcMap.get(t).size===0&&this._funcMap.delete(t),!0)}},{key:"_pack",value:function(t,o,e){return function(){try{o.apply(e,Array.from(arguments))}catch(_){var n=Object.values(mn).indexOf(t);if(n!==-1){var l=Object.keys(mn)[n];V.warn("\u63A5\u5165\u4FA7\u4E8B\u4EF6 TIM.EVENT.".concat(l," \u5BF9\u5E94\u7684\u56DE\u8C03\u51FD\u6570\u903B\u8F91\u5B58\u5728\u95EE\u9898\uFF0C\u8BF7\u68C0\u67E5\uFF01"),_)}var h=new ht(yt.CALLBACK_FUNCTION_ERROR);h.setMessage("eventName:".concat(t)).setMoreMessage(_.message).end()}}}}]),a}(),yS=function(){function a(t){A(this,a);var o={SDKAppID:t.SDKAppID,unlimitedAVChatRoom:t.unlimitedAVChatRoom||!1,scene:t.scene||"",oversea:t.oversea||!1,instanceID:Sh(),devMode:t.devMode||!1,proxyServer:t.proxyServer||void 0};this._moduleManager=new AC(o),this._safetyCallbackFactory=new _S}return x(a,[{key:"onError",value:function(t){this._moduleManager.onError(t)}},{key:"login",value:function(t){return this._moduleManager.login(),this._moduleManager.getModule(qu).login(t)}},{key:"logout",value:function(){var t=this;return this._moduleManager.getModule(qu).logout().then(function(o){return t._moduleManager.reset(),o})}},{key:"isReady",value:function(){return this._moduleManager.isReady()}},{key:"getNotReadyReason",value:function(){return this._moduleManager.getNotReadyReason()}},{key:"destroy",value:function(){var t=this;return this.logout().finally(function(){t._moduleManager.stopTimer(),t._moduleManager.getModule(kr).terminate(),t._moduleManager.getModule(uo).dealloc();var o=t._moduleManager.getOuterEmitterInstance(),e=t._moduleManager.getModule(ir);o.emit(mn.SDK_DESTROY,{SDKAppID:e.getSDKAppID()})})}},{key:"on",value:function(t,o,e){t===mn.GROUP_SYSTEM_NOTICE_RECEIVED&&V.warn("\uFF01\uFF01\uFF01TIM.EVENT.GROUP_SYSTEM_NOTICE_RECEIVED v2.6.0\u8D77\u5F03\u7528\uFF0C\u4E3A\u4E86\u66F4\u597D\u7684\u4F53\u9A8C\uFF0C\u8BF7\u5728 TIM.EVENT.MESSAGE_RECEIVED \u4E8B\u4EF6\u56DE\u8C03\u5185\u63A5\u6536\u5904\u7406\u7FA4\u7CFB\u7EDF\u901A\u77E5\uFF0C\u8BE6\u7EC6\u8BF7\u53C2\u8003\uFF1Ahttps://web.sdk.qcloud.com/im/doc/zh-cn/Message.html#.GroupSystemNoticePayload"),V.debug("on","eventName:".concat(t)),this._moduleManager.getOuterEmitterInstance().on(t,this._safetyCallbackFactory.defense(t,o,e),e)}},{key:"once",value:function(t,o,e){V.debug("once","eventName:".concat(t)),this._moduleManager.getOuterEmitterInstance().once(t,this._safetyCallbackFactory.defenseOnce(t,o,e),e||this)}},{key:"off",value:function(t,o,e,n){V.debug("off","eventName:".concat(t));var l=this._safetyCallbackFactory.find(t,o);l!==null&&(this._moduleManager.getOuterEmitterInstance().off(t,l,e,n),this._safetyCallbackFactory.delete(t,o))}},{key:"registerPlugin",value:function(t){this._moduleManager.getModule(sI).registerPlugin(t)}},{key:"setLogLevel",value:function(t){t<=0&&(console.log([""," ________  ______  __       __  __       __  ________  _______","|        \\|      \\|  \\     /  \\|  \\  _  |  \\|        \\|       \\"," \\$$$$$$$$ \\$$$$$$| $$\\   /  $$| $$ / \\ | $$| $$$$$$$$| $$$$$$$\\","   | $$     | $$  | $$$\\ /  $$$| $$/  $\\| $$| $$__    | $$__/ $$","   | $$     | $$  | $$$$\\  $$$$| $$  $$$\\ $$| $$  \\   | $$    $$","   | $$     | $$  | $$\\$$ $$ $$| $$ $$\\$$\\$$| $$$$$   | $$$$$$$\\","   | $$    _| $$_ | $$ \\$$$| $$| $$$$  \\$$$$| $$_____ | $$__/ $$","   | $$   |   $$ \\| $$  \\$ | $$| $$$    \\$$$| $$     \\| $$    $$","    \\$$    \\$$$$$$ \\$$      \\$$ \\$$      \\$$ \\$$$$$$$$ \\$$$$$$$","",""].join(`
`)),console.log("%cIM \u667A\u80FD\u5BA2\u670D\uFF0C\u968F\u65F6\u968F\u5730\u89E3\u51B3\u60A8\u7684\u95EE\u9898 \u2192_\u2192 https://cloud.tencent.com/act/event/smarty-service?from=im-doc","color:#006eff"),console.log("%c\u4ECEv2.11.2\u8D77\uFF0CSDK \u652F\u6301\u4E86 WebSocket\uFF0C\u5C0F\u7A0B\u5E8F\u9700\u8981\u6DFB\u52A0\u53D7\u4FE1\u57DF\u540D\uFF01\u5347\u7EA7\u6307\u5F15: https://web.sdk.qcloud.com/im/doc/zh-cn/tutorial-02-upgradeguideline.html","color:#ff0000"),console.log(["",`\u53C2\u8003\u4EE5\u4E0B\u6587\u6863\uFF0C\u4F1A\u66F4\u5FEB\u89E3\u51B3\u95EE\u9898\u54E6\uFF01(#^.^#)
`,`SDK \u66F4\u65B0\u65E5\u5FD7: https://cloud.tencent.com/document/product/269/38492
`,`SDK \u63A5\u53E3\u6587\u6863: https://web.sdk.qcloud.com/im/doc/zh-cn/SDK.html
`,`\u5E38\u89C1\u95EE\u9898: https://web.sdk.qcloud.com/im/doc/zh-cn/tutorial-01-faq.html
`,`\u53CD\u9988\u95EE\u9898\uFF1F\u6233\u6211\u63D0 issue: https://github.com/tencentyun/TIMSDK/issues
`,`\u5982\u679C\u60A8\u9700\u8981\u5728\u751F\u4EA7\u73AF\u5883\u5173\u95ED\u4E0A\u9762\u7684\u65E5\u5FD7\uFF0C\u8BF7 tim.setLogLevel(1)
`].join(`
`))),V.setLevel(t)}},{key:"createTextMessage",value:function(t){return this._moduleManager.getModule(fi).createTextMessage(t)}},{key:"createTextAtMessage",value:function(t){return this._moduleManager.getModule(fi).createTextMessage(t)}},{key:"createImageMessage",value:function(t){return this._moduleManager.getModule(fi).createImageMessage(t)}},{key:"createAudioMessage",value:function(t){return this._moduleManager.getModule(fi).createAudioMessage(t)}},{key:"createVideoMessage",value:function(t){return this._moduleManager.getModule(fi).createVideoMessage(t)}},{key:"createCustomMessage",value:function(t){return this._moduleManager.getModule(fi).createCustomMessage(t)}},{key:"createFaceMessage",value:function(t){return this._moduleManager.getModule(fi).createFaceMessage(t)}},{key:"createFileMessage",value:function(t){return this._moduleManager.getModule(fi).createFileMessage(t)}},{key:"createLocationMessage",value:function(t){return this._moduleManager.getModule(fi).createLocationMessage(t)}},{key:"createMergerMessage",value:function(t){return this._moduleManager.getModule(fi).createMergerMessage(t)}},{key:"downloadMergerMessage",value:function(t){return t.type!==Z.MSG_MERGER?Le(new Me({code:We.MESSAGE_MERGER_TYPE_INVALID,message:at.MESSAGE_MERGER_TYPE_INVALID})):Mt(t.payload.downloadKey)?Le(new Me({code:We.MESSAGE_MERGER_KEY_INVALID,message:at.MESSAGE_MERGER_KEY_INVALID})):this._moduleManager.getModule(fi).downloadMergerMessage(t).catch(function(o){return Le(new Me({code:We.MESSAGE_MERGER_DOWNLOAD_FAIL,message:at.MESSAGE_MERGER_DOWNLOAD_FAIL}))})}},{key:"createForwardMessage",value:function(t){return this._moduleManager.getModule(fi).createForwardMessage(t)}},{key:"sendMessage",value:function(t,o){return t instanceof Bi?this._moduleManager.getModule(fi).sendMessageInstance(t,o):Le(new Me({code:We.MESSAGE_SEND_NEED_MESSAGE_INSTANCE,message:at.MESSAGE_SEND_NEED_MESSAGE_INSTANCE}))}},{key:"callExperimentalAPI",value:function(t,o){return t==="handleGroupInvitation"?this._moduleManager.getModule(pn).handleGroupInvitation(o):t==="isCommercialAbilityEnabled"?this._moduleManager.getModule(vf).isFeatureEnabled(o):Le(new Me({code:We.INVALID_OPERATION,message:at.INVALID_OPERATION}))}},{key:"revokeMessage",value:function(t){return this._moduleManager.getModule(fi).revokeMessage(t)}},{key:"resendMessage",value:function(t){return this._moduleManager.getModule(fi).resendMessage(t)}},{key:"deleteMessage",value:function(t){return this._moduleManager.getModule(fi).deleteMessage(t)}},{key:"modifyMessage",value:function(t){return this._moduleManager.getModule(fi).modifyRemoteMessage(t)}},{key:"getMessageList",value:function(t){return this._moduleManager.getModule(Vt).getMessageList(t)}},{key:"getMessageListHopping",value:function(t){return this._moduleManager.getModule(Vt).getMessageListHopping(t)}},{key:"sendMessageReadReceipt",value:function(t){return this._moduleManager.getModule(Vt).sendReadReceipt(t)}},{key:"getMessageReadReceiptList",value:function(t){return this._moduleManager.getModule(Vt).getReadReceiptList(t)}},{key:"getGroupMessageReadMemberList",value:function(t){return this._moduleManager.getModule(pn).getReadReceiptDetail(t)}},{key:"findMessage",value:function(t){return this._moduleManager.getModule(Vt).findMessage(t)}},{key:"setMessageRead",value:function(t){return this._moduleManager.getModule(Vt).setMessageRead(t)}},{key:"getConversationList",value:function(t){return this._moduleManager.getModule(Vt).getConversationList(t)}},{key:"getConversationProfile",value:function(t){return this._moduleManager.getModule(Vt).getConversationProfile(t)}},{key:"deleteConversation",value:function(t){return this._moduleManager.getModule(Vt).deleteConversation(t)}},{key:"pinConversation",value:function(t){return this._moduleManager.getModule(Vt).pinConversation(t)}},{key:"setAllMessageRead",value:function(t){return this._moduleManager.getModule(Vt).setAllMessageRead(t)}},{key:"setMessageRemindType",value:function(t){return this._moduleManager.getModule(Vt).setMessageRemindType(t)}},{key:"getMyProfile",value:function(){return this._moduleManager.getModule(Ei).getMyProfile()}},{key:"getUserProfile",value:function(t){return this._moduleManager.getModule(Ei).getUserProfile(t)}},{key:"updateMyProfile",value:function(t){return this._moduleManager.getModule(Ei).updateMyProfile(t)}},{key:"getBlacklist",value:function(){return this._moduleManager.getModule(Ei).getLocalBlacklist()}},{key:"addToBlacklist",value:function(t){return this._moduleManager.getModule(Ei).addBlacklist(t)}},{key:"removeFromBlacklist",value:function(t){return this._moduleManager.getModule(Ei).deleteBlacklist(t)}},{key:"setSelfStatus",value:function(t){return this._moduleManager.getModule(Ei).setSelfStatus(t)}},{key:"getUserStatus",value:function(t){return this._moduleManager.getModule(Ei).getUserStatus(t)}},{key:"subscribeUserStatus",value:function(t){return this._moduleManager.getModule(Ei).subscribeUserStatus(t)}},{key:"unsubscribeUserStatus",value:function(t){return this._moduleManager.getModule(Ei).unsubscribeUserStatus(t)}},{key:"getFriendList",value:function(){var t=this._moduleManager.getModule(ni);return t?t.getLocalFriendList():Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"addFriend",value:function(t){var o=this._moduleManager.getModule(ni);return o?o.addFriend(t):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"deleteFriend",value:function(t){var o=this._moduleManager.getModule(ni);return o?o.deleteFriend(t):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"checkFriend",value:function(t){var o=this._moduleManager.getModule(ni);return o?o.checkFriend(t):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"getFriendProfile",value:function(t){var o=this._moduleManager.getModule(ni);return o?o.getFriendProfile(t):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"updateFriend",value:function(t){var o=this._moduleManager.getModule(ni);return o?o.updateFriend(t):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"getFriendApplicationList",value:function(){var t=this._moduleManager.getModule(ni);return t?t.getLocalFriendApplicationList():Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"acceptFriendApplication",value:function(t){var o=this._moduleManager.getModule(ni);return o?o.acceptFriendApplication(t):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"refuseFriendApplication",value:function(t){var o=this._moduleManager.getModule(ni);return o?o.refuseFriendApplication(t):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"deleteFriendApplication",value:function(t){var o=this._moduleManager.getModule(ni);return o?o.deleteFriendApplication(t):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"setFriendApplicationRead",value:function(){var t=this._moduleManager.getModule(ni);return t?t.setFriendApplicationRead():Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"getFriendGroupList",value:function(){var t=this._moduleManager.getModule(ni);return t?t.getLocalFriendGroupList():Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"createFriendGroup",value:function(t){var o=this._moduleManager.getModule(ni);return o?o.createFriendGroup(t):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"deleteFriendGroup",value:function(t){var o=this._moduleManager.getModule(ni);return o?o.deleteFriendGroup(t):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"addToFriendGroup",value:function(t){var o=this._moduleManager.getModule(ni);return o?o.addToFriendGroup(t):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"removeFromFriendGroup",value:function(t){var o=this._moduleManager.getModule(ni);return o?o.removeFromFriendGroup(t):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"renameFriendGroup",value:function(t){var o=this._moduleManager.getModule(ni);return o?o.renameFriendGroup(t):Le({code:We.CANNOT_FIND_MODULE,message:at.CANNOT_FIND_MODULE})}},{key:"getGroupList",value:function(t){return this._moduleManager.getModule(pn).getGroupList(t)}},{key:"getGroupProfile",value:function(t){return this._moduleManager.getModule(pn).getGroupProfile(t)}},{key:"createGroup",value:function(t){return this._moduleManager.getModule(pn).createGroup(t)}},{key:"dismissGroup",value:function(t){return this._moduleManager.getModule(pn).dismissGroup(t)}},{key:"updateGroupProfile",value:function(t){return this._moduleManager.getModule(pn).updateGroupProfile(t)}},{key:"joinGroup",value:function(t){return this._moduleManager.getModule(pn).joinGroup(t)}},{key:"quitGroup",value:function(t){return this._moduleManager.getModule(pn).quitGroup(t)}},{key:"searchGroupByID",value:function(t){return this._moduleManager.getModule(pn).searchGroupByID(t)}},{key:"getGroupOnlineMemberCount",value:function(t){return this._moduleManager.getModule(pn).getGroupOnlineMemberCount(t)}},{key:"changeGroupOwner",value:function(t){return this._moduleManager.getModule(pn).changeGroupOwner(t)}},{key:"handleGroupApplication",value:function(t){return this._moduleManager.getModule(pn).handleGroupApplication(t)}},{key:"initGroupAttributes",value:function(t){return this._moduleManager.getModule(pn).initGroupAttributes(t)}},{key:"setGroupAttributes",value:function(t){return this._moduleManager.getModule(pn).setGroupAttributes(t)}},{key:"deleteGroupAttributes",value:function(t){return this._moduleManager.getModule(pn).deleteGroupAttributes(t)}},{key:"getGroupAttributes",value:function(t){return this._moduleManager.getModule(pn).getGroupAttributes(t)}},{key:"getGroupMemberList",value:function(t){return this._moduleManager.getModule(gi).getGroupMemberList(t)}},{key:"getGroupMemberProfile",value:function(t){return this._moduleManager.getModule(gi).getGroupMemberProfile(t)}},{key:"addGroupMember",value:function(t){return this._moduleManager.getModule(gi).addGroupMember(t)}},{key:"deleteGroupMember",value:function(t){return this._moduleManager.getModule(gi).deleteGroupMember(t)}},{key:"setGroupMemberMuteTime",value:function(t){return this._moduleManager.getModule(gi).setGroupMemberMuteTime(t)}},{key:"setGroupMemberRole",value:function(t){return this._moduleManager.getModule(gi).setGroupMemberRole(t)}},{key:"setGroupMemberNameCard",value:function(t){return this._moduleManager.getModule(gi).setGroupMemberNameCard(t)}},{key:"setGroupMemberCustomField",value:function(t){return this._moduleManager.getModule(gi).setGroupMemberCustomField(t)}},{key:"getJoinedCommunityList",value:function(){return this._moduleManager.getModule(ri).getJoinedCommunityList()}},{key:"createTopicInCommunity",value:function(t){return this._moduleManager.getModule(ri).createTopicInCommunity(t)}},{key:"deleteTopicFromCommunity",value:function(t){return this._moduleManager.getModule(ri).deleteTopicFromCommunity(t)}},{key:"updateTopicProfile",value:function(t){return this._moduleManager.getModule(ri).updateTopicProfile(t)}},{key:"getTopicList",value:function(t){return this._moduleManager.getModule(ri).getTopicList(t)}}]),a}(),zE={login:"login",logout:"logout",destroy:"destroy",on:"on",off:"off",ready:"ready",setLogLevel:"setLogLevel",joinGroup:"joinGroup",quitGroup:"quitGroup",registerPlugin:"registerPlugin",getGroupOnlineMemberCount:"getGroupOnlineMemberCount"};function YE(a,t){if(a.isReady()||zE[t]!==void 0)return!0;var o=a.getNotReadyReason(),e="";Object.getOwnPropertyNames(We).forEach(function(l){We[l]===o&&(e=at[l])});var n={code:o,message:"".concat(e,"\u5BFC\u81F4 sdk not ready\u3002").concat(t," ").concat(at.SDK_IS_NOT_READY,"\uFF0C\u8BF7\u53C2\u8003 https://web.sdk.qcloud.com/im/doc/zh-cn/module-EVENT.html#.SDK_READY")};return a.onError(n),n}var Yh={},md={};return md.create=function(a){var t=0;if(gr(a.SDKAppID))t=a.SDKAppID;else if(V.warn("TIM.create SDKAppID \u7684\u7C7B\u578B\u5E94\u8BE5\u4E3A Number\uFF0C\u8BF7\u4FEE\u6539\uFF01"),t=parseInt(a.SDKAppID),isNaN(t))return V.error("TIM.create failed. \u89E3\u6790 SDKAppID \u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u4F20\u53C2\uFF01"),null;if(t&&Yh[t])return Yh[t];V.log("TIM.create");var o=new yS(m(m({},a),{},{SDKAppID:t}));o.on(mn.SDK_DESTROY,function(n){Yh[n.data.SDKAppID]=null,delete Yh[n.data.SDKAppID]});var e=function(n){var l=Object.create(null);return Object.keys(Ah).forEach(function(h){if(n[h]){var _=Ah[h],S=new Hg;l[_]=function(){var E=Array.from(arguments);return S.use(function(M,w){var L=YE(n,h);return L===!0?w():Le(L)}).use(function(M,w){if(Y0(M,nd[h],_)===!0)return w()}).use(function(M,w){return n[h].apply(n,M)}),S.run(E)}}}),l}(o);return Yh[t]=e,V.log("TIM.create ok"),e},md.TYPES=Z,md.EVENT=mn,md.VERSION="2.21.2",V.log("TIM.VERSION: ".concat(md.VERSION)),md})})(s1);const Cr=s1.exports;var fL=(i=>(i.ON_CHANGE_LOG_LEVEL="onChangeLogLevel",i))(fL||{});const ig={LOG_LEVEL_DEBUG:-1,LOG_LEVEL_LOG:0,LOG_LEVEL_INFO:1,LOG_LEVEL_WARN:2,LOG_LEVEL_ERROR:3,LOG_LEVEL_NON_LOGGING:4};var og=(i=>(i.MAIN="main-process",i.RENDER="render-process",i))(og||{});function D5(i){const s=i.toString().length;let g;switch(s){case 1:g=`00${i}`;break;case 2:g=`0${i}`;break;default:g=i;break}return g}function Nv(i){const s=new Date;return`${s.toLocaleTimeString("en-US",{hour12:!1})}.${D5(s.getMilliseconds())} [${i}]:`}let Zf=ig.LOG_LEVEL_DEBUG;const Fe={debug(...i){Zf<=ig.LOG_LEVEL_DEBUG&&console.debug(`${Nv(og.RENDER)}`,...i)},log(...i){Zf<=ig.LOG_LEVEL_LOG&&console.log(`${Nv(og.RENDER)}`,...i)},info(...i){Zf<=ig.LOG_LEVEL_INFO&&console.info(`${Nv(og.RENDER)}`,...i)},warn(...i){Zf<=ig.LOG_LEVEL_WARN&&console.warn(`${Nv(og.RENDER)}`,...i)},error(...i){Zf<=ig.LOG_LEVEL_ERROR&&console.error(`${Nv(og.RENDER)}`,...i)},setLevel(i){var s;i>=ig.LOG_LEVEL_DEBUG&&i<=ig.LOG_LEVEL_NON_LOGGING?(console.log(`${Nv(og.RENDER)} set log level from ${Zf} to ${i}`),Zf=i,(s=window.electron)!=null&&s.ipcRenderer&&window.electron.ipcRenderer.send(fL.ON_CHANGE_LOG_LEVEL,i)):console.error(`${Nv(og.RENDER)} logger.setLevel() invalid params:${i}`)},getLevel(){return Zf}};class bT{constructor(){we(this,"stores")}on(s,g,m){if(typeof g!="function"){Fe.error("listener must be a function");return}this.stores=this.stores||{},(this.stores[s]=this.stores[s]||[]).push({cb:g,ctx:m})}emit(s,g){this.stores=this.stores||{};let m=this.stores[s];const R=[];if(m){m=m.slice(0),R[0]=g;for(let A=0,D=m.length;A<D;A++)m[A].cb.apply(m[A].ctx,R)}}off(s,g){if(this.stores=this.stores||{},!s){this.stores={};return}const m=this.stores[s];if(!m)return;if(!g){delete this.stores[s];return}let R;for(let A=0,D=m.length;A<D;A++)if(R=m[A].cb,R===g){m.splice(A,1);break}}}function Sr(i){return JSON.parse(JSON.stringify(i))}function sg(i){let s;try{s=JSON.parse(i)}catch{return console.error("JSON parse exception",i),{}}return s}const Jt={INVALID_PARAM_ERROR:-1e3,LOGIN_ERROR:-1001,LOGOUT_ERROR:-1002,NOT_LOGIN:-1003,TIM_ERROR:-1004,TRTC_NOT_EXIST_ERROR:-1005,ROOM_EXISTED:-1006,SDK_NOT_READY:-1007,CREATE_GROUP_ERROR:-1008,JOIN_GROUP_ERROR:-1009,QUIT_GROUP_ERROR:-1010,DISMISS_GROUP_ERROR:-1011,SEND_MESSAGE_ERROR:-1012,SEND_CUSTOM_MESSAGE_ERROR:-1013,CREATE_ROOM_ERROR:-1014,DESTROY_ROOM_ERROR:-1015,ENTER_ROOM_ERROR:-1016,EXIT_ROOM_ERROR:-1017,SET_ROOM_CONTROL_CONFIG_ERROR:-1018,GROUP_NOT_EXIST_ERROR:-1019,CHANGE_ALL_MIC_MUTE_ERROR:-1020,CHANGE_GROUP_OWNER:-1021,WEB_SCREEN_SHARE_SYSTEM_DENY:-1022,WEB_SCREEN_SHARE_USER_DENY:-1023,WEB_SCREEN_SHARE_UNKNOWN:-1024,GET_GROUP_MEMBER_PROFILE_ERROR:-1025,CHANGE_ALL_CAMERA_MUTE_ERROR:-1026,GET_GROUP_MEMBER_LIST_ERROR:-1027,ROOM_BEEN_DESTROYED:-1997,NO_PRIVILEGE:-1998,UNKNOWN_ERROR:-1999,CALLING_ROLL:-2e3,NOT_CALL_ROLL:-2001,START_CALL_ROLL_ERROR:-2002,STOP_CALL_ROLL_ERROR:-2003,SEND_SPEECH_APPLICATION_EORRO:-2004,TS_INVITE_ERROR:-2010,TS_CMD_ERROR:-2011},yn={INVALID_PARAM_ERROR:"\u65E0\u6548\u53C2\u6570",LOGIN_ERROR:"\u767B\u5F55\u5931\u8D25",LOGOUT_ERROR:"\u767B\u51FA\u5931\u8D25",LOGOUT_TIM_ERROR:"\u9000\u51FA TIM \u5931\u8D25",LOGOUT_TRTC_ERROR:"\u9000\u51FA TRTC \u623F\u95F4\u5931\u8D25",NOT_LOGIN:"\u672A\u767B\u5F55",TRTC_NOT_EXIST_ERROR:"TRTC \u5B9E\u4F8B\u672A\u521B\u5EFA",ROOM_EXISTED:"\u623F\u95F4\u5DF2\u5B58\u5728",SDK_NOT_READY:"SDK \u521D\u59CB\u5316\u672A\u5B8C\u6210",CREATE_GROUP_ERROR:"\u521B\u5EFA\u7FA4\u7EC4\u5931\u8D25",JOIN_GROUP_ERROR:"\u52A0\u5165\u7FA4\u7EC4\u5931\u8D25",QUIT_GROUP_ERROR:"\u9000\u51FA\u7FA4\u7EC4\u5931\u8D25",DISMISS_GROUP_ERROR:"\u89E3\u6563\u7FA4\u7EC4\u5931\u8D25",SEND_MESSAGE_ERROR:"\u53D1\u9001\u6587\u672C\u6D88\u606F\u5931\u8D25",SEND_CUSTOM_MESSAGE_ERROR:"\u53D1\u9001\u81EA\u5B9A\u4E49\u6D88\u606F\u5931\u8D25",CREATE_ROOM_ERROR:"\u521B\u5EFA\u623F\u95F4\u5931\u8D25",DESTROY_ROOM_ERROR:"\u9500\u6BC1\u623F\u95F4\u5931\u8D25",ENTER_ROOM_ERROR:"\u8FDB\u5165\u623F\u95F4\u5931\u8D25",EXIT_ROOM_ERROR:"\u9000\u51FA\u623F\u95F4\u5931\u8D25",ROOM_BEEN_DESTROYED:"\u623F\u95F4\u5B9E\u4F8B\u5DF2\u88AB\u9500\u6BC1",SET_ROOM_CONTROL_CONFIG_ERROR:"\u8BBE\u7F6E\u623F\u95F4\u63A7\u5236\u914D\u7F6E\u5931\u8D25",GROUP_NOT_EXIST_ERROR:"\u7FA4\u7EC4\u4E0D\u5B58\u5728",CHANGE_ALL_MIC_MUTE_ERROR:"\u4FEE\u6539\u5168\u5458\u7981\u9EA6\u514B\u98CE\u72B6\u6001\u5931\u8D25",CHANGE_ALL_CAMERA_MUTE_ERROR:"\u4FEE\u6539\u5168\u5458\u7981\u753B\u72B6\u6001\u5931\u8D25",CHANGE_GROUP_OWNER:"\u8F6C\u79FB\u7FA4\u5931\u8D25",WEB_SCREEN_SHARE_SYSTEM_DENY:"\u7CFB\u7EDF\u7981\u6B62\u5F53\u524D\u6D4F\u89C8\u5668\u83B7\u53D6\u5C4F\u5E55\u5185\u5BB9",WEB_SCREEN_SHARE_USER_DENY:"\u7528\u6237\u62D2\u7EDD/\u53D6\u6D88\u5C4F\u5E55\u5206\u4EAB",WEB_SCREEN_SHARE_UNKNOWN:"\u5C4F\u5E55\u5206\u4EAB\u9047\u5230\u672A\u77E5\u9519\u8BEF",GET_GROUP_MEMBER_PROFILE_ERROR:"\u83B7\u53D6\u7FA4\u6210\u5458\u4FE1\u606F\u5931\u8D25",GET_GROUP_MEMBER_LIST_ERROR:"\u83B7\u53D6\u7FA4\u6210\u5458\u5217\u8868\u5931\u8D25",NO_PRIVILEGE:"\u65E0\u6743\u9650",UNKNOWN_ERROR:"\u672A\u77E5\u9519\u8BEF",CALLING_ROLL:"\u6B63\u5728\u70B9\u540D\u4E2D",NOT_CALL_ROLL:"\u5C1A\u672A\u5F00\u59CB\u70B9\u540D",START_CALL_ROLL_ERROR:"\u5F00\u59CB\u70B9\u540D\u5931\u8D25",STOP_CALL_ROLL_ERROR:"\u7ED3\u675F\u70B9\u540D\u5931\u8D25",SEND_SPEECH_APPLICATION_EORRO:"\u7533\u8BF7\u53D1\u8A00\u5931\u8D25",TS_INVITE_ERROR:"\u9080\u8BF7\u4FE1\u4EE4\u5DF2\u5728\u6D41\u7A0B\u4E2D\uFF0C\u8BF7\u4E0D\u8981\u91CD\u590D\u9080\u8BF7",TS_CMD_ERROR:"\u672C\u6B21\u54CD\u5E94\u64CD\u4F5C\u65E0\u5BF9\u5E94\u9080\u8BF7\u4E8B\u4EF6\u4FE1\u4EE4"},Lv={timeout:0},OS="";var Db={exports:{}},VS=typeof Reflect=="object"?Reflect:null,jO=VS&&typeof VS.apply=="function"?VS.apply:function(s,g,m){return Function.prototype.apply.call(s,g,m)},nb;VS&&typeof VS.ownKeys=="function"?nb=VS.ownKeys:Object.getOwnPropertySymbols?nb=function(s){return Object.getOwnPropertyNames(s).concat(Object.getOwnPropertySymbols(s))}:nb=function(s){return Object.getOwnPropertyNames(s)};function O5(i){console&&console.warn&&console.warn(i)}var gL=Number.isNaN||function(s){return s!==s};function Yr(){Yr.init.call(this)}Db.exports=Yr;Db.exports.once=x5;Yr.EventEmitter=Yr;Yr.prototype._events=void 0;Yr.prototype._eventsCount=0;Yr.prototype._maxListeners=void 0;var qO=10;function Ob(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(Yr,"defaultMaxListeners",{enumerable:!0,get:function(){return qO},set:function(i){if(typeof i!="number"||i<0||gL(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");qO=i}});Yr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Yr.prototype.setMaxListeners=function(s){if(typeof s!="number"||s<0||gL(s))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+s+".");return this._maxListeners=s,this};function mL(i){return i._maxListeners===void 0?Yr.defaultMaxListeners:i._maxListeners}Yr.prototype.getMaxListeners=function(){return mL(this)};Yr.prototype.emit=function(s){for(var g=[],m=1;m<arguments.length;m++)g.push(arguments[m]);var R=s==="error",A=this._events;if(A!==void 0)R=R&&A.error===void 0;else if(!R)return!1;if(R){var D;if(g.length>0&&(D=g[0]),D instanceof Error)throw D;var x=new Error("Unhandled error."+(D?" ("+D.message+")":""));throw x.context=D,x}var $=A[s];if($===void 0)return!1;if(typeof $=="function")jO($,this,g);else for(var B=$.length,te=IL($,B),m=0;m<B;++m)jO(te[m],this,g);return!0};function vL(i,s,g,m){var R,A,D;if(Ob(g),A=i._events,A===void 0?(A=i._events=Object.create(null),i._eventsCount=0):(A.newListener!==void 0&&(i.emit("newListener",s,g.listener?g.listener:g),A=i._events),D=A[s]),D===void 0)D=A[s]=g,++i._eventsCount;else if(typeof D=="function"?D=A[s]=m?[g,D]:[D,g]:m?D.unshift(g):D.push(g),R=mL(i),R>0&&D.length>R&&!D.warned){D.warned=!0;var x=new Error("Possible EventEmitter memory leak detected. "+D.length+" "+String(s)+" listeners added. Use emitter.setMaxListeners() to increase limit");x.name="MaxListenersExceededWarning",x.emitter=i,x.type=s,x.count=D.length,O5(x)}return i}Yr.prototype.addListener=function(s,g){return vL(this,s,g,!1)};Yr.prototype.on=Yr.prototype.addListener;Yr.prototype.prependListener=function(s,g){return vL(this,s,g,!0)};function N5(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _L(i,s,g){var m={fired:!1,wrapFn:void 0,target:i,type:s,listener:g},R=N5.bind(m);return R.listener=g,m.wrapFn=R,R}Yr.prototype.once=function(s,g){return Ob(g),this.on(s,_L(this,s,g)),this};Yr.prototype.prependOnceListener=function(s,g){return Ob(g),this.prependListener(s,_L(this,s,g)),this};Yr.prototype.removeListener=function(s,g){var m,R,A,D,x;if(Ob(g),R=this._events,R===void 0)return this;if(m=R[s],m===void 0)return this;if(m===g||m.listener===g)--this._eventsCount===0?this._events=Object.create(null):(delete R[s],R.removeListener&&this.emit("removeListener",s,m.listener||g));else if(typeof m!="function"){for(A=-1,D=m.length-1;D>=0;D--)if(m[D]===g||m[D].listener===g){x=m[D].listener,A=D;break}if(A<0)return this;A===0?m.shift():L5(m,A),m.length===1&&(R[s]=m[0]),R.removeListener!==void 0&&this.emit("removeListener",s,x||g)}return this};Yr.prototype.off=Yr.prototype.removeListener;Yr.prototype.removeAllListeners=function(s){var g,m,R;if(m=this._events,m===void 0)return this;if(m.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):m[s]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete m[s]),this;if(arguments.length===0){var A=Object.keys(m),D;for(R=0;R<A.length;++R)D=A[R],D!=="removeListener"&&this.removeAllListeners(D);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(g=m[s],typeof g=="function")this.removeListener(s,g);else if(g!==void 0)for(R=g.length-1;R>=0;R--)this.removeListener(s,g[R]);return this};function yL(i,s,g){var m=i._events;if(m===void 0)return[];var R=m[s];return R===void 0?[]:typeof R=="function"?g?[R.listener||R]:[R]:g?P5(R):IL(R,R.length)}Yr.prototype.listeners=function(s){return yL(this,s,!0)};Yr.prototype.rawListeners=function(s){return yL(this,s,!1)};Yr.listenerCount=function(i,s){return typeof i.listenerCount=="function"?i.listenerCount(s):SL.call(i,s)};Yr.prototype.listenerCount=SL;function SL(i){var s=this._events;if(s!==void 0){var g=s[i];if(typeof g=="function")return 1;if(g!==void 0)return g.length}return 0}Yr.prototype.eventNames=function(){return this._eventsCount>0?nb(this._events):[]};function IL(i,s){for(var g=new Array(s),m=0;m<s;++m)g[m]=i[m];return g}function L5(i,s){for(;s+1<i.length;s++)i[s]=i[s+1];i.pop()}function P5(i){for(var s=new Array(i.length),g=0;g<s.length;++g)s[g]=i[g].listener||i[g];return s}function x5(i,s){return new Promise(function(g,m){function R(D){i.removeListener(s,A),m(D)}function A(){typeof i.removeListener=="function"&&i.removeListener("error",R),g([].slice.call(arguments))}EL(i,s,A,{once:!0}),s!=="error"&&U5(i,R,{once:!0})})}function U5(i,s,g){typeof i.on=="function"&&EL(i,"error",s,g)}function EL(i,s,g,m){if(typeof i.on=="function")m.once?i.once(s,g):i.on(s,g);else if(typeof i.addEventListener=="function")i.addEventListener(s,function R(A){m.once&&i.removeEventListener(s,R),g(A)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var TL=(i=>(i[i.TRTCVideoResolution_120_120=1]="TRTCVideoResolution_120_120",i[i.TRTCVideoResolution_160_160=3]="TRTCVideoResolution_160_160",i[i.TRTCVideoResolution_270_270=5]="TRTCVideoResolution_270_270",i[i.TRTCVideoResolution_480_480=7]="TRTCVideoResolution_480_480",i[i.TRTCVideoResolution_160_120=50]="TRTCVideoResolution_160_120",i[i.TRTCVideoResolution_240_180=52]="TRTCVideoResolution_240_180",i[i.TRTCVideoResolution_280_210=54]="TRTCVideoResolution_280_210",i[i.TRTCVideoResolution_320_240=56]="TRTCVideoResolution_320_240",i[i.TRTCVideoResolution_400_300=58]="TRTCVideoResolution_400_300",i[i.TRTCVideoResolution_480_360=60]="TRTCVideoResolution_480_360",i[i.TRTCVideoResolution_640_480=62]="TRTCVideoResolution_640_480",i[i.TRTCVideoResolution_960_720=64]="TRTCVideoResolution_960_720",i[i.TRTCVideoResolution_160_90=100]="TRTCVideoResolution_160_90",i[i.TRTCVideoResolution_256_144=102]="TRTCVideoResolution_256_144",i[i.TRTCVideoResolution_320_180=104]="TRTCVideoResolution_320_180",i[i.TRTCVideoResolution_480_270=106]="TRTCVideoResolution_480_270",i[i.TRTCVideoResolution_640_360=108]="TRTCVideoResolution_640_360",i[i.TRTCVideoResolution_960_540=110]="TRTCVideoResolution_960_540",i[i.TRTCVideoResolution_1280_720=112]="TRTCVideoResolution_1280_720",i[i.TRTCVideoResolution_1920_1080=114]="TRTCVideoResolution_1920_1080",i))(TL||{}),Ed=(i=>(i[i.TRTCVideoStreamTypeBig=0]="TRTCVideoStreamTypeBig",i[i.TRTCVideoStreamTypeSmall=1]="TRTCVideoStreamTypeSmall",i[i.TRTCVideoStreamTypeSub=2]="TRTCVideoStreamTypeSub",i))(Ed||{}),LS=(i=>(i[i.TRTCVideoFillMode_Fill=0]="TRTCVideoFillMode_Fill",i[i.TRTCVideoFillMode_Fit=1]="TRTCVideoFillMode_Fit",i))(LS||{}),xw=(i=>(i[i.TRTCVideoRotation0=0]="TRTCVideoRotation0",i[i.TRTCVideoRotation90=1]="TRTCVideoRotation90",i[i.TRTCVideoRotation180=2]="TRTCVideoRotation180",i[i.TRTCVideoRotation270=3]="TRTCVideoRotation270",i))(xw||{}),cg=(i=>(i[i.TRTCVideoMirrorType_Auto=0]="TRTCVideoMirrorType_Auto",i[i.TRTCVideoMirrorType_Enable=1]="TRTCVideoMirrorType_Enable",i[i.TRTCVideoMirrorType_Disable=2]="TRTCVideoMirrorType_Disable",i))(cg||{}),uT=(i=>(i[i.TRTCRoleAnchor=20]="TRTCRoleAnchor",i[i.TRTCRoleAudience=21]="TRTCRoleAudience",i))(uT||{}),c1=(i=>(i[i.TRTCAudioQualitySpeech=1]="TRTCAudioQualitySpeech",i[i.TRTCAudioQualityDefault=2]="TRTCAudioQualityDefault",i[i.TRTCAudioQualityMusic=3]="TRTCAudioQualityMusic",i))(c1||{});class ML{constructor(s=0,g="",m="",R=0,A="",D=20,x=null,$=null,B=null,te=null){we(this,"sdkAppId");we(this,"userId");we(this,"userSig");we(this,"roomId");we(this,"strRoomId");we(this,"role");we(this,"privateMapKey");we(this,"businessInfo");we(this,"streamId");we(this,"userDefineRecordId");this.sdkAppId=s,this.userId=g,this.userSig=m,this.roomId=R,this.strRoomId=A,this.role=D,this.privateMapKey=x,this.businessInfo=$,this.streamId=B,this.userDefineRecordId=te}}class G5{constructor(s="",g=0){we(this,"userId");we(this,"quality");this.userId=s,this.quality=g}}class F5{constructor(s=0,g=0,m=null){we(this,"appId");we(this,"bizId");we(this,"url");this.appId=s,this.bizId=g,this.url=m}}class V5{constructor(s=0,g=0,m=0,R=0,A=0,D=0,x=0){we(this,"width");we(this,"height");we(this,"frameRate");we(this,"videoBitrate");we(this,"audioSampleRate");we(this,"audioBitrate");we(this,"streamType");this.width=s,this.height=g,this.frameRate=m,this.videoBitrate=R,this.audioSampleRate=A,this.audioBitrate=D,this.streamType=x}}class B5{constructor(s=0,g=0,m=0,R=0,A=0,D=0,x=0,$=[],B=0,te=[],re=0){we(this,"upLoss");we(this,"downLoss");we(this,"appCpu");we(this,"systemCpu");we(this,"rtt");we(this,"receivedBytes");we(this,"sentBytes");we(this,"localStatisticsArray");we(this,"localStatisticsArraySize");we(this,"remoteStatisticsArray");we(this,"remoteStatisticsArraySize");this.upLoss=s,this.downLoss=g,this.appCpu=m,this.systemCpu=R,this.rtt=A,this.receivedBytes=D,this.sentBytes=x,this.localStatisticsArray=$,this.localStatisticsArraySize=B,this.remoteStatisticsArray=te,this.remoteStatisticsArraySize=re}}const j5=-1,XC="onError",Uw="live",mb="rtc",RL="anchor",CL="audience",HO="standard",q5="high",H5="small",$5="big",ST="auxiliary",$O={20:RL,21:CL},K5={0:mb,1:Uw,2:mb,3:Uw},W5={1:HO,2:HO,3:q5},KO={0:$5,1:H5,2:ST};var Gw=(i=>(i[i.ActiveExitRoom=0]="ActiveExitRoom",i[i.KickedExitRoom=1]="KickedExitRoom",i))(Gw||{});function WO(){return Math.floor(performance.now())}const BS=i=>typeof i>"u",z5=i=>typeof i=="string";function PS(i){return`${i}-main`}function zO(i){return`${i}-${ST}`}function gg(...i){class s{constructor(){for(const R of i)Ew(this,new R(this))}}const g=s.prototype;for(const m of i)Ew(s,m),Ew(g,m.prototype);return s}function Ew(i,s){for(const g of Reflect.ownKeys(s))if(g!=="constructor"&&g!=="prototype"&&g!=="name"){const m=Object.getOwnPropertyDescriptor(s,g)||"";Object.defineProperty(i,g,m)}}var Tw={exports:{}},YO;function bL(){return YO||(YO=1,function(i,s){(function(g,m){i.exports=m()})(rc,function(){function g(r,c){var u=Object.keys(r);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(r);c&&(d=d.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),u.push.apply(u,d)}return u}function m(r){for(var c=1;c<arguments.length;c++){var u=arguments[c]!=null?arguments[c]:{};c%2?g(Object(u),!0).forEach(function(d){te(r,d,u[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(u)):g(Object(u)).forEach(function(d){Object.defineProperty(r,d,Object.getOwnPropertyDescriptor(u,d))})}return r}function R(r){return(R=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c})(r)}function A(r,c,u,d,p,v,f){try{var y=r[v](f),I=y.value}catch(T){return void u(T)}y.done?c(I):Promise.resolve(I).then(d,p)}function D(r){return function(){var c=this,u=arguments;return new Promise(function(d,p){var v=r.apply(c,u);function f(I){A(v,d,p,f,y,"next",I)}function y(I){A(v,d,p,f,y,"throw",I)}f(void 0)})}}function x(r,c){if(!(r instanceof c))throw new TypeError("Cannot call a class as a function")}function $(r,c){for(var u=0;u<c.length;u++){var d=c[u];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(r,d.key,d)}}function B(r,c,u){return c&&$(r.prototype,c),u&&$(r,u),Object.defineProperty(r,"prototype",{writable:!1}),r}function te(r,c,u){return c in r?Object.defineProperty(r,c,{value:u,enumerable:!0,configurable:!0,writable:!0}):r[c]=u,r}function re(r,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(c&&c.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),c&&W(r,c)}function ie(r){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(c){return c.__proto__||Object.getPrototypeOf(c)})(r)}function W(r,c){return(W=Object.setPrototypeOf||function(u,d){return u.__proto__=d,u})(r,c)}function Y(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function se(r,c,u){return(se=Y()?Reflect.construct:function(d,p,v){var f=[null];f.push.apply(f,p);var y=new(Function.bind.apply(d,f));return v&&W(y,v.prototype),y}).apply(null,arguments)}function Ae(r){var c=typeof Map=="function"?new Map:void 0;return(Ae=function(u){if(u===null||(d=u,Function.toString.call(d).indexOf("[native code]")===-1))return u;var d;if(typeof u!="function")throw new TypeError("Super expression must either be null or a function");if(c!==void 0){if(c.has(u))return c.get(u);c.set(u,p)}function p(){return se(u,arguments,ie(this).constructor)}return p.prototype=Object.create(u.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),W(p,u)})(r)}function Je(r,c){if(c&&(typeof c=="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}(r)}function Xe(r){var c=Y();return function(){var u,d=ie(r);if(c){var p=ie(this).constructor;u=Reflect.construct(d,arguments,p)}else u=d.apply(this,arguments);return Je(this,u)}}function Ue(r,c){for(;!Object.prototype.hasOwnProperty.call(r,c)&&(r=ie(r))!==null;);return r}function Be(){return(Be=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(r,c,u){var d=Ue(r,c);if(d){var p=Object.getOwnPropertyDescriptor(d,c);return p.get?p.get.call(arguments.length<3?r:u):p.value}}).apply(this,arguments)}function Pe(r,c){return function(u){if(Array.isArray(u))return u}(r)||function(u,d){var p=u==null?null:typeof Symbol<"u"&&u[Symbol.iterator]||u["@@iterator"];if(p!=null){var v,f,y=[],I=!0,T=!1;try{for(p=p.call(u);!(I=(v=p.next()).done)&&(y.push(v.value),!d||y.length!==d);I=!0);}catch(b){T=!0,f=b}finally{try{I||p.return==null||p.return()}finally{if(T)throw f}}return y}}(r,c)||Se(r,c)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function de(r){return function(c){if(Array.isArray(c))return Ee(c)}(r)||function(c){if(typeof Symbol<"u"&&c[Symbol.iterator]!=null||c["@@iterator"]!=null)return Array.from(c)}(r)||Se(r)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Se(r,c){if(r){if(typeof r=="string")return Ee(r,c);var u=Object.prototype.toString.call(r).slice(8,-1);return u==="Object"&&r.constructor&&(u=r.constructor.name),u==="Map"||u==="Set"?Array.from(r):u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?Ee(r,c):void 0}}function Ee(r,c){(c==null||c>r.length)&&(c=r.length);for(var u=0,d=new Array(c);u<c;u++)d[u]=r[u];return d}function ke(r,c){var u=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!u){if(Array.isArray(r)||(u=Se(r))||c&&r&&typeof r.length=="number"){u&&(r=u);var d=0,p=function(){};return{s:p,n:function(){return d>=r.length?{done:!0}:{done:!1,value:r[d++]}},e:function(I){throw I},f:p}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var v,f=!0,y=!1;return{s:function(){u=u.call(r)},n:function(){var I=u.next();return f=I.done,I},e:function(I){y=!0,v=I},f:function(){try{f||u.return==null||u.return()}finally{if(y)throw v}}}}function De(r,c,u,d,p){var v={};return Object.keys(d).forEach(function(f){v[f]=d[f]}),v.enumerable=!!v.enumerable,v.configurable=!!v.configurable,("value"in v||v.initializer)&&(v.writable=!0),v=u.slice().reverse().reduce(function(f,y){return y(r,c,f)||f},v),p&&v.initializer!==void 0&&(v.value=v.initializer?v.initializer.call(p):void 0,v.initializer=void 0),v.initializer===void 0&&(Object.defineProperty(r,c,v),v=null),v}var Qe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof rc<"u"?rc:typeof self<"u"?self:{};function vt(r,c){return r(c={exports:{}},c.exports),c.exports}var ft,it,ut=function(r){return r&&r.Math==Math&&r},ee=ut(typeof globalThis=="object"&&globalThis)||ut(typeof window=="object"&&window)||ut(typeof self=="object"&&self)||ut(typeof Qe=="object"&&Qe)||function(){return this}()||Function("return this")(),xe=function(r){try{return!!r()}catch{return!0}},Et=!xe(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Fn=!xe(function(){var r=function(){}.bind();return typeof r!="function"||r.hasOwnProperty("prototype")}),Fr=Function.prototype.call,dt=Fn?Fr.bind(Fr):function(){return Fr.apply(Fr,arguments)},ai={}.propertyIsEnumerable,bi=Object.getOwnPropertyDescriptor,dr={f:bi&&!ai.call({1:2},1)?function(r){var c=bi(this,r);return!!c&&c.enumerable}:ai},Gn=function(r,c){return{enumerable:!(1&r),configurable:!(2&r),writable:!(4&r),value:c}},Ai=Function.prototype,si=Ai.bind,Nr=Ai.call,_i=Fn&&si.bind(Nr,Nr),ve=Fn?function(r){return r&&_i(r)}:function(r){return r&&function(){return Nr.apply(r,arguments)}},qn=ve({}.toString),ho=ve("".slice),hr=function(r){return ho(qn(r),8,-1)},Ki=ee.Object,Co=ve("".split),qr=xe(function(){return!Ki("z").propertyIsEnumerable(0)})?function(r){return hr(r)=="String"?Co(r,""):Ki(r)}:Ki,Oo=ee.TypeError,an=function(r){if(r==null)throw Oo("Can't call method on "+r);return r},ur=function(r){return qr(an(r))},bt=function(r){return typeof r=="function"},xt=function(r){return typeof r=="object"?r!==null:bt(r)},Qo=function(r){return bt(r)?r:void 0},_r=function(r,c){return arguments.length<2?Qo(ee[r]):ee[r]&&ee[r][c]},nt=ve({}.isPrototypeOf),nn=_r("navigator","userAgent")||"",yi=ee.process,Lr=ee.Deno,pr=yi&&yi.versions||Lr&&Lr.version,ma=pr&&pr.v8;ma&&(it=(ft=ma.split("."))[0]>0&&ft[0]<4?1:+(ft[0]+ft[1])),!it&&nn&&(!(ft=nn.match(/Edge\/(\d+)/))||ft[1]>=74)&&(ft=nn.match(/Chrome\/(\d+)/))&&(it=+ft[1]);var Ge=it,ct=!!Object.getOwnPropertySymbols&&!xe(function(){var r=Symbol();return!String(r)||!(Object(r)instanceof Symbol)||!Symbol.sham&&Ge&&Ge<41}),Mn=ct&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Vn=ee.Object,rr=Mn?function(r){return typeof r=="symbol"}:function(r){var c=_r("Symbol");return bt(c)&&nt(c.prototype,Vn(r))},No=ee.String,ci=function(r){try{return No(r)}catch{return"Object"}},Zo=ee.TypeError,er=function(r){if(bt(r))return r;throw Zo(ci(r)+" is not a function")},Ir=function(r,c){var u=r[c];return u==null?void 0:er(u)},va=ee.TypeError,up=Object.defineProperty,Cd=function(r,c){try{up(ee,r,{value:c,configurable:!0,writable:!0})}catch{ee[r]=c}return c},ui=ee["__core-js_shared__"]||Cd("__core-js_shared__",{}),ja=vt(function(r){(r.exports=function(c,u){return ui[c]||(ui[c]=u!==void 0?u:{})})("versions",[]).push({version:"3.22.5",mode:"global",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.22.5/LICENSE",source:"https://github.com/zloirock/core-js"})}),Kv=ee.Object,fr=function(r){return Kv(an(r))},pl=ve({}.hasOwnProperty),st=Object.hasOwn||function(r,c){return pl(fr(r),c)},Wv=0,r0=Math.random(),vg=ve(1 .toString),Wi=function(r){return"Symbol("+(r===void 0?"":r)+")_"+vg(++Wv+r0,36)},Pr=ja("wks"),Lo=ee.Symbol,_g=Lo&&Lo.for,oc=Mn?Lo:Lo&&Lo.withoutSetter||Wi,Qt=function(r){if(!st(Pr,r)||!ct&&typeof Pr[r]!="string"){var c="Symbol."+r;ct&&st(Lo,r)?Pr[r]=Lo[r]:Pr[r]=Mn&&_g?_g(c):oc(c)}return Pr[r]},i0=ee.TypeError,qa=Qt("toPrimitive"),bd=function(r,c){if(!xt(r)||rr(r))return r;var u,d=Ir(r,qa);if(d){if(c===void 0&&(c="default"),u=dt(d,r,c),!xt(u)||rr(u))return u;throw i0("Can't convert object to primitive value")}return c===void 0&&(c="number"),function(p,v){var f,y;if(v==="string"&&bt(f=p.toString)&&!xt(y=dt(f,p))||bt(f=p.valueOf)&&!xt(y=dt(f,p))||v!=="string"&&bt(f=p.toString)&&!xt(y=dt(f,p)))return y;throw va("Can't convert object to primitive value")}(r,c)},Si=function(r){var c=bd(r,"string");return rr(c)?c:c+""},bo=ee.document,zv=xt(bo)&&xt(bo.createElement),_a=function(r){return zv?bo.createElement(r):{}},yg=!Et&&!xe(function(){return Object.defineProperty(_a("div"),"a",{get:function(){return 7}}).a!=7}),lp=Object.getOwnPropertyDescriptor,ki={f:Et?lp:function(r,c){if(r=ur(r),c=Si(c),yg)try{return lp(r,c)}catch{}if(st(r,c))return Gn(!dt(dr.f,r,c),r[c])}},Sg=Et&&xe(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),uu=ee.String,o0=ee.TypeError,Sn=function(r){if(xt(r))return r;throw o0(uu(r)+" is not an object")},a0=ee.TypeError,Ad=Object.defineProperty,kd=Object.getOwnPropertyDescriptor,Yn={f:Et?Sg?function(r,c,u){if(Sn(r),c=Si(c),Sn(u),typeof r=="function"&&c==="prototype"&&"value"in u&&"writable"in u&&!u.writable){var d=kd(r,c);d&&d.writable&&(r[c]=u.value,u={configurable:"configurable"in u?u.configurable:d.configurable,enumerable:"enumerable"in u?u.enumerable:d.enumerable,writable:!1})}return Ad(r,c,u)}:Ad:function(r,c,u){if(Sn(r),c=Si(c),Sn(u),yg)try{return Ad(r,c,u)}catch{}if("get"in u||"set"in u)throw a0("Accessors not supported");return"value"in u&&(r[c]=u.value),r}},Hn=Et?function(r,c,u){return Yn.f(r,c,Gn(1,u))}:function(r,c,u){return r[c]=u,r},Yv=Function.prototype,dp=Et&&Object.getOwnPropertyDescriptor,ya=st(Yv,"name"),Sa={EXISTS:ya,PROPER:ya&&function(){}.name==="something",CONFIGURABLE:ya&&(!Et||Et&&dp(Yv,"name").configurable)},wi=ve(Function.toString);bt(ui.inspectSource)||(ui.inspectSource=function(r){return wi(r)});var As,fl,gl,ac=ui.inspectSource,ks=ee.WeakMap,Ig=bt(ks)&&/native code/.test(ac(ks)),Jv=ja("keys"),to=function(r){return Jv[r]||(Jv[r]=Wi(r))},hp={},wd=ee.TypeError,Eg=ee.WeakMap;if(Ig||ui.state){var ea=ui.state||(ui.state=new Eg),Jr=ve(ea.get),lu=ve(ea.has),Xv=ve(ea.set);As=function(r,c){if(lu(ea,r))throw new wd("Object already initialized");return c.facade=r,Xv(ea,r,c),c},fl=function(r){return Jr(ea,r)||{}},gl=function(r){return lu(ea,r)}}else{var sc=to("state");hp[sc]=!0,As=function(r,c){if(st(r,sc))throw new wd("Object already initialized");return c.facade=r,Hn(r,sc,c),c},fl=function(r){return st(r,sc)?r[sc]:{}},gl=function(r){return st(r,sc)}}var Tr={set:As,get:fl,has:gl,enforce:function(r){return gl(r)?fl(r):As(r,{})},getterFor:function(r){return function(c){var u;if(!xt(c)||(u=fl(c)).type!==r)throw wd("Incompatible receiver, "+r+" required");return u}}},lr=vt(function(r){var c=Sa.CONFIGURABLE,u=Tr.enforce,d=Tr.get,p=Object.defineProperty,v=Et&&!xe(function(){return p(function(){},"length",{value:8}).length!==8}),f=String(String).split("String"),y=r.exports=function(I,T,b){if(String(T).slice(0,7)==="Symbol("&&(T="["+String(T).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),b&&b.getter&&(T="get "+T),b&&b.setter&&(T="set "+T),(!st(I,"name")||c&&I.name!==T)&&p(I,"name",{value:T,configurable:!0}),v&&b&&st(b,"arity")&&I.length!==b.arity&&p(I,"length",{value:b.arity}),b&&st(b,"constructor")&&b.constructor){if(Et)try{p(I,"prototype",{writable:!1})}catch{}}else I.prototype=void 0;var k=u(I);return st(k,"source")||(k.source=f.join(typeof T=="string"?T:"")),I};Function.prototype.toString=y(function(){return bt(this)&&d(this).source||ac(this)},"toString")}),sr=function(r,c,u,d){var p=!!d&&!!d.unsafe,v=!!d&&!!d.enumerable,f=!!d&&!!d.noTargetGet,y=d&&d.name!==void 0?d.name:c;return bt(u)&&lr(u,y,d),r===ee?(v?r[c]=u:Cd(c,u),r):(p?!f&&r[c]&&(v=!0):delete r[c],v?r[c]=u:Hn(r,c,u),r)},Ha=Math.ceil,$a=Math.floor,Ia=function(r){var c=+r;return c!=c||c===0?0:(c>0?$a:Ha)(c)},s0=Math.max,Li=Math.min,po=function(r,c){var u=Ia(r);return u<0?s0(u+c,0):Li(u,c)},Ea=Math.min,xr=function(r){return r>0?Ea(Ia(r),9007199254740991):0},Pi=function(r){return xr(r.length)},ml=function(r){return function(c,u,d){var p,v=ur(c),f=Pi(v),y=po(d,f);if(r&&u!=u){for(;f>y;)if((p=v[y++])!=p)return!0}else for(;f>y;y++)if((r||y in v)&&v[y]===u)return r||y||0;return!r&&-1}},Dd={includes:ml(!0),indexOf:ml(!1)},Qv=Dd.indexOf,Tg=ve([].push),vl=function(r,c){var u,d=ur(r),p=0,v=[];for(u in d)!st(hp,u)&&st(d,u)&&Tg(v,u);for(;c.length>p;)st(d,u=c[p++])&&(~Qv(v,u)||Tg(v,u));return v},du=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],cc=du.concat("length","prototype"),ta={f:Object.getOwnPropertyNames||function(r){return vl(r,cc)}},pp={f:Object.getOwnPropertySymbols},Zv=ve([].concat),fp=_r("Reflect","ownKeys")||function(r){var c=ta.f(Sn(r)),u=pp.f;return u?Zv(c,u(r)):c},e_=function(r,c,u){for(var d=fp(c),p=Yn.f,v=ki.f,f=0;f<d.length;f++){var y=d[f];st(r,y)||u&&st(u,y)||p(r,y,v(c,y))}},_l=/#|\.prototype\./,uc=function(r,c){var u=Mg[Od(r)];return u==Ta||u!=Rg&&(bt(c)?xe(c):!!c)},Od=uc.normalize=function(r){return String(r).replace(_l,".").toLowerCase()},Mg=uc.data={},Rg=uc.NATIVE="N",Ta=uc.POLYFILL="P",hu=uc,sn=ki.f,cn=function(r,c){var u,d,p,v,f,y=r.target,I=r.global,T=r.stat;if(u=I?ee:T?ee[y]||Cd(y,{}):(ee[y]||{}).prototype)for(d in c){if(v=c[d],p=r.noTargetGet?(f=sn(u,d))&&f.value:u[d],!hu(I?d:y+(T?".":"#")+d,r.forced)&&p!==void 0){if(typeof v==typeof p)continue;e_(v,p)}(r.sham||p&&p.sham)&&Hn(v,"sham",!0),sr(u,d,v,r)}},lc=ve(ve.bind),Ma=function(r,c){return er(r),c===void 0?r:Fn?lc(r,c):function(){return r.apply(c,arguments)}},dc=Array.isArray||function(r){return hr(r)=="Array"},t_={};t_[Qt("toStringTag")]="z";var xi=String(t_)==="[object z]",Cg=Qt("toStringTag"),fn=ee.Object,hc=hr(function(){return arguments}())=="Arguments",Ka=xi?hr:function(r){var c,u,d;return r===void 0?"Undefined":r===null?"Null":typeof(u=function(p,v){try{return p[v]}catch{}}(c=fn(r),Cg))=="string"?u:hc?hr(c):(d=hr(c))=="Object"&&bt(c.callee)?"Arguments":d},yl=function(){},Sl=[],n_=_r("Reflect","construct"),Nd=/^\s*(?:class|function)\b/,li=ve(Nd.exec),c0=!Nd.exec(yl),ws=function(r){if(!bt(r))return!1;try{return n_(yl,Sl,r),!0}catch{return!1}},gp=function(r){if(!bt(r))return!1;switch(Ka(r)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return c0||!!li(Nd,ac(r))}catch{return!0}};gp.sham=!0;var pc=!n_||xe(function(){var r;return ws(ws.call)||!ws(Object)||!ws(function(){r=!0})||r})?gp:ws,Il=Qt("species"),r_=ee.Array,El=function(r,c){return new(function(u){var d;return dc(u)&&(d=u.constructor,(pc(d)&&(d===r_||dc(d.prototype))||xt(d)&&(d=d[Il])===null)&&(d=void 0)),d===void 0?r_:d}(r))(c===0?0:c)},Ld=ve([].push),no=function(r){var c=r==1,u=r==2,d=r==3,p=r==4,v=r==6,f=r==7,y=r==5||v;return function(I,T,b,k){for(var N,O,F=fr(I),G=qr(F),P=Ma(T,b),K=Pi(G),X=0,oe=k||El,Ce=c?oe(I,K):u||f?oe(I,0):void 0;K>X;X++)if((y||X in G)&&(O=P(N=G[X],X,F),r))if(c)Ce[X]=O;else if(O)switch(r){case 3:return!0;case 5:return N;case 6:return X;case 2:Ld(Ce,N)}else switch(r){case 4:return!1;case 7:Ld(Ce,N)}return v?-1:d||p?p:Ce}},Zr={forEach:no(0),map:no(1),filter:no(2),some:no(3),every:no(4),find:no(5),findIndex:no(6),filterReject:no(7)},mp=Qt("species"),Tl=function(r){return Ge>=51||!xe(function(){var c=[];return(c.constructor={})[mp]=function(){return{foo:1}},c[r](Boolean).foo!==1})},vp=Zr.map,i_=Tl("map");cn({target:"Array",proto:!0,forced:!i_},{map:function(r){return vp(this,r,arguments.length>1?arguments[1]:void 0)}});var o_=Zr.filter,Ds=Tl("filter");cn({target:"Array",proto:!0,forced:!Ds},{filter:function(r){return o_(this,r,arguments.length>1?arguments[1]:void 0)}});var na=xi?{}.toString:function(){return"[object "+Ka(this)+"]"};xi||sr(Object.prototype,"toString",na,{unsafe:!0});var a_=ki.f,ra=xe(function(){a_(1)});cn({target:"Object",stat:!0,forced:!Et||ra,sham:!Et},{getOwnPropertyDescriptor:function(r,c){return a_(ur(r),c)}}),vt(function(r){var c=function(u){var d=Object.prototype,p=d.hasOwnProperty,v=typeof Symbol=="function"?Symbol:{},f=v.iterator||"@@iterator",y=v.asyncIterator||"@@asyncIterator",I=v.toStringTag||"@@toStringTag";function T(Q,j,le){return Object.defineProperty(Q,j,{value:le,enumerable:!0,configurable:!0,writable:!0}),Q[j]}try{T({},"")}catch{T=function(j,le,fe){return j[le]=fe}}function b(Q,j,le,fe){var Ie=j&&j.prototype instanceof O?j:O,Ne=Object.create(Ie.prototype),lt=new qe(fe||[]);return Ne._invoke=function(Dt,Ut,St){var _n="suspendedStart";return function(Gt,zn){if(_n==="executing")throw new Error("Generator is already running");if(_n==="completed"){if(Gt==="throw")throw zn;return Tn()}for(St.method=Gt,St.arg=zn;;){var Un=St.delegate;if(Un){var on=je(Un,St);if(on){if(on===N)continue;return on}}if(St.method==="next")St.sent=St._sent=St.arg;else if(St.method==="throw"){if(_n==="suspendedStart")throw _n="completed",St.arg;St.dispatchException(St.arg)}else St.method==="return"&&St.abrupt("return",St.arg);_n="executing";var vr=k(Dt,Ut,St);if(vr.type==="normal"){if(_n=St.done?"completed":"suspendedYield",vr.arg===N)continue;return{value:vr.arg,done:St.done}}vr.type==="throw"&&(_n="completed",St.method="throw",St.arg=vr.arg)}}}(Q,le,lt),Ne}function k(Q,j,le){try{return{type:"normal",arg:Q.call(j,le)}}catch(fe){return{type:"throw",arg:fe}}}u.wrap=b;var N={};function O(){}function F(){}function G(){}var P={};T(P,f,function(){return this});var K=Object.getPrototypeOf,X=K&&K(K($e([])));X&&X!==d&&p.call(X,f)&&(P=X);var oe=G.prototype=O.prototype=Object.create(P);function Ce(Q){["next","throw","return"].forEach(function(j){T(Q,j,function(le){return this._invoke(j,le)})})}function Ve(Q,j){var le;this._invoke=function(fe,Ie){function Ne(){return new j(function(lt,Dt){(function Ut(St,_n,Gt,zn){var Un=k(Q[St],Q,_n);if(Un.type!=="throw"){var on=Un.arg,vr=on.value;return vr&&typeof vr=="object"&&p.call(vr,"__await")?j.resolve(vr.__await).then(function(qi){Ut("next",qi,Gt,zn)},function(qi){Ut("throw",qi,Gt,zn)}):j.resolve(vr).then(function(qi){on.value=qi,Gt(on)},function(qi){return Ut("throw",qi,Gt,zn)})}zn(Un.arg)})(fe,Ie,lt,Dt)})}return le=le?le.then(Ne,Ne):Ne()}}function je(Q,j){var le=Q.iterator[j.method];if(le===void 0){if(j.delegate=null,j.method==="throw"){if(Q.iterator.return&&(j.method="return",j.arg=void 0,je(Q,j),j.method==="throw"))return N;j.method="throw",j.arg=new TypeError("The iterator does not provide a 'throw' method")}return N}var fe=k(le,Q.iterator,j.arg);if(fe.type==="throw")return j.method="throw",j.arg=fe.arg,j.delegate=null,N;var Ie=fe.arg;return Ie?Ie.done?(j[Q.resultName]=Ie.value,j.next=Q.nextLoc,j.method!=="return"&&(j.method="next",j.arg=void 0),j.delegate=null,N):Ie:(j.method="throw",j.arg=new TypeError("iterator result is not an object"),j.delegate=null,N)}function Re(Q){var j={tryLoc:Q[0]};1 in Q&&(j.catchLoc=Q[1]),2 in Q&&(j.finallyLoc=Q[2],j.afterLoc=Q[3]),this.tryEntries.push(j)}function Oe(Q){var j=Q.completion||{};j.type="normal",delete j.arg,Q.completion=j}function qe(Q){this.tryEntries=[{tryLoc:"root"}],Q.forEach(Re,this),this.reset(!0)}function $e(Q){if(Q){var j=Q[f];if(j)return j.call(Q);if(typeof Q.next=="function")return Q;if(!isNaN(Q.length)){var le=-1,fe=function Ie(){for(;++le<Q.length;)if(p.call(Q,le))return Ie.value=Q[le],Ie.done=!1,Ie;return Ie.value=void 0,Ie.done=!0,Ie};return fe.next=fe}}return{next:Tn}}function Tn(){return{value:void 0,done:!0}}return F.prototype=G,T(oe,"constructor",G),T(G,"constructor",F),F.displayName=T(G,I,"GeneratorFunction"),u.isGeneratorFunction=function(Q){var j=typeof Q=="function"&&Q.constructor;return!!j&&(j===F||(j.displayName||j.name)==="GeneratorFunction")},u.mark=function(Q){return Object.setPrototypeOf?Object.setPrototypeOf(Q,G):(Q.__proto__=G,T(Q,I,"GeneratorFunction")),Q.prototype=Object.create(oe),Q},u.awrap=function(Q){return{__await:Q}},Ce(Ve.prototype),T(Ve.prototype,y,function(){return this}),u.AsyncIterator=Ve,u.async=function(Q,j,le,fe,Ie){Ie===void 0&&(Ie=Promise);var Ne=new Ve(b(Q,j,le,fe),Ie);return u.isGeneratorFunction(j)?Ne:Ne.next().then(function(lt){return lt.done?lt.value:Ne.next()})},Ce(oe),T(oe,I,"Generator"),T(oe,f,function(){return this}),T(oe,"toString",function(){return"[object Generator]"}),u.keys=function(Q){var j=[];for(var le in Q)j.push(le);return j.reverse(),function fe(){for(;j.length;){var Ie=j.pop();if(Ie in Q)return fe.value=Ie,fe.done=!1,fe}return fe.done=!0,fe}},u.values=$e,qe.prototype={constructor:qe,reset:function(Q){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(Oe),!Q)for(var j in this)j.charAt(0)==="t"&&p.call(this,j)&&!isNaN(+j.slice(1))&&(this[j]=void 0)},stop:function(){this.done=!0;var Q=this.tryEntries[0].completion;if(Q.type==="throw")throw Q.arg;return this.rval},dispatchException:function(Q){if(this.done)throw Q;var j=this;function le(Ut,St){return Ne.type="throw",Ne.arg=Q,j.next=Ut,St&&(j.method="next",j.arg=void 0),!!St}for(var fe=this.tryEntries.length-1;fe>=0;--fe){var Ie=this.tryEntries[fe],Ne=Ie.completion;if(Ie.tryLoc==="root")return le("end");if(Ie.tryLoc<=this.prev){var lt=p.call(Ie,"catchLoc"),Dt=p.call(Ie,"finallyLoc");if(lt&&Dt){if(this.prev<Ie.catchLoc)return le(Ie.catchLoc,!0);if(this.prev<Ie.finallyLoc)return le(Ie.finallyLoc)}else if(lt){if(this.prev<Ie.catchLoc)return le(Ie.catchLoc,!0)}else{if(!Dt)throw new Error("try statement without catch or finally");if(this.prev<Ie.finallyLoc)return le(Ie.finallyLoc)}}}},abrupt:function(Q,j){for(var le=this.tryEntries.length-1;le>=0;--le){var fe=this.tryEntries[le];if(fe.tryLoc<=this.prev&&p.call(fe,"finallyLoc")&&this.prev<fe.finallyLoc){var Ie=fe;break}}Ie&&(Q==="break"||Q==="continue")&&Ie.tryLoc<=j&&j<=Ie.finallyLoc&&(Ie=null);var Ne=Ie?Ie.completion:{};return Ne.type=Q,Ne.arg=j,Ie?(this.method="next",this.next=Ie.finallyLoc,N):this.complete(Ne)},complete:function(Q,j){if(Q.type==="throw")throw Q.arg;return Q.type==="break"||Q.type==="continue"?this.next=Q.arg:Q.type==="return"?(this.rval=this.arg=Q.arg,this.method="return",this.next="end"):Q.type==="normal"&&j&&(this.next=j),N},finish:function(Q){for(var j=this.tryEntries.length-1;j>=0;--j){var le=this.tryEntries[j];if(le.finallyLoc===Q)return this.complete(le.completion,le.afterLoc),Oe(le),N}},catch:function(Q){for(var j=this.tryEntries.length-1;j>=0;--j){var le=this.tryEntries[j];if(le.tryLoc===Q){var fe=le.completion;if(fe.type==="throw"){var Ie=fe.arg;Oe(le)}return Ie}}throw new Error("illegal catch attempt")},delegateYield:function(Q,j,le){return this.delegate={iterator:$e(Q),resultName:j,nextLoc:le},this.method==="next"&&(this.arg=void 0),N}},u}(r.exports);try{regeneratorRuntime=c}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=c:Function("r","regeneratorRuntime = r")(c)}});let fc=!0,Pd=!0;function Ml(r,c,u){const d=r.match(c);return d&&d.length>=u&&parseInt(d[u],10)}function gc(r,c,u){if(!r.RTCPeerConnection)return;const d=r.RTCPeerConnection.prototype,p=d.addEventListener;d.addEventListener=function(f,y){if(f!==c)return p.apply(this,arguments);const I=T=>{const b=u(T);b&&(y.handleEvent?y.handleEvent(b):y(b))};return this._eventMap=this._eventMap||{},this._eventMap[c]||(this._eventMap[c]=new Map),this._eventMap[c].set(y,I),p.apply(this,[f,I])};const v=d.removeEventListener;d.removeEventListener=function(f,y){if(f!==c||!this._eventMap||!this._eventMap[c])return v.apply(this,arguments);if(!this._eventMap[c].has(y))return v.apply(this,arguments);const I=this._eventMap[c].get(y);return this._eventMap[c].delete(y),this._eventMap[c].size===0&&delete this._eventMap[c],Object.keys(this._eventMap).length===0&&delete this._eventMap,v.apply(this,[f,I])},Object.defineProperty(d,"on"+c,{get(){return this["_on"+c]},set(f){this["_on"+c]&&(this.removeEventListener(c,this["_on"+c]),delete this["_on"+c]),f&&this.addEventListener(c,this["_on"+c]=f)},enumerable:!0,configurable:!0})}function pu(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(fc=r,r?"adapter.js logging disabled":"adapter.js logging enabled")}function _p(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(Pd=!r,"adapter.js deprecation warnings "+(r?"disabled":"enabled"))}function Ra(){if(typeof window=="object"){if(fc)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Os(r,c){Pd&&console.warn(r+" is deprecated, please use "+c+" instead.")}function yp(r){return Object.prototype.toString.call(r)==="[object Object]"}function xd(r){return yp(r)?Object.keys(r).reduce(function(c,u){const d=yp(r[u]),p=d?xd(r[u]):r[u],v=d&&!Object.keys(p).length;return p===void 0||v?c:Object.assign(c,{[u]:p})},{}):r}function bg(r,c,u){const d=u?"outbound-rtp":"inbound-rtp",p=new Map;if(c===null)return p;const v=[];return r.forEach(f=>{f.type==="track"&&f.trackIdentifier===c.id&&v.push(f)}),v.forEach(f=>{r.forEach(y=>{y.type===d&&y.trackId===f.id&&function I(T,b,k){b&&!k.has(b.id)&&(k.set(b.id,b),Object.keys(b).forEach(N=>{N.endsWith("Id")?I(T,T.get(b[N]),k):N.endsWith("Ids")&&b[N].forEach(O=>{I(T,T.get(O),k)})}))}(r,y,p)})}),p}const Ud=Ra;function Rl(r,c){const u=r&&r.navigator;if(!u.mediaDevices)return;const d=function(f){if(typeof f!="object"||f.mandatory||f.optional)return f;const y={};return Object.keys(f).forEach(I=>{if(I==="require"||I==="advanced"||I==="mediaSource")return;const T=typeof f[I]=="object"?f[I]:{ideal:f[I]};T.exact!==void 0&&typeof T.exact=="number"&&(T.min=T.max=T.exact);const b=function(k,N){return k?k+N.charAt(0).toUpperCase()+N.slice(1):N==="deviceId"?"sourceId":N};if(T.ideal!==void 0){y.optional=y.optional||[];let k={};typeof T.ideal=="number"?(k[b("min",I)]=T.ideal,y.optional.push(k),k={},k[b("max",I)]=T.ideal,y.optional.push(k)):(k[b("",I)]=T.ideal,y.optional.push(k))}T.exact!==void 0&&typeof T.exact!="number"?(y.mandatory=y.mandatory||{},y.mandatory[b("",I)]=T.exact):["min","max"].forEach(k=>{T[k]!==void 0&&(y.mandatory=y.mandatory||{},y.mandatory[b(k,I)]=T[k])})}),f.advanced&&(y.optional=(y.optional||[]).concat(f.advanced)),y},p=function(f,y){if(c.version>=61)return y(f);if((f=JSON.parse(JSON.stringify(f)))&&typeof f.audio=="object"){const I=function(T,b,k){b in T&&!(k in T)&&(T[k]=T[b],delete T[b])};I((f=JSON.parse(JSON.stringify(f))).audio,"autoGainControl","googAutoGainControl"),I(f.audio,"noiseSuppression","googNoiseSuppression"),f.audio=d(f.audio)}if(f&&typeof f.video=="object"){let I=f.video.facingMode;I=I&&(typeof I=="object"?I:{ideal:I});const T=c.version<66;if(I&&(I.exact==="user"||I.exact==="environment"||I.ideal==="user"||I.ideal==="environment")&&(!u.mediaDevices.getSupportedConstraints||!u.mediaDevices.getSupportedConstraints().facingMode||T)){let b;if(delete f.video.facingMode,I.exact==="environment"||I.ideal==="environment"?b=["back","rear"]:I.exact!=="user"&&I.ideal!=="user"||(b=["front"]),b)return u.mediaDevices.enumerateDevices().then(k=>{let N=(k=k.filter(O=>O.kind==="videoinput")).find(O=>b.some(F=>O.label.toLowerCase().includes(F)));return!N&&k.length&&b.includes("back")&&(N=k[k.length-1]),N&&(f.video.deviceId=I.exact?{exact:N.deviceId}:{ideal:N.deviceId}),f.video=d(f.video),Ud("chrome: "+JSON.stringify(f)),y(f)})}f.video=d(f.video)}return Ud("chrome: "+JSON.stringify(f)),y(f)},v=function(f){return c.version>=64?f:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[f.name]||f.name,message:f.message,constraint:f.constraint||f.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(u.getUserMedia=function(f,y,I){p(f,T=>{u.webkitGetUserMedia(T,y,b=>{I&&I(v(b))})})}.bind(u),u.mediaDevices.getUserMedia){const f=u.mediaDevices.getUserMedia.bind(u.mediaDevices);u.mediaDevices.getUserMedia=function(y){return p(y,I=>f(I).then(T=>{if(I.audio&&!T.getAudioTracks().length||I.video&&!T.getVideoTracks().length)throw T.getTracks().forEach(b=>{b.stop()}),new DOMException("","NotFoundError");return T},T=>Promise.reject(v(T))))}}}function fu(r){r.MediaStream=r.MediaStream||r.webkitMediaStream}function Wa(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("ontrack"in r.RTCPeerConnection.prototype)){Object.defineProperty(r.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(u){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=u)},enumerable:!0,configurable:!0});const c=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=u=>{u.stream.addEventListener("addtrack",d=>{let p;p=r.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(f=>f.track&&f.track.id===d.track.id):{track:d.track};const v=new Event("track");v.track=d.track,v.receiver=p,v.transceiver={receiver:p},v.streams=[u.stream],this.dispatchEvent(v)}),u.stream.getTracks().forEach(d=>{let p;p=r.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(f=>f.track&&f.track.id===d.id):{track:d};const v=new Event("track");v.track=d,v.receiver=p,v.transceiver={receiver:p},v.streams=[u.stream],this.dispatchEvent(v)})},this.addEventListener("addstream",this._ontrackpoly)),c.apply(this,arguments)}}else gc(r,"track",c=>(c.transceiver||Object.defineProperty(c,"transceiver",{value:{receiver:c.receiver}}),c))}function Ui(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("getSenders"in r.RTCPeerConnection.prototype)&&"createDTMFSender"in r.RTCPeerConnection.prototype){const c=function(p,v){return{track:v,get dtmf(){return this._dtmf===void 0&&(v.kind==="audio"?this._dtmf=p.createDTMFSender(v):this._dtmf=null),this._dtmf},_pc:p}};if(!r.RTCPeerConnection.prototype.getSenders){r.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const p=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(f,y){let I=p.apply(this,arguments);return I||(I=c(this,f),this._senders.push(I)),I};const v=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(f){v.apply(this,arguments);const y=this._senders.indexOf(f);y!==-1&&this._senders.splice(y,1)}}const u=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(p){this._senders=this._senders||[],u.apply(this,[p]),p.getTracks().forEach(v=>{this._senders.push(c(this,v))})};const d=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(p){this._senders=this._senders||[],d.apply(this,[p]),p.getTracks().forEach(v=>{const f=this._senders.find(y=>y.track===v);f&&this._senders.splice(this._senders.indexOf(f),1)})}}else if(typeof r=="object"&&r.RTCPeerConnection&&"getSenders"in r.RTCPeerConnection.prototype&&"createDTMFSender"in r.RTCPeerConnection.prototype&&r.RTCRtpSender&&!("dtmf"in r.RTCRtpSender.prototype)){const c=r.RTCPeerConnection.prototype.getSenders;r.RTCPeerConnection.prototype.getSenders=function(){const u=c.apply(this,[]);return u.forEach(d=>d._pc=this),u},Object.defineProperty(r.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Cl(r){if(!r.RTCPeerConnection)return;const c=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[u,d,p]=arguments;if(arguments.length>0&&typeof u=="function")return c.apply(this,arguments);if(c.length===0&&(arguments.length===0||typeof u!="function"))return c.apply(this,[]);const v=function(y){const I={};return y.result().forEach(T=>{const b={id:T.id,timestamp:T.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[T.type]||T.type};T.names().forEach(k=>{b[k]=T.stat(k)}),I[b.id]=b}),I},f=function(y){return new Map(Object.keys(y).map(I=>[I,y[I]]))};if(arguments.length>=2){const y=function(I){d(f(v(I)))};return c.apply(this,[y,u])}return new Promise((y,I)=>{c.apply(this,[function(T){y(f(v(T)))},I])}).then(d,p)}}function Ag(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&r.RTCRtpReceiver))return;if(!("getStats"in r.RTCRtpSender.prototype)){const u=r.RTCPeerConnection.prototype.getSenders;u&&(r.RTCPeerConnection.prototype.getSenders=function(){const p=u.apply(this,[]);return p.forEach(v=>v._pc=this),p});const d=r.RTCPeerConnection.prototype.addTrack;d&&(r.RTCPeerConnection.prototype.addTrack=function(){const p=d.apply(this,arguments);return p._pc=this,p}),r.RTCRtpSender.prototype.getStats=function(){const p=this;return this._pc.getStats().then(v=>bg(v,p.track,!0))}}if(!("getStats"in r.RTCRtpReceiver.prototype)){const u=r.RTCPeerConnection.prototype.getReceivers;u&&(r.RTCPeerConnection.prototype.getReceivers=function(){const d=u.apply(this,[]);return d.forEach(p=>p._pc=this),d}),gc(r,"track",d=>(d.receiver._pc=d.srcElement,d)),r.RTCRtpReceiver.prototype.getStats=function(){const d=this;return this._pc.getStats().then(p=>bg(p,d.track,!1))}}if(!("getStats"in r.RTCRtpSender.prototype)||!("getStats"in r.RTCRtpReceiver.prototype))return;const c=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof r.MediaStreamTrack){const u=arguments[0];let d,p,v;return this.getSenders().forEach(f=>{f.track===u&&(d?v=!0:d=f)}),this.getReceivers().forEach(f=>(f.track===u&&(p?v=!0:p=f),f.track===u)),v||d&&p?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):d?d.getStats():p?p.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return c.apply(this,arguments)}}function gu(r){r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(v=>this._shimmedLocalStreams[v][0])};const c=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(v,f){if(!f)return c.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const y=c.apply(this,arguments);return this._shimmedLocalStreams[f.id]?this._shimmedLocalStreams[f.id].indexOf(y)===-1&&this._shimmedLocalStreams[f.id].push(y):this._shimmedLocalStreams[f.id]=[f,y],y};const u=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(v){this._shimmedLocalStreams=this._shimmedLocalStreams||{},v.getTracks().forEach(I=>{if(this.getSenders().find(T=>T.track===I))throw new DOMException("Track already exists.","InvalidAccessError")});const f=this.getSenders();u.apply(this,arguments);const y=this.getSenders().filter(I=>f.indexOf(I)===-1);this._shimmedLocalStreams[v.id]=[v].concat(y)};const d=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(v){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[v.id],d.apply(this,arguments)};const p=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(v){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},v&&Object.keys(this._shimmedLocalStreams).forEach(f=>{const y=this._shimmedLocalStreams[f].indexOf(v);y!==-1&&this._shimmedLocalStreams[f].splice(y,1),this._shimmedLocalStreams[f].length===1&&delete this._shimmedLocalStreams[f]}),p.apply(this,arguments)}}function Sp(r,c){if(!r.RTCPeerConnection)return;if(r.RTCPeerConnection.prototype.addTrack&&c.version>=65)return gu(r);const u=r.RTCPeerConnection.prototype.getLocalStreams;r.RTCPeerConnection.prototype.getLocalStreams=function(){const T=u.apply(this);return this._reverseStreams=this._reverseStreams||{},T.map(b=>this._reverseStreams[b.id])};const d=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(T){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},T.getTracks().forEach(b=>{if(this.getSenders().find(k=>k.track===b))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[T.id]){const b=new r.MediaStream(T.getTracks());this._streams[T.id]=b,this._reverseStreams[b.id]=T,T=b}d.apply(this,[T])};const p=r.RTCPeerConnection.prototype.removeStream;function v(T,b){let k=b.sdp;return Object.keys(T._reverseStreams||[]).forEach(N=>{const O=T._reverseStreams[N],F=T._streams[O.id];k=k.replace(new RegExp(F.id,"g"),O.id)}),new RTCSessionDescription({type:b.type,sdp:k})}function f(T,b){let k=b.sdp;return Object.keys(T._reverseStreams||[]).forEach(N=>{const O=T._reverseStreams[N],F=T._streams[O.id];k=k.replace(new RegExp(O.id,"g"),F.id)}),new RTCSessionDescription({type:b.type,sdp:k})}r.RTCPeerConnection.prototype.removeStream=function(T){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.apply(this,[this._streams[T.id]||T]),delete this._reverseStreams[this._streams[T.id]?this._streams[T.id].id:T.id],delete this._streams[T.id]},r.RTCPeerConnection.prototype.addTrack=function(T,b){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const k=[].slice.call(arguments,1);if(k.length!==1||!k[0].getTracks().find(F=>F===T))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(F=>F.track===T))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const O=this._streams[b.id];if(O)O.addTrack(T),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const F=new r.MediaStream([T]);this._streams[b.id]=F,this._reverseStreams[F.id]=b,this.addStream(F)}return this.getSenders().find(F=>F.track===T)},["createOffer","createAnswer"].forEach(function(T){const b=r.RTCPeerConnection.prototype[T],k={[T](){const N=arguments;return arguments.length&&typeof arguments[0]=="function"?b.apply(this,[O=>{const F=v(this,O);N[0].apply(null,[F])},O=>{N[1]&&N[1].apply(null,O)},arguments[2]]):b.apply(this,arguments).then(O=>v(this,O))}};r.RTCPeerConnection.prototype[T]=k[T]});const y=r.RTCPeerConnection.prototype.setLocalDescription;r.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=f(this,arguments[0]),y.apply(this,arguments)):y.apply(this,arguments)};const I=Object.getOwnPropertyDescriptor(r.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(r.RTCPeerConnection.prototype,"localDescription",{get(){const T=I.get.apply(this);return T.type===""?T:v(this,T)}}),r.RTCPeerConnection.prototype.removeTrack=function(T){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!T._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(T._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let b;this._streams=this._streams||{},Object.keys(this._streams).forEach(k=>{this._streams[k].getTracks().find(N=>T.track===N)&&(b=this._streams[k])}),b&&(b.getTracks().length===1?this.removeStream(this._reverseStreams[b.id]):b.removeTrack(T.track),this.dispatchEvent(new Event("negotiationneeded")))}}function bl(r,c){!r.RTCPeerConnection&&r.webkitRTCPeerConnection&&(r.RTCPeerConnection=r.webkitRTCPeerConnection),r.RTCPeerConnection&&c.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(u){const d=r.RTCPeerConnection.prototype[u],p={[u](){return arguments[0]=new(u==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};r.RTCPeerConnection.prototype[u]=p[u]})}function ro(r,c){gc(r,"negotiationneeded",u=>{const d=u.target;if(!(c.version<72||d.getConfiguration&&d.getConfiguration().sdpSemantics==="plan-b")||d.signalingState==="stable")return u})}var Ip=Object.freeze({__proto__:null,shimMediaStream:fu,shimOnTrack:Wa,shimGetSendersWithDtmf:Ui,shimGetStats:Cl,shimSenderReceiverGetStats:Ag,shimAddTrackRemoveTrackWithNative:gu,shimAddTrackRemoveTrack:Sp,shimPeerConnection:bl,fixNegotiationNeeded:ro,shimGetUserMedia:Rl,shimGetDisplayMedia:function(r,c){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(typeof c=="function"?r.navigator.mediaDevices.getDisplayMedia=function(u){return c(u).then(d=>{const p=u.video&&u.video.width,v=u.video&&u.video.height,f=u.video&&u.video.frameRate;return u.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:d,maxFrameRate:f||3}},p&&(u.video.mandatory.maxWidth=p),v&&(u.video.mandatory.maxHeight=v),r.navigator.mediaDevices.getUserMedia(u)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}),gn=vt(function(r){var c={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};c.localCName=c.generateIdentifier(),c.splitLines=function(u){return u.trim().split(`
`).map(function(d){return d.trim()})},c.splitSections=function(u){return u.split(`
m=`).map(function(d,p){return(p>0?"m="+d:d).trim()+`\r
`})},c.getDescription=function(u){var d=c.splitSections(u);return d&&d[0]},c.getMediaSections=function(u){var d=c.splitSections(u);return d.shift(),d},c.matchPrefix=function(u,d){return c.splitLines(u).filter(function(p){return p.indexOf(d)===0})},c.parseCandidate=function(u){for(var d,p={foundation:(d=u.indexOf("a=candidate:")===0?u.substring(12).split(" "):u.substring(10).split(" "))[0],component:parseInt(d[1],10),protocol:d[2].toLowerCase(),priority:parseInt(d[3],10),ip:d[4],address:d[4],port:parseInt(d[5],10),type:d[7]},v=8;v<d.length;v+=2)switch(d[v]){case"raddr":p.relatedAddress=d[v+1];break;case"rport":p.relatedPort=parseInt(d[v+1],10);break;case"tcptype":p.tcpType=d[v+1];break;case"ufrag":p.ufrag=d[v+1],p.usernameFragment=d[v+1];break;default:p[d[v]]=d[v+1]}return p},c.writeCandidate=function(u){var d=[];d.push(u.foundation),d.push(u.component),d.push(u.protocol.toUpperCase()),d.push(u.priority),d.push(u.address||u.ip),d.push(u.port);var p=u.type;return d.push("typ"),d.push(p),p!=="host"&&u.relatedAddress&&u.relatedPort&&(d.push("raddr"),d.push(u.relatedAddress),d.push("rport"),d.push(u.relatedPort)),u.tcpType&&u.protocol.toLowerCase()==="tcp"&&(d.push("tcptype"),d.push(u.tcpType)),(u.usernameFragment||u.ufrag)&&(d.push("ufrag"),d.push(u.usernameFragment||u.ufrag)),"candidate:"+d.join(" ")},c.parseIceOptions=function(u){return u.substr(14).split(" ")},c.parseRtpMap=function(u){var d=u.substr(9).split(" "),p={payloadType:parseInt(d.shift(),10)};return d=d[0].split("/"),p.name=d[0],p.clockRate=parseInt(d[1],10),p.channels=d.length===3?parseInt(d[2],10):1,p.numChannels=p.channels,p},c.writeRtpMap=function(u){var d=u.payloadType;u.preferredPayloadType!==void 0&&(d=u.preferredPayloadType);var p=u.channels||u.numChannels||1;return"a=rtpmap:"+d+" "+u.name+"/"+u.clockRate+(p!==1?"/"+p:"")+`\r
`},c.parseExtmap=function(u){var d=u.substr(9).split(" ");return{id:parseInt(d[0],10),direction:d[0].indexOf("/")>0?d[0].split("/")[1]:"sendrecv",uri:d[1]}},c.writeExtmap=function(u){return"a=extmap:"+(u.id||u.preferredId)+(u.direction&&u.direction!=="sendrecv"?"/"+u.direction:"")+" "+u.uri+`\r
`},c.parseFmtp=function(u){for(var d,p={},v=u.substr(u.indexOf(" ")+1).split(";"),f=0;f<v.length;f++)p[(d=v[f].trim().split("="))[0].trim()]=d[1];return p},c.writeFmtp=function(u){var d="",p=u.payloadType;if(u.preferredPayloadType!==void 0&&(p=u.preferredPayloadType),u.parameters&&Object.keys(u.parameters).length){var v=[];Object.keys(u.parameters).forEach(function(f){u.parameters[f]?v.push(f+"="+u.parameters[f]):v.push(f)}),d+="a=fmtp:"+p+" "+v.join(";")+`\r
`}return d},c.parseRtcpFb=function(u){var d=u.substr(u.indexOf(" ")+1).split(" ");return{type:d.shift(),parameter:d.join(" ")}},c.writeRtcpFb=function(u){var d="",p=u.payloadType;return u.preferredPayloadType!==void 0&&(p=u.preferredPayloadType),u.rtcpFeedback&&u.rtcpFeedback.length&&u.rtcpFeedback.forEach(function(v){d+="a=rtcp-fb:"+p+" "+v.type+(v.parameter&&v.parameter.length?" "+v.parameter:"")+`\r
`}),d},c.parseSsrcMedia=function(u){var d=u.indexOf(" "),p={ssrc:parseInt(u.substr(7,d-7),10)},v=u.indexOf(":",d);return v>-1?(p.attribute=u.substr(d+1,v-d-1),p.value=u.substr(v+1)):p.attribute=u.substr(d+1),p},c.parseSsrcGroup=function(u){var d=u.substr(13).split(" ");return{semantics:d.shift(),ssrcs:d.map(function(p){return parseInt(p,10)})}},c.getMid=function(u){var d=c.matchPrefix(u,"a=mid:")[0];if(d)return d.substr(6)},c.parseFingerprint=function(u){var d=u.substr(14).split(" ");return{algorithm:d[0].toLowerCase(),value:d[1]}},c.getDtlsParameters=function(u,d){return{role:"auto",fingerprints:c.matchPrefix(u+d,"a=fingerprint:").map(c.parseFingerprint)}},c.writeDtlsParameters=function(u,d){var p="a=setup:"+d+`\r
`;return u.fingerprints.forEach(function(v){p+="a=fingerprint:"+v.algorithm+" "+v.value+`\r
`}),p},c.parseCryptoLine=function(u){var d=u.substr(9).split(" ");return{tag:parseInt(d[0],10),cryptoSuite:d[1],keyParams:d[2],sessionParams:d.slice(3)}},c.writeCryptoLine=function(u){return"a=crypto:"+u.tag+" "+u.cryptoSuite+" "+(typeof u.keyParams=="object"?c.writeCryptoKeyParams(u.keyParams):u.keyParams)+(u.sessionParams?" "+u.sessionParams.join(" "):"")+`\r
`},c.parseCryptoKeyParams=function(u){if(u.indexOf("inline:")!==0)return null;var d=u.substr(7).split("|");return{keyMethod:"inline",keySalt:d[0],lifeTime:d[1],mkiValue:d[2]?d[2].split(":")[0]:void 0,mkiLength:d[2]?d[2].split(":")[1]:void 0}},c.writeCryptoKeyParams=function(u){return u.keyMethod+":"+u.keySalt+(u.lifeTime?"|"+u.lifeTime:"")+(u.mkiValue&&u.mkiLength?"|"+u.mkiValue+":"+u.mkiLength:"")},c.getCryptoParameters=function(u,d){return c.matchPrefix(u+d,"a=crypto:").map(c.parseCryptoLine)},c.getIceParameters=function(u,d){var p=c.matchPrefix(u+d,"a=ice-ufrag:")[0],v=c.matchPrefix(u+d,"a=ice-pwd:")[0];return p&&v?{usernameFragment:p.substr(12),password:v.substr(10)}:null},c.writeIceParameters=function(u){return"a=ice-ufrag:"+u.usernameFragment+`\r
a=ice-pwd:`+u.password+`\r
`},c.parseRtpParameters=function(u){for(var d={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},p=c.splitLines(u)[0].split(" "),v=3;v<p.length;v++){var f=p[v],y=c.matchPrefix(u,"a=rtpmap:"+f+" ")[0];if(y){var I=c.parseRtpMap(y),T=c.matchPrefix(u,"a=fmtp:"+f+" ");switch(I.parameters=T.length?c.parseFmtp(T[0]):{},I.rtcpFeedback=c.matchPrefix(u,"a=rtcp-fb:"+f+" ").map(c.parseRtcpFb),d.codecs.push(I),I.name.toUpperCase()){case"RED":case"ULPFEC":d.fecMechanisms.push(I.name.toUpperCase())}}}return c.matchPrefix(u,"a=extmap:").forEach(function(b){d.headerExtensions.push(c.parseExtmap(b))}),d},c.writeRtpDescription=function(u,d){var p="";p+="m="+u+" ",p+=d.codecs.length>0?"9":"0",p+=" UDP/TLS/RTP/SAVPF ",p+=d.codecs.map(function(f){return f.preferredPayloadType!==void 0?f.preferredPayloadType:f.payloadType}).join(" ")+`\r
`,p+=`c=IN IP4 0.0.0.0\r
`,p+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,d.codecs.forEach(function(f){p+=c.writeRtpMap(f),p+=c.writeFmtp(f),p+=c.writeRtcpFb(f)});var v=0;return d.codecs.forEach(function(f){f.maxptime>v&&(v=f.maxptime)}),v>0&&(p+="a=maxptime:"+v+`\r
`),p+=`a=rtcp-mux\r
`,d.headerExtensions&&d.headerExtensions.forEach(function(f){p+=c.writeExtmap(f)}),p},c.parseRtpEncodingParameters=function(u){var d,p=[],v=c.parseRtpParameters(u),f=v.fecMechanisms.indexOf("RED")!==-1,y=v.fecMechanisms.indexOf("ULPFEC")!==-1,I=c.matchPrefix(u,"a=ssrc:").map(function(N){return c.parseSsrcMedia(N)}).filter(function(N){return N.attribute==="cname"}),T=I.length>0&&I[0].ssrc,b=c.matchPrefix(u,"a=ssrc-group:FID").map(function(N){return N.substr(17).split(" ").map(function(O){return parseInt(O,10)})});b.length>0&&b[0].length>1&&b[0][0]===T&&(d=b[0][1]),v.codecs.forEach(function(N){if(N.name.toUpperCase()==="RTX"&&N.parameters.apt){var O={ssrc:T,codecPayloadType:parseInt(N.parameters.apt,10)};T&&d&&(O.rtx={ssrc:d}),p.push(O),f&&((O=JSON.parse(JSON.stringify(O))).fec={ssrc:T,mechanism:y?"red+ulpfec":"red"},p.push(O))}}),p.length===0&&T&&p.push({ssrc:T});var k=c.matchPrefix(u,"b=");return k.length&&(k=k[0].indexOf("b=TIAS:")===0?parseInt(k[0].substr(7),10):k[0].indexOf("b=AS:")===0?1e3*parseInt(k[0].substr(5),10)*.95-16e3:void 0,p.forEach(function(N){N.maxBitrate=k})),p},c.parseRtcpParameters=function(u){var d={},p=c.matchPrefix(u,"a=ssrc:").map(function(y){return c.parseSsrcMedia(y)}).filter(function(y){return y.attribute==="cname"})[0];p&&(d.cname=p.value,d.ssrc=p.ssrc);var v=c.matchPrefix(u,"a=rtcp-rsize");d.reducedSize=v.length>0,d.compound=v.length===0;var f=c.matchPrefix(u,"a=rtcp-mux");return d.mux=f.length>0,d},c.parseMsid=function(u){var d,p=c.matchPrefix(u,"a=msid:");if(p.length===1)return{stream:(d=p[0].substr(7).split(" "))[0],track:d[1]};var v=c.matchPrefix(u,"a=ssrc:").map(function(f){return c.parseSsrcMedia(f)}).filter(function(f){return f.attribute==="msid"});return v.length>0?{stream:(d=v[0].value.split(" "))[0],track:d[1]}:void 0},c.parseSctpDescription=function(u){var d,p=c.parseMLine(u),v=c.matchPrefix(u,"a=max-message-size:");v.length>0&&(d=parseInt(v[0].substr(19),10)),isNaN(d)&&(d=65536);var f=c.matchPrefix(u,"a=sctp-port:");if(f.length>0)return{port:parseInt(f[0].substr(12),10),protocol:p.fmt,maxMessageSize:d};if(c.matchPrefix(u,"a=sctpmap:").length>0){var y=c.matchPrefix(u,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(y[0],10),protocol:y[1],maxMessageSize:d}}},c.writeSctpDescription=function(u,d){var p=[];return p=u.protocol!=="DTLS/SCTP"?["m="+u.kind+" 9 "+u.protocol+" "+d.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+d.port+`\r
`]:["m="+u.kind+" 9 "+u.protocol+" "+d.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+d.port+" "+d.protocol+` 65535\r
`],d.maxMessageSize!==void 0&&p.push("a=max-message-size:"+d.maxMessageSize+`\r
`),p.join("")},c.generateSessionId=function(){return Math.random().toString().substr(2,21)},c.writeSessionBoilerplate=function(u,d,p){var v=d!==void 0?d:2;return`v=0\r
o=`+(p||"thisisadapterortc")+" "+(u||c.generateSessionId())+" "+v+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},c.writeMediaSection=function(u,d,p,v){var f=c.writeRtpDescription(u.kind,d);if(f+=c.writeIceParameters(u.iceGatherer.getLocalParameters()),f+=c.writeDtlsParameters(u.dtlsTransport.getLocalParameters(),p==="offer"?"actpass":"active"),f+="a=mid:"+u.mid+`\r
`,u.direction?f+="a="+u.direction+`\r
`:u.rtpSender&&u.rtpReceiver?f+=`a=sendrecv\r
`:u.rtpSender?f+=`a=sendonly\r
`:u.rtpReceiver?f+=`a=recvonly\r
`:f+=`a=inactive\r
`,u.rtpSender){var y="msid:"+v.id+" "+u.rtpSender.track.id+`\r
`;f+="a="+y,f+="a=ssrc:"+u.sendEncodingParameters[0].ssrc+" "+y,u.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+u.sendEncodingParameters[0].rtx.ssrc+" "+y,f+="a=ssrc-group:FID "+u.sendEncodingParameters[0].ssrc+" "+u.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return f+="a=ssrc:"+u.sendEncodingParameters[0].ssrc+" cname:"+c.localCName+`\r
`,u.rtpSender&&u.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+u.sendEncodingParameters[0].rtx.ssrc+" cname:"+c.localCName+`\r
`),f},c.getDirection=function(u,d){for(var p=c.splitLines(u),v=0;v<p.length;v++)switch(p[v]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return p[v].substr(2)}return d?c.getDirection(d):"sendrecv"},c.getKind=function(u){return c.splitLines(u)[0].split(" ")[0].substr(2)},c.isRejected=function(u){return u.split(" ",2)[1]==="0"},c.parseMLine=function(u){var d=c.splitLines(u)[0].substr(2).split(" ");return{kind:d[0],port:parseInt(d[1],10),protocol:d[2],fmt:d.slice(3).join(" ")}},c.parseOLine=function(u){var d=c.matchPrefix(u,"o=")[0].substr(2).split(" ");return{username:d[0],sessionId:d[1],sessionVersion:parseInt(d[2],10),netType:d[3],addressType:d[4],address:d[5]}},c.isValidSDP=function(u){if(typeof u!="string"||u.length===0)return!1;for(var d=c.splitLines(u),p=0;p<d.length;p++)if(d[p].length<2||d[p].charAt(1)!=="=")return!1;return!0},r.exports=c});function kg(r,c,u,d,p){var v=gn.writeRtpDescription(r.kind,c);if(v+=gn.writeIceParameters(r.iceGatherer.getLocalParameters()),v+=gn.writeDtlsParameters(r.dtlsTransport.getLocalParameters(),u==="offer"?"actpass":p||"active"),v+="a=mid:"+r.mid+`\r
`,r.rtpSender&&r.rtpReceiver?v+=`a=sendrecv\r
`:r.rtpSender?v+=`a=sendonly\r
`:r.rtpReceiver?v+=`a=recvonly\r
`:v+=`a=inactive\r
`,r.rtpSender){var f=r.rtpSender._initialTrackId||r.rtpSender.track.id;r.rtpSender._initialTrackId=f;var y="msid:"+(d?d.id:"-")+" "+f+`\r
`;v+="a="+y,v+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" "+y,r.sendEncodingParameters[0].rtx&&(v+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" "+y,v+="a=ssrc-group:FID "+r.sendEncodingParameters[0].ssrc+" "+r.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return v+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" cname:"+gn.localCName+`\r
`,r.rtpSender&&r.sendEncodingParameters[0].rtx&&(v+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" cname:"+gn.localCName+`\r
`),v}function Al(r,c){var u={codecs:[],headerExtensions:[],fecMechanisms:[]},d=function(v,f){v=parseInt(v,10);for(var y=0;y<f.length;y++)if(f[y].payloadType===v||f[y].preferredPayloadType===v)return f[y]},p=function(v,f,y,I){var T=d(v.parameters.apt,y),b=d(f.parameters.apt,I);return T&&b&&T.name.toLowerCase()===b.name.toLowerCase()};return r.codecs.forEach(function(v){for(var f=0;f<c.codecs.length;f++){var y=c.codecs[f];if(v.name.toLowerCase()===y.name.toLowerCase()&&v.clockRate===y.clockRate){if(v.name.toLowerCase()==="rtx"&&v.parameters&&y.parameters.apt&&!p(v,y,r.codecs,c.codecs))continue;(y=JSON.parse(JSON.stringify(y))).numChannels=Math.min(v.numChannels,y.numChannels),u.codecs.push(y),y.rtcpFeedback=y.rtcpFeedback.filter(function(I){for(var T=0;T<v.rtcpFeedback.length;T++)if(v.rtcpFeedback[T].type===I.type&&v.rtcpFeedback[T].parameter===I.parameter)return!0;return!1});break}}}),r.headerExtensions.forEach(function(v){for(var f=0;f<c.headerExtensions.length;f++){var y=c.headerExtensions[f];if(v.uri===y.uri){u.headerExtensions.push(y);break}}}),u}function s_(r,c,u){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[c][r].indexOf(u)!==-1}function mc(r,c){var u=r.getRemoteCandidates().find(function(d){return c.foundation===d.foundation&&c.ip===d.ip&&c.port===d.port&&c.priority===d.priority&&c.protocol===d.protocol&&c.type===d.type});return u||r.addRemoteCandidate(c),!u}function Gi(r,c){var u=new Error(c);return u.name=r,u.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[r],u}var mu=function(r,c){function u(f,y){y.addTrack(f),y.dispatchEvent(new r.MediaStreamTrackEvent("addtrack",{track:f}))}function d(f,y,I,T){var b=new Event("track");b.track=y,b.receiver=I,b.transceiver={receiver:I},b.streams=T,r.setTimeout(function(){f._dispatchEvent("track",b)})}var p=function(f){var y=this,I=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(b){y[b]=I[b].bind(I)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",f=JSON.parse(JSON.stringify(f||{})),this.usingBundle=f.bundlePolicy==="max-bundle",f.rtcpMuxPolicy==="negotiate")throw Gi("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(f.rtcpMuxPolicy||(f.rtcpMuxPolicy="require"),f.iceTransportPolicy){case"all":case"relay":break;default:f.iceTransportPolicy="all"}switch(f.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:f.bundlePolicy="balanced"}if(f.iceServers=function(b,k){var N=!1;return(b=JSON.parse(JSON.stringify(b))).filter(function(O){if(O&&(O.urls||O.url)){var F=O.urls||O.url;O.url&&!O.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var G=typeof F=="string";return G&&(F=[F]),F=F.filter(function(P){return P.indexOf("turn:")===0&&P.indexOf("transport=udp")!==-1&&P.indexOf("turn:[")===-1&&!N?(N=!0,!0):P.indexOf("stun:")===0&&k>=14393&&P.indexOf("?transport=udp")===-1}),delete O.url,O.urls=G?F[0]:F,!!F.length}})}(f.iceServers||[],c),this._iceGatherers=[],f.iceCandidatePoolSize)for(var T=f.iceCandidatePoolSize;T>0;T--)this._iceGatherers.push(new r.RTCIceGatherer({iceServers:f.iceServers,gatherPolicy:f.iceTransportPolicy}));else f.iceCandidatePoolSize=0;this._config=f,this.transceivers=[],this._sdpSessionId=gn.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(p.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(p.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),p.prototype.onicecandidate=null,p.prototype.onaddstream=null,p.prototype.ontrack=null,p.prototype.onremovestream=null,p.prototype.onsignalingstatechange=null,p.prototype.oniceconnectionstatechange=null,p.prototype.onconnectionstatechange=null,p.prototype.onicegatheringstatechange=null,p.prototype.onnegotiationneeded=null,p.prototype.ondatachannel=null,p.prototype._dispatchEvent=function(f,y){this._isClosed||(this.dispatchEvent(y),typeof this["on"+f]=="function"&&this["on"+f](y))},p.prototype._emitGatheringStateChange=function(){var f=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",f)},p.prototype.getConfiguration=function(){return this._config},p.prototype.getLocalStreams=function(){return this.localStreams},p.prototype.getRemoteStreams=function(){return this.remoteStreams},p.prototype._createTransceiver=function(f,y){var I=this.transceivers.length>0,T={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:f,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&I)T.iceTransport=this.transceivers[0].iceTransport,T.dtlsTransport=this.transceivers[0].dtlsTransport;else{var b=this._createIceAndDtlsTransports();T.iceTransport=b.iceTransport,T.dtlsTransport=b.dtlsTransport}return y||this.transceivers.push(T),T},p.prototype.addTrack=function(f,y){if(this._isClosed)throw Gi("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var I;if(this.transceivers.find(function(b){return b.track===f}))throw Gi("InvalidAccessError","Track already exists.");for(var T=0;T<this.transceivers.length;T++)this.transceivers[T].track||this.transceivers[T].kind!==f.kind||(I=this.transceivers[T]);return I||(I=this._createTransceiver(f.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(y)===-1&&this.localStreams.push(y),I.track=f,I.stream=y,I.rtpSender=new r.RTCRtpSender(f,I.dtlsTransport),I.rtpSender},p.prototype.addStream=function(f){var y=this;if(c>=15025)f.getTracks().forEach(function(T){y.addTrack(T,f)});else{var I=f.clone();f.getTracks().forEach(function(T,b){var k=I.getTracks()[b];T.addEventListener("enabled",function(N){k.enabled=N.enabled})}),I.getTracks().forEach(function(T){y.addTrack(T,I)})}},p.prototype.removeTrack=function(f){if(this._isClosed)throw Gi("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(f instanceof r.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var y=this.transceivers.find(function(T){return T.rtpSender===f});if(!y)throw Gi("InvalidAccessError","Sender was not created by this connection.");var I=y.stream;y.rtpSender.stop(),y.rtpSender=null,y.track=null,y.stream=null,this.transceivers.map(function(T){return T.stream}).indexOf(I)===-1&&this.localStreams.indexOf(I)>-1&&this.localStreams.splice(this.localStreams.indexOf(I),1),this._maybeFireNegotiationNeeded()},p.prototype.removeStream=function(f){var y=this;f.getTracks().forEach(function(I){var T=y.getSenders().find(function(b){return b.track===I});T&&y.removeTrack(T)})},p.prototype.getSenders=function(){return this.transceivers.filter(function(f){return!!f.rtpSender}).map(function(f){return f.rtpSender})},p.prototype.getReceivers=function(){return this.transceivers.filter(function(f){return!!f.rtpReceiver}).map(function(f){return f.rtpReceiver})},p.prototype._createIceGatherer=function(f,y){var I=this;if(y&&f>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var T=new r.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(T,"state",{value:"new",writable:!0}),this.transceivers[f].bufferedCandidateEvents=[],this.transceivers[f].bufferCandidates=function(b){var k=!b.candidate||Object.keys(b.candidate).length===0;T.state=k?"completed":"gathering",I.transceivers[f].bufferedCandidateEvents!==null&&I.transceivers[f].bufferedCandidateEvents.push(b)},T.addEventListener("localcandidate",this.transceivers[f].bufferCandidates),T},p.prototype._gather=function(f,y){var I=this,T=this.transceivers[y].iceGatherer;if(!T.onlocalcandidate){var b=this.transceivers[y].bufferedCandidateEvents;this.transceivers[y].bufferedCandidateEvents=null,T.removeEventListener("localcandidate",this.transceivers[y].bufferCandidates),T.onlocalcandidate=function(k){if(!(I.usingBundle&&y>0)){var N=new Event("icecandidate");N.candidate={sdpMid:f,sdpMLineIndex:y};var O=k.candidate,F=!O||Object.keys(O).length===0;if(F)T.state!=="new"&&T.state!=="gathering"||(T.state="completed");else{T.state==="new"&&(T.state="gathering"),O.component=1,O.ufrag=T.getLocalParameters().usernameFragment;var G=gn.writeCandidate(O);N.candidate=Object.assign(N.candidate,gn.parseCandidate(G)),N.candidate.candidate=G,N.candidate.toJSON=function(){return{candidate:N.candidate.candidate,sdpMid:N.candidate.sdpMid,sdpMLineIndex:N.candidate.sdpMLineIndex,usernameFragment:N.candidate.usernameFragment}}}var P=gn.getMediaSections(I._localDescription.sdp);P[N.candidate.sdpMLineIndex]+=F?`a=end-of-candidates\r
`:"a="+N.candidate.candidate+`\r
`,I._localDescription.sdp=gn.getDescription(I._localDescription.sdp)+P.join("");var K=I.transceivers.every(function(X){return X.iceGatherer&&X.iceGatherer.state==="completed"});I.iceGatheringState!=="gathering"&&(I.iceGatheringState="gathering",I._emitGatheringStateChange()),F||I._dispatchEvent("icecandidate",N),K&&(I._dispatchEvent("icecandidate",new Event("icecandidate")),I.iceGatheringState="complete",I._emitGatheringStateChange())}},r.setTimeout(function(){b.forEach(function(k){T.onlocalcandidate(k)})},0)}},p.prototype._createIceAndDtlsTransports=function(){var f=this,y=new r.RTCIceTransport(null);y.onicestatechange=function(){f._updateIceConnectionState(),f._updateConnectionState()};var I=new r.RTCDtlsTransport(y);return I.ondtlsstatechange=function(){f._updateConnectionState()},I.onerror=function(){Object.defineProperty(I,"state",{value:"failed",writable:!0}),f._updateConnectionState()},{iceTransport:y,dtlsTransport:I}},p.prototype._disposeIceAndDtlsTransports=function(f){var y=this.transceivers[f].iceGatherer;y&&(delete y.onlocalcandidate,delete this.transceivers[f].iceGatherer);var I=this.transceivers[f].iceTransport;I&&(delete I.onicestatechange,delete this.transceivers[f].iceTransport);var T=this.transceivers[f].dtlsTransport;T&&(delete T.ondtlsstatechange,delete T.onerror,delete this.transceivers[f].dtlsTransport)},p.prototype._transceive=function(f,y,I){var T=Al(f.localCapabilities,f.remoteCapabilities);y&&f.rtpSender&&(T.encodings=f.sendEncodingParameters,T.rtcp={cname:gn.localCName,compound:f.rtcpParameters.compound},f.recvEncodingParameters.length&&(T.rtcp.ssrc=f.recvEncodingParameters[0].ssrc),f.rtpSender.send(T)),I&&f.rtpReceiver&&T.codecs.length>0&&(f.kind==="video"&&f.recvEncodingParameters&&c<15019&&f.recvEncodingParameters.forEach(function(b){delete b.rtx}),f.recvEncodingParameters.length?T.encodings=f.recvEncodingParameters:T.encodings=[{}],T.rtcp={compound:f.rtcpParameters.compound},f.rtcpParameters.cname&&(T.rtcp.cname=f.rtcpParameters.cname),f.sendEncodingParameters.length&&(T.rtcp.ssrc=f.sendEncodingParameters[0].ssrc),f.rtpReceiver.receive(T))},p.prototype.setLocalDescription=function(f){var y,I,T=this;if(["offer","answer"].indexOf(f.type)===-1)return Promise.reject(Gi("TypeError",'Unsupported type "'+f.type+'"'));if(!s_("setLocalDescription",f.type,T.signalingState)||T._isClosed)return Promise.reject(Gi("InvalidStateError","Can not set local "+f.type+" in state "+T.signalingState));if(f.type==="offer")y=gn.splitSections(f.sdp),I=y.shift(),y.forEach(function(k,N){var O=gn.parseRtpParameters(k);T.transceivers[N].localCapabilities=O}),T.transceivers.forEach(function(k,N){T._gather(k.mid,N)});else if(f.type==="answer"){y=gn.splitSections(T._remoteDescription.sdp),I=y.shift();var b=gn.matchPrefix(I,"a=ice-lite").length>0;y.forEach(function(k,N){var O=T.transceivers[N],F=O.iceGatherer,G=O.iceTransport,P=O.dtlsTransport,K=O.localCapabilities,X=O.remoteCapabilities;if(!(gn.isRejected(k)&&gn.matchPrefix(k,"a=bundle-only").length===0)&&!O.rejected){var oe=gn.getIceParameters(k,I),Ce=gn.getDtlsParameters(k,I);b&&(Ce.role="server"),T.usingBundle&&N!==0||(T._gather(O.mid,N),G.state==="new"&&G.start(F,oe,b?"controlling":"controlled"),P.state==="new"&&P.start(Ce));var Ve=Al(K,X);T._transceive(O,Ve.codecs.length>0,!1)}})}return T._localDescription={type:f.type,sdp:f.sdp},f.type==="offer"?T._updateSignalingState("have-local-offer"):T._updateSignalingState("stable"),Promise.resolve()},p.prototype.setRemoteDescription=function(f){var y=this;if(["offer","answer"].indexOf(f.type)===-1)return Promise.reject(Gi("TypeError",'Unsupported type "'+f.type+'"'));if(!s_("setRemoteDescription",f.type,y.signalingState)||y._isClosed)return Promise.reject(Gi("InvalidStateError","Can not set remote "+f.type+" in state "+y.signalingState));var I={};y.remoteStreams.forEach(function(G){I[G.id]=G});var T=[],b=gn.splitSections(f.sdp),k=b.shift(),N=gn.matchPrefix(k,"a=ice-lite").length>0,O=gn.matchPrefix(k,"a=group:BUNDLE ").length>0;y.usingBundle=O;var F=gn.matchPrefix(k,"a=ice-options:")[0];return y.canTrickleIceCandidates=!!F&&F.substr(14).split(" ").indexOf("trickle")>=0,b.forEach(function(G,P){var K=gn.splitLines(G),X=gn.getKind(G),oe=gn.isRejected(G)&&gn.matchPrefix(G,"a=bundle-only").length===0,Ce=K[0].substr(2).split(" ")[2],Ve=gn.getDirection(G,k),je=gn.parseMsid(G),Re=gn.getMid(G)||gn.generateIdentifier();if(oe||X==="application"&&(Ce==="DTLS/SCTP"||Ce==="UDP/DTLS/SCTP"))y.transceivers[P]={mid:Re,kind:X,protocol:Ce,rejected:!0};else{var Oe,qe,$e,Tn,Q,j,le,fe,Ie;!oe&&y.transceivers[P]&&y.transceivers[P].rejected&&(y.transceivers[P]=y._createTransceiver(X,!0));var Ne,lt,Dt=gn.parseRtpParameters(G);oe||(Ne=gn.getIceParameters(G,k),(lt=gn.getDtlsParameters(G,k)).role="client"),le=gn.parseRtpEncodingParameters(G);var Ut=gn.parseRtcpParameters(G),St=gn.matchPrefix(G,"a=end-of-candidates",k).length>0,_n=gn.matchPrefix(G,"a=candidate:").map(function(Un){return gn.parseCandidate(Un)}).filter(function(Un){return Un.component===1});if((f.type==="offer"||f.type==="answer")&&!oe&&O&&P>0&&y.transceivers[P]&&(y._disposeIceAndDtlsTransports(P),y.transceivers[P].iceGatherer=y.transceivers[0].iceGatherer,y.transceivers[P].iceTransport=y.transceivers[0].iceTransport,y.transceivers[P].dtlsTransport=y.transceivers[0].dtlsTransport,y.transceivers[P].rtpSender&&y.transceivers[P].rtpSender.setTransport(y.transceivers[0].dtlsTransport),y.transceivers[P].rtpReceiver&&y.transceivers[P].rtpReceiver.setTransport(y.transceivers[0].dtlsTransport)),f.type!=="offer"||oe)f.type==="answer"&&!oe&&(qe=(Oe=y.transceivers[P]).iceGatherer,$e=Oe.iceTransport,Tn=Oe.dtlsTransport,Q=Oe.rtpReceiver,j=Oe.sendEncodingParameters,fe=Oe.localCapabilities,y.transceivers[P].recvEncodingParameters=le,y.transceivers[P].remoteCapabilities=Dt,y.transceivers[P].rtcpParameters=Ut,_n.length&&$e.state==="new"&&(!N&&!St||O&&P!==0?_n.forEach(function(Un){mc(Oe.iceTransport,Un)}):$e.setRemoteCandidates(_n)),O&&P!==0||($e.state==="new"&&$e.start(qe,Ne,"controlling"),Tn.state==="new"&&Tn.start(lt)),!Al(Oe.localCapabilities,Oe.remoteCapabilities).codecs.filter(function(Un){return Un.name.toLowerCase()==="rtx"}).length&&Oe.sendEncodingParameters[0].rtx&&delete Oe.sendEncodingParameters[0].rtx,y._transceive(Oe,Ve==="sendrecv"||Ve==="recvonly",Ve==="sendrecv"||Ve==="sendonly"),!Q||Ve!=="sendrecv"&&Ve!=="sendonly"?delete Oe.rtpReceiver:(Ie=Q.track,je?(I[je.stream]||(I[je.stream]=new r.MediaStream),u(Ie,I[je.stream]),T.push([Ie,Q,I[je.stream]])):(I.default||(I.default=new r.MediaStream),u(Ie,I.default),T.push([Ie,Q,I.default]))));else{(Oe=y.transceivers[P]||y._createTransceiver(X)).mid=Re,Oe.iceGatherer||(Oe.iceGatherer=y._createIceGatherer(P,O)),_n.length&&Oe.iceTransport.state==="new"&&(!St||O&&P!==0?_n.forEach(function(Un){mc(Oe.iceTransport,Un)}):Oe.iceTransport.setRemoteCandidates(_n)),fe=r.RTCRtpReceiver.getCapabilities(X),c<15019&&(fe.codecs=fe.codecs.filter(function(Un){return Un.name!=="rtx"})),j=Oe.sendEncodingParameters||[{ssrc:1001*(2*P+2)}];var Gt,zn=!1;Ve==="sendrecv"||Ve==="sendonly"?(zn=!Oe.rtpReceiver,Q=Oe.rtpReceiver||new r.RTCRtpReceiver(Oe.dtlsTransport,X),zn&&(Ie=Q.track,je&&je.stream==="-"||(je?(I[je.stream]||(I[je.stream]=new r.MediaStream,Object.defineProperty(I[je.stream],"id",{get:function(){return je.stream}})),Object.defineProperty(Ie,"id",{get:function(){return je.track}}),Gt=I[je.stream]):(I.default||(I.default=new r.MediaStream),Gt=I.default)),Gt&&(u(Ie,Gt),Oe.associatedRemoteMediaStreams.push(Gt)),T.push([Ie,Q,Gt]))):Oe.rtpReceiver&&Oe.rtpReceiver.track&&(Oe.associatedRemoteMediaStreams.forEach(function(Un){var on=Un.getTracks().find(function(vr){return vr.id===Oe.rtpReceiver.track.id});on&&function(vr,qi){qi.removeTrack(vr),qi.dispatchEvent(new r.MediaStreamTrackEvent("removetrack",{track:vr}))}(on,Un)}),Oe.associatedRemoteMediaStreams=[]),Oe.localCapabilities=fe,Oe.remoteCapabilities=Dt,Oe.rtpReceiver=Q,Oe.rtcpParameters=Ut,Oe.sendEncodingParameters=j,Oe.recvEncodingParameters=le,y._transceive(y.transceivers[P],!1,zn)}}}),y._dtlsRole===void 0&&(y._dtlsRole=f.type==="offer"?"active":"passive"),y._remoteDescription={type:f.type,sdp:f.sdp},f.type==="offer"?y._updateSignalingState("have-remote-offer"):y._updateSignalingState("stable"),Object.keys(I).forEach(function(G){var P=I[G];if(P.getTracks().length){if(y.remoteStreams.indexOf(P)===-1){y.remoteStreams.push(P);var K=new Event("addstream");K.stream=P,r.setTimeout(function(){y._dispatchEvent("addstream",K)})}T.forEach(function(X){var oe=X[0],Ce=X[1];P.id===X[2].id&&d(y,oe,Ce,[P])})}}),T.forEach(function(G){G[2]||d(y,G[0],G[1],[])}),r.setTimeout(function(){y&&y.transceivers&&y.transceivers.forEach(function(G){G.iceTransport&&G.iceTransport.state==="new"&&G.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),G.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},p.prototype.close=function(){this.transceivers.forEach(function(f){f.iceTransport&&f.iceTransport.stop(),f.dtlsTransport&&f.dtlsTransport.stop(),f.rtpSender&&f.rtpSender.stop(),f.rtpReceiver&&f.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},p.prototype._updateSignalingState=function(f){this.signalingState=f;var y=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",y)},p.prototype._maybeFireNegotiationNeeded=function(){var f=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,r.setTimeout(function(){if(f.needNegotiation){f.needNegotiation=!1;var y=new Event("negotiationneeded");f._dispatchEvent("negotiationneeded",y)}},0))},p.prototype._updateIceConnectionState=function(){var f,y={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(T){T.iceTransport&&!T.rejected&&y[T.iceTransport.state]++}),f="new",y.failed>0?f="failed":y.checking>0?f="checking":y.disconnected>0?f="disconnected":y.new>0?f="new":y.connected>0?f="connected":y.completed>0&&(f="completed"),f!==this.iceConnectionState){this.iceConnectionState=f;var I=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",I)}},p.prototype._updateConnectionState=function(){var f,y={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(T){T.iceTransport&&T.dtlsTransport&&!T.rejected&&(y[T.iceTransport.state]++,y[T.dtlsTransport.state]++)}),y.connected+=y.completed,f="new",y.failed>0?f="failed":y.connecting>0?f="connecting":y.disconnected>0?f="disconnected":y.new>0?f="new":y.connected>0&&(f="connected"),f!==this.connectionState){this.connectionState=f;var I=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",I)}},p.prototype.createOffer=function(){var f=this;if(f._isClosed)return Promise.reject(Gi("InvalidStateError","Can not call createOffer after close"));var y=f.transceivers.filter(function(N){return N.kind==="audio"}).length,I=f.transceivers.filter(function(N){return N.kind==="video"}).length,T=arguments[0];if(T){if(T.mandatory||T.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");T.offerToReceiveAudio!==void 0&&(y=T.offerToReceiveAudio===!0?1:T.offerToReceiveAudio===!1?0:T.offerToReceiveAudio),T.offerToReceiveVideo!==void 0&&(I=T.offerToReceiveVideo===!0?1:T.offerToReceiveVideo===!1?0:T.offerToReceiveVideo)}for(f.transceivers.forEach(function(N){N.kind==="audio"?--y<0&&(N.wantReceive=!1):N.kind==="video"&&--I<0&&(N.wantReceive=!1)});y>0||I>0;)y>0&&(f._createTransceiver("audio"),y--),I>0&&(f._createTransceiver("video"),I--);var b=gn.writeSessionBoilerplate(f._sdpSessionId,f._sdpSessionVersion++);f.transceivers.forEach(function(N,O){var F=N.track,G=N.kind,P=N.mid||gn.generateIdentifier();N.mid=P,N.iceGatherer||(N.iceGatherer=f._createIceGatherer(O,f.usingBundle));var K=r.RTCRtpSender.getCapabilities(G);c<15019&&(K.codecs=K.codecs.filter(function(oe){return oe.name!=="rtx"})),K.codecs.forEach(function(oe){oe.name==="H264"&&oe.parameters["level-asymmetry-allowed"]===void 0&&(oe.parameters["level-asymmetry-allowed"]="1"),N.remoteCapabilities&&N.remoteCapabilities.codecs&&N.remoteCapabilities.codecs.forEach(function(Ce){oe.name.toLowerCase()===Ce.name.toLowerCase()&&oe.clockRate===Ce.clockRate&&(oe.preferredPayloadType=Ce.payloadType)})}),K.headerExtensions.forEach(function(oe){(N.remoteCapabilities&&N.remoteCapabilities.headerExtensions||[]).forEach(function(Ce){oe.uri===Ce.uri&&(oe.id=Ce.id)})});var X=N.sendEncodingParameters||[{ssrc:1001*(2*O+1)}];F&&c>=15019&&G==="video"&&!X[0].rtx&&(X[0].rtx={ssrc:X[0].ssrc+1}),N.wantReceive&&(N.rtpReceiver=new r.RTCRtpReceiver(N.dtlsTransport,G)),N.localCapabilities=K,N.sendEncodingParameters=X}),f._config.bundlePolicy!=="max-compat"&&(b+="a=group:BUNDLE "+f.transceivers.map(function(N){return N.mid}).join(" ")+`\r
`),b+=`a=ice-options:trickle\r
`,f.transceivers.forEach(function(N,O){b+=kg(N,N.localCapabilities,"offer",N.stream,f._dtlsRole),b+=`a=rtcp-rsize\r
`,!N.iceGatherer||f.iceGatheringState==="new"||O!==0&&f.usingBundle||(N.iceGatherer.getLocalCandidates().forEach(function(F){F.component=1,b+="a="+gn.writeCandidate(F)+`\r
`}),N.iceGatherer.state==="completed"&&(b+=`a=end-of-candidates\r
`))});var k=new r.RTCSessionDescription({type:"offer",sdp:b});return Promise.resolve(k)},p.prototype.createAnswer=function(){var f=this;if(f._isClosed)return Promise.reject(Gi("InvalidStateError","Can not call createAnswer after close"));if(f.signalingState!=="have-remote-offer"&&f.signalingState!=="have-local-pranswer")return Promise.reject(Gi("InvalidStateError","Can not call createAnswer in signalingState "+f.signalingState));var y=gn.writeSessionBoilerplate(f._sdpSessionId,f._sdpSessionVersion++);f.usingBundle&&(y+="a=group:BUNDLE "+f.transceivers.map(function(b){return b.mid}).join(" ")+`\r
`),y+=`a=ice-options:trickle\r
`;var I=gn.getMediaSections(f._remoteDescription.sdp).length;f.transceivers.forEach(function(b,k){if(!(k+1>I)){if(b.rejected)return b.kind==="application"?b.protocol==="DTLS/SCTP"?y+=`m=application 0 DTLS/SCTP 5000\r
`:y+="m=application 0 "+b.protocol+` webrtc-datachannel\r
`:b.kind==="audio"?y+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:b.kind==="video"&&(y+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(y+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+b.mid+`\r
`);var N;b.stream&&(b.kind==="audio"?N=b.stream.getAudioTracks()[0]:b.kind==="video"&&(N=b.stream.getVideoTracks()[0]),N&&c>=15019&&b.kind==="video"&&!b.sendEncodingParameters[0].rtx&&(b.sendEncodingParameters[0].rtx={ssrc:b.sendEncodingParameters[0].ssrc+1}));var O=Al(b.localCapabilities,b.remoteCapabilities);!O.codecs.filter(function(F){return F.name.toLowerCase()==="rtx"}).length&&b.sendEncodingParameters[0].rtx&&delete b.sendEncodingParameters[0].rtx,y+=kg(b,O,"answer",b.stream,f._dtlsRole),b.rtcpParameters&&b.rtcpParameters.reducedSize&&(y+=`a=rtcp-rsize\r
`)}});var T=new r.RTCSessionDescription({type:"answer",sdp:y});return Promise.resolve(T)},p.prototype.addIceCandidate=function(f){var y,I=this;return f&&f.sdpMLineIndex===void 0&&!f.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(T,b){if(!I._remoteDescription)return b(Gi("InvalidStateError","Can not add ICE candidate without a remote description"));if(f&&f.candidate!==""){var k=f.sdpMLineIndex;if(f.sdpMid){for(var N=0;N<I.transceivers.length;N++)if(I.transceivers[N].mid===f.sdpMid){k=N;break}}var O=I.transceivers[k];if(!O)return b(Gi("OperationError","Can not add ICE candidate"));if(O.rejected)return T();var F=Object.keys(f.candidate).length>0?gn.parseCandidate(f.candidate):{};if(F.protocol==="tcp"&&(F.port===0||F.port===9)||F.component&&F.component!==1)return T();if((k===0||k>0&&O.iceTransport!==I.transceivers[0].iceTransport)&&!mc(O.iceTransport,F))return b(Gi("OperationError","Can not add ICE candidate"));var G=f.candidate.trim();G.indexOf("a=")===0&&(G=G.substr(2)),(y=gn.getMediaSections(I._remoteDescription.sdp))[k]+="a="+(F.type?G:"end-of-candidates")+`\r
`,I._remoteDescription.sdp=gn.getDescription(I._remoteDescription.sdp)+y.join("")}else for(var P=0;P<I.transceivers.length&&(I.transceivers[P].rejected||(I.transceivers[P].iceTransport.addRemoteCandidate({}),(y=gn.getMediaSections(I._remoteDescription.sdp))[P]+=`a=end-of-candidates\r
`,I._remoteDescription.sdp=gn.getDescription(I._remoteDescription.sdp)+y.join(""),!I.usingBundle));P++);T()})},p.prototype.getStats=function(f){if(f&&f instanceof r.MediaStreamTrack){var y=null;if(this.transceivers.forEach(function(T){T.rtpSender&&T.rtpSender.track===f?y=T.rtpSender:T.rtpReceiver&&T.rtpReceiver.track===f&&(y=T.rtpReceiver)}),!y)throw Gi("InvalidAccessError","Invalid selector.");return y.getStats()}var I=[];return this.transceivers.forEach(function(T){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(b){T[b]&&I.push(T[b].getStats())})}),Promise.all(I).then(function(T){var b=new Map;return T.forEach(function(k){k.forEach(function(N){b.set(N.id,N)})}),b})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(f){var y=r[f];if(y&&y.prototype&&y.prototype.getStats){var I=y.prototype.getStats;y.prototype.getStats=function(){return I.apply(this).then(function(T){var b=new Map;return Object.keys(T).forEach(function(k){var N;T[k].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(N=T[k]).type]||N.type,b.set(k,T[k])}),b})}}});var v=["createOffer","createAnswer"];return v.forEach(function(f){var y=p.prototype[f];p.prototype[f]=function(){var I=arguments;return typeof I[0]=="function"||typeof I[1]=="function"?y.apply(this,[arguments[2]]).then(function(T){typeof I[0]=="function"&&I[0].apply(null,[T])},function(T){typeof I[1]=="function"&&I[1].apply(null,[T])}):y.apply(this,arguments)}}),(v=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(f){var y=p.prototype[f];p.prototype[f]=function(){var I=arguments;return typeof I[1]=="function"||typeof I[2]=="function"?y.apply(this,arguments).then(function(){typeof I[1]=="function"&&I[1].apply(null)},function(T){typeof I[2]=="function"&&I[2].apply(null,[T])}):y.apply(this,arguments)}}),["getStats"].forEach(function(f){var y=p.prototype[f];p.prototype[f]=function(){var I=arguments;return typeof I[1]=="function"?y.apply(this,arguments).then(function(){typeof I[1]=="function"&&I[1].apply(null)}):y.apply(this,arguments)}}),p};function wg(r){const c=r&&r.navigator,u=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(d){return u(d).catch(p=>Promise.reject(function(v){return{name:{PermissionDeniedError:"NotAllowedError"}[v.name]||v.name,message:v.message,constraint:v.constraint,toString(){return this.name}}}(p)))}}function Ep(r){"getDisplayMedia"in r.navigator&&r.navigator.mediaDevices&&(r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||(r.navigator.mediaDevices.getDisplayMedia=r.navigator.getDisplayMedia.bind(r.navigator)))}function kl(r,c){if(r.RTCIceGatherer&&(r.RTCIceCandidate||(r.RTCIceCandidate=function(d){return d}),r.RTCSessionDescription||(r.RTCSessionDescription=function(d){return d}),c.version<15025)){const d=Object.getOwnPropertyDescriptor(r.MediaStreamTrack.prototype,"enabled");Object.defineProperty(r.MediaStreamTrack.prototype,"enabled",{set(p){d.set.call(this,p);const v=new Event("enabled");v.enabled=p,this.dispatchEvent(v)}})}r.RTCRtpSender&&!("dtmf"in r.RTCRtpSender.prototype)&&Object.defineProperty(r.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new r.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),r.RTCDtmfSender&&!r.RTCDTMFSender&&(r.RTCDTMFSender=r.RTCDtmfSender);const u=mu(r,c.version);r.RTCPeerConnection=function(d){return d&&d.iceServers&&(d.iceServers=function(p,v){let f=!1;return(p=JSON.parse(JSON.stringify(p))).filter(y=>{if(y&&(y.urls||y.url)){let I=y.urls||y.url;y.url&&!y.urls&&Os("RTCIceServer.url","RTCIceServer.urls");const T=typeof I=="string";return T&&(I=[I]),I=I.filter(b=>{if(b.indexOf("stun:")===0)return!1;const k=b.startsWith("turn")&&!b.startsWith("turn:[")&&b.includes("transport=udp");return k&&!f?(f=!0,!0):k&&!f}),delete y.url,y.urls=T?I[0]:I,!!I.length}})}(d.iceServers,c.version),Ra("ICE servers after filtering:",d.iceServers)),new u(d)},r.RTCPeerConnection.prototype=u.prototype}function za(r){r.RTCRtpSender&&!("replaceTrack"in r.RTCRtpSender.prototype)&&(r.RTCRtpSender.prototype.replaceTrack=r.RTCRtpSender.prototype.setTrack)}var Dg=Object.freeze({__proto__:null,shimPeerConnection:kl,shimReplaceTrack:za,shimGetUserMedia:wg,shimGetDisplayMedia:Ep});function vc(r,c){const u=r&&r.navigator,d=r&&r.MediaStreamTrack;if(u.getUserMedia=function(p,v,f){Os("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),u.mediaDevices.getUserMedia(p).then(v,f)},!(c.version>55&&"autoGainControl"in u.mediaDevices.getSupportedConstraints())){const p=function(f,y,I){y in f&&!(I in f)&&(f[I]=f[y],delete f[y])},v=u.mediaDevices.getUserMedia.bind(u.mediaDevices);if(u.mediaDevices.getUserMedia=function(f){return typeof f=="object"&&typeof f.audio=="object"&&(f=JSON.parse(JSON.stringify(f)),p(f.audio,"autoGainControl","mozAutoGainControl"),p(f.audio,"noiseSuppression","mozNoiseSuppression")),v(f)},d&&d.prototype.getSettings){const f=d.prototype.getSettings;d.prototype.getSettings=function(){const y=f.apply(this,arguments);return p(y,"mozAutoGainControl","autoGainControl"),p(y,"mozNoiseSuppression","noiseSuppression"),y}}if(d&&d.prototype.applyConstraints){const f=d.prototype.applyConstraints;d.prototype.applyConstraints=function(y){return this.kind==="audio"&&typeof y=="object"&&(y=JSON.parse(JSON.stringify(y)),p(y,"autoGainControl","mozAutoGainControl"),p(y,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[y])}}}}function Og(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Po(r,c){if(typeof r!="object"||!r.RTCPeerConnection&&!r.mozRTCPeerConnection)return;!r.RTCPeerConnection&&r.mozRTCPeerConnection&&(r.RTCPeerConnection=r.mozRTCPeerConnection),c.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(p){const v=r.RTCPeerConnection.prototype[p],f={[p](){return arguments[0]=new(p==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),v.apply(this,arguments)}};r.RTCPeerConnection.prototype[p]=f[p]});const u={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},d=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[p,v,f]=arguments;return d.apply(this,[p||null]).then(y=>{if(c.version<53&&!v)try{y.forEach(I=>{I.type=u[I.type]||I.type})}catch(I){if(I.name!=="TypeError")throw I;y.forEach((T,b)=>{y.set(b,Object.assign({},T,{type:u[T.type]||T.type}))})}return y}).then(v,f)}}function Ng(r){if(typeof r!="object"||!r.RTCPeerConnection||!r.RTCRtpSender||r.RTCRtpSender&&"getStats"in r.RTCRtpSender.prototype)return;const c=r.RTCPeerConnection.prototype.getSenders;c&&(r.RTCPeerConnection.prototype.getSenders=function(){const d=c.apply(this,[]);return d.forEach(p=>p._pc=this),d});const u=r.RTCPeerConnection.prototype.addTrack;u&&(r.RTCPeerConnection.prototype.addTrack=function(){const d=u.apply(this,arguments);return d._pc=this,d}),r.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function io(r){if(typeof r!="object"||!r.RTCPeerConnection||!r.RTCRtpSender||r.RTCRtpSender&&"getStats"in r.RTCRtpReceiver.prototype)return;const c=r.RTCPeerConnection.prototype.getReceivers;c&&(r.RTCPeerConnection.prototype.getReceivers=function(){const u=c.apply(this,[]);return u.forEach(d=>d._pc=this),u}),gc(r,"track",u=>(u.receiver._pc=u.srcElement,u)),r.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Lg(r){r.RTCPeerConnection&&!("removeStream"in r.RTCPeerConnection.prototype)&&(r.RTCPeerConnection.prototype.removeStream=function(c){Os("removeStream","removeTrack"),this.getSenders().forEach(u=>{u.track&&c.getTracks().includes(u.track)&&this.removeTrack(u)})})}function Pg(r){r.DataChannel&&!r.RTCDataChannel&&(r.RTCDataChannel=r.DataChannel)}function c_(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const c=r.RTCPeerConnection.prototype.addTransceiver;c&&(r.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const u=arguments[1],d=u&&"sendEncodings"in u;d&&u.sendEncodings.forEach(v=>{if("rid"in v&&!/^[a-z0-9]{0,16}$/i.test(v.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in v&&!(parseFloat(v.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in v&&!(parseFloat(v.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const p=c.apply(this,arguments);if(d){const{sender:v}=p,f=v.getParameters();(!("encodings"in f)||f.encodings.length===1&&Object.keys(f.encodings[0]).length===0)&&(f.encodings=u.sendEncodings,v.sendEncodings=u.sendEncodings,this.setParametersPromises.push(v.setParameters(f).then(()=>{delete v.sendEncodings}).catch(()=>{delete v.sendEncodings})))}return p})}function xg(r){if(typeof r!="object"||!r.RTCRtpSender)return;const c=r.RTCRtpSender.prototype.getParameters;c&&(r.RTCRtpSender.prototype.getParameters=function(){const u=c.apply(this,arguments);return"encodings"in u||(u.encodings=[].concat(this.sendEncodings||[{}])),u})}function Gd(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const c=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>c.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):c.apply(this,arguments)}}function Ug(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const c=r.RTCPeerConnection.prototype.createAnswer;r.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>c.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):c.apply(this,arguments)}}var _c=Object.freeze({__proto__:null,shimOnTrack:Og,shimPeerConnection:Po,shimSenderGetStats:Ng,shimReceiverGetStats:io,shimRemoveStream:Lg,shimRTCDataChannel:Pg,shimAddTransceiver:c_,shimGetParameters:xg,shimCreateOffer:Gd,shimCreateAnswer:Ug,shimGetUserMedia:vc,shimGetDisplayMedia:function(r,c){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(r.navigator.mediaDevices.getDisplayMedia=function(u){if(!u||!u.video){const d=new DOMException("getDisplayMedia without video constraints is undefined");return d.name="NotFoundError",d.code=8,Promise.reject(d)}return u.video===!0?u.video={mediaSource:c}:u.video.mediaSource=c,r.navigator.mediaDevices.getUserMedia(u)})}});function Gg(r){if(typeof r=="object"&&r.RTCPeerConnection){if("getLocalStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in r.RTCPeerConnection.prototype)){const c=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addStream=function(u){this._localStreams||(this._localStreams=[]),this._localStreams.includes(u)||this._localStreams.push(u),u.getAudioTracks().forEach(d=>c.call(this,d,u)),u.getVideoTracks().forEach(d=>c.call(this,d,u))},r.RTCPeerConnection.prototype.addTrack=function(u,...d){return d&&d.forEach(p=>{this._localStreams?this._localStreams.includes(p)||this._localStreams.push(p):this._localStreams=[p]}),c.apply(this,arguments)}}"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(c){this._localStreams||(this._localStreams=[]);const u=this._localStreams.indexOf(c);if(u===-1)return;this._localStreams.splice(u,1);const d=c.getTracks();this.getSenders().forEach(p=>{d.includes(p.track)&&this.removeTrack(p)})})}}function Fg(r){if(typeof r=="object"&&r.RTCPeerConnection&&("getRemoteStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in r.RTCPeerConnection.prototype))){Object.defineProperty(r.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(u){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=u),this.addEventListener("track",this._onaddstreampoly=d=>{d.streams.forEach(p=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(p))return;this._remoteStreams.push(p);const v=new Event("addstream");v.stream=p,this.dispatchEvent(v)})})}});const c=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){const u=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(d){d.streams.forEach(p=>{if(u._remoteStreams||(u._remoteStreams=[]),u._remoteStreams.indexOf(p)>=0)return;u._remoteStreams.push(p);const v=new Event("addstream");v.stream=p,u.dispatchEvent(v)})}),c.apply(u,arguments)}}}function Vg(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const c=r.RTCPeerConnection.prototype,u=c.createOffer,d=c.createAnswer,p=c.setLocalDescription,v=c.setRemoteDescription,f=c.addIceCandidate;c.createOffer=function(I,T){const b=arguments.length>=2?arguments[2]:arguments[0],k=u.apply(this,[b]);return T?(k.then(I,T),Promise.resolve()):k},c.createAnswer=function(I,T){const b=arguments.length>=2?arguments[2]:arguments[0],k=d.apply(this,[b]);return T?(k.then(I,T),Promise.resolve()):k};let y=function(I,T,b){const k=p.apply(this,[I]);return b?(k.then(T,b),Promise.resolve()):k};c.setLocalDescription=y,y=function(I,T,b){const k=v.apply(this,[I]);return b?(k.then(T,b),Promise.resolve()):k},c.setRemoteDescription=y,y=function(I,T,b){const k=f.apply(this,[I]);return b?(k.then(T,b),Promise.resolve()):k},c.addIceCandidate=y}function yc(r){const c=r&&r.navigator;if(c.mediaDevices&&c.mediaDevices.getUserMedia){const u=c.mediaDevices,d=u.getUserMedia.bind(u);c.mediaDevices.getUserMedia=p=>d(Bg(p))}!c.getUserMedia&&c.mediaDevices&&c.mediaDevices.getUserMedia&&(c.getUserMedia=function(u,d,p){c.mediaDevices.getUserMedia(u).then(d,p)}.bind(c))}function Bg(r){return r&&r.video!==void 0?Object.assign({},r,{video:xd(r.video)}):r}function Ao(r){if(!r.RTCPeerConnection)return;const c=r.RTCPeerConnection;r.RTCPeerConnection=function(u,d){if(u&&u.iceServers){const p=[];for(let v=0;v<u.iceServers.length;v++){let f=u.iceServers[v];!f.hasOwnProperty("urls")&&f.hasOwnProperty("url")?(Os("RTCIceServer.url","RTCIceServer.urls"),f=JSON.parse(JSON.stringify(f)),f.urls=f.url,delete f.url,p.push(f)):p.push(u.iceServers[v])}u.iceServers=p}return new c(u,d)},r.RTCPeerConnection.prototype=c.prototype,"generateCertificate"in c&&Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get:()=>c.generateCertificate})}function oo(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function xo(r){const c=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(u){if(u){u.offerToReceiveAudio!==void 0&&(u.offerToReceiveAudio=!!u.offerToReceiveAudio);const d=this.getTransceivers().find(v=>v.receiver.track.kind==="audio");u.offerToReceiveAudio===!1&&d?d.direction==="sendrecv"?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":d.direction==="recvonly"&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):u.offerToReceiveAudio!==!0||d||this.addTransceiver("audio"),u.offerToReceiveVideo!==void 0&&(u.offerToReceiveVideo=!!u.offerToReceiveVideo);const p=this.getTransceivers().find(v=>v.receiver.track.kind==="video");u.offerToReceiveVideo===!1&&p?p.direction==="sendrecv"?p.setDirection?p.setDirection("sendonly"):p.direction="sendonly":p.direction==="recvonly"&&(p.setDirection?p.setDirection("inactive"):p.direction="inactive"):u.offerToReceiveVideo!==!0||p||this.addTransceiver("video")}return c.apply(this,arguments)}}function wl(r){typeof r!="object"||r.AudioContext||(r.AudioContext=r.webkitAudioContext)}var Fd=Object.freeze({__proto__:null,shimLocalStreamsAPI:Gg,shimRemoteStreamsAPI:Fg,shimCallbacksAPI:Vg,shimGetUserMedia:yc,shimConstraints:Bg,shimRTCIceServerUrls:Ao,shimTrackEventTransceiver:oo,shimCreateOfferLegacy:xo,shimAudioContext:wl});function vu(r){if(!r.RTCIceCandidate||r.RTCIceCandidate&&"foundation"in r.RTCIceCandidate.prototype)return;const c=r.RTCIceCandidate;r.RTCIceCandidate=function(u){if(typeof u=="object"&&u.candidate&&u.candidate.indexOf("a=")===0&&((u=JSON.parse(JSON.stringify(u))).candidate=u.candidate.substr(2)),u.candidate&&u.candidate.length){const d=new c(u),p=gn.parseCandidate(u.candidate),v=Object.assign(d,p);return v.toJSON=function(){return{candidate:v.candidate,sdpMid:v.sdpMid,sdpMLineIndex:v.sdpMLineIndex,usernameFragment:v.usernameFragment}},v}return new c(u)},r.RTCIceCandidate.prototype=c.prototype,gc(r,"icecandidate",u=>(u.candidate&&Object.defineProperty(u,"candidate",{value:new r.RTCIceCandidate(u.candidate),writable:"false"}),u))}function fo(r,c){if(!r.RTCPeerConnection)return;"sctp"in r.RTCPeerConnection.prototype||Object.defineProperty(r.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const u=function(y){if(!y||!y.sdp)return!1;const I=gn.splitSections(y.sdp);return I.shift(),I.some(T=>{const b=gn.parseMLine(T);return b&&b.kind==="application"&&b.protocol.indexOf("SCTP")!==-1})},d=function(y){const I=y.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(I===null||I.length<2)return-1;const T=parseInt(I[1],10);return T!=T?-1:T},p=function(y){let I=65536;return c.browser==="firefox"&&(I=c.version<57?y===-1?16384:2147483637:c.version<60?c.version===57?65535:65536:2147483637),I},v=function(y,I){let T=65536;c.browser==="firefox"&&c.version===57&&(T=65535);const b=gn.matchPrefix(y.sdp,"a=max-message-size:");return b.length>0?T=parseInt(b[0].substr(19),10):c.browser==="firefox"&&I!==-1&&(T=2147483637),T},f=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,c.browser==="chrome"&&c.version>=76){const{sdpSemantics:y}=this.getConfiguration();y==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(u(arguments[0])){const y=d(arguments[0]),I=p(y),T=v(arguments[0],y);let b;b=I===0&&T===0?Number.POSITIVE_INFINITY:I===0||T===0?Math.max(I,T):Math.min(I,T);const k={};Object.defineProperty(k,"maxMessageSize",{get:()=>b}),this._sctp=k}return f.apply(this,arguments)}}function Sc(r){if(!r.RTCPeerConnection||!("createDataChannel"in r.RTCPeerConnection.prototype))return;function c(d,p){const v=d.send;d.send=function(){const f=arguments[0],y=f.length||f.size||f.byteLength;if(d.readyState==="open"&&p.sctp&&y>p.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+p.sctp.maxMessageSize+" bytes)");return v.apply(d,arguments)}}const u=r.RTCPeerConnection.prototype.createDataChannel;r.RTCPeerConnection.prototype.createDataChannel=function(){const d=u.apply(this,arguments);return c(d,this),d},gc(r,"datachannel",d=>(c(d.channel,d.target),d))}function Vd(r){if(!r.RTCPeerConnection||"connectionState"in r.RTCPeerConnection.prototype)return;const c=r.RTCPeerConnection.prototype;Object.defineProperty(c,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(c,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(u){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),u&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=u)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(u=>{const d=c[u];c[u]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=p=>{const v=p.target;if(v._lastConnectionState!==v.connectionState){v._lastConnectionState=v.connectionState;const f=new Event("connectionstatechange",p);v.dispatchEvent(f)}return p},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),d.apply(this,arguments)}})}function Dl(r,c){if(!r.RTCPeerConnection||c.browser==="chrome"&&c.version>=71||c.browser==="safari"&&c.version>=605)return;const u=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(d){if(d&&d.sdp&&d.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const p=d.sdp.split(`
`).filter(v=>v.trim()!=="a=extmap-allow-mixed").join(`
`);r.RTCSessionDescription&&d instanceof r.RTCSessionDescription?arguments[0]=new r.RTCSessionDescription({type:d.type,sdp:p}):d.sdp=p}return u.apply(this,arguments)}}function Bd(r,c){if(!r.RTCPeerConnection||!r.RTCPeerConnection.prototype)return;const u=r.RTCPeerConnection.prototype.addIceCandidate;u&&u.length!==0&&(r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(c.browser==="chrome"&&c.version<78||c.browser==="firefox"&&c.version<68||c.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():u.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}var jg=Object.freeze({__proto__:null,shimRTCIceCandidate:vu,shimMaxMessageSize:fo,shimSendThrowTypeError:Sc,shimConnectionState:Vd,removeExtmapAllowMixed:Dl,shimAddIceCandidateNullOrEmpty:Bd});(function({window:r}={},c={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const u=Ra,d=function(v){const f={browser:null,version:null};if(v===void 0||!v.navigator)return f.browser="Not a browser.",f;const{navigator:y}=v;if(y.mozGetUserMedia)f.browser="firefox",f.version=Ml(y.userAgent,/Firefox\/(\d+)\./,1);else if(y.webkitGetUserMedia||v.isSecureContext===!1&&v.webkitRTCPeerConnection&&!v.RTCIceGatherer)f.browser="chrome",f.version=Ml(y.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(y.mediaDevices&&y.userAgent.match(/Edge\/(\d+).(\d+)$/))f.browser="edge",f.version=Ml(y.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!v.RTCPeerConnection||!y.userAgent.match(/AppleWebKit\/(\d+)\./))return f.browser="Not a supported browser.",f;f.browser="safari",f.version=Ml(y.userAgent,/AppleWebKit\/(\d+)\./,1),f.supportsUnifiedPlan=v.RTCRtpTransceiver&&"currentDirection"in v.RTCRtpTransceiver.prototype}return f}(r),p={browserDetails:d,commonShim:jg,extractVersion:Ml,disableLog:pu,disableWarnings:_p};switch(d.browser){case"chrome":if(!Ip||!bl||!c.shimChrome)return u("Chrome shim is not included in this adapter release."),p;if(d.version===null)return u("Chrome shim can not determine version, not shimming."),p;u("adapter.js shimming chrome."),p.browserShim=Ip,Bd(r,d),Rl(r,d),fu(r),bl(r,d),Wa(r),Sp(r,d),Ui(r),Cl(r),Ag(r),ro(r,d),vu(r),Vd(r),fo(r,d),Sc(r),Dl(r,d);break;case"firefox":if(!_c||!Po||!c.shimFirefox)return u("Firefox shim is not included in this adapter release."),p;u("adapter.js shimming firefox."),p.browserShim=_c,Bd(r,d),vc(r,d),Po(r,d),Og(r),Lg(r),Ng(r),io(r),Pg(r),c_(r),xg(r),Gd(r),Ug(r),vu(r),Vd(r),fo(r,d),Sc(r);break;case"edge":if(!Dg||!kl||!c.shimEdge)return u("MS edge shim is not included in this adapter release."),p;u("adapter.js shimming edge."),p.browserShim=Dg,wg(r),Ep(r),kl(r,d),za(r),fo(r,d),Sc(r);break;case"safari":if(!Fd||!c.shimSafari)return u("Safari shim is not included in this adapter release."),p;u("adapter.js shimming safari."),p.browserShim=Fd,Bd(r,d),Ao(r),xo(r),Vg(r),Gg(r),Fg(r),oo(r),yc(r),wl(r),vu(r),fo(r,d),Sc(r),Dl(r,d);break;default:u("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var ia,_u=Object.keys||function(r){return vl(r,du)},Tp={f:Et&&!Sg?Object.defineProperties:function(r,c){Sn(r);for(var u,d=ur(c),p=_u(c),v=p.length,f=0;v>f;)Yn.f(r,u=p[f++],d[u]);return r}},Ca=_r("document","documentElement"),Ns=to("IE_PROTO"),Mp=function(){},di=function(r){return"<script>"+r+"<\/script>"},u_=function(r){r.write(di("")),r.close();var c=r.parentWindow.Object;return r=null,c},jd=function(){try{ia=new ActiveXObject("htmlfile")}catch{}var r,c;jd=typeof document<"u"?document.domain&&ia?u_(ia):((c=_a("iframe")).style.display="none",Ca.appendChild(c),c.src=String("javascript:"),(r=c.contentWindow.document).open(),r.write(di("document.F=Object")),r.close(),r.F):u_(ia);for(var u=du.length;u--;)delete jd.prototype[du[u]];return jd()};hp[Ns]=!0;var Ic=Object.create||function(r,c){var u;return r!==null?(Mp.prototype=Sn(r),u=new Mp,Mp.prototype=null,u[Ns]=r):u=jd(),c===void 0?u:Tp.f(u,c)},Ls=Qt("unscopables"),Ec=Array.prototype;Ec[Ls]==null&&Yn.f(Ec,Ls,{configurable:!0,value:Ic(null)});var Ya,qd,l_,Tc=function(r){Ec[Ls][r]=!0},Mc={},mn=!xe(function(){function r(){}return r.prototype.constructor=null,Object.getPrototypeOf(new r)!==r.prototype}),Z=to("IE_PROTO"),ba=ee.Object,go=ba.prototype,mo=mn?ba.getPrototypeOf:function(r){var c=fr(r);if(st(c,Z))return c[Z];var u=c.constructor;return bt(u)&&c instanceof u?u.prototype:c instanceof ba?go:null},Ol=Qt("iterator"),Rp=!1;[].keys&&("next"in(l_=[].keys())?(qd=mo(mo(l_)))!==Object.prototype&&(Ya=qd):Rp=!0),(Ya==null||xe(function(){var r={};return Ya[Ol].call(r)!==r}))&&(Ya={}),bt(Ya[Ol])||sr(Ya,Ol,function(){return this});var Nl={IteratorPrototype:Ya,BUGGY_SAFARI_ITERATORS:Rp},Cp=Yn.f,qg=Qt("toStringTag"),Uo=function(r,c,u){r&&!u&&(r=r.prototype),r&&!st(r,qg)&&Cp(r,qg,{configurable:!0,value:c})},Ja=Nl.IteratorPrototype,Aa=function(){return this},Hg=function(r,c,u,d){var p=c+" Iterator";return r.prototype=Ic(Ja,{next:Gn(+!d,u)}),Uo(r,p,!1),Mc[p]=Aa,r},u0=ee.String,d_=ee.TypeError,hi=Object.setPrototypeOf||("__proto__"in{}?function(){var r,c=!1,u={};try{(r=ve(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(u,[]),c=u instanceof Array}catch{}return function(d,p){return Sn(d),function(v){if(typeof v=="object"||bt(v))return v;throw d_("Can't set "+u0(v)+" as a prototype")}(p),c?r(d,p):d.__proto__=p,d}}():void 0),$g=Sa.PROPER,Xa=Sa.CONFIGURABLE,Kg=Nl.IteratorPrototype,Go=Nl.BUGGY_SAFARI_ITERATORS,Rc=Qt("iterator"),h_=function(){return this},rn=function(r,c,u,d,p,v,f){Hg(u,c,d);var y,I,T,b=function(K){if(K===p&&G)return G;if(!Go&&K in O)return O[K];switch(K){case"keys":case"values":case"entries":return function(){return new u(this,K)}}return function(){return new u(this)}},k=c+" Iterator",N=!1,O=r.prototype,F=O[Rc]||O["@@iterator"]||p&&O[p],G=!Go&&F||b(p),P=c=="Array"&&O.entries||F;if(P&&(y=mo(P.call(new r)))!==Object.prototype&&y.next&&(mo(y)!==Kg&&(hi?hi(y,Kg):bt(y[Rc])||sr(y,Rc,h_)),Uo(y,k,!0)),$g&&p=="values"&&F&&F.name!=="values"&&(Xa?Hn(O,"name","values"):(N=!0,G=function(){return dt(F,this)})),p)if(I={values:b("values"),keys:v?G:b("keys"),entries:b("entries")},f)for(T in I)(Go||N||!(T in O))&&sr(O,T,I[T]);else cn({target:c,proto:!0,forced:Go||N},I);return O[Rc]!==G&&sr(O,Rc,G,{name:p}),Mc[c]=G,I},l0=Yn.f,Wg=Tr.set,Ps=Tr.getterFor("Array Iterator"),Cc=rn(Array,"Array",function(r,c){Wg(this,{type:"Array Iterator",target:ur(r),index:0,kind:c})},function(){var r=Ps(this),c=r.target,u=r.kind,d=r.index++;return!c||d>=c.length?(r.target=void 0,{value:void 0,done:!0}):u=="keys"?{value:d,done:!1}:u=="values"?{value:c[d],done:!1}:{value:[d,c[d]],done:!1}},"values"),p_=Mc.Arguments=Mc.Array;if(Tc("keys"),Tc("values"),Tc("entries"),Et&&p_.name!=="values")try{l0(p_,"name",{value:"values"})}catch{}var yu=function(r,c,u){var d=Si(c);d in r?Yn.f(r,d,Gn(0,u)):r[d]=u},bp=ee.Array,d0=Math.max,Vr=function(r,c,u){for(var d=Pi(r),p=po(c,d),v=po(u===void 0?d:u,d),f=bp(d0(v-p,0)),y=0;p<v;p++,y++)yu(f,y,r[p]);return f.length=y,f},Ap=ta.f,f_=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],g_={f:function(r){return f_&&hr(r)=="Window"?function(c){try{return Ap(c)}catch{return Vr(f_)}}(r):Ap(ur(r))}},Hd=xe(function(){if(typeof ArrayBuffer=="function"){var r=new ArrayBuffer(8);Object.isExtensible(r)&&Object.defineProperty(r,"a",{value:8})}}),kp=Object.isExtensible,zg=xe(function(){kp(1)})||Hd?function(r){return!!xt(r)&&(!Hd||hr(r)!="ArrayBuffer")&&(!kp||kp(r))}:kp,wp=!xe(function(){return Object.isExtensible(Object.preventExtensions({}))}),ka=vt(function(r){var c=Yn.f,u=!1,d=Wi("meta"),p=0,v=function(y){c(y,d,{value:{objectID:"O"+p++,weakData:{}}})},f=r.exports={enable:function(){f.enable=function(){},u=!0;var y=ta.f,I=ve([].splice),T={};T[d]=1,y(T).length&&(ta.f=function(b){for(var k=y(b),N=0,O=k.length;N<O;N++)if(k[N]===d){I(k,N,1);break}return k},cn({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:g_.f}))},fastKey:function(y,I){if(!xt(y))return typeof y=="symbol"?y:(typeof y=="string"?"S":"P")+y;if(!st(y,d)){if(!zg(y))return"F";if(!I)return"E";v(y)}return y[d].objectID},getWeakData:function(y,I){if(!st(y,d)){if(!zg(y))return!0;if(!I)return!1;v(y)}return y[d].weakData},onFreeze:function(y){return wp&&u&&zg(y)&&!st(y,d)&&v(y),y}};hp[d]=!0}),$d=(ka.enable,ka.fastKey,ka.getWeakData,ka.onFreeze,Qt("iterator")),Yg=Array.prototype,Jg=function(r){return r!==void 0&&(Mc.Array===r||Yg[$d]===r)},m_=Qt("iterator"),Su=function(r){if(r!=null)return Ir(r,m_)||Ir(r,"@@iterator")||Mc[Ka(r)]},v_=ee.TypeError,bc=function(r,c){var u=arguments.length<2?Su(r):c;if(er(u))return Sn(dt(u,r));throw v_(ci(r)+" is not iterable")},Kd=function(r,c,u){var d,p;Sn(r);try{if(!(d=Ir(r,"return"))){if(c==="throw")throw u;return u}d=dt(d,r)}catch(v){p=!0,d=v}if(c==="throw")throw u;if(p)throw d;return Sn(d),u},h0=ee.TypeError,Wd=function(r,c){this.stopped=r,this.result=c},__=Wd.prototype,Dp=function(r,c,u){var d,p,v,f,y,I,T,b=u&&u.that,k=!(!u||!u.AS_ENTRIES),N=!(!u||!u.IS_ITERATOR),O=!(!u||!u.INTERRUPTED),F=Ma(c,b),G=function(K){return d&&Kd(d,"normal",K),new Wd(!0,K)},P=function(K){return k?(Sn(K),O?F(K[0],K[1],G):F(K[0],K[1])):O?F(K,G):F(K)};if(N)d=r;else{if(!(p=Su(r)))throw h0(ci(r)+" is not iterable");if(Jg(p)){for(v=0,f=Pi(r);f>v;v++)if((y=P(r[v]))&&nt(__,y))return y;return new Wd(!1)}d=bc(r,p)}for(I=d.next;!(T=dt(I,d)).done;){try{y=P(T.value)}catch(K){Kd(d,"throw",K)}if(typeof y=="object"&&y&&nt(__,y))return y}return new Wd(!1)},p0=ee.TypeError,oa=function(r,c){if(nt(c,r))return r;throw p0("Incorrect invocation")},Xg=Qt("iterator"),Qg=!1;try{var zd=0,Op={next:function(){return{done:!!zd++}},return:function(){Qg=!0}};Op[Xg]=function(){return this},Array.from(Op,function(){throw 2})}catch{}var Zg=function(r,c){if(!c&&!Qg)return!1;var u=!1;try{var d={};d[Xg]=function(){return{next:function(){return{done:u=!0}}}},r(d)}catch{}return u},Np=function(r,c,u){var d,p;return hi&&bt(d=c.constructor)&&d!==u&&xt(p=d.prototype)&&p!==u.prototype&&hi(r,p),r},Lp=function(r,c,u){var d=r.indexOf("Map")!==-1,p=r.indexOf("Weak")!==-1,v=d?"set":"add",f=ee[r],y=f&&f.prototype,I=f,T={},b=function(P){var K=ve(y[P]);sr(y,P,P=="add"?function(X){return K(this,X===0?0:X),this}:P=="delete"?function(X){return!(p&&!xt(X))&&K(this,X===0?0:X)}:P=="get"?function(X){return p&&!xt(X)?void 0:K(this,X===0?0:X)}:P=="has"?function(X){return!(p&&!xt(X))&&K(this,X===0?0:X)}:function(X,oe){return K(this,X===0?0:X,oe),this})};if(hu(r,!bt(f)||!(p||y.forEach&&!xe(function(){new f().entries().next()}))))I=u.getConstructor(c,r,d,v),ka.enable();else if(hu(r,!0)){var k=new I,N=k[v](p?{}:-0,1)!=k,O=xe(function(){k.has(1)}),F=Zg(function(P){new f(P)}),G=!p&&xe(function(){for(var P=new f,K=5;K--;)P[v](K,K);return!P.has(-0)});F||((I=c(function(P,K){oa(P,y);var X=Np(new f,P,I);return K!=null&&Dp(K,X[v],{that:X,AS_ENTRIES:d}),X})).prototype=y,y.constructor=I),(O||G)&&(b("delete"),b("has"),d&&b("get")),(G||N)&&b(v),p&&y.clear&&delete y.clear}return T[r]=I,cn({global:!0,constructor:!0,forced:I!=f},T),Uo(I,r),p||u.setStrong(I,r,d),I},Qa=function(r,c,u){for(var d in c)sr(r,d,c[d],u);return r},Yd=Qt("species"),Iu=function(r){var c=_r(r),u=Yn.f;Et&&c&&!c[Yd]&&u(c,Yd,{configurable:!0,get:function(){return this}})},Pp=Yn.f,Ll=ka.fastKey,xp=Tr.set,Jd=Tr.getterFor,y_={getConstructor:function(r,c,u,d){var p=r(function(T,b){oa(T,v),xp(T,{type:c,index:Ic(null),first:void 0,last:void 0,size:0}),Et||(T.size=0),b!=null&&Dp(b,T[d],{that:T,AS_ENTRIES:u})}),v=p.prototype,f=Jd(c),y=function(T,b,k){var N,O,F=f(T),G=I(T,b);return G?G.value=k:(F.last=G={index:O=Ll(b,!0),key:b,value:k,previous:N=F.last,next:void 0,removed:!1},F.first||(F.first=G),N&&(N.next=G),Et?F.size++:T.size++,O!=="F"&&(F.index[O]=G)),T},I=function(T,b){var k,N=f(T),O=Ll(b);if(O!=="F")return N.index[O];for(k=N.first;k;k=k.next)if(k.key==b)return k};return Qa(v,{clear:function(){for(var T=f(this),b=T.index,k=T.first;k;)k.removed=!0,k.previous&&(k.previous=k.previous.next=void 0),delete b[k.index],k=k.next;T.first=T.last=void 0,Et?T.size=0:this.size=0},delete:function(T){var b=f(this),k=I(this,T);if(k){var N=k.next,O=k.previous;delete b.index[k.index],k.removed=!0,O&&(O.next=N),N&&(N.previous=O),b.first==k&&(b.first=N),b.last==k&&(b.last=O),Et?b.size--:this.size--}return!!k},forEach:function(T){for(var b,k=f(this),N=Ma(T,arguments.length>1?arguments[1]:void 0);b=b?b.next:k.first;)for(N(b.value,b.key,this);b&&b.removed;)b=b.previous},has:function(T){return!!I(this,T)}}),Qa(v,u?{get:function(T){var b=I(this,T);return b&&b.value},set:function(T,b){return y(this,T===0?0:T,b)}}:{add:function(T){return y(this,T=T===0?0:T,T)}}),Et&&Pp(v,"size",{get:function(){return f(this).size}}),p},setStrong:function(r,c,u){var d=c+" Iterator",p=Jd(c),v=Jd(d);rn(r,c,function(f,y){xp(this,{type:d,target:f,state:p(f),kind:y,last:void 0})},function(){for(var f=v(this),y=f.kind,I=f.last;I&&I.removed;)I=I.previous;return f.target&&(f.last=I=I?I.next:f.state.first)?y=="keys"?{value:I.key,done:!1}:y=="values"?{value:I.value,done:!1}:{value:[I.key,I.value],done:!1}:(f.target=void 0,{value:void 0,done:!0})},u?"entries":"values",!u,!0),Iu(c)}};Lp("Set",function(r){return function(){return r(this,arguments.length?arguments[0]:void 0)}},y_);var em=ee.String,hn=function(r){if(Ka(r)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return em(r)},S_=ve("".charAt),I_=ve("".charCodeAt),f0=ve("".slice),E_=function(r){return function(c,u){var d,p,v=hn(an(c)),f=Ia(u),y=v.length;return f<0||f>=y?r?"":void 0:(d=I_(v,f))<55296||d>56319||f+1===y||(p=I_(v,f+1))<56320||p>57343?r?S_(v,f):d:r?f0(v,f,f+2):p-56320+(d-55296<<10)+65536}},tm={codeAt:E_(!1),charAt:E_(!0)},Up=tm.charAt,Gp=Tr.set,g0=Tr.getterFor("String Iterator");rn(String,"String",function(r){Gp(this,{type:"String Iterator",string:hn(r),index:0})},function(){var r,c=g0(this),u=c.string,d=c.index;return d>=u.length?{value:void 0,done:!0}:(r=Up(u,d),c.index+=r.length,{value:r,done:!1})});var Pl={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},nm=_a("span").classList,xl=nm&&nm.constructor&&nm.constructor.prototype,rm=xl===Object.prototype?void 0:xl,im=Qt("iterator"),Fp=Qt("toStringTag"),Xd=Cc.values,Eu=function(r,c){if(r){if(r[im]!==Xd)try{Hn(r,im,Xd)}catch{r[im]=Xd}if(r[Fp]||Hn(r,Fp,c),Pl[c]){for(var u in Cc)if(r[u]!==Cc[u])try{Hn(r,u,Cc[u])}catch{r[u]=Cc[u]}}}};for(var om in Pl)Eu(ee[om]&&ee[om].prototype,om);Eu(rm,"DOMTokenList");var T_=Function.prototype,am=T_.apply,M_=T_.call,wa=typeof Reflect=="object"&&Reflect.apply||(Fn?M_.bind(am):function(){return M_.apply(am,arguments)}),Ac=ve([].slice),R_=ee.TypeError,xs=function(r,c){if(r<c)throw R_("Not enough arguments");return r},C_=/MSIE .\./.test(nn),b_=ee.Function,A_=function(r){return C_?function(c,u){var d=xs(arguments.length,1)>2,p=bt(c)?c:b_(c),v=d?Ac(arguments,2):void 0;return r(d?function(){wa(p,this,v)}:p,u)}:r},sm={setTimeout:A_(ee.setTimeout),setInterval:A_(ee.setInterval)},Vp=sm.setInterval;cn({global:!0,bind:!0,forced:ee.setInterval!==Vp},{setInterval:Vp});var kc=sm.setTimeout;cn({global:!0,bind:!0,forced:ee.setTimeout!==kc},{setTimeout:kc}),Lp("Map",function(r){return function(){return r(this,arguments.length?arguments[0]:void 0)}},y_);var m0=Tl("splice"),Bp=ee.TypeError,Da=Math.max,cm=Math.min;cn({target:"Array",proto:!0,forced:!m0},{splice:function(r,c){var u,d,p,v,f,y,I=fr(this),T=Pi(I),b=po(r,T),k=arguments.length;if(k===0?u=d=0:k===1?(u=0,d=T-b):(u=k-2,d=cm(Da(Ia(c),0),T-b)),T+u-d>9007199254740991)throw Bp("Maximum allowed length exceeded");for(p=El(I,d),v=0;v<d;v++)(f=b+v)in I&&yu(p,v,I[f]);if(p.length=d,u<d){for(v=b;v<T-d;v++)y=v+u,(f=v+d)in I?I[y]=I[f]:delete I[y];for(v=T;v>T-d+u;v--)delete I[v-1]}else if(u>d)for(v=T-d;v>b;v--)y=v+u-1,(f=v+d-1)in I?I[y]=I[f]:delete I[y];for(v=0;v<u;v++)I[v+b]=arguments[v+2];return I.length=T-d+u,p}});var Ul=function(r,c){var u=[][r];return!!u&&xe(function(){u.call(null,c||function(){return 1},1)})},v0=Zr.forEach,wc=Ul("forEach")?[].forEach:function(r){return v0(this,r,arguments.length>1?arguments[1]:void 0)};cn({target:"Array",proto:!0,forced:[].forEach!=wc},{forEach:wc});var um=function(r){if(r&&r.forEach!==wc)try{Hn(r,"forEach",wc)}catch{r.forEach=wc}};for(var lm in Pl)Pl[lm]&&um(ee[lm]&&ee[lm].prototype);um(rm);var k_=ve([].join),_0=qr!=Object,y0=Ul("join",",");cn({target:"Array",proto:!0,forced:_0||!y0},{join:function(r){return k_(ur(this),r===void 0?",":r)}});var dm=Qt("isConcatSpreadable"),jp=ee.TypeError,w_=Ge>=51||!xe(function(){var r=[];return r[dm]=!1,r.concat()[0]!==r}),Qd=Tl("concat"),Dc=function(r){if(!xt(r))return!1;var c=r[dm];return c!==void 0?!!c:dc(r)};cn({target:"Array",proto:!0,arity:1,forced:!w_||!Qd},{concat:function(r){var c,u,d,p,v,f=fr(this),y=El(f,0),I=0;for(c=-1,d=arguments.length;c<d;c++)if(Dc(v=c===-1?f:arguments[c])){if(I+(p=Pi(v))>9007199254740991)throw jp("Maximum allowed index exceeded");for(u=0;u<p;u++,I++)u in v&&yu(y,I,v[u])}else{if(I>=9007199254740991)throw jp("Maximum allowed index exceeded");yu(y,I++,v)}return y.length=I,y}});var hm=Date.prototype,Zd=ve(hm.toString),D_=ve(hm.getTime);String(new Date(NaN))!="Invalid Date"&&sr(hm,"toString",function(){var r=D_(this);return r==r?Zd(this):"Invalid Date"});var Gl=function(){var r=Sn(this),c="";return r.hasIndices&&(c+="d"),r.global&&(c+="g"),r.ignoreCase&&(c+="i"),r.multiline&&(c+="m"),r.dotAll&&(c+="s"),r.unicode&&(c+="u"),r.sticky&&(c+="y"),c},pm=ee.RegExp,eh=xe(function(){var r=pm("a","y");return r.lastIndex=2,r.exec("abcd")!=null}),S0=eh||xe(function(){return!pm("a","y").sticky}),Oc={BROKEN_CARET:eh||xe(function(){var r=pm("^r","gy");return r.lastIndex=2,r.exec("str")!=null}),MISSED_STICKY:S0,UNSUPPORTED_Y:eh},I0=ee.RegExp,Fl=xe(function(){var r=I0(".","s");return!(r.dotAll&&r.exec(`
`)&&r.flags==="s")}),E0=ee.RegExp,Tu=xe(function(){var r=E0("(?<a>b)","g");return r.exec("b").groups.a!=="b"||"b".replace(r,"$<a>c")!=="bc"}),qp=Tr.get,fm=ja("native-string-replace",String.prototype.replace),Vl=RegExp.prototype.exec,Mu=Vl,T0=ve("".charAt),gm=ve("".indexOf),M0=ve("".replace),Za=ve("".slice),Hp=function(){var r=/a/,c=/b*/g;return dt(Vl,r,"a"),dt(Vl,c,"a"),r.lastIndex!==0||c.lastIndex!==0}(),$p=Oc.BROKEN_CARET,Kp=/()??/.exec("")[1]!==void 0;(Hp||Kp||$p||Fl||Tu)&&(Mu=function(r){var c,u,d,p,v,f,y,I=this,T=qp(I),b=hn(r),k=T.raw;if(k)return k.lastIndex=I.lastIndex,c=dt(Mu,k,b),I.lastIndex=k.lastIndex,c;var N=T.groups,O=$p&&I.sticky,F=dt(Gl,I),G=I.source,P=0,K=b;if(O&&(F=M0(F,"y",""),gm(F,"g")===-1&&(F+="g"),K=Za(b,I.lastIndex),I.lastIndex>0&&(!I.multiline||I.multiline&&T0(b,I.lastIndex-1)!==`
`)&&(G="(?: "+G+")",K=" "+K,P++),u=new RegExp("^(?:"+G+")",F)),Kp&&(u=new RegExp("^"+G+"$(?!\\s)",F)),Hp&&(d=I.lastIndex),p=dt(Vl,O?u:I,K),O?p?(p.input=Za(p.input,P),p[0]=Za(p[0],P),p.index=I.lastIndex,I.lastIndex+=p[0].length):I.lastIndex=0:Hp&&p&&(I.lastIndex=I.global?p.index+p[0].length:d),Kp&&p&&p.length>1&&dt(fm,p[0],u,function(){for(v=1;v<arguments.length-2;v++)arguments[v]===void 0&&(p[v]=void 0)}),p&&N)for(p.groups=f=Ic(null),v=0;v<N.length;v++)f[(y=N[v])[0]]=p[y[1]];return p});var Ru=Mu;cn({target:"RegExp",proto:!0,forced:/./.exec!==Ru},{exec:Ru});var O_=Qt("species"),th=RegExp.prototype,Bl=function(r,c,u,d){var p=Qt(r),v=!xe(function(){var T={};return T[p]=function(){return 7},""[r](T)!=7}),f=v&&!xe(function(){var T=!1,b=/a/;return r==="split"&&((b={}).constructor={},b.constructor[O_]=function(){return b},b.flags="",b[p]=/./[p]),b.exec=function(){return T=!0,null},b[p](""),!T});if(!v||!f||u){var y=ve(/./[p]),I=c(p,""[r],function(T,b,k,N,O){var F=ve(T),G=b.exec;return G===Ru||G===th.exec?v&&!O?{done:!0,value:y(b,k,N)}:{done:!0,value:F(k,b,N)}:{done:!1}});sr(String.prototype,r,I[0]),sr(th,p,I[1])}d&&Hn(th[p],"sham",!0)},R0=tm.charAt,nh=function(r,c,u){return c+(u?R0(r,c).length:1)},C0=Math.floor,Wp=ve("".charAt),b0=ve("".replace),zp=ve("".slice),N_=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,mm=/\$([$&'`]|\d{1,2})/g,L_=function(r,c,u,d,p,v){var f=u+r.length,y=d.length,I=mm;return p!==void 0&&(p=fr(p),I=N_),b0(v,I,function(T,b){var k;switch(Wp(b,0)){case"$":return"$";case"&":return r;case"`":return zp(c,0,u);case"'":return zp(c,f);case"<":k=p[zp(b,1,-1)];break;default:var N=+b;if(N===0)return T;if(N>y){var O=C0(N/10);return O===0?T:O<=y?d[O-1]===void 0?Wp(b,1):d[O-1]+Wp(b,1):T}k=d[N-1]}return k===void 0?"":k})},A0=ee.TypeError,jl=function(r,c){var u=r.exec;if(bt(u)){var d=dt(u,r,c);return d!==null&&Sn(d),d}if(hr(r)==="RegExp")return dt(Ru,r,c);throw A0("RegExp#exec called on incompatible receiver")},vm=Qt("replace"),zi=Math.max,P_=Math.min,es=ve([].concat),Nc=ve([].push),x_=ve("".indexOf),Lc=ve("".slice),_m="a".replace(/./,"$0")==="$0",ym=!!/./[vm]&&/./[vm]("a","$0")==="";Bl("replace",function(r,c,u){var d=ym?"$":"$0";return[function(p,v){var f=an(this),y=p==null?void 0:Ir(p,vm);return y?dt(y,p,f,v):dt(c,hn(f),p,v)},function(p,v){var f=Sn(this),y=hn(p);if(typeof v=="string"&&x_(v,d)===-1&&x_(v,"$<")===-1){var I=u(c,f,y,v);if(I.done)return I.value}var T=bt(v);T||(v=hn(v));var b=f.global;if(b){var k=f.unicode;f.lastIndex=0}for(var N=[];;){var O=jl(f,y);if(O===null||(Nc(N,O),!b))break;hn(O[0])===""&&(f.lastIndex=nh(y,xr(f.lastIndex),k))}for(var F,G="",P=0,K=0;K<N.length;K++){for(var X=hn((O=N[K])[0]),oe=zi(P_(Ia(O.index),y.length),0),Ce=[],Ve=1;Ve<O.length;Ve++)Nc(Ce,(F=O[Ve])===void 0?F:String(F));var je=O.groups;if(T){var Re=es([X],Ce,oe,y);je!==void 0&&Nc(Re,je);var Oe=hn(wa(v,void 0,Re))}else Oe=L_(X,y,oe,Ce,je,v);oe>=P&&(G+=Lc(y,P,oe)+Oe,P=oe+X.length)}return G+Lc(y,P)}]},!!xe(function(){var r=/./;return r.exec=function(){var c=[];return c.groups={a:"7"},c},"".replace(r,"$<a>")!=="7"})||!_m||ym);var Yp=Qt("iterator"),Sm=!xe(function(){var r=new URL("b?a=1&b=2&c=3","http://a"),c=r.searchParams,u="";return r.pathname="c%20d",c.forEach(function(d,p){c.delete("b"),u+=p+d}),!c.sort||r.href!=="http://a/c%20d?a=1&c=3"||c.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!c[Yp]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://\u0442\u0435\u0441\u0442").host!=="xn--e1aybc"||new URL("http://a#\u0431").hash!=="#%D0%B1"||u!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Oa=Math.floor,Im=function(r,c){var u=r.length,d=Oa(u/2);return u<8?U_(r,c):Em(r,Im(Vr(r,0,d),c),Im(Vr(r,d),c),c)},U_=function(r,c){for(var u,d,p=r.length,v=1;v<p;){for(d=v,u=r[v];d&&c(r[d-1],u)>0;)r[d]=r[--d];d!==v++&&(r[d]=u)}return r},Em=function(r,c,u,d){for(var p=c.length,v=u.length,f=0,y=0;f<p||y<v;)r[f+y]=f<p&&y<v?d(c[f],u[y])<=0?c[f++]:u[y++]:f<p?c[f++]:u[y++];return r},G_=Im,rh=Qt("iterator"),Cu=Tr.set,aa=Tr.getterFor("URLSearchParams"),bu=Tr.getterFor("URLSearchParamsIterator"),ts=Object.getOwnPropertyDescriptor,ns=function(r){if(!Et)return ee[r];var c=ts(ee,r);return c&&c.value},Tm=ns("fetch"),Au=ns("Request"),ih=ns("Headers"),ko=Au&&Au.prototype,ql=ih&&ih.prototype,Us=ee.RegExp,Mm=ee.TypeError,ku=ee.decodeURIComponent,k0=ee.encodeURIComponent,F_=ve("".charAt),oh=ve([].join),sa=ve([].push),rs=ve("".replace),Na=ve([].shift),ah=ve([].splice),Gs=ve("".split),Jp=ve("".slice),sh=/\+/g,Xp=Array(4),wu=function(r){return Xp[r-1]||(Xp[r-1]=Us("((?:%[\\da-f]{2}){"+r+"})","gi"))},Rm=function(r){try{return ku(r)}catch{return r}},ch=function(r){var c=rs(r,sh," "),u=4;try{return ku(c)}catch{for(;u;)c=rs(c,wu(u--),Rm);return c}},V_=/[!'()~]|%20/g,Qp={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Fs=function(r){return Qp[r]},is=function(r){return rs(k0(r),V_,Fs)},Vs=Hg(function(r,c){Cu(this,{type:"URLSearchParamsIterator",iterator:bc(aa(r).entries),kind:c})},"Iterator",function(){var r=bu(this),c=r.kind,u=r.iterator.next(),d=u.value;return u.done||(u.value=c==="keys"?d.key:c==="values"?d.value:[d.key,d.value]),u},!0),Du=function(r){this.entries=[],this.url=null,r!==void 0&&(xt(r)?this.parseObject(r):this.parseQuery(typeof r=="string"?F_(r,0)==="?"?Jp(r,1):r:hn(r)))};Du.prototype={type:"URLSearchParams",bindURL:function(r){this.url=r,this.update()},parseObject:function(r){var c,u,d,p,v,f,y,I=Su(r);if(I)for(u=(c=bc(r,I)).next;!(d=dt(u,c)).done;){if(v=(p=bc(Sn(d.value))).next,(f=dt(v,p)).done||(y=dt(v,p)).done||!dt(v,p).done)throw Mm("Expected sequence with length 2");sa(this.entries,{key:hn(f.value),value:hn(y.value)})}else for(var T in r)st(r,T)&&sa(this.entries,{key:T,value:hn(r[T])})},parseQuery:function(r){if(r)for(var c,u,d=Gs(r,"&"),p=0;p<d.length;)(c=d[p++]).length&&(u=Gs(c,"="),sa(this.entries,{key:ch(Na(u)),value:ch(oh(u,"="))}))},serialize:function(){for(var r,c=this.entries,u=[],d=0;d<c.length;)r=c[d++],sa(u,is(r.key)+"="+is(r.value));return oh(u,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Ou=function(){oa(this,La);var r=arguments.length>0?arguments[0]:void 0;Cu(this,new Du(r))},La=Ou.prototype;if(Qa(La,{append:function(r,c){xs(arguments.length,2);var u=aa(this);sa(u.entries,{key:hn(r),value:hn(c)}),u.updateURL()},delete:function(r){xs(arguments.length,1);for(var c=aa(this),u=c.entries,d=hn(r),p=0;p<u.length;)u[p].key===d?ah(u,p,1):p++;c.updateURL()},get:function(r){xs(arguments.length,1);for(var c=aa(this).entries,u=hn(r),d=0;d<c.length;d++)if(c[d].key===u)return c[d].value;return null},getAll:function(r){xs(arguments.length,1);for(var c=aa(this).entries,u=hn(r),d=[],p=0;p<c.length;p++)c[p].key===u&&sa(d,c[p].value);return d},has:function(r){xs(arguments.length,1);for(var c=aa(this).entries,u=hn(r),d=0;d<c.length;)if(c[d++].key===u)return!0;return!1},set:function(r,c){xs(arguments.length,1);for(var u,d=aa(this),p=d.entries,v=!1,f=hn(r),y=hn(c),I=0;I<p.length;I++)(u=p[I]).key===f&&(v?ah(p,I--,1):(v=!0,u.value=y));v||sa(p,{key:f,value:y}),d.updateURL()},sort:function(){var r=aa(this);G_(r.entries,function(c,u){return c.key>u.key?1:-1}),r.updateURL()},forEach:function(r){for(var c,u=aa(this).entries,d=Ma(r,arguments.length>1?arguments[1]:void 0),p=0;p<u.length;)d((c=u[p++]).value,c.key,this)},keys:function(){return new Vs(this,"keys")},values:function(){return new Vs(this,"values")},entries:function(){return new Vs(this,"entries")}},{enumerable:!0}),sr(La,rh,La.entries,{name:"entries"}),sr(La,"toString",function(){return aa(this).serialize()},{enumerable:!0}),Uo(Ou,"URLSearchParams"),cn({global:!0,constructor:!0,forced:!Sm},{URLSearchParams:Ou}),!Sm&&bt(ih)){var Bs=ve(ql.has),Hl=ve(ql.set),Pc=function(r){if(xt(r)){var c,u=r.body;if(Ka(u)==="URLSearchParams")return c=r.headers?new ih(r.headers):new ih,Bs(c,"content-type")||Hl(c,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Ic(r,{body:Gn(0,hn(u)),headers:Gn(0,c)})}return r};if(bt(Tm)&&cn({global:!0,enumerable:!0,noTargetGet:!0,forced:!0},{fetch:function(r){return Tm(r,arguments.length>1?Pc(arguments[1]):{})}}),bt(Au)){var uh=function(r){return oa(this,ko),new Au(r,arguments.length>1?Pc(arguments[1]):{})};ko.constructor=uh,uh.prototype=ko,cn({global:!0,constructor:!0,noTargetGet:!0,forced:!0},{Request:uh})}}var Zp={URLSearchParams:Ou,getState:aa},ef=Object.is||function(r,c){return r===c?r!==0||1/r==1/c:r!=r&&c!=c};Bl("search",function(r,c,u){return[function(d){var p=an(this),v=d==null?void 0:Ir(d,r);return v?dt(v,d,p):new RegExp(d)[r](hn(p))},function(d){var p=Sn(this),v=hn(d),f=u(c,p,v);if(f.done)return f.value;var y=p.lastIndex;ef(y,0)||(p.lastIndex=0);var I=jl(p,v);return ef(p.lastIndex,y)||(p.lastIndex=y),I===null?-1:I.index}]}),new Date().getTime();var tf=0,Yi=function(){return new Date().getTime()+tf},Cm=function(){var r=new Date;return r.setTime(Yi()),r.toLocaleString()};Bl("match",function(r,c,u){return[function(d){var p=an(this),v=d==null?void 0:Ir(d,r);return v?dt(v,d,p):new RegExp(d)[r](hn(p))},function(d){var p=Sn(this),v=hn(d),f=u(c,p,v);if(f.done)return f.value;if(!p.global)return jl(p,v);var y=p.unicode;p.lastIndex=0;for(var I,T=[],b=0;(I=jl(p,v))!==null;){var k=hn(I[0]);T[b]=k,k===""&&(p.lastIndex=nh(v,xr(p.lastIndex),y)),b++}return b===0?null:T}]});var B_=Qt("match"),$l=function(r){var c;return xt(r)&&((c=r[B_])!==void 0?!!c:hr(r)=="RegExp")},lh=RegExp.prototype,nf=function(r){var c=r.flags;return c!==void 0||"flags"in lh||st(r,"flags")||!nt(lh,r)?c:dt(Gl,r)},rf=Yn.f,bm=function(r,c,u){u in r||rf(r,u,{configurable:!0,get:function(){return c[u]},set:function(d){c[u]=d}})},dh=ta.f,Am=Tr.enforce,km=Qt("match"),os=ee.RegExp,xc=os.prototype,hh=ee.SyntaxError,wm=ve(xc.exec),Nu=ve("".charAt),Dm=ve("".replace),Fo=ve("".indexOf),Om=ve("".slice),j_=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,Uc=/a/g,js=/a/g,Pa=new os(Uc)!==Uc,Kl=Oc.MISSED_STICKY,q_=Oc.UNSUPPORTED_Y,ca=Et&&(!Pa||Kl||Fl||Tu||xe(function(){return js[km]=!1,os(Uc)!=Uc||os(js)==js||os(Uc,"i")!="/a/i"}));if(hu("RegExp",ca)){for(var as=function(r,c){var u,d,p,v,f,y,I=nt(xc,this),T=$l(r),b=c===void 0,k=[],N=r;if(!I&&T&&b&&r.constructor===as)return r;if((T||nt(xc,r))&&(r=r.source,b&&(c=nf(N))),r=r===void 0?"":hn(r),c=c===void 0?"":hn(c),N=r,Fl&&"dotAll"in Uc&&(d=!!c&&Fo(c,"s")>-1)&&(c=Dm(c,/s/g,"")),u=c,Kl&&"sticky"in Uc&&(p=!!c&&Fo(c,"y")>-1)&&q_&&(c=Dm(c,/y/g,"")),Tu&&(r=(v=function(O){for(var F,G=O.length,P=0,K="",X=[],oe={},Ce=!1,Ve=!1,je=0,Re="";P<=G;P++){if((F=Nu(O,P))==="\\")F+=Nu(O,++P);else if(F==="]")Ce=!1;else if(!Ce)switch(!0){case F==="[":Ce=!0;break;case F==="(":wm(j_,Om(O,P+1))&&(P+=2,Ve=!0),K+=F,je++;continue;case(F===">"&&Ve):if(Re===""||st(oe,Re))throw new hh("Invalid capture group name");oe[Re]=!0,X[X.length]=[Re,je],Ve=!1,Re="";continue}Ve?Re+=F:K+=F}return[K,X]}(r))[0],k=v[1]),f=Np(os(r,c),I?this:xc,as),(d||p||k.length)&&(y=Am(f),d&&(y.dotAll=!0,y.raw=as(function(O){for(var F,G=O.length,P=0,K="",X=!1;P<=G;P++)(F=Nu(O,P))!=="\\"?X||F!=="."?(F==="["?X=!0:F==="]"&&(X=!1),K+=F):K+="[\\s\\S]":K+=F+Nu(O,++P);return K}(r),u)),p&&(y.sticky=!0),k.length&&(y.groups=k)),r!==N)try{Hn(f,"source",N===""?"(?:)":N)}catch{}return f},Lu=dh(os),H_=0;Lu.length>H_;)bm(as,os,Lu[H_++]);xc.constructor=as,as.prototype=xc,sr(ee,"RegExp",as,{constructor:!0})}Iu("RegExp");var Pu=Sa.PROPER,ua=RegExp.prototype.toString,Wl=xe(function(){return ua.call({source:"a",flags:"b"})!="/a/b"}),zl=Pu&&ua.name!="toString";(Wl||zl)&&sr(RegExp.prototype,"toString",function(){var r=Sn(this);return"/"+hn(r.source)+"/"+hn(nf(r))},{unsafe:!0});var of=ve(1 .valueOf),qs=`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF`,Hs=ve("".replace),ph="["+qs+"]",w0=RegExp("^"+ph+ph+"*"),Nm=RegExp(ph+ph+"*$"),af=function(r){return function(c){var u=hn(an(c));return 1&r&&(u=Hs(u,w0,"")),2&r&&(u=Hs(u,Nm,"")),u}},Vo={start:af(1),end:af(2),trim:af(3)},Yl=ta.f,sf=ki.f,$_=Yn.f,cf=Vo.trim,ss=ee.Number,C=ss.prototype,U=ee.TypeError,q=ve("".slice),J=ve("".charCodeAt),ce=function(r){var c=bd(r,"number");return typeof c=="bigint"?c:z(c)},z=function(r){var c,u,d,p,v,f,y,I,T=bd(r,"number");if(rr(T))throw U("Cannot convert a Symbol value to a number");if(typeof T=="string"&&T.length>2){if(T=cf(T),(c=J(T,0))===43||c===45){if((u=J(T,2))===88||u===120)return NaN}else if(c===48){switch(J(T,1)){case 66:case 98:d=2,p=49;break;case 79:case 111:d=8,p=55;break;default:return+T}for(f=(v=q(T,2)).length,y=0;y<f;y++)if((I=J(v,y))<48||I>p)return NaN;return parseInt(v,d)}}return+T};if(hu("Number",!ss(" 0o1")||!ss("0b1")||ss("+0x1"))){for(var pe,ye=function(r){var c=arguments.length<1?0:ss(ce(r)),u=this;return nt(C,u)&&xe(function(){of(u)})?Np(Object(c),u,ye):c},ue=Et?Yl(ss):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),be=0;ue.length>be;be++)st(ss,pe=ue[be])&&!st(ye,pe)&&$_(ye,pe,sf(ss,pe));ye.prototype=C,C.constructor=ye,sr(ee,"Number",ye,{constructor:!0})}var He=Dd.indexOf,gt=ve([].indexOf),mt=!!gt&&1/gt([1],1,-0)<0,ot=Ul("indexOf");cn({target:"Array",proto:!0,forced:mt||!ot},{indexOf:function(r){var c=arguments.length>1?arguments[1]:void 0;return mt?gt(this,r,c)||0:He(this,r,c)}});var Zt=xe(function(){mo(1)});cn({target:"Object",stat:!0,forced:Zt,sham:!mn},{getPrototypeOf:function(r){return mo(fr(r))}});var In=!xe(function(){Reflect.apply(function(){})});cn({target:"Reflect",stat:!0,forced:In},{apply:function(r,c,u){return wa(er(r),c,Sn(u))}});var un=Sa.EXISTS,zt=Yn.f,en=Function.prototype,Pn=ve(en.toString),cr=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,ao=ve(cr.exec);Et&&!un&&zt(en,"name",{configurable:!0,get:function(){try{return ao(cr,Pn(this))[1]}catch{return""}}});var Fi=ee.Date,so=ve(Fi.prototype.getTime);cn({target:"Date",stat:!0},{now:function(){return so(new Fi)}});var Jn=ee.TypeError,Bn=function(r){if(pc(r))return r;throw Jn(ci(r)+" is not a constructor")},Hr=Qt("species"),ei=function(r,c){var u,d=Sn(r).constructor;return d===void 0||(u=Sn(d)[Hr])==null?c:Bn(u)},_t=Oc.UNSUPPORTED_Y,Rt=Math.min,me=[].push,Nn=ve(/./.exec),At=ve(me),Wn=ve("".slice);Bl("split",function(r,c,u){var d;return d="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||".".split(/()()/).length>1||"".split(/.?/).length?function(p,v){var f=hn(an(this)),y=v===void 0?4294967295:v>>>0;if(y===0)return[];if(p===void 0)return[f];if(!$l(p))return dt(c,f,p,y);for(var I,T,b,k=[],N=(p.ignoreCase?"i":"")+(p.multiline?"m":"")+(p.unicode?"u":"")+(p.sticky?"y":""),O=0,F=new RegExp(p.source,N+"g");(I=dt(Ru,F,f))&&!((T=F.lastIndex)>O&&(At(k,Wn(f,O,I.index)),I.length>1&&I.index<f.length&&wa(me,k,Vr(I,1)),b=I[0].length,O=T,k.length>=y));)F.lastIndex===I.index&&F.lastIndex++;return O===f.length?!b&&Nn(F,"")||At(k,""):At(k,Wn(f,O)),k.length>y?Vr(k,0,y):k}:"0".split(void 0,0).length?function(p,v){return p===void 0&&v===0?[]:dt(c,this,p,v)}:c,[function(p,v){var f=an(this),y=p==null?void 0:Ir(p,r);return y?dt(y,p,f,v):dt(d,hn(f),p,v)},function(p,v){var f=Sn(this),y=hn(p),I=u(d,f,y,v,d!==c);if(I.done)return I.value;var T=ei(f,RegExp),b=f.unicode,k=(f.ignoreCase?"i":"")+(f.multiline?"m":"")+(f.unicode?"u":"")+(_t?"g":"y"),N=new T(_t?"^(?:"+f.source+")":f,k),O=v===void 0?4294967295:v>>>0;if(O===0)return[];if(y.length===0)return jl(N,y)===null?[y]:[];for(var F=0,G=0,P=[];G<y.length;){N.lastIndex=_t?0:G;var K,X=jl(N,_t?Wn(y,G):y);if(X===null||(K=Rt(xr(N.lastIndex+(_t?G:0)),y.length))===F)G=nh(y,G,b);else{if(At(P,Wn(y,F,G)),P.length===O)return P;for(var oe=1;oe<=X.length-1;oe++)if(At(P,X[oe]),P.length===O)return P;G=F=K}}return At(P,Wn(y,F)),P}]},!!xe(function(){var r=/(?:)/,c=r.exec;r.exec=function(){return c.apply(this,arguments)};var u="ab".split(r);return u.length!==2||u[0]!=="a"||u[1]!=="b"}),_t);var $r,Di,Kr,Xt,tr=hr(ee.process)=="process",Oi=/(?:ipad|iphone|ipod).*applewebkit/i.test(nn),tn=ee.setImmediate,Xn=ee.clearImmediate,Rn=ee.process,co=ee.Dispatch,$n=ee.Function,fh=ee.MessageChannel,AT=ee.String,D0=0,Lm={};try{$r=ee.location}catch{}var K_=function(r){if(st(Lm,r)){var c=Lm[r];delete Lm[r],c()}},O0=function(r){return function(){K_(r)}},W_=function(r){K_(r.data)},kT=function(r){ee.postMessage(AT(r),$r.protocol+"//"+$r.host)};tn&&Xn||(tn=function(r){xs(arguments.length,1);var c=bt(r)?r:$n(r),u=Ac(arguments,1);return Lm[++D0]=function(){wa(c,void 0,u)},Di(D0),D0},Xn=function(r){delete Lm[r]},tr?Di=function(r){Rn.nextTick(O0(r))}:co&&co.now?Di=function(r){co.now(O0(r))}:fh&&!Oi?(Xt=(Kr=new fh).port2,Kr.port1.onmessage=W_,Di=Ma(Xt.postMessage,Xt)):ee.addEventListener&&bt(ee.postMessage)&&!ee.importScripts&&$r&&$r.protocol!=="file:"&&!xe(kT)?(Di=kT,ee.addEventListener("message",W_,!1)):Di="onreadystatechange"in _a("script")?function(r){Ca.appendChild(_a("script")).onreadystatechange=function(){Ca.removeChild(this),K_(r)}}:function(r){setTimeout(O0(r),0)});var Pm,Jl,xm,gh,N0,L0,P0,mh,wT={set:tn,clear:Xn},DT=/ipad|iphone|ipod/i.test(nn)&&ee.Pebble!==void 0,z_=/web0s(?!.*chrome)/i.test(nn),x0=ki.f,U0=wT.set,vh=ee.MutationObserver||ee.WebKitMutationObserver,OT=ee.document,G0=ee.process,Um=ee.Promise,Y_=x0(ee,"queueMicrotask"),J_=Y_&&Y_.value;J_||(Pm=function(){var r,c;for(tr&&(r=G0.domain)&&r.exit();Jl;){c=Jl.fn,Jl=Jl.next;try{c()}catch(u){throw Jl?gh():xm=void 0,u}}xm=void 0,r&&r.enter()},Oi||tr||z_||!vh||!OT?!DT&&Um&&Um.resolve?((P0=Um.resolve(void 0)).constructor=Um,mh=Ma(P0.then,P0),gh=function(){mh(Pm)}):tr?gh=function(){G0.nextTick(Pm)}:(U0=Ma(U0,ee),gh=function(){U0(Pm)}):(N0=!0,L0=OT.createTextNode(""),new vh(Pm).observe(L0,{characterData:!0}),gh=function(){L0.data=N0=!N0}));var Gm=J_||function(r){var c={fn:r,next:void 0};xm&&(xm.next=c),Jl||(Jl=c,gh()),xm=c},Fm=function(r){try{return{error:!1,value:r()}}catch(c){return{error:!0,value:c}}},NT=function(){this.head=null,this.tail=null};NT.prototype={add:function(r){var c={item:r,next:null};this.head?this.tail.next=c:this.head=c,this.tail=c},get:function(){var r=this.head;if(r)return this.head=r.next,this.tail===r&&(this.tail=null),r.item}};var X_,F0,$s,Vm=NT,Ji=ee.Promise,LT=typeof window=="object"&&typeof Deno!="object",PT=(Ji&&Ji.prototype,Qt("species")),xu=!1,Bm=bt(ee.PromiseRejectionEvent),Uu={CONSTRUCTOR:hu("Promise",function(){var r=ac(Ji),c=r!==String(Ji);if(!c&&Ge===66)return!0;if(Ge>=51&&/native code/.test(r))return!1;var u=new Ji(function(p){p(1)}),d=function(p){p(function(){},function(){})};return(u.constructor={})[PT]=d,!(xu=u.then(function(){})instanceof d)||!c&&LT&&!Bm}),REJECTION_EVENT:Bm,SUBCLASSING:xu},V=function(r){var c,u;this.promise=new r(function(d,p){if(c!==void 0||u!==void 0)throw TypeError("Bad Promise constructor");c=d,u=p}),this.resolve=er(c),this.reject=er(u)},Gu={f:function(r){return new V(r)}},Ii=wT.set,xT=Uu.CONSTRUCTOR,Nb=Uu.REJECTION_EVENT,Lb=Uu.SUBCLASSING,Xl=Tr.getterFor("Promise"),UT=Tr.set,_h=Ji&&Ji.prototype,Ql=Ji,Q_=_h,Ks=ee.TypeError,gr=ee.document,Ln=ee.process,Gc=Gu.f,Br=Gc,Yt=!!(gr&&gr.createEvent&&ee.dispatchEvent),Ke=function(r){var c;return!(!xt(r)||!bt(c=r.then))&&c},uf=function(r,c){var u,d,p,v=c.value,f=c.state==1,y=f?r.ok:r.fail,I=r.resolve,T=r.reject,b=r.domain;try{y?(f||(c.rejection===2&&qm(c),c.rejection=1),y===!0?u=v:(b&&b.enter(),u=y(v),b&&(b.exit(),p=!0)),u===r.promise?T(Ks("Promise-chain cycle")):(d=Ke(u))?dt(d,u,I,T):I(u)):T(v)}catch(k){b&&!p&&b.exit(),T(k)}},Fc=function(r,c){r.notified||(r.notified=!0,Gm(function(){for(var u,d=r.reactions;u=d.get();)uf(u,r);r.notified=!1,c&&!r.rejection&&jm(r)}))},GT=function(r,c,u){var d,p;Yt?((d=gr.createEvent("Event")).promise=c,d.reason=u,d.initEvent(r,!1,!0),ee.dispatchEvent(d)):d={promise:c,reason:u},!Nb&&(p=ee["on"+r])?p(d):r==="unhandledrejection"&&function(v,f){var y=ee.console;y&&y.error&&(arguments.length==1?y.error(v):y.error(v,f))}("Unhandled promise rejection",u)},jm=function(r){dt(Ii,ee,function(){var c,u=r.facade,d=r.value;if(V0(r)&&(c=Fm(function(){tr?Ln.emit("unhandledRejection",d,u):GT("unhandledrejection",u,d)}),r.rejection=tr||V0(r)?2:1,c.error))throw c.value})},V0=function(r){return r.rejection!==1&&!r.parent},qm=function(r){dt(Ii,ee,function(){var c=r.facade;tr?Ln.emit("rejectionHandled",c):GT("rejectionhandled",c,r.value)})},Fu=function(r,c,u){return function(d){r(c,d,u)}},Bo=function(r,c,u){r.done||(r.done=!0,u&&(r=u),r.value=c,r.state=2,Fc(r,!0))},Z_=function(r,c,u){if(!r.done){r.done=!0,u&&(r=u);try{if(r.facade===c)throw Ks("Promise can't be resolved itself");var d=Ke(c);d?Gm(function(){var p={done:!1};try{dt(d,c,Fu(Z_,p,r),Fu(Bo,p,r))}catch(v){Bo(p,v,r)}}):(r.value=c,r.state=1,Fc(r,!1))}catch(p){Bo({done:!1},p,r)}}};if(xT&&(Q_=(Ql=function(r){oa(this,Q_),er(r),dt(X_,this);var c=Xl(this);try{r(Fu(Z_,c),Fu(Bo,c))}catch(u){Bo(c,u)}}).prototype,(X_=function(r){UT(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new Vm,rejection:!1,state:0,value:void 0})}).prototype=sr(Q_,"then",function(r,c){var u=Xl(this),d=Gc(ei(this,Ql));return u.parent=!0,d.ok=!bt(r)||r,d.fail=bt(c)&&c,d.domain=tr?Ln.domain:void 0,u.state==0?u.reactions.add(d):Gm(function(){uf(d,u)}),d.promise}),F0=function(){var r=new X_,c=Xl(r);this.promise=r,this.resolve=Fu(Z_,c),this.reject=Fu(Bo,c)},Gu.f=Gc=function(r){return r===Ql||r===void 0?new F0(r):Br(r)},bt(Ji)&&_h!==Object.prototype)){$s=_h.then,Lb||sr(_h,"then",function(r,c){var u=this;return new Ql(function(d,p){dt($s,u,d,p)}).then(r,c)},{unsafe:!0});try{delete _h.constructor}catch{}hi&&hi(_h,Q_)}cn({global:!0,constructor:!0,wrap:!0,forced:xT},{Promise:Ql}),Uo(Ql,"Promise",!1),Iu("Promise");var B0=Uu.CONSTRUCTOR||!Zg(function(r){Ji.all(r).then(void 0,function(){})});cn({target:"Promise",stat:!0,forced:B0},{all:function(r){var c=this,u=Gu.f(c),d=u.resolve,p=u.reject,v=Fm(function(){var f=er(c.resolve),y=[],I=0,T=1;Dp(r,function(b){var k=I++,N=!1;T++,dt(f,c,b).then(function(O){N||(N=!0,y[k]=O,--T||d(y))},p)}),--T||d(y)});return v.error&&p(v.value),u.promise}});var cs=Uu.CONSTRUCTOR,j0=Ji&&Ji.prototype;if(cn({target:"Promise",proto:!0,forced:cs,real:!0},{catch:function(r){return this.then(void 0,r)}}),bt(Ji)){var FT=_r("Promise").prototype.catch;j0.catch!==FT&&sr(j0,"catch",FT,{unsafe:!0})}cn({target:"Promise",stat:!0,forced:B0},{race:function(r){var c=this,u=Gu.f(c),d=u.reject,p=Fm(function(){var v=er(c.resolve);Dp(r,function(f){dt(v,c,f).then(u.resolve,d)})});return p.error&&d(p.value),u.promise}}),cn({target:"Promise",stat:!0,forced:Uu.CONSTRUCTOR},{reject:function(r){var c=Gu.f(this);return dt(c.reject,void 0,r),c.promise}});var q0=Uu.CONSTRUCTOR;_r("Promise"),cn({target:"Promise",stat:!0,forced:q0},{resolve:function(r){return function(c,u){if(Sn(c),xt(u)&&u.constructor===c)return u;var d=Gu.f(c);return(0,d.resolve)(u),d.promise}(this,r)}});var ey=Vo.trim,VT=ve("".charAt),yh=ee.parseFloat,H0=ee.Symbol,Hm=H0&&H0.iterator,$0=1/yh(qs+"-0")!=-1/0||Hm&&!xe(function(){yh(Object(Hm))})?function(r){var c=ey(hn(r)),u=yh(c);return u===0&&VT(c,0)=="-"?-0:u}:yh;cn({global:!0,forced:parseFloat!=$0},{parseFloat:$0});var Ws,vo,Lt=window.navigator&&window.navigator.userAgent||"",$m=/AppleWebKit\/([\d.]+)/i.exec(Lt),Zl=($m&&parseFloat($m.pop()),/iPad/i.test(Lt)),ty=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/Macintosh/.test(Lt),ny=/iPhone/i.test(Lt)&&!Zl,K0=/iPod/i.test(Lt),Sh=ny||Zl||K0||ty,ed=/Android/i.test(Lt);ed&&function(){var r=Lt.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!r)return null;var c=r[1]&&parseFloat(r[1]),u=r[2]&&parseFloat(r[2]);return c&&u?parseFloat(r[1]+"."+r[2]):c||null}();var Vc=(ed&&/webkit/i.test(Lt),/Firefox/i.test(Lt)),ry=Vc&&function(){var r=Lt.match(/Firefox\/(\d+)/);return r&&r[1]?parseFloat(r[1]):null}(),Km=/Edge\//i.test(Lt),W0=Km&&function(){var r=Lt.match(/Edge\/(\d+)/i);if(r&&r[1])return r[1]}(),xa=/Edg\//i.test(Lt),z0=xa&&function(){var r=Lt.match(/Edg\/(\d+)/);return r&&r[1]?parseFloat(r[1]):null}(),iy=/SogouMobileBrowser\//i.test(Lt),wo=iy&&function(){var r=Lt.match(/SogouMobileBrowser\/(\d+)/);return r&&r[1]?parseFloat(r[1]):null}(),Ih=/MetaSr\s/i.test(Lt),BT=Ih&&function(){var r=Lt.match(/MetaSr(\s\d+(\.\d+)+)/);return r&&r[1]?parseFloat(r[1]):null}(),Vu=/TBS\/\d+/i.test(Lt),Mt=Vu&&function(){var r=Lt.match(/TBS\/(\d+)/i);if(r&&r[1])return r[1]}(),Y0=/XWEB\/\d+/i.test(Lt),jT=Y0&&function(){var r=Lt.match(/XWEB\/(\d+)/i);if(r&&r[1])return r[1]}(),oy=(/MSIE\s8\.0/.test(Lt),/MSIE\/\d+/i.test(Lt)&&function(){var r=/MSIE\s(\d+)\.\d/.exec(Lt),c=r&&parseFloat(r[1]);!c&&/Trident\/7.0/i.test(Lt)&&/rv:11.0/.test(Lt)&&(c=11)}(),/(micromessenger|webbrowser)/i.test(Lt)),qT=oy&&function(){var r=Lt.match(/MicroMessenger\/(\d+)/i);if(r&&r[1])return r[1]}(),J0=!Vu&&/MQQBrowser\/\d+/i.test(Lt)&&/COVC\/\d+/i.test(Lt),lf=!Vu&&/MQQBrowser\/\d+/i.test(Lt)&&!/COVC\/\d+/i.test(Lt),jo=(lf||J0)&&function(){var r=Lt.match(/ MQQBrowser\/([\d.]+)/);return r&&r[1]?r[1]:null}(),ay=!Vu&&/ QQBrowser\/\d+/i.test(Lt),Pb=ay&&function(){var r=Lt.match(/ QQBrowser\/([\d.]+)/);return r&&r[1]?r[1]:null}(),sy=!Vu&&/QQBrowserLite\/\d+/i.test(Lt),us=sy&&function(){var r=Lt.match(/QQBrowserLite\/([\d.]+)/);return r&&r[1]?r[1]:null}(),Bc=!Vu&&/MQBHD\/\d+/i.test(Lt),td=Bc&&function(){var r=Lt.match(/MQBHD\/([\d.]+)/);return r&&r[1]?r[1]:null}(),X0=/Windows/i.test(Lt),cy=!Sh&&/MAC OS X/i.test(Lt),df=!ed&&/Linux/i.test(Lt),HT=(/MicroMessenger/i.test(Lt),/UCBrowser/i.test(Lt)),jc=(/Electron/i.test(Lt),/MiuiBrowser/i.test(Lt)),$T=jc&&function(){var r=Lt.match(/MiuiBrowser\/([\d.]+)/);return r&&r[1]?r[1]:null}(),Q0=/HuaweiBrowser/i.test(Lt),uy=/Huawei/i.test(Lt),Bu=Q0&&function(){var r=Lt.match(/HuaweiBrowser\/([\d.]+)/);return r&&r[1]?r[1]:null}(),Eh=/SamsungBrowser/i.test(Lt),Z0=Eh&&function(){var r=Lt.match(/SamsungBrowser\/([\d.]+)/);return r&&r[1]?r[1]:null}(),hf=/HeyTapBrowser/i.test(Lt),xb=hf&&function(){var r=Lt.match(/HeyTapBrowser\/([\d.]+)/);return r&&r[1]?r[1]:null}(),pf=/VivoBrowser/i.test(Lt),eI=pf&&function(){var r=Lt.match(/VivoBrowser\/([\d.]+)/);return r&&r[1]?r[1]:null}(),ff=function(){var r=Lt.match(/Chrome\/(\d+)/);return r&&r[1]?Number(r[1]):null},ly=/Chrome/i.test(Lt),gf=!Km&&!Ih&&!iy&&!Vu&&!Y0&&!xa&&!ay&&!jc&&!Q0&&!Eh&&!hf&&!pf&&/Chrome/i.test(Lt),tI=gf&&ff(),KT=gf&&function(){var r=Lt.match(/Chrome\/([\d.]+)/);return r&&r[1]?r[1]:null}(),Th=!ly&&!lf&&!J0&&!sy&&!Bc&&/Safari/i.test(Lt),Wm=function(){if(Th){var r=Lt.match(/Version\/([\d.]+)/);if(r&&r[1])return r[1]}return""}(),Ub=/Android.*(wv|.0.0.0)/.test(Lt),zm=function(){if(ty)return Wm;if(Sh){var r=Lt.match(/OS (\d+)_(\d+)/i);if(r&&r[1]){var c=r[1];return r[2]&&(c+=".".concat(r[2])),c}}return""}(),dy=Wm==="15.1",ls=zm==="15.1",Mh=(Ws=Number(zm.split(".")[0]))===14||Ws===13,Rh=location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1",qc=function(){if(kt(vo))try{vo=window.localStorage}catch(r){Bt.warn(r),vo=!1}return vo},nI=new Map([[Vc,["Firefox",ry]],[xa,["Edg",z0]],[gf,["Chrome",KT]],[Th,["Safari",Wm]],[Vu,["TBS",Mt]],[Y0,["XWEB",jT]],[oy&&ny,["WeChat",qT]],[ay,["QQ(Win)",Pb]],[lf,["QQ(Mobile)",jo]],[J0,["QQ(Mobile X5)",jo]],[sy,["QQ(Mac)",us]],[Bc,["QQ(iPad)",td]],[jc,["MI",$T]],[Q0,["HW",Bu]],[Eh,["Samsung",Z0]],[hf,["OPPO",xb]],[pf,["VIVO",eI]],[Km,["EDGE",W0]],[iy,["SogouMobile",wo]],[Ih,["Sogou",BT]]]);function Ch(){var r="unknown",c="unknown";return nI.get(!0)&&(r=nI.get(!0)[0],c=nI.get(!0)[1]),{name:r,version:c}}var Gb=xe(function(){_u(1)});cn({target:"Object",stat:!0,forced:Gb},{keys:function(r){return _u(fr(r))}});var Fb="canvas",ln="audio",An="video",Xi="auxiliary",ju="smallVideo",bh="user",rI="environment",Tt="mute",Pt="unmute",Mr="ended",pi="playing",nd="pause",Ah="error",iI="loadeddata",mf="audioinput",oI="videoinput",WT="detail",zT="text",ti="main",kh="backup",zs="banned",qu="kick",fi="user_time_out",Ei="room_disband",Vi="sei-message",pn="wss://trtc.rtc.qq.com",ni="wss://webrtc.qq.com",gi="qcloud",ri="trtc",Vt="webrtc",ir="",ds="jssdk_log",aI="jssdk_event",wh="jssdk_new_endreport",Ym=function(r){return ir=r},YT=1,sI=2,rd=20,Ua=21,uo="5Y2wZK8nANNAoVw6dSAHVjNxrD1ObBM2kBPV",Hu="224d130c-7b5c-415b-aaa2-79c2eb5a6df2",hy=2,kr=ti,Ni=Xi,Ur="DISCONNECTED",vf="CONNECTING",Ti="RECONNECTING",_o="CONNECTED",JT="new",Jm="connecting",XT="failed",py="closed",QT="disconnected",fy="connected",cI="completed",uI="join",ZT="delta-join",lI="rejoin",eM="leave",tM="delta-leave",dI="publish",nM="delta-publish",hI="unpublish",pI="subscribe",gy="unsubscribe",fI="uplink-connection",gI="uplink-reconnection",mI="downlink-connection",vI="downlink-reconnection",vy="setLocalDescription",_I="setRemoteDescription",yI="iceConnectionState",_f="stream-initialize",Xm="websocketConnectionState",SI="websocketReconnectionState",II="update-stream",EI="recover-subscription",TI="start-mix-transcode",MI="stop-mix-transcode",RI="player-error",CI="schedule",bI="load-worklet",_y="unsubscribe",yy="subscribe_change",Sy={MANUAL:"manual",PRESET_LAYOUT:"preset-layout"},AI={REMOTE:"$PLACE_HOLDER_REMOTE$"},kI={IT_AUDIO_VIDEO:0,IT_PICTURE:2,IT_CANVAS:3,IT_PURE_AUDIO:4,IT_PURE_VIDEO:5},Xr="string",Wr="number",la="boolean",rM="array",$u="object",Ku="add",id="remove",Iy={unknown:0,wifi:1,"4g":2,"3g":3,"2g":4,wired:5},wI=-1,yf=0,iM=1,oM="schedule.rtc.qq.com",aM="schedule.rtc.qcloud.com",sM="intl-schedule.rtc.qq.com",cM="intl-schedule.rtc.qcloud.com",uM="TRTC",lM="Client",Ey="LocalStream",Ty="RemoteStream",dM="Stream",DI="web.sdk.qcloud.com",hM="web.sdk.tencent.cn",pM="web.sdk.cloud.tencent.cn",Dh="https://".concat(DI,"/trtc/webrtc/doc"),My="".concat(Dh,"/zh-cn/"),Ga={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,NONE:5},Wu=Object.keys(Ga),fM=["normal leave","timeout leave","kick","role change"],Vb=/"/g,Bb=ve("".replace),Ry=function(r,c,u,d){var p=hn(an(r)),v="<"+c;return u!==""&&(v+=" "+u+'="'+Bb(hn(d),Vb,"&quot;")+'"'),v+">"+p+"</"+c+">"},gM=function(r){return xe(function(){var c=""[r]('"');return c!==c.toLowerCase()||c.split('"').length>3})};cn({target:"String",proto:!0,forced:gM("link")},{link:function(r){return Ry(this,"a","href",r)}}),cn({target:"Array",stat:!0},{isArray:dc});var mM="AVOID_REPEATED_CALL",vM="INVALID_PARAMETER_REQUIRED",OI="INVALID_PARAMETER_TYPE",jb="INVALID_PARAMETER_EMPTY",NI="INVALID_PARAMETER_INSTANCE",qb="INVALID_PARAMETER_RANGE",Hb="API_CALL_TIMEOUT",_M="SIGNAL_CHANNEL_RECONNECTION_FAILED",yM="SIGNAL_CHANNEL_SETUP_FAILED",SM="ERROR_MESSAGE",IM="EXCHANGE_SDP_TIMEOUT",EM="DOWNLINK_RECONNECTION_FAILED",TM="EXCHANGE_SDP_FAILED",MM="UPLINK_RECONNECTION_FAILED",RM="AUDIO",We="VIDEO",at="INVALID_PURE_AUDIO",LI="INVALID_STREAMID",PI="INVALID_USER_DEFINE_RECORDID",Qm="INVALID_USER_DEFINE_PUSH_ARGS",Zm="INVALID_PROXY",ev="INVALID_JOIN",Oh="INVALID_ROOMID_STRING",qo="INVALID_ROOMID_INTEGER",Sf="JOIN_ROOM_TIMEOUT",If="JOIN_ROOM_FAILED",tv="REJOIN_ROOM_FAILED",$b="INVALID_DESTROY",Kb="INVALID_PUBLISH",CM="INVALID_UNPUBLISH",Wb="INVALID_AUDIENCE",ht="INVALID_INITIALIZE",yt="INVALID_DUPLICATE_PUBLISHING",xI="INVALID_REMOTE_STREAM",zb="SUBSCRIBE_FAILED",Yb="INVALID_ROLE",bM="INVALID_OPERATION_SWITCH_ROLE",Jb="SWITCH_ROLE_TIMEOUT",UI="SWITCH_ROLE_FAILED",Xb="CLIENT_BANNED",GI="INVALID_OPERATION_START_PUBLISH_CDN",Ef="INVALID_OPERATION_STOP_PUBLISH_CDN",AM="INVALID_STREAM_ID",kM="START_PUBLISH_CDN_FAILED",Tf="STOP_PUBLISH_CDN_FAILED",Qb="START_MIX_TRANSCODE",wM="STOP_MIX_TRANSCODE",DM="INVALID_AUDIO_VOLUME",OM="ENABLE_SMALL_STREAM_PUBLISHED",Zb="DISABLE_SMALL_STREAM_PUBLISHED",Mf="NOT_SUPPORTED_SMALL_STREAM",FI="INVALID_SMALL_STREAM_PROFILE",NM="INVALID_PARAMETER_REMOTE_STREAM",LM="INVALID_SWITCH_DEVICE",od="INVALID_SWITCH_DEVICE_PUBLISHING",VI="INVALID_REPLACE_TRACK",eA="INVALID_INITIALIZE_LOCAL_STREAM",tA="INVALID_ADD_TRACK_REPETITIVE",PM="INVALID_ADD_TRACK_REMOVING",nA="INVALID_ADD_TRACK_PUBLISHING",xM="INVALID_STREAM_INITIALIZED",rA="INVALID_ADD_TRACK_NUMBER",BI="INVALID_REMOVE_AUDIO_TRACK",iA="INVALID_REMOVE_AUDIO_ADDING",oA="INVALID_REMOVE_AUDIO_ON",jI="INVALID_REMOVE_TRACK_PUBLISHING",aA="INVALID_REMOVE_TRACK_NOT_PUBLISHING",UM="INVALID_REMOVE_TRACK_NUMBER",Ys="INVALID_REMOVE_TRACK_NOT_PUBLISHED",sA="REPEAT_JOIN",Cy="CLIENT_DESTROYED",by="START_MIX_TRANSCODE_FAILED",nv="STOP_MIX_TRANSCODE_FAILED",qI="MIX_TRANSCODE_NOT_STARTED",GM="CANNOT_LESS_THAN_ZERO",cA="MIX_PARAMS_VIDEO_FRAMERATE",uA="MIX_PARAMS_VIDEO_GOP",FM="MIX_PARAMS_AUDIO_BITRATE",lA="MIX_PARAMS_USER_Z_ORDER",dA="MIX_PARAMS_NOT_SELF",VM="MIX_PARAMS_USER_STREAM",Nh="INVALID_ELEMENT_ID",HI="INVALID_ELEMENT_ID_TYPE",hA="INVALID_CREATE_STREAM_SOURCE",BM="INVALID_CREATE_STREAM_SCREEN",jM="INVALID_CREATE_STREAM_AUDIO",pA="INVALID_CREATE_STREAM_SCREEN_AUDIO",qM="NOT_SUPPORTED_HTTP",$I="NOT_SUPPORTED_WEBRTC",fA="NOT_SUPPORTED_PROFILE",HM="NOT_SUPPORTED_H264ENCODE",KI="NOT_SUPPORTED_H264DECODE",gA="NOT_SUPPORTED_REPLACE_TRACK",mA="NOT_SUPPORTED_CAPTURE",vA="MICROPHONE_NOT_FOUND",$M="CAMERA_NOT_FOUND",Ay="SIGNAL_RESPONSE_FAILED",KM="CATCH_HANDLER_ERROR",ky="API_NOT_EXIST",rv="STREAM_UNSUBSCRIBED",_A="SUBSCRIBE_ALL_FALSE",WM="SEI_NOT_SUPPORT",zM="SEI_DISABLED",WI="SEI_EMPTY",hs="SEI_OVERSIZE",YM="SEI_BEFORE_PUBLISH",yA="SEI_NOT_VIDEO",SA="CALL_FREQUENCY_LIMIT",ad={AVOID_REPEATED_CALL:function(r){return"previous ".concat(r.name,"() is ongoing, please avoid repeated calls.")},INVALID_PARAMETER_REQUIRED:function(r){var c=r.key,u=r.rule,d=r.fnName,p=r.value;return"'".concat(c||u.name,"' is a required param when calling ").concat(d,"(), received: ").concat(p,".")},INVALID_PARAMETER_TYPE:function(r){var c=r.key,u=r.rule,d=r.fnName,p=r.value,v="".concat(c||u.name),f="";return f=Array.isArray(u.type)?u.type.join("|"):u.type,"'".concat(v,"' must be type of ").concat(f," when calling ").concat(d,"(), received type: ").concat(ps(p),".")},INVALID_PARAMETER_EMPTY:function(r){var c=r.key,u=r.rule,d=r.fnName,p=r.value;return"'".concat(c||u.name,"' cannot be '").concat(p,"' when calling ").concat(d,"().")},INVALID_PARAMETER_INSTANCE:function(r){var c=r.key,u=r.rule,d=r.fnName,p=r.value,v="".concat(c||u.name),f="".concat(u.instanceOf.name||u.instanceOf);return"'".concat(v,"' must be instanceof ").concat(f," when calling ").concat(d,"(), received type: ").concat(ps(p),".")},INVALID_PARAMETER_RANGE:function(r){var c=r.key,u=r.rule,d=r.fnName,p=r.value;return"'".concat(c||u.name,"' must be one of ").concat(u.values.join("|")," when calling ").concat(d,"(), received: ").concat(p,".")},API_CALL_TIMEOUT:function(r){return"".concat(r.commandDesc||r.command," timeout observed.")},SIGNAL_CHANNEL_RECONNECTION_FAILED:"signal channel reconnection failed, please check your network.",SIGNAL_CHANNEL_SETUP_FAILED:function(r){return"SignalChannel setup failure: (errorCode: ".concat(r.errorCode,", errorMsg: ").concat(r.errorMsg," }).")},ERROR_MESSAGE:function(r){var c="".concat(r.type," failed");return r.message&&(c="".concat(c,": ").concat(r.message,".")),c},EXCHANGE_SDP_TIMEOUT:"exchange sdp timeout.",DOWNLINK_RECONNECTION_FAILED:"downlink reconnection failed, please check your network and re-join room.",EXCHANGE_SDP_FAILED:function(r){return"exchange sdp failed ".concat(r.errMsg,".")},UPDATE_OFFER_TIMEOUT:"update offer timeout observed.",UPLINK_RECONNECTION_FAILED:"uplink reconnection failed, please check your network and publish again.",AUDIO:function(r){return r.error.toString()+" <audio>"},VIDEO:function(r){return r.error.toString()+" <video>"},INVALID_RECORDID:"recordId must be an integer number.",INVALID_PURE_AUDIO:"pureAudioPushMode must be 1 or 2.",INVALID_STREAMID:"streamId must be a sting literal within 64 bytes, and not be empty.",INVALID_USER_DEFINE_RECORDID:"userDefineRecordId must be a sting literal contains (a-zA-Z),(0-9), underline and hyphen, within 64 bytes, and not be empty.",INVALID_USER_DEFINE_PUSH_ARGS:"userDefinePushArgs must be a sting literal within 256 bytes, and not be empty.",INVALID_PROXY:'proxy server url must start with "wss://".',INVALID_JOIN:"duplicate join() called.",INVALID_ROOMID_STRING:function(r){return"'".concat(r,"' must be validate string when useStringRoomId is true.")},INVALID_ROOMID_INTEGER:function(r){return"'".concat(r,"' must be an integer between [1, 4294967294] when useStringRoomId is false.")},INVALID_SIGNAL_CHANNEL:"SignalChannel is not ready yet.",JOIN_ROOM_TIMEOUT:"join room timeout.",JOIN_ROOM_FAILED:function(r){var c=r.error,u=r.code;return"Failed to join room - ".concat(c," code: ").concat(u)},REJOIN_ROOM_FAILED:function(r){return"reJoin room: ".concat(r.roomId," failed, please check your network.")},INVALID_DESTROY:"please call leave() before destroy().",INVALID_PUBLISH:"please call join() before publish().",INVALID_UNPUBLISH:"stream has not been published yet.",INVALID_AUDIENCE:"no permission to publish() under live/".concat("audience",', please call switchRole("').concat("anchor",'") firstly before publish().'),INVALID_INITIALIZE:"cannot publish stream because stream is not initialized or is switching device.",INVALID_DUPLICATE_PUBLISHING:"duplicate publishing, please unpublish and then re-publish.",INVALID_SUBSCRIBE_UNDEFINED:"stream is undefined or null.",INVALID_SUBSCRIBE_LOCAL:"stream cannot be LocalStream.",INVALID_REMOTE_STREAM:"remoteStream does not exist because it has been unpublished by remote peer.",SUBSCRIBE_FAILED:function(r){var c=r.message,u=r.stream;return"failed to subscribe ".concat(u.getUserId()," ").concat(u.getType()," stream, reason: ").concat(c,".")},INVALID_ROLE:"switchRole can only be called in live mode.",INVALID_PARAMETER_SWITCH_ROLE:"role could only be set to a value as ".concat("anchor"," or ").concat("audience","."),INVALID_OPERATION_SWITCH_ROLE:"please call join() before switchRole().",SWITCH_ROLE_TIMEOUT:"switchRole timeout.",SWITCH_ROLE_FAILED:function(r){return"switchRole failed, errCode: ".concat(r.code," errMsg: ").concat(r.message,".")},CLIENT_BANNED:function(r){return"client was banned because of "+r.message+"."},INVALID_OPERATION_START_PUBLISH_CDN:"please call startPublishCDNStream() after join room and publish the local stream.",INVALID_OPERATION_STOP_PUBLISH_CDN:"please call startPublishCDNStream() before stopPublishCDNStream().",START_PUBLISH_CDN_FAILED:function(r){return"startPublishCDNStream failed, errMsg: ".concat(r.message,".")},STOP_PUBLISH_CDN_FAILED:function(r){return"stopPublishCDNStream failed, errMsg: ".concat(r.message,".")},INVALID_STREAM_ID:function(r){return"'".concat(r,"' can only consist of uppercase and lowercase english letters (a-zA-Z), numbers (0-9), hyphens and underscores.")},START_MIX_TRANSCODE:"please call startMixTranscode() after join().",STOP_MIX_TRANSCODE:"please call stopMixTranscode() after startMixTranscode().",INVALID_AUDIO_VOLUME:"interval must be a number.",ENABLE_SMALL_STREAM_PUBLISHED:"Cannot enable small stream after localStream published.",DISABLE_SMALL_STREAM_PUBLISHED:"Cannot disable small stream after localStream published.",NOT_SUPPORTED_SMALL_STREAM:"your browser does not support opening small stream.",INVALID_SMALL_STREAM_PROFILE:"small stream profile is invalid.",INVALID_PARAMETER_REMOTE_STREAM:"remoteStream is invalid.",INVALID_OPERATION_CHANGE_SMALL:"cannot switch to the small stream without subscribing to the video of remoteStream.",REMOTE_NOT_PUBLISH_SMALL_STREAM:"remote peer does not publish small stream.",INVALID_SWITCH_DEVICE:"cannot switch device on current stream.",INVALID_SWITCH_DEVICE_PUBLISHING:"cannot switch device when publishing localStream.",INVALID_REPLACE_TRACK:"cannot replace track when publishing localStream.",INVALID_INITIALIZE_LOCAL_STREAM:"local stream has not initialized yet.",INVALID_ADD_TRACK_REPETITIVE:"previous addTrack is ongoing, please avoid repetitive execution.",INVALID_ADD_TRACK_REMOVING:"cannot add track when a track is removing.",INVALID_ADD_TRACK_PUBLISHING:"cannot add track when publishing localStream.",INVALID_STREAM_INITIALIZED:"your local stream haven't been initialized yet.",INVALID_ADD_TRACK_NUMBER:"a Stream has at most one audio track and one video track.",INVALID_REMOVE_AUDIO_TRACK:"remove audio track is not supported.",INVALID_REMOVE_AUDIO_ADDING:"cannot remove track when a track is adding.",INVALID_REMOVE_AUDIO_ON:"previous removeTrack is ongoing, please avoid repetitive execution.",INVALID_REMOVE_TRACK_PUBLISHING:"cannot remove track when publishing localStream.",INVALID_REMOVE_TRACK_NOT_PUBLISHING:"the track to be removed is not being publishing.",INVALID_REMOVE_TRACK_NUMBER:"remove the only video track is not supported, please use replaceTrack or muteVideo.",INVALID_REMOVE_TRACK_NOT_PUBLISHED:function(r){return"try to replace ".concat(r.kind," track but there's no previous ").concat(r.kind," being published.")},START_MIX_TRANSCODE_FAILED:function(r){return"startMixTranscode failed, errMsg: ".concat(r.message,".")},STOP_MIX_TRANSCODE_FAILED:function(r){return"stopMixTranscode failed, errMsg: ".concat(r.message,".")},MIX_TRANSCODE_NOT_STARTED:"mixTranscode has not been started.",CANNOT_LESS_THAN_ZERO:function(r){var c=r.key,u=r.rule,d=r.fnName;return r.value,"'".concat(c||u.name,"' cannot be less than 0 when calling ").concat(d,"().")},MIX_PARAMS_VIDEO_FRAMERATE:"'config.videoFramerate' should be an integer between 0 and 30, excluding 0.",MIX_PARAMS_VIDEO_GOP:"'config.videoGOP' should be an integer between 1 and 8.",MIX_PARAMS_AUDIO_BITRATE:"'config.audioBitrate' should be an integer between 32 and 192.",MIX_PARAMS_USER_Z_ORDER:function(r){return"'".concat(r,"' is required and must be between 1 and 15.")},MIX_PARAMS_NOT_SELF:"'config.mixUsers' must contain self.",MIX_PARAMS_USER_STREAM:"'config.videoWidth' and 'config.videoHeight' of output stream should be contain all mix stream.",INVALID_PLAY:"duplicate play() call observed, please stop() firstly.",INVALID_ELEMENT_ID:function(r){var c=r.key,u=r.fnName;return"'".concat(c,"' is not found in the document object when calling ").concat(u,"().")},INVALID_ELEMENT_ID_TYPE:function(r){var c=r.key,u=r.fnName,d=r.type;return"the element corresponding to '".concat(c,"' must be instanceof HTMLDivElement when calling ").concat(u,"(), received: ").concat(d,".")},INVALID_USERID:"userId cannot be all spaces.",INVALID_CREATE_STREAM_SOURCE:"LocalStream must be created by createStream() with either audio/video or audioSource/videoSource, but can not be mixed with audio/video and audioSource/videoSource.",INVALID_CREATE_STREAM_SCREEN:"screen/video cannot be both true.",INVALID_CREATE_STREAM_AUDIO:"audio/screenAudio cannot be both true.",INVALID_CREATE_STREAM_SCREEN_AUDIO:"when screen is true, screenAudio can be configured.",NOT_SUPPORTED_HTTP:"http protocol does not support the ability to capture and publish streams, please use the https protocol.",NOT_SUPPORTED_WEBRTC:"your browser or environment does not support full WebRTC capabilities.",NOT_SUPPORTED_PROFILE:"your browser does not support setVideoProfile.",NOT_SUPPORTED_MEDIA:"your browser or environment does not support navigator.mediaDevices.",NOT_SUPPORTED_H264ENCODE:"your device does not support H.264 encoding.",NOT_SUPPORTED_H264DECODE:"your device does not support H.264 decoding.",NOT_SUPPORTED_REPLACE_TRACK:"replaceTrack is not supported in this browser, please use switchDevice or addTrack instead.",NOT_SUPPORTED_CAPTURE:"Your browser or environment does not support screen sharing, please check whether the browser version.",MICROPHONE_NOT_FOUND:"no microphone detected, please check your microphone and the configuration on TRTC.createStream.",CAMERA_NOT_FOUND:"no camera detected, please check your camera and the configuration on TRTC.createStream.",SIGNAL_RESPONSE_FAILED:function(r){return"".concat(r.signalResponse," failed, response code is ").concat(r.code," , errMsg: ").concat(r.message,".")},CATCH_HANDLER_ERROR:function(r){var c=r.name,u=r.event;return"an error was caught on ".concat(c,".on('").concat(u,"', handler), please check your code on 'handler'.")},API_NOT_EXIST:function(r){var c=r.name;return"experimental api ".concat(c," does not exist.")},REPEAT_JOIN:function(r){return"[".concat(r,"] is calling client.join api or has already joined room, please avoid repeated join.")},STREAM_UNSUBSCRIBED:"stream has been unsubscribed, please call client.unsubscribe after last client.subscribe finished.",SUBSCRIBE_ALL_FALSE:"cannot subscribe when both audio & video are false, use client.unsubscribe() instead",CLIENT_DESTROYED:function(r){var c=r.funName;return"failed to call ".concat(c,"() because client was destroyed.")},SEI_NOT_SUPPORT:function(r){return"not support to sendSEIMessage".concat(r===!1?" without using h264 codec":"")},SEI_DISABLED:"SEI is disabled, to enable SEI: TRTC.createClient({ enableSEI: true })",SEI_EMPTY:"buffer cannot be empty",SEI_OVERSIZE:function(r){return"buffer size(".concat(r,") is over 1000 Bytes")},SEI_BEFORE_PUBLISH:"please call sendSEIMessage() after publish() success",SEI_NOT_VIDEO:"cannot send sei when localStream has not video.",CALL_FREQUENCY_LIMIT:function(r){var c=r.isSize,u=r.name,d=r.timesInSecond,p=r.maxSizeInSecond;return"api ".concat(u," call ").concat(c?"size":"times"," is over ").concat(c?p+" bytes":d," in a second.")}},iv=function(r,c){return c?Dh+"/"+r+"/"+c:Dh+"/"+r+"/index.html"},IA=function(){if(!qc())return!1;var r=localStorage.getItem("trtc_error_assistance");r&&!function(c){var u=c.saveTime&&new Date().getTime()-c.saveTime>=6048e5,d=!c.saveVersion||c.saveVersion!=="4.14.0";return u||d}(JSON.parse(r))||(Bt.info("init debug info"),function(){var c=new XMLHttpRequest;if(c.open("GET","https://web.sdk.qcloud.com/trtc/webrtc/download/error-message/0.0.2/script.js",!1),c.send(null),c.readyState===4&&c.status===200){var u=document.createElement("script");u.type="text/javascript",u.text=c.responseText,document.body.appendChild(u),localStorage.setItem("trtc_error_assistance",JSON.stringify({message:c.responseText,saveTime:new Date().getTime(),saveVersion:"4.14.0"})),document.body.removeChild(u)}}())};function rt(r){var c=r.key,u=r.data,d=r.link,p=r.addDocLink,v=p===void 0||p,f="",y="",I="";da(ad[c])?f=ad[c](u):yo(ad[c])&&(f=ad[c]);var T=function(){if(window.TRTC_ERROR_INFO&&window.TRTC_ERROR_LINK)return{TRTC_ERROR_INFO:window.TRTC_ERROR_INFO,TRTC_ERROR_LINK:window.TRTC_ERROR_LINK};var O=localStorage.getItem("trtc_error_assistance");if(O){O=JSON.parse(O);var F=document.createElement("script");F.type="text/javascript",F.text=O.message,document.body.appendChild(F);var G=window.TRTC_ERROR_INFO,P=window.TRTC_ERROR_LINK;return document.body.removeChild(F),{TRTC_ERROR_INFO:G,TRTC_ERROR_LINK:P}}return{}}(),b=T.TRTC_ERROR_INFO,k=T.TRTC_ERROR_LINK;d?I="".concat(d.className,".html#").concat(d.fnName):k&&k[c]&&(I=k[c]);var N=f;return Ph()&&(b&&b[c]&&(da(b[c])?y=b[c](u):yo(b[c])&&(y=b[c])),y&&(N=v?y+`
\u8BF7\u67E5\u770B\u6587\u6863: `+iv("zh-cn",I)+`

`:y+`

`,N+=f)),v&&(N+=` 
Refer to: `+iv("en",I)+`
`),N}var Rf=function(){return function(r){var c=window.location.search.match(new RegExp("(\\?|&)"+r+"=([^&]*)(&|$)"));return c?decodeURIComponent(c[2]):""}("trtc_env")},wy=function(r){return(r=Number(r))>0&&r<14e8},Lh=function(r,c){var u;u=ir||(wy(r)?"https://videoapi-sgp.im.qcloud.com":"https://yun.tim.qq.com");var d=Math.floor(Math.random()*Math.pow(2,31));return"".concat(u,"/v5/AVQualityReportSvc/C2S?random=").concat(d,"&sdkappid=").concat(r,"&cmdtype=").concat(c)};function zI(){var r=navigator.userAgent,c=navigator.connection,u=r.match(/NetType\/\w+/)?r.match(/NetType\/\w+/)[0]:"";(u=u.toLowerCase().replace("nettype/",""))==="3gnet"&&(u="3g");var d=c&&c.type&&c.type.toLowerCase(),p=c&&c.effectiveType&&c.effectiveType.toLowerCase();p==="slow-2"&&(p="2g");var v=u||"unknown";if(d)switch(d){case"cellular":case"wimax":v=p||"unknown";break;case"wifi":v="wifi";break;case"ethernet":v="wired";break;case"none":case"other":case"unknown":v="unknown"}return v}var sd=function(r){if(!r||R(r)!=="object"||Object.prototype.toString.call(r)!="[object Object]")return!1;var c=Object.getPrototypeOf(r);if(c===null)return!0;var u=Object.prototype.hasOwnProperty.call(c,"constructor")&&c.constructor;return typeof u=="function"&&u instanceof u&&Function.prototype.toString.call(u)===Function.prototype.toString.call(Object)};function Ho(r){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return r<=1?u:Ho(r-1,u,c+u)}function Fa(r){var c=Math.round(r/2)+1;return c>6?13e3:1e3*Ho(c)}var da=function(r){return typeof r=="function"},kt=function(r){return r===void 0},yo=function(r){return typeof r=="string"},ha=function(r){return typeof r=="number"},YI=function(r){return typeof r=="boolean"},JM=function(r){return ps(r)==="array"},XM=function(r){return ps(r)==="MediaStreamTrack".toLowerCase()};function ps(r){return Reflect.apply(Object.prototype.toString,r,[]).replace(/^\[object\s(\w+)\]$/,"$1").toLowerCase()}function ov(r){var c={};return c.urls="turn:".concat(r.url),kt(r.username)||kt(r.credential)||(c.username=r.username,c.credential=r.credential,c.credentialType="password",kt(r.credentialType)||(c.credentialType=r.credentialType)),c}function So(){return performance&&performance.now?Math.floor(performance.now()):Date.now()}function Dy(r){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"big";if(!yo(r))return 0;var u=r.split(".");return c==="big"?(Number(u[0])<<24|Number(u[1])<<16|Number(u[2])<<8|Number(u[3]))>>>0:(Number(u[3])<<24|Number(u[2])<<16|Number(u[1])<<8|Number(u[0]))>>>0}var JI,av,Ph=function(){var r=navigator.language||navigator.userLanguage;return(r=r.substr(0,2))==="zh"},QM=(JI=!1,av=document.visibilityState,function(){document.visibilityState!==av&&Bt.info("visibility change: ".concat(document.visibilityState)),JI||(document.addEventListener("visibilitychange",function(){Bt.info("visibility change: "+document.visibilityState),av=document.visibilityState}),JI=!0)});window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;var ZM=function(){var r;return function(){return r||(r=new window.AudioContext,r.onstatechange=function(){Bt.info("gain context state: ".concat(r.state)),r.state==="suspended"?(r.resume(),document.addEventListener("click",r.resume)):r.state==="interrupted"?r.resume():document.removeEventListener("click",r.resume)},r)}}(),eR=!!window.AudioWorkletNode,tR=function(r,c){var u=r.emit;return r.emit=function(){for(var d=arguments.length,p=new Array(d),v=0;v<d;v++)p[v]=arguments[v];try{u.apply(r,p)}catch(y){var f=rt({key:KM,data:{name:c,event:p[0]},addDocLink:!1});Bt.warn(f+`

`+y.stack)}},r},nR=function(r){return+r<10?"0".concat(r):r},EA=function(r){var c=r.match(/^\d+\.\d+\.\d+/)[0];if(!c)return r;var u=c.split("."),d=nR(u[1])+nR(u[2]);return u[1]-15>0&&(u[1]="15"),u[2]-15>0&&(u[2]="15"),u.join(".")+"."+d},rR=function(r,c){return function(){for(var u=new Array(arguments.length),d=0;d<u.length;d++)u[d]=arguments[d];return r.apply(c,u)}},Hc=Object.prototype.toString;function sv(r){return Hc.call(r)==="[object Array]"}function Oy(r){return r===void 0}function XI(r){return r!==null&&typeof r=="object"}function Ny(r){return Hc.call(r)==="[object Function]"}function Js(r,c){if(r!=null)if(typeof r!="object"&&(r=[r]),sv(r))for(var u=0,d=r.length;u<d;u++)c.call(null,r[u],u,r);else for(var p in r)Object.prototype.hasOwnProperty.call(r,p)&&c.call(null,r[p],p,r)}var Cn={isArray:sv,isArrayBuffer:function(r){return Hc.call(r)==="[object ArrayBuffer]"},isBuffer:function(r){return r!==null&&!Oy(r)&&r.constructor!==null&&!Oy(r.constructor)&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)},isFormData:function(r){return typeof FormData<"u"&&r instanceof FormData},isArrayBufferView:function(r){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(r):r&&r.buffer&&r.buffer instanceof ArrayBuffer},isString:function(r){return typeof r=="string"},isNumber:function(r){return typeof r=="number"},isObject:XI,isUndefined:Oy,isDate:function(r){return Hc.call(r)==="[object Date]"},isFile:function(r){return Hc.call(r)==="[object File]"},isBlob:function(r){return Hc.call(r)==="[object Blob]"},isFunction:Ny,isStream:function(r){return XI(r)&&Ny(r.pipe)},isURLSearchParams:function(r){return typeof URLSearchParams<"u"&&r instanceof URLSearchParams},isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:Js,merge:function r(){var c={};function u(v,f){typeof c[f]=="object"&&typeof v=="object"?c[f]=r(c[f],v):c[f]=v}for(var d=0,p=arguments.length;d<p;d++)Js(arguments[d],u);return c},deepMerge:function r(){var c={};function u(v,f){typeof c[f]=="object"&&typeof v=="object"?c[f]=r(c[f],v):c[f]=typeof v=="object"?r({},v):v}for(var d=0,p=arguments.length;d<p;d++)Js(arguments[d],u);return c},extend:function(r,c,u){return Js(c,function(d,p){r[p]=u&&typeof d=="function"?rR(d,u):d}),r},trim:function(r){return r.replace(/^\s*/,"").replace(/\s*$/,"")}};function Cf(r){return encodeURIComponent(r).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var QI=function(r,c,u){if(!c)return r;var d;if(u)d=u(c);else if(Cn.isURLSearchParams(c))d=c.toString();else{var p=[];Cn.forEach(c,function(f,y){f!=null&&(Cn.isArray(f)?y+="[]":f=[f],Cn.forEach(f,function(I){Cn.isDate(I)?I=I.toISOString():Cn.isObject(I)&&(I=JSON.stringify(I)),p.push(Cf(y)+"="+Cf(I))}))}),d=p.join("&")}if(d){var v=r.indexOf("#");v!==-1&&(r=r.slice(0,v)),r+=(r.indexOf("?")===-1?"?":"&")+d}return r};function Ly(){this.handlers=[]}Ly.prototype.use=function(r,c){return this.handlers.push({fulfilled:r,rejected:c}),this.handlers.length-1},Ly.prototype.eject=function(r){this.handlers[r]&&(this.handlers[r]=null)},Ly.prototype.forEach=function(r){Cn.forEach(this.handlers,function(c){c!==null&&r(c)})};var Py=Ly,xy=function(r,c,u){return Cn.forEach(u,function(d){r=d(r,c)}),r},Uy=function(r){return!(!r||!r.__CANCEL__)},Gy=typeof rc<"u"?rc:typeof self<"u"?self:typeof window<"u"?window:{};function ZI(){throw new Error("setTimeout has not been defined")}function Fy(){throw new Error("clearTimeout has not been defined")}var zu=ZI,Yu=Fy;function cv(r){if(zu===setTimeout)return setTimeout(r,0);if((zu===ZI||!zu)&&setTimeout)return zu=setTimeout,setTimeout(r,0);try{return zu(r,0)}catch{try{return zu.call(null,r,0)}catch{return zu.call(this,r,0)}}}typeof Gy.setTimeout=="function"&&(zu=setTimeout),typeof Gy.clearTimeout=="function"&&(Yu=clearTimeout);var $c,Xs=[],cd=!1,bf=-1;function eE(){cd&&$c&&(cd=!1,$c.length?Xs=$c.concat(Xs):bf=-1,Xs.length&&tE())}function tE(){if(!cd){var r=cv(eE);cd=!0;for(var c=Xs.length;c;){for($c=Xs,Xs=[];++bf<c;)$c&&$c[bf].run();bf=-1,c=Xs.length}$c=null,cd=!1,function(u){if(Yu===clearTimeout)return clearTimeout(u);if((Yu===Fy||!Yu)&&clearTimeout)return Yu=clearTimeout,clearTimeout(u);try{Yu(u)}catch{try{return Yu.call(null,u)}catch{return Yu.call(this,u)}}}(r)}}function Vy(r,c){this.fun=r,this.array=c}Vy.prototype.run=function(){this.fun.apply(null,this.array)};function fs(){}var Kc=fs,iR=fs,xh=fs,Ju=fs,nE=fs,Af=fs,By=fs,Io=Gy.performance||{},oR=Io.now||Io.mozNow||Io.msNow||Io.oNow||Io.webkitNow||function(){return new Date().getTime()},aR=new Date,jy={nextTick:function(r){var c=new Array(arguments.length-1);if(arguments.length>1)for(var u=1;u<arguments.length;u++)c[u-1]=arguments[u];Xs.push(new Vy(r,c)),Xs.length!==1||cd||cv(tE)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:Kc,addListener:iR,once:xh,off:Ju,removeListener:nE,removeAllListeners:Af,emit:By,binding:function(r){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(r){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(r){var c=.001*oR.call(Io),u=Math.floor(c),d=Math.floor(c%1*1e9);return r&&(u-=r[0],(d-=r[1])<0&&(u--,d+=1e9)),[u,d]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-aR)/1e3}},qy=function(r,c){Cn.forEach(r,function(u,d){d!==c&&d.toUpperCase()===c.toUpperCase()&&(r[c]=u,delete r[d])})},kf=function(r,c,u,d,p){return function(v,f,y,I,T){return v.config=f,y&&(v.code=y),v.request=I,v.response=T,v.isAxiosError=!0,v.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},v}(new Error(r),c,u,d,p)},TA=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],sR=Cn.isStandardBrowserEnv()?function(){var r,c=/(msie|trident)/i.test(navigator.userAgent),u=document.createElement("a");function d(p){var v=p;return c&&(u.setAttribute("href",v),v=u.href),u.setAttribute("href",v),{href:u.href,protocol:u.protocol?u.protocol.replace(/:$/,""):"",host:u.host,search:u.search?u.search.replace(/^\?/,""):"",hash:u.hash?u.hash.replace(/^#/,""):"",hostname:u.hostname,port:u.port,pathname:u.pathname.charAt(0)==="/"?u.pathname:"/"+u.pathname}}return r=d(window.location.href),function(p){var v=Cn.isString(p)?d(p):p;return v.protocol===r.protocol&&v.host===r.host}}():function(){return!0},MA=Cn.isStandardBrowserEnv()?{write:function(r,c,u,d,p,v){var f=[];f.push(r+"="+encodeURIComponent(c)),Cn.isNumber(u)&&f.push("expires="+new Date(u).toGMTString()),Cn.isString(d)&&f.push("path="+d),Cn.isString(p)&&f.push("domain="+p),v===!0&&f.push("secure"),document.cookie=f.join("; ")},read:function(r){var c=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return c?decodeURIComponent(c[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},cR=function(r){return new Promise(function(c,u){var d=r.data,p=r.headers;Cn.isFormData(d)&&delete p["Content-Type"];var v=new XMLHttpRequest;if(r.auth){var f=r.auth.username||"",y=r.auth.password||"";p.Authorization="Basic "+btoa(f+":"+y)}var I,T,b=(I=r.baseURL,T=r.url,I&&!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(T)?function(O,F){return F?O.replace(/\/+$/,"")+"/"+F.replace(/^\/+/,""):O}(I,T):T);if(v.open(r.method.toUpperCase(),QI(b,r.params,r.paramsSerializer),!0),v.timeout=r.timeout,v.onreadystatechange=function(){if(v&&v.readyState===4&&(v.status!==0||v.responseURL&&v.responseURL.indexOf("file:")===0)){var O="getAllResponseHeaders"in v?function(G){var P,K,X,oe={};return G&&Cn.forEach(G.split(`
`),function(Ce){if(X=Ce.indexOf(":"),P=Cn.trim(Ce.substr(0,X)).toLowerCase(),K=Cn.trim(Ce.substr(X+1)),P){if(oe[P]&&TA.indexOf(P)>=0)return;oe[P]=P==="set-cookie"?(oe[P]?oe[P]:[]).concat([K]):oe[P]?oe[P]+", "+K:K}}),oe}(v.getAllResponseHeaders()):null,F={data:r.responseType&&r.responseType!=="text"?v.response:v.responseText,status:v.status,statusText:v.statusText,headers:O,config:r,request:v};(function(G,P,K){var X=K.config.validateStatus;!X||X(K.status)?G(K):P(kf("Request failed with status code "+K.status,K.config,null,K.request,K))})(c,u,F),v=null}},v.onabort=function(){v&&(u(kf("Request aborted",r,"ECONNABORTED",v)),v=null)},v.onerror=function(){u(kf("Network Error",r,null,v)),v=null},v.ontimeout=function(){var O="timeout of "+r.timeout+"ms exceeded";r.timeoutErrorMessage&&(O=r.timeoutErrorMessage),u(kf(O,r,"ECONNABORTED",v)),v=null},Cn.isStandardBrowserEnv()){var k=MA,N=(r.withCredentials||sR(b))&&r.xsrfCookieName?k.read(r.xsrfCookieName):void 0;N&&(p[r.xsrfHeaderName]=N)}if("setRequestHeader"in v&&Cn.forEach(p,function(O,F){d===void 0&&F.toLowerCase()==="content-type"?delete p[F]:v.setRequestHeader(F,O)}),Cn.isUndefined(r.withCredentials)||(v.withCredentials=!!r.withCredentials),r.responseType)try{v.responseType=r.responseType}catch(O){if(r.responseType!=="json")throw O}typeof r.onDownloadProgress=="function"&&v.addEventListener("progress",r.onDownloadProgress),typeof r.onUploadProgress=="function"&&v.upload&&v.upload.addEventListener("progress",r.onUploadProgress),r.cancelToken&&r.cancelToken.promise.then(function(O){v&&(v.abort(),u(O),v=null)}),d===void 0&&(d=null),v.send(d)})},RA={"Content-Type":"application/x-www-form-urlencoded"};function Hy(r,c){!Cn.isUndefined(r)&&Cn.isUndefined(r["Content-Type"])&&(r["Content-Type"]=c)}var $y={adapter:function(){var r;return(typeof XMLHttpRequest<"u"||jy!==void 0&&Object.prototype.toString.call(jy)==="[object process]")&&(r=cR),r}(),transformRequest:[function(r,c){return qy(c,"Accept"),qy(c,"Content-Type"),Cn.isFormData(r)||Cn.isArrayBuffer(r)||Cn.isBuffer(r)||Cn.isStream(r)||Cn.isFile(r)||Cn.isBlob(r)?r:Cn.isArrayBufferView(r)?r.buffer:Cn.isURLSearchParams(r)?(Hy(c,"application/x-www-form-urlencoded;charset=utf-8"),r.toString()):Cn.isObject(r)?(Hy(c,"application/json;charset=utf-8"),JSON.stringify(r)):r}],transformResponse:[function(r){if(typeof r=="string")try{r=JSON.parse(r)}catch{}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Cn.forEach(["delete","get","head"],function(r){$y.headers[r]={}}),Cn.forEach(["post","put","patch"],function(r){$y.headers[r]=Cn.merge(RA)});var uR=$y;function uv(r){r.cancelToken&&r.cancelToken.throwIfRequested()}var rE=function(r){return uv(r),r.headers=r.headers||{},r.data=xy(r.data,r.headers,r.transformRequest),r.headers=Cn.merge(r.headers.common||{},r.headers[r.method]||{},r.headers),Cn.forEach(["delete","get","head","post","put","patch","common"],function(c){delete r.headers[c]}),(r.adapter||uR.adapter)(r).then(function(c){return uv(r),c.data=xy(c.data,c.headers,r.transformResponse),c},function(c){return Uy(c)||(uv(r),c&&c.response&&(c.response.data=xy(c.response.data,c.response.headers,r.transformResponse))),Promise.reject(c)})},lv=function(r,c){c=c||{};var u={},d=["url","method","params","data"],p=["headers","auth","proxy"],v=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];Cn.forEach(d,function(I){c[I]!==void 0&&(u[I]=c[I])}),Cn.forEach(p,function(I){Cn.isObject(c[I])?u[I]=Cn.deepMerge(r[I],c[I]):c[I]!==void 0?u[I]=c[I]:Cn.isObject(r[I])?u[I]=Cn.deepMerge(r[I]):r[I]!==void 0&&(u[I]=r[I])}),Cn.forEach(v,function(I){c[I]!==void 0?u[I]=c[I]:r[I]!==void 0&&(u[I]=r[I])});var f=d.concat(p).concat(v),y=Object.keys(c).filter(function(I){return f.indexOf(I)===-1});return Cn.forEach(y,function(I){c[I]!==void 0?u[I]=c[I]:r[I]!==void 0&&(u[I]=r[I])}),u};function Uh(r){this.defaults=r,this.interceptors={request:new Py,response:new Py}}Uh.prototype.request=function(r){typeof r=="string"?(r=arguments[1]||{}).url=arguments[0]:r=r||{},(r=lv(this.defaults,r)).method?r.method=r.method.toLowerCase():this.defaults.method?r.method=this.defaults.method.toLowerCase():r.method="get";var c=[rE,void 0],u=Promise.resolve(r);for(this.interceptors.request.forEach(function(d){c.unshift(d.fulfilled,d.rejected)}),this.interceptors.response.forEach(function(d){c.push(d.fulfilled,d.rejected)});c.length;)u=u.then(c.shift(),c.shift());return u},Uh.prototype.getUri=function(r){return r=lv(this.defaults,r),QI(r.url,r.params,r.paramsSerializer).replace(/^\?/,"")},Cn.forEach(["delete","get","head","options"],function(r){Uh.prototype[r]=function(c,u){return this.request(Cn.merge(u||{},{method:r,url:c}))}}),Cn.forEach(["post","put","patch"],function(r){Uh.prototype[r]=function(c,u,d){return this.request(Cn.merge(d||{},{method:r,url:c,data:u}))}});var wf=Uh;function Ky(r){this.message=r}Ky.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},Ky.prototype.__CANCEL__=!0;var dv=Ky;function Df(r){if(typeof r!="function")throw new TypeError("executor must be a function.");var c;this.promise=new Promise(function(d){c=d});var u=this;r(function(d){u.reason||(u.reason=new dv(d),c(u.reason))})}Df.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Df.source=function(){var r;return{token:new Df(function(c){r=c}),cancel:r}};var Bi=Df;function Wt(r){var c=new wf(r),u=rR(wf.prototype.request,c);return Cn.extend(u,wf.prototype,c),Cn.extend(u,c),u}var Qi=Wt(uR);Qi.Axios=wf,Qi.create=function(r){return Wt(lv(Qi.defaults,r))},Qi.Cancel=dv,Qi.CancelToken=Bi,Qi.isCancel=Uy,Qi.all=function(r){return Promise.all(r)},Qi.spread=function(r){return function(c){return r.apply(null,c)}};var Wy=Qi,lR=Qi;Wy.default=lR;var hv=Wy,Wc=vt(function(r){var c=Object.prototype.hasOwnProperty,u="~";function d(){}function p(I,T,b){this.fn=I,this.context=T,this.once=b||!1}function v(I,T,b,k,N){if(typeof b!="function")throw new TypeError("The listener must be a function");var O=new p(b,k||I,N),F=u?u+T:T;return I._events[F]?I._events[F].fn?I._events[F]=[I._events[F],O]:I._events[F].push(O):(I._events[F]=O,I._eventsCount++),I}function f(I,T){--I._eventsCount==0?I._events=new d:delete I._events[T]}function y(){this._events=new d,this._eventsCount=0}Object.create&&(d.prototype=Object.create(null),new d().__proto__||(u=!1)),y.prototype.eventNames=function(){var I,T,b=[];if(this._eventsCount===0)return b;for(T in I=this._events)c.call(I,T)&&b.push(u?T.slice(1):T);return Object.getOwnPropertySymbols?b.concat(Object.getOwnPropertySymbols(I)):b},y.prototype.listeners=function(I){var T=u?u+I:I,b=this._events[T];if(!b)return[];if(b.fn)return[b.fn];for(var k=0,N=b.length,O=new Array(N);k<N;k++)O[k]=b[k].fn;return O},y.prototype.listenerCount=function(I){var T=u?u+I:I,b=this._events[T];return b?b.fn?1:b.length:0},y.prototype.emit=function(I,T,b,k,N,O){var F=u?u+I:I;if(!this._events[F])return!1;var G,P,K=this._events[F],X=arguments.length;if(K.fn){switch(K.once&&this.removeListener(I,K.fn,void 0,!0),X){case 1:return K.fn.call(K.context),!0;case 2:return K.fn.call(K.context,T),!0;case 3:return K.fn.call(K.context,T,b),!0;case 4:return K.fn.call(K.context,T,b,k),!0;case 5:return K.fn.call(K.context,T,b,k,N),!0;case 6:return K.fn.call(K.context,T,b,k,N,O),!0}for(P=1,G=new Array(X-1);P<X;P++)G[P-1]=arguments[P];K.fn.apply(K.context,G)}else{var oe,Ce=K.length;for(P=0;P<Ce;P++)switch(K[P].once&&this.removeListener(I,K[P].fn,void 0,!0),X){case 1:K[P].fn.call(K[P].context);break;case 2:K[P].fn.call(K[P].context,T);break;case 3:K[P].fn.call(K[P].context,T,b);break;case 4:K[P].fn.call(K[P].context,T,b,k);break;default:if(!G)for(oe=1,G=new Array(X-1);oe<X;oe++)G[oe-1]=arguments[oe];K[P].fn.apply(K[P].context,G)}}return!0},y.prototype.on=function(I,T,b){return v(this,I,T,b,!1)},y.prototype.once=function(I,T,b){return v(this,I,T,b,!0)},y.prototype.removeListener=function(I,T,b,k){var N=u?u+I:I;if(!this._events[N])return this;if(!T)return f(this,N),this;var O=this._events[N];if(O.fn)O.fn!==T||k&&!O.once||b&&O.context!==b||f(this,N);else{for(var F=0,G=[],P=O.length;F<P;F++)(O[F].fn!==T||k&&!O[F].once||b&&O[F].context!==b)&&G.push(O[F]);G.length?this._events[N]=G.length===1?G[0]:G:f(this,N)}return this},y.prototype.removeAllListeners=function(I){var T;return I?(T=u?u+I:I,this._events[T]&&f(this,T)):(this._events=new d,this._eventsCount=0),this},y.prototype.off=y.prototype.removeListener,y.prototype.addListener=y.prototype.on,y.prefixed=u,y.EventEmitter=y,r.exports=y}),Me=new Wc,zc=1,iE=2,En=3,Le=4,Of=5,zy=20,Nf=21,pv=22,Yy=23,Lf=24,Yc=27,Jy=28,Xy=29,dR=30,oE=33,hR=31,Qy=32,CA=100,aE=101,fv=102,gs=103,ji=110,Pf=111,gv=112,Xu=113,Qu=114,bA=115,mv=116,sE=120,cE=121,xf=122,uE=123,Gh=130,lE=131,Zu=132,Zy=133,Uf=134,dE=135,hE=136,pE=137,fE=200,gE=201,mE=300,vv=301,eS=302,vE=303;function Gf(r){var c=r.retryFunction,u=r.settings,d=r.onError,p=r.onRetrying,v=r.context;return function(){for(var f=this,y=arguments.length,I=new Array(y),T=0;T<y;T++)I[T]=arguments[T];var b=u.retries||5,k=0,N=-1,O=0,F=function(){var G=D(regeneratorRuntime.mark(function P(K,X){var oe,Ce,Ve,je;return regeneratorRuntime.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return Re.prev=0,oe=v||f,Re.next=4,c.apply(oe,I);case 4:Ce=Re.sent,k=0,K(Ce),Re.next=14;break;case 9:Re.prev=9,Re.t0=Re.catch(0),Ve=function(){clearTimeout(N),k=0,O=2,X(Re.t0)},je=function(){O!==2&&k<b?(k++,O=1,da(p)&&p(k,Ve),N=setTimeout(function(){N=-1,F(K,X)},kt(u.timeout)?1e3:u.timeout)):Ve()},da(d)?d(Re.t0,je,X):je();case 14:case"end":return Re.stop()}},P,null,[[0,9]])}));return function(P,K){return G.apply(this,arguments)}}();return new Promise(F)}}var AA=B(function r(c){x(this,r),this.log=c.log,this.level=c.level,this.userId=c.userId,this.sdkAppId=c.sdkAppId,this.forAllJoinedClients=c.forAllJoinedClients,this.uploaded=!1}),kA=function(){function r(c){x(this,r),this.id_=c.id,this.userId_=c.userId,this.sdkAppId_=c.sdkAppId,this.type_=c.type,this.isLocal_=!YI(c.isLocal)||c.isLocal}return B(r,[{key:"setUserId",value:function(c){this.userId_=c}},{key:"setSdkAppId",value:function(c){this.sdkAppId_=c}},{key:"log",value:function(c,u){Bt.log({log:"[".concat(this.isLocal_?"":"*").concat(this.id_,"] ").concat(this.type_?this.type_+" ":"").concat(u),level:c,forAllJoinedClients:kt(this.userId_),userId:this.userId_,sdkAppId:this.sdkAppId_})}},{key:"info",value:function(c){this.log(Ga.INFO,c)}},{key:"debug",value:function(c){this.log(Ga.DEBUG,c)}},{key:"warn",value:function(c){this.log(Ga.WARN,c)}},{key:"error",value:function(c){this.log(Ga.ERROR,c)}}]),r}(),Bt=new(function(){function r(){var d=this;x(this,r),this.clients_=new Set,this.queue_=[],this.timeoutId_=-1,this.logLevel_=Ga.DEBUG,this.logLevelToUpload_=Ga.INFO,this.enableUploadLog_=!0,this.isAbleToUpload_=!1,this.startUpload(),this.checkURLParam(),Me.on(dR,function(p){var v=p.client;return d.clients_.add(v)}),Me.on(oE,function(p){var v=p.client;return d.clients_.delete(v)}),Me.on(hR,function(p){p&&sd(p.config)&&Wu[p.config.logLevelToUpload]&&(d.logLevelToUpload_=p.config.logLevelToUpload)}),Me.on(Le,this.setIsAbleToUpload,this),Me.on(Of,this.setIsAbleToUpload,this)}var c,u;return B(r,[{key:"getIsAbleToUpload",value:function(){return this.isAbleToUpload_}},{key:"setIsAbleToUpload",value:function(){this.isAbleToUpload_=!0,Me.off(Le,this.setIsAbleToUpload,this),Me.off(Of,this.setIsAbleToUpload,this)}},{key:"startUpload",value:(u=D(regeneratorRuntime.mark(function d(){var p=this;return regeneratorRuntime.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.prev=0,v.next=3,this.upload();case 3:v.next=7;break;case 5:v.prev=5,v.t0=v.catch(0);case 7:this.timeoutId_=setTimeout(function(){return p.startUpload()},2e3);case 8:case"end":return v.stop()}},d,this,[[0,5]])})),function(){return u.apply(this,arguments)})},{key:"stopUpload",value:function(){this.timeoutId_!==-1&&(clearTimeout(this.timeoutId_),this.timeoutId_=-1)}},{key:"getLogsToUpload",value:function(){var d=this,p={map:new Map,splicedQueue:[]};if(this.queue_[0].forAllJoinedClients&&this.clients_.size===0)return p;for(var v=0,f=function(){if(v===50)return"break";var y=d.queue_[v];y.forAllJoinedClients?d.clients_.forEach(function(I){if(I.getIsJoined()){var T=I.getUserId(),b=I.getSDKAppId();p.map.has(T)?p.map.get(T).logs.push(y):p.map.set(T,{userId:T,sdkAppId:b,logs:[y]})}}):p.map.has(y.userId)?p.map.get(y.userId).logs.push(y):p.map.set(y.userId,{userId:y.userId,sdkAppId:y.sdkAppId,logs:[y]})};v<this.queue_.length&&f()!=="break";v++);return p.map.size>0&&(p.splicedQueue=this.queue_.splice(0,v)),p}},{key:"upload",value:(c=D(regeneratorRuntime.mark(function d(){var p,v,f,y,I,T,b,k,N,O;return regeneratorRuntime.wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(this.queue_.length!==0&&this.isAbleToUpload_){F.next=2;break}return F.abrupt("return");case 2:if(p=this.getLogsToUpload(),v=p.map,f=p.splicedQueue,v.size!==0){F.next=5;break}return F.abrupt("return");case 5:F.prev=5,y=de(v.values()),I=0;case 8:if(!(I<y.length)){F.next=16;break}return T=y[I],b=T.userId,k=T.sdkAppId,N=T.logs,F.next=12,this.uploadLogWithRetry(JSON.stringify({timestamp:Cm(),sdkAppId:String(k),userId:b,version:"4.14.0",log:N.map(function(G){return G.log}).join(`
`)}),k);case 12:N.forEach(function(G){return G.uploaded=!0});case 13:I++,F.next=8;break;case 16:F.next=20;break;case 18:F.prev=18,F.t0=F.catch(5);case 20:(O=f.filter(function(G){return!G.uploaded})).length>0&&(this.queue_=O.concat(this.queue_));case 22:case"end":return F.stop()}},d,this,[[5,18]])})),function(){return c.apply(this,arguments)})},{key:"uploadLogWithRetry",value:function(d,p){return Gf({retryFunction:function(){return hv.post(Lh(p,ds),d,{timeout:5e3})},settings:{retries:3,timeout:1e3},onError:function(v,f){f()}})()}},{key:"getPrefix",value:function(d){var p=new Date;return p.setTime(Yi()),"[".concat(p.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1"),":").concat(p.getMilliseconds(),"] <").concat(Wu[d],">")}},{key:"getLogLevel",value:function(){return this.logLevel_}},{key:"setLogLevel",value:function(d){kt(Wu[d])||(this.logLevel_!==d&&this.info("setLogLevel ".concat(d)),this.logLevel_=d)}},{key:"enableUploadLog",value:function(){this.enableUploadLog_=!0}},{key:"disableUploadLog",value:function(){this.enableUploadLog_=!1}},{key:"log",value:function(d){var p=d.log,v=d.level,f=d.forAllJoinedClients,y=f===void 0||f,I=d.userId,T=d.sdkAppId;if(p="".concat(this.getPrefix(v)," ").concat(p),this.enableUploadLog_&&v>=this.logLevelToUpload_&&this.queue_.push(new AA({log:p,level:v,userId:I,sdkAppId:T,forAllJoinedClients:y})),!(v<this.logLevel_)){var b=Wu[v]?Wu[v].toLowerCase():"info";console[b]("%cTRTC:%c%s","padding: 1px 4px;border-radius: 3px;color: #fff;background: #1E88E5;","display: inline",p)}}},{key:"debug",value:function(d){this.log({log:d,level:Ga.DEBUG})}},{key:"info",value:function(d){this.log({log:d,level:Ga.INFO})}},{key:"warn",value:function(d){this.log({log:d,level:Ga.WARN})}},{key:"error",value:function(d){this.log({log:d,level:Ga.ERROR})}},{key:"createLogger",value:function(d){return new kA(d)}},{key:"checkURLParam",value:function(){var d=new URLSearchParams(location.search).get("logLevelToUpload");Wu[d]&&(this.logLevelToUpload_=d)}}]),r}()),pR=!0,wA=Math.floor,fR=Number.isInteger||function(r){return!xt(r)&&isFinite(r)&&wA(r)===r};cn({target:"Number",stat:!0},{isInteger:fR});var _E,gR=ee.TypeError,mR=function(r){if($l(r))throw gR("The method doesn't accept regular expressions");return r},DA=Qt("match"),vR=function(r){var c=/./;try{"/./"[r](c)}catch{try{return c[DA]=!1,"/./"[r](c)}catch{}}return!1},_R=ki.f,yR=ve("".startsWith),OA=ve("".slice),NA=Math.min,SR=vR("startsWith"),LA=!(SR||(_E=_R(String.prototype,"startsWith"),!_E||_E.writable));cn({target:"String",proto:!0,forced:!LA&&!SR},{startsWith:function(r){var c=hn(an(this));mR(r);var u=xr(NA(arguments.length>1?arguments[1]:void 0,c.length)),d=hn(r);return yR?yR(c,d,u):OA(c,u,u+d.length)===d}});var ud=Object.assign,IR=Object.defineProperty,PA=ve([].concat),_v=!ud||xe(function(){if(Et&&ud({b:1},ud(IR({},"a",{enumerable:!0,get:function(){IR(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var r={},c={},u=Symbol();return r[u]=7,"abcdefghijklmnopqrst".split("").forEach(function(d){c[d]=d}),ud({},r)[u]!=7||_u(ud({},c)).join("")!="abcdefghijklmnopqrst"})?function(r,c){for(var u=fr(r),d=arguments.length,p=1,v=pp.f,f=dr.f;d>p;)for(var y,I=qr(arguments[p++]),T=v?PA(_u(I),v(I)):_u(I),b=T.length,k=0;b>k;)y=T[k++],Et&&!dt(f,I,y)||(u[y]=I[y]);return u}:ud;cn({target:"Object",stat:!0,arity:2,forced:Object.assign!==_v},{assign:_v});var ER=ee.Function,TR=ve([].concat),tS=ve([].join),yE={},xA=function(r,c,u){if(!st(yE,c)){for(var d=[],p=0;p<c;p++)d[p]="a["+p+"]";yE[c]=ER("C,a","return new C("+tS(d,",")+")")}return yE[c](r,u)},SE=Fn?ER.bind:function(r){var c=er(this),u=c.prototype,d=Ac(arguments,1),p=function(){var v=TR(d,Ac(arguments));return this instanceof p?xA(c,v.length,v):c.apply(r,v)};return xt(u)&&(p.prototype=u),p};cn({target:"Function",proto:!0,forced:Function.bind!==SE},{bind:SE});var UA=Zr.findIndex,Jc=!0;"findIndex"in[]&&Array(1).findIndex(function(){Jc=!1}),cn({target:"Array",proto:!0,forced:Jc},{findIndex:function(r){return UA(this,r,arguments.length>1?arguments[1]:void 0)}}),Tc("findIndex");var yv=ve(dr.f),GA=ve([].push),MR=function(r){return function(c){for(var u,d=ur(c),p=_u(d),v=p.length,f=0,y=[];v>f;)u=p[f++],Et&&!yv(d,u)||GA(y,r?[u,d[u]]:d[u]);return y}},RR={entries:MR(!0),values:MR(!1)}.values;cn({target:"Object",stat:!0},{values:function(r){return RR(r)}});var FA=Dd.includes,VA=xe(function(){return!Array(1).includes()});cn({target:"Array",proto:!0,forced:VA},{includes:function(r){return FA(this,r,arguments.length>1?arguments[1]:void 0)}}),Tc("includes");var BA=ve("".indexOf);cn({target:"String",proto:!0,forced:!vR("includes")},{includes:function(r){return!!~BA(hn(an(this)),hn(mR(r)),arguments.length>1?arguments[1]:void 0)}});var CR=1,bR=5,IE=2,Sv=3,Fh=4,nS="DISCONNECTED",AR="CONNECTING",EE="RECONNECTING",Vh="CONNECTED",el={CLIENT_BANNED:9,CHANNEL_SETUP_RESULT:19,CHANNEL_RECONNECT_RESULT:514,JOIN_ROOM_RESULT:20,PEER_JOIN:4134,PEER_LEAVE:4135,STREAM_ADDED:16,STREAM_REMOVED:18,UPLINK_NETWORK_STATS:22,UPDATE_REMOTE_MUTE_STAT:23,PUBLISH_RESULT:4098,UNPUBLISH_RESULT:4100,SUBSCRIBE_RESULT:4102,UNSUBSCRIBE_RESULT:4104,SUBSCRIBE_CHANGE_RESULT:4106,MUTE_RESULT:4108,UPDATE_OFFER_RESULT:4128,START_PUBLISH_TENCENT_CDN_RES:1286,STOP_PUBLISH_TENCENT_CDN_RES:1288,START_PUBLISH_GIVEN_CDN_RES:777,STOP_PUBLISH_GIVEN_CDN_RES:779,START_MIX_TRANSCODE_RES:781,STOP_MIX_TRANSCODE_RES:783,USER_LIST_RES:4137,SWITCH_ROLE_RES:4110,UPDATE_CONSTRAINT_CONFIG_RES:772},jA=[el.UPDATE_REMOTE_MUTE_STAT,el.UPLINK_NETWORK_STATS,el.USER_LIST_RES,el.MUTE_RESULT],wr={CLIENT_BANNED:"client-banned",CHANNEL_SETUP_RESULT:"channel-setup-result",CHANNEL_RECONNECT_RESULT:"channel-reconnect-result",JOIN_ROOM_RESULT:"join-room-result",PEER_JOIN:"peer-join",PEER_LEAVE:"peer-leave",STREAM_ADDED:"stream-added",STREAM_REMOVED:"stream-removed",UPLINK_NETWORK_STATS:"uplink-network-stats",UPDATE_REMOTE_MUTE_STAT:"update-remote-mute-stat",PUBLISH_RESULT:"publish-result",UNPUBLISH_RESULT:"unpublish-result",SUBSCRIBE_RESULT:"subscribe-result",SUBSCRIBE_CHANGE_RESULT:"subscribe-change-result",UNSUBSCRIBE_RESULT:"unsubscribe-result",UPDATE_OFFER_RESULT:"update-offer-result",START_PUBLISH_TENCENT_CDN_RES:"start-publish-tencent-cdn-res",STOP_PUBLISH_TENCENT_CDN_RES:"stop-publish-tencent-cdn-res",START_PUBLISH_GIVEN_CDN_RES:"start-publish-given-cdn-res",STOP_PUBLISH_GIVEN_CDN_RES:"stop-publish-given-cdn-res",START_MIX_TRANSCODE_RES:"start-mix-transcode-res",STOP_MIX_TRANSCODE_RES:"stop-mix-transcode-res",USER_LIST_RES:"user-list-res",SWITCH_ROLE_RES:"switch_role_res",MUTE_RESULT:"mute-result",UPDATE_CONSTRAINT_CONFIG_RES:"update-contraint-config-res"},qA="publish_change",HA="join",TE="leave",kR="quality_report",$A="mute_uplink",Ff="publish",wR="unpublish",KA="subscribe",tl="unsubscribe",WA="subscribe_change",zA="start_publishing",YA="stop_publishing",JA="start_push_user_cdn",XA="stop_push_user_cdn",DR="start_mcu_mix",QA="stop_mcu_mix",ZA="get_user_list",ek="change_role",OR="update_constraint_config",Ye={INVALID_PARAMETER:4096,INVALID_OPERATION:4097,NOT_SUPPORTED:4098,DEVICE_NOT_FOUND:4099,INITIALIZE_FAILED:4100,SIGNAL_CHANNEL_SETUP_FAILED:16385,SIGNAL_CHANNEL_ERROR:16386,ICE_TRANSPORT_ERROR:16387,JOIN_ROOM_FAILED:16388,CREATE_OFFER_FAILED:16389,SIGNAL_CHANNEL_RECONNECTION_FAILED:16390,UPLINK_RECONNECTION_FAILED:16391,DOWNLINK_RECONNECTION_FAILED:16392,REMOTE_STREAM_NOT_EXIST:16400,CLIENT_BANNED:16448,SERVER_TIMEOUT:16449,SUBSCRIPTION_TIMEOUT:16450,PLAY_NOT_ALLOWED:16451,DEVICE_AUTO_RECOVER_FAILED:16452,START_PUBLISH_CDN_FAILED:16453,STOP_PUBLISH_CDN_FAILED:16454,START_MIX_TRANSCODE_FAILED:16455,STOP_MIX_TRANSCODE_FAILED:16456,NOT_SUPPORTED_H264:16457,SWITCH_ROLE_FAILED:16458,API_CALL_TIMEOUT:16459,SCHEDULE_FAILED:16460,UNKNOWN:65535},et=function(r){re(u,r);var c=Xe(u);function u(d){var p,v=d.name,f=v===void 0?"RtcError":v,y=d.message,I=d.code,T=I===void 0?Ye.UNKNOWN:I,b=d.extraCode,k=b===void 0?0:b,N=d.constraint;x(this,u);var O="<".concat(function(F){for(var G in Ye)if(Ye[G]===F)return G;return"UNKNOWN"}(T)," 0x").concat(T.toString(16),">");return(p=c.call(this,y+"".concat(N?" constraint: ".concat(N):"")+"".concat(y.includes(O)?"":" "+O))).code_=T,p.extraCode_=k,p.name=f,p.message_=y,N&&(p.constraint=N),p}return B(u,[{key:"getCode",value:function(){return this.code_}},{key:"getExtraCode",value:function(){return this.extraCode_}}]),u}(Ae(Error)),ms=32768,vs=32769,Bh=32770,Xc=32771,jh=32772,NR=32773,tk=32774,rS=32775,LR=32777,nk=32778,iS=32779,PR=32780,xR=32781,UR=32782,GR=32783,FR=32784,rk=32785,ik=32786,oS=32787,ld=32788,dd=32789,VR=32790,ME=32791,BR=32792,jR=32793,aS=32794,qR=32795,sS=32796,RE=32797,CE=32798,HR=32799,$R=32800,ok=32801,ak=32802,sk=32803,pa=32804,Qc=new Map,Eo=function(r,c){var u=Qc.get(r);u||(Qc.set(r,[]),u=Qc.get(r)),u.push(c)},ck=function(r){var c=Qc.get(r),u=[];return c?(Qc.delete(r),u=c.map(function(d){return{uint32_event_id:d.eventId,uint64_date:d.timestamp,str_userid:d.remoteUserId,str_event_json:d.eventDesc}})):u=[],u},cS=Object.prototype.hasOwnProperty;function hd(r){if(r==null)return!0;if(typeof r=="boolean")return!1;if(typeof r=="number")return r===0;if(typeof r=="string"||typeof r=="function"||Array.isArray(r))return r.length===0;if(r instanceof Error)return r.message==="";if(sd(r))switch(Object.prototype.toString.call(r)){case"[object File]":case"[object Map]":case"[object Set]":return r.size===0;case"[object Object]":for(var c in r)if(cS.call(r,c))return!1;return!0}return!1}var jt=new(function(){function r(){x(this,r);var c=Ch(),u=c.name,d=c.version;this.roomIdMap_=new Map,this.configs_={sdkAppId:"",userId:"",version:"4.14.0",env:gi,browserVersion:u+d,ua:navigator.userAgent}}return B(r,[{key:"setConfig",value:function(c){var u=c.sdkAppId,d=c.env,p=c.userId,v=c.roomId;u!==this.configs_.sdkAppId&&(this.configs_.sdkAppId=String(u)),this.configs_.env=d,this.configs_.userId=p,this.roomIdMap_.set(p,String(v))}},{key:"logEvent",value:function(c){if(!Rh){var u=m(m(m({},c),this.configs_),{},{userId:c.userId||this.configs_.userId});kt(u.code)&&(u.code=u.result==="failed"?Ye.UNKNOWN:0),this.sendRequest(Lh(this.configs_.sdkAppId,aI),u)}}},{key:"logSuccessEvent",value:function(c){Rh||(this.logEvent(m(m({},c),{},{result:"success",roomId:this.roomIdMap_.get(c.userId)})),this.configs_.env===gi&&this.uploadEventToKibana(m(m({},c),{},{result:"success"})))}},{key:"logFailedEvent",value:function(c){if(!Rh){var u=c.eventType,d=c.code,p=c.error,v=c.userId,f={roomId:this.roomIdMap_.get(v),userId:v,eventType:u,result:"failed",code:d||(p instanceof et?p.getExtraCode()||p.getCode():Ye.UNKNOWN)};this.logEvent(f),this.configs_.env===gi&&this.uploadEventToKibana(m(m({},f),{},{error:p}))}}},{key:"uploadEventToKibana",value:function(c){var u="stat-".concat(c.eventType,"-").concat(c.result);c.eventType!=="delta-join"&&c.eventType!=="delta-leave"&&c.eventType!=="delta-publish"||(u="".concat(c.eventType,":").concat(c.delta)),this.uploadEvent({log:u,userId:c.userId}),c.result==="failed"&&(u="stat-".concat(c.eventType,"-").concat(c.result,"-").concat(c.code),this.uploadEvent({log:u,userId:c.userId,error:c.error}))}},{key:"uploadEvent",value:function(c){var u=c.log,d=c.userId,p=c.error,v={timestamp:Cm(),sdkAppId:this.configs_.sdkAppId,userId:d||this.configs_.userId,version:this.configs_.version,log:u};p&&(v.errorInfo=p.message),this.sendRequest(Lh(this.configs_.sdkAppId,ds),v)}},{key:"sendRequest",value:function(c,u){var d=this;Bt.getIsAbleToUpload()?hv.post(c,JSON.stringify(u)).catch(function(){}):setTimeout(function(){d.sendRequest(c,u)},1e3)}}]),r}()),KR=function(){function r(c){x(this,r),this.client_=c.client,this.sdkAppId_=c.sdkAppId,this.userId_=c.userId,this.userSig_=c.userSig,this.url_=c.url,this.backupUrl_=c.backupUrl;var u="?sdkAppId=".concat(encodeURIComponent(this.sdkAppId_),"&userId=").concat(encodeURIComponent(this.userId_),"&userSig=").concat(encodeURIComponent(this.userSig_));this.urlWithParam_="".concat(this.url_).concat(u),this.backupUrlWithParam_="".concat(this.backupUrl_).concat(u),this.isConnected_=!1,this.isConnecting_=!1,this.socketInUse_=null,this.socket_=null,this.backupSocket_=null,this.backupTimer_=-1,this.signalInfo_={},this.currentState_=nS,this.reconnectionCount_=0,this.reconnectionTimer_=-1,this.seq_=0,this.log_=Bt.createLogger({id:"ws|"+this.userId_,userId:this.userId_,sdkAppId:this.sdkAppId_}),this.emitter_=new Wc}return B(r,[{key:"connect",value:function(){var c=this;return new Promise(function(u,d){c.log_.info("connect to url: ".concat(c.urlWithParam_)),c.emitConnectionStateChanged(AR),c.socket_=new WebSocket(c.urlWithParam_),c.bindSocket(c.socket_),c.backupTimer_=setTimeout(function(){c.isConnected_||(c.log_.info("trying to connect to backupUrl"),c.tryConnectBackup())},5e3),c.once(Sv,u),c.once(Fh,d)})}},{key:"tryConnectBackup",value:function(){this.backupSocket_||(this.unbindAndCloseSocket(ti),this.log_.debug("try to connect to url: ".concat(this.backupUrlWithParam_)),this.backupSocket_=new WebSocket(this.backupUrlWithParam_),this.bindSocket(this.backupSocket_))}},{key:"bindSocket",value:function(c){c.onopen=this.onopen.bind(this),c.onclose=this.onclose.bind(this),c.onerror=this.onerror.bind(this),c.onmessage=this.onmessage.bind(this)}},{key:"unbindSocket",value:function(c){c.onopen=function(){},c.onclose=function(){},c.onerror=function(){},c.onmessage=function(){}}},{key:"unbindAndCloseSocket",value:function(c){if(c===ti){if(this.socket_){this.unbindSocket(this.socket_);try{this.socket_.close(1e3)}catch{}this.socket_=null}}else if(this.backupSocket_){this.unbindSocket(this.backupSocket_);try{this.backupSocket_.close(1e3)}catch{}this.backupSocket_=null}}},{key:"clearBackupTimer",value:function(){this.backupTimer_!==-1&&(clearTimeout(this.backupTimer_),this.backupTimer_=-1)}},{key:"clearReconnectionTimer",value:function(){this.reconnectionTimer_!==-1&&(clearTimeout(this.reconnectionTimer_),this.reconnectionTimer_=-1)}},{key:"onopen",value:function(c){if(!this.isConnected_){this.isConnected_=!0,this.isConnecting_=!1,this.clearBackupTimer(),c.target===this.socket_?(this.unbindAndCloseSocket(kh),this.socketInUse_=this.socket_):(this.unbindAndCloseSocket(ti),this.socketInUse_=this.backupSocket_);var u=c.target.url;this.log_.info("websocket[".concat(u,"] is connected")),this.currentState_===AR?this.addSignalEvent(ME,"signal channel is connected"):this.currentState_===EE&&this.addSignalEvent(qR,"signal channel reconnect success"),this.emitConnectionStateChanged(Vh),this.emitter_.emit(Sv)}}},{key:"onclose",value:function(c){var u=c.target.url,d=c.target===this.socketInUse_;this.log_.info("websocket[".concat(u," InUse: ").concat(d,"] is closed with code: ").concat(c.code)),c.target===this.socketInUse_&&(this.isConnected_=!1,this.emitConnectionStateChanged(nS),this.addSignalEvent(VR,"signal channel is disconnected"),c.wasClean&&c.code===1e3||(this.log_.warn("onclose code:".concat(c.code," reason:").concat(c.reason)),this.log_.warn("close current websocket and schedule a reconnect timeout"),this.socketInUse_.onclose=function(){},this.socketInUse_.close(4011),this.socket_=this.backupSocket_=this.socketInUse_=null,this.reconnect(ti)))}},{key:"onerror",value:function(c){var u=c.target.url;this.log_.error("websocket[".concat(u,"] error observed")),this.isConnected_?c.target===this.socketInUse_&&(this.isConnected_=!1,this.unbindAndCloseSocket(ti),this.unbindAndCloseSocket(kh),this.socketInUse_=null,this.reconnect(ti)):(this.isReconnecting_||jt.logFailedEvent({userId:this.client_.getUserId(),eventType:Xm,code:Ye.UNKNOWN}),c.target==this.socket_?(this.unbindAndCloseSocket(ti),this.reconnect(kh)):(this.unbindAndCloseSocket(kh),this.reconnect(ti))),this.isConnecting_=!1,this.isConnected_=!1}},{key:"onmessage",value:function(c){if(this.isConnected_){var u=JSON.parse(c.data),d=u.cmd,p=u.data,v=Object.values(el),f=Object.keys(el)[v.indexOf(d)],y=wr[f];if(!jA.includes(d)){var I=c.target==this.socket_?this.url_:this.backupUrl_;this.log_.debug("websocket[".concat(I,"] received message: ").concat(c.data)),this.log_.info("Received event: [ ".concat(y||"unknown cmd: "+d," ]"))}switch(d){case el.CHANNEL_SETUP_RESULT:if(u.code===0)this.signalInfo_.clientIp=p.clientIp,this.signalInfo_.signalIp=p.signalInnerIp,this.signalInfo_.tinyId=u.tinyId,p.svrTime&&function(b){tf=b-new Date().getTime();var k=new Date;k.setTime(b),Bt.info("baseTime from server: "+k+" offset: "+tf)}(p.svrTime),this.log_.info("ChannelSetup Success"),jt.logSuccessEvent({userId:this.userId_,eventType:Xm}),this.emitter_.emit(CR,{signalInfo:this.signalInfo_});else{var T=new et({code:Ye.SIGNAL_CHANNEL_SETUP_FAILED,extraCode:u.code,message:rt({key:yM,data:{errorCode:u.code,errorMsg:u.message}})});this.log_.error("".concat(u.code,", ").concat(u.message)),this.close(),jt.logFailedEvent({userId:this.userId_,eventType:Xm,error:T}),this.emitter_.emit(bR,T)}break;case el.JOIN_ROOM_RESULT:u.code===0&&(this.signalInfo_.relayIp=p.relayOuterIp,this.signalInfo_.relayInnerIp=p.relayInnerIp,this.signalInfo_.relayPort=p.relayPort,this.log_.info("signalIp:".concat(this.signalInfo_.signalIp," clientIp:").concat(this.signalInfo_.clientIp," relayIp: ").concat(this.signalInfo_.relayIp))),this.emitter_.emit(y,{data:u});break;case el.CHANNEL_RECONNECT_RESULT:u.code===0?(this.log_.warn("reconnect success"),this.stopReconnection(),jt.logSuccessEvent({userId:this.userId_,eventType:SI}),this.client_.syncUserList(),this.client_.checkConnectionsToReconnect()):(this.log_.warn("reconnect failed, ".concat(u.code," ").concat(u.message)),this.client_.reJoin());break;default:this.emitter_.emit(y,{data:u})}}}},{key:"addSignalEvent",value:function(c,u){Eo(this.userId_,{eventId:c,eventDesc:u,timestamp:Yi(),userId:this.userId_,tinyId:this.signalInfo_.tinyId})}},{key:"reconnect",value:function(){var c=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ti;if(this.isConnecting_||this.reconnectionTimer_!==-1)this.log_.info("signal channel is reconnecting, ignoring current reconnection");else{if(this.reconnectionCount_>=30){this.log_.warn("SDK has tried reconnect signal channel for ".concat(30," times, but all failed. please check your network"));var d=new et({code:Ye.SIGNAL_CHANNEL_RECONNECTION_FAILED,message:rt({key:_M})});return jt.logFailedEvent({userId:this.client_.getUserId(),eventType:SI,error:d}),this.addSignalEvent(sS,"signal channel reconnect fail"),void this.emitter_.emit(Fh,d)}this.isConnecting_=!0,this.reconnectionCount_++,this.currentState_!==EE&&(this.emitConnectionStateChanged(EE),this.addSignalEvent(aS,"signal channel is reconnecting")),this.log_.warn("reconnecting to ".concat(u," signal channel [").concat(this.reconnectionCount_,"/").concat(30,"]"));var p=this.getReconnectionUrl(u);u===ti?(this.socket_=new WebSocket(p),this.bindSocket(this.socket_)):(this.backupSocket_=new WebSocket(p),this.bindSocket(this.backupSocket_));var v=Fa(this.reconnectionCount_);this.reconnectionTimer_=setTimeout(function(){c.log_.warn("reconnect ".concat(u," signal channel timeout(").concat(v/1e3,"s), close and try again")),c.isConnecting_=!1,c.clearReconnectionTimer(),c.unbindAndCloseSocket(u),c.reconnect(u===ti?kh:ti)},v)}}},{key:"isConnected",value:function(){return this.isConnected_}},{key:"isReconnecting_",get:function(){return this.reconnectionTimer_!==-1}},{key:"getReconnectionUrl",value:function(c){var u=c===ti?this.urlWithParam_:this.backupUrlWithParam_;if(!hd(this.signalInfo_)&&u.indexOf("&rc=1")===-1){var d=this.client_.getRoomId(),p=this.client_.getUseStringRoomId();u+="&rc=1&relayInnerIp=".concat(this.signalInfo_.relayInnerIp,"&relayOuterIp=").concat(this.signalInfo_.relayIp,"&relayPort=").concat(this.signalInfo_.relayPort,"&roomId=").concat(d,"&useStringRoomId=").concat(p)}return u}},{key:"send",value:function(c){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.isConnected_){var d={cmd:c,data:u,userId:this.userId_,tinyId:this.signalInfo_.tinyId,seq:++this.seq_};return this.socketInUse_.send(JSON.stringify(d)),d.seq}}},{key:"sendWaitForResponse",value:function(c){var u=this,d=c.command,p=c.data,v=c.timeout,f=v===void 0?5e3:v,y=c.responseCommand,I=c.commandDesc,T=c.enableLog,b=T===void 0||T;return new Promise(function(k,N){var O=setTimeout(function(){u.off(y,F);var P=new et({code:Ye.API_CALL_TIMEOUT,message:rt({key:Hb,data:{commandDesc:I,command:d}})});b&&u.log_.warn(P),N(P)},f),F=function P(K){K.data.seq===G&&(clearTimeout(O),u.off(y,P),k(K))};u.on(y,F);var G=u.send(d,p)})}},{key:"sendWaitForResponseWithRetry",value:function(){var c=this,u=arguments.length<=0?void 0:arguments[0],d=u.commandDesc,p=u.retries,v=p===void 0?0:p,f=u.retryTimeout,y=f===void 0?0:f;return Gf({retryFunction:this.sendWaitForResponse,onRetrying:function(I){c.log_.warn("".concat(d," timeout observed, retrying [").concat(I,"/").concat(v,"]"))},settings:{retries:v,timeout:y},context:this}).apply(void 0,arguments)}},{key:"getCurrentState",value:function(){return this.currentState_}},{key:"getSignalInfo",value:function(){return this.signalInfo_}},{key:"stopReconnection",value:function(){this.isReconnecting_&&(this.reconnectionCount_=0,this.clearReconnectionTimer())}},{key:"close",value:function(){this.log_.info("close SignalChannel"),this.clearBackupTimer(),this.stopReconnection(),this.isConnecting_=!1,this.isConnected_=!1,this.socketInUse_=null,this.unbindAndCloseSocket(ti),this.unbindAndCloseSocket(kh),this.emitConnectionStateChanged(nS)}},{key:"on",value:function(c,u,d){this.emitter_.on(c,u,d)}},{key:"removeListener",value:function(c,u,d){this.emitter_.removeListener(c,u,d)}},{key:"once",value:function(c,u,d){this.emitter_.once(c,u,d)}},{key:"off",value:function(c,u,d){this.emitter_.off(c,u,d)}},{key:"emitConnectionStateChanged",value:function(c){c!==this.currentState_&&(this.emitter_.emit(IE,{prevState:this.currentState_,state:c}),this.currentState_=c)}}]),r}(),Zc=Zr.find,_s=!0;"find"in[]&&Array(1).find(function(){_s=!1}),cn({target:"Array",proto:!0,forced:_s},{find:function(r){return Zc(this,r,arguments.length>1?arguments[1]:void 0)}}),Tc("find");var Zi=vt(function(r){var c=r.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(u){return u.encoding?"rtpmap:%d %s/%s/%s":u.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(u){return u.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(u){return u.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(u){return"extmap:%d"+(u.direction?"/%s":"%v")+(u["encrypt-uri"]?" %s":"%v")+" %s"+(u.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(u){return u.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(u){var d="candidate:%s %d %s %d %s %d typ %s";return d+=u.raddr!=null?" raddr %s rport %d":"%v%v",d+=u.tcptype!=null?" tcptype %s":"%v",u.generation!=null&&(d+=" generation %d"),d+=u["network-id"]!=null?" network-id %d":"%v",d+=u["network-cost"]!=null?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(u){var d="ssrc:%d";return u.attribute!=null&&(d+=" %s",u.value!=null&&(d+=":%s")),d}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(u){return u.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(u){return u.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(u){return"imageattr:%s %s %s"+(u.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(u){return"simulcast:%s %s"+(u.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(u){return"ts-refclk:%s"+(u.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(u){var d="mediaclk:";return d+=u.id!=null?"id=%s %s":"%v%s",d+=u.mediaClockValue!=null?"=%s":"",d+=u.rateNumerator!=null?" rate=%s":"",d+=u.rateDenominator!=null?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(c).forEach(function(u){c[u].forEach(function(d){d.reg||(d.reg=/(.*)/),d.format||(d.format="%s")})})}),Do=(Zi.v,Zi.o,Zi.s,Zi.i,Zi.u,Zi.e,Zi.p,Zi.z,Zi.r,Zi.t,Zi.c,Zi.b,Zi.m,Zi.a,vt(function(r,c){var u=function(f){return String(Number(f))===f?Number(f):f},d=function(f,y,I){var T=f.name&&f.names;f.push&&!y[f.push]?y[f.push]=[]:T&&!y[f.name]&&(y[f.name]={});var b=f.push?{}:T?y[f.name]:y;(function(k,N,O,F){if(F&&!O)N[F]=u(k[1]);else for(var G=0;G<O.length;G+=1)k[G+1]!=null&&(N[O[G]]=u(k[G+1]))})(I.match(f.reg),b,f.names,f.name),f.push&&y[f.push].push(b)},p=RegExp.prototype.test.bind(/^([a-z])=(.*)/);c.parse=function(f){var y={},I=[],T=y;return f.split(/(\r\n|\r|\n)/).filter(p).forEach(function(b){var k=b[0],N=b.slice(2);k==="m"&&(I.push({rtp:[],fmtp:[]}),T=I[I.length-1]);for(var O=0;O<(Zi[k]||[]).length;O+=1){var F=Zi[k][O];if(F.reg.test(N))return d(F,T,N)}}),y.media=I,y};var v=function(f,y){var I=y.split(/=(.+)/,2);return I.length===2?f[I[0]]=u(I[1]):I.length===1&&y.length>1&&(f[I[0]]=void 0),f};c.parseParams=function(f){return f.split(/;\s?/).reduce(v,{})},c.parseFmtpConfig=c.parseParams,c.parsePayloads=function(f){return f.toString().split(" ").map(Number)},c.parseRemoteCandidates=function(f){for(var y=[],I=f.split(" ").map(u),T=0;T<I.length;T+=3)y.push({component:I[T],ip:I[T+1],port:I[T+2]});return y},c.parseImageAttributes=function(f){return f.split(" ").map(function(y){return y.substring(1,y.length-1).split(",").reduce(v,{})})},c.parseSimulcastStreamList=function(f){return f.split(";").map(function(y){return y.split(",").map(function(I){var T,b=!1;return I[0]!=="~"?T=u(I):(T=u(I.substring(1,I.length)),b=!0),{scid:T,paused:b}})})}})),WR=(Do.parse,Do.parseParams,Do.parseFmtpConfig,Do.parsePayloads,Do.parseRemoteCandidates,Do.parseImageAttributes,Do.parseSimulcastStreamList,/%[sdv%]/g),bE=function(r){var c=1,u=arguments,d=u.length;return r.replace(WR,function(p){if(c>=d)return p;var v=u[c];switch(c+=1,p){case"%%":return"%";case"%s":return String(v);case"%d":return Number(v);case"%v":return""}})},qh=function(r,c,u){var d=[r+"="+(c.format instanceof Function?c.format(c.push?u:u[c.name]):c.format)];if(c.names)for(var p=0;p<c.names.length;p+=1){var v=c.names[p];c.name?d.push(u[c.name][v]):d.push(u[c.names[p]])}else d.push(u[c.name]);return bE.apply(null,d)},nl=["v","o","s","i","u","e","p","c","b","t","r","z","a"],zR=["i","c","b","a"],Qs={write:function(r,c){c=c||{},r.version==null&&(r.version=0),r.name==null&&(r.name=" "),r.media.forEach(function(v){v.payloads==null&&(v.payloads="")});var u=c.outerOrder||nl,d=c.innerOrder||zR,p=[];return u.forEach(function(v){Zi[v].forEach(function(f){f.name in r&&r[f.name]!=null?p.push(qh(v,f,r)):f.push in r&&r[f.push]!=null&&r[f.push].forEach(function(y){p.push(qh(v,f,y))})})}),r.media.forEach(function(v){p.push(qh("m",Zi.m[0],v)),d.forEach(function(f){Zi[f].forEach(function(y){y.name in v&&v[y.name]!=null?p.push(qh(f,y,v)):y.push in v&&v[y.push]!=null&&v[y.push].forEach(function(I){p.push(qh(f,y,I))})})})}),p.join(`\r
`)+`\r
`},parse:Do.parse,parseParams:Do.parseParams,parseFmtpConfig:Do.parseFmtpConfig,parsePayloads:Do.parsePayloads,parseRemoteCandidates:Do.parseRemoteCandidates,parseImageAttributes:Do.parseImageAttributes,parseSimulcastStreamList:Do.parseSimulcastStreamList},Zs=function(r){return Qs.parse(r)},Hh=function(r){return Qs.write(r)},vn=function(r){var c=Zs(r);return c.media.forEach(function(u){u.type===ln&&u.fmtp.forEach(function(d){d.config+=";sprop-stereo=1;stereo=1"})}),Hh(c)};function uk(r){var c=Zs(r);return c.media.forEach(function(u){if(u.type===An){var d=new Set;u.rtp.forEach(function(v){var f=v.payload;return v.codec==="H264"&&d.add(f)}),u.fmtp.forEach(function(v){var f=v.payload,y=v.config.match(/apt=(\d+)/);y&&y[1]&&d.has(Number(y[1]))&&d.add(f)});var p=function(v){var f=v.payload;return!d.has(f)};u.rtp=u.rtp.filter(p),u.rtcpFb=u.rtcpFb.filter(p),u.fmtp=u.fmtp.filter(p),u.payloads=u.payloads.split(" ").filter(function(v){return!d.has(Number(v))}).join(" ")}}),Hh(c)}var YR=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var c=16*Math.random()|0;return(r=="x"?c:3&c|8).toString(16)})},ii=new(function(){function r(){x(this,r),this.intervalMap_=new Map}return B(r,[{key:"setInterval",value:function(c){function u(d,p){return c.apply(this,arguments)}return u.toString=function(){return c.toString()},u}(function(c,u){var d=this,p=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];if(!window||!window.requestAnimationFrame)return setInterval(c,u);var v=YR(),f=So(),y=f;this.intervalMap_.set(v,{rafId:null,timeoutId:null,onVisibilityChange:null});var I=function k(){if(p&&document.hidden){if(c(),!d.intervalMap_.has(v))return;var N=setTimeout(k,u);d.setTimeoutId(v,N),f=So(),y=f}else{if((y=So())-f>=u&&(f=y,c(),!d.intervalMap_.has(v)))return;var O=requestAnimationFrame(k);d.setRafId(v,O)}},T=requestAnimationFrame(I);if(this.setRafId(v,T),p){var b=function(){if(document.hidden){var k=So()-f;if(k>=u)I();else{var N=setTimeout(I,u-k);d.setTimeoutId(v,N)}}};document.addEventListener("visibilitychange",b),this.setOnVisibilityChange(v,b),document.hidden&&b()}return v})},{key:"clearInterval",value:function(c){if(this.intervalMap_.has(c)){var u=this.intervalMap_.get(c),d=u.rafId,p=u.timeoutId,v=u.onVisibilityChange;cancelAnimationFrame(d),clearTimeout(p),document.removeEventListener("visibilitychange",v),this.intervalMap_.delete(c)}}},{key:"setTimeoutId",value:function(c,u){if(this.intervalMap_.has(c)){var d=this.intervalMap_.get(c);d.timeoutId&&clearTimeout(d.timeoutId),d.timeoutId=u}}},{key:"setRafId",value:function(c,u){if(this.intervalMap_.has(c)){var d=this.intervalMap_.get(c);d.rafId&&cancelAnimationFrame(d.rafId),d.rafId=u}}},{key:"setOnVisibilityChange",value:function(c,u){this.intervalMap_.has(c)&&(this.intervalMap_.get(c).onVisibilityChange=u)}}]),r}()),Vf=new(function(){function r(){x(this,r),this.prefix_="TRTC",this.queue_=new Map,this.intervalId_=ii.setInterval(this.doFlush.bind(this),2e4),this.checkStorage()}return B(r,[{key:"getRealKey",value:function(c){return"".concat(this.prefix_,"_").concat(c)}},{key:"checkStorage",value:function(){var c=this;qc()&&Object.keys(localStorage).filter(function(u){if(u.startsWith(c.prefix_)){var d=JSON.parse(localStorage.getItem(u));if(d&&d.expiresIn<Date.now())return!0}return!1}).forEach(function(u){return localStorage.removeItem(u)})}},{key:"doFlush",value:function(){if(qc())try{var c,u=ke(this.queue_);try{for(u.s();!(c=u.n()).done;){var d=Pe(c.value,2),p=d[0],v=d[1];localStorage.setItem(p,JSON.stringify(v))}}catch(f){u.e(f)}finally{u.f()}}catch(f){Bt.warn(f)}}},{key:"getItem",value:function(c){if(!qc())return null;try{var u=JSON.parse(localStorage.getItem(this.getRealKey(c)));return u&&u.expiresIn>=Date.now()?u.value:null}catch(d){Bt.warn(d)}}},{key:"setItem",value:function(c,u){if(qc())try{var d={expiresIn:Date.now()+6048e5,value:u};this.queue_.set(this.getRealKey(c),d)}catch(p){Bt.warn(p)}}},{key:"deleteItem",value:function(c){if(!qc())return!1;try{return c=this.getRealKey(c),this.queue_.delete(c),localStorage.removeItem(c),!0}catch(u){return Bt.warn(u),!1}}},{key:"clear",value:function(){if(qc())try{localStorage.clear()}catch(c){Bt.warn(c)}}}]),r}()),Gr={result:!1,detail:{isBrowserSupported:!1,isWebRTCSupported:!1,isMediaDevicesSupported:!1,isH264EncodeSupported:!1,isVp8EncodeSupported:!1,isH264DecodeSupported:!1,isVp8DecodeSupported:!1}},JR=function(){return!HT&&!Km&&!(xa&&z0<80)&&!(Vc&&ry<56)},AE=function(){return["RTCPeerConnection","webkitRTCPeerConnection","RTCIceGatherer"].filter(function(r){return r in window}).length>0},lk=function(){if(!navigator.mediaDevices)return!1;var r=["getUserMedia","enumerateDevices"];return r.filter(function(c){return c in navigator.mediaDevices}).length===r.length},uS=function(){var r=D(regeneratorRuntime.mark(function c(){var u,d,p,v,f,y;return regeneratorRuntime.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(!Gr.detail.isH264EncodeSupported&&!Gr.detail.isVp8EncodeSupported){I.next=2;break}return I.abrupt("return",{isH264EncodeSupported:Gr.detail.isH264EncodeSupported,isVp8EncodeSupported:Gr.detail.isVp8EncodeSupported});case 2:return u="",d=!1,p=!1,I.prev=5,v=new RTCPeerConnection,(f=document.createElement("canvas")).getContext("2d"),y=f.captureStream(0),v.addTrack(y.getVideoTracks()[0],y),I.next=13,v.createOffer();case 13:return(u=I.sent).sdp.toLowerCase().indexOf("h264")!==-1&&(d=!0),u.sdp.toLowerCase().indexOf("vp8")!==-1&&(p=!0),v.close(),Gr.detail.isH264EncodeSupported=d,Gr.detail.isVp8EncodeSupported=p,I.abrupt("return",{isH264EncodeSupported:Gr.detail.isH264EncodeSupported,isVp8EncodeSupported:Gr.detail.isVp8EncodeSupported});case 22:return I.prev=22,I.t0=I.catch(5),I.abrupt("return",{isH264EncodeSupported:!1,isVp8EncodeSupported:!1});case 25:case"end":return I.stop()}},c,null,[[5,22]])}));return function(){return r.apply(this,arguments)}}();function dk(){return kE.apply(this,arguments)}function kE(){return(kE=D(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",new Promise(function(){var u=D(regeneratorRuntime.mark(function d(p){var v,f,y,I,T,b,k,N,O,F,G,P,K,X;return regeneratorRuntime.wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return v={encode:!1,decode:!1},f=null,oe.prev=2,y=document.createElement("canvas"),I=y.getContext("2d"),y.width=640,y.height=480,T=setInterval(function(){I.fillText("test",Math.floor(640*Math.random()),Math.floor(480*Math.random()))},33),b=-1,k=-1,f=function(){clearInterval(b),clearInterval(T),clearTimeout(k),O.close(),F.close(),N.getTracks().forEach(function(Ce){return Ce.stop()})},k=setTimeout(function(){f(),p(v)},3e3),N=y.captureStream(),O=new RTCPeerConnection({}),F=new RTCPeerConnection({offerToReceiveAudio:!0,offerToReceiveVideo:!0}),O.addEventListener("icecandidate",function(Ce){return F.addIceCandidate(Ce.candidate)}),F.addEventListener("icecandidate",function(Ce){return O.addIceCandidate(Ce.candidate)}),O.addTrack(N.getVideoTracks()[0],N),oe.next=20,O.createOffer();case 20:return G=oe.sent,oe.next=23,O.setLocalDescription(G);case 23:return oe.next=25,F.setRemoteDescription(G);case 25:return oe.next=27,F.createAnswer();case 27:return P=oe.sent,K=Zs(P.sdp),X=K.media[0].rtp.findIndex(function(Ce){return Ce.codec==="H264"}),K.media[0].rtp=[K.media[0].rtp[X]],K.media[0].fmtp=K.media[0].fmtp.filter(function(Ce){return Ce.payload===K.media[0].rtp[0].payload}),K.media[0].rtcpFb=K.media[0].rtcpFb.filter(function(Ce){return Ce.payload===K.media[0].rtp[0].payload}),P.sdp=Hh(K),oe.next=36,F.setLocalDescription(P);case 36:return oe.next=38,O.setRemoteDescription(P);case 38:b=setInterval(D(regeneratorRuntime.mark(function Ce(){var Ve,je;return regeneratorRuntime.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return v.encode&&v.decode&&(f(),p(v)),Re.next=3,O.getStats();case 3:return Ve=Re.sent,Re.next=6,F.getStats();case 6:je=Re.sent,v.encode||Ve.forEach(function(Oe){Oe.type==="outbound-rtp"&&Oe.mediaType===An&&Oe.framesEncoded>0&&(v.encode=!0)}),v.decode||je.forEach(function(Oe){Oe.type==="inbound-rtp"&&Oe.mediaType===An&&Oe.framesDecoded>0&&(v.decode=!0)});case 9:case"end":return Re.stop()}},Ce)})),500),oe.next=46;break;case 41:oe.prev=41,oe.t0=oe.catch(2),f(),Bt.warn(oe.t0),p(v);case 46:case"end":return oe.stop()}},d,null,[[2,41]])}));return function(d){return u.apply(this,arguments)}}()));case 1:case"end":return c.stop()}},r)}))).apply(this,arguments)}var XR=function(){var r=D(regeneratorRuntime.mark(function c(){var u,d,p,v;return regeneratorRuntime.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!Gr.detail.isH264DecodeSupported&&!Gr.detail.isVp8DecodeSupported){f.next=2;break}return f.abrupt("return",{isH264DecodeSupported:Gr.detail.isH264DecodeSupported,isVp8DecodeSupported:Gr.detail.isVp8DecodeSupported});case 2:return u="",d=!1,p=!1,f.prev=5,v=new RTCPeerConnection,f.next=9,v.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1});case 9:return(u=f.sent).sdp.toLowerCase().indexOf("h264")!==-1&&(d=!0),u.sdp.toLowerCase().indexOf("vp8")!==-1&&(p=!0),v.close(),f.abrupt("return",{isH264DecodeSupported:d,isVp8DecodeSupported:p});case 16:return f.prev=16,f.t0=f.catch(5),f.abrupt("return",{isH264DecodeSupported:!1,isVp8DecodeSupported:!1});case 19:case"end":return f.stop()}},c,null,[[5,16]])}));return function(){return r.apply(this,arguments)}}(),wE=function(r,c){var u=null;return function(){if(u)return u;for(var d=arguments.length,p=new Array(d),v=0;v<d;v++)p[v]=arguments[v];return(u=r.apply(c||this,p)).then(function(f){return u=null,f}).catch(function(f){throw u=null,f}),u}}(function(){var r=D(regeneratorRuntime.mark(function c(){var u,d,p,v,f,y,I,T,b,k,N,O;return regeneratorRuntime.wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(!Gr.result){F.next=2;break}return F.abrupt("return",Gr);case 2:return u=JR(),d=AE(),p=lk(),F.next=7,uS();case 7:return v=F.sent,f=v.isH264EncodeSupported,y=v.isVp8EncodeSupported,F.next=12,XR();case 12:if(I=F.sent,T=I.isH264DecodeSupported,b=I.isVp8DecodeSupported,!(f&&T&&(hf||pf||Ub)&&!Vu&&ff()<79)){F.next=23;break}return F.next=18,dk();case 18:k=F.sent,N=k.encode,O=k.decode,f=N,T=O;case 23:return Gr.result=u&&d&&p&&(f||y)&&(T||b),Gr.detail.isBrowserSupported=u,Gr.detail.isWebRTCSupported=d,Gr.detail.isMediaDevicesSupported=p,Gr.detail.isH264EncodeSupported=f,Gr.detail.isVp8EncodeSupported=y,Gr.detail.isH264DecodeSupported=T,Gr.detail.isVp8DecodeSupported=b,hk(),Vf.setItem("checkResult",{ua:navigator.userAgent,checkResult:Gr}),F.abrupt("return",Gr);case 34:case"end":return F.stop()}},c)}));return function(){return r.apply(this,arguments)}}());function hk(){Object.keys(Gr.detail).findIndex(function(r){return!Gr.detail[r]})>=0&&(Bt.warn(rt({key:$I})),Bt.info("".concat(navigator.userAgent," ").concat(JSON.stringify(Gr.detail))))}var QR=function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia)},ZR=function(){return"RTCPeerConnection"in window&&"getReceivers"in window.RTCPeerConnection.prototype},lS=function(){return"RTCPeerConnection"in window&&"getSenders"in window.RTCPeerConnection.prototype},eC=function(){return"RTCPeerConnection"in window&&"getTransceivers"in window.RTCPeerConnection.prototype},pk=function(){return"RTCRtpTransceiver"in window&&"stop"in window.RTCRtpTransceiver.prototype},Iv=function(){return"RTCRtpSender"in window&&"replaceTrack"in window.RTCRtpSender.prototype},DE=function(){return"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype&&lS()},Bf=function(){return!!kt(navigator.mediaDevices)&&(Bt.error(ad.NOT_SUPPORTED_MEDIA),!0)},jf=function(){return location.protocol==="http:"&&!Rh&&(Bt.warn(rt({key:qM})),!0)},OE="RTCRtpSender"in window&&"createEncodedStreams"in window.RTCRtpSender.prototype&&ff()>=86,NE=function(r){return!(r.type!=="candidate-pair"||!r.nominated||r.state!=="in-progress"&&r.state!=="succeeded")&&!(YI(r.selected)&&!r.selected)},tC=new Map([[ed,"Android"],[Sh,"iOS"],[X0,"Windows"],[cy,"MacOS"],[df,"Linux"]]),LE=function(){var r="unknown";return tC.get(!0)&&(r=tC.get(!0)),r};function fk(){var r="";return screen.width&&(r+=(screen.width?screen.width*window.devicePixelRatio:"")+" * "+(screen.height?screen.height*window.devicePixelRatio:"")),r}function gk(){var r=!1;return(navigator.getUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)&&(r=!0),r}function mk(){for(var r={isSupported:!1},c=["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"],u=0;u<c.length;u++)if(c[u]in window){r.isSupported=!0;break}return r.isSupported}function nC(){return!oy&&!Sh&&!(!JR()||!("captureStream"in HTMLCanvasElement.prototype))}var qf=window.MediaStreamTrack&&"getSettings"in MediaStreamTrack.prototype,vk=window.MediaStreamTrack&&"getCapabilities"in MediaStreamTrack.prototype;(function(){jf();var r=Vf.getItem("checkResult");r&&r.ua===navigator.userAgent&&(Gr=r.checkResult),wE()})();var or={STREAM_ADDED:"stream-added",STREAM_REMOVED:"stream-removed",STREAM_UPDATED:"stream-updated",STREAM_PUBLISHED:"stream-published",STREAM_SUBSCRIBED:"stream-subscribed",STREAM_UNSUBSCRIBED:"stream-unsubscribed",STATE_CHANGED:"state-changed",ERROR:"error",CONNECTION_STATE_CHANGED:"connection-state-changed",SEI_MESSAGE:Vi},Er={STREAM_ADDED:"stream-added",STREAM_REMOVED:"stream-removed",STREAM_UPDATED:"stream-updated",STREAM_SUBSCRIBED:"stream-subscribed",CONNECTION_STATE_CHANGED:"connection-state-changed",PEER_JOIN:"peer-join",PEER_LEAVE:"peer-leave",MUTE_AUDIO:"mute-audio",MUTE_VIDEO:"mute-video",UNMUTE_AUDIO:"unmute-audio",UNMUTE_VIDEO:"unmute-video",CLIENT_BANNED:"client-banned",NETWORK_QUALITY:"network-quality",AUDIO_VOLUME:"audio-volume",SEI_MESSAGE:Vi,ERROR:"error"},rC="player-state-changed",_k="screen-sharing-stopped",yk="connection-state-changed",PE="device-auto-recovered",Hf="error",eo="player-state-changed",dS=function(){function r(v){x(this,r);var f=v.getUserId();this.log_=Bt.createLogger({id:f,userId:f,sdkAppId:v.getSDKAppId()}),this.prevReport_={},this.prevEncoderImplementation_="",this.prevQualityLimitationReason_="",this.prevDecoderImplementationMap_=new Map}var c,u,d,p;return B(r,[{key:"getSenderStats",value:(p=D(regeneratorRuntime.mark(function v(f){var y,I,T,b=this;return regeneratorRuntime.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(y={audio:{bytesSent:0,packetsSent:0,audioLevel:0,totalAudioEnergy:0},video:{bytesSent:0,packetsSent:0,framesEncoded:0,frameWidth:0,frameHeight:0,framesSent:0,fpsCapture:0,smallFramesEncoded:0,smallFPSCapture:0,smallFramesSent:0},rtt:0},I=f.getPeerConnection(),T=f.getSSRC(),!I){k.next=14;break}return k.prev=4,k.next=7,I.getStats();case 7:k.sent.forEach(function(N){if(N.type==="outbound-rtp")if(N.mediaType===An){if(!Vc&&kt(N.trackId))return;N.ssrc!==T.video||kt(N.encoderImplementation)||b.prevEncoderImplementation_===N.encoderImplementation||(b.log_.info("encoderImplementation change to ".concat(N.encoderImplementation)),b.prevEncoderImplementation_=N.encoderImplementation),N.ssrc!==T.video||kt(N.qualityLimitationReason)||b.prevQualityLimitationReason_===N.qualityLimitationReason||(b.log_.info("qualityLimitationReason change to ".concat(N.qualityLimitationReason)),b.prevQualityLimitationReason_=N.qualityLimitationReason);var O=f.getSSRC();N.ssrc===O.video?(y.video.bytesSent=N.bytesSent,y.video.packetsSent=N.packetsSent,y.video.framesEncoded=N.framesEncoded):(y.video.smallBytesSent=N.bytesSent,y.video.smallFramesEncoded=N.framesEncoded)}else N.mediaType===ln&&(y.audio.bytesSent=N.bytesSent,y.audio.packetsSent=N.packetsSent);else if(N.type==="candidate-pair")NE(N)&&ha(N.currentRoundTripTime)&&(y.rtt=Math.floor(1e3*N.currentRoundTripTime));else if(N.type==="track")if(kt(N.frameWidth)||(N.trackIdentifier===f.getLocalStreamVideoTrackId()?(y.video.frameWidth=N.frameWidth,y.video.frameHeight=N.frameHeight,y.video.framesSent=N.framesSent):(y.video.smallFrameWidth=N.frameWidth,y.video.smallFrameHeight=N.frameHeight,y.video.smallFramesSent=N.framesSent)),kt(N.audioLevel)){if(Th){var F;y.audio.audioLevel=((F=f.getLocalStream())===null||F===void 0?void 0:F.getInternalAudioLevel())||0}}else y.audio.audioLevel=N.audioLevel||0;else N.type==="media-source"&&(N.kind===ln?(y.audio.audioLevel=N.audioLevel||0,y.audio.totalAudioEnergy=N.totalAudioEnergy||0):N.kind===An&&(N.trackIdentifier===f.getLocalStreamVideoTrackId()?y.video.fpsCapture=N.framesPerSecond:y.video.smallFPSCapture=N.framesPerSecond))}),k.next=14;break;case 11:k.prev=11,k.t0=k.catch(4),this.log_.warn("failed to getStats on sender connection");case 14:return k.abrupt("return",y);case 15:case"end":return k.stop()}},v,this,[[4,11]])})),function(v){return p.apply(this,arguments)})},{key:"getReceiverStats",value:(d=D(regeneratorRuntime.mark(function v(f){var y,I,T=this;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(y={tinyId:f.getTinyId(),userId:f.getUserId(),rtt:0,hasAudio:!1,hasVideo:!1,hasAuxiliary:!1,audio:{bytesReceived:0,packetsReceived:0,packetsLost:0,jitter:0,audioLevel:0,totalAudioEnergy:0},video:{bytesReceived:0,packetsReceived:0,packetsLost:0,framesReceived:0,framesDecoded:0,frameWidth:0,frameHeight:0},auxiliary:{bytesReceived:0,packetsReceived:0,packetsLost:0,framesReceived:0,framesDecoded:0,frameWidth:0,frameHeight:0}},!(I=f.getPeerConnection())){b.next=13;break}return b.prev=3,b.next=6,I.getStats();case 6:b.sent.forEach(function(k){if(k.type==="inbound-rtp"){if(k.mediaType===ln)y.audio.packetsReceived=k.packetsReceived,y.audio.bytesReceived=k.bytesReceived,y.audio.packetsLost=k.packetsLost,y.audio.jitter=k.jitter,y.hasAudio=!0;else if(k.mediaType===An){if(Vc&&k.bytesReceived===0)return;var N=f.getSSRC();k.ssrc===N.video&&(y.video.packetsReceived=k.packetsReceived,y.video.bytesReceived=k.bytesReceived,y.video.packetsLost=k.packetsLost,y.video.framesReceived=k.framesReceived,y.video.framesDecoded=k.framesDecoded,y.video.fpsDecoded=k.framesPerSecond,y.hasVideo=!0,!k.decoderImplementation||T.prevDecoderImplementationMap_.has(y.userId)&&T.prevDecoderImplementationMap_.get(y.userId)===k.decoderImplementation||(Bt.info("[".concat(y.userId,"] decoderImplementation change to ").concat(k.decoderImplementation)),T.prevDecoderImplementationMap_.set(y.userId,k.decoderImplementation))),k.ssrc===N.auxiliary&&(y.auxiliary.packetsReceived=k.packetsReceived,y.auxiliary.bytesReceived=k.bytesReceived,y.auxiliary.packetsLost=k.packetsLost,y.auxiliary.framesReceived=k.framesReceived,y.auxiliary.framesDecoded=k.framesDecoded,y.auxiliary.fpsDecoded=k.framesPerSecond,y.hasAuxiliary=!0)}}else k.type==="track"?(kt(k.frameWidth)||(k.trackIdentifier===f.getMainStreamVideoTrackId()&&(y.video.frameWidth=k.frameWidth,y.video.frameHeight=k.frameHeight),k.trackIdentifier===f.getAuxStreamVideoTrackId()&&(y.auxiliary.frameWidth=k.frameWidth,y.auxiliary.frameHeight=k.frameHeight)),kt(k.audioLevel)||(y.audio.audioLevel=k.audioLevel||0,y.audio.totalAudioEnergy=k.totalAudioEnergy||0)):k.type==="candidate-pair"&&NE(k)&&ha(k.currentRoundTripTime)&&(y.rtt=Math.floor(1e3*k.currentRoundTripTime))}),b.next=13;break;case 10:b.prev=10,b.t0=b.catch(3),this.log_.warn("failed to getStats on receiver connection");case 13:return b.abrupt("return",y);case 14:case"end":return b.stop()}},v,this,[[3,10]])})),function(v){return d.apply(this,arguments)})},{key:"getStats",value:(u=D(regeneratorRuntime.mark(function v(f,y){var I,T,b,k,N,O,F;return regeneratorRuntime.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(I={},!f){G.next=5;break}return G.next=4,this.getSenderStats(f);case 4:I=G.sent;case 5:T=[],b=ke(y),G.prev=7,b.s();case 9:if((k=b.n()).done){G.next=17;break}return(N=Pe(k.value,2))[0],O=N[1],G.next=13,this.getReceiverStats(O);case 13:F=G.sent,T.push(F);case 15:G.next=9;break;case 17:G.next=22;break;case 19:G.prev=19,G.t0=G.catch(7),b.e(G.t0);case 22:return G.prev=22,b.f(),G.finish(22);case 25:return G.abrupt("return",{senderStats:I,receiverStats:T});case 26:case"end":return G.stop()}},v,this,[[7,19,22,25]])})),function(v,f){return u.apply(this,arguments)})},{key:"getDifferenceValue",value:function(v,f){if(hd(v))return f;var y=f-v;return y<0?0:y}},{key:"prepareReport",value:function(v){var f=this,y=v.stats,I=v.report,T=v.freezeMap;if(!hd(y.senderStats)){var b={uint32_audio_level:1e8*y.senderStats.audio.audioLevel,uint32_audio_energy:1e6*y.senderStats.audio.totalAudioEnergy,uint32_audio_codec_bitrate:y.senderStats.audio.bytesSent,audioLevel:y.senderStats.audio.audioLevel},k=[],N={uint32_video_stream_type:2,uint32_video_codec_fps:y.senderStats.video.framesSent,uint32_video_capture_fps:y.senderStats.video.fpsCapture,uint32_video_width:y.senderStats.video.frameWidth,uint32_video_height:y.senderStats.video.frameHeight,uint32_video_codec_bitrate:y.senderStats.video.bytesSent,uint32_video_enc_fps:y.senderStats.video.framesEncoded};if(k.push(N),y.senderStats.video.smallBytesSent){var O={uint32_video_stream_type:3,uint32_video_codec_fps:y.senderStats.video.smallFramesSent||0,uint32_video_capture_fps:y.senderStats.video.smallFPSCapture||0,uint32_video_width:y.senderStats.video.smallFrameWidth||0,uint32_video_height:y.senderStats.video.smallFrameHeight||0,uint32_video_codec_bitrate:y.senderStats.video.smallBytesSent,uint32_video_enc_fps:y.senderStats.video.smallFramesEncoded||0};k.push(O)}var F={uint32_bitrate:"",uint32_rtt:y.senderStats.rtt};I.msg_up_stream_info={msg_audio_status:b,msg_video_status:k,msg_network_status:F}}I.msg_down_stream_info=[],y.receiverStats.forEach(function(je){var Re={};if(Re.msg_user_info={str_identifier:je.userId,uint64_tinyid:je.tinyId},Re.msg_network_status={uint32_rtt:je.rtt},Re.msg_video_status={},je.hasAudio){var Oe={uint32_audio_codec_bitrate:je.audio.bytesReceived,uint32_audio_total_bitrate:je.audio.bytesReceived,uint32_audio_level:1e8*je.audio.audioLevel,uint32_audio_energy:1e6*je.audio.totalAudioEnergy,uint32_audio_receive:je.audio.packetsReceived,uint32_audio_origin_lost:je.audio.packetsLost,audioLevel:je.audio.audioLevel};Re.msg_audio_status=Oe}if(Re.msg_video_status=[],je.hasVideo){var qe=T.get(je.userId+"_"+kr),$e=qe?qe.duration:0,Tn={uint32_video_stream_type:2,uint32_video_receive_fps:je.video.framesReceived,uint32_video_width:je.video.frameWidth,uint32_video_height:je.video.frameHeight,uint32_video_codec_bitrate:je.video.bytesReceived,uint32_video_receive:je.video.packetsReceived,uint32_video_origin_lost:je.video.packetsLost,uint32_video_block_time:$e,uint32_video_dec_fps:je.video.fpsDecoded};Re.msg_video_status.push(Tn)}if(je.hasAuxiliary){var Q=T.get(je.userId+"_"+Ni),j=Q?Q.duration:0,le={uint32_video_stream_type:7,uint32_video_receive_fps:je.auxiliary.framesReceived,uint32_video_width:je.auxiliary.frameWidth,uint32_video_height:je.auxiliary.frameHeight,uint32_video_codec_bitrate:je.auxiliary.bytesReceived,uint32_video_receive:je.auxiliary.packetsReceived+je.auxiliary.packetsLost,uint32_video_origin_lost:je.auxiliary.packetsLost,uint32_video_block_time:j,uint32_video_dec_fps:je.auxiliary.fpsDecoded};Re.msg_video_status.push(le)}I.msg_down_stream_info.push(Re)});var G=this.prevReport_;this.prevReport_=JSON.parse(JSON.stringify(I));var P=G.msg_up_stream_info.msg_audio_status,K=I.msg_up_stream_info.msg_audio_status,X=this.getDifferenceValue(P.uint32_audio_codec_bitrate,K.uint32_audio_codec_bitrate);K.uint32_audio_codec_bitrate=8*X/2;var oe=G.msg_up_stream_info.msg_video_status;I.msg_up_stream_info.msg_video_status.forEach(function(je,Re){var Oe=oe[Re],qe=0,$e=0,Tn=0;Oe&&(qe=Oe.uint32_video_codec_bitrate,$e=Oe.uint32_video_enc_fps,Tn=Oe.uint32_video_codec_fps);var Q=f.getDifferenceValue(qe,je.uint32_video_codec_bitrate);je.uint32_video_codec_bitrate=8*Q/2,je.uint32_video_enc_fps=f.getDifferenceValue($e,je.uint32_video_enc_fps)/2,je.uint32_video_codec_fps=f.getDifferenceValue(Tn,je.uint32_video_codec_fps)/2});var Ce=I.msg_down_stream_info,Ve=G.msg_down_stream_info;return Ce.forEach(function(je){var Re=Ve.find(function(j){return j.msg_user_info.uint64_tinyid===je.msg_user_info.uint64_tinyid});if(Re){if(je.msg_audio_status&&Re.msg_audio_status){var Oe=je.msg_audio_status,qe=Re.msg_audio_status;Oe.uint32_audio_origin_lost=f.getDifferenceValue(qe.uint32_audio_origin_lost,Oe.uint32_audio_origin_lost),Oe.uint32_audio_receive=f.getDifferenceValue(qe.uint32_audio_receive,Oe.uint32_audio_receive),Oe.uint32_audio_receive+=Oe.uint32_audio_origin_lost;var $e=f.getDifferenceValue(qe.uint32_audio_codec_bitrate,Oe.uint32_audio_codec_bitrate);Oe.uint32_audio_codec_bitrate=8*$e/2,Oe.uint32_audio_total_bitrate=8*$e/2}if(je.msg_video_status&&Re.msg_video_status){var Tn=je.msg_video_status,Q=Re.msg_video_status;Tn.forEach(function(j,le){var fe=Q[le],Ie=0,Ne=0,lt=0,Dt=0;fe&&(Ie=fe.uint32_video_receive,Ne=fe.uint32_video_origin_lost,lt=fe.uint32_video_codec_bitrate,Dt=fe.uint32_video_receive_fps),j.uint32_video_origin_lost=f.getDifferenceValue(Ne,j.uint32_video_origin_lost),j.uint32_video_receive=f.getDifferenceValue(Ie,j.uint32_video_receive)+j.uint32_video_origin_lost;var Ut=f.getDifferenceValue(lt,j.uint32_video_codec_bitrate);j.uint32_video_codec_bitrate=8*Ut/2;var St=f.getDifferenceValue(Dt,j.uint32_video_receive_fps);j.uint32_video_receive_fps=St/2})}}}),I.msg_up_stream_info.msg_network_status.uint32_bitrate=I.msg_up_stream_info.msg_audio_status.uint32_audio_codec_bitrate+I.msg_up_stream_info.msg_video_status[0].uint32_video_codec_bitrate,I}},{key:"getStatsReport",value:(c=D(regeneratorRuntime.mark(function v(f){var y,I,T,b,k;return regeneratorRuntime.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return y=f.uplinkConnection,I=f.downlinkConnections,T=f.freezeMap,b={msg_up_stream_info:{msg_audio_status:{uint32_audio_format:0,uint32_audio_sample_rate:0,uint32_audio_codec_bitrate:0,uint32_audio_receive:0,uint32_audio_origin_lost:0,uint32_audio_level:0,uint32_audio_energy:0,audioLevel:0},msg_video_status:[{uint32_video_stream_type:0,uint32_video_codec_fps:0,uint32_video_capture_fps:0,uint32_video_width:0,uint32_video_height:0,uint32_video_codec_bitrate:0,uint32_video_receive:0,uint32_video_origin_lost:0,uint32_video_final_lost:0,uint32_video_enc_fps:0}],msg_network_status:{uint32_bitrate:0,uint32_rtt:0,uint32_lost:0},msg_qos:[{uint32_video_fps:0,uint32_video_width:0,uint32_video_height:0,uint32_video_bitrate:0,uint32_audio_bitrate:0,uint32_video_stream_type:0}]},msg_down_stream_info:[{msg_user_info:{str_identifier:"",uint64_tinyid:""},msg_audio_status:{uint32_audio_format:0,uint32_audio_sample_rate:0,uint32_audio_codec_bitrate:0,uint32_audio_total_bitrate:0,uint32_audio_level:0,uint32_audio_energy:0,uint32_audio_receive:0,uint32_audio_origin_lost:0,uint32_audio_final_lost:0,audioLevel:0},msg_video_status:[{uint32_video_stream_type:0,uint32_video_receive_fps:0,uint32_video_width:0,uint32_video_height:0,uint32_video_codec_bitrate:0,uint32_video_receive:0,uint32_video_origin_lost:0,uint32_video_block_time:0,uint32_video_dec_fps:0}],msg_network_status:{uint32_bitrate:0,uint32_rtt:0,uint32_lost:0,uint32_jitter:0},msg_qos:[{uint32_video_fps:0,uint32_video_width:0,uint32_video_height:0,uint32_video_bitrate:0,uint32_audio_bitrate:0,uint32_video_stream_type:0}]}]},JSON.stringify(this.prevReport_)==="{}"&&(this.prevReport_=JSON.parse(JSON.stringify(b))),N.next=5,this.getStats(y,I);case 5:return k=N.sent,this.prepareReport({stats:k,report:b,freezeMap:T}),N.abrupt("return",b);case 8:case"end":return N.stop()}},v,this)})),function(v){return c.apply(this,arguments)})}]),r}(),iC=function(){function r(d){var p=d.signalChannel,v=d.connections,f=d.client;x(this,r),this.client_=f,this.signalChannel_=p,this.connections_=v,this.client_=f,this.log_=Bt.createLogger({id:"q|"+this.client_.getUserId(),userId:this.client_.getUserId(),sdkAppId:this.client_.getSDKAppId()}),this.uplinkConnection_=null,this.uplinkNetworkQuality_=0,this.uplinkRTT_=0,this.uplinkLoss_=0,this.downlinkNetworkQuality_=0,this.downlinkRTT_=0,this.downlinkLoss_=0,this.downlinkPrevStatMap_=new Map,this.downlinkLossAndRTTMap_=new Map,this.interval_=-1,this.emitter_=new Wc,this.initialize()}var c,u;return B(r,[{key:"uplinkNetworkQuality",get:function(){return this.uplinkNetworkQuality_},set:function(d){d!==this.uplinkNetworkQuality_&&this.log_.info("uplink network quality change ".concat(this.uplinkNetworkQuality," -> ").concat(d,", rtt: ").concat(this.uplinkRTT_,", loss: ").concat(this.uplinkLoss_)),this.uplinkNetworkQuality_=d}},{key:"downlinkNetworkQuality",get:function(){return this.downlinkNetworkQuality_},set:function(d){if(d!==this.downlinkNetworkQuality_){var p=this.getAverageLossAndRTT(de(this.downlinkLossAndRTTMap_.values())),v=p.rtt,f=p.loss;this.log_.info("downlink network quality change ".concat(this.downlinkNetworkQuality," -> ").concat(d,", rtt: ").concat(v,", loss: ").concat(f))}this.downlinkNetworkQuality_=d}},{key:"initialize",value:function(){var d=this;this.signalChannel_.on(wr.UPLINK_NETWORK_STATS,function(p){d.handleUplinkNetworkQuality(p)}),this.signalChannel_.on(IE,this.handleSignalConnectionStateChange.bind(this)),this.start()}},{key:"handleUplinkNetworkQuality",value:function(d){if(!this.uplinkConnection_)return this.uplinkNetworkQuality=0,this.uplinkLoss_=0,void(this.uplinkRTT_=0);var p=this.uplinkConnection_.getPeerConnection();if(p&&this.isPeerConnectionDisconnected(p))return this.uplinkNetworkQuality=6,this.uplinkLoss_=0,void(this.uplinkRTT_=0);if(d.data.code===0){var v=d.data.data,f=v.expectAudPkg+v.expectVidPkg,y=v.recvAudPkg+v.recvVidPkg,I=f-y,T=v.delay;if(T&&this.updateDelay(T),f===0&&y===0)return;this.uplinkLoss_=I<=0?0:Math.round(I/f*100),this.uplinkRTT_=v.rtt,this.uplinkNetworkQuality=this.getNetworkQuality(this.uplinkLoss_,this.uplinkRTT_)}}},{key:"handleDownlinkNetworkQuality",value:(u=D(regeneratorRuntime.mark(function d(){var p,v,f,y,I,T,b,k,N,O,F,G,P,K,X,oe=this;return regeneratorRuntime.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:if(this.connections_&&this.connections_.size!==0){Ce.next=3;break}return this.downlinkNetworkQuality=0,Ce.abrupt("return");case 3:if(p=de(this.connections_.values()),v=p.filter(function(Ve){return Ve.getPeerConnection()&&Ve.getPeerConnection().connectionState===fy}),p.filter(function(Ve){return Ve.getPeerConnection()&&oe.isPeerConnectionDisconnected(Ve.getPeerConnection())}).length!==p.length){Ce.next=9;break}return this.downlinkNetworkQuality=6,Ce.abrupt("return");case 9:f=0;case 10:if(!(f<v.length)){Ce.next=31;break}return y=v[f].getPeerConnection(),Ce.next=14,this.getStat(y);case 14:if(I=Ce.sent,T=I.rtt,b=I.totalPacketsLost,k=I.totalPacketsReceived,this.downlinkPrevStatMap_.has(y)){Ce.next=21;break}return this.downlinkPrevStatMap_.set(y,{totalPacketsLost:b,totalPacketsReceived:k}),Ce.abrupt("continue",28);case 21:N=0,O=this.downlinkPrevStatMap_.get(y),F=b-O.totalPacketsLost,G=k-O.totalPacketsReceived,N=F<=0||G<0?0:Math.round(F/(F+G)*100),this.downlinkPrevStatMap_.set(y,{totalPacketsLost:b,totalPacketsReceived:k}),this.downlinkLossAndRTTMap_.set(y,{rtt:T,loss:N,userId:v[f].getUserId()});case 28:f++,Ce.next=10;break;case 31:if(de(this.downlinkPrevStatMap_.keys()).forEach(function(Ve){oe.isPeerConnectionDisconnected(Ve)&&(oe.downlinkPrevStatMap_.delete(Ve),oe.downlinkLossAndRTTMap_.delete(Ve))}),this.downlinkLossAndRTTMap_.size!==0){Ce.next=34;break}return Ce.abrupt("return");case 34:P=this.getAverageLossAndRTT(de(this.downlinkLossAndRTTMap_.values())),K=P.rtt,X=P.loss,this.downlinkRTT_=K,this.downlinkLoss_=X,this.downlinkNetworkQuality=this.getNetworkQuality(X,K);case 38:case"end":return Ce.stop()}},d,this)})),function(){return u.apply(this,arguments)})},{key:"getStat",value:(c=D(regeneratorRuntime.mark(function d(p){var v,f,y,I;return regeneratorRuntime.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(v={rtt:0,totalPacketsLost:0,totalPacketsReceived:0},p&&ZR()){T.next=3;break}return T.abrupt("return",v);case 3:f=p.getReceivers(),T.prev=4,y=0;case 6:if(!(y<f.length)){T.next=15;break}return I=f[y],T.next=10,I.getStats();case 10:T.sent.forEach(function(b){b.type==="candidate-pair"&&ha(b.currentRoundTripTime)&&(v.rtt=Math.round(1e3*b.currentRoundTripTime)),b.type!=="inbound-rtp"||b.mediaType!==ln&&b.mediaType!==An||(v.totalPacketsLost+=b.packetsLost,v.totalPacketsReceived+=b.packetsReceived)});case 12:y++,T.next=6;break;case 15:return T.abrupt("return",v);case 18:return T.prev=18,T.t0=T.catch(4),T.abrupt("return",v);case 21:case"end":return T.stop()}},d,null,[[4,18]])})),function(d){return c.apply(this,arguments)})},{key:"getAverageLossAndRTT",value:function(d){var p={rtt:0,loss:0};return Array.isArray(d)&&d.length>0&&(d.forEach(function(v){p.rtt+=v.rtt,p.loss+=v.loss}),Object.keys(p).forEach(function(v){p[v]=Math.round(p[v]/d.length)})),p}},{key:"getNetworkQuality",value:function(d,p){return d>50||p>500?5:d>30||p>350?4:d>20||p>200?3:d>10||p>100?2:d>=0||p>=0?1:0}},{key:"handleSignalConnectionStateChange",value:function(d){d.state===nS?(this.uplinkRTT_=0,this.uplinkLoss_=0,this.uplinkNetworkQuality=6):d.state===Vh&&this.uplinkNetworkQuality===6&&(this.uplinkNetworkQuality=5)}},{key:"handleUplinkConnectionStateChange",value:function(d){var p=d.state;p===Ur?(this.uplinkLoss_=0,this.uplinkRTT_=0,this.uplinkNetworkQuality=6):p===_o&&this.uplinkNetworkQuality===6&&(this.uplinkNetworkQuality=5)}},{key:"isPeerConnectionDisconnected",value:function(d){return!(!d||d.connectionState!==QT&&d.connectionState!==XT&&d.connectionState!==py)}},{key:"setUplinkConnection",value:function(d){this.uplinkConnection_=d,this.uplinkConnection_?this.uplinkConnection_.on(or.CONNECTION_STATE_CHANGED,this.handleUplinkConnectionStateChange.bind(this)):(this.uplinkNetworkQuality=0,this.uplinkRTT_=0,this.uplinkLoss_=0)}},{key:"start",value:function(){var d=this;this.interval_===-1?(this.log_.info("start network quality calculating"),this.interval_=ii.setInterval(function(){d.handleDownlinkNetworkQuality(),Me.emit(mE,{client:d.client_,uplinkNetworkQuality:d.uplinkNetworkQuality,downlinkNetworkQuality:d.downlinkNetworkQuality,uplinkRTT:d.uplinkRTT_,uplinkLoss:d.uplinkLoss_,downlinkRTT:d.downlinkRTT_,downlinkLoss:d.downlinkLoss_,downlinkLossAndRTTMap:d.downlinkLossAndRTTMap_}),d.emitter_.emit(Er.NETWORK_QUALITY,{uplinkNetworkQuality:d.uplinkNetworkQuality,downlinkNetworkQuality:d.downlinkNetworkQuality,uplinkRTT:d.uplinkRTT_,uplinkLoss:d.uplinkLoss_,downlinkRTT:d.downlinkRTT_,downlinkLoss:d.downlinkLoss_})},2e3)):this.log_.info("network quality calculating is already started")}},{key:"stop",value:function(){this.log_.info("stop network quality calculating"),this.interval_!==-1&&(ii.clearInterval(this.interval_),this.interval_=-1)}},{key:"on",value:function(d,p){this.emitter_.on(d,p)}},{key:"updateDelay",value:function(d){var p=this;d.forEach(function(v){var f=v.srcTinyId,y=v.videoDelay,I=v.audioDelay,T=p.connections_.get(f);T&&T.setDelay({videoDelay:y,audioDelay:I})})}}]),r}(),oC=function(){function r(p){x(this,r),this.log_=Bt.createLogger({id:p.client.getUserId(),userId:p.client.getUserId(),sdkAppId:p.client.getSDKAppId()}),this.localStream_=null,this.prevDevices_=[],this.initialize()}var c,u,d;return B(r,[{key:"initialize",value:(d=D(regeneratorRuntime.mark(function p(){return regeneratorRuntime.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:navigator.mediaDevices&&(this.onDeviceChange=this.onDeviceChange.bind(this),navigator.mediaDevices.addEventListener("devicechange",this.onDeviceChange));case 1:case"end":return v.stop()}},p,this)})),function(){return d.apply(this,arguments)})},{key:"destroy",value:function(){navigator.mediaDevices&&navigator.mediaDevices.removeEventListener("devicechange",this.onDeviceChange)}},{key:"onDeviceChange",value:(u=D(regeneratorRuntime.mark(function p(){var v,f,y,I=this;return regeneratorRuntime.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(this.localStream_&&this.localStream_.getMediaStream()&&!this.localStream_.getScreen()){T.next=2;break}return T.abrupt("return");case 2:return T.next=4,Qr.getDevices();case 4:v=T.sent,f=v.filter(function(b){return I.prevDevices_.findIndex(function(k){var N=k.deviceId;return b.deviceId===N})<0}),y=this.prevDevices_.filter(function(b){return v.findIndex(function(k){var N=k.deviceId;return b.deviceId===N})<0}),f.length>0&&this.handleDeviceAdded(this.prevDevices_,f),y.length>0&&this.handleDeviceRemoved(v,y),this.prevDevices_=v;case 10:case"end":return T.stop()}},p,this)})),function(){return u.apply(this,arguments)})},{key:"setLocalStream",value:(c=D(regeneratorRuntime.mark(function p(v){return regeneratorRuntime.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!v){f.next=4;break}return f.next=3,Qr.getDevices();case 3:this.prevDevices_=f.sent;case 4:this.localStream_=v;case 5:case"end":return f.stop()}},p,this)})),function(p){return c.apply(this,arguments)})},{key:"handleDeviceAdded",value:function(p,v){this.log_.warn("devicesAdded: ".concat(JSON.stringify(v))),this.localStream_.updateDeviceIdInUse();var f=v.filter(function(N){return N.kind===oI}),y=v.filter(function(N){return N.kind===mf}),I=p.filter(function(N){return N.kind===oI}),T=p.filter(function(N){return N.kind===mf}),b=f.length>0&&I.length===0&&this.localStream_.getVideo(),k=y.length>0&&T.length===0&&this.localStream_.getAudio();if(k&&b)return this.log_.info("new microphone and camera detected, but there was no device before."),void this.localStream_.updateStream({audio:!0,video:!0,cameraId:f[0].deviceId,microphoneId:y[0].deviceId});b&&(this.log_.info("new camera detected, but there was no camera before."),this.localStream_.updateStream({audio:!1,video:!0,cameraId:f[0].deviceId})),k&&(this.log_.info("new microphone detected, but there was no microphone before."),this.localStream_.updateStream({audio:!0,video:!1,microphoneId:y[0].deviceId}))}},{key:"handleDeviceRemoved",value:function(p,v){this.log_.warn("devicesRemoved: ".concat(JSON.stringify(v))),this.localStream_.updateDeviceIdInUse();var f=!1,y=!1,I=this.localStream_.getCameraId(),T=this.localStream_.getMicrophoneId();if(T==="default"){var b=this.localStream_.getMicrophoneGroupId(),k=p.filter(function(N){return N.deviceId==="default"&&N.kind===mf})[0];k&&k.groupId!==b&&(y=!0)}if(v.forEach(function(N){var O=N.deviceId;I.length>0&&O===I?f=!0:T.length>0&&O===T&&(y=!0)}),f&&y)return this.log_.warn("current camera and microphone in use is lost, cameraId: ".concat(I,", microphoneId: ").concat(T)),void((this.localStream_.getAudio()||this.localStream_.getVideo())&&this.localStream_.updateStream({video:!0,audio:!0}));f&&(this.log_.warn("current camera in use is lost, deviceId: ".concat(I)),this.localStream_.getVideo()&&this.localStream_.updateStream({video:!0,audio:!1})),y&&(this.log_.warn("current microphone in use is lost, deviceId: ".concat(T)),this.localStream_.getAudio()&&this.localStream_.updateStream({video:!1,audio:!0}))}}]),r}(),Sk=ee.RangeError,Ik=ee.RangeError,aC=ee.String,sC=Math.floor,xE=ve(function(r){var c=hn(an(this)),u="",d=Ia(r);if(d<0||d==1/0)throw Sk("Wrong number of repetitions");for(;d>0;(d>>>=1)&&(c+=c))1&d&&(u+=c);return u}),cC=ve("".slice),Ev=ve(1 .toFixed),$h=function(r,c,u){return c===0?u:c%2==1?$h(r,c-1,u*r):$h(r*r,c/2,u)},Kh=function(r,c,u){for(var d=-1,p=u;++d<6;)p+=c*r[d],r[d]=p%1e7,p=sC(p/1e7)},UE=function(r,c){for(var u=6,d=0;--u>=0;)d+=r[u],r[u]=sC(d/c),d=d%c*1e7},uC=function(r){for(var c=6,u="";--c>=0;)if(u!==""||c===0||r[c]!==0){var d=aC(r[c]);u=u===""?d:u+xE("0",7-d.length)+d}return u},Ek=xe(function(){return Ev(8e-5,3)!=="0.000"||Ev(.9,0)!=="1"||Ev(1.255,2)!=="1.25"||Ev(0xde0b6b3a7640080,0)!=="1000000000000000128"})||!xe(function(){Ev({})});cn({target:"Number",proto:!0,forced:Ek},{toFixed:function(r){var c,u,d,p,v=of(this),f=Ia(r),y=[0,0,0,0,0,0],I="",T="0";if(f<0||f>20)throw Ik("Incorrect fraction digits");if(v!=v)return"NaN";if(v<=-1e21||v>=1e21)return aC(v);if(v<0&&(I="-",v=-v),v>1e-21)if(u=(c=function(b){for(var k=0,N=b;N>=4096;)k+=12,N/=4096;for(;N>=2;)k+=1,N/=2;return k}(v*$h(2,69,1))-69)<0?v*$h(2,-c,1):v/$h(2,c,1),u*=4503599627370496,(c=52-c)>0){for(Kh(y,0,u),d=f;d>=7;)Kh(y,1e7,0),d-=7;for(Kh(y,$h(10,d,1),0),d=c-1;d>=23;)UE(y,1<<23),d-=23;UE(y,1<<d),Kh(y,1,1),UE(y,2),T=uC(y)}else Kh(y,0,u),Kh(y,1<<-c,0),T=uC(y)+xE("0",f);return T=f>0?I+((p=T.length)<=f?"0."+xE("0",f-p)+T:cC(T,0,p-f)+"."+cC(T,p-f)):I+T}});var ys,Ss=function(r,c,u){return u.get&&lr(u.get,c,{getter:!0}),u.set&&lr(u.set,c,{setter:!0}),Yn.f(r,c,u)},Tk=function(r,c,u,d){try{return d?c(Sn(u)[0],u[1]):c(u)}catch(p){Kd(r,"throw",p)}},lC=ee.Array,$f=function(r){var c=fr(r),u=pc(this),d=arguments.length,p=d>1?arguments[1]:void 0,v=p!==void 0;v&&(p=Ma(p,d>2?arguments[2]:void 0));var f,y,I,T,b,k,N=Su(c),O=0;if(!N||this==lC&&Jg(N))for(f=Pi(c),y=u?new this(f):lC(f);f>O;O++)k=v?p(c[O],O):c[O],yu(y,O,k);else for(b=(T=bc(c,N)).next,y=u?new this:[];!(I=dt(b,T)).done;O++)k=v?Tk(T,p,[I.value,O],!0):I.value,yu(y,O,k);return y.length=O,y},GE=/[^\0-\u007E]/,FE=/[.\u3002\uFF0E\uFF61]/g,VE="Overflow: input needs wider integers to process",dC=ee.RangeError,Mk=ve(FE.exec),pd=Math.floor,BE=String.fromCharCode,hC=ve("".charCodeAt),pC=ve([].join),fd=ve([].push),Rk=ve("".replace),Ck=ve("".split),bk=ve("".toLowerCase),Kf=function(r){return r+22+75*(r<26)},Wf=function(r,c,u){var d=0;for(r=u?pd(r/700):r>>1,r+=pd(r/c);r>455;)r=pd(r/35),d+=36;return pd(d+36*r/(r+38))},Ak=function(r){var c,u,d=[],p=(r=function(K){for(var X=[],oe=0,Ce=K.length;oe<Ce;){var Ve=hC(K,oe++);if(Ve>=55296&&Ve<=56319&&oe<Ce){var je=hC(K,oe++);(64512&je)==56320?fd(X,((1023&Ve)<<10)+(1023&je)+65536):(fd(X,Ve),oe--)}else fd(X,Ve)}return X}(r)).length,v=128,f=0,y=72;for(c=0;c<r.length;c++)(u=r[c])<128&&fd(d,BE(u));var I=d.length,T=I;for(I&&fd(d,"-");T<p;){var b=2147483647;for(c=0;c<r.length;c++)(u=r[c])>=v&&u<b&&(b=u);var k=T+1;if(b-v>pd((2147483647-f)/k))throw dC(VE);for(f+=(b-v)*k,v=b,c=0;c<r.length;c++){if((u=r[c])<v&&++f>2147483647)throw dC(VE);if(u==v){for(var N=f,O=36;;){var F=O<=y?1:O>=y+26?26:O-y;if(N<F)break;var G=N-F,P=36-F;fd(d,BE(Kf(F+G%P))),N=pd(G/P),O+=36}fd(d,BE(Kf(N))),y=Wf(f,k,T==I),f=0,T++}}f++,v++}return pC(d,"")},fC=tm.codeAt,kk=Tr.set,Wh=Tr.getterFor("URL"),gC=Zp.URLSearchParams,wk=Zp.getState,zf=ee.URL,jE=ee.TypeError,hS=ee.parseInt,mC=Math.floor,vC=Math.pow,$o=ve("".charAt),ec=ve(/./.exec),Tv=ve([].join),Dk=ve(1 .toString),_C=ve([].pop),zh=ve([].push),yC=ve("".replace),Ok=ve([].shift),qE=ve("".split),Mv=ve("".slice),Yf=ve("".toLowerCase),Nk=ve([].unshift),SC=/[a-z]/i,Lk=/[\d+-.a-z]/i,pS=/\d/,Pk=/^0x/i,xk=/^[0-7]+$/,Rv=/^\d+$/,HE=/^[\da-f]+$/i,fS=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Uk=/[\0\t\n\r #/:<>?@[\\\]^|]/,Gk=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,Fk=/[\t\n\r]/g,Cv=function(r){var c,u,d,p;if(typeof r=="number"){for(c=[],u=0;u<4;u++)Nk(c,r%256),r=mC(r/256);return Tv(c,".")}if(typeof r=="object"){for(c="",d=function(v){for(var f=null,y=1,I=null,T=0,b=0;b<8;b++)v[b]!==0?(T>y&&(f=I,y=T),I=null,T=0):(I===null&&(I=b),++T);return T>y&&(f=I,y=T),f}(r),u=0;u<8;u++)p&&r[u]===0||(p&&(p=!1),d===u?(c+=u?":":"::",p=!0):(c+=Dk(r[u],16),u<7&&(c+=":")));return"["+c+"]"}return r},gS={},IC=_v({},gS,{" ":1,'"':1,"<":1,">":1,"`":1}),EC=_v({},IC,{"#":1,"?":1,"{":1,"}":1}),mS=_v({},EC,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),gd=function(r,c){var u=fC(r,0);return u>32&&u<127&&!st(c,r)?r:encodeURIComponent(r)},vS={ftp:21,file:null,http:80,https:443,ws:80,wss:443},bv=function(r,c){var u;return r.length==2&&ec(SC,$o(r,0))&&((u=$o(r,1))==":"||!c&&u=="|")},TC=function(r){var c;return r.length>1&&bv(Mv(r,0,2))&&(r.length==2||(c=$o(r,2))==="/"||c==="\\"||c==="?"||c==="#")},Vk=function(r){return r==="."||Yf(r)==="%2e"},$E={},MC={},KE={},RC={},CC={},WE={},bC={},AC={},_S={},yS={},zE={},YE={},Yh={},md={},a={},t={},o={},e={},n={},l={},h={},_=function(r,c,u){var d,p,v,f=hn(r);if(c){if(p=this.parse(f))throw jE(p);this.searchParams=null}else{if(u!==void 0&&(d=new _(u,!0)),p=this.parse(f,null,d))throw jE(p);(v=wk(new gC)).bindURL(this),this.searchParams=v}};_.prototype={type:"URL",parse:function(r,c,u){var d,p,v,f,y,I=this,T=c||$E,b=0,k="",N=!1,O=!1,F=!1;for(r=hn(r),c||(I.scheme="",I.username="",I.password="",I.host=null,I.port=null,I.path=[],I.query=null,I.fragment=null,I.cannotBeABaseURL=!1,r=yC(r,Gk,"")),r=yC(r,Fk,""),d=$f(r);b<=d.length;){switch(p=d[b],T){case $E:if(!p||!ec(SC,p)){if(c)return"Invalid scheme";T=KE;continue}k+=Yf(p),T=MC;break;case MC:if(p&&(ec(Lk,p)||p=="+"||p=="-"||p=="."))k+=Yf(p);else{if(p!=":"){if(c)return"Invalid scheme";k="",T=KE,b=0;continue}if(c&&(I.isSpecial()!=st(vS,k)||k=="file"&&(I.includesCredentials()||I.port!==null)||I.scheme=="file"&&!I.host))return;if(I.scheme=k,c)return void(I.isSpecial()&&vS[I.scheme]==I.port&&(I.port=null));k="",I.scheme=="file"?T=md:I.isSpecial()&&u&&u.scheme==I.scheme?T=RC:I.isSpecial()?T=AC:d[b+1]=="/"?(T=CC,b++):(I.cannotBeABaseURL=!0,zh(I.path,""),T=n)}break;case KE:if(!u||u.cannotBeABaseURL&&p!="#")return"Invalid scheme";if(u.cannotBeABaseURL&&p=="#"){I.scheme=u.scheme,I.path=Vr(u.path),I.query=u.query,I.fragment="",I.cannotBeABaseURL=!0,T=h;break}T=u.scheme=="file"?md:WE;continue;case RC:if(p!="/"||d[b+1]!="/"){T=WE;continue}T=_S,b++;break;case CC:if(p=="/"){T=yS;break}T=e;continue;case WE:if(I.scheme=u.scheme,p==ys)I.username=u.username,I.password=u.password,I.host=u.host,I.port=u.port,I.path=Vr(u.path),I.query=u.query;else if(p=="/"||p=="\\"&&I.isSpecial())T=bC;else if(p=="?")I.username=u.username,I.password=u.password,I.host=u.host,I.port=u.port,I.path=Vr(u.path),I.query="",T=l;else{if(p!="#"){I.username=u.username,I.password=u.password,I.host=u.host,I.port=u.port,I.path=Vr(u.path),I.path.length--,T=e;continue}I.username=u.username,I.password=u.password,I.host=u.host,I.port=u.port,I.path=Vr(u.path),I.query=u.query,I.fragment="",T=h}break;case bC:if(!I.isSpecial()||p!="/"&&p!="\\"){if(p!="/"){I.username=u.username,I.password=u.password,I.host=u.host,I.port=u.port,T=e;continue}T=yS}else T=_S;break;case AC:if(T=_S,p!="/"||$o(k,b+1)!="/")continue;b++;break;case _S:if(p!="/"&&p!="\\"){T=yS;continue}break;case yS:if(p=="@"){N&&(k="%40"+k),N=!0,v=$f(k);for(var G=0;G<v.length;G++){var P=v[G];if(P!=":"||F){var K=gd(P,mS);F?I.password+=K:I.username+=K}else F=!0}k=""}else if(p==ys||p=="/"||p=="?"||p=="#"||p=="\\"&&I.isSpecial()){if(N&&k=="")return"Invalid authority";b-=$f(k).length+1,k="",T=zE}else k+=p;break;case zE:case YE:if(c&&I.scheme=="file"){T=t;continue}if(p!=":"||O){if(p==ys||p=="/"||p=="?"||p=="#"||p=="\\"&&I.isSpecial()){if(I.isSpecial()&&k=="")return"Invalid host";if(c&&k==""&&(I.includesCredentials()||I.port!==null))return;if(f=I.parseHost(k))return f;if(k="",T=o,c)return;continue}p=="["?O=!0:p=="]"&&(O=!1),k+=p}else{if(k=="")return"Invalid host";if(f=I.parseHost(k))return f;if(k="",T=Yh,c==YE)return}break;case Yh:if(!ec(pS,p)){if(p==ys||p=="/"||p=="?"||p=="#"||p=="\\"&&I.isSpecial()||c){if(k!=""){var X=hS(k,10);if(X>65535)return"Invalid port";I.port=I.isSpecial()&&X===vS[I.scheme]?null:X,k=""}if(c)return;T=o;continue}return"Invalid port"}k+=p;break;case md:if(I.scheme="file",p=="/"||p=="\\")T=a;else{if(!u||u.scheme!="file"){T=e;continue}if(p==ys)I.host=u.host,I.path=Vr(u.path),I.query=u.query;else if(p=="?")I.host=u.host,I.path=Vr(u.path),I.query="",T=l;else{if(p!="#"){TC(Tv(Vr(d,b),""))||(I.host=u.host,I.path=Vr(u.path),I.shortenPath()),T=e;continue}I.host=u.host,I.path=Vr(u.path),I.query=u.query,I.fragment="",T=h}}break;case a:if(p=="/"||p=="\\"){T=t;break}u&&u.scheme=="file"&&!TC(Tv(Vr(d,b),""))&&(bv(u.path[0],!0)?zh(I.path,u.path[0]):I.host=u.host),T=e;continue;case t:if(p==ys||p=="/"||p=="\\"||p=="?"||p=="#"){if(!c&&bv(k))T=e;else if(k==""){if(I.host="",c)return;T=o}else{if(f=I.parseHost(k))return f;if(I.host=="localhost"&&(I.host=""),c)return;k="",T=o}continue}k+=p;break;case o:if(I.isSpecial()){if(T=e,p!="/"&&p!="\\")continue}else if(c||p!="?")if(c||p!="#"){if(p!=ys&&(T=e,p!="/"))continue}else I.fragment="",T=h;else I.query="",T=l;break;case e:if(p==ys||p=="/"||p=="\\"&&I.isSpecial()||!c&&(p=="?"||p=="#")){if((y=Yf(y=k))===".."||y==="%2e."||y===".%2e"||y==="%2e%2e"?(I.shortenPath(),p=="/"||p=="\\"&&I.isSpecial()||zh(I.path,"")):Vk(k)?p=="/"||p=="\\"&&I.isSpecial()||zh(I.path,""):(I.scheme=="file"&&!I.path.length&&bv(k)&&(I.host&&(I.host=""),k=$o(k,0)+":"),zh(I.path,k)),k="",I.scheme=="file"&&(p==ys||p=="?"||p=="#"))for(;I.path.length>1&&I.path[0]==="";)Ok(I.path);p=="?"?(I.query="",T=l):p=="#"&&(I.fragment="",T=h)}else k+=gd(p,EC);break;case n:p=="?"?(I.query="",T=l):p=="#"?(I.fragment="",T=h):p!=ys&&(I.path[0]+=gd(p,gS));break;case l:c||p!="#"?p!=ys&&(p=="'"&&I.isSpecial()?I.query+="%27":I.query+=p=="#"?"%23":gd(p,gS)):(I.fragment="",T=h);break;case h:p!=ys&&(I.fragment+=gd(p,IC))}b++}},parseHost:function(r){var c,u,d;if($o(r,0)=="["){if($o(r,r.length-1)!="]"||!(c=function(p){var v,f,y,I,T,b,k,N=[0,0,0,0,0,0,0,0],O=0,F=null,G=0,P=function(){return $o(p,G)};if(P()==":"){if($o(p,1)!=":")return;G+=2,F=++O}for(;P();){if(O==8)return;if(P()!=":"){for(v=f=0;f<4&&ec(HE,P());)v=16*v+hS(P(),16),G++,f++;if(P()=="."){if(f==0||(G-=f,O>6))return;for(y=0;P();){if(I=null,y>0){if(!(P()=="."&&y<4))return;G++}if(!ec(pS,P()))return;for(;ec(pS,P());){if(T=hS(P(),10),I===null)I=T;else{if(I==0)return;I=10*I+T}if(I>255)return;G++}N[O]=256*N[O]+I,++y!=2&&y!=4||O++}if(y!=4)return;break}if(P()==":"){if(G++,!P())return}else if(P())return;N[O++]=v}else{if(F!==null)return;G++,F=++O}}if(F!==null)for(b=O-F,O=7;O!=0&&b>0;)k=N[O],N[O--]=N[F+b-1],N[F+--b]=k;else if(O!=8)return;return N}(Mv(r,1,-1))))return"Invalid host";this.host=c}else if(this.isSpecial()){if(r=function(p){var v,f,y=[],I=Ck(Rk(bk(p),FE,"."),".");for(v=0;v<I.length;v++)f=I[v],fd(y,Mk(GE,f)?"xn--"+Ak(f):f);return pC(y,".")}(r),ec(fS,r)||(c=function(p){var v,f,y,I,T,b,k,N=qE(p,".");if(N.length&&N[N.length-1]==""&&N.length--,(v=N.length)>4)return p;for(f=[],y=0;y<v;y++){if((I=N[y])=="")return p;if(T=10,I.length>1&&$o(I,0)=="0"&&(T=ec(Pk,I)?16:8,I=Mv(I,T==8?1:2)),I==="")b=0;else{if(!ec(T==10?Rv:T==8?xk:HE,I))return p;b=hS(I,T)}zh(f,b)}for(y=0;y<v;y++)if(b=f[y],y==v-1){if(b>=vC(256,5-v))return null}else if(b>255)return null;for(k=_C(f),y=0;y<f.length;y++)k+=f[y]*vC(256,3-y);return k}(r))===null)return"Invalid host";this.host=c}else{if(ec(Uk,r))return"Invalid host";for(c="",u=$f(r),d=0;d<u.length;d++)c+=gd(u[d],gS);this.host=c}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return st(vS,this.scheme)},shortenPath:function(){var r=this.path,c=r.length;!c||this.scheme=="file"&&c==1&&bv(r[0],!0)||r.length--},serialize:function(){var r=this,c=r.scheme,u=r.username,d=r.password,p=r.host,v=r.port,f=r.path,y=r.query,I=r.fragment,T=c+":";return p!==null?(T+="//",r.includesCredentials()&&(T+=u+(d?":"+d:"")+"@"),T+=Cv(p),v!==null&&(T+=":"+v)):c=="file"&&(T+="//"),T+=r.cannotBeABaseURL?f[0]:f.length?"/"+Tv(f,"/"):"",y!==null&&(T+="?"+y),I!==null&&(T+="#"+I),T},setHref:function(r){var c=this.parse(r);if(c)throw jE(c);this.searchParams.update()},getOrigin:function(){var r=this.scheme,c=this.port;if(r=="blob")try{return new S(r.path[0]).origin}catch{return"null"}return r!="file"&&this.isSpecial()?r+"://"+Cv(this.host)+(c!==null?":"+c:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(r){this.parse(hn(r)+":",$E)},getUsername:function(){return this.username},setUsername:function(r){var c=$f(hn(r));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var u=0;u<c.length;u++)this.username+=gd(c[u],mS)}},getPassword:function(){return this.password},setPassword:function(r){var c=$f(hn(r));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var u=0;u<c.length;u++)this.password+=gd(c[u],mS)}},getHost:function(){var r=this.host,c=this.port;return r===null?"":c===null?Cv(r):Cv(r)+":"+c},setHost:function(r){this.cannotBeABaseURL||this.parse(r,zE)},getHostname:function(){var r=this.host;return r===null?"":Cv(r)},setHostname:function(r){this.cannotBeABaseURL||this.parse(r,YE)},getPort:function(){var r=this.port;return r===null?"":hn(r)},setPort:function(r){this.cannotHaveUsernamePasswordPort()||((r=hn(r))==""?this.port=null:this.parse(r,Yh))},getPathname:function(){var r=this.path;return this.cannotBeABaseURL?r[0]:r.length?"/"+Tv(r,"/"):""},setPathname:function(r){this.cannotBeABaseURL||(this.path=[],this.parse(r,o))},getSearch:function(){var r=this.query;return r?"?"+r:""},setSearch:function(r){(r=hn(r))==""?this.query=null:($o(r,0)=="?"&&(r=Mv(r,1)),this.query="",this.parse(r,l)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var r=this.fragment;return r?"#"+r:""},setHash:function(r){(r=hn(r))!=""?($o(r,0)=="#"&&(r=Mv(r,1)),this.fragment="",this.parse(r,h)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var S=function(r){var c=oa(this,E),u=xs(arguments.length,1)>1?arguments[1]:void 0,d=kk(c,new _(r,!1,u));Et||(c.href=d.serialize(),c.origin=d.getOrigin(),c.protocol=d.getProtocol(),c.username=d.getUsername(),c.password=d.getPassword(),c.host=d.getHost(),c.hostname=d.getHostname(),c.port=d.getPort(),c.pathname=d.getPathname(),c.search=d.getSearch(),c.searchParams=d.getSearchParams(),c.hash=d.getHash())},E=S.prototype,M=function(r,c){return{get:function(){return Wh(this)[r]()},set:c&&function(u){return Wh(this)[c](u)},configurable:!0,enumerable:!0}};if(Et&&(Ss(E,"href",M("serialize","setHref")),Ss(E,"origin",M("getOrigin")),Ss(E,"protocol",M("getProtocol","setProtocol")),Ss(E,"username",M("getUsername","setUsername")),Ss(E,"password",M("getPassword","setPassword")),Ss(E,"host",M("getHost","setHost")),Ss(E,"hostname",M("getHostname","setHostname")),Ss(E,"port",M("getPort","setPort")),Ss(E,"pathname",M("getPathname","setPathname")),Ss(E,"search",M("getSearch","setSearch")),Ss(E,"searchParams",M("getSearchParams")),Ss(E,"hash",M("getHash","setHash"))),sr(E,"toJSON",function(){return Wh(this).serialize()},{enumerable:!0}),sr(E,"toString",function(){return Wh(this).serialize()},{enumerable:!0}),zf){var w=zf.createObjectURL,L=zf.revokeObjectURL;w&&sr(S,"createObjectURL",Ma(w,zf)),L&&sr(S,"revokeObjectURL",Ma(L,zf))}Uo(S,"URL"),cn({global:!0,constructor:!0,forced:!Sm,sham:!Et},{URL:S});var H,ne,ae,he=new Blob(["class VolumeMeter extends AudioWorkletProcessor{constructor(){super();this.volume=0;this.intervalTime=200;this.tick=this.intervalTime;this.isStop=false;this.port.onmessage=event=>{const{data}=event;switch(data.name){case'setIntervalTime':this.intervalTime=data.intervalTime;break;case'stop':this.isStop=true;break}}}process(inputs){const input=inputs[0];if(this.isStop){return false}if(input.length>0){const firstChannel=input[0];let sum=0;let rms;for(let i=0;i<firstChannel.length;++i){sum+=firstChannel[i]*firstChannel[i]}rms=Math.sqrt(sum/firstChannel.length);this.volume=Math.max(rms,this.volume*0.95);this.tick-=firstChannel.length;if(this.tick<0){this.tick+=(this.intervalTime/1000)*sampleRate;this.port.postMessage({volume:this.volume})}}return true}}registerProcessor('volume-meter',VolumeMeter);"],{type:"application/javascript"}),ge=!1,Te=function(){function r(u){x(this,r),this.context_=u.context,this.addModuleToContext()}var c;return B(r,[{key:"addModuleToContext",value:(c=D(regeneratorRuntime.mark(function u(){return regeneratorRuntime.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.prev=0,d.next=3,this.context_.audioWorklet.addModule(URL.createObjectURL(he));case 3:Bt.info("worklet addModule success"),Me.emit(eS),ge=!0,d.next=12;break;case 8:d.prev=8,d.t0=d.catch(0),Bt.info("worklet addModule catch error. ".concat(d.t0.message)),Me.emit(vE);case 12:case"end":return d.stop()}},u,this,[[0,8]])})),function(){return c.apply(this,arguments)})},{key:"initWorkletSuccess",get:function(){return ge}}]),r}(),Ze=function(){function r(c){x(this,r);var u=c.track,d=c.log,p=c.stream;this.volume_=0,this.log_=d,this.track_=u,this.stream_=p,H||(H=new window.AudioContext),this.audioCtx_=H,this.destination_=this.audioCtx_.destination;var v=new MediaStream;v.addTrack(this.track_),this.streamSource_=this.audioCtx_.createMediaStreamSource(v),this.audioWorkletNode_=null,this.scriptProcessorNode_=null,this.interval_=200,Me.on(vv,this.resume,this),Me.on(Qy,this.handleAudioLevelInterval,this),eR?(Me.on(eS,this.initAudioWorklet,this),Me.on(vE,this.initScriptProcessor,this),this.preload()):this.initScriptProcessor()}return B(r,[{key:"preload",value:function(){ne?ne.initWorkletSuccess&&this.initAudioWorklet():ne=new Te({context:H})}},{key:"initAudioWorklet",value:function(){var c=this;if(!this.audioWorkletNode_)try{this.audioWorkletNode_=new AudioWorkletNode(this.audioCtx_,"volume-meter"),this.audioWorkletNode_.port.onmessage=function(u){c.volume_=u.data.volume||0},this.streamSource_.connect(this.audioWorkletNode_).connect(this.destination_),this.handleAudioLevelInterval({interval:this.interval_}),jt.logSuccessEvent({userId:this.stream_.getUserId(),eventType:bI})}catch{jt.logFailedEvent({userId:this.stream_.getUserId(),eventType:bI}),this.initScriptProcessor()}}},{key:"initScriptProcessor",value:function(){var c=this;if(!this.scriptProcessorNode_)try{this.scriptProcessorNode_=this.audioCtx_.createScriptProcessor(2048,1,1),this.scriptProcessorNode_.onaudioprocess=function(u){for(var d=u.inputBuffer.getChannelData(0),p=0,v=0;v<d.length;++v)p+=d[v]*d[v];c.volume_=Math.sqrt(p/d.length)||0},this.streamSource_.connect(this.scriptProcessorNode_),this.scriptProcessorNode_.connect(this.destination_)}catch(u){this.log_.error("volumeMeter init script processor error: "+u)}}},{key:"destroy",value:function(){this.streamSource_&&this.streamSource_.disconnect(),this.scriptProcessorNode_&&(this.scriptProcessorNode_.onaudioprocess=null,this.scriptProcessorNode_.disconnect()),this.audioWorkletNode_&&(this.audioWorkletNode_.port.postMessage({name:"stop"}),this.audioWorkletNode_.port.onmessage=null,this.audioWorkletNode_.disconnect()),this.audioWorkletNode_=null,this.scriptProcessorNode_=null,this.audioCtx_=null,Me.off(vv,this.resume,this),Me.off(Qy,this.handleAudioLevelInterval,this),Me.off(eS,this.initAudioWorklet,this),Me.off(vE,this.initScriptProcessor,this)}},{key:"resume",value:function(){this.audioCtx_&&this.audioCtx_.resume()}},{key:"getInternalAudioLevel",value:function(){return this.volume_}},{key:"getCalculatedVolume",value:function(){return this.volume_.toFixed(2)}},{key:"handleAudioLevelInterval",value:function(c){var u=c.interval;this.interval_=u,this.audioWorkletNode_&&this.audioWorkletNode_.port.postMessage({name:"setIntervalTime",intervalTime:u})}}]),r}(),Ct=function(){function r(v){x(this,r),this.stream_=v.stream,this.userId_=v.stream.getUserId(),this.log_=this.stream_.getLogger(),this.track_=v.track,v.gainedTrack&&(this.gainedTrack_=v.gainedTrack),this.div_=v.div,this.muted_=v.muted,this.outputDeviceId_=v.outputDeviceId,this.volume_=v.volume,this.pausedRetryCount_=5,this.emitter_=new Wc,this.initializeElement(),this.state_="NONE",this.volumeMeter_=new Ze({stream:this.stream_,track:this.gainedTrack_||this.track_,log:this.log_})}var c,u,d,p;return B(r,[{key:"isPlaying",get:function(){return this.state_==="PLAYING"}},{key:"initializeElement",value:function(){if(this.isAudioElementInit()){var v=new MediaStream;v.addTrack(this.gainedTrack_||this.track_);var f=document.createElement(ln);f.srcObject=v,f.muted=this.muted_,f.setAttribute("id","audio_".concat(this.stream_.getId())),f.setAttribute("autoplay","autoplay"),f.setAttribute("playsinline","playsinline"),this.div_.appendChild(f),this.element_=f}this.handleEvents()}},{key:"setMuted",value:function(v){this.element_&&(this.element_.muted=v,this.muted_=v)}},{key:"play",value:(p=D(regeneratorRuntime.mark(function v(){var f;return regeneratorRuntime.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!this.outputDeviceId_||!this.element_){y.next=3;break}return y.next=3,this.element_.setSinkId(this.outputDeviceId_);case 3:if(this.setVolume(this.volume_),y.prev=4,!this.element_){y.next=8;break}return y.next=8,this.element_.play();case 8:y.next=16;break;case 10:if(y.prev=10,y.t0=y.catch(4),this.log_.warn("<audio> play() error: "+y.t0),!(f=y.t0.toString()+" <audio>").startsWith("NotAllowedError")){y.next=16;break}throw new et({code:Ye.PLAY_NOT_ALLOWED,message:f});case 16:case"end":return y.stop()}},v,this,[[4,10]])})),function(){return p.apply(this,arguments)})},{key:"handleEvents",value:function(){this.handleElementEvent=this.handleElementEvent.bind(this),this.handleTrackEvent=this.handleTrackEvent.bind(this),this.element_&&(this.element_.addEventListener(pi,this.handleElementEvent),this.element_.addEventListener(Mr,this.handleElementEvent),this.element_.addEventListener(nd,this.handleElementEvent),this.element_.addEventListener(Ah,this.handleElementEvent)),this.track_.addEventListener(Mr,this.handleTrackEvent),this.track_.addEventListener(Tt,this.handleTrackEvent),this.track_.addEventListener(Pt,this.handleTrackEvent),this.track_.readyState===Mr&&this.handleTrackEvent({type:Mr}),this.track_.muted&&this.handleTrackEvent({type:Tt})}},{key:"handleElementEvent",value:(d=D(regeneratorRuntime.mark(function v(f){var y,I,T,b,k,N,O,F=this;return regeneratorRuntime.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:y=f.type,G.t0=y,G.next=G.t0===pi?4:G.t0===Mr?9:G.t0===nd?12:G.t0===Ah?20:31;break;case 4:return this.log_.info("stream - audio player is starting playing"),this.state_="PLAYING",Me.emit(gs,{stream:this.stream_}),this.emitter_.emit(eo,{state:this.state_,reason:pi}),G.abrupt("break",31);case 9:return this.log_.info("stream - audio player is ended"),this.state_!=="STOPPED"&&(this.state_="STOPPED",this.emitter_.emit(eo,{state:this.state_,reason:Mr})),G.abrupt("break",31);case 12:return this.log_.info("stream - audio player is paused"),this.state_="PAUSED",this.emitter_.emit(eo,{state:this.state_,reason:nd}),(I=this.div_&&document.getElementById(this.div_.id))||this.log_.warn("audio container is not in DOM"),T=ff(),this.pausedRetryCount_>0&&(ha(T)&&T<=70||!I)&&(this.resume(),this.pausedRetryCount_--),G.abrupt("break",31);case 20:if(!this.element_||!this.element_.error){G.next=30;break}return b="".concat(LE(),"/").concat(Ch().name,"/").concat(Ch().version),G.next=24,Qr.getSpeakers();case 24:k=G.sent,N=k[0].label,(O=k.find(function(P){return P.deviceId===F.outputDeviceId_}))&&(N=O.label),this.log_.error("stream - audio player error observed. code: ".concat(this.element_.error.code," message: ").concat(this.element_.error.message," deviceInfo: ").concat(b," speaker: ").concat(N)),jt.uploadEvent("stat-".concat(this.stream_.getType(),"-audio-").concat(RI,"-").concat(this.element_.error.code,"-").concat(b,"-").concat(N),this.element_.error);case 30:return G.abrupt("break",31);case 31:case"end":return G.stop()}},v,this)})),function(v){return d.apply(this,arguments)})},{key:"handleTrackEvent",value:function(v){var f=v.type;switch(f){case Mr:this.log_.info("stream - audio player track is ended"),this.state_!=="STOPPED"&&(this.state_="STOPPED",this.emitter_.emit(eo,{state:this.state_,reason:Mr})),Me.emit(pE,{stream:this.stream_,type:f});break;case Tt:this.log_.info("stream - audio track is unable to provide media output"),this.stream_.isRemote()||QM(),this.state_!=="PAUSED"&&(this.state_="PAUSED",this.emitter_.emit(eo,{state:this.state_,reason:Tt})),Me.emit(hE,{stream:this.stream_,type:f});break;case Pt:this.log_.info("stream - audio track is able to provide media output"),this.state_==="PAUSED"&&(this.state_="PLAYING",this.emitter_.emit(eo,{state:this.state_,reason:Pt}))}}},{key:"unbindEvents",value:function(){this.element_&&(this.element_.removeEventListener(pi,this.handleElementEvent),this.element_.removeEventListener(Mr,this.handleElementEvent),this.element_.removeEventListener(nd,this.handleElementEvent),this.element_.removeEventListener(Ah,this.handleElementEvent)),this.track_&&(this.track_.removeEventListener(Mr,this.handleTrackEvent),this.track_.removeEventListener(Tt,this.handleTrackEvent),this.track_.removeEventListener(Pt,this.handleTrackEvent))}},{key:"setSinkId",value:(u=D(regeneratorRuntime.mark(function v(f){return regeneratorRuntime.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(this.outputDeviceId_===f){y.next=5;break}if(!this.element_){y.next=4;break}return y.next=4,this.element_.setSinkId(f);case 4:this.outputDeviceId_=f;case 5:case"end":return y.stop()}},v,this)})),function(v){return u.apply(this,arguments)})},{key:"setVolume",value:function(v){this.element_&&(this.log_.info("stream - audioElement setVolume to : ".concat(v)),this.element_.volume=v)}},{key:"getAudioLevel",value:function(){return this.volumeMeter_.getCalculatedVolume()}},{key:"getInternalAudioLevel",value:function(){return this.volumeMeter_.getInternalAudioLevel()}},{key:"stop",value:function(){this.unbindEvents(),this.element_&&(this.div_.removeChild(this.element_),this.element_.srcObject=null,this.element_=null),this.volumeMeter_&&(this.volumeMeter_.destroy(),this.volumeMeter_=null)}},{key:"resume",value:(c=D(regeneratorRuntime.mark(function v(){var f;return regeneratorRuntime.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(y.prev=0,this.volumeMeter_&&this.volumeMeter_.resume(),!this.element_){y.next=5;break}return y.next=5,this.element_.play();case 5:y.next=13;break;case 7:if(y.prev=7,y.t0=y.catch(0),this.log_.warn("<audio> play() error: "+y.t0),!(f=rt({key:RM,data:{error:y.t0}})).startsWith("NotAllowedError")){y.next=13;break}throw new et({code:Ye.PLAY_NOT_ALLOWED,message:f});case 13:case"end":return y.stop()}},v,this,[[0,7]])})),function(){return c.apply(this,arguments)})},{key:"on",value:function(v,f){this.emitter_.on(v,f)}},{key:"isAudioElementInit",value:function(){return!(zm==="15.2"||zm==="15.3"||zm==="15.4")||this.stream_.getType()!=="local"||!this.muted_||(this.log_.info("audioElement is muted."),!1)}}]),r}(),wt=Sa.PROPER,dn=Vo.trim;cn({target:"String",proto:!0,forced:(ae="trim",xe(function(){return!!qs[ae]()||"\u200B\x85\u180E"[ae]()!=="\u200B\x85\u180E"||wt&&qs[ae].name!==ae}))},{trim:function(){return dn(this)}});var $t="".concat("trtc_autoplay","_mask"),Kn="".concat("trtc_autoplay","_wrapper"),xn="".concat("trtc_autoplay","_header"),On="".concat("trtc_autoplay","_content"),ar="".concat("trtc_autoplay","_action_wrapper"),yr="".concat("trtc_autoplay","_question"),Mi="".concat("trtc_autoplay","_collapse"),Ko="".concat("trtc_autoplay","_action_confirm"),fa="".concat("trtc_autoplay","_detail"),To="".concat("dialog","-show"),Dr="".concat("dialog","-1"),Wo="".concat("dialog","-2"),eu=!1,Jf=function(){return!!document.querySelector(".".concat(Kn))},zo="".concat(Dh,"/").concat(Ph()?"zh-cn":"en","/tutorial-21-advanced-auto-play-policy.html"),mr="<br><a href='".concat(zo,"' target='_blank'>").concat(Ph()?"\u5176\u4ED6\u65B9\u6848\uFF1F":"Any other solution?","</a>"),tc="".concat(Ph()?"\u6D4F\u89C8\u5668\u81EA\u52A8\u64AD\u653E\u7B56\u7565\uFF1A\u5728\u7528\u6237\u4E0E\u9875\u9762\u4EA7\u751F\u4EA4\u4E92\uFF08\u70B9\u51FB\u3001\u89E6\u6478\uFF09\u4E4B\u524D\uFF0C\u6D4F\u89C8\u5668\u7981\u6B62\u64AD\u653E\u6709\u58F0\u5A92\u4F53\u3002\u8BE5\u5F39\u7A97\u7528\u4E8E\u5E2E\u52A9\u7528\u6237\u6062\u590D\u97F3\u89C6\u9891\u64AD\u653E\u3002".concat(mr):"Autoplay Policy: Before user interacts with the web page (clicking, touching), page will not be allowed to play media with sound. This Dialog is used to help users resume playback. ".concat(mr)),Yo=function(){function r(){if(x(this,r),this.dialogNode_=null,this.bodyPosition_="",this.content="\u97F3\u89C6\u9891\u64AD\u653E\u88AB\u6D4F\u89C8\u5668\u62E6\u622A\uFF0C\u8BF7\u70B9\u51FB\u201C\u6062\u590D\u64AD\u653E\u201D\u3002",Ph()||(this.content='Media playback failed. Click the "Resume" to resume playback.'),!eu){var c=document.createElement("style");c.innerHTML=".".concat($t,"{position:fixed;top:0;left:0;right:0;bottom:0;width:100vw;height:100vh;display:flex;justify-content:center;align-items:center;background:rgba(0,0,0,0.5);z-index:1500;}.").concat($t," div:not(.").concat(ar,"){display:block !important;}.").concat(Kn,"{padding:14px;background:#fff;border-radius:3px;box-shadow:0px 3px 15px #434343;border:1px solid #d1cfcf;max-width:500px;}.").concat(Kn," a{color:").concat("#2473E8",";}.").concat(xn,"{overflow:hidden;text-overflow:ellipsis;font-size:16px;font-weight:600;}.").concat(On,"{margin:8px 0;}.").concat(ar,"{width:100%;display:flex !important;align-items:center;justify-content:right;float:right;}.").concat(Mi,"{margin-right:auto;cursor:pointer}.").concat(yr,"{height:100%;line-height:16px;cursor:pointer;}.").concat(Ko,"{margin-left:8px;color:#fff;background:").concat("#2473E8",";padding:4px 12px;outline:none;border:1px solid;border-radius:3px;font-weight:bold;}.").concat(Ko,":hover{opacity:0.9;}.").concat(Mi,",.").concat(Ko,",.").concat(On,",.").concat(yr,"{font-size:14px;}@media screen and (max-width:750px){.").concat(Kn,"{width:80vw;}}"),document.head.appendChild(c),eu=!0}this.showDetail_=!1,this.isCollapseClicked_=!1,this.isQuestionClicked_=!1,this.addDiaLog()}return B(r,[{key:"createDiaLog",value:function(){var c=document.createElement("template");c.innerHTML='<div class="'.concat($t,`"><div class='`).concat(Kn,"'><div class='").concat(xn,"'>").concat(location.host,"</div><div class='").concat(On,"'>").concat(this.content,"</div><div class='").concat(fa,`' style="visibility:hidden;width:100%;height:0;font-size:12px;color:gray;">`).concat(tc,"</div><div class='").concat(ar,"'></div></div></div>").trim();var u=document.createElement("button");u.className=Ko,u.innerText=Ph()?"\u6062\u590D\u64AD\u653E":"Resume",u.onclick=this.onConfirm.bind(this);var d=document.createElement("div");d.className=yr,d.innerHTML=`<?xml version="1.0" encoding="UTF-8"?>
    <svg class="icon" width="18" height="18" p-id="2030" t="1639646523624" version="1.1" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
    <path d="m464 784.35c0 26.51 21.49 48 48 48s48-21.49 48-48-21.49-48-48-48-48 21.49-48 48z" p-id="2031"/>
    <path d="m512 960c-247.04 0-448-200.96-448-448s200.96-448 448-448 448 200.96 448 448-200.96 448-448 448zm0-831.71c-211.58 0-383.71 172.13-383.71 383.71 0 211.55 172.13 383.71 383.71 383.71 211.55 0 383.71-172.16 383.71-383.71 0-211.58-172.16-383.71-383.71-383.71z" p-id="2032"/>
    <path d="m512 673.7c-17.665 0-32.001-14.336-32.001-31.999v-54.112c0-52.353 40-92.352 75.328-127.65 25.887-25.92 52.672-52.672 52.672-74.017 0-53.343-43.072-96.735-95.999-96.735-53.823 0-95.999 41.536-95.999 94.559 0 17.665-14.336 31.999-32.001 31.999s-32.001-14.336-32.001-31.999c0-87.424 71.775-158.56 160-158.56s160 72.095 160 160.74c0 47.904-36.32 84.192-71.424 119.3-27.84 27.776-56.576 56.512-56.576 82.336v54.112c0 17.665-14.336 32.032-32.001 32.032z" p-id="2033"/>
    </svg>
    `,d.onclick=this.onQuestionClick.bind(this);var p=document.createElement("div");p.className=Mi,p.innerText="".concat(Ph()?"\u8BE6\u60C5 >":"Detail >"),p.onclick=this.onCollapseClick.bind(this);var v=c.content.firstChild,f=v.querySelector(".".concat(ar));return f.appendChild(p),f.appendChild(d),f.appendChild(u),v}},{key:"addDiaLog",value:function(){Jf()||(this.dialogNode_=this.createDiaLog(),document.body.appendChild(this.dialogNode_),this.dialogNode_.onclick=this.onConfirm.bind(this),this.dialogNode_.querySelector(".".concat(Kn)).onclick=function(c){return c.stopPropagation()},this.bodyPosition_=document.body.style.position,document.body.style.position="fixed",Bt.warn("show autoplay dialog"),jt.uploadEvent({log:To}))}},{key:"deleteDiaLog",value:function(){this.dialogNode_&&(document.body.removeChild(this.dialogNode_),document.body.style.position=this.bodyPosition_,this.dialogNode_=null)}},{key:"onConfirm",value:function(){Bt.warn("confirm clicked, try resume stream"),Me.emit(vv),this.deleteDiaLog()}},{key:"onCollapseClick",value:function(){var c=this.dialogNode_.querySelector(".".concat(fa));c.style.visibility="".concat(this.showDetail_?"hidden":"visible"),c.style.height="".concat(this.showDetail_?0:"fit-content"),this.showDetail_=!this.showDetail_,this.isCollapseClicked_||jt.uploadEvent({log:Dr}),this.isCollapseClicked_=!0}},{key:"onQuestionClick",value:function(){window.open(zo,"_blank"),this.isQuestionClicked_||jt.uploadEvent({log:Wo}),this.isQuestionClicked_=!0}}]),r}(),Is=function(){function r(d){x(this,r),this.stream_=d.stream,this.userId_=d.stream.getUserId(),this.log_=this.stream_.getLogger(),this.track_=d.track,this.div_=d.div,this.muted_=d.muted,this.objectFit_=d.objectFit,this.mirror_=d.mirror,this.emitter_=new Wc,this.initializeElement(),this.state_="NONE",this.pausedRetryCount_=5}var c,u;return B(r,[{key:"isPlaying",get:function(){return this.state_==="PLAYING"}},{key:"initializeElement",value:function(){var d=new MediaStream;d.addTrack(this.track_);var p=document.createElement(An);p.srcObject=d,p.muted=!0;var v="width: 100%; height: 100%; object-fit: ".concat(this.objectFit_,";");this.mirror_&&(v+="transform: scaleX(-1);"),p.setAttribute("id","video_".concat(this.stream_.getId())),p.setAttribute("style",v),p.setAttribute("autoplay","autoplay"),p.setAttribute("playsinline","playsinline"),this.div_&&this.div_.appendChild(p),this.element_=p,this.handleEvents()}},{key:"setRect",value:function(d){var p=d.width,v=d.height;this.element_&&(this.element_.style.width=p+"px",this.element_.style.height=v+"px")}},{key:"setMirror",value:function(d){this.element_&&(this.element_.style.transform=d?"scaleX(-1)":"",this.mirror_=d)}},{key:"setObjectFit",value:function(d){this.element_&&(this.element_.style.objectFit="".concat(d),this.objectFit_=d)}},{key:"play",value:(u=D(regeneratorRuntime.mark(function d(){var p;return regeneratorRuntime.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.prev=0,v.next=3,this.element_.play();case 3:v.next=11;break;case 5:if(v.prev=5,v.t0=v.catch(0),this.log_.warn("<video> play() error: "+v.t0),!(p=v.t0.toString()+" <video>").startsWith("NotAllowedError")){v.next=11;break}throw new et({code:Ye.PLAY_NOT_ALLOWED,message:p});case 11:case"end":return v.stop()}},d,this,[[0,5]])})),function(){return u.apply(this,arguments)})},{key:"handleEvents",value:function(){this.handleElementEvent=this.handleElementEvent.bind(this),this.handleTrackEvent=this.handleTrackEvent.bind(this),this.element_.addEventListener(pi,this.handleElementEvent),this.element_.addEventListener(Mr,this.handleElementEvent),this.element_.addEventListener(nd,this.handleElementEvent),this.element_.addEventListener(Ah,this.handleElementEvent),this.element_.addEventListener(iI,this.handleElementEvent),this.track_.addEventListener(Mr,this.handleTrackEvent),this.track_.addEventListener(Tt,this.handleTrackEvent),this.track_.addEventListener(Pt,this.handleTrackEvent),this.track_.readyState===Mr&&this.handleTrackEvent({type:Mr}),this.track_.muted&&this.handleTrackEvent({type:Tt})}},{key:"handleElementEvent",value:function(d){switch(d.type){case pi:this.log_.info("stream - video player is starting playing"),this.state_="PLAYING",Me.emit(fv,{stream:this.stream_}),this.emitter_.emit(eo,{state:this.state_,reason:pi});break;case Mr:this.log_.info("stream - video player is ended"),this.state_!=="STOPPED"&&(this.state_="STOPPED",this.emitter_.emit(eo,{state:this.state_,reason:Mr}));break;case nd:this.log_.info("stream - video player is paused"),this.div_&&!document.getElementById(this.div_.id)&&this.log_.warn("video container is not in DOM"),this.state_="PAUSED",this.emitter_.emit(eo,{state:this.state_,reason:nd}),this.pausedRetryCount_>0&&!Jf()&&(this.log_.info("auto resume when video paused"),this.resume(),this.pausedRetryCount_--);break;case Ah:if(this.element_&&this.element_.error){var p="".concat(LE(),"/").concat(Ch().name,"/").concat(Ch().version);this.log_.error("stream - video player error observed. code: ".concat(this.element_.error.code," message: ").concat(this.element_.error.message," deviceInfo: ").concat(p)),jt.uploadEvent("stat-".concat(this.stream_.getType(),"-video-").concat(RI,"-").concat(this.element_.error.code,"-").concat(p),this.element_.error)}break;case iI:Me.emit(Zy,{stream:this.stream_})}}},{key:"handleTrackEvent",value:function(d){var p=d.type;switch(p){case Mr:this.log_.info("stream - video player track is ended"),Me.emit(dE,{stream:this.stream_,type:p}),this.state_!=="STOPPED"&&(this.state_="STOPPED",this.emitter_.emit(eo,{state:this.state_,reason:Mr}));break;case Tt:this.log_.info("stream - video track is unable to provide media output"),this.stream_.isRemote()||QM(),Me.emit(Gh,{stream:this.stream_,type:p}),this.state_!=="PAUSED"&&(this.state_="PAUSED",this.emitter_.emit(eo,{state:this.state_,reason:Tt}));break;case Pt:this.log_.info("stream - video track is able to provide media output"),Me.emit(lE,{stream:this.stream_}),this.state_==="PAUSED"&&(this.state_="PLAYING",this.emitter_.emit(eo,{state:this.state_,reason:Pt}))}}},{key:"unbindEvents",value:function(){this.element_&&(this.element_.removeEventListener(pi,this.handleElementEvent),this.element_.removeEventListener(Mr,this.handleElementEvent),this.element_.removeEventListener(nd,this.handleElementEvent),this.element_.removeEventListener(Ah,this.handleElementEvent),this.element_.removeEventListener(iI,this.handleElementEvent)),this.track_&&(this.track_.removeEventListener(Mr,this.handleTrackEvent),this.track_.removeEventListener(Tt,this.handleTrackEvent),this.track_.removeEventListener(Pt,this.handleTrackEvent))}},{key:"stop",value:function(){this.unbindEvents(),this.div_&&this.div_.removeChild(this.element_),this.element_.srcObject=null,this.element_=null}},{key:"resume",value:(c=D(regeneratorRuntime.mark(function d(){var p;return regeneratorRuntime.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.prev=0,v.next=3,this.element_.play();case 3:v.next=11;break;case 5:if(v.prev=5,v.t0=v.catch(0),this.log_.warn("<video> play() error: "+v.t0),!(p=rt({key:We,data:{error:v.t0}})).startsWith("NotAllowedError")){v.next=11;break}throw new et({code:Ye.PLAY_NOT_ALLOWED,message:p});case 11:case"end":return v.stop()}},d,this,[[0,5]])})),function(){return c.apply(this,arguments)})},{key:"getVideoFrame",value:function(){var d=document.createElement("canvas");return d.width=this.element_.videoWidth,d.height=this.element_.videoHeight,d.getContext("2d").drawImage(this.element_,0,0),d.toDataURL("image/png")}},{key:"on",value:function(d,p){this.emitter_.on(d,p)}},{key:"getElement",value:function(){return this.element_?this.element_:null}}]),r}(),ga=typeof ArrayBuffer<"u"&&typeof DataView<"u",vd=ee.RangeError,Jh=function(r){if(r===void 0)return 0;var c=Ia(r),u=xr(c);if(c!==u)throw vd("Wrong length or index");return u},SS=ee.Array,JE=Math.abs,Xh=Math.pow,wL=Math.floor,DL=Math.log,OL=Math.LN2,NL=function(r,c,u){var d,p,v,f=SS(u),y=8*u-c-1,I=(1<<y)-1,T=I>>1,b=c===23?Xh(2,-24)-Xh(2,-77):0,k=r<0||r===0&&1/r<0?1:0,N=0;for((r=JE(r))!=r||r===1/0?(p=r!=r?1:0,d=I):(d=wL(DL(r)/OL),r*(v=Xh(2,-d))<1&&(d--,v*=2),(r+=d+T>=1?b/v:b*Xh(2,1-T))*v>=2&&(d++,v/=2),d+T>=I?(p=0,d=I):d+T>=1?(p=(r*v-1)*Xh(2,c),d+=T):(p=r*Xh(2,T-1)*Xh(2,c),d=0));c>=8;)f[N++]=255&p,p/=256,c-=8;for(d=d<<c|p,y+=c;y>0;)f[N++]=255&d,d/=256,y-=8;return f[--N]|=128*k,f},LL=function(r,c){var u,d=r.length,p=8*d-c-1,v=(1<<p)-1,f=v>>1,y=p-7,I=d-1,T=r[I--],b=127&T;for(T>>=7;y>0;)b=256*b+r[I--],y-=8;for(u=b&(1<<-y)-1,b>>=-y,y+=c;y>0;)u=256*u+r[I--],y-=8;if(b===0)b=1-f;else{if(b===v)return u?NaN:T?-1/0:1/0;u+=Xh(2,c),b-=f}return(T?-1:1)*u*Xh(2,b-c)},f1=function(r){for(var c=fr(this),u=Pi(c),d=arguments.length,p=po(d>1?arguments[1]:void 0,u),v=d>2?arguments[2]:void 0,f=v===void 0?u:po(v,u);f>p;)c[p++]=r;return c},PL=ta.f,xL=Yn.f,UL=Sa.PROPER,g1=Sa.CONFIGURABLE,IS=Tr.get,m1=Tr.set,rl=ee.ArrayBuffer,il=rl,ES=il&&il.prototype,Qh=ee.DataView,Av=Qh&&Qh.prototype,v1=Object.prototype,GL=ee.Array,kC=ee.RangeError,FL=ve(f1),VL=ve([].reverse),_1=NL,y1=LL,S1=function(r){return[255&r]},I1=function(r){return[255&r,r>>8&255]},E1=function(r){return[255&r,r>>8&255,r>>16&255,r>>24&255]},T1=function(r){return r[3]<<24|r[2]<<16|r[1]<<8|r[0]},BL=function(r){return _1(r,23,4)},jL=function(r){return _1(r,52,8)},wC=function(r,c){xL(r.prototype,c,{get:function(){return IS(this)[c]}})},Xf=function(r,c,u,d){var p=Jh(u),v=IS(r);if(p+c>v.byteLength)throw kC("Wrong index");var f=IS(v.buffer).bytes,y=p+v.byteOffset,I=Vr(f,y,y+c);return d?I:VL(I)},Qf=function(r,c,u,d,p,v){var f=Jh(u),y=IS(r);if(f+c>y.byteLength)throw kC("Wrong index");for(var I=IS(y.buffer).bytes,T=f+y.byteOffset,b=d(+p),k=0;k<c;k++)I[T+k]=b[v?k:c-k-1]};if(ga){var M1=UL&&rl.name!=="ArrayBuffer";if(xe(function(){rl(1)})&&xe(function(){new rl(-1)})&&!xe(function(){return new rl,new rl(1.5),new rl(NaN),M1&&!g1}))M1&&g1&&Hn(rl,"name","ArrayBuffer");else{(il=function(r){return oa(this,ES),new rl(Jh(r))}).prototype=ES;for(var Bk,R1=PL(rl),C1=0;R1.length>C1;)(Bk=R1[C1++])in il||Hn(il,Bk,rl[Bk]);ES.constructor=il}hi&&mo(Av)!==v1&&hi(Av,v1);var DC=new Qh(new il(2)),b1=ve(Av.setInt8);DC.setInt8(0,2147483648),DC.setInt8(1,2147483649),!DC.getInt8(0)&&DC.getInt8(1)||Qa(Av,{setInt8:function(r,c){b1(this,r,c<<24>>24)},setUint8:function(r,c){b1(this,r,c<<24>>24)}},{unsafe:!0})}else ES=(il=function(r){oa(this,ES);var c=Jh(r);m1(this,{bytes:FL(GL(c),0),byteLength:c}),Et||(this.byteLength=c)}).prototype,Av=(Qh=function(r,c,u){oa(this,Av),oa(r,ES);var d=IS(r).byteLength,p=Ia(c);if(p<0||p>d)throw kC("Wrong offset");if(p+(u=u===void 0?d-p:xr(u))>d)throw kC("Wrong length");m1(this,{buffer:r,byteLength:u,byteOffset:p}),Et||(this.buffer=r,this.byteLength=u,this.byteOffset=p)}).prototype,Et&&(wC(il,"byteLength"),wC(Qh,"buffer"),wC(Qh,"byteLength"),wC(Qh,"byteOffset")),Qa(Av,{getInt8:function(r){return Xf(this,1,r)[0]<<24>>24},getUint8:function(r){return Xf(this,1,r)[0]},getInt16:function(r){var c=Xf(this,2,r,arguments.length>1?arguments[1]:void 0);return(c[1]<<8|c[0])<<16>>16},getUint16:function(r){var c=Xf(this,2,r,arguments.length>1?arguments[1]:void 0);return c[1]<<8|c[0]},getInt32:function(r){return T1(Xf(this,4,r,arguments.length>1?arguments[1]:void 0))},getUint32:function(r){return T1(Xf(this,4,r,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(r){return y1(Xf(this,4,r,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(r){return y1(Xf(this,8,r,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(r,c){Qf(this,1,r,S1,c)},setUint8:function(r,c){Qf(this,1,r,S1,c)},setInt16:function(r,c){Qf(this,2,r,I1,c,arguments.length>2?arguments[2]:void 0)},setUint16:function(r,c){Qf(this,2,r,I1,c,arguments.length>2?arguments[2]:void 0)},setInt32:function(r,c){Qf(this,4,r,E1,c,arguments.length>2?arguments[2]:void 0)},setUint32:function(r,c){Qf(this,4,r,E1,c,arguments.length>2?arguments[2]:void 0)},setFloat32:function(r,c){Qf(this,4,r,BL,c,arguments.length>2?arguments[2]:void 0)},setFloat64:function(r,c){Qf(this,8,r,jL,c,arguments.length>2?arguments[2]:void 0)}});Uo(il,"ArrayBuffer"),Uo(Qh,"DataView");var TS={ArrayBuffer:il,DataView:Qh},jk=TS.ArrayBuffer,qk=TS.DataView,A1=qk.prototype,k1=ve(jk.prototype.slice),qL=ve(A1.getUint8),HL=ve(A1.setUint8),$L=xe(function(){return!new jk(2).slice(1,void 0).byteLength});cn({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:$L},{slice:function(r,c){if(k1&&c===void 0)return k1(Sn(this),r);for(var u=Sn(this).byteLength,d=po(r,u),p=po(c===void 0?u:c,u),v=new(ei(this,jk))(xr(p-d)),f=new qk(this),y=new qk(v),I=0;d<p;)HL(y,I++,qL(f,d++));return v}}),cn({global:!0,constructor:!0,forced:!ga},{DataView:TS.DataView});var KL=ve([].reverse),w1=[1,2];cn({target:"Array",proto:!0,forced:String(w1)===String(w1.reverse())},{reverse:function(){return dc(this)&&(this.length=this.length),KL(this)}});var WL=ee.TypeError,D1=function(r){return function(c,u,d,p){er(u);var v=fr(c),f=qr(v),y=Pi(v),I=r?y-1:0,T=r?-1:1;if(d<2)for(;;){if(I in f){p=f[I],I+=T;break}if(I+=T,r?I<0:y<=I)throw WL("Reduce of empty array with no initial value")}for(;r?I>=0:y>I;I+=T)I in f&&(p=u(p,f[I],I,v));return p}},Hk={left:D1(!1),right:D1(!0)},zL=Hk.left,YL=Ul("reduce");cn({target:"Array",proto:!0,forced:!YL||!tr&&Ge>79&&Ge<83},{reduce:function(r){var c=arguments.length;return zL(this,r,c,c>1?arguments[1]:void 0)}});var O1=TS.ArrayBuffer,JL=ee.ArrayBuffer;cn({global:!0,constructor:!0,forced:JL!==O1},{ArrayBuffer:O1}),Iu("ArrayBuffer");var XL=Tl("slice"),QL=Qt("species"),$k=ee.Array,ZL=Math.max;cn({target:"Array",proto:!0,forced:!XL},{slice:function(r,c){var u,d,p,v=ur(this),f=Pi(v),y=po(r,f),I=po(c===void 0?f:c,f);if(dc(v)&&(u=v.constructor,(pc(u)&&(u===$k||dc(u.prototype))||xt(u)&&(u=u[QL])===null)&&(u=void 0),u===$k||u===void 0))return Ac(v,y,I);for(d=new(u===void 0?$k:u)(ZL(I-y,0)),p=0;y<I;y++,p++)y in v&&yu(d,p,v[y]);return d.length=p,d}});var eP=Vo.trim,XE=ee.parseInt,N1=ee.Symbol,L1=N1&&N1.iterator,P1=/^[+-]?0x/i,tP=ve(P1.exec),x1=XE(qs+"08")!==8||XE(qs+"0x16")!==22||L1&&!xe(function(){XE(Object(L1))})?function(r,c){var u=eP(hn(r));return XE(u,c>>>0||(tP(P1,u)?16:10))}:XE;cn({global:!0,forced:parseInt!=x1},{parseInt:x1});var Es,MS,OC,nP=Yn.f,NC=ee.Int8Array,Kk=NC&&NC.prototype,U1=ee.Uint8ClampedArray,G1=U1&&U1.prototype,_d=NC&&mo(NC),ol=Kk&&mo(Kk),rP=Object.prototype,Wk=ee.TypeError,F1=Qt("toStringTag"),zk=Wi("TYPED_ARRAY_TAG"),Yk=Wi("TYPED_ARRAY_CONSTRUCTOR"),Zh=ga&&!!hi&&Ka(ee.opera)!=="Opera",V1=!1,ep={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Jk={BigInt64Array:8,BigUint64Array:8},B1=function(r){if(!xt(r))return!1;var c=Ka(r);return st(ep,c)||st(Jk,c)};for(Es in ep)(OC=(MS=ee[Es])&&MS.prototype)?Hn(OC,Yk,MS):Zh=!1;for(Es in Jk)(OC=(MS=ee[Es])&&MS.prototype)&&Hn(OC,Yk,MS);if((!Zh||!bt(_d)||_d===Function.prototype)&&(_d=function(){throw Wk("Incorrect invocation")},Zh))for(Es in ep)ee[Es]&&hi(ee[Es],_d);if((!Zh||!ol||ol===rP)&&(ol=_d.prototype,Zh))for(Es in ep)ee[Es]&&hi(ee[Es].prototype,ol);if(Zh&&mo(G1)!==ol&&hi(G1,ol),Et&&!st(ol,F1))for(Es in V1=!0,nP(ol,F1,{get:function(){return xt(this)?this[zk]:void 0}}),ep)ee[Es]&&Hn(ee[Es],zk,Es);var bn={NATIVE_ARRAY_BUFFER_VIEWS:Zh,TYPED_ARRAY_CONSTRUCTOR:Yk,TYPED_ARRAY_TAG:V1&&zk,aTypedArray:function(r){if(B1(r))return r;throw Wk("Target is not a typed array")},aTypedArrayConstructor:function(r){if(bt(r)&&(!hi||nt(_d,r)))return r;throw Wk(ci(r)+" is not a typed array constructor")},exportTypedArrayMethod:function(r,c,u,d){if(Et){if(u)for(var p in ep){var v=ee[p];if(v&&st(v.prototype,r))try{delete v.prototype[r]}catch{try{v.prototype[r]=c}catch{}}}ol[r]&&!u||sr(ol,r,u?c:Zh&&Kk[r]||c,d)}},exportTypedArrayStaticMethod:function(r,c,u){var d,p;if(Et){if(hi){if(u){for(d in ep)if((p=ee[d])&&st(p,r))try{delete p[r]}catch{}}if(_d[r]&&!u)return;try{return sr(_d,r,u?c:Zh&&_d[r]||c)}catch{}}for(d in ep)!(p=ee[d])||p[r]&&!u||sr(p,r,c)}},isView:function(r){if(!xt(r))return!1;var c=Ka(r);return c==="DataView"||st(ep,c)||st(Jk,c)},isTypedArray:B1,TypedArray:_d,TypedArrayPrototype:ol},iP=bn.NATIVE_ARRAY_BUFFER_VIEWS,oP=ee.ArrayBuffer,kv=ee.Int8Array,aP=!iP||!xe(function(){kv(1)})||!xe(function(){new kv(-1)})||!Zg(function(r){new kv,new kv(null),new kv(1.5),new kv(r)},!0)||xe(function(){return new kv(new oP(2),1,void 0).length!==1}),sP=ee.RangeError,cP=ee.RangeError,LC=function(r,c){var u=function(d){var p=Ia(d);if(p<0)throw sP("The argument can't be less than 0");return p}(r);if(u%c)throw cP("Wrong offset");return u},uP=bn.aTypedArrayConstructor,j1=function(r){var c,u,d,p,v,f,y=Bn(this),I=fr(r),T=arguments.length,b=T>1?arguments[1]:void 0,k=b!==void 0,N=Su(I);if(N&&!Jg(N))for(f=(v=bc(I,N)).next,I=[];!(p=dt(f,v)).done;)I.push(p.value);for(k&&T>2&&(b=Ma(b,arguments[2])),u=Pi(I),d=new(uP(y))(u),c=0;u>c;c++)d[c]=k?b(I[c],c):I[c];return d};vt(function(r){var c=ta.f,u=Zr.forEach,d=Tr.get,p=Tr.set,v=Yn.f,f=ki.f,y=Math.round,I=ee.RangeError,T=TS.ArrayBuffer,b=T.prototype,k=TS.DataView,N=bn.NATIVE_ARRAY_BUFFER_VIEWS,O=bn.TYPED_ARRAY_CONSTRUCTOR,F=bn.TYPED_ARRAY_TAG,G=bn.TypedArray,P=bn.TypedArrayPrototype,K=bn.aTypedArrayConstructor,X=bn.isTypedArray,oe=function(qe,$e){K(qe);for(var Tn=0,Q=$e.length,j=new qe(Q);Q>Tn;)j[Tn]=$e[Tn++];return j},Ce=function(qe,$e){v(qe,$e,{get:function(){return d(this)[$e]}})},Ve=function(qe){var $e;return nt(b,qe)||($e=Ka(qe))=="ArrayBuffer"||$e=="SharedArrayBuffer"},je=function(qe,$e){return X(qe)&&!rr($e)&&$e in qe&&fR(+$e)&&$e>=0},Re=function(qe,$e){return $e=Si($e),je(qe,$e)?Gn(2,qe[$e]):f(qe,$e)},Oe=function(qe,$e,Tn){return $e=Si($e),!(je(qe,$e)&&xt(Tn)&&st(Tn,"value"))||st(Tn,"get")||st(Tn,"set")||Tn.configurable||st(Tn,"writable")&&!Tn.writable||st(Tn,"enumerable")&&!Tn.enumerable?v(qe,$e,Tn):(qe[$e]=Tn.value,qe)};Et?(N||(ki.f=Re,Yn.f=Oe,Ce(P,"buffer"),Ce(P,"byteOffset"),Ce(P,"byteLength"),Ce(P,"length")),cn({target:"Object",stat:!0,forced:!N},{getOwnPropertyDescriptor:Re,defineProperty:Oe}),r.exports=function(qe,$e,Tn){var Q=qe.match(/\d+$/)[0]/8,j=qe+(Tn?"Clamped":"")+"Array",le="get"+qe,fe="set"+qe,Ie=ee[j],Ne=Ie,lt=Ne&&Ne.prototype,Dt={},Ut=function(_n,Gt){v(_n,Gt,{get:function(){return function(zn,Un){var on=d(zn);return on.view[le](Un*Q+on.byteOffset,!0)}(this,Gt)},set:function(zn){return function(Un,on,vr){var qi=d(Un);Tn&&(vr=(vr=y(vr))<0?0:vr>255?255:255&vr),qi.view[fe](on*Q+qi.byteOffset,vr,!0)}(this,Gt,zn)},enumerable:!0})};N?aP&&(Ne=$e(function(_n,Gt,zn,Un){return oa(_n,lt),Np(xt(Gt)?Ve(Gt)?Un!==void 0?new Ie(Gt,LC(zn,Q),Un):zn!==void 0?new Ie(Gt,LC(zn,Q)):new Ie(Gt):X(Gt)?oe(Ne,Gt):dt(j1,Ne,Gt):new Ie(Jh(Gt)),_n,Ne)}),hi&&hi(Ne,G),u(c(Ie),function(_n){_n in Ne||Hn(Ne,_n,Ie[_n])}),Ne.prototype=lt):(Ne=$e(function(_n,Gt,zn,Un){oa(_n,lt);var on,vr,qi,xD=0,KC=0;if(xt(Gt)){if(!Ve(Gt))return X(Gt)?oe(Ne,Gt):dt(j1,Ne,Gt);on=Gt,KC=LC(zn,Q);var pw=Gt.byteLength;if(Un===void 0){if(pw%Q||(vr=pw-KC)<0)throw I("Wrong length")}else if((vr=xr(Un)*Q)+KC>pw)throw I("Wrong length");qi=vr/Q}else qi=Jh(Gt),on=new T(vr=qi*Q);for(p(_n,{buffer:on,byteOffset:KC,byteLength:vr,length:qi,view:new k(on)});xD<qi;)Ut(_n,xD++)}),hi&&hi(Ne,G),lt=Ne.prototype=Ic(P)),lt.constructor!==Ne&&Hn(lt,"constructor",Ne),Hn(lt,O,Ne),F&&Hn(lt,F,j);var St=Ne!=Ie;Dt[j]=Ne,cn({global:!0,constructor:!0,forced:St,sham:!N},Dt),"BYTES_PER_ELEMENT"in Ne||Hn(Ne,"BYTES_PER_ELEMENT",Q),"BYTES_PER_ELEMENT"in lt||Hn(lt,"BYTES_PER_ELEMENT",Q),Iu(j)}):r.exports=function(){}})("Uint8",function(r){return function(c,u,d){return r(this,c,u,d)}});var lP=Math.min,dP=ve([].copyWithin||function(r,c){var u=fr(this),d=Pi(u),p=po(r,d),v=po(c,d),f=arguments.length>2?arguments[2]:void 0,y=lP((f===void 0?d:po(f,d))-v,d-p),I=1;for(v<p&&p<v+y&&(I=-1,v+=y-1,p+=y-1);y-- >0;)v in u?u[p]=u[v]:delete u[p],p+=I,v+=I;return u}),hP=bn.aTypedArray;(0,bn.exportTypedArrayMethod)("copyWithin",function(r,c){return dP(hP(this),r,c,arguments.length>2?arguments[2]:void 0)});var pP=Zr.every,fP=bn.aTypedArray;(0,bn.exportTypedArrayMethod)("every",function(r){return pP(fP(this),r,arguments.length>1?arguments[1]:void 0)});var gP=bn.aTypedArray;(0,bn.exportTypedArrayMethod)("fill",function(r){var c=arguments.length;return dt(f1,gP(this),r,c>1?arguments[1]:void 0,c>2?arguments[2]:void 0)});var mP=bn.TYPED_ARRAY_CONSTRUCTOR,vP=bn.aTypedArrayConstructor,PC=function(r){return vP(ei(r,r[mP]))},_P=function(r,c){return function(u,d){for(var p=0,v=Pi(d),f=new u(v);v>p;)f[p]=d[p++];return f}(PC(r),c)},yP=Zr.filter,SP=bn.aTypedArray;(0,bn.exportTypedArrayMethod)("filter",function(r){var c=yP(SP(this),r,arguments.length>1?arguments[1]:void 0);return _P(this,c)});var IP=Zr.find,EP=bn.aTypedArray;(0,bn.exportTypedArrayMethod)("find",function(r){return IP(EP(this),r,arguments.length>1?arguments[1]:void 0)});var TP=Zr.findIndex,MP=bn.aTypedArray;(0,bn.exportTypedArrayMethod)("findIndex",function(r){return TP(MP(this),r,arguments.length>1?arguments[1]:void 0)});var RP=Zr.forEach,CP=bn.aTypedArray;(0,bn.exportTypedArrayMethod)("forEach",function(r){RP(CP(this),r,arguments.length>1?arguments[1]:void 0)});var bP=Dd.includes,AP=bn.aTypedArray;(0,bn.exportTypedArrayMethod)("includes",function(r){return bP(AP(this),r,arguments.length>1?arguments[1]:void 0)});var kP=Dd.indexOf,wP=bn.aTypedArray;(0,bn.exportTypedArrayMethod)("indexOf",function(r){return kP(wP(this),r,arguments.length>1?arguments[1]:void 0)});var Xk=Qt("iterator"),q1=ee.Uint8Array,DP=ve(Cc.values),OP=ve(Cc.keys),NP=ve(Cc.entries),Qk=bn.aTypedArray,xC=bn.exportTypedArrayMethod,RS=q1&&q1.prototype,UC=!xe(function(){RS[Xk].call([1])}),H1=!!RS&&RS.values&&RS[Xk]===RS.values&&RS.values.name==="values",$1=function(){return DP(Qk(this))};xC("entries",function(){return NP(Qk(this))},UC),xC("keys",function(){return OP(Qk(this))},UC),xC("values",$1,UC||!H1,{name:"values"}),xC(Xk,$1,UC||!H1,{name:"values"});var LP=bn.aTypedArray,PP=bn.exportTypedArrayMethod,xP=ve([].join);PP("join",function(r){return xP(LP(this),r)});var UP=Math.min,Zk=[].lastIndexOf,K1=!!Zk&&1/[1].lastIndexOf(1,-0)<0,GP=Ul("lastIndexOf"),FP=K1||!GP?function(r){if(K1)return wa(Zk,this,arguments)||0;var c=ur(this),u=Pi(c),d=u-1;for(arguments.length>1&&(d=UP(d,Ia(arguments[1]))),d<0&&(d=u+d);d>=0;d--)if(d in c&&c[d]===r)return d||0;return-1}:Zk,VP=bn.aTypedArray;(0,bn.exportTypedArrayMethod)("lastIndexOf",function(r){var c=arguments.length;return wa(FP,VP(this),c>1?[r,arguments[1]]:[r])});var BP=Zr.map,jP=bn.aTypedArray;(0,bn.exportTypedArrayMethod)("map",function(r){return BP(jP(this),r,arguments.length>1?arguments[1]:void 0,function(c,u){return new(PC(c))(u)})});var qP=Hk.left,HP=bn.aTypedArray;(0,bn.exportTypedArrayMethod)("reduce",function(r){var c=arguments.length;return qP(HP(this),r,c,c>1?arguments[1]:void 0)});var $P=Hk.right,KP=bn.aTypedArray;(0,bn.exportTypedArrayMethod)("reduceRight",function(r){var c=arguments.length;return $P(KP(this),r,c,c>1?arguments[1]:void 0)});var WP=bn.aTypedArray,zP=bn.exportTypedArrayMethod,YP=Math.floor;zP("reverse",function(){for(var r,c=WP(this).length,u=YP(c/2),d=0;d<u;)r=this[d],this[d++]=this[--c],this[c]=r;return this});var JP=ee.RangeError,ew=ee.Int8Array,W1=ew&&ew.prototype,z1=W1&&W1.set,XP=bn.aTypedArray,QP=bn.exportTypedArrayMethod,tw=!xe(function(){var r=new Uint8ClampedArray(2);return dt(z1,r,{length:1,0:3},1),r[1]!==3}),ZP=tw&&bn.NATIVE_ARRAY_BUFFER_VIEWS&&xe(function(){var r=new ew(2);return r.set(1),r.set("2",1),r[0]!==0||r[1]!==2});QP("set",function(r){XP(this);var c=LC(arguments.length>1?arguments[1]:void 0,1),u=fr(r);if(tw)return dt(z1,this,u,c);var d=this.length,p=Pi(u),v=0;if(p+c>d)throw JP("Wrong length");for(;v<p;)this[c+v]=u[v++]},!tw||ZP);var ex=bn.aTypedArray;(0,bn.exportTypedArrayMethod)("slice",function(r,c){for(var u=Ac(ex(this),r,c),d=PC(this),p=0,v=u.length,f=new d(v);v>p;)f[p]=u[p++];return f},xe(function(){new Int8Array(1).slice()}));var tx=Zr.some,nx=bn.aTypedArray;(0,bn.exportTypedArrayMethod)("some",function(r){return tx(nx(this),r,arguments.length>1?arguments[1]:void 0)});var Y1=nn.match(/firefox\/(\d+)/i),J1=!!Y1&&+Y1[1],rx=/MSIE|Trident/.test(nn),X1=nn.match(/AppleWebKit\/(\d+)\./),Q1=!!X1&&+X1[1],ix=bn.aTypedArray,ox=bn.exportTypedArrayMethod,QE=ee.Uint16Array,CS=QE&&ve(QE.prototype.sort),ax=!(!CS||xe(function(){CS(new QE(2),null)})&&xe(function(){CS(new QE(2),{})})),Z1=!!CS&&!xe(function(){if(Ge)return Ge<74;if(J1)return J1<67;if(rx)return!0;if(Q1)return Q1<602;var r,c,u=new QE(516),d=Array(516);for(r=0;r<516;r++)c=r%4,u[r]=515-r,d[r]=r-2*c+3;for(CS(u,function(p,v){return(p/4|0)-(v/4|0)}),r=0;r<516;r++)if(u[r]!==d[r])return!0});ox("sort",function(r){return r!==void 0&&er(r),Z1?CS(this,r):G_(ix(this),function(c){return function(u,d){return c!==void 0?+c(u,d)||0:d!=d?-1:u!=u?1:u===0&&d===0?1/u>0&&1/d<0?1:-1:u>d}}(r))},!Z1||ax);var sx=bn.aTypedArray;(0,bn.exportTypedArrayMethod)("subarray",function(r,c){var u=sx(this),d=u.length,p=po(r,d);return new(PC(u))(u.buffer,u.byteOffset+p*u.BYTES_PER_ELEMENT,xr((c===void 0?d:po(c,d))-p))});var GC=ee.Int8Array,eD=bn.aTypedArray,cx=bn.exportTypedArrayMethod,tD=[].toLocaleString,ux=!!GC&&xe(function(){tD.call(new GC(1))});cx("toLocaleString",function(){return wa(tD,ux?Ac(eD(this)):eD(this),Ac(arguments))},xe(function(){return[1,2].toLocaleString()!=new GC([1,2]).toLocaleString()})||!xe(function(){GC.prototype.toLocaleString.call([1,2])}));var lx=bn.exportTypedArrayMethod,nD=ee.Uint8Array,dx=nD&&nD.prototype||{},FC=[].toString,hx=ve([].join);xe(function(){FC.call({})})&&(FC=function(){return hx(this)});var px=dx.toString!=FC;lx("toString",FC,px);var fx=function(){function r(c,u){x(this,r),this.connection_=c,this.log_=u,this.seiMessageList_=[],this.abortController_=null,this.seiPayloadType_=243,this.senderOrReceiver_=null,this.onSEIMessage=null}return B(r,[{key:"isRunning",get:function(){return!!this.abortController_}},{key:"start",value:function(c,u){if(this.senderOrReceiver_!==c){this.senderOrReceiver_=c;var d=c.createEncodedStreams(),p=d.readable,v=d.writable,f=new TransformStream({transform:u?this.encodeVideoFrame.bind(this):this.decodeVideoFrame.bind(this)});this.abortController_=new AbortController,p.pipeThrough(f).pipeTo(v,{signal:this.abortController_.signal}).catch(function(){})}}},{key:"restart",value:function(c,u){this.stop(),this.start(c,u)}},{key:"stop",value:function(){var c;(c=this.abortController_)===null||c===void 0||c.abort(),this.abortController_=null}},{key:"destory",value:function(){this.stop(),this.log_=null,this.onSEIMessage=null,this.senderOrReceiver_=null,this.connection_=null}},{key:"push",value:function(c,u){u&&u.seiPayloadType&&(this.seiPayloadType_=u.seiPayloadType),this.seiMessageList_.push(c)}},{key:"hasSEI",value:function(c){var u=new DataView(c);return u.getInt32(0)===1&&u.getInt8(4)===6}},{key:"isEmptyFrame",value:function(c){return c.type==="empty"||c.data.byteLength===0}},{key:"getNaluCount",value:function(c){for(var u=0,d=0,p=new DataView(c),v=0;v<c.byteLength;v++)switch(p.getUint8(v)){case 0:u++;break;case 1:u!==2&&u!==3||d++,u=0;break;default:u=0}return d}},{key:"encodeVideoFrame",value:function(c,u){try{if(this.connection_.isH264&&this.seiMessageList_.length>0&&!this.isEmptyFrame(c)){var d=9-this.getNaluCount(c.data);if(d<=0)return;for(var p=this.seiMessageList_.splice(0,d).reverse().map(this.encodeSEINalu.bind(this)),v=p.reduce(function(O,F){return O+F.dataView.byteLength},0),f=new ArrayBuffer(v+c.data.byteLength),y=new DataView(f),I=new DataView(c.data),T=0,b=0;b<p.length;b++)for(var k=0;k<p[b].dataView.byteLength;k++)y.setInt8(T++,p[b].dataView.getInt8(k));for(var N=0;N<c.data.byteLength;N++)y.setInt8(T++,I.getInt8(N));c.data=f,this.log_.debug("".concat(p.length," sei sent"))}}catch(O){this.log_.warn(O)}u.enqueue(c)}},{key:"decodeVideoFrame",value:function(c,u){var d=this;try{if(this.connection_.isH264&&!this.isEmptyFrame(c)&&this.hasSEI(c.data)){for(var p=[],v=new DataView(c.data),f=0,y=-1,I=-1,T=0;T<c.data.byteLength;T++){var b=v.getUint8(T);if(b===0)f++;else if(b===1){if(f===2||f===3){var k=T-f;if(y===-1?y=k:I===-1&&(I=k,p.push(new rD(new DataView(v.buffer.slice(y,I)))),y=k,I=-1),v.getUint8(T+1)!==6){c.data=new DataView(v.buffer.slice(k)).buffer;break}}f=0}else f=0}this.log_.debug("".concat(p.length," sei received")),da(this.onSEIMessage)&&p.reverse().forEach(function(N){d.onSEIMessage({seiPayloadType:N.seiPayloadType,data:N.seiPayload.buffer})})}}catch(N){this.log_.warn(N)}u.enqueue(c)}},{key:"encodeSEINalu",value:function(c){var u=c.byteLength,d=parseInt(u/255),p=u%255,v=[];v.push(0,0,0,1,6,this.seiPayloadType_);for(var f=0;f<d;f++)v.push(255);v.push(p);var y=new DataView(c);return v.push.apply(v,de(new Uint8Array(y.buffer))),v.push(128),new rD(new DataView(new Uint8Array(v).buffer),!0)}}]),r}(),rD=function(){function r(c){var u=arguments.length>1&&arguments[1]!==void 0&&arguments[1];x(this,r),this.dataView=c,this.isSEI&&(u?this.addPreventionByte():this.removePreventionByte())}return B(r,[{key:"addPreventionByte",value:function(){for(var c=this.seiPayloadStartIndex,u=this.dataView.byteLength-2,d=[],p=0,v=c;v<=u;v++){var f=this.dataView.getInt8(v);switch(f){case 0:case 1:case 2:case 3:p===2&&(d.push(3),p=0),f==0?p++:p=0,d.push(f);break;default:p=0,d.push(f)}}d.push(this.dataView.getInt8(this.dataView.byteLength-1));var y=new DataView(new Uint8Array([].concat(de(new Uint8Array(this.dataView.buffer).slice(0,c)),d)).buffer);this.dataView=y}},{key:"removePreventionByte",value:function(){for(var c=this.seiPayloadStartIndex,u=this.dataView.byteLength-1,d=[],p=0,v=c;v<=u;v++)switch(this.dataView.getInt8(v)){case 0:p++,d.push(this.dataView.getInt8(v));break;case 3:p!==2&&d.push(this.dataView.getInt8(v)),p=0;break;default:d.push(this.dataView.getInt8(v)),p=0}var f=new DataView(new Uint8Array([].concat(de(new Uint8Array(this.dataView.buffer).slice(0,c)),d)).buffer);this.dataView=f}},{key:"isSEI",get:function(){return this.dataView.getUint8(4)===6}},{key:"seiPayloadStartIndex",get:function(){for(var c=6,u=6;u<this.dataView.buffer.byteLength&&(c++,this.dataView.getUint8(u)===255);u++);return c}},{key:"seiPayloadType",get:function(){return this.isSEI?this.dataView.getUint8(5):null}},{key:"seiPayload",get:function(){if(!this.isSEI)return null;for(var c=0,u=6,d=6;d<this.dataView.buffer.byteLength;d++){var p=this.dataView.getUint8(d);if(u++,p!==255){c+=p;break}c+=255}for(var v=new ArrayBuffer(c),f=new DataView(v),y=0;y<v.byteLength;y++,u++)f.setInt8(y,this.dataView.getInt8(u));return f}}]),r}(),nw=function(){function r(u){x(this,r),this.userId_=u.userId,this.tinyId_=u.tinyId,this.client_=u.client,this.sdpSemantics_=u.client.getSdpSemantics(),this.isUplink_=u.isUplink,this.log_=Bt.createLogger({id:"n|"+this.userId_,userId:this.client_.getUserId(),sdkAppId:this.client_.getSDKAppId(),isLocal:this.isUplink_}),this.signalChannel_=u.signalChannel,this.peerConnection_=null,this.connectTimer_=-1,this.isErrorObserved_=!1,this.emitter_=new Wc,this.currentState_=Ur,this.waitForPeerConnectionConnectedPromise_=null,this.isReconnecting_=!1,this.reconnectionCount_=0,this.reconnectionTimer_=-1,this.isFirstConnection_=!0,this.delay_={audioDelay:0,videoDelay:0},this.enableSEI_=u.enableSEI,this.enableSEI_&&OE&&(this.sei_=new fx(this,this.log_))}var c;return B(r,[{key:"initialize",value:function(){var u={encodedInsertableStreams:this.enableSEI_&&OE,iceServers:this.client_.getIceServers(),iceTransportPolicy:this.client_.getIceTransportPolicy(),sdpSemantics:this.sdpSemantics_,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",tcpCandidatePolicy:"disable",IceTransportsType:"nohost"};this.peerConnection_=new RTCPeerConnection(u),this.peerConnection_.onconnectionstatechange=this.onConnectionStateChange.bind(this)}},{key:"close",value:function(){this.log_.info("closing connection"),this.closePeerConnection(),this.sei_&&(this.sei_.destory(),this.sei_=null)}},{key:"closePeerConnection",value:function(){var u=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.peerConnection_&&(this.peerConnection_.onconnectionstatechange=function(){},this.peerConnection_.close(),this.peerConnection_=null,u&&this.emitConnectionStateChangedEvent(Ur))}},{key:"getDTLSTransportState",value:function(){if(!this.peerConnection_)return"unknown";var u=null;if(this.isUplink_){if(!lS()||this.peerConnection_.getSenders().length===0)return"unknown";u=this.peerConnection_.getSenders()[0].transport}else{if(!ZR()||this.peerConnection_.getReceivers().length===0)return"unknown";u=this.peerConnection_.getReceivers()[0].transport}return u?u.state:"unknown"}},{key:"onConnectionStateChange",value:function(u){var d=this.peerConnection_.iceConnectionState,p=this.getDTLSTransportState();if(this.log_.info("onConnectionStateChange() connectionState: "+u.target.connectionState),this.log_.info("ICE Transport state: ".concat(d,", DTLS Transport state: ").concat(p)),u.target.connectionState===Jm&&this.emitConnectionStateChangedEvent(vf),u.target.connectionState===XT||u.target.connectionState===py){var v="".concat(this.isUplink_?"uplink":"downlink"," ICE/DTLS Transport connection ").concat(u.target.connectionState,". ICE Transport state: ").concat(d,", DTLS Transport state: ").concat(p),f=new et({message:v,code:Ye.ICE_TRANSPORT_ERROR});jt.logFailedEvent({userId:this.client_.getUserId(),eventType:yI,error:f}),this.emitConnectionStateChangedEvent(Ur),this.isErrorObserved_||this.emitter_.emit(or.ERROR,f)}u.target.connectionState!==fy&&u.target.connectionState!==cI||(this.logSelectedCandidate(),jt.logSuccessEvent({userId:this.client_.getUserId(),eventType:yI}),this.emitConnectionStateChangedEvent(_o))}},{key:"emitConnectionStateChangedEvent",value:function(u){u!==this.currentState_&&(this.currentState_===Ti&&u===vf||(Me.emit(fE,{client:this.client_,connection:this,prevState:this.currentState_,state:u}),this.emitter_.emit(or.CONNECTION_STATE_CHANGED,{prevState:this.currentState_,state:u}),this.currentState_=u))}},{key:"hitTest",value:function(u){return(u===0||u==="0")&&this.isUplink_||u===this.tinyId_}},{key:"addEventInternal",value:function(u,d){var p=this.client_.getUserId(),v={eventId:u,eventDesc:d,timestamp:Yi(),userId:p,tinyId:this.client_.getTinyId()};this.isUplink_||(v.remoteUserId=this.userId_,v.remoteTinyId=this.tinyId_),Eo(p,v)}},{key:"getPeerConnection",value:function(){return this.peerConnection_}},{key:"getClient",value:function(){return this.client_}},{key:"getUserId",value:function(){return this.userId_}},{key:"getTinyId",value:function(){return this.tinyId_}},{key:"logSelectedCandidate",value:(c=D(regeneratorRuntime.mark(function u(){var d,p,v,f,y,I,T;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(this.peerConnection_){b.next=2;break}return b.abrupt("return");case 2:return b.next=4,this.peerConnection_.getStats();case 4:d=b.sent,p=ke(d),b.prev=6,p.s();case 8:if((v=p.n()).done){b.next=18;break}if((f=Pe(v.value,2))[0],y=f[1],!NE(y)){b.next=16;break}return I=d.get(y.localCandidateId),T=d.get(y.remoteCandidateId),I&&this.log_.info("local candidate: ".concat(I.candidateType," ").concat(I.protocol,":").concat(I.ip||I.address,":").concat(I.port," ").concat(I.networkType||""," ").concat(I.candidateType==="relay"?"relayProtocol:"+I.relayProtocol:"")),T&&this.log_.info("remote candidate: ".concat(T.candidateType," ").concat(T.protocol,":").concat(T.ip||T.address,":").concat(T.port)),b.abrupt("break",18);case 16:b.next=8;break;case 18:b.next=23;break;case 20:b.prev=20,b.t0=b.catch(6),p.e(b.t0);case 23:return b.prev=23,p.f(),b.finish(23);case 26:case"end":return b.stop()}},u,this,[[6,20,23,26]])})),function(){return c.apply(this,arguments)})},{key:"getCurrentState",value:function(){return this.currentState_}},{key:"waitForPeerConnectionConnected",value:function(){var u=this;return this.waitForPeerConnectionConnectedPromise_||(this.waitForPeerConnectionConnectedPromise_=new Promise(function(d,p){if(u.currentState_===_o)return d();var v=-1,f=function y(I){I.state===_o&&(clearTimeout(v),u.emitter_.off(or.CONNECTION_STATE_CHANGED,y,u),d())};v=setTimeout(function(){u.emitter_.off(or.CONNECTION_STATE_CHANGED,f,u);var y=new et({code:Ye.API_CALL_TIMEOUT,message:"connection timeout"});p(y)},1e4),u.emitter_.on(or.CONNECTION_STATE_CHANGED,f,u)}),this.waitForPeerConnectionConnectedPromise_=this.waitForPeerConnectionConnectedPromise_.then(function(d){return u.waitForPeerConnectionConnectedPromise_=null,d}).catch(function(d){throw u.waitForPeerConnectionConnectedPromise_=null,d})),this.waitForPeerConnectionConnectedPromise_}},{key:"getReconnectionCount",value:function(){return this.reconnectionCount_}},{key:"startReconnection",value:function(){this.isReconnecting_=!0,this.emitConnectionStateChangedEvent(Ti),this.reconnect(),this.addEventInternal(this.isUplink_?RE:$R,"".concat(this.isUplink_?"uplink":"downlink","-connection is reconnecting"))}},{key:"stopReconnection",value:function(){this.log_.info("stop reconnection"),this.isReconnecting_=!1,this.reconnectionCount_=0,this.clearReconnectionTimer(),this.signalChannel_.off(Sv,this.reconnect,this)}},{key:"on",value:function(u,d,p){this.emitter_.on(u,d,p)}},{key:"off",value:function(u,d,p){this.emitter_.off(u,d,p)}},{key:"setDelay",value:function(u){var d=u.audioDelay,p=u.videoDelay;this.delay_={audioDelay:d,videoDelay:p}}},{key:"getDelay",value:function(){return this.delay_}},{key:"isH264",get:function(){var u;return!((u=this.peerConnection_)===null||u===void 0||!u.remoteDescription.sdp.includes("H264"))}}]),r}(),gx=new(function(){function r(){x(this,r),this.set_=new Set,Me.on(zc,this.add,this),Me.on(Le,this.add,this),Me.on(Of,this.delete,this),Me.on(pv,this.delete,this)}return B(r,[{key:"add",value:function(c){var u=c.client,d=c.roomId;if(u.getMode()!=="rtc"){var p=this.getKey(u.getUserId(),d||u.getRoomId(),u.getSDKAppId(),u.getUseStringRoomId());this.set_.add(p)}}},{key:"delete",value:function(c){var u=c.client;if(u.getMode()!=="rtc"){var d=this.getKey(u.getUserId(),u.getRoomId(),u.getSDKAppId(),u.getUseStringRoomId());this.set_.delete(d)}}},{key:"getKey",value:function(c,u,d,p){return"".concat(d,"_").concat(u,"_").concat(c,"_").concat(p)}},{key:"isJoined",value:function(c){var u=c.userId,d=c.roomId,p=c.sdkAppId,v=c.client;return v.getMode()!=="rtc"&&this.set_.has(this.getKey(u,d,p,v.getUseStringRoomId()))}}]),r}());function iD(r,c,u,d){if(this.useStringRoomId_){if(!(yo(r)&&/^[A-Za-z\d\s!#$%&()+\-:;<=.>?@[\]^_{}|~,]{1,64}$/.test(r)))throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:Oh,data:c,link:{className:d,fnName:u}})})}else if(!(ha(r)&&/^[1-9]\d*$/.test(String(r))&&r<4294967295))throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:qo,data:c,link:{className:d,fnName:u}})})}function oD(r,c,u,d){if(!/^[A-Za-z\d_-]*$/.test(r))throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:AM,data:c,link:{className:d,fnName:u}})})}var aD,VC,Ts={TRTC:{createClient:{name:"clientConfig",required:!0,type:$u,properties:{sdkAppId:{required:!0,type:Wr,allowEmpty:!1},userId:{required:!0,type:Xr,allowEmpty:!1},userSig:{required:!0,type:Xr,allowEmpty:!1},mode:{required:!0,type:Xr,values:["rtc","live"]},useStringRoomId:{type:la},autoSubscribe:{type:la},enableAutoPlayDialog:{type:la},streamId:{type:Xr},userDefineRecordId:{type:Xr},pureAudioPushMode:{type:Wr,values:[1,2]},enableSEI:{type:la}}},createStream:{name:"streamConfig",required:!0,type:$u,properties:{userId:{type:Xr},audio:{type:la},video:{type:la},screen:{type:la},screenAudio:{type:la},microphoneId:{type:Xr},cameraId:{type:Xr},facingMode:{type:[Xr,$u]},audioSource:{instanceOf:window.MediaStreamTrack},videoSource:{instanceOf:window.MediaStreamTrack}},validate:function(r){if(!kt(r.screen)&&r.screen&&kt(r.audio)&&(r.audio=!1),!(kt(r.audio)&&kt(r.video)||kt(r.audioSource)&&kt(r.videoSource)))throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:hA})});if(!kt(r.screen)&&r.screen===!0&&r.video===!0)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:BM})});if(r.audio&&r.screenAudio)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:jM})});if(r.screen!==!0&&r.screenAudio===!0)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:pA})});if(!kt(r.screen)&&r.screen===!0&&!this.isScreenShareSupported())throw new et({code:Ye.INVALID_OPERATION,message:rt({key:mA})})}}},CLIENT:{join:{name:"options",required:!0,properties:{roomId:{required:!0,type:[Wr,Xr],allowEmpty:!1,validate:iD},role:{type:[Xr],values:["anchor","audience"]},privateMapKey:{type:[Xr]}},validate:function(r){if(this.isJoined_)throw new et({code:Ye.INVALID_OPERATION,message:rt({key:ev})});if(this.checkDestroy(),gx.isJoined({userId:this.userId_,roomId:r.roomId,sdkAppId:this.sdkAppId_,client:this}))throw new et({code:Ye.INVALID_OPERATION,message:rt({key:sA,data:this.userId_})})}},publish:{name:"stream",required:!0,instanceOf:Ey,validate:function(r){if(!this.isJoined_)throw new et({code:Ye.INVALID_OPERATION,message:rt({key:Kb})});if(this.mode_==="live"&&this.role_==="audience")throw new et({code:Ye.INVALID_OPERATION,message:rt({key:Wb})});if(this.localStream_)throw new et({code:Ye.INVALID_OPERATION,message:rt({key:yt})});if(!r.getIsReadyToPublish())throw new et({code:Ye.INVALID_OPERATION,message:rt({key:ht})});if(this.notPublishWithoutH264Supported_)throw new et({code:Ye.NOT_SUPPORTED_H264,message:rt({key:HM})})}},unpublish:{name:"stream",required:!0,instanceOf:Ey,validate:function(r){if(r!==this.localStream_){if(this.localStream_)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:CM})});this.log_.warn("Client currently has no published stream, please call publish() first.")}}},subscribe:[{name:"stream",required:!0,instanceOf:Ty,validate:function(r){if(!r.getConnection())throw new et({code:Ye.INVALID_OPERATION,message:rt({key:xI})});if(this.notSubscribeWithoutH264Supported_)throw new et({code:Ye.NOT_SUPPORTED_H264,message:rt({key:KI})})}},{name:"options",type:$u,properties:{audio:{type:la},video:{type:la}},validate:function(r){var c=r.audio,u=r.video;if(!(kt(c)||kt(u)||c||u))throw new et({code:Ye.INVALID_OPERATION,message:rt({key:_A})})}}],unsubscribe:{name:"stream",required:!0,instanceOf:Ty,validate:function(r){if(!r.getConnection())throw new et({code:Ye.INVALID_OPERATION,message:rt({key:xI})})}},switchRole:{name:"role",required:!0,values:["anchor","audience"],validate:function(){if(this.mode_!=="live")throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:Yb})});if(!this.isJoined_)throw new et({code:Ye.INVALID_OPERATION,message:rt({key:bM})})}},startPublishCDNStream:{name:"options",required:!1,properties:{streamId:{type:Xr,validate:oD},appId:{type:Wr,allowEmpty:!1},bizId:{type:Wr,allowEmpty:!1},url:{type:Xr,allowEmpty:!1}},validate:function(){if(this.isDestroyed_)throw new et({code:Ye.INVALID_OPERATION,message:rt({key:Cy,data:{funName:"startPublishCDNStream"}})})}},startMixTranscode:{name:"config",required:!0,type:$u,properties:{mode:{type:Xr,values:["preset-layout","manual"]},streamId:{type:Xr,validate:oD},videoWidth:{type:Wr,notLessThanZero:!0},videoHeight:{type:Wr,notLessThanZero:!0},videoBitrate:{type:Wr,notLessThanZero:!0,allowEmpty:!1},videoFramerate:{type:Wr,validate:function(r,c,u,d){if(r<=0||r>30)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:cA,link:{className:d,fnName:u}})})}},videoGop:{type:Wr,validate:function(r,c,u,d){if(r<1||r>8)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:uA,link:{className:d,fnName:u}})})}},audioSampleRate:{type:Wr,notLessThanZero:!0},audioBitrate:{type:Wr,validate:function(r,c,u,d){if(r<32||r>192)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:FM,link:{className:d,fnName:u}})})}},audioChannels:{type:Wr,values:[1,2]},backgroundColor:{type:Wr},backgroundImage:{type:Xr},mixUsers:{required:!0,type:rM,arrayItem:{require:!0,type:$u,properties:{userId:{required:!0,type:Xr},roomId:{type:[Xr,Wr],validate:iD},pureAudio:{type:la},width:{type:Wr,notLessThanZero:!0},height:{type:Wr,notLessThanZero:!0},locationX:{type:Wr,notLessThanZero:!0},locationY:{type:Wr,notLessThanZero:!0},zOrder:{type:Wr},streamType:{type:Xr,values:["main","auxiliary"]},renderMode:{type:Wr,values:[0,1,2,4]}}}}},validate:function(r,c,u,d,p){var v=0,f=0,y=r.mixUsers,I=[];if(y.forEach(function(T,b){if(I.push(T.userId),!T.pureAudio){if(!T.zOrder||T.zOrder<1||T>15)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:lA,data:"config.mixUsers[".concat(b,"].zOrder"),link:{className:d,fnName:u}})});T.width+T.locationX>v&&(v=T.width+T.locationX),T.height+T.locationY>f&&(f=T.height+T.locationY)}}),I.indexOf(this.getUserId())<0)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:dA,link:{className:d,fnName:u}})});if(r.videoWidth<v||r.videoHeight<f)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:VM,link:{className:d,fnName:u}})})}},sendSEIMessage:[{name:"buffer",required:!0,instanceOf:ArrayBuffer,validate:function(r){if(!OE)throw new et({code:Ye.NOT_SUPPORTED,message:rt({key:WM})});if(!this.enableSEI_)throw new et({code:Ye.INVALID_OPERATION,message:rt({key:zM})});if(r.byteLength>1e3)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:hs,data:r.byteLength})});if(r.byteLength===0)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:WI})});if(!this.uplinkConnection_)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:YM})});if(!this.localStream_.hasVideo())throw new et({code:Ye.INVALID_OPERATION,message:rt({key:yA})});var c=this.uplinkConnection_.isH264;if(!c)throw new et({code:Ye.NOT_SUPPORTED,message:rt({key:WM,data:c})})}},{name:"options",type:$u,properties:{seiPayloadType:{type:Wr,values:[5,243]}}}]},LOCAL_STREAM:{switchDevice:[{name:"type",required:!0,type:Xr,values:[ln,An]},{name:"deviceId",required:!0,type:Xr,validate:function(){if(this.screen_&&!this.audio_||this.audioSource_||this.videoSource_)throw new et({code:Ye.INVALID_OPERATION,message:rt({key:LM})});if(this.publishState_===yf)throw new et({code:Ye.INVALID_OPERATION,message:rt({key:od})})}}],setAudioCaptureVolume:{name:"volume",type:Wr}},STREAM:{play:[{name:"elementId",required:!0,type:[Xr,"HTMLDivElement"],validate:function(r,c,u){if(yo(r)){var d=document.getElementById(r);if(!d)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:Nh,data:{key:c,fnName:u}})});if(!(d instanceof HTMLDivElement))throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:HI,data:{key:c,fnName:u,type:ps(d)}})})}}},{name:"options",type:$u,properties:{objectFit:{type:Xr,values:["contain","cover","fill"]},muted:{type:la},mirror:{type:la}}}]}};function BC(){for(var r=arguments.length,c=new Array(r),u=0;u<r;u++)c[u]=arguments[u];return function(d,p,v){var f=v.value;return v.value=function(){for(var y=arguments.length,I=new Array(y),T=0;T<y;T++)I[T]=arguments[T];return sD.call(this,c,I,p,this.name_),f.apply(this,I)},v}}function yd(){for(var r=arguments.length,c=new Array(r),u=0;u<r;u++)c[u]=arguments[u];return function(d,p,v){var f=v.value;return v.value=D(regeneratorRuntime.mark(function y(){var I,T,b,k=arguments;return regeneratorRuntime.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:for(I=k.length,T=new Array(I),b=0;b<I;b++)T[b]=k[b];return sD.call(this,c,T,p,this.name_),N.abrupt("return",f.apply(this,T));case 3:case"end":return N.stop()}},y,this)})),v}}function sD(r,c,u,d){try{for(var p=0;p<r.length;p++)rw.call(this,{rule:r[p],value:c[p],key:r[p].name,fnName:u,className:d})}catch(v){throw Bt.error(v),v}}function rw(r){var c=this,u=r.rule,d=r.value,p=r.key,v=r.fnName,f=r.className;if(kt(d)){if(u.required)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:vM,data:{key:p,rule:u,fnName:v,value:d},link:{className:f,fnName:v}})})}else{if(Array.isArray(u.type)){if(!u.type.map(function(k){return k.toLowerCase()}).includes(ps(d)))throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:OI,data:{key:p,rule:u,fnName:v,value:d},link:{className:f,fnName:v}})})}else if(!kt(u.type)&&ps(d)!==u.type)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:OI,data:{key:p,rule:u,fnName:v,value:d},link:{className:f,fnName:v}})});if(u.allowEmpty===!1){var y=ha(d)&&(d===0||Number.isNaN(d)),I=yo(d)&&d.trim()==="";if(y||I)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:jb,data:{key:p,rule:u,fnName:v,value:d},link:{className:f,fnName:v}})})}if(u.notLessThanZero&&ha(d)&&d<0)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:GM,data:{key:p,rule:u,fnName:v,value:d},link:{className:f,fnName:v}})});if(yo(u.instanceOf)){if(!d||d.name_!==u.instanceOf)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:NI,data:{key:p,rule:u,fnName:v,value:d},link:{className:f,fnName:v}})})}else if(da(u.instanceOf)&&!(d instanceof u.instanceOf))throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:NI,data:{key:p,rule:u,fnName:v,value:d},link:{className:f,fnName:v}})});if(u.values&&!u.values.includes(d))throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:qb,data:{key:p,rule:u,fnName:v,value:d},link:{className:f,fnName:v}})});var T=u.properties;sd(T)&&ps(d)==="object"&&Object.keys(T).forEach(function(k){rw.call(c,{rule:T[k],value:d&&d[k],key:"".concat(p,".").concat(k),fnName:v,className:f})});var b=u.arrayItem;sd(b)&&JM(d)&&d.forEach(function(k,N){rw.call(c,{rule:b,value:k,key:"".concat(p,"[").concat(N,"]"),fnName:v,className:f})}),da(u.validate)&&u.validate.call(this,d,p,v,f,this)}}cn({target:"Number",stat:!0},{isNaN:function(r){return r!=r}});var cD=(aD=yd.apply(void 0,de(Ts.STREAM.play)),De((VC=function(){function r(f){x(this,r),this.name_=dM,this.userId_=f.userId,this.isRemote_=f.isRemote,this.type_=f.type,this.log_=Bt.createLogger({id:"s".concat(f.seq?f.seq:"","|").concat(this.userId_),userId:kt(f.client)?void 0:f.client.getUserId(),sdkAppId:kt(f.client)?void 0:f.client.getSDKAppId(),isLocal:!this.isRemote_,type:this.isRemote_?this.type_:""}),this.client_=null,kt(f.client)||(this.client_=f.client),this.mediaStream_=null,this.div_=null,this.isPlaying_=!1,this.connection_=null,this.audioPlayer_=null,this.videoPlayer_=null,this.muted_=!1,this.objectFit_="cover",this.mirror_=!1,this.id_=YR(),this.audioOutputDeviceId_=0,this.audioVolume_=1,this.emitter_=tR(new Wc,this.name_),this.connectionState_=Ur,this.installEvents(),kt(f.mirror)||this.log_.warn('TRTC.createStream "mirror" option was deprecated since v4.12.1\uFF0Cplease use localStream.play to set up preview mirror. refer to '.concat(Dh,"/en/LocalStream.html#play. TRTC.createStream \u63A5\u53E3\u7684 mirror \u9009\u9879\u4ECE v4.12.1 \u5F00\u59CB\u88AB\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528 localStream.play \u8BBE\u7F6E\u672C\u5730\u6D41\u9884\u89C8\u955C\u50CF\uFF0C\u53C2\u8003\u6587\u6863\uFF1A").concat(Dh,"/zh-cn/LocalStream.html#play\u3002"))}var c,u,d,p,v;return B(r,[{key:"installEvents",value:function(){Me.on(vv,this.restartPlayback,this)}},{key:"uninstallEvents",value:function(){Me.off(vv,this.restartPlayback,this)}},{key:"getType",value:function(){return this.type_}},{key:"getLogger",value:function(){return this.log_}},{key:"isSubscribed",get:function(){return this.type_===kr&&this.connection_.isMainStreamSubscribed||this.type_===Ni&&this.connection_.isAuxStreamSubscribed}},{key:"isMainVideoSubscribed",get:function(){var f=this.getSubscribedState();return this.type_===kr&&f&&f.video}},{key:"isMainAudioSubscribed",get:function(){var f=this.getSubscribedState();return this.type_===kr&&f&&f.audio}},{key:"isAuxVideoSubscribed",get:function(){var f=this.getSubscribedState();return this.type_===Ni&&f&&f.auxiliary}},{key:"isSmallVideoSubscribed",get:function(){var f=this.getSubscribedState();return this.type_===kr&&f&&f.smallVideo}},{key:"emitConnectionStateChanged",value:function(f){f.state!==this.connectionState_&&(f.state!==Ur&&this.isRemote_&&!this.isSubscribed||(this.emitter_.emit(yk,f),this.connectionState_=f.state))}},{key:"setConnection",value:function(f){this.connection_!==f&&(f instanceof nw?(this.connection_!==null&&this.connection_.off(or.CONNECTION_STATE_CHANGED,this.emitConnectionStateChanged,this),f.on(or.CONNECTION_STATE_CHANGED,this.emitConnectionStateChanged,this)):f===null&&this.connection_.off(or.CONNECTION_STATE_CHANGED,this.emitConnectionStateChanged,this),this.connection_=f)}},{key:"getConnection",value:function(){return this.connection_}},{key:"play",value:(v=D(regeneratorRuntime.mark(function f(y,I){var T,b,k;return regeneratorRuntime.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(this.log_.info("stream ".concat(this.isPlaying_?"update":"start to"," play with elementId: ").concat(y," and options: ").concat(JSON.stringify(I),".")),!this.isPlaying_){N.next=9;break}return I&&!kt(I.muted)&&(this.muted_=I.muted),I&&!kt(I.objectFit)&&(this.objectFit_=I.objectFit),this.isScreenShare()?this.mirror_=!1:I&&!kt(I.mirror)&&(this.mirror_=I.mirror),this.audioPlayer_&&this.audioPlayer_.setMuted(this.muted_),this.videoPlayer_&&(this.videoPlayer_.setObjectFit(this.objectFit_),this.videoPlayer_.setMirror(this.mirror_)),this.elementId_!==y&&(T=y,yo(y)&&(T=document.getElementById(y)),T.appendChild(this.div_),this.elementId_=y),N.abrupt("return");case 9:return this.isPlaying_=!0,(b=document.createElement("div")).setAttribute("id","player_".concat(this.id_)),b.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"),k=y,yo(y)&&(k=document.getElementById(y)),k.appendChild(b),this.elementId_=y,this.div_=b,this.isRemote_||(this.muted_=!0),I&&!kt(I.muted)&&(this.muted_=I.muted),this.isScreenShare()&&(this.objectFit_="contain"),I&&!kt(I.objectFit)&&(this.objectFit_=I.objectFit),this.isScreenShare()?this.mirror_=!1:(this.isRemote_||(this.mirror_=!0),I&&!kt(I.mirror)&&(this.mirror_=I.mirror)),Me.emit(Zu,{stream:this}),N.next=26,Promise.all([this.playAudio(),this.playVideo()]);case 26:Me.emit(CA,{stream:this});case 27:case"end":return N.stop()}},f,this)})),function(f,y){return v.apply(this,arguments)})},{key:"playAudio",value:(p=D(regeneratorRuntime.mark(function f(){var y,I,T=this;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(this.hasAudio()&&(!this.isRemote_||this.isMainAudioSubscribed)){b.next=2;break}return b.abrupt("return");case 2:if(y=this.getAudioTrack(),this.audioPlayer_||!y){b.next=17;break}return this.log_.info("stream - create AudioPlayer and play"),this.audioPlayer_=new Ct({stream:this,track:y,gainedTrack:(I=this.gain_)===null||I===void 0?void 0:I.audioTrack,div:this.div_,muted:this.muted_,outputDeviceId:this.audioOutputDeviceId_,volume:this.audioVolume_}),this.audioPlayer_.on(eo,function(k){var N={type:ln,state:k.state,reason:k.reason};Me.emit(aE,m({stream:T},N)),T.emitter_.emit(rC,N)}),b.prev=7,b.next=10,this.audioPlayer_.play();case 10:b.next=17;break;case 12:throw b.prev=12,b.t0=b.catch(7),this.client_&&this.client_.getEnableAutoPlayDialog()&&new Yo,this.emitter_.emit(Hf,b.t0),b.t0;case 17:case"end":return b.stop()}},f,this,[[7,12]])})),function(){return p.apply(this,arguments)})},{key:"playVideo",value:(d=D(regeneratorRuntime.mark(function f(){var y,I=this;return regeneratorRuntime.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(this.hasVideo()&&(!this.isRemote_||this.isMainVideoSubscribed||this.isAuxVideoSubscribed||this.isSmallVideoSubscribed)){T.next=2;break}return T.abrupt("return");case 2:if(y=this.getVideoTrack(),this.videoPlayer_||!y){T.next=18;break}return Me.emit(Uf,{stream:this}),this.log_.info("stream - create VideoPlayer and play"),this.videoPlayer_=new Is({stream:this,track:y,div:this.div_,muted:this.muted_,objectFit:this.objectFit_,mirror:this.mirror_}),this.videoPlayer_.on(eo,function(b){var k={type:An,state:b.state,reason:b.reason};Me.emit(aE,m({stream:I},k)),I.emitter_.emit(rC,k)}),T.prev=8,T.next=11,this.videoPlayer_.play();case 11:T.next=18;break;case 13:throw T.prev=13,T.t0=T.catch(8),this.client_&&this.client_.getEnableAutoPlayDialog()&&new Yo,this.emitter_.emit(Hf,T.t0),T.t0;case 18:case"end":return T.stop()}},f,this,[[8,13]])})),function(){return d.apply(this,arguments)})},{key:"stopAudio",value:function(){this.audioPlayer_&&(this.log_.info("stream - stop AudioPlayer"),this.audioPlayer_.stop(),this.audioPlayer_=null)}},{key:"stopVideo",value:function(){this.videoPlayer_&&(this.log_.info("stream - stop VideoPlayer"),this.videoPlayer_.stop(),this.videoPlayer_=null)}},{key:"restartPlayback",value:function(){this.audioPlayer_&&!this.audioPlayer_.isPlaying&&this.restartAudio(),this.videoPlayer_&&!this.videoPlayer_.isPlaying&&this.restartVideo()}},{key:"restartAudio",value:function(){this.isPlaying_&&(this.stopAudio(),this.playAudio().catch(function(f){}))}},{key:"restartVideo",value:function(){this.isPlaying_&&(this.stopVideo(),this.playVideo().catch(function(f){}))}},{key:"stop",value:function(){this.isPlaying_&&(this.isPlaying_=!1,this.stopAudio(),this.stopVideo(),this.div_.parentNode.removeChild(this.div_))}},{key:"resume",value:(u=D(regeneratorRuntime.mark(function f(){return regeneratorRuntime.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(this.isPlaying_){y.next=2;break}return y.abrupt("return");case 2:if(this.log_.info("stream - resume"),!this.audioPlayer_){y.next=6;break}return y.next=6,this.audioPlayer_.resume();case 6:if(!this.videoPlayer_){y.next=9;break}return y.next=9,this.videoPlayer_.resume();case 9:case"end":return y.stop()}},f,this)})),function(){return u.apply(this,arguments)})},{key:"close",value:function(){this.isPlaying_&&this.stop(),this.isRemote_||(this.mediaStream_&&(this.mediaStream_.preventEvent=1,this.mediaStream_.getTracks().forEach(function(f){f.stop()}),this.mediaStream_=null),this.uninstallEvents())}},{key:"muteAudio",value:function(){return this.addRemoteEvent(!0,ln),this.doEnableTrack(ln,!1)}},{key:"muteVideo",value:function(){return this.addRemoteEvent(!0,An),this.doEnableTrack(An,!1)}},{key:"unmuteAudio",value:function(){return this.addRemoteEvent(!1,ln),this.doEnableTrack(ln,!0)}},{key:"unmuteVideo",value:function(){return this.addRemoteEvent(!1,An),this.doEnableTrack(An,!0)}},{key:"addRemoteEvent",value:function(f,y){if(this.isRemote_&&this.client_){var I=this.client_.getUserId(),T="".concat(f?Tt:Pt," remote ").concat(y);Eo(I,{eventId:y===ln?f?rk:oS:f?FR:ik,eventDesc:T,timestamp:new Date().getTime(),userId:I,tinyId:this.client_.getTinyId(),remoteUserId:this.userId_,remoteTinyId:this.connection_.getTinyId()})}}},{key:"doEnableTrack",value:function(f,y){var I=!1;return f===ln?this.mediaStream_.getAudioTracks().forEach(function(T){I=!0,T.enabled=y}):this.mediaStream_.getVideoTracks().forEach(function(T){I=!0,T.enabled=y}),I}},{key:"getId",value:function(){return this.id_}},{key:"getUserId",value:function(){return this.userId_}},{key:"getTinyId",value:function(){return this.connection_?this.connection_.getTinyId():""}},{key:"isPlaying",value:function(){return this.isPlaying_}},{key:"setAudioOutput",value:(c=D(regeneratorRuntime.mark(function f(y){return regeneratorRuntime.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(this.audioOutputDeviceId_=y,!this.audioPlayer_){I.next=4;break}return I.next=4,this.audioPlayer_.setSinkId(y);case 4:case"end":return I.stop()}},f,this)})),function(f){return c.apply(this,arguments)})},{key:"setAudioVolume",value:function(f){this.audioVolume_=f,this.log_.info("setAudioVolume to ".concat(f)),this.audioPlayer_&&this.audioPlayer_.setVolume(f)}},{key:"getAudioLevel",value:function(){var f=0;return this.audioPlayer_&&(f=this.audioPlayer_.getAudioLevel()),f}},{key:"getInternalAudioLevel",value:function(){var f=0;return this.audioPlayer_&&(f=this.audioPlayer_.getInternalAudioLevel()),f}},{key:"hasAudio",value:function(){if(this.isRemote_){if(!this.connection_)return!1;var f=this.connection_.getTrackState();return this.type_===kr&&f.audio}return!!this.getAudioTrack()}},{key:"hasVideo",value:function(){if(this.isRemote_){if(!this.connection_)return!1;var f=this.connection_.getTrackState();return this.type_===Ni?f.auxiliary:f.video}return!!this.getVideoTrack()}},{key:"getSubscribedState",value:function(){return this.isRemote_&&this.connection_?this.connection_.getSubscribeState():null}},{key:"getAudioTrack",value:function(){var f=null;if(this.mediaStream_){var y=this.mediaStream_.getAudioTracks();y.length>0&&(f=y[0])}return f}},{key:"getVideoTrack",value:function(){var f=null;if(this.mediaStream_){var y=this.mediaStream_.getVideoTracks();y.length>0&&(f=y[0])}return f}},{key:"getVideoFrame",value:function(){return this.videoPlayer_?this.videoPlayer_.getVideoFrame():null}},{key:"getMediaStream",value:function(){return this.mediaStream_}},{key:"setMediaStream",value:function(f){f!==this.mediaStream_&&(this.mediaStream_&&this.mediaStream_.getTracks().forEach(function(y){return y.stop()}),this.mediaStream_=f)}},{key:"updateVideoPlayingState",value:function(f){this.isPlaying_&&(f?(this.log_.info("playing state updated, play video"),this.playVideo().catch(function(y){})):(this.log_.info("playing state updated, stop video"),this.stopVideo()))}},{key:"updateAudioPlayingState",value:function(f){this.isPlaying_&&(f?(this.log_.info("playing state updated, play audio"),this.playAudio().catch(function(y){})):(this.log_.info("playing state updated, stop audio"),this.stopAudio()))}},{key:"on",value:function(f,y,I){this.emitter_.on(f,y,I)}},{key:"off",value:function(f,y,I){f==="*"?this.emitter_.removeAllListeners():this.emitter_.off(f,y,I)}},{key:"isRemote",value:function(){return this.isRemote_}},{key:"isScreenShare",value:function(){return!this.isRemote_&&this.screen_||this.isRemote_&&this.getType()===Xi}},{key:"getDiv",value:function(){return this.div_}},{key:"getObjectFit",value:function(){return this.objectFit_}},{key:"getMuted",value:function(){return this.muted_}},{key:"getClient",value:function(){return this.client_}}]),r}()).prototype,"play",[aD],Object.getOwnPropertyDescriptor(VC.prototype,"play"),VC.prototype),VC),iw=function(r){re(u,r);var c=Xe(u);function u(d){var p;x(this,u);var v={isRemote:!0,type:d.type},f=m(m({},d),v);return(p=c.call(this,f)).name_=Ty,p.isStreamAddedEventEmitted_=!1,p.isAbleToCallSubscription_=!0,p}return B(u,[{key:"installEvents",value:function(){Be(ie(u.prototype),"installEvents",this).call(this),Me.on(Xu,this.handleStreamSubscribed,this),Me.on(Qu,this.handleStreamUnsubscribed,this)}},{key:"uninstallEvents",value:function(){Be(ie(u.prototype),"uninstallEvents",this).call(this),Me.off(Xu,this.handleStreamSubscribed,this),Me.off(Qu,this.handleStreamUnsubscribed,this)}},{key:"handleStreamSubscribed",value:function(d){d.client===this.client_&&d.stream===this&&this.connection_.getCurrentState()===_o&&this.emitConnectionStateChanged({prevState:Ur,state:_o})}},{key:"handleStreamUnsubscribed",value:function(d){d.client===this.client_&&d.stream===this&&this.emitConnectionStateChanged({prevState:_o,state:Ur})}},{key:"getType",value:function(){return Be(ie(u.prototype),"getType",this).call(this)}},{key:"getIsAbleToCallSubscription",value:function(){return this.isAbleToCallSubscription_}},{key:"setIsAbleToCallSubscription",value:function(d){this.isAbleToCallSubscription_=d}},{key:"setIsStreamAddedEventEmitted",value:function(d){this.isStreamAddedEventEmitted_=d}},{key:"getIsStreamAddedEventEmitted",value:function(){return this.isStreamAddedEventEmitted_}},{key:"getAudioTrack",value:function(){return this.connection_&&this.connection_.getTrackState().audio?Be(ie(u.prototype),"getAudioTrack",this).call(this):null}},{key:"getVideoTrack",value:function(){if(!this.connection_)return null;var d=this.connection_.getTrackState();return(this.type_!==kr||d.video)&&(this.type_!==Ni||d.auxiliary)?Be(ie(u.prototype),"getVideoTrack",this).call(this):null}},{key:"close",value:function(){Be(ie(u.prototype),"close",this).call(this)}}]),u}(cD),mx=function(){function r(p){x(this,r),this.client_=p.client,this.subscribedStreams_=new Map,this.unsubscribedStreams_=new Map,this.subscriptedOptions_=new Map,this.autoRecoveryFlags_=new Map}var c,u,d;return B(r,[{key:"isEnabled",get:function(){return this.client_.getEnv()!=="webrtc"}},{key:"recover",value:(d=D(regeneratorRuntime.mark(function p(v){var f,y,I;return regeneratorRuntime.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(f=v.getUserId(),y=v.getType(),this.hasAutoRecoveryFlag(f,y)){T.next=5;break}return T.abrupt("return");case 5:if(I=this.getUnsubscribedStream(f,y)?"unsubscribe":"subscribe",T.prev=6,Bt.warn("recover() try to recover subscription [".concat(I,"][").concat(f,"][").concat(y,"]")),I!=="subscribe"){T.next=13;break}return T.next=11,this.recoverSubscription(f,v);case 11:T.next=15;break;case 13:return T.next=15,this.recoverUnsubscription(f,v);case 15:jt.logSuccessEvent({userId:this.client_.getUserId(),eventType:EI}),Bt.warn("recover() recover successfully [".concat(I,"][").concat(f,"][").concat(y,"]")),T.next=23;break;case 19:T.prev=19,T.t0=T.catch(6),Bt.error("recover() recover failed [".concat(I,"][").concat(f,"][").concat(y,"]"),T.t0),jt.logFailedEvent({userId:this.client_.getUserId(),eventType:EI,error:T.t0});case 23:this.deleteAutoRecoveryFlag(f,y);case 24:case"end":return T.stop()}},p,this,[[6,19]])})),function(p){return d.apply(this,arguments)})},{key:"recoverSubscription",value:(u=D(regeneratorRuntime.mark(function p(v,f){var y,I,T,b,k;return regeneratorRuntime.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(y=this.getOptions(v,f.getType()),I=this.getSubscribedStream(v,f.getType()),y&&I){N.next=4;break}return N.abrupt("return");case 4:T=this.getStreamMuteState(I),b=T.isAudioMuted,k=T.isVideoMuted,this.mergeStream(I,f),this.recoverPlayingState(I),b&&I.doEnableTrack(ln,!1),k&&I.doEnableTrack(An,!1);case 9:case"end":return N.stop()}},p,this)})),function(p,v){return u.apply(this,arguments)})},{key:"recoverUnsubscription",value:(c=D(regeneratorRuntime.mark(function p(v,f){var y;return regeneratorRuntime.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(y=this.getUnsubscribedStream(v,f.getType())){I.next=3;break}return I.abrupt("return");case 3:this.mergeStream(y,f);case 4:case"end":return I.stop()}},p,this)})),function(p,v){return c.apply(this,arguments)})},{key:"getStreamMuteState",value:function(p){var v={isAudioMuted:!1,isVideoMuted:!1},f=p.getMediaStream();return f&&(v.isAudioMuted=f.getAudioTracks().map(function(y){return y.enabled}).includes(!1),v.isVideoMuted=f.getVideoTracks().map(function(y){return y.enabled}).includes(!1)),v}},{key:"recoverPlayingState",value:function(p){var v=p.isPlaying(),f=p.getDiv();if(v&&f){var y=f.parentNode;p.stop(),p.play(y,{objectFit:p.getObjectFit(),muted:p.getMuted()})}}},{key:"mergeStream",value:function(p,v){var f=v.getConnection(),y=v.getMediaStream();p.setConnection(f),f.setRemoteStream(y.id,p),p.setMediaStream(y),p.updateAudioPlayingState(v.hasAudio()),p.updateVideoPlayingState(v.hasVideo())}},{key:"addSubscriptionRecord",value:function(p,v,f){var y=v.getType();if(this.subscribedStreams_.has(p))this.subscribedStreams_.get(p).set(y,v);else{var I=new Map;I.set(v.getType(),v),this.subscribedStreams_.set(p,I)}if(this.subscriptedOptions_.has(p))this.subscriptedOptions_.get(p).set(y,f);else{var T=new Map;T.set(v.getType(),f),this.subscriptedOptions_.set(p,T)}this.deleteUnsubscriptionRecord(p,y)}},{key:"addUnsubscriptionRecord",value:function(p,v){if(this.unsubscribedStreams_.has(p))this.unsubscribedStreams_.get(p).set(v.getType(),v);else{var f=new Map;f.set(v.getType(),v),this.unsubscribedStreams_.set(p,f)}this.deleteSubscriptionRecord(p,v.getType())}},{key:"getSubscribedStream",value:function(p,v){return this.subscribedStreams_.has(p)&&this.subscribedStreams_.get(p).has(v)?this.subscribedStreams_.get(p).get(v):null}},{key:"getOptions",value:function(p,v){return this.subscriptedOptions_.has(p)&&this.subscriptedOptions_.get(p).has(v)?this.subscriptedOptions_.get(p).get(v):null}},{key:"getUnsubscribedStream",value:function(p,v){return this.unsubscribedStreams_.has(p)&&this.unsubscribedStreams_.get(p).has(v)?this.unsubscribedStreams_.get(p).get(v):null}},{key:"deleteSubscriptionRecord",value:function(p,v){this.subscribedStreams_.has(p)&&this.subscribedStreams_.get(p).delete(v),this.subscriptedOptions_.has(p)&&this.subscriptedOptions_.get(p).delete(v)}},{key:"deleteUnsubscriptionRecord",value:function(p,v){this.unsubscribedStreams_.has(p)&&this.unsubscribedStreams_.get(p).delete(v)}},{key:"markAllStream",value:function(){for(var p=0,v=de(this.subscribedStreams_.entries());p<v.length;p++)for(var f=Pe(v[p],2),y=f[0],I=0,T=de(f[1].entries());I<T.length;I++){var b=Pe(T[I],1)[0];this.setAutoRecoveryFlag(y,b)}for(var k=0,N=de(this.unsubscribedStreams_.entries());k<N.length;k++)for(var O=Pe(N[k],2),F=O[0],G=0,P=de(O[1].entries());G<P.length;G++){var K=Pe(P[G],1)[0];this.setAutoRecoveryFlag(F,K)}}},{key:"setAutoRecoveryFlag",value:function(p,v){if(Bt.info("setAutoRecoveryFlag() mark [".concat(p,"][").concat(v,"]")),this.autoRecoveryFlags_.has(p))this.autoRecoveryFlags_.get(p).set(v);else{var f=new Map;f.set(v),this.autoRecoveryFlags_.set(p,f)}}},{key:"hasAutoRecoveryFlag",value:function(p,v){return!!this.isEnabled&&this.autoRecoveryFlags_.has(p)&&this.autoRecoveryFlags_.get(p).has(v)}},{key:"deleteAutoRecoveryFlag",value:function(p,v){this.autoRecoveryFlags_.has(p)&&this.autoRecoveryFlags_.get(p).delete(v)}},{key:"delete",value:function(p){this.unsubscribedStreams_.delete(p),this.subscribedStreams_.delete(p),this.subscriptedOptions_.delete(p),this.autoRecoveryFlags_.delete(p)}}]),r}();cn({target:"String",proto:!0,forced:gM("small")},{small:function(){return Ry(this,"small","","")}});var vx=function(){function r(c){x(this,r),this.player_=c,this.canvas_=document.createElement(Fb),this.canvasCtx_=this.canvas_.getContext("2d")}return B(r,[{key:"setCanvasRect",value:function(c,u){this.canvas_.width=c,this.canvas_.height=u}},{key:"drawVideoToCanvas",value:function(){var c=this.player_.getElement();this.canvasCtx_.drawImage(c,0,0,this.canvas_.width,this.canvas_.height)}},{key:"generateVideoTrackFromCanvasCapture",value:function(c){return this.canvas_.captureStream(c).getVideoTracks()[0]}},{key:"generateStreamFromTrack",value:function(c){var u=new MediaStream;return u.addTrack(c),u}},{key:"destroy",value:function(){this.player_.stop(),this.canvas_=null,this.canvasCtx_=null}},{key:"canvas",get:function(){return this.canvas_}},{key:"canvasCtx",get:function(){return this.canvasCtx_}},{key:"canDrawVideoToCanvas",get:function(){if(this.player_){var c=this.player_.getElement();if(c)return c.readyState===c.HAVE_ENOUGH_DATA}return!1}}]),r}(),_x=new Blob(["let width,height,offscreen,ctx;onmessage=function(e){const{action,data}=e.data;switch(action){case'render':offscreen=data.canvas;width=offscreen.width;height=offscreen.height;ctx=offscreen.getContext('2d');draw(data.readable,data.writable);break}};function draw(readable,writable){const transformer=new TransformStream({async transform(cameraFrame,controller){ctx.drawImage(cameraFrame,0,0,width,height);const frame=new VideoFrame(offscreen,{timestamp:cameraFrame.timestamp});cameraFrame.close();controller.enqueue(frame)}});readable.pipeThrough(transformer).pipeTo(writable)}"],{type:"application/javascript"}),yx=function(){function r(c){x(this,r);var u=c.videoTrack;this.width=void 0,this.height=void 0,this.canvas=null,this.offscreen=null,this.smallGenerator=new MediaStreamTrackGenerator({kind:"video"}),this.smallWritable=this.smallGenerator.writable,this.bigProcessor=new MediaStreamTrackProcessor({track:u}),this.bigReadable=this.bigProcessor.readable,this.initWorker()}return B(r,[{key:"initWorker",value:function(){try{this.worker=new Worker(URL.createObjectURL(_x)),Bt.info("init worker processor success")}catch(c){Bt.warn("init worker processor failed. ".concat(c.error))}}},{key:"setCanvasRect",value:function(c,u){this.width=c,this.height=u,this.canvas=document.createElement("canvas"),this.canvas.width=c,this.canvas.height=u,this.offscreen=this.canvas.transferControlToOffscreen(),this.worker.postMessage({action:"render",data:{canvas:this.offscreen,readable:this.bigReadable,writable:this.smallWritable}},[this.offscreen,this.bigReadable,this.smallWritable])}},{key:"generatorVideoTrack",value:function(){var c=new MediaStream([this.smallGenerator]);return c==null?void 0:c.getTracks()[0]}},{key:"destroy",value:function(){this.worker.terminate()}}]),r}(),Sx=function(){function r(u){x(this,r),this.localStream_=u,this.player_=null,this.processor_=null,this.initOffscreenSuccess_=!1}var c;return B(r,[{key:"initialize",value:(c=D(regeneratorRuntime.mark(function u(){var d;return regeneratorRuntime.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(v=void 0,f=void 0,y=void 0,!(((v=window)===null||v===void 0?void 0:v.OffscreenCanvas)&&((f=window)===null||f===void 0?void 0:f.MediaStreamTrackProcessor)&&((y=window)===null||y===void 0?void 0:y.MediaStreamTrackGenerator)&&((d=navigator)===null||d===void 0?void 0:d.hardwareConcurrency)>=6)){p.next=13;break}return p.prev=1,p.next=4,this.initOffscreen();case 4:this.initOffscreenSuccess_=!0,Bt.info("Initialize VideoGenerator successfully!"),p.next=11;break;case 8:p.prev=8,p.t0=p.catch(1),this.initCanvas();case 11:p.next=14;break;case 13:this.initCanvas();case 14:case"end":return p.stop()}var v,f,y},u,this,[[1,8]])})),function(){return c.apply(this,arguments)})},{key:"generateSmallVideoTrack",value:function(u){var d,p=this.getSmallVideoProfile(u);return this.initOffscreenSuccess_?(this.processor_.setCanvasRect(p.width,p.height),d=this.processor_.generatorVideoTrack()):(this.processor_.setCanvasRect(p.width,p.height),this.player_.setRect({width:p.width,height:p.height}),d=this.processor_.generateVideoTrackFromCanvasCapture(p.frameRate),this.interval_=ii.setInterval(this.render.bind(this),Math.ceil(1e3/p.frameRate))),d}},{key:"render",value:function(){this.processor_.canDrawVideoToCanvas&&this.processor_.drawVideoToCanvas()}},{key:"destroy",value:function(){ii.clearInterval(this.interval_),this.processor_&&this.processor_.destroy()}},{key:"initOffscreen",value:function(){this.processor_=new yx({videoTrack:this.localStream_.getVideoTrack()})}},{key:"initCanvas",value:function(){this.player_=new Is({stream:this.localStream_,track:this.localStream_.getVideoTrack(),muted:!0,objectFit:"cover",mirror:!1}),this.player_.play().then(function(){Bt.info("VideoGenerator: play local video success")}).catch(function(){Bt.error("VideoGenerator: Failed to play local video")}),this.processor_=new vx(this.player_)}},{key:"getSmallVideoProfile",value:function(u){var d,p=this.localStream_.getVideoTrack(),v=this.localStream_.getVideoProfile(),f=p.getSettings(),y=f&&f.width&&f.height?{width:f.width,height:f.height}:v,I=y.width*y.height,T=u.width*u.height;return Bt.info("big stream resolution: ".concat(y.height,"*").concat(y.width," small stream resolution: ").concat(u.height,"*").concat(u.width," ")),I>T?d=I/T:(Bt.warn("Small stream resolution is larger than big stream, which is invalid. big: ".concat(y.width," * ").concat(y.height," small: ").concat(u.width," * ").concat(u.height)),d=I/19200),{width:parseInt(y.width/Math.sqrt(d)),height:parseInt(y.height/Math.sqrt(d)),frameRate:u.frameRate}}}]),r}(),uD={voiceActivityDetection:!1},Ix=function(r){re(F,r);var c,u,d,p,v,f,y,I,T,b,k,N,O=Xe(F);function F(G){var P;return x(this,F),(P=O.call(this,G)).localStream_=null,P.exchangeSDPTimeout_=-1,P.smallGenerator_=null,P.isSDPExchanging_=!1,P.ssrc_={audio:0,video:0,small:0},P.canvasTrack_=null,P}return B(F,[{key:"initialize",value:function(){Be(ie(F.prototype),"initialize",this).call(this),this.installEvents()}},{key:"reset",value:function(){this.closePeerConnection(),this.uninstallEvents(),this.clearExchangeSDPTimeout(),this.canvasTrack_=null,this.localStream_&&this.localStream_.clearCanvas()}},{key:"close",value:function(){this.reset(),this.emitConnectionStateChangedEvent(Ur),this.smallGenerator_&&(this.smallGenerator_.destroy(),this.smallGenerator_=null)}},{key:"installEvents",value:function(){this.emitter_.on(or.ERROR,this.handleError,this),this.emitter_.on(or.CONNECTION_STATE_CHANGED,this.handleConnectionStateChange,this)}},{key:"uninstallEvents",value:function(){this.emitter_.off(or.ERROR,this.handleError,this),this.emitter_.off(or.CONNECTION_STATE_CHANGED,this.handleConnectionStateChange,this)}},{key:"publish",value:(N=D(regeneratorRuntime.mark(function G(P){var K,X,oe,Ce,Ve;return regeneratorRuntime.wrap(function(je){for(;;)switch(je.prev=je.next){case 0:if(this.localStream_=P,K=P.getMediaStream(),this.log_.info("is publishing stream: ".concat(P.getId())),X=this.localStream_.getAudioTrack(),oe=this.localStream_.getVideoTrack(),X&&(Ce=this.localStream_.getGainedTrack(),this.peerConnection_.addTrack(Ce||X,K)),!oe){je.next=14;break}if((ls||dy)&&XM(oe)?(this.canvasTrack_=this.localStream_.genCanvasTrack(oe),this.peerConnection_.addTrack(this.canvasTrack_,K)):this.peerConnection_.addTrack(oe,K),!this.client_.getIsEnableSmallStream()){je.next=14;break}return this.smallGenerator_=new Sx(this.localStream_),je.next=12,this.smallGenerator_.initialize();case 12:Ve=this.smallGenerator_.generateSmallVideoTrack(this.client_.smallStreamConfig_),this.peerConnection_.addTrack(Ve,K);case 14:return je.next=16,this.connect();case 16:return je.abrupt("return",P);case 17:case"end":return je.stop()}},G,this)})),function(G){return N.apply(this,arguments)})},{key:"updateMediaSettings",value:function(G){var P=this,K=this.getMediaSettings(G);this.signalChannel_.sendWaitForResponse({command:OR,data:K,responseCommand:wr.UPDATE_CONSTRAINT_CONFIG_RES}).then(function(X){X.data.code!==0&&P.log_.warn(X.data.message)}).catch(this.log_.warn)}},{key:"getMediaSettings",value:function(G){var P=this,K=this.client_.getSystemResult().detail,X=K.isH264EncodeSupported,oe=K.isVp8EncodeSupported,Ce="";X?Ce="H264":oe&&(Ce="VP8");var Ve={videoCodec:Ce,videoWidth:0,videoHeight:0,videoBps:0,videoFps:0,audioCodec:"opus",audioFs:0,audioChannel:0,audioBps:0};return qf?G.getTracks().forEach(function(je){var Re=je.getSettings();if(je.kind===ln){var Oe=1;Re.channelCount&&(Oe=Re.channelCount),Ve.audioChannel=Oe,Ve.audioBps=1e3*P.localStream_.getAudioBitrate(),Ve.audioFs=Re.sampleRate}else je.kind===An&&(P.client_.getIsEnableSmallStream()&&(Ve.smallVideoWidth=P.client_.smallStreamConfig.width,Ve.smallVideoHeight=P.client_.smallStreamConfig.height,Ve.smallVideoFps=P.client_.smallStreamConfig.framerate,Ve.smallVideoBps=1e3*P.client_.smallStreamConfig.bitrate),Ve.videoWidth=Re.width,Ve.videoHeight=Re.height,Ve.videoFps=Re.frameRate,Ve.videoBps=1e3*P.localStream_.getVideoBitrate())}):Ve=this.getMediaSettingsFromProfile(Ve),this.log_.info("updateMediaSettings: "+JSON.stringify(Ve)),Ve}},{key:"getMediaSettingsFromProfile",value:function(G){var P=this.localStream_;if(P){if(P.getAudioTrack()){var K=P.getAudioProfile();G.audioChannel=K.channelCount,G.audioBps=1e3*K.bitrate,G.audioFs=K.sampleRate}if(P.getVideoTrack()){var X=P.getVideoProfile();G.videoWidth=X.width,G.videoHeight=X.height,G.videoFps=X.frameRate,G.videoBps=1e3*X.bitrate}}return G}},{key:"addTrack",value:(k=D(regeneratorRuntime.mark(function G(P){var K,X,oe;return regeneratorRuntime.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:if(!this.peerConnection_){Ce.next=19;break}if(P.kind===An&&(ls||dy)&&XM(P)&&(P=this.canvasTrack_=this.localStream_.genCanvasTrack(P)),this.log_.info("is adding ".concat(P.kind," track to current published local stream")),!(eC()&&this.peerConnection_.getTransceivers().findIndex(function(Ve){return Ve.direction==="stopped"})>=0)){Ce.next=7;break}return this.log_.warn("transceiver is stopping, negotiate sdp first"),Ce.next=7,this.updateOffer(id,P);case 7:if(!(K=this.peerConnection_.getSenders().find(function(Ve){return Ve.track&&Ve.track.kind===P.kind}))){Ce.next=14;break}return this.log_.warn("sender already exists, remove sender first"),X=K.track,this.removeSender(K),Ce.next=14,this.updateOffer(id,X);case 14:return oe=this.localStream_.getMediaStream(),this.peerConnection_.addTrack(P,oe),Ce.next=18,this.updateOffer(Ku,P);case 18:Eo(this.userId_,{eventId:P.kind===ln?vs:ms,eventDesc:"add ".concat(P.kind," track to current published stream"),timestamp:Yi(),userId:this.userId_,tinyId:this.tinyId_});case 19:case"end":return Ce.stop()}},G,this)})),function(G){return k.apply(this,arguments)})},{key:"isNeedToResetOfferOrder",value:function(){if(this.sdpSemantics_==="plan-b"||!this.peerConnection_||!this.peerConnection_.localDescription)return!1;for(var G=this.peerConnection_.localDescription.sdp,P=Zs(G),K=0;K<P.media.length;K++)if(P.media[K].mid===0&&P.media[K].type===An)return!0;return!1}},{key:"removeSender",value:function(G){var P=null;eC()&&(P=this.peerConnection_.getTransceivers().find(function(K){return K.sender&&K.sender.track===G.track})),this.peerConnection_.removeTrack(G),P&&da(P.stop)&&(this.log_.info("stop transceiver"),P.stop())}},{key:"removeTrack",value:(b=D(regeneratorRuntime.mark(function G(P){var K,X;return regeneratorRuntime.wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(!this.peerConnection_||!lS()){oe.next=15;break}if(P.kind===An&&(ls||dy)&&this.canvasTrack_&&(P=this.canvasTrack_,this.localStream_.clearCanvas()),this.log_.info("is removing ".concat(P.kind," track from current published local stream")),P.kind!==An||!this.isNeedToResetOfferOrder()){oe.next=10;break}return this.reset(),this.initialize(),(K=this.localStream_.getMediaStream())===null||K===void 0||K.removeTrack(P),oe.next=9,this.publish(this.localStream_);case 9:return oe.abrupt("return");case 10:return(X=this.peerConnection_.getSenders().find(function(Ce){return Ce.track===P}))&&this.removeSender(X),oe.next=14,this.updateOffer(id,P);case 14:Eo(this.userId_,{eventId:P.kind===ln?Xc:Bh,eventDesc:"remove ".concat(P.kind," track from current published stream"),timestamp:Yi(),userId:this.userId_,tinyId:this.tinyId_});case 15:case"end":return oe.stop()}},G,this)})),function(G){return b.apply(this,arguments)})},{key:"replaceTrack",value:(T=D(regeneratorRuntime.mark(function G(P){var K,X=this;return regeneratorRuntime.wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(P.kind!==An||!ls&&!dy||!this.canvasTrack_){oe.next=2;break}return oe.abrupt("return");case 2:if(Iv()&&lS()){oe.next=4;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:gA})});case 4:if(this.peerConnection_){oe.next=6;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:VI})});case 6:if((K=this.peerConnection_.getSenders()).length!==0){oe.next=9;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:VI})});case 9:K.forEach(function(Ce){Ce.track&&Ce.track.kind===P.kind&&(X.log_.info("is replacing ".concat(P.kind," track to current published local stream")),Ce.replaceTrack(P))}),Eo(this.userId_,{eventId:P.kind===ln?GR:UR,eventDesc:"replace ".concat(P.kind," track from current published stream"),timestamp:Yi(),userId:this.userId_,tinyId:this.tinyId_});case 11:case"end":return oe.stop()}},G,this)})),function(G){return T.apply(this,arguments)})},{key:"setBandwidth",value:(I=D(regeneratorRuntime.mark(function G(P,K,X){var oe,Ce;return regeneratorRuntime.wrap(function(Ve){for(;;)switch(Ve.prev=Ve.next){case 0:if(this.isUplink_){Ve.next=2;break}return Ve.abrupt("return",X);case 2:if(DE()){Ve.next=4;break}return Ve.abrupt("return",K===An?this.updateVideoBandwidthRestriction(X,P):this.updateAudioBandwidthRestriction(X,P));case 4:if(!(oe=this.peerConnection_.getSenders().find(function(je){return je.track&&je.track.kind===K}))){Ve.next=20;break}return(Ce=oe.getParameters()).encodings&&Ce.encodings.length!==0||(Ce.encodings=[{}]),P==="unlimited"?delete Ce.encodings[0].maxBitrate:Ce.encodings[0].maxBitrate=1e3*P,Ve.prev=9,Ve.next=12,oe.setParameters(Ce);case 12:return this.log_.info(K+" bandwidth was set to "+P+" kbps"),Ve.abrupt("return",X);case 16:return Ve.prev=16,Ve.t0=Ve.catch(9),this.log_.info("failed to set bandwidth by setting maxBitrate: "+Ve.t0),Ve.abrupt("return",K===An?this.updateVideoBandwidthRestriction(X,P):this.updateAudioBandwidthRestriction(X,P));case 20:return Ve.abrupt("return",X);case 21:case"end":return Ve.stop()}},G,this,[[9,16]])})),function(G,P,K){return I.apply(this,arguments)})},{key:"setSmallStreamBandwidth",value:(y=D(regeneratorRuntime.mark(function G(P,K){var X,oe;return regeneratorRuntime.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:if(this.isUplink_){Ce.next=2;break}return Ce.abrupt("return",K);case 2:if(DE()){Ce.next=4;break}return Ce.abrupt("return",this.updateSmallVideoBandwidthRestriction(K,P));case 4:if(!(X=this.peerConnection_.getSenders().filter(function(Ve){return Ve.track&&Ve.track.kind===An})[1])){Ce.next=20;break}return(oe=X.getParameters()).encodings&&oe.encodings.length!==0||(oe.encodings=[{}]),P==="unlimited"?delete oe.encodings[0].maxBitrate:oe.encodings[0].maxBitrate=1e3*P,Ce.prev=9,Ce.next=12,X.setParameters(oe);case 12:return this.log_.info("small stream bandwidth was set to "+P+" kbps"),Ce.abrupt("return",K);case 16:return Ce.prev=16,Ce.t0=Ce.catch(9),this.log_.info("failed to set small stream bandwidth by setting maxBitrate: "+Ce.t0),Ce.abrupt("return",this.updateSmallVideoBandwidthRestriction(K,P));case 20:return Ce.abrupt("return",K);case 21:case"end":return Ce.stop()}},G,this,[[9,16]])})),function(G,P){return y.apply(this,arguments)})},{key:"updateVideoBandwidthRestriction",value:function(G,P){var K="AS";return Vc&&(K="TIAS",P*=1e3),G=G.indexOf("b="+K+":")===-1?G.replace(/m=video (.*)\r\nc=IN (.*)\r\n/,`m=video $1\r
c=IN $2\r
b=`+K+":"+P+`\r
`):G.replace(new RegExp("b="+K+`:.*\r
`),"b="+K+":"+P+`\r
`)}},{key:"updateAudioBandwidthRestriction",value:function(G,P){var K="AS";return Vc&&(K="TIAS",P*=1e3),G=G.replace(/m=audio (.*)\r\nc=IN (.*)\r\n/,`m=audio $1\r
c=IN $2\r
b=`+K+":"+P+`\r
`)}},{key:"updateSmallVideoBandwidthRestriction",value:function(G,P){var K="AS";Vc&&(K="TIAS",P*=1e3);var X=/m=video (.*)\r\nc=IN (.*)\r\n/g,oe=[],Ce=X.exec(G);for(oe.push(Ce);Ce!==null;)Ce=X.exec(G),oe.push(Ce);var Ve=oe[oe.length-2],je=G.slice(0,Ve.index),Re=G.slice(Ve.index);return G=G.indexOf("b="+K+":")===-1?je+(Re=Re.replace(/m=video (.*)\r\nc=IN (.*)\r\n/,`m=video $1\r
c=IN $2\r
b=`+K+":"+P+`\r
`)):je+(Re=Re.replace(new RegExp("b="+K+`:.*\r
`),"b="+K+":"+P+`\r
`))}},{key:"removeBandwidthRestriction",value:function(G){return G.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,"")}},{key:"removeVideoOrientation",value:function(G){return G.replace(/urn:3gpp:video-orientation/,"")}},{key:"connect",value:(f=D(regeneratorRuntime.mark(function G(){return regeneratorRuntime.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.prev=0,P.next=3,this.exchangeSDP();case 3:return P.next=5,this.waitForPeerConnectionConnected();case 5:P.next=11;break;case 7:throw P.prev=7,P.t0=P.catch(0),this.closePeerConnection(!0),P.t0;case 11:case"end":return P.stop()}},G,this,[[0,7]])})),function(){return f.apply(this,arguments)})},{key:"exchangeSDP",value:(v=D(regeneratorRuntime.mark(function G(){return regeneratorRuntime.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.prev=0,this.isSDPExchanging_=!0,P.next=4,this.createOffer();case 4:return this.log_.info("createOffer success, sending offer to remote server"),P.next=7,this.doExchangeSDP();case 7:this.isSDPExchanging_=!1,P.next=14;break;case 10:throw P.prev=10,P.t0=P.catch(0),this.isSDPExchanging_=!1,P.t0;case 14:case"end":return P.stop()}},G,this,[[0,10]])})),function(){return v.apply(this,arguments)})},{key:"createOffer",value:(p=D(regeneratorRuntime.mark(function G(){var P;return regeneratorRuntime.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return K.prev=0,K.next=3,this.peerConnection_.createOffer(uD);case 3:return P=K.sent,K.next=6,this.peerConnection_.setLocalDescription(P);case 6:this.updateSSRC(P.sdp),jt.logSuccessEvent({userId:this.client_.getUserId(),eventType:vy,kind:"offer"}),K.next=14;break;case 10:throw K.prev=10,K.t0=K.catch(0),jt.logFailedEvent({userId:this.client_.getUserId(),eventType:vy,kind:"offer",error:K.t0}),K.t0;case 14:case"end":return K.stop()}},G,this,[[0,10]])})),function(){return p.apply(this,arguments)})},{key:"doExchangeSDP",value:function(){var G=this;return new Promise(function(P,K){G.exchangeSDPTimeout_=setTimeout(function(){G.signalChannel_.off(wr.PUBLISH_RESULT,X),G.clearExchangeSDPTimeout();var Ve=new et({code:Ye.API_CALL_TIMEOUT,message:rt({key:IM})});K(Ve)},5e3);var X=function(){var Ve=D(regeneratorRuntime.mark(function je(Re){var Oe,qe,$e;return regeneratorRuntime.wrap(function(Tn){for(;;)switch(Tn.prev=Tn.next){case 0:if(Tn.prev=0,G.clearExchangeSDPTimeout(),Oe=Re.data,qe=Oe.code,$e=Oe.message,qe!==0){Tn.next=9;break}return Tn.next=6,G.acceptAnswer(Re.data.data);case 6:P(),Tn.next=10;break;case 9:G.checkPublishResultCode(qe,$e);case 10:Tn.next=15;break;case 12:Tn.prev=12,Tn.t0=Tn.catch(0),K(Tn.t0);case 15:case"end":return Tn.stop()}},je,null,[[0,12]])}));return function(je){return Ve.apply(this,arguments)}}(),oe=G.getMediaSettings(G.localStream_.getMediaStream()),Ce={type:G.peerConnection_.localDescription.type,sdp:G.removeVideoOrientation(G.peerConnection_.localDescription.sdp),screen:G.localStream_.hasScreenTrack(),constraintConfig:oe};G.signalChannel_.once(wr.PUBLISH_RESULT,X),G.log_.debug("sending sdp offer: "+Ce.sdp),G.signalChannel_.send(Ff,Ce)})}},{key:"setSDPDirection",value:function(G,P){var K=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"all",X=Zs(G);return X.media.forEach(function(oe){K!=="all"&&oe.type!==K||(oe.direction=P)}),Hh(X)}},{key:"updateOffer",value:(d=D(regeneratorRuntime.mark(function G(P,K){var X,oe,Ce,Ve,je,Re,Oe;return regeneratorRuntime.wrap(function(qe){for(;;)switch(qe.prev=qe.next){case 0:return qe.prev=0,qe.next=3,this.peerConnection_.createOffer(uD);case 3:return X=qe.sent,Vc&&(X.sdp=this.setSDPDirection(X.sdp,"sendrecv")),qe.next=7,this.peerConnection_.setLocalDescription(X);case 7:return oe=this.getMediaSettings(this.localStream_.getMediaStream()),Ce={action:P,trackId:K.id,kind:K.kind===An?"bigVideo":K.kind,type:"offer",sdp:this.peerConnection_.localDescription.sdp,constraintConfig:oe},this.log_.info("createOffer success, sending updated offer to remote server"),this.log_.debug("updatedOffer: "+Ce.sdp),qe.next=13,this.signalChannel_.sendWaitForResponse({command:qA,data:Ce,responseCommand:wr.UPDATE_OFFER_RESULT,timeout:1e4,commandDesc:"update offer"});case 13:return Ve=qe.sent,je=Ve.data,Re=je.code,Oe=je.message,Re!==0&&this.checkPublishResultCode(Re,Oe),qe.next=18,this.acceptAnswer(Ve.data.data);case 18:this.updateSSRC(X.sdp),jt.logSuccessEvent({userId:this.client_.getUserId(),eventType:vy,kind:"offer"}),qe.next=27;break;case 22:throw qe.prev=22,qe.t0=qe.catch(0),this.log_.error(qe.t0),jt.logFailedEvent({userId:this.client_.getUserId(),eventType:vy,kind:"offer",error:qe.t0}),qe.t0;case 27:case"end":return qe.stop()}},G,this,[[0,22]])})),function(G,P){return d.apply(this,arguments)})},{key:"acceptAnswer",value:(u=D(regeneratorRuntime.mark(function G(P){var K,X,oe,Ce,Ve,je;return regeneratorRuntime.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return K=this.localStream_.getVideoBitrate(),X=this.localStream_.getAudioBitrate(),Re.prev=2,oe=this.removeVideoOrientation(P.sdp),Re.next=6,this.setBandwidth(K,An,oe);case 6:return oe=Re.sent,Re.next=9,this.setBandwidth(X,ln,oe);case 9:if(oe=Re.sent,!this.client_.getIsEnableSmallStream()){Re.next=15;break}return Ce=this.client_.smallStreamConfig,Re.next=14,this.setSmallStreamBandwidth(Ce.bitrate,oe);case 14:oe=Re.sent;case 15:return Ve={type:P.type,sdp:oe},Re.next=18,this.peerConnection_.setRemoteDescription(Ve);case 18:this.sei_&&(je=this.peerConnection_.getSenders().filter(function(Oe){return Oe.track.kind===An})[0])&&(this.sei_.isRunning?this.sei_.restart(je,!0):this.sei_.start(je,!0)),this.log_.debug("accepted answer: "+oe),jt.logSuccessEvent({userId:this.client_.getUserId(),eventType:_I,kind:"answer"}),Re.next=28;break;case 23:throw Re.prev=23,Re.t0=Re.catch(2),jt.logFailedEvent({userId:this.client_.getUserId(),eventType:_I,kind:"answer",error:Re.t0}),this.log_.error("failed to accept remote answer "+Re.t0),Re.t0;case 28:case"end":return Re.stop()}},G,this,[[2,23]])})),function(G){return u.apply(this,arguments)})},{key:"sendMutedFlag",value:function(G){var P={audio:G.audio,bigVideo:G.video,auxVideo:G.auxVideo};this.log_.info("send muted state: ".concat(JSON.stringify(P))),this.signalChannel_.send($A,P)}},{key:"getIsReconnecting",value:function(){return this.isReconnecting_}},{key:"reconnect",value:(c=D(regeneratorRuntime.mark(function G(){var P,K,X=this;return regeneratorRuntime.wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(this.reconnectionTimer_===-1){oe.next=3;break}return this.log_.warn("reconnect() uplink is reconnecting, ignore current reconnection"),oe.abrupt("return");case 3:if(!(this.reconnectionCount_>=30)){oe.next=12;break}return this.log_.warn("SDK has tried reconnect uplink for ".concat(30," times, but all failed, please check your network")),this.stopReconnection(),P=new et({code:Ye.UPLINK_RECONNECTION_FAILED,message:rt({key:MM})}),jt.logFailedEvent({userId:this.client_.getUserId(),eventType:gI,error:P}),this.addEventInternal(HR,"uplink-connection reconnect fail"),this.emitConnectionStateChangedEvent(Ur),this.emitter_.emit(or.ERROR,P),oe.abrupt("return");case 12:if(this.signalChannel_.getCurrentState()===Vh){oe.next=16;break}return this.log_.warn("reconnect() signal channel is not connected, suspend reconnection until signal is connected"),this.signalChannel_.once(Sv,this.reconnect,this),oe.abrupt("return");case 16:if(this.reconnectionCount_++,oe.prev=17,this.log_.warn("reconnect() try to reconnect uplink [".concat(this.reconnectionCount_,"/").concat(30,"]")),K=Fa(this.reconnectionCount_),this.reconnectionTimer_=setTimeout(function(){X.log_.warn("reconnect() uplink reconnect timeout(".concat(K/1e3,"s), try again")),X.clearReconnectionTimer(),X.reconnect()},K),!(this.isSDPExchanging_||this.peerConnection_&&this.peerConnection_.connectionState===Jm)){oe.next=23;break}return oe.abrupt("return");case 23:return oe.next=25,this.signalChannel_.sendWaitForResponse({command:wR,responseCommand:wr.UNPUBLISH_RESULT,enableLog:!1});case 25:return this.reset(),this.initialize(),oe.next=29,this.publish(this.localStream_);case 29:jt.logSuccessEvent({userId:this.client_.getUserId(),eventType:gI}),this.log_.warn("reconnect() uplink reconnect successfully"),this.addEventInternal(CE,"uplink-connection reconnect success"),this.stopReconnection(),this.localStream_.syncMuteState(),oe.next=38;break;case 36:oe.prev=36,oe.t0=oe.catch(17);case 38:case"end":return oe.stop()}},G,this,[[17,36]])})),function(){return c.apply(this,arguments)})},{key:"clearExchangeSDPTimeout",value:function(){this.exchangeSDPTimeout_!==-1&&(clearTimeout(this.exchangeSDPTimeout_),this.exchangeSDPTimeout_=-1)}},{key:"clearReconnectionTimer",value:function(){this.reconnectionTimer_!==-1&&(clearTimeout(this.reconnectionTimer_),this.reconnectionTimer_=-1)}},{key:"handleError",value:function(G){G.getCode()===Ye.ICE_TRANSPORT_ERROR&&(this.isFirstConnection_&&(this.isFirstConnection_=!1,jt.logFailedEvent({userId:this.client_.getUserId(),eventType:fI,error:G})),this.isReconnecting_||this.startReconnection())}},{key:"handleConnectionStateChange",value:function(G){G.state===_o&&this.isFirstConnection_&&(this.isFirstConnection_=!1,jt.logSuccessEvent({userId:this.client_.getUserId(),eventType:fI}),this.addEventInternal(BR,"uplink-connection is connected"))}},{key:"updateSSRC",value:function(G){var P=this;try{var K=0;Zs(G).media.forEach(function(X){if(X.type===ln){var oe=X.ssrcs[0];oe&&(P.ssrc_.audio=oe.id)}else{var Ce=X.ssrcs[0];switch(K+=1){case 1:Ce&&(P.ssrc_.video=Ce.id);break;case 2:Ce&&(P.ssrc_.small=Ce.id)}}})}catch{}}},{key:"getLocalStreamVideoTrackId",value:function(){if(this.peerConnection_){var G=this.peerConnection_.getSenders().filter(function(K){return K.track&&K.track.kind===An});if(G[0])return G[0].track.id}if(this.localStream_){var P=this.localStream_.getVideoTrack();if(P)return P.id}return""}},{key:"getSSRC",value:function(){return this.ssrc_}},{key:"checkPublishResultCode",value:function(G,P){if(G!==0)throw G===1028?(this.log_.error(ad.NOT_SUPPORTED_H264ENCODE),new et({code:Ye.NOT_SUPPORTED_H264,message:rt({key:HM})})):new et({code:Ye.UNKNOWN,message:rt({key:Ay,data:{signalResponse:wr.PUBLISH_RESULT,code:G,message:P}})})}},{key:"getLocalStream",value:function(){return this.localStream_}},{key:"sendSEI",value:function(G,P){this.sei_.push(G,P)}}]),F}(nw),Ex=function(r){re(T,r);var c,u,d,p,v,f,y,I=Xe(T);function T(b){var k;return x(this,T),(k=I.call(this,b)).remoteStreams_=new Map,k.autoSubscribe=b.autoSubscribe,k.trackState_={audio:b.trackState.audio,video:b.trackState.video,auxiliary:b.trackState.auxiliary,smallVideo:b.trackState.smallVideo},k.ssrc_={audio:0,video:0,auxiliary:0},k.subscribeState_={audio:b.autoSubscribe,video:b.autoSubscribe,auxiliary:b.autoSubscribe,smallVideo:!1},k.isSDPExchanging_=!1,k.installEvents(),k}return B(T,[{key:"isMainStreamSubscribed",get:function(){return(this.subscribeState_.audio||this.subscribeState_.video||this.subscribeState_.smallVideo)&&(this.trackState_.audio||this.trackState_.video||this.trackState_.smallVideo)}},{key:"isAuxStreamSubscribed",get:function(){return this.subscribeState_.auxiliary&&this.trackState_.auxiliary}},{key:"isSmallStreamSubscribed",get:function(){return this.subscribeState_.smallVideo&&this.trackState_.smallVideo}},{key:"isBigStreamSubscribed",get:function(){return this.subscribeState_.video&&this.trackState_.video}},{key:"isStreamUnpublished",value:function(b){return b.getType()===ti?!this.trackState_.audio&&!this.trackState_.video:!this.trackState_.auxiliary}},{key:"initialize",value:function(){Be(ie(T.prototype),"initialize",this).call(this),this.peerConnection_.ontrack=this.onTrack.bind(this)}},{key:"close",value:function(){var b=this;Be(ie(T.prototype),"close",this).call(this),this.trackState_.audio=!1,this.trackState_.video=!1,this.trackState_.auxiliary=!1,this.emitConnectionStateChangedEvent(Ur),this.remoteStreams_.forEach(function(k){var N=k;N.setConnection(null),N.uninstallEvents(),N.getIsStreamAddedEventEmitted()&&b.emitter_.emit(or.STREAM_REMOVED,{stream:N})}),this.remoteStreams_.clear(),this.uninstallEvents()}},{key:"installEvents",value:function(){var b=this;Me.on(ji,this.onRemoteStreamUpdate,this),this.emitter_.on(or.ERROR,function(k){k.getCode()===Ye.ICE_TRANSPORT_ERROR&&(b.isFirstConnection_&&(b.isFirstConnection_=!1,jt.logFailedEvent({userId:b.client_.getUserId(),eventType:mI,error:k})),b.isReconnecting_||b.startReconnection())}),this.emitter_.on(or.CONNECTION_STATE_CHANGED,function(k){k.state===_o&&b.isFirstConnection_&&(b.isFirstConnection_=!1,jt.logSuccessEvent({userId:b.client_.getUserId(),eventType:mI}),b.addEventInternal(jR,"downlink-connection is connected"))})}},{key:"uninstallEvents",value:function(){Me.removeListener(ji,this.onRemoteStreamUpdate,this)}},{key:"onRemoteStreamUpdate",value:function(b){if(this.hitTest(b.tinyId)&&b.client===this.client_){this.updateTrackState(b.action,b.kind);var k=b.kind===Xi?Hu:uo,N=this.remoteStreams_.get(k);if(!N)return;b.action===Ku?this.handleRemoteAddTrack(b.kind,N):this.handleRemoteRemoveTrack(b.kind,N)}}},{key:"handleRemoteAddTrack",value:function(b,k){this.log_.info("remote add ".concat(b," track")),b===ln?k.updateAudioPlayingState(this.subscribeState_.audio):k.updateVideoPlayingState(b===Xi?this.subscribeState_.auxiliary:this.subscribeState_.video||this.subscribeState_.smallVideo),k.getIsStreamAddedEventEmitted()?this.emitter_.emit(or.STREAM_UPDATED,{stream:k}):(this.emitter_.emit(or.STREAM_ADDED,{stream:k}),this.currentState_===_o&&k.emitConnectionStateChanged({prevState:Ur,state:_o}))}},{key:"handleRemoteRemoveTrack",value:function(b,k){k.getIsStreamAddedEventEmitted()&&(this.log_.info("remote remove ".concat(b," track")),b===Xi||!this.trackState_.audio&&!this.trackState_.video?(this.log_.info("remote stream ".concat(k.getType()," removed")),this.currentState_===_o&&k.emitConnectionStateChanged({prevState:_o,state:Ur}),this.emitter_.emit(or.STREAM_REMOVED,{stream:k})):(b===ln?k.updateAudioPlayingState(!1):k.updateVideoPlayingState(!1),this.emitter_.emit(or.STREAM_UPDATED,{stream:k})))}},{key:"updateTrackState",value:function(b,k){var N=b===Ku;switch(k){case ln:this.trackState_.audio=N;break;case An:this.trackState_.video=N;break;case Xi:this.trackState_.auxiliary=N;break;case ju:this.trackState_.smallVideo=N}this.log_.info("trackState updated: ".concat(JSON.stringify(this.trackState_)))}},{key:"onTrack",value:function(b){var k=b.streams[0],N=b.track;if(this.log_.info("ontrack() kind: ".concat(N.kind," id: ").concat(N.id," streamId: ").concat(k.id)),this.sdpSemantics_==="unified-plan"){var O=function(X){var oe=Qs.parse(X),Ce={audio:[],video:[]};return oe.media.forEach(function(Ve){if(Ve.ssrcs){var je=Ve.ssrcs[0].id>>16&255;if(Ve.type===ln)Ce.audio.push(uo);else if(Ve.type==An){var Re=je===hy?uo:Hu;Ce.video.push(Re)}}}),Ce}(this.peerConnection_.remoteDescription.sdp);if(N.kind===ln){if(O.audio.length===0||k.id!==uo)return void this.log_.debug("skip this invalid audio track")}else if(O.video.indexOf(k.id)===-1)return void this.log_.debug("skip this invalid video track: ".concat(N.id,"  msid: ").concat(k.id))}jt.logEvent({eventType:"ontrack",kind:N.kind});var F=!1,G=this.remoteStreams_.get(k.id),P=k.id===uo?kr:Ni;if(kt(G)&&((G=new iw({type:P,userId:this.userId_,client:this.client_})).setConnection(this),this.remoteStreams_.set(k.id,G),F=!0),G.setMediaStream(k),N.kind===ln?G.updateAudioPlayingState(this.subscribeState_.audio):P===kr?G.updateVideoPlayingState(this.subscribeState_.video||this.subscribeState_.smallVideo):G.updateVideoPlayingState(this.subscribeState_.auxiliary),(P!==Ni||this.trackState_.auxiliary)&&(P!==kr||this.trackState_.audio||this.trackState_.video)){var K=this.client_.getSubscriptionManager();K&&K.hasAutoRecoveryFlag(this.userId_,P)||(F?this.emitter_.emit(or.STREAM_ADDED,{stream:G}):this.emitter_.emit(or.STREAM_UPDATED,{stream:G}))}}},{key:"addRRTRLine",value:function(b){var k=b.split(`\r
`),N=new Map;k.forEach(function(X,oe){/^a=rtcp-fb:/.test(X)&&k[oe+1]&&!/^a=rtcp-fb:/.test(k[oe+1])&&N.set(oe+1,X.match(/^a=rtcp-fb:\d+/)[0]+" rrtr")});for(var O=de(N),F=0;F<O.length;F++){var G=Pe(O[F],2),P=G[0],K=G[1];k.splice(P+F,0,K)}return k.join(`\r
`)}},{key:"addSPSDescription",value:function(b){var k=Zs(b);return k.media.forEach(function(N){N.type===An&&N.fmtp.forEach(function(O){O.config+=";sps-pps-idr-in-keyframe=1"})}),Hh(k)}},{key:"removeSDESDescription",value:function(b){var k=["urn:ietf:params:rtp-hdrext:sdes:mid","urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id","urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id"],N=Zs(b);return N.media.forEach(function(O){O.ext=O.ext.filter(function(F){return!k.includes(F.uri)})}),Hh(N)}},{key:"isSubscriptionStateNotChanged",value:function(b,k){return b.getType()===kr?(k==null?void 0:k.audio)===this.subscribeState_.audio&&(k==null?void 0:k.video)===this.subscribeState_.video&&this.isSubscribeSmall(k):b.getType()===Ni?!kt(k.video)&&this.subscribeState_.auxiliary===k.video:void 0}},{key:"isSubscribeSmall",value:function(b){return kt(b.smallVideo)&&!this.subscribeState_.smallVideo}},{key:"subscribe",value:(y=D(regeneratorRuntime.mark(function b(k,N){var O,F,G,P,K,X;return regeneratorRuntime.wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(oe.prev=0,G=N.emitEvent,P=G===void 0||G,K=k.getType(),((O=this.peerConnection_)===null||O===void 0?void 0:O.connectionState)!==JT&&((F=this.peerConnection_)===null||F===void 0?void 0:F.connectionState)!==Jm){oe.next=6;break}return oe.next=6,this.waitForPeerConnectionConnected();case 6:if(!this.isSubscriptionStateNotChanged(k,N)){oe.next=13;break}if(this.peerConnection_){oe.next=11;break}return this.initialize(),oe.next=11,this.connect();case 11:return P&&kt(N.smallVideo)&&this.emitter_.emit(or.STREAM_SUBSCRIBED,{stream:k,result:!0}),oe.abrupt("return",k);case 13:if(K===ti?(kt(N.audio)||(this.subscribeState_.audio=N.audio),kt(N.video)||(this.subscribeState_.video=N.video),this.subscribeState_.smallVideo=(N==null?void 0:N.smallVideo)||!1,this.addEventInternal(this.subscribeState_.audio?LR:iS,this.subscribeState_.audio?"subscribe audio":"unsubscribe audio"),this.addEventInternal(this.subscribeState_.video?LR:iS,this.subscribeState_.video?"subscribe video":"unsubscribe video"),this.addEventInternal(this.subscribeState_.smallVideo?sk:pa,this.subscribeState_.smallVideo?"subscribe smallVideo":"unsubscribe smallVideo")):kt(N.video)||(this.subscribeState_.auxiliary=N.video),this.log_.info("subscribe ".concat(K," stream with options ").concat(JSON.stringify(N)," current state: ").concat(JSON.stringify(this.subscribeState_))),!this.peerConnection_&&!this.isSDPExchanging_){oe.next=23;break}return X=yy,this.isMainStreamSubscribed||this.isAuxStreamSubscribed||(X=_y),oe.next=20,this.sendSubscription(X);case 20:K===ti?(k.updateAudioPlayingState(this.subscribeState_.audio),k.updateVideoPlayingState(this.subscribeState_.video||this.subscribeState_.smallVideo)):k.updateVideoPlayingState(this.subscribeState_.auxiliary),oe.next=26;break;case 23:return this.initialize(),oe.next=26,this.connect();case 26:return P&&kt(N.smallVideo)&&this.emitter_.emit(or.STREAM_SUBSCRIBED,{stream:k,result:!0}),oe.abrupt("return",k);case 30:if(oe.prev=30,oe.t0=oe.catch(0),!this.isStreamUnpublished(k)){oe.next=34;break}throw new et({code:Ye.REMOTE_STREAM_NOT_EXIST,message:"remote user ".concat(this.userId_," unpublished stream")});case 34:throw oe.t0;case 35:case"end":return oe.stop()}},b,this,[[0,30]])})),function(b,k){return y.apply(this,arguments)})},{key:"unsubscribe",value:(f=D(regeneratorRuntime.mark(function b(k){var N,O,F;return regeneratorRuntime.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if((N=k.getType())!==ti){G.next=10;break}if(this.isMainStreamSubscribed){G.next=5;break}return this.log_.info("main stream already unsubscribed"),G.abrupt("return",k);case 5:this.subscribeState_.audio=!1,this.subscribeState_.video=!1,this.subscribeState_.smallVideo=!1,G.next=14;break;case 10:if(this.isAuxStreamSubscribed){G.next=13;break}return this.log_.info("auxiliary stream already unsubscribed"),G.abrupt("return",k);case 13:this.subscribeState_.auxiliary=!1;case 14:return O=_y,(N===kr&&this.isAuxStreamSubscribed||N===Ni&&this.isMainStreamSubscribed)&&(O=yy),this.log_.info("unsubscribe ".concat(N," stream with ").concat(JSON.stringify(this.subscribeState_))),G.next=19,this.sendSubscription(O);case 19:return k.updateVideoPlayingState(!1),k.updateAudioPlayingState(!1),O===_y&&((F=k.getMediaStream())&&F.getTracks().forEach(function(P){return F.removeTrack(P)}),this.closePeerConnection(),this.emitConnectionStateChangedEvent(Ur)),this.addEventInternal(iS,"unsubscribe audio"),this.addEventInternal(nk,"unsubscribe video"),G.abrupt("return",k);case 25:case"end":return G.stop()}},b,this)})),function(b){return f.apply(this,arguments)})},{key:"sendSubscription",value:function(b){var k=this,N={srcTinyId:this.tinyId_,srcUserId:this.userId_},O=tl,F=wr.UNSUBSCRIBE_RESULT;return b===yy&&(N={audio:this.subscribeState_.audio,bigVideo:this.subscribeState_.video,auxVideo:this.subscribeState_.auxiliary,smallVideo:this.subscribeState_.smallVideo,srcTinyId:this.tinyId_},O=WA,F=wr.SUBSCRIBE_CHANGE_RESULT),this.signalChannel_.sendWaitForResponse({command:O,data:N,responseCommand:F,timeout:1e4}).then(function(G){var P=G.data;if(P.code!==0){var K=new et({code:P.code,message:rt({key:SM,data:{type:b,message:P.message}})});throw k.log_.error(K),K}})}},{key:"connect",value:(v=D(regeneratorRuntime.mark(function b(){var k,N=this;return regeneratorRuntime.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.prev=0,O.next=3,this.exchangeSDP();case 3:return this.sei_&&(k=this.peerConnection_.getReceivers()[1])&&(this.sei_.isRunning?this.sei_.restart(k,!1):this.sei_.start(k,!1),this.sei_.onSEIMessage=function(F){N.emitter_.emit(or.SEI_MESSAGE,m(m({},F),{},{userId:N.userId_}))}),O.next=6,this.waitForPeerConnectionConnected();case 6:O.next=12;break;case 8:throw O.prev=8,O.t0=O.catch(0),this.closePeerConnection(!0),O.t0;case 12:case"end":return O.stop()}},b,this,[[0,8]])})),function(){return v.apply(this,arguments)})},{key:"exchangeSDP",value:(p=D(regeneratorRuntime.mark(function b(){var k,N,O,F,G,P;return regeneratorRuntime.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return K.prev=0,this.isSDPExchanging_=!0,K.next=4,this.createOffer();case 4:return this.log_.info("createOffer success, sending offer to remote server"),k=this.peerConnection_.localDescription,N=k.type,O=k.sdp,F={type:N,sdp:O,srcUserId:this.userId_,srcTinyId:this.tinyId_,audio:this.subscribeState_.audio,bigVideo:this.subscribeState_.video,auxVideo:this.subscribeState_.auxiliary,smallVideo:this.subscribeState_.smallVideo},Me.emit(gE,{client:this.client_,connection:this,userId:this.userId_,tinyId:this.tinyId_,role:rd,subscribeState:this.subscribeState_,trackState:this.trackState_}),K.next=10,this.signalChannel_.sendWaitForResponse({command:KA,commandDesc:"exchange sdp",data:F,responseCommand:wr.SUBSCRIBE_RESULT});case 10:if(G=K.sent,this.peerConnection_){K.next=15;break}throw P=new et({code:Ye.INVALID_OPERATION,message:rt({key:rv})}),this.log_.warn(P),P;case 15:return K.next=17,this.onSubscribeResult(G);case 17:this.isSDPExchanging_=!1,K.next=24;break;case 20:throw K.prev=20,K.t0=K.catch(0),this.isSDPExchanging_=!1,K.t0;case 24:case"end":return K.stop()}},b,this,[[0,20]])})),function(){return p.apply(this,arguments)})},{key:"createOffer",value:(d=D(regeneratorRuntime.mark(function b(){var k,N;return regeneratorRuntime.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return k={voiceActivityDetection:!1},"RTCPeerConnection"in window&&"addTransceiver"in window.RTCPeerConnection.prototype&&this.sdpSemantics_==="unified-plan"?(this.peerConnection_.addTransceiver(ln,{direction:"recvonly"}),this.peerConnection_.addTransceiver(An,{direction:"recvonly"}),this.peerConnection_.addTransceiver(An,{direction:"recvonly"})):(k.offerToReceiveAudio=!0,k.offerToReceiveVideo=!0),O.next=4,this.peerConnection_.createOffer(k);case 4:return N=O.sent,O.next=7,XR();case 7:return O.sent.isH264DecodeSupported||(this.log_.warn("remove h264 desc from sdp"),N.sdp=uk(N.sdp)),N.sdp=this.addRRTRLine(N.sdp),N.sdp=this.addSPSDescription(N.sdp),N.sdp=vn(N.sdp),this.sdpSemantics_==="unified-plan"&&(N.sdp=this.removeSDESDescription(N.sdp)),O.next=16,this.peerConnection_.setLocalDescription(N);case 16:case"end":return O.stop()}},b,this)})),function(){return d.apply(this,arguments)})},{key:"onSubscribeResult",value:(u=D(regeneratorRuntime.mark(function b(k){var N,O,F,G,P,K,X;return regeneratorRuntime.wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(N=k&&k.data||{},O=N.code,F=N.message,G=F===void 0?"":F,P=k&&k.data&&k.data.data||{},K=P.type,X=P.sdp,O!==77393){oe.next=5;break}throw this.log_.error(ad.NOT_SUPPORTED_H264DECODE),new et({code:Ye.NOT_SUPPORTED_H264,message:rt({key:KI})});case 5:if(oe.prev=5,O===0){oe.next=8;break}throw new et({code:O,message:rt({key:TM,data:{errMsg:G}})});case 8:return this.log_.debug("accept remote answer: "+X),oe.next=11,this.peerConnection_.setRemoteDescription({type:K,sdp:X});case 11:this.updateSSRC(X),oe.next=18;break;case 14:throw oe.prev=14,oe.t0=oe.catch(5),this.log_.error(oe.t0),oe.t0;case 18:case"end":return oe.stop()}},b,this,[[5,14]])})),function(b){return u.apply(this,arguments)})},{key:"updateSSRC",value:function(b){var k=this;try{Zs(b).media.forEach(function(N){if(N.type===ln){var O=N.ssrcs.find(function(P){return P.value.includes(uo)});O&&(k.ssrc_.audio=O.id)}else{var F=N.ssrcs.find(function(P){return P.value.includes(uo)}),G=N.ssrcs.find(function(P){return P.value.includes(Hu)});F&&(k.ssrc_.video=F.id),G&&(k.ssrc_.auxiliary=G.id)}})}catch{}}},{key:"setRemoteStream",value:function(b,k){this.remoteStreams_.set(b,k)}},{key:"getSubscribeState",value:function(){return this.subscribeState_}},{key:"getTrackState",value:function(){return this.trackState_}},{key:"getSSRC",value:function(){return this.ssrc_}},{key:"getMainStream",value:function(){return this.remoteStreams_.get(uo)}},{key:"getAuxStream",value:function(){return this.remoteStreams_.get(Hu)}},{key:"getMainStreamVideoTrackId",value:function(){var b=this.getMainStream();if(b){var k=b.getVideoTrack();if(k)return k.id}return""}},{key:"getAuxStreamVideoTrackId",value:function(){var b=this.getAuxStream();if(b){var k=b.getVideoTrack();if(k)return k.id}return""}},{key:"reconnect",value:(c=D(regeneratorRuntime.mark(function b(){var k,N,O=this;return regeneratorRuntime.wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(this.reconnectionTimer_===-1){F.next=3;break}return this.log_.warn("reconnect() downlink is reconnecting, ignore current reconnection"),F.abrupt("return");case 3:if(!(this.reconnectionCount_>=30)){F.next=12;break}return this.log_.warn("SDK has tried reconnect downlink [".concat(this.userId_,"] for ").concat(30," times, but all failed, please check your network")),this.stopReconnection(),k=new et({code:Ye.DOWNLINK_RECONNECTION_FAILED,message:rt({key:EM})}),jt.logFailedEvent({userId:this.client_.getUserId(),eventType:vI,error:k}),this.addEventInternal(ak,"downlink-connection reconnect fail"),this.emitConnectionStateChangedEvent(Ur),this.emitter_.emit(or.ERROR,k),F.abrupt("return");case 12:if(this.signalChannel_.getCurrentState()===Vh){F.next=16;break}return this.log_.warn("reconnect() signal channel is not connected, suspend reconnection until signal is connected"),this.signalChannel_.once(Sv,this.reconnect,this),F.abrupt("return");case 16:if(this.reconnectionCount_++,this.log_.warn("reconnect() try to reconnect downlink [".concat(this.reconnectionCount_,"/").concat(30,"]")),N=Fa(this.reconnectionCount_),this.reconnectionTimer_=setTimeout(function(){O.log_.warn("reconnect() downlink [".concat(O.userId_,"] reconnect timeout(").concat(N/1e3,"s), try again")),O.clearReconnectionTimer(),O.reconnect()},N),!(this.isSDPExchanging_||this.peerConnection_&&this.peerConnection_.connectionState===Jm)){F.next=22;break}return F.abrupt("return");case 22:return F.prev=22,this.closePeerConnection(),this.initialize(),F.next=27,this.connect();case 27:this.stopReconnection(),this.log_.warn("reconnect() downlink reconnect successfully"),jt.logSuccessEvent({userId:this.client_.getUserId(),eventType:vI}),this.addEventInternal(ok,"downlink-connection reconnect success"),this.recoverSubscription(),F.next=36;break;case 34:F.prev=34,F.t0=F.catch(22);case 36:case"end":return F.stop()}},b,this,[[22,34]])})),function(){return c.apply(this,arguments)})},{key:"recoverSubscription",value:function(){var b=this,k=this.client_.getSubscriptionManager();k&&de(this.remoteStreams_.values()).forEach(function(N){k.hasAutoRecoveryFlag(b.userId_,N.getType())&&k.recover(N)})}},{key:"getIsReconnecting",value:function(){return this.isReconnecting_}},{key:"getSubscribedMainStream",value:function(){var b=null;return this.isMainStreamSubscribed&&(b=this.remoteStreams_.get(uo)),b}},{key:"clearReconnectionTimer",value:function(){this.reconnectionTimer_!==-1&&(clearTimeout(this.reconnectionTimer_),this.reconnectionTimer_=-1)}},{key:"startReconnection",value:function(){var b=this.client_.getSubscriptionManager();if(b){var k,N=ke(this.remoteStreams_.values());try{for(N.s();!(k=N.n()).done;){var O=k.value,F=O.getType();(F===kr&&(this.trackState_.audio||this.trackState_.video)||F===Ni&&this.trackState_.auxiliary)&&b.setAutoRecoveryFlag(this.userId_,O.getType())}}catch(G){N.e(G)}finally{N.f()}}Be(ie(T.prototype),"startReconnection",this).call(this)}},{key:"getCurrentState",value:function(){return this.currentState_}},{key:"hasMainStream",value:function(){return this.trackState_.video||this.trackState_.audio||this.trackState_.smallVideo}},{key:"hasAuxStream",value:function(){return this.trackState_.auxiliary}}]),T}(nw),jC=function(){function r(){x(this,r),this.startTime=0,this.endTime=0,this.start()}return B(r,[{key:"start",value:function(){this.startTime===0&&(this.startTime=So())}},{key:"stop",value:function(){this.endTime===0&&(this.endTime=So())}},{key:"getDuration",value:function(){return this.endTime===0?So()-this.startTime:this.endTime-this.startTime}}]),r}(),Tx=function(){function r(p){x(this,r),this.client_=p.client,this.intervalId_=-1,this.statsCalculator_=p.stats,this.prevStats_=null,this.renderFreezeMap_=new Map,this.remoteStreamMap_=new Map,this.dataFreezeMap_=new Map,this.monitorFreezeData_=new Map}var c,u,d;return B(r,[{key:"installEvents",value:function(){Me.on(Uf,this.handlePlayVideoStart,this),Me.on(Gh,this.onVideoTrackMuted,this),Me.on(lE,this.onVideoTrackUnmuted,this),Me.on(mv,this.handleStreamStopped,this),Me.on(Qu,this.handleStreamStopped,this),Me.on(fv,this.handleVideoPlaying,this)}},{key:"uninstallEvents",value:function(){Me.off(Uf,this.handlePlayVideoStart,this),Me.off(Gh,this.onVideoTrackMuted,this),Me.off(lE,this.onVideoTrackUnmuted,this),Me.off(mv,this.handleStreamStopped,this),Me.off(Qu,this.handleStreamStopped,this),Me.off(fv,this.handleVideoPlaying,this)}},{key:"start",value:function(){var p=this;this.intervalId_===-1&&(this.installEvents(),this.intervalId_=ii.setInterval(D(regeneratorRuntime.mark(function v(){return regeneratorRuntime.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.prev=0,f.next=3,p.detectFPS();case 3:f.next=7;break;case 5:f.prev=5,f.t0=f.catch(0);case 7:case"end":return f.stop()}},v,null,[[0,5]])})),1e3))}},{key:"stop",value:function(){this.intervalId_!==-1&&(this.uninstallEvents(),ii.clearInterval(this.intervalId_),this.intervalId_=-1,this.renderFreezeMap_.clear(),this.dataFreezeMap_.clear(),this.remoteStreamMap_.clear())}},{key:"onVideoTrackMuted",value:function(p){var v=p.stream;if(v.getClient()===this.client_&&v.isRemote()){var f=v.userId_,y=v.type_,I="".concat(f,"_").concat(y),T=this.dataFreezeMap_.get(I),b=new jC;T?T.durationItemList.push(b):this.dataFreezeMap_.set(I,{userId:f,type:y,durationItemList:[b],isFreezing:function(){var k=this.durationItemList[this.durationItemList.length-1];return k&&k.endTime===0}})}}},{key:"onVideoTrackUnmuted",value:function(p){var v=p.stream;if(v.getClient()===this.client_&&v.isRemote()){var f=v.userId_,y=v.type_,I="".concat(f,"_").concat(y);this.stopDataFreeze({key:I,userId:f,type:y})}}},{key:"handleStreamStopped",value:function(p){var v=p.client,f=p.stream;if(v===this.client_){var y=f.getUserId(),I=f.getType(),T="".concat(y,"_").concat(I);this.stopDataFreeze({key:T,userId:y,type:I})}}},{key:"stopDataFreeze",value:function(p){var v=p.key,f=p.userId,y=p.type,I=this.dataFreezeMap_.get(v);if(I&&I.isFreezing()){var T=I.durationItemList[I.durationItemList.length-1];T.stop();var b=T.getDuration();b>500?(jt.logEvent({eventType:"videoFrozenCount",delta:b}),this.monitorFreezeData_.set(v,{userId:f,type:y,duration:b})):I.durationItemList.pop()}}},{key:"getTotalDuration",value:function(p){return p.reduce(function(v,f){var y=f.getDuration();return v+Math.min(y,5e3)},0)}},{key:"getStats",value:(d=D(regeneratorRuntime.mark(function p(){var v,f,y,I,T,b,k,N,O,F,G;return regeneratorRuntime.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:v=this.client_.getConnections(),f={},y=ke(v),P.prev=3,y.s();case 5:if((I=y.n()).done){P.next=20;break}if(T=Pe(I.value,2),b=T[0],(k=T[1]).getPeerConnection()){P.next=9;break}return P.abrupt("continue",18);case 9:return N=k.getSubscribeState(),O=k.getTrackState(),P.next=13,this.statsCalculator_.getReceiverStats(k);case 13:F=P.sent,(G={userId:F.userId,tinyId:b,hasVideo:O.video&&N.video,hasAuxiliary:O.auxiliary&&N.auxiliary,video:{framesDecoded:0},auxiliary:{framesDecoded:0}}).hasVideo&&(G.video.framesDecoded=F.video.framesDecoded),G.hasAuxiliary&&(G.auxiliary.framesDecoded=F.auxiliary.framesDecoded),f[F.userId]=G;case 18:P.next=5;break;case 20:P.next=25;break;case 22:P.prev=22,P.t0=P.catch(3),y.e(P.t0);case 25:return P.prev=25,y.f(),P.finish(25);case 28:return P.abrupt("return",f);case 29:case"end":return P.stop()}},p,this,[[3,22,25,28]])})),function(){return d.apply(this,arguments)})},{key:"detectFPS",value:(u=D(regeneratorRuntime.mark(function p(){var v,f,y,I,T,b;return regeneratorRuntime.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.next=2,this.getStats();case 2:if(v=k.sent,this.prevStats_){k.next=6;break}return this.prevStats_=v,k.abrupt("return");case 6:k.t0=regeneratorRuntime.keys(v);case 7:if((k.t1=k.t0()).done){k.next=17;break}if(f=k.t1.value,this.prevStats_[f]){k.next=11;break}return k.abrupt("continue",7);case 11:y=v[f].tinyId,I=this.client_.getMutedStates(),v[f].hasVideo&&this.prevStats_[f].hasVideo&&I.has(y)&&!I.get(y).videoMuted&&(T=v[f].video.framesDecoded-this.prevStats_[f].video.framesDecoded,this.handleRenderFreeze({userId:f,type:kr,fps:T})),v[f].hasAuxiliary&&this.prevStats_[f].hasAuxiliary&&(b=v[f].auxiliary.framesDecoded-this.prevStats_[f].auxiliary.framesDecoded,this.handleRenderFreeze({userId:f,type:Ni,fps:b})),k.next=7;break;case 17:this.prevStats_=v;case 18:case"end":return k.stop()}},p,this)})),function(){return u.apply(this,arguments)})},{key:"handleRenderFreeze",value:(c=D(regeneratorRuntime.mark(function p(v){var f,y,I,T,b,k,N,O;return regeneratorRuntime.wrap(function(F){for(;;)switch(F.prev=F.next){case 0:f=v.userId,y=v.fps,I=v.type,T="".concat(f,"_").concat(I),b=this.renderFreezeMap_.get(T),y<=2?(k=So(),b&&!b.isFreeze&&(b.freezeTimeline.push({startTime:k,endTime:void 0}),b.isFreeze=!0),b||this.renderFreezeMap_.set(T,{userId:f,type:I,isFreeze:!0,freezeTimeline:[{startTime:k,endTime:void 0}],renderFreezeTotal:0})):b&&b.isFreeze&&(b.isFreeze=!1,(N=b.freezeTimeline.pop()).endTime=So(),O=N.endTime-N.startTime,b.freezeTimeline.push(N),b.renderFreezeTotal+=Math.min(5e3,O));case 4:case"end":return F.stop()}},p,this)})),function(p){return c.apply(this,arguments)})},{key:"handlePlayVideoStart",value:function(p){var v=p.stream;if(v.getClient()===this.client_&&v.isRemote()&&v.hasVideo()){var f="".concat(v.getUserId(),"_").concat(v.getType());this.remoteStreamMap_.has(f)?this.remoteStreamMap_.get(f).remoteStream=v:this.remoteStreamMap_.set(f,{isPlayingFired:!1,remoteStream:v})}}},{key:"handleVideoPlaying",value:function(p){var v=p.stream;if(v.isRemote()&&v.getClient()===this.client_){var f="".concat(v.getUserId(),"_").concat(v.getType());this.remoteStreamMap_.has(f)&&(this.remoteStreamMap_.get(f).isPlayingFired=!0)}}},{key:"getDataFreezeDuration",value:function(p){var v={dataFreeze:0,count:0},f=this.dataFreezeMap_.get(p);if(f){if(f.isFreezing()){var y=f.durationItemList[f.durationItemList.length-1];y.stop(),y.getDuration()<500&&f.durationItemList.pop()}v.dataFreeze=this.getTotalDuration(f.durationItemList),v.count=f.durationItemList.length}return v}},{key:"getRenderFreezeDuration",value:function(p){var v=this.renderFreezeMap_.get(p),f=0,y=0;if(v)if(v.isFreeze){var I=So()-v.freezeTimeline[v.freezeTimeline.length-1].startTime;f=v.renderFreezeTotal+Math.min(I,5e3),y=v.freezeTimeline.length}else f=v.renderFreezeTotal;return{renderFreeze:f,count:y}}},{key:"getMonitorFreeze",value:function(){return this.monitorFreezeData_}},{key:"isBlackStream",value:function(p){return!!this.remoteStreamMap_.has(p)&&!this.remoteStreamMap_.get(p).isPlayingFired}},{key:"resetMonitor",value:function(){this.monitorFreezeData_.clear()}}]),r}(),ow=B(function r(c){x(this,r),this.userId=c.userId,this.tinyId=c.tinyId,this.role=c.role===rd?"anchor":"audience"}),qC=vt(function(r){(function(c){function u(P,K){var X=(65535&P)+(65535&K);return(P>>16)+(K>>16)+(X>>16)<<16|65535&X}function d(P,K,X,oe,Ce,Ve){return u((je=u(u(K,P),u(oe,Ve)))<<(Re=Ce)|je>>>32-Re,X);var je,Re}function p(P,K,X,oe,Ce,Ve,je){return d(K&X|~K&oe,P,K,Ce,Ve,je)}function v(P,K,X,oe,Ce,Ve,je){return d(K&oe|X&~oe,P,K,Ce,Ve,je)}function f(P,K,X,oe,Ce,Ve,je){return d(K^X^oe,P,K,Ce,Ve,je)}function y(P,K,X,oe,Ce,Ve,je){return d(X^(K|~oe),P,K,Ce,Ve,je)}function I(P,K){var X,oe,Ce,Ve,je;P[K>>5]|=128<<K%32,P[14+(K+64>>>9<<4)]=K;var Re=1732584193,Oe=-271733879,qe=-1732584194,$e=271733878;for(X=0;X<P.length;X+=16)oe=Re,Ce=Oe,Ve=qe,je=$e,Re=p(Re,Oe,qe,$e,P[X],7,-680876936),$e=p($e,Re,Oe,qe,P[X+1],12,-389564586),qe=p(qe,$e,Re,Oe,P[X+2],17,606105819),Oe=p(Oe,qe,$e,Re,P[X+3],22,-1044525330),Re=p(Re,Oe,qe,$e,P[X+4],7,-176418897),$e=p($e,Re,Oe,qe,P[X+5],12,1200080426),qe=p(qe,$e,Re,Oe,P[X+6],17,-1473231341),Oe=p(Oe,qe,$e,Re,P[X+7],22,-45705983),Re=p(Re,Oe,qe,$e,P[X+8],7,1770035416),$e=p($e,Re,Oe,qe,P[X+9],12,-1958414417),qe=p(qe,$e,Re,Oe,P[X+10],17,-42063),Oe=p(Oe,qe,$e,Re,P[X+11],22,-1990404162),Re=p(Re,Oe,qe,$e,P[X+12],7,1804603682),$e=p($e,Re,Oe,qe,P[X+13],12,-40341101),qe=p(qe,$e,Re,Oe,P[X+14],17,-1502002290),Re=v(Re,Oe=p(Oe,qe,$e,Re,P[X+15],22,1236535329),qe,$e,P[X+1],5,-165796510),$e=v($e,Re,Oe,qe,P[X+6],9,-1069501632),qe=v(qe,$e,Re,Oe,P[X+11],14,643717713),Oe=v(Oe,qe,$e,Re,P[X],20,-373897302),Re=v(Re,Oe,qe,$e,P[X+5],5,-701558691),$e=v($e,Re,Oe,qe,P[X+10],9,38016083),qe=v(qe,$e,Re,Oe,P[X+15],14,-660478335),Oe=v(Oe,qe,$e,Re,P[X+4],20,-405537848),Re=v(Re,Oe,qe,$e,P[X+9],5,568446438),$e=v($e,Re,Oe,qe,P[X+14],9,-1019803690),qe=v(qe,$e,Re,Oe,P[X+3],14,-187363961),Oe=v(Oe,qe,$e,Re,P[X+8],20,1163531501),Re=v(Re,Oe,qe,$e,P[X+13],5,-1444681467),$e=v($e,Re,Oe,qe,P[X+2],9,-51403784),qe=v(qe,$e,Re,Oe,P[X+7],14,1735328473),Re=f(Re,Oe=v(Oe,qe,$e,Re,P[X+12],20,-1926607734),qe,$e,P[X+5],4,-378558),$e=f($e,Re,Oe,qe,P[X+8],11,-2022574463),qe=f(qe,$e,Re,Oe,P[X+11],16,1839030562),Oe=f(Oe,qe,$e,Re,P[X+14],23,-35309556),Re=f(Re,Oe,qe,$e,P[X+1],4,-1530992060),$e=f($e,Re,Oe,qe,P[X+4],11,1272893353),qe=f(qe,$e,Re,Oe,P[X+7],16,-155497632),Oe=f(Oe,qe,$e,Re,P[X+10],23,-1094730640),Re=f(Re,Oe,qe,$e,P[X+13],4,681279174),$e=f($e,Re,Oe,qe,P[X],11,-358537222),qe=f(qe,$e,Re,Oe,P[X+3],16,-722521979),Oe=f(Oe,qe,$e,Re,P[X+6],23,76029189),Re=f(Re,Oe,qe,$e,P[X+9],4,-640364487),$e=f($e,Re,Oe,qe,P[X+12],11,-421815835),qe=f(qe,$e,Re,Oe,P[X+15],16,530742520),Re=y(Re,Oe=f(Oe,qe,$e,Re,P[X+2],23,-995338651),qe,$e,P[X],6,-198630844),$e=y($e,Re,Oe,qe,P[X+7],10,1126891415),qe=y(qe,$e,Re,Oe,P[X+14],15,-1416354905),Oe=y(Oe,qe,$e,Re,P[X+5],21,-57434055),Re=y(Re,Oe,qe,$e,P[X+12],6,1700485571),$e=y($e,Re,Oe,qe,P[X+3],10,-1894986606),qe=y(qe,$e,Re,Oe,P[X+10],15,-1051523),Oe=y(Oe,qe,$e,Re,P[X+1],21,-2054922799),Re=y(Re,Oe,qe,$e,P[X+8],6,1873313359),$e=y($e,Re,Oe,qe,P[X+15],10,-30611744),qe=y(qe,$e,Re,Oe,P[X+6],15,-1560198380),Oe=y(Oe,qe,$e,Re,P[X+13],21,1309151649),Re=y(Re,Oe,qe,$e,P[X+4],6,-145523070),$e=y($e,Re,Oe,qe,P[X+11],10,-1120210379),qe=y(qe,$e,Re,Oe,P[X+2],15,718787259),Oe=y(Oe,qe,$e,Re,P[X+9],21,-343485551),Re=u(Re,oe),Oe=u(Oe,Ce),qe=u(qe,Ve),$e=u($e,je);return[Re,Oe,qe,$e]}function T(P){var K,X="",oe=32*P.length;for(K=0;K<oe;K+=8)X+=String.fromCharCode(P[K>>5]>>>K%32&255);return X}function b(P){var K,X=[];for(X[(P.length>>2)-1]=void 0,K=0;K<X.length;K+=1)X[K]=0;var oe=8*P.length;for(K=0;K<oe;K+=8)X[K>>5]|=(255&P.charCodeAt(K/8))<<K%32;return X}function k(P){var K,X,oe="";for(X=0;X<P.length;X+=1)K=P.charCodeAt(X),oe+="0123456789abcdef".charAt(K>>>4&15)+"0123456789abcdef".charAt(15&K);return oe}function N(P){return unescape(encodeURIComponent(P))}function O(P){return function(K){return T(I(b(K),8*K.length))}(N(P))}function F(P,K){return function(X,oe){var Ce,Ve,je=b(X),Re=[],Oe=[];for(Re[15]=Oe[15]=void 0,je.length>16&&(je=I(je,8*X.length)),Ce=0;Ce<16;Ce+=1)Re[Ce]=909522486^je[Ce],Oe[Ce]=1549556828^je[Ce];return Ve=I(Re.concat(b(oe)),512+8*oe.length),T(I(Oe.concat(Ve),640))}(N(P),N(K))}function G(P,K,X){return K?X?F(K,P):k(F(K,P)):X?O(P):k(O(P))}r.exports?r.exports=G:c.md5=G})(Qe)}),Mx=function(){function r(v){x(this,r),this.client_=v.client,this.signalChannel_=v.signalChannel,this.log_=Bt.createLogger({id:"mix|"+this.client_.getUserId(),userId:v.client.getUserId(),sdkAppId:v.client.getSDKAppId()}),this.isMixing_=!1,this.config_=null,this.data_=null,this.remoteStreamMap_=new Map,this.installEvents()}var c,u,d,p;return B(r,[{key:"isPresetLayoutMode",get:function(){return this.config_&&this.config_.mode===Sy.PRESET_LAYOUT}},{key:"installEvents",value:function(){Me.on(Xu,this.onStreamSubscribed,this),Me.on(Qu,this.onStreamUnsubscribed,this),this.client_.on("stream-removed",this.onStreamRemoved,this)}},{key:"uninstallEvents",value:function(){Me.off(Xu,this.onStreamSubscribed,this),Me.off(Qu,this.onStreamUnsubscribed,this),this.client_.off("stream-removed",this.onStreamRemoved,this)}},{key:"reset",value:function(){this.uninstallEvents(),this.isMixing_=!1,this.config_=null}},{key:"onStreamSubscribed",value:function(v){var f=v.client,y=v.stream;f===this.client_&&(this.remoteStreamMap_.set(y.getId(),{remoteStream:y,isUsed:!1}),this.isMixing_&&this.hasAvailablePlaceHolder()&&this.startMixTranscode(this.config_))}},{key:"onStreamUnsubscribed",value:function(v){var f=v.client,y=v.stream;f===this.client_&&this.onStreamRemoved({stream:y})}},{key:"onStreamRemoved",value:function(v){var f=v.stream;if(this.remoteStreamMap_.has(f.getId())){var y=this.remoteStreamMap_.get(f.getId()).isUsed;this.remoteStreamMap_.delete(f.getId()),this.isMixing_&&this.isPresetLayoutMode&&y&&this.startMixTranscode(this.config_)}}},{key:"startMixTranscode",value:(p=D(regeneratorRuntime.mark(function v(f){var y,I,T;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(b.prev=0,this.resetIsUsedFlag(),this.config_=f,y=this.getInputParam(f,this.remoteStreamMap_),I=this.getOutputParam(f),T=this.getOutputSessionId({config:f,roomId:this.client_.getRoomId(),userId:this.client_.getUserId()}),!this.isMixing_||!this.data_||T===this.data_.outputSessionId){b.next=10;break}return this.log_.info("startMixTranscode() streamId changed, stop mixing before start"),b.next=10,this.doStopMixTranscode();case 10:return b.next=12,this.doStartMixTranscode({outputSessionId:T,inputParam:y,outputParam:I});case 12:b.next=18;break;case 14:throw b.prev=14,b.t0=b.catch(0),this.resetIsUsedFlag(),b.t0;case 18:case"end":return b.stop()}},v,this,[[0,14]])})),function(v){return p.apply(this,arguments)})},{key:"doStartMixTranscode",value:(d=D(regeneratorRuntime.mark(function v(f){var y,I,T,b,k,N,O,F;return regeneratorRuntime.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return y=f.outputSessionId,I=f.inputParam,T=f.outputParam,b={roomId:String(this.client_.getRoomId()),mcuRequestTime:Date.now(),outputSessionId:y,inputParam:I,outputParam:T},this.data_=b,this.log_.info("startMixTranscode: ".concat(JSON.stringify(b))),this.isMixing_=!0,G.prev=5,G.next=8,this.signalChannel_.sendWaitForResponse({command:DR,data:b,timeout:5e3,responseCommand:wr.START_MIX_TRANSCODE_RES,commandDesc:"startMixTranscode"});case 8:if(k=G.sent,N=k.data,O=N.code,F=N.message,O===0){G.next=15;break}throw O===-102083&&(F="Please enable relayed-push in ".concat("https://console.cloud.tencent.com/trtc"," and try later, refer to ").concat(My,"tutorial-26-advanced-publish-cdn-stream.html")),this.log_.error("startMixTranscode failed, errCode: ".concat(O," errMsg: ").concat(F)),this.isMixing_=!1,new et({code:Ye.START_MIX_TRANSCODE_FAILED,message:rt({key:by,data:{message:F},link:{className:"Client",fnName:"startMixTranscode"}})});case 15:G.next=21;break;case 17:throw G.prev=17,G.t0=G.catch(5),this.isMixing_=!1,G.t0;case 21:case"end":return G.stop()}},v,this,[[5,17]])})),function(v){return d.apply(this,arguments)})},{key:"reStartMixTranscode",value:function(){this.isMixing_&&this.startMixTranscode(this.config_)}},{key:"stopMixTranscode",value:(u=D(regeneratorRuntime.mark(function v(){return regeneratorRuntime.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.isMixing_){f.next=2;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:qI})});case 2:return f.next=4,this.doStopMixTranscode();case 4:this.resetIsUsedFlag();case 5:case"end":return f.stop()}},v,this)})),function(){return u.apply(this,arguments)})},{key:"doStopMixTranscode",value:(c=D(regeneratorRuntime.mark(function v(){var f,y,I,T,b;return regeneratorRuntime.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return f={mcuRequestTime:Date.now(),outputSessionId:this.data_.outputSessionId,streamType:this.data_.outputParam.streamType},this.log_.info("stopMixTranscode: ".concat(JSON.stringify(f))),k.next=4,this.signalChannel_.sendWaitForResponse({command:QA,data:f,timeout:5e3,responseCommand:wr.STOP_MIX_TRANSCODE_RES,commandDesc:"stopMixTranscode"});case 4:if(y=k.sent,I=y.data,T=I.code,b=I.message,T!==0){k.next=10;break}this.isMixing_=!1,k.next=12;break;case 10:throw this.log_.error("stopMixTranscode failed, errCode: ".concat(T," errMsg: ").concat(b)),new et({code:Ye.STOP_MIX_TRANSCODE_FAILED,message:rt({key:nv,data:{message:b},link:{className:"Client",fnName:"stopMixTranscode"}})});case 12:case"end":return k.stop()}},v,this)})),function(){return c.apply(this,arguments)})},{key:"getOutputSessionId",value:function(v){var f=v.config,y=v.userId,I=v.roomId;return yo(f.streamId)&&f.streamId.length>0?f.streamId:qC("".concat(I,"_").concat(y,"_main"))}},{key:"getInputParam",value:function(v,f){var y=this,I=v.mixUsers.map(function(T){return{userId:T.userId,roomId:String(T.roomId||y.client_.getRoomId()),width:T.width||0,height:T.height||0,locationX:T.locationX||0,locationY:T.locationY||0,zOrder:T.zOrder,streamType:kt(T.streamType)||T.streamType!==Ni?0:1,inputType:T.pureAudio?kI.IT_PURE_AUDIO:kI.IT_AUDIO_VIDEO,renderMode:T.renderMode||0}});return v.mode===Sy.PRESET_LAYOUT&&(I.forEach(function(T){if(T.userId===AI.REMOTE){var b=de(f.values()).find(function(k){return!k.isUsed});b&&(T.userId=b.remoteStream.getUserId(),T.streamType=b.remoteStream.getType()===Ni?1:0,b.isUsed=!0)}}),I=I.filter(function(T){return T.userId!==AI.REMOTE})),I}},{key:"getOutputParam",value:function(v){var f=v.streamId||"";return{streamId:f,streamType:f.length>0?1:0,width:kt(v.videoWidth)?640:v.videoWidth,height:kt(v.videoHeight)?480:v.videoHeight,videoBps:v.videoBitrate||0,fps:v.videoFramerate||15,gop:v.videoGOP||2,audioSampleRate:v.audioSampleRate||48e3,audioBps:v.audioBitrate||64,audioChannels:v.audioChannels||1,backgroundColor:v.backgroundColor||0,backgroundImg:v.backgroundImage||"",extraInfo:"",videoCodec:2,audioCodec:0}}},{key:"hasAvailablePlaceHolder",value:function(){return!!this.isPresetLayoutMode&&this.data_.inputParam.length!==this.config_.mixUsers.length}},{key:"resetIsUsedFlag",value:function(){this.remoteStreamMap_.forEach(function(v){return v.isUsed=!1})}}]),r}(),Rx=function(){function r(f){x(this,r),this.client_=f.client,this.signalChannel_=f.signalChannel,this.isPublishingTencentCDN_=!1,this.publishTencentStreamRetryCount_=0,this.publishTencentStreamId_=void 0,this.publishGivenCDNData_=null,this.isPublishingGivenCDN_=!1}var c,u,d,p,v;return B(r,[{key:"setSignalChannel",value:function(f){this.signalChannel_=f.signalChannel}},{key:"getIsPublishingTencentCDN",value:function(){return this.isPublishingTencentCDN_}},{key:"getIsPublishingGivenCDN",value:function(){return this.isPublishingGivenCDN_}},{key:"generatePublishCDNStreamId",value:function(f){if(!f){var y="".concat(this.client_.getRoomId(),"_").concat(this.client_.getUserId(),"_main");return/^[A-Za-z\d_-]*$/.test(y)||(y=qC(y)),"".concat(this.client_.getSDKAppId(),"_").concat(y)}return f}},{key:"startPublishTencentCDN",value:(v=D(regeneratorRuntime.mark(function f(y){var I,T;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(this.isPublishingTencentCDN_=!0,this.publishTencentStreamId_=y.streamId,this.client_.isJoined_){b.next=4;break}return b.abrupt("return");case 4:return I=this.generatePublishCDNStreamId(y.streamId),T={requestTime:Date.now(),sessionId:qC("".concat(this.client_.getRoomId(),"_").concat(this.client_.getUserId(),"_main")),streamId:I,streamType:0},this.publishTencentStreamRetryCount_=0,b.next=9,this.doStartPublishTencentCDN(T);case 9:case"end":return b.stop()}},f,this)})),function(f){return v.apply(this,arguments)})},{key:"doStartPublishTencentCDN",value:(p=D(regeneratorRuntime.mark(function f(y){var I,T,b,k;return regeneratorRuntime.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.prev=0,Bt.info("startPublishTencentCDN: "+JSON.stringify(y)),N.next=4,this.signalChannel_.sendWaitForResponseWithRetry({command:zA,data:y,timeout:2e3,responseCommand:wr.START_PUBLISH_TENCENT_CDN_RES,commandDesc:"startPublishCDNStream",retries:2});case 4:if(I=N.sent,T=I.data,b=T.code,k=T.message,b===0){N.next=12;break}throw this.publishTencentStreamId_=void 0,this.isPublishingTencentCDN_=!1,b===-102083&&(k="Please enable relayed-push in ".concat("https://console.cloud.tencent.com/trtc"," and try later, refer to ").concat(My,"tutorial-26-advanced-publish-cdn-stream.html")),Bt.error("startPublishTencentCDN failed, errCode: ".concat(b,", errMsg: ").concat(k)),new et({code:Ye.START_PUBLISH_CDN_FAILED,message:rt({key:kM,data:{message:k},link:{className:"Client",fnName:"startPublishCDNStream"}})});case 12:N.next=19;break;case 14:throw N.prev=14,N.t0=N.catch(0),this.publishTencentStreamId_=void 0,this.isPublishingTencentCDN_=!1,N.t0;case 19:case"end":return N.stop()}},f,this,[[0,14]])})),function(f){return p.apply(this,arguments)})},{key:"stopPublishTencentCDN",value:(d=D(regeneratorRuntime.mark(function f(){var y,I,T,b,k;return regeneratorRuntime.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return y={requestTime:Date.now(),sessionId:qC("".concat(this.client_.getRoomId(),"_").concat(this.client_.getUserId(),"_main"))},Bt.info("stopPublishTencentCDN: "+JSON.stringify(y)),N.next=4,this.signalChannel_.sendWaitForResponse({command:YA,data:y,timeout:5e3,responseCommand:wr.STOP_PUBLISH_TENCENT_CDN_RES,commandDesc:"stopPublishCDNStream"});case 4:if(I=N.sent,T=I.data,b=T.code,k=T.message,b!==0){N.next=11;break}this.publishTencentStreamId_=void 0,this.isPublishingTencentCDN_=!1,N.next=19;break;case 11:if(b!==-102069){N.next=17;break}Bt.warn("stopPublishTencentCDN failed, can not stopPublishTencentCDN in auto relayed-push mode"),this.publishTencentStreamId_=void 0,this.isPublishingTencentCDN_=!1,N.next=19;break;case 17:throw Bt.error("stopPublishTencentCDN failed, errCode: ".concat(b," errMsg: ").concat(k)),new et({code:Ye.STOP_PUBLISH_CDN_FAILED,message:rt({key:Tf,data:{message:k},link:{className:"Client",fnName:"stopPublishCDNStream"}})});case 19:case"end":return N.stop()}},f,this)})),function(){return d.apply(this,arguments)})},{key:"startPublishGivenCDN",value:(u=D(regeneratorRuntime.mark(function f(y){var I,T,b,k,N;return regeneratorRuntime.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(I={pushRequestTime:Date.now(),pushAppId:y.appId,pushBizId:y.bizId,pushCdnUrl:y.url,pushStreamType:ti,pushStreamId:this.publishTencentStreamId_},Bt.info("startPublishGivenCDN: "+JSON.stringify(I)),this.publishGivenCDNData_=I,this.isPublishingGivenCDN_=!0,this.client_.isJoined_){O.next=6;break}return O.abrupt("return");case 6:return O.prev=6,O.next=9,this.signalChannel_.sendWaitForResponse({command:JA,data:I,timeout:5e3,responseCommand:wr.START_PUBLISH_GIVEN_CDN_RES,commandDesc:"startPublishCDNStream"});case 9:if(T=O.sent,b=T.data,k=b.code,N=b.message,k===0){O.next=16;break}throw Bt.error("startPublishGivenCDN failed, errCode: ".concat(k,", errMsg: ").concat(N)),this.publishGivenCDNData_=null,this.isPublishingGivenCDN_=!1,new et({code:Ye.START_PUBLISH_CDN_FAILED,message:rt({key:kM,data:{message:N},link:{className:"Client",fnName:"startPublishCDNStream"}})});case 16:O.next=23;break;case 18:throw O.prev=18,O.t0=O.catch(6),this.publishGivenCDNData_=null,this.isPublishingGivenCDN_=!1,O.t0;case 23:case"end":return O.stop()}},f,this,[[6,18]])})),function(f){return u.apply(this,arguments)})},{key:"stopPublishGivenCDN",value:(c=D(regeneratorRuntime.mark(function f(){var y,I,T,b,k,N,O,F,G,P;return regeneratorRuntime.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return y=this.publishGivenCDNData_,I=y.pushAppId,T=y.pushBizId,b=y.pushCdnUrl,k=y.pushStreamType,N={pushRequestTime:Date.now(),pushAppId:I,pushBizId:T,pushCdnUrl:b,pushStreamType:k},Bt.info("stopPublishGivenCDN: "+JSON.stringify(N)),K.next=5,this.signalChannel_.sendWaitForResponse({command:XA,data:N,timeout:5e3,responseCommand:wr.STOP_PUBLISH_GIVEN_CDN_RES,commandDesc:"stopPublishCDNStream"});case 5:if(O=K.sent,F=O.data,G=F.code,P=F.message,G!==0){K.next=12;break}this.publishGivenCDNData_=null,this.isPublishingGivenCDN_=!1,K.next=14;break;case 12:throw Bt.error("stopPublishGivenCDN failed, errCode: ".concat(G," errMsg: ").concat(P)),new et({code:Ye.STOP_PUBLISH_CDN_FAILED,message:rt({key:Tf,data:{message:P},link:{className:"Client",fnName:"stopPublishCDNStream"}})});case 14:case"end":return K.stop()}},f,this)})),function(){return c.apply(this,arguments)})},{key:"handleCDNConfigForJoinData",value:function(f){var y,I=f;if(this.isPublishingTencentCDN_){var T={};yo(I)&&(T=JSON.parse(I)),T.Str_uc_params||(T.Str_uc_params={}),T.Str_uc_params.userdefine_streamid_main=this.generatePublishCDNStreamId(this.publishTencentStreamId_),I=JSON.stringify(T)}if(this.isPublishingGivenCDN_){var b=this.publishGivenCDNData_,k=b.pushAppId,N=b.pushBizId,O=b.pushCdnUrl,F=b.pushStreamType,G=b.pushStreamId;y={pushRequestTime:Date.now(),pushAppId:k,pushBizId:N,pushCdnUrl:O,pushStreamType:F,pushStreamId:G}}return{bussinessInfo:I,pushUserCdnInfo:y}}},{key:"reset",value:function(){this.isPublishingTencentCDN_=!1,this.publishTencentStreamRetryCount_=0,this.publishTencentStreamId_=void 0,this.publishGivenCDNData_=null,this.isPublishingGivenCDN_=!1}}]),r}(),Cx=function(){function r(c){x(this,r),this.client_=c.client,this.durationMap_=new Map,this.installEvents()}return B(r,[{key:"installEvents",value:function(){Me.on(Xu,this.handleSubscribed,this),Me.on(ji,this.handleStreamTrackUpdated,this),Me.on(Qu,this.handleStreamStopped,this),Me.on(mv,this.handleStreamStopped,this)}},{key:"uninstallEvents",value:function(){Me.off(Xu,this.handleSubscribed,this),Me.off(ji,this.handleStreamTrackUpdated,this),Me.off(Qu,this.handleStreamStopped,this),Me.off(mv,this.handleStreamStopped,this)}},{key:"handleSubscribed",value:function(c){var u=c.client,d=c.stream;if(u===this.client_){var p=d.getUserId(),v=d.getType(),f="".concat(p,"_").concat(v);if(d.hasAudio())if(d.isMainAudioSubscribed){var y=new jC,I=this.durationMap_.get(f);I?this.isRecording(I.audio)||I.audio.push(y):this.durationMap_.set(f,{userId:p,type:v,audio:[y],video:[]})}else this.stopDurationItem(f,ln);if(d.hasVideo())if(v===kr&&d.isMainVideoSubscribed||v===Ni&&d.isAuxVideoSubscribed){var T=new jC,b=this.durationMap_.get(f);b?this.isRecording(b.video)||b.video.push(T):this.durationMap_.set(f,{userId:p,type:v,audio:[],video:[T]})}else this.stopDurationItem(f,An)}}},{key:"handleStreamStopped",value:function(c){var u=c.client,d=c.stream;if(this.clientHitTest(u)){var p=d.getUserId(),v=d.getType(),f="".concat(p,"_").concat(v);this.stopDurationItem(f,ln),this.stopDurationItem(f,An)}}},{key:"handleStreamTrackUpdated",value:function(c){var u=c.client,d=c.userId,p=c.tinyId,v=c.kind,f=c.action;if(this.clientHitTest(u)&&this.client_.getConnections().has(p)){var y=v===Xi?v:kr,I="".concat(d,"_").concat(y);if(f===Ku){var T=this.client_.getConnections().get(p).getSubscribeState();if(v===ln&&!T.audio||v===An&&!T.video||v===Xi&&!T.auxiliary)return;var b=new jC,k=this.durationMap_.get(I);k?(v!==ln||this.isRecording(k.audio)||k.audio.push(b),v===ln||this.isRecording(k.video)||k.video.push(b)):this.durationMap_.set(I,{userId:d,type:y,audio:v===ln?[b]:[],video:v===ln?[]:[b]})}else this.stopDurationItem(I,v===ln?ln:An)}}},{key:"isRecording",value:function(c){return c.findIndex(function(u){return u.endTime===0})>=0}},{key:"stopDurationItem",value:function(c,u){if(this.durationMap_.has(c)){var d=this.durationMap_.get(c)[u].find(function(p){return p.endTime===0});d&&d.stop()}}},{key:"clientHitTest",value:function(c){return this.client_===c}},{key:"getDuration",value:function(c,u){return this.durationMap_.has(c)?this.durationMap_.get(c)[u].reduce(function(d,p){return d+p.getDuration()},0):0}},{key:"getDurationMap",value:function(){return this.durationMap_}},{key:"reset",value:function(){this.durationMap_.clear()}},{key:"destroy",value:function(){this.client_=null,this.uninstallEvents()}}]),r}(),bx=g_.f,Ax=xe(function(){return!Object.getOwnPropertyNames(1)});cn({target:"Object",stat:!0,forced:Ax},{getOwnPropertyNames:bx});var kx={msg_user_info:0,uint32_video_avg_fps:0,uint32_video_width:0,uint32_video_height:0,uint32_video_avg_bitrate:0,uint32_video_block_time:0,uint32_video_play_time:0,uint32_audio_block_time:0,uint32_audio_play_time:0,uint32_audio_play_db:0,uint32_avg_down_loss:0,uint32_stream_type:0,uint32_video_render_first:0,uint32_video_block_count:0,uint32_audio_block_count:0,uint32_audio_bitrate:0,uint32_video_black_screen_subjective:0,uint32_audio_recv_bitrate:0,uint32_video_external_block_time:0},aw=B(function r(c){x(this,r),this.str_identifier=String(c.userId),this.uint64_tinyid=Number(c.tinyId),this.uint32_role=c.role}),Dx=function(){function r(p){var v=this;x(this,r),this.frameWorkType_=p.frameWorkType||30,this.client_=p.client,this.keyPrefix_="key_point",this.storageKey_="".concat(this.keyPrefix_,"_").concat(this.client_.getUserId()),this.log_=Bt.createLogger({id:"kpm|"+this.client_.getUserId(),userId:this.client_.getUserId(),sdkAppId:this.client_.getSDKAppId()}),this.upload=Gf({retryFunction:this.upload,settings:{timeout:500,retries:3},onError:function(f,y){return y()}}),Object.getOwnPropertyNames(this.__proto__).forEach(function(f){f.startsWith("handle")&&da(v[f])&&(v[f]=function(y){var I=y.fn,T=y.context;return D(regeneratorRuntime.mark(function b(){var k,N,O,F=arguments;return regeneratorRuntime.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:for(G.prev=0,k=F.length,N=new Array(k),O=0;O<k;O++)N[O]=F[O];return G.next=4,I.apply(T||this,N);case 4:return G.abrupt("return",G.sent);case 7:G.prev=7,G.t0=G.catch(0),Bt.error("".concat(I.name,"() error observed ")+G.t0);case 10:case"end":return G.stop()}},b,this,[[0,7]])}))}({fn:v[f],context:v}))}),this.initData(),this.installEvents(),this.intervalId_=ii.setInterval(this.setStorage.bind(this),2e4)}var c,u,d;return B(r,[{key:"initData",value:function(){this.firstPublishedUserList_=[],this.networkQuality_={totalUplinkRTT:0,totalUplinkLoss:0,count:0,totalDownlinkRTTAndLossMap:new Map},this.basicInfo={string_sdk_version:"4.14.0",uint32_os_type:15,string_device_name:"",string_http_user_agent:navigator.userAgent,string_os_version:"",uint32_avg_rtt:0,uint32_avg_up_loss:0,uint32_scene:this.client_.getMode()==="live"?1:0,uint32_joining_duration:0,uint32_networkType:Iy[zI()],uint32_framework:this.frameWorkType_},this.pathJoinRoom_={uint64_start_time:0,uint64_init_audio_start_time:0,uint64_init_audio_end_time:0,uint64_init_camera_start_time:0,uint64_init_camera_end_time:0,uint64_send_request_acc_ip_cmd_start_time:0,uint64_send_request_acc_ip_cmd_end_time:0,uint64_send_request_enter_room_cmd_start_time:0,uint64_send_request_enter_room_cmd_end_time:0,uint64_send_first_video_frame_time:0,uint64_recv_userlist_time:0,uint64_end_time:0,int32_init_audio_ret:0,int32_init_camera_ret:0,int32_send_request_acc_ip_cmd_ret:0,int32_send_request_enter_room_cmd_ret:0,int32_end_ret:0},this.pathLeaveRoom_={uint64_start_time:0,uint64_send_request_exit_room_cmd_start_time:0,uint64_send_request_exit_room_cmd_end_time:0,uint64_end_time:0,int32_send_request_exit_room_cmd_ret:0,int32_end_ret:0},this.pathMainVideoMap_=new Map,this.pathMainAudioMap_=new Map,this.pathAuxiliaryMap_=new Map,this.localStreamStats_={totalVideoBitrate:0,totalVideoFPS:0,totalVideoHeight:0,totalVideoWidth:0,totalAudioLevel:0,videoCount:0,audioLevelCount:0,publishStartTime:0,statsToReport:{uint32_audio_capture_db:0,uint32_video_big_capture_fps:0,uint32_video_big_bitrate:0,uint32_video_big_resolution:0}},this.remoteStreamStatsMap_=new Map}},{key:"installEvents",value:function(){Me.on(zc,this.handleJoinStart,this),Me.on(Jy,this.handleWSStart,this),Me.on(Xy,this.handleWSEnd,this),Me.on(iE,this.handleJoinSendCMD,this),Me.on(En,this.handleJoinReceivedCMDResponce,this),Me.on(Le,this.handleJoinSuccess,this),Me.on(Of,this.handleJoinFailed,this),Me.on(Lf,this.handleReceivedPublishUserList,this),Me.on(fE,this.handleConnectionStateChanged,this),Me.on(zy,this.handleLeaveStart,this),Me.on(pv,this.handleLeaveSuccess,this),Me.on(Nf,this.handleLeaveSendCMD,this),Me.on(gE,this.handleSendSubscribeCMD,this),Me.on(fv,this.handleVideoPlaying,this),Me.on(gs,this.handleAudioPlaying,this),Me.on(mE,this.handleNetworkQuality,this),Me.on(Yy,this.handleHeartbeatStats,this),Me.on(Pf,this.handleRemoteStreamAdded,this),Me.on(gv,this.handleRemoteStreamSubscribeStart,this),Me.on(Xu,this.handleRemoteStreamSubscribed,this),Me.on(Zy,this.handleVideoLoadedData,this),Me.on(Zu,this.handlePlayStream,this),Me.on(Yc,this.handlePublishStart,this),Me.on(cE,this.handleLocalStreamInitStart,this),Me.on(xf,this.handleLocalStreamInitEnd,this),Me.on(uE,this.handleLocalStreamInitFailed,this)}},{key:"uninstallEvents",value:function(){Me.off(zc,this.handleJoinStart,this),Me.off(Jy,this.handleWSStart,this),Me.off(Xy,this.handleWSEnd,this),Me.off(iE,this.handleJoinSendCMD,this),Me.off(En,this.handleJoinReceivedCMDResponce,this),Me.off(Lf,this.handleReceivedPublishUserList,this),Me.off(fE,this.handleConnectionStateChanged,this),Me.off(zy,this.handleLeaveStart,this),Me.off(pv,this.handleLeaveSuccess,this),Me.off(Le,this.handleJoinSuccess,this),Me.off(Of,this.handleJoinFailed,this),Me.off(Nf,this.handleLeaveSendCMD,this),Me.off(gE,this.handleSendSubscribeCMD,this),Me.off(fv,this.handleVideoPlaying,this),Me.off(gs,this.handleAudioPlaying,this),Me.off(mE,this.handleNetworkQuality,this),Me.off(Yy,this.handleHeartbeatStats,this),Me.off(Pf,this.handleRemoteStreamAdded,this),Me.off(gv,this.handleRemoteStreamSubscribeStart,this),Me.off(Xu,this.handleRemoteStreamSubscribed,this),Me.off(Zy,this.handleVideoLoadedData,this),Me.off(Zu,this.handlePlayStream,this),Me.off(Yc,this.handlePublishStart,this),Me.off(cE,this.handleLocalStreamInitStart,this),Me.off(xf,this.handleLocalStreamInitEnd,this),Me.off(uE,this.handleLocalStreamInitFailed,this)}},{key:"destroy",value:function(){this.uninstallEvents(),ii.clearInterval(this.intervalId_),this.client_=null}},{key:"handleJoinStart",value:function(p){this.hitTest(p.client)&&this.pathJoinRoom_.uint64_start_time===0&&(this.pathJoinRoom_.uint64_start_time=Date.now(),this.checkStorage())}},{key:"handleWSStart",value:function(p){var v=p.client;this.hitTest(v)&&this.pathJoinRoom_.uint64_send_request_acc_ip_cmd_start_time===0&&(this.pathJoinRoom_.uint64_send_request_acc_ip_cmd_start_time=Date.now())}},{key:"handleWSEnd",value:function(p){var v=p.client,f=p.error;this.hitTest(v)&&this.pathJoinRoom_.uint64_send_request_acc_ip_cmd_end_time===0&&(this.pathJoinRoom_.uint64_send_request_acc_ip_cmd_end_time=Date.now(),f&&(this.pathJoinRoom_.int32_send_request_acc_ip_cmd_ret=f instanceof et?Number(f.getExtraCode()||f.getCode()):Ye.UNKNOWN,this.pathJoinRoom_.int32_end_ret=2))}},{key:"handleJoinSendCMD",value:function(p){this.hitTest(p.client)&&this.pathJoinRoom_.uint64_send_request_enter_room_cmd_start_time===0&&(this.pathJoinRoom_.uint64_send_request_enter_room_cmd_start_time=Date.now())}},{key:"handleJoinReceivedCMDResponce",value:function(p){this.hitTest(p.client)&&this.pathJoinRoom_.uint64_send_request_enter_room_cmd_end_time===0&&(this.pathJoinRoom_.uint64_send_request_enter_room_cmd_end_time=Date.now(),this.pathJoinRoom_.int32_send_request_enter_room_cmd_ret=p.code,p.code!==0&&(this.pathJoinRoom_.int32_end_ret=3))}},{key:"handleJoinSuccess",value:function(p){this.hitTest(p.client)&&this.pathJoinRoom_.uint64_end_time===0&&(this.pathJoinRoom_.uint64_end_time=Date.now(),this.pathJoinRoom_.int32_end_ret=0)}},{key:"handleJoinFailed",value:function(p){var v=p.client;this.hitTest(v)&&(this.pathJoinRoom_.uint64_end_time=Date.now(),this.pathJoinRoom_.int32_end_ret===0&&(this.pathJoinRoom_.int32_end_ret=3),this.prepareReport(),this.report())}},{key:"handleReceivedPublishUserList",value:function(p){this.hitTest(p.client)&&this.pathJoinRoom_.uint64_recv_userlist_time===0&&(this.pathJoinRoom_.uint64_recv_userlist_time=Date.now(),this.firstPublishedUserList_=p.data.data&&p.data.data.userList||[])}},{key:"handleConnectionStateChanged",value:function(p){var v=p.client,f=p.state,y=p.connection;if(this.hitTest(v)&&f===_o){this.client_.getUplinkConnection()===y&&this.pathJoinRoom_.uint64_send_first_video_frame_time===0&&this.localStreamStats_.publishStartTime>this.pathJoinRoom_.uint64_end_time&&this.localStreamStats_.publishStartTime-this.pathJoinRoom_.uint64_end_time<=100&&(this.pathJoinRoom_.uint64_send_first_video_frame_time=Date.now());var I=this.pathMainVideoMap_.get("".concat(y.getUserId(),"_").concat(kr));I&&I.statsToReport.uint64_pc_connected_time===0&&(I.statsToReport.uint64_pc_connected_time=Date.now())}}},{key:"handleLeaveStart",value:function(p){this.hitTest(p.client)&&(this.pathLeaveRoom_.uint64_start_time=Date.now())}},{key:"handleLeaveSuccess",value:function(p){this.hitTest(p.client)&&this.pathLeaveRoom_.uint64_end_time===0&&(this.pathLeaveRoom_.uint64_end_time=Date.now(),this.pathJoinRoom_.uint64_end_time!==0?this.basicInfo.uint32_joining_duration=this.pathLeaveRoom_.uint64_end_time-this.pathJoinRoom_.uint64_end_time:this.log_.warn("pathJoinRoom endTime is 0"),this.report())}},{key:"handleLeaveSendCMD",value:function(p){this.hitTest(p.client)&&(this.pathLeaveRoom_.uint64_send_request_exit_room_cmd_start_time=Date.now(),this.pathLeaveRoom_.uint64_send_request_exit_room_cmd_end_time=Date.now())}},{key:"handleRemoteStreamAdded",value:function(p){var v=p.client,f=p.stream;if(this.hitTest(v)){var y=f.getUserId(),I=f.getType(),T="".concat(y,"_").concat(I),b=this.remoteStreamStatsMap_.get(T);if(b)b.stream=f;else{var k={userId:y,totalVideoFPS:0,totalVideoBitrate:0,totalAudioLevel:0,totalAudioBitrate:0,totalLoss:0,audioCount:0,audioLevelCount:0,videoCount:0,networkQualityCount:0,streamAddedTime:Date.now(),subscribeStartTime:0,subscribedTime:0,playStreamTime:0,statsToReport:m({},kx),stream:f};k.statsToReport.msg_user_info=new aw({userId:y,tinyId:f.getTinyId(),role:rd}),k.statsToReport.uint32_stream_type=I===kr?2:7,this.remoteStreamStatsMap_.set(T,k)}}}},{key:"handleRemoteStreamSubscribeStart",value:function(p){var v=p.client,f=p.stream;if(this.hitTest(v)){var y=f.getUserId(),I=f.getType(),T="".concat(y,"_").concat(I),b=this.remoteStreamStatsMap_.get(T);b&&b.subscribeStartTime===0&&(b.subscribeStartTime=Date.now())}}},{key:"handleSendSubscribeCMD",value:function(p){if(this.hitTest(p.client)){var v=new aw(p),f=Date.now(),y="".concat(p.userId,"_").concat(kr);p.trackState.video&&p.subscribeState.video&&!this.pathMainVideoMap_.has(y)&&this.pathMainVideoMap_.set(y,{statsToReport:{msg_user_info:v,uint64_start_enter_time:this.pathJoinRoom_.uint64_start_time,uint64_render_first_frame_time:0,uint64_combine_first_frame_time:0,uint64_pc_connected_time:0},userId:p.userId,sendSubscribeCMDTime:f}),p.trackState.audio&&p.subscribeState.audio&&!this.pathMainAudioMap_.has(y)&&this.pathMainAudioMap_.set(y,{statsToReport:{msg_user_info:v,uint64_start_enter_time:this.pathJoinRoom_.uint64_start_time,uint64_play_first_frame_time:0},userId:p.userId,sendSubscribeCMDTime:f});var I="".concat(p.userId,"_").concat(Ni);p.trackState.auxiliary&&p.subscribeState.auxiliary&&!this.pathAuxiliaryMap_.has(I)&&this.pathAuxiliaryMap_.set(I,{sendSubscribeCMDTime:f})}}},{key:"handleRemoteStreamSubscribed",value:function(p){var v=p.client,f=p.stream;if(this.hitTest(v)){var y=f.getUserId(),I=f.getType(),T="".concat(y,"_").concat(I),b=this.remoteStreamStatsMap_.get(T);b&&b.subscribedTime===0&&(b.subscribedTime=Date.now(),b.stream=f)}}},{key:"handlePlayStream",value:function(p){var v=p.stream;if(v.isRemote()&&v.getConnection()&&this.hitTest(v.getConnection().getClient())){var f=v.getConnection().getUserId(),y="".concat(f,"_").concat(v.getType());if(this.remoteStreamStatsMap_.has(y)){var I=this.remoteStreamStatsMap_.get(y);I.playStreamTime===0&&(I.playStreamTime=Date.now())}}}},{key:"handleVideoLoadedData",value:function(p){var v=p.stream;if(v.isRemote()&&v.getConnection()&&this.hitTest(v.getConnection().getClient())){var f=v.getConnection().getUserId(),y="".concat(f,"_").concat(v.getType());if(this.pathMainVideoMap_.has(y)){var I=this.pathMainVideoMap_.get(y);I.statsToReport.uint64_combine_first_frame_time===0&&(I.statsToReport.uint64_combine_first_frame_time=Date.now())}}}},{key:"handleVideoPlaying",value:function(p){var v=p.stream;if(v.isRemote()&&v.getConnection()&&this.hitTest(v.getConnection().getClient())){var f=v.getConnection().getUserId(),y="".concat(f,"_").concat(v.getType()),I=Date.now();if(this.pathMainVideoMap_.has(y)){var T=this.pathMainVideoMap_.get(y);if(T.statsToReport.uint64_render_first_frame_time===0&&(T.statsToReport.uint64_render_first_frame_time=I),this.remoteStreamStatsMap_.has(y)){var b=this.remoteStreamStatsMap_.get(y),k=b.statsToReport,N=b.playStreamTime,O=b.subscribedTime;k.uint32_video_render_first===0&&N-O<=100&&(k.uint32_video_render_first=I-T.sendSubscribeCMDTime)}}if(v.getType()===Ni&&this.pathAuxiliaryMap_.has(y)&&this.remoteStreamStatsMap_.has(y)){var F=this.remoteStreamStatsMap_.get(y),G=F.statsToReport,P=F.playStreamTime,K=F.subscribedTime;G.uint32_video_render_first===0&&P-K<=100&&(G.uint32_video_render_first=I-this.pathAuxiliaryMap_.get(y).sendSubscribeCMDTime)}}}},{key:"handleAudioPlaying",value:function(p){if(p.stream.isRemote()&&p.stream.getConnection()&&this.hitTest(p.stream.getConnection().getClient())){var v=p.stream.getConnection().getUserId(),f="".concat(v,"_").concat(p.stream.getType());if(this.pathMainAudioMap_.has(f)){var y=this.pathMainAudioMap_.get(f);y.statsToReport.uint64_play_first_frame_time===0&&(y.statsToReport.uint64_play_first_frame_time=Date.now())}}}},{key:"handleNetworkQuality",value:function(p){var v=this;this.hitTest(p.client)&&(this.networkQuality_.totalUplinkLoss+=p.uplinkLoss,this.networkQuality_.totalUplinkRTT+=p.uplinkRTT,this.networkQuality_.count++,p.downlinkLossAndRTTMap.forEach(function(f){var y=f.rtt,I=f.loss,T=f.userId,b=v.networkQuality_.totalDownlinkRTTAndLossMap.get(T);b?(b.totalRTT+=y,b.totalLoss+=I,b.count++):v.networkQuality_.totalDownlinkRTTAndLossMap.set(T,{totalRTT:y,totalLoss:I,count:1})}))}},{key:"handleHeartbeatStats",value:function(p){var v=this;if(this.hitTest(p.client)){var f=p.stats,y=f.msg_up_stream_info,I=f.msg_down_stream_info;if(y.msg_video_status[0]){var T=y.msg_video_status[0],b=T.uint32_video_codec_bitrate,k=T.uint32_video_enc_fps,N=T.uint32_video_width,O=T.uint32_video_height;this.localStreamStats_.totalVideoBitrate+=b,this.localStreamStats_.totalVideoFPS+=k,this.localStreamStats_.totalVideoWidth+=N,this.localStreamStats_.totalVideoHeight+=O,this.localStreamStats_.videoCount++}var F=y.msg_audio_status.audioLevel;Math.floor(100*F)>0&&(this.localStreamStats_.totalAudioLevel+=F,this.localStreamStats_.audioLevelCount++),I.forEach(function(G){var P=G.msg_user_info,K=G.msg_audio_status,X=G.msg_video_status,oe=P.str_identifier;if(X.forEach(function(je){var Re=je.uint32_video_stream_type===2,Oe=je.uint32_video_stream_type===7,qe="".concat(oe,"_").concat(Re?kr:Ni);if(v.remoteStreamStatsMap_.has(qe)){var $e=v.remoteStreamStatsMap_.get(qe);(Re&&$e.stream.isMainVideoSubscribed||Oe&&$e.stream.isAuxVideoSubscribed)&&($e.totalVideoFPS+=je.uint32_video_receive_fps,$e.totalVideoBitrate+=je.uint32_video_codec_bitrate,$e.videoCount++,$e.statsToReport.uint32_video_width===0&&($e.statsToReport.uint32_video_width=je.uint32_video_width),$e.statsToReport.uint32_video_height===0&&($e.statsToReport.uint32_video_height=je.uint32_video_height))}}),K){var Ce="".concat(oe,"_").concat(kr);if(v.remoteStreamStatsMap_.has(Ce)){var Ve=v.remoteStreamStatsMap_.get(Ce);Ve.stream.isMainAudioSubscribed&&(Ve.totalAudioBitrate+=K.uint32_audio_codec_bitrate,Ve.audioCount++,Math.floor(100*K.audioLevel)>0&&(Ve.totalAudioLevel+=K.audioLevel,Ve.audioLevelCount++))}}})}}},{key:"handlePublishStart",value:function(p){var v=p.client;this.hitTest(v)&&this.localStreamStats_.publishStartTime===0&&(this.localStreamStats_.publishStartTime=Date.now())}},{key:"handleLocalStreamInitStart",value:function(p){var v=p.audio,f=p.video;v&&this.pathJoinRoom_.uint64_init_audio_start_time===0&&(this.pathJoinRoom_.uint64_init_audio_start_time=Date.now()),f&&this.pathJoinRoom_.uint64_init_camera_start_time===0&&(this.pathJoinRoom_.uint64_init_camera_start_time=Date.now())}},{key:"handleLocalStreamInitEnd",value:function(p){var v=p.audio,f=p.video;v&&this.pathJoinRoom_.uint64_init_audio_end_time===0&&(this.pathJoinRoom_.uint64_init_audio_end_time=Date.now()),f&&this.pathJoinRoom_.uint64_init_camera_end_time===0&&(this.pathJoinRoom_.uint64_init_camera_end_time=Date.now())}},{key:"handleLocalStreamInitFailed",value:function(p){var v=p.audio,f=p.video,y=p.error,I=y instanceof et?y.getExtraCode()||y.getCode():{NotFoundError:1,NotAllowedError:2,NotReadableError:3,OverConstrainedError:4,AbortError:5}[y.name]||Ye.UNKNOWN;v&&this.pathJoinRoom_.uint64_init_audio_end_time===0&&(this.pathJoinRoom_.int32_init_audio_ret=I,this.pathJoinRoom_.uint64_init_audio_end_time=Date.now()),f&&this.pathJoinRoom_.uint64_init_camera_end_time===0&&(this.pathJoinRoom_.int32_init_camera_ret=I,this.pathJoinRoom_.uint64_init_camera_end_time=Date.now())}},{key:"hasVideoFlag",value:function(p){return this.firstPublishedUserList_.findIndex(function(v){return v.userId===p&&1&v.flag})>=0}},{key:"hasAudioFlag",value:function(p){return this.firstPublishedUserList_.findIndex(function(v){return v.userId===p&&8&v.flag})>=0}},{key:"hasAuxFlag",value:function(p){return this.firstPublishedUserList_.findIndex(function(v){return v.userId===p&&4&v.flag})>=0}},{key:"hitTest",value:function(p){return p===this.client_}},{key:"checkStorage",value:(d=D(regeneratorRuntime.mark(function p(){var v;return regeneratorRuntime.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(f.prev=0,!(v=Vf.getItem(this.storageKey_))){f.next=6;break}return f.next=5,this.upload(v);case 5:Vf.deleteItem(this.storageKey_);case 6:f.next=11;break;case 8:f.prev=8,f.t0=f.catch(0),this.log_.warn(f.t0);case 11:case"end":return f.stop()}},p,this,[[0,8]])})),function(){return d.apply(this,arguments)})},{key:"setStorage",value:function(){this.prepareReport();var p=this.getReportData();p.msg_path_enter_room.uint64_start_time!==0&&Vf.setItem(this.storageKey_,p)}},{key:"prepareReport",value:function(){var p=this;if(this.networkQuality_.count>0&&(this.basicInfo.uint32_avg_rtt=Math.floor(this.networkQuality_.totalUplinkRTT/this.networkQuality_.count),this.basicInfo.uint32_avg_up_loss=Math.floor(this.networkQuality_.totalUplinkLoss/this.networkQuality_.count)),this.localStreamStats_.videoCount>0){this.localStreamStats_.statsToReport.uint32_video_big_capture_fps=Math.floor(this.localStreamStats_.totalVideoFPS/this.localStreamStats_.videoCount),this.localStreamStats_.statsToReport.uint32_video_big_bitrate=Math.floor(this.localStreamStats_.totalVideoBitrate/this.localStreamStats_.videoCount);var v=Math.floor(this.localStreamStats_.totalVideoWidth/this.localStreamStats_.videoCount),f=Math.floor(this.localStreamStats_.totalVideoHeight/this.localStreamStats_.videoCount);this.localStreamStats_.statsToReport.uint32_video_big_resolution=v<<16|f}this.localStreamStats_.audioLevelCount>0&&(this.localStreamStats_.statsToReport.uint32_audio_capture_db=Math.floor(this.localStreamStats_.totalAudioLevel/this.localStreamStats_.audioLevelCount*100)),this.remoteStreamStatsMap_.forEach(function(y,I){var T=y.userId;if(p.networkQuality_.totalDownlinkRTTAndLossMap.has(T)){var b=p.networkQuality_.totalDownlinkRTTAndLossMap.get(T),k=b.totalLoss,N=b.count;y.statsToReport.uint32_avg_down_loss=Math.floor(k/N)}y.videoCount>0&&(y.statsToReport.uint32_video_avg_fps=Math.floor(y.totalVideoFPS/y.videoCount),y.statsToReport.uint32_video_avg_bitrate=Math.floor(y.totalVideoBitrate/y.videoCount)),y.audioCount>0&&(y.statsToReport.uint32_audio_recv_bitrate=y.statsToReport.uint32_audio_bitrate=Math.floor(y.totalAudioBitrate/y.audioCount)),y.audioLevelCount>0&&(y.statsToReport.uint32_audio_play_db=Math.floor(y.totalAudioLevel/y.audioLevelCount*100));var O=p.client_.getCallDurationCalculator();O&&(y.statsToReport.uint32_audio_play_time=O.getDuration(I,ln),y.statsToReport.uint32_video_play_time=O.getDuration(I,An)),y.statsToReport.uint32_video_render_first=Math.min(y.statsToReport.uint32_video_render_first,5e3);var F=p.client_.getBadCaseDetector();if(F){var G=F.getDataFreezeDuration(I),P=G.dataFreeze,K=G.count,X=F.getRenderFreezeDuration(I).renderFreeze;y.statsToReport.uint32_video_block_count=K,y.statsToReport.uint32_video_block_time=Math.min(P,y.statsToReport.uint32_video_play_time),y.statsToReport.uint32_video_external_block_time=Math.min(X,y.statsToReport.uint32_video_play_time),F.isBlackStream(I)&&y.statsToReport.uint32_video_avg_fps===0?y.statsToReport.uint32_video_black_screen_subjective=1:y.statsToReport.uint32_video_black_screen_subjective=0}(y.subscribeStartTime===0||y.subscribeStartTime-y.streamAddedTime>100||y.playStreamTime===0)&&(p.pathMainAudioMap_.delete(I),p.pathMainVideoMap_.delete(I),y.statsToReport.uint32_video_render_first=0)}),this.pathMainAudioMap_.forEach(function(y,I){p.hasAudioFlag(y.userId)?y.statsToReport.uint64_play_first_frame_time-y.statsToReport.uint64_start_enter_time>5e3&&(y.statsToReport.uint64_play_first_frame_time=y.statsToReport.uint64_start_enter_time+5e3):p.pathMainAudioMap_.delete(I)}),this.pathMainVideoMap_.forEach(function(y,I){p.hasVideoFlag(y.userId)?y.statsToReport.uint64_render_first_frame_time-y.statsToReport.uint64_start_enter_time>5e3&&(y.statsToReport.uint64_render_first_frame_time=y.statsToReport.uint64_start_enter_time+5e3):p.pathMainVideoMap_.delete(I)}),this.pathJoinRoom_.uint64_end_time-this.pathJoinRoom_.uint64_start_time>5e3&&(this.pathJoinRoom_.uint64_end_time=this.pathJoinRoom_.uint64_start_time+5e3)}},{key:"getReportData",value:function(){var p=this.client_.getSignalInfo();return{uint32_sdk_app_id:Number(this.client_.getSDKAppId()),msg_user_info:new aw({userId:this.client_.getUserId(),tinyId:this.client_.getTinyId(),role:this.client_.getRole()==="anchor"?rd:Ua}),msg_basic_info:this.basicInfo,uint32_acc_ip:Dy(p.relayIp),uint32_client_ip:Dy(p.clientIp,"small"),uint32_acc_port:0,uint64_timestamp:Date.now(),uint32_seq:Math.floor(Math.random()*Math.pow(2,31)),msg_path_enter_room:this.pathJoinRoom_,msg_path_exit_room:this.pathLeaveRoom_,msg_path_recv_video:de(this.pathMainVideoMap_.values()).map(function(v){return v.statsToReport}),msg_quality_statistics:de(this.remoteStreamStatsMap_.values()).map(function(v){return v.statsToReport}),str_room_name:String(this.client_.getRoomId()),msg_path_recv_audio:de(this.pathMainAudioMap_.values()).map(function(v){return v.statsToReport}),uint32_info_client_ip:Dy(p.clientIp,"small"),error_code:[],msg_local_statistics:this.localStreamStats_.statsToReport}}},{key:"report",value:(u=D(regeneratorRuntime.mark(function p(){var v;return regeneratorRuntime.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.prev=0,v=this.getReportData(),f.next=4,this.upload(v);case 4:Vf.deleteItem(this.storageKey_),this.initData(),f.next=11;break;case 8:f.prev=8,f.t0=f.catch(0),this.log_.warn(f.t0);case 11:case"end":return f.stop()}},p,this,[[0,8]])})),function(){return u.apply(this,arguments)})},{key:"upload",value:(c=D(regeneratorRuntime.mark(function p(v){var f,y,I;return regeneratorRuntime.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(!(Rh||v.msg_path_enter_room.uint64_start_time===0||[DI,hM,pM].findIndex(function(b){return b===location.host})>=0)){T.next=2;break}return T.abrupt("return");case 2:return f=Number(this.client_.getSDKAppId()),y=Lh(f,wh),T.next=6,hv.post(y,JSON.stringify(v));case 6:if((I=T.sent).data==="ok"){T.next=9;break}throw"key point upload failed: ".concat(I.data);case 9:case"end":return T.stop()}},p,this)})),function(p){return c.apply(this,arguments)})}]),r}();function ZE(){return function(r,c,u){var d=u.value,p=new Set;return u.value=D(regeneratorRuntime.mark(function v(){var f,y,I,T,b=arguments;return regeneratorRuntime.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(!p.has(this)){k.next=2;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:mM,data:{name:c}})});case 2:for(k.prev=2,p.add(this),f=b.length,y=new Array(f),I=0;I<f;I++)y[I]=b[I];return k.next=7,d.apply(this,y);case 7:return T=k.sent,p.delete(this),k.abrupt("return",T);case 12:throw k.prev=12,k.t0=k.catch(2),p.delete(this),k.t0;case 16:case"end":return k.stop()}},v,this,[[2,12]])})),u}}function Ox(r){return lD.apply(this,arguments)}function lD(){return(lD=D(regeneratorRuntime.mark(function r(c){var u,d,p,v,f,y,I,T,b,k,N,O,F;return regeneratorRuntime.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return u=c.userId,d=c.sdkAppId,p=c.useStringRoomId,v=c.roomId,f=c.userSig,y={delta:0,count:[1,1],msg:[]},G.prev=2,(I=new FormData).append("userId",String(u)),I.append("sdkAppId",String(d)),I.append("isStrGroupId",p),I.append("groupId",String(v)),I.append("sdkVersion","4.14.0"),I.append("userSig",String(f)),T=So(),G.next=13,Lx(I,y,d);case 13:return b=G.sent,y.delta=So()-T,dD({stat:y,userId:u}),G.abrupt("return",b);case 19:throw G.prev=19,G.t0=G.catch(2),k=JM(G.t0)?G.t0[0]:G.t0,N=ha(k.code)?k.code:0,O="get websocket url failed: ".concat(k.message.includes("timeout")?"timeout":k.message),F=new et({code:Ye.SCHEDULE_FAILED,extraCode:N,message:rt({key:If,data:{error:O,code:N}})}),Bt.error(F),dD({stat:y,userId:u,roomId:v,error:F}),F;case 28:case"end":return G.stop()}},r,null,[[2,19]])}))).apply(this,arguments)}function dD(r){var c=r.stat,u=r.userId,d=r.error;d?jt.logFailedEvent({eventType:CI,error:d,userId:u}):jt.logSuccessEvent({eventType:CI,delta:c.delta,userId:u}),jt.uploadEvent({log:"stat-schedule:"+JSON.stringify(c),userId:u})}function hD(r){var c,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ti;return c=wy(r)?u===ti?sM:cM:u===ti?oM:aM,"https://".concat(c,"/api/v1/config")}function Nx(r,c,u){return new Promise(function(d,p){hv.post(r,c,u).then(function(v){v.data.code===0?d(v.data.data):p({code:v.data.code,message:v.data.msg})}).catch(p)})}var pD=function(r,c){return Gf({retryFunction:Nx,settings:{retries:3,timeout:0},onError:c,onRetrying:r})};function Lx(r,c,u){return new Promise(function(d,p){var v,f=null;(v=[pD(function(y){return c.count[0]=y+1},function(y,I){c.msg[0]=y.message,f||I()})(hD(u,ti),r,{get timeout(){return 1e3*Ho(2+c.count[0])}}),pD(function(y){return c.count[1]=y+1},function(y,I){c.msg[1]=y.message,f||I()})(hD(u,kh),r,{get timeout(){return 1e3*Ho(2+c.count[1])}})],new Promise(function(y,I){var T=[];v.forEach(function(b){b.then(y).catch(function(k){T.push(k),T.length===v.length&&I(T)})})})).then(function(y){d(f=y)}).catch(p)})}var fD,gD,mD,vD,_D,yD,SD,ID,ED,TD,MD,RD,CD,bD,AD,Or,Px=new(function(){function r(){x(this,r)}return B(r,[{key:"call",value:function(c,u){return da(this[c])?this[c](u):Promise.reject(new et({code:Ye.INVALID_PARAMETER,message:rt({key:ky,data:{name:c}})}))}},{key:"updatePrivateMapKey",value:function(c){var u=c.privateMapKey;return c.client.setProperty("privateMapKey",u),Promise.resolve()}}]),r}()),sw,HC,$C,cw,xx=(fD=ZE(),gD=yd(Ts.CLIENT.join),mD=ZE(),vD=ZE(),_D=yd(Ts.CLIENT.publish),yD=ZE(),SD=yd(Ts.CLIENT.unpublish),ID=yd.apply(void 0,de(Ts.CLIENT.subscribe)),ED=yd(Ts.CLIENT.unsubscribe),TD=ZE(),MD=yd(Ts.CLIENT.switchRole),RD=yd(Ts.CLIENT.startPublishCDNStream),CD=yd(Ts.CLIENT.startMixTranscode),bD=BC.apply(void 0,de(Ts.CLIENT.sendSEIMessage)),HC=(sw={timesInSecond:30,maxSizeInSecond:8e3,getSize:function(){for(var r=arguments.length,c=new Array(r),u=0;u<r;u++)c[u]=arguments[u];return c[0].byteLength}}).timesInSecond,$C=sw.maxSizeInSecond,cw=sw.getSize,AD=function(r,c,u){var d=u.value,p=new Map;return Me.on(oE,function(v){var f=v.client;return p.delete(f)}),u.value=function(){var v=p.get(this);v||(v={callCountInSecond:0,timestamp:0,totalSizeInSecond:0},p.set(this,v)),v.timestamp===0?v.timestamp=Date.now():Date.now()-v.timestamp>1e3&&(v.timestamp=Date.now(),v.callCountInSecond=0,v.totalSizeInSecond=0);for(var f=arguments.length,y=new Array(f),I=0;I<f;I++)y[I]=arguments[I];if(cw&&(v.totalSizeInSecond+=cw.apply(void 0,y)),v.timestamp!==0&&Date.now()-v.timestamp<1e3&&(v.callCountInSecond>=HC||v.totalSizeInSecond>$C))throw new et({code:Ye.INVALID_OPERATION,message:rt({key:SA,data:{isTimes:v.callCountInSecond>=HC,isSize:v.totalSizeInSecond>$C,name:c,timesInSecond:HC,maxSizeInSecond:$C}})});return v.callCountInSecond++,d.apply(this,y)},u},De((Or=function(){function r(Q){var j,le;x(this,r),this.name_=lM,this.mode_=Q.mode,this.sdpSemantics_="plan-b",kt(Q.sdpSemantics)?function(){if(!pk()||kt(window.RTCRtpTransceiver)||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var fe=new RTCPeerConnection,Ie=!1;try{fe.addTransceiver(ln),Ie=!0}catch{}return fe.close(),Ie}()&&(this.sdpSemantics_="unified-plan"):this.sdpSemantics_=Q.sdpSemantics,this.sdkAppId_=Q.sdkAppId,this.userId_=Q.userId,this.log_=Bt.createLogger({id:"c".concat(Q.seq,"|").concat(this.userId_),userId:this.userId_,sdkAppId:this.sdkAppId_}),this.userSig_=Q.userSig,this.roomId_=0,this.useStringRoomId_=Q.useStringRoomId||!1,this.pureAudioPushMode_=null,this.version_=Q.version,this.log_.info("using sdpSemantics: "+this.sdpSemantics_),this.signalChannel_=null,this.role_="anchor",this.privateMapKey_="",this.tinyId_=0,this.env_="",this.proxy_=null,this.connections_=new Map,this.mutedStates_=new Map,this.userMap_=new Map,this.syncUserListInterval_=-1,this.localStream_=null,this.uplinkConnection_=null,this.emitter_=tR(new Wc,this.name_),this.isJoined_=!1,this.heartbeat_=-1,this.lastHeartBeatTime_=-1,this.stats_=new dS(this),this.joinTimeout_=-1,this.changeBigSmallRecords_=new Map,this.networkQuality_=null,this.badCaseDetector_=null,this.networkType_=zI(),this.autoSubscribe_=!!kt(Q.autoSubscribe)||Q.autoSubscribe,this.joinedTimestamp_=0,this.joinOptions_={},this.basis_=(le={browser:Ch().name+"/"+Ch().version,os:LE(),displayResolution:fk(),isScreenShareSupported:QR(),isWebRTCSupported:AE(),isGetUserMediaSupported:gk(),isWebAudioSupported:mk(),isWebSocketsSupported:"WebSocket"in window&&window.WebSocket.CLOSING===2,isWebCodecSupported:(j={AudioDecoder:!1,AudioEncoder:!1,VideoDecoder:!1,VideoEncoder:!1,ImageDecoder:!1},kt(window.AudioDecoder)||(j.AudioDecoder=!0),kt(window.AudioEncoder)||(j.AudioEncoder=!0),kt(window.VideoDecoder)||(j.VideoDecoder=!0),kt(window.VideoEncoder)||(j.VideoEncoder=!0),kt(window.ImageDecoder)||(j.ImageDecoder=!0),j),isMediaSessionSupported:"mediaSession"in navigator&&!kt(navigator.mediaSession.setActionHandler),isWebTransportSupported:!kt(window.WebTransport)},navigator.userAgent.includes("miniProgram")&&(le.browser="mini/".concat(le.browser)),le),this.initBussinessInfo_(Q),this.publishedCDN_=!1,this.publishCDNData_=null,this.mixedMCU_=!1,this.mixTranscodeData_=null,this.checkSystemResult_=null,this.enableAudioVolumeEvaluation_=!1,this.audioVolumeIntervalId_=null,this.mixTranscodeManager_=null,this.publishCDNManager_=new Rx({client:this}),this.keyPointManager_=new Dx({client:this,frameWorkType:Q.frameWorkType}),this.getUserList=Gf({retryFunction:this.getUserList,settings:{retries:3},onError:function(fe,Ie){return Ie()}}),this.isPublishing_=!1,this.isEnableSmallStream_=!1,this.smallStreamConfig_={bitrate:100,frameRate:15,height:120,width:160},this.turnServers_=[],this.iceTransportPolicy_=Q.iceTransportPolicy,this.schedule_={domains:null,iceServers:null,iceTransportPolicy:null},this.enableAutoPlayDialog_=!!kt(Q.enableAutoPlayDialog)||Q.enableAutoPlayDialog,this.signalInfo_={},this.enableSEI_=!kt(Q.enableSEI)&&Q.enableSEI,this.isDestroyed_=!1}var c,u,d,p,v,f,y,I,T,b,k,N,O,F,G,P,K,X,oe,Ce,Ve,je,Re,Oe,qe,$e,Tn;return B(r,[{key:"initBussinessInfo_",value:function(Q){this.bussinessInfo_=Q.bussinessInfo;var j={};if(yo(Q.bussinessInfo)&&(j=JSON.parse(Q.bussinessInfo)),!kt(Q.pureAudioPushMode)){if(!Number.isInteger(Number(Q.pureAudioPushMode)))throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:at})});this.pureAudioPushMode_=Q.pureAudioPushMode,j.Str_uc_params||(j.Str_uc_params={}),j.Str_uc_params.pure_audio_push_mod=this.pureAudioPushMode_}if(!kt(Q.streamId)){if(!(yo(Q.streamId)&&String(Q.streamId)&&String(Q.streamId).length<=64))throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:LI})});j.Str_uc_params||(j.Str_uc_params={}),j.Str_uc_params.userdefine_streamid_main=Q.streamId}if(!kt(Q.userDefineRecordId)){if(Q.userDefineRecordId.match(/^[A-Za-z0-9_-]{1,64}$/gi)===null)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:PI})});j.Str_uc_params||(j.Str_uc_params={}),j.Str_uc_params.userdefine_record_id=Q.userDefineRecordId}if(!kt(Q.userDefinePushArgs)){if(!(yo(Q.userDefinePushArgs)&&String(Q.userDefinePushArgs)&&String(Q.userDefinePushArgs).length<=256))throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:Qm})});j.Str_uc_params||(j.Str_uc_params={}),j.Str_uc_params.userdefine_push_args=Q.userDefinePushArgs}hd(j)||(this.bussinessInfo_=JSON.stringify(j))}},{key:"setProxyServer",value:function(Q){if(this.log_.info("set proxy server: ".concat(JSON.stringify(Q))),yo(Q)){if(!Q.startsWith("wss://"))throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:Zm})});this.proxy_=Q}else if(sd(Q)){var j=Q.websocketProxy,le=Q.loggerProxy;j&&(this.proxy_=j),le&&Ym(le)}}},{key:"schedule",value:(Tn=D(regeneratorRuntime.mark(function Q(j){var le;return regeneratorRuntime.wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return fe.next=2,Ox({userId:this.userId_,sdkAppId:this.sdkAppId_,roomId:j,useStringRoomId:this.useStringRoomId_,version:this.version_,userSig:this.userSig_});case 2:(le=fe.sent)&&(this.log_.info("schedule: ".concat(JSON.stringify(le))),this.schedule_=m(m({},this.schedule_),le),Me.emit(hR,this.schedule_));case 4:case"end":return fe.stop()}},Q,this)})),function(Q){return Tn.apply(this,arguments)})},{key:"getSignalChannelUrl",value:function(){var Q={mainUrl:"",backupUrl:""},j=Rf();return j?Q.mainUrl=Q.backupUrl="wss://".concat(j,".rtc.qq.com"):this.proxy_?Q.mainUrl=Q.backupUrl=this.proxy_:Array.isArray(this.schedule_.domains)&&this.schedule_.domains.length>0&&(Q.mainUrl=Q.backupUrl="wss://".concat(this.schedule_.domains[0]),this.schedule_.domains[1]&&(Q.backupUrl="wss://".concat(this.schedule_.domains[1]))),Q}},{key:"getUserId",value:function(){return this.userId_}},{key:"getUserSig",value:function(){return this.userSig_}},{key:"getRole",value:function(){return this.role_}},{key:"getSignalInfo",value:function(){return this.signalInfo_}},{key:"getRoomId",value:function(){return this.roomId_}},{key:"getSDKAppId",value:function(){return this.sdkAppId_}},{key:"getTinyId",value:function(){return this.tinyId_}},{key:"setTurnServer",value:function(Q){this.log_.info("set turn server: "+JSON.stringify(Q));var j=[];Array.isArray(Q)?Q.forEach(function(le){return j.push(ov(le))}):sd(Q)&&j.push(ov(Q)),this.turnServers_=j}},{key:"getIceTransportPolicy",value:function(){return this.iceTransportPolicy_||this.schedule_.iceTransportPolicy||"all"}},{key:"initialize",value:function(){var Q=this;this.log_.info("setup signal channel");var j=this.getSignalChannelUrl(),le=j.mainUrl,fe=j.backupUrl;return this.signalChannel_=new KR({sdkAppId:this.sdkAppId_,userId:this.userId_,userSig:this.userSig_,url:le,backupUrl:fe,client:this}),this.networkQuality_||(this.networkQuality_=new iC({connections:this.connections_,signalChannel:this.signalChannel_,userId:this.userId_,client:this}),this.networkQuality_.on(Er.NETWORK_QUALITY,function(Ie){Q.emitter_.emit(Er.NETWORK_QUALITY,Ie)})),this.deviceDetector_||(this.deviceDetector_=new oC({client:this})),this.subscriptionManager_||(this.subscriptionManager_=new mx({client:this})),this.badCaseDetector_||(this.badCaseDetector_=new Tx({client:this,stats:this.stats_})),this.callDurationCalculator_||(this.callDurationCalculator_=new Cx({client:this})),this.mixTranscodeManager_||(this.mixTranscodeManager_=new Mx({client:this,signalChannel:this.signalChannel_})),this.publishCDNManager_&&this.publishCDNManager_.setSignalChannel({signalChannel:this.signalChannel_}),this.signalChannel_.on(IE,function(Ie){Q.log_.info("SignalChannel state changed from ".concat(Ie.prevState," to ").concat(Ie.state)),Q.emitter_.emit(Er.CONNECTION_STATE_CHANGED,Ie)}),this.signalChannel_.on(Fh,function(Ie){Q.reset(),Q.emitter_.emit(Er.ERROR,Ie)}),this.signalChannel_.once(CR,function(Ie){Q.tinyId_=Ie.signalInfo.tinyId,Me.emit(Xy,{client:Q})}),this.signalChannel_.on(wr.PEER_JOIN,this.onPeerJoin,this),this.signalChannel_.on(wr.PEER_LEAVE,this.onPeerLeave,this),this.signalChannel_.on(wr.UPDATE_REMOTE_MUTE_STAT,function(Ie){Date.now()-Q.lastHeartBeatTime_>=1e4&&Q.doHeartbeat(),Me.emit(Lf,{client:Q,data:Ie.data}),Q.onPublishedUserList(Ie.data),Q.onUpdateRemoteMuteStat(Ie.data)}),this.signalChannel_.on(wr.CLIENT_BANNED,function(Ie){var Ne,lt=Ie.data.data.reason;if(jt.uploadEvent({log:"stat-banned:".concat(lt),userId:Q.userId_}),lt===zs)Ne="you got banned by the admin";else if(lt===qu)Ne="duplicated userId joining the room";else if(lt===Ei)Ne="the room has been disbanded by the admin",lt=lt.replace("_","-");else if(lt===fi)return Q.log_.warn("".concat(lt," last heart beat time: ").concat(Q.lastHeartBeatTime_," interval: ").concat(Date.now()-Q.lastHeartBeatTime_,", visibility: ").concat(document.visibilityState)),void Q.reJoin();Q.log_[lt==="kick"?"error":"info"]("user was banned because of [".concat(lt,"]")),Q.reset(),Q.emitter_.emit(Er.CLIENT_BANNED,{reason:lt,message:rt({key:Xb,data:{message:Ne,reason:lt}})||lt})}),Me.emit(Jy,{client:this}),this.signalChannel_.connect()}},{key:"preJoin",value:($e=D(regeneratorRuntime.mark(function Q(j){var le,fe,Ie,Ne;return regeneratorRuntime.wrap(function(lt){for(;;)switch(lt.prev=lt.next){case 0:return this.joinOptions_=j,lt.next=3,wE();case 3:if(this.checkSystemResult_=lt.sent,this.checkDestroy(),(le=Rf())||(le=gi,this.proxy_&&(this.proxy_.startsWith(pn)?le=ri:this.proxy_.startsWith(ni)&&(le=Vt))),this.env_=le,jt.setConfig({env:le,sdkAppId:this.sdkAppId_,userId:this.userId_,roomId:j.roomId}),this.uploadTrtcStats(),fe=this.checkSystemResult_.detail,Ie=fe.isH264EncodeSupported,Ne=fe.isVp8EncodeSupported,AE()&&(Ie||Ne)){lt.next=13;break}throw new et({code:Ye.NOT_SUPPORTED,message:rt({key:$I})});case 13:case"end":return lt.stop()}},Q,this)})),function(Q){return $e.apply(this,arguments)})},{key:"join",value:(qe=D(regeneratorRuntime.mark(function Q(j){var le,fe=this;return regeneratorRuntime.wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return le=So(),Me.emit(zc,{client:this,roomId:j.roomId}),Eo(this.userId_,{eventId:ld,eventDesc:"joining room",timestamp:Yi(),userId:this.userId_,tinyId:this.tinyId_}),Ie.next=5,this.preJoin(j);case 5:return Ie.abrupt("return",new Promise(function(){var Ne=D(regeneratorRuntime.mark(function lt(Dt,Ut){return regeneratorRuntime.wrap(function(St){for(;;)switch(St.prev=St.next){case 0:if(fe.joinReject_=Ut,St.prev=1,fe.proxy_||fe.schedule_.domains){St.next=5;break}return St.next=5,fe.schedule(j.roomId);case 5:return fe.checkDestroy(),St.next=8,fe.initialize(j);case 8:return St.next=10,fe.doJoin(j);case 10:fe.signalInfo_=fe.signalChannel_.getSignalInfo(),Me.emit(Le,{client:fe}),fe.joinedTimestamp_=So(),jt.logSuccessEvent({userId:fe.userId_,eventType:ZT,delta:fe.joinedTimestamp_-le}),jt.logSuccessEvent({userId:fe.userId_,eventType:uI}),jt.uploadEvent({log:"stat-autoplay-dialog:".concat(fe.enableAutoPlayDialog_),userId:fe.userId_}),jt.uploadEvent({log:"stat-conv-".concat(Rh,"-").concat(location.hostname),userId:fe.userId_}),Dt(),St.next=26;break;case 20:St.prev=20,St.t0=St.catch(1),Me.emit(Of,{client:fe,error:St.t0}),jt.logFailedEvent({userId:fe.userId_,eventType:uI,error:St.t0}),fe.reset(),Ut(St.t0);case 26:fe.joinReject_=null;case 27:case"end":return St.stop()}},lt,null,[[1,20]])}));return function(lt,Dt){return Ne.apply(this,arguments)}}()));case 6:case"end":return Ie.stop()}},Q,this)})),function(Q){return qe.apply(this,arguments)})},{key:"checkDestroy",value:function(){if(this.isDestroyed_)throw new et({code:Ye.INVALID_OPERATION,message:rt({key:Cy,data:{funName:"join"}})})}},{key:"uploadTrtcStats",value:(Oe=D(regeneratorRuntime.mark(function Q(){var j,le,fe,Ie,Ne,lt,Dt,Ut,St,_n,Gt,zn,Un;return regeneratorRuntime.wrap(function(on){for(;;)switch(on.prev=on.next){case 0:return on.prev=0,on.next=3,Qr.getMicrophones();case 3:fe=on.sent,j=fe&&fe.length,on.next=9;break;case 7:on.prev=7,on.t0=on.catch(0);case 9:return on.prev=9,on.next=12,Qr.getCameras();case 12:Ie=on.sent,le=Ie&&Ie.length,on.next=18;break;case 16:on.prev=16,on.t1=on.catch(9);case 18:Ne={microphone:j,camera:le},lt=this.checkSystemResult_.detail,Dt=lt.isH264EncodeSupported,Ut=lt.isVp8EncodeSupported,St=lt.isH264DecodeSupported,_n=lt.isVp8DecodeSupported,Gt={webRTC:this.basis_.isWebRTCSupported,getUserMedia:this.basis_.isGetUserMediaSupported,webSocket:this.basis_.isWebSocketsSupported,screenShare:this.basis_.isScreenShareSupported,webAudio:this.basis_.isWebAudioSupported,h264Encode:Dt,h264Decode:St,vp8Encode:Ut,vp8Decode:_n},zn={browser:this.basis_.browser,os:this.basis_.os,trtc:Gt,devices:Ne},Un={isWebCodecSupported:this.basis_.isWebCodecSupported,isMediaSessionSupported:this.basis_.isMediaSessionSupported,isWebTransportSupported:this.basis_.isWebTransportSupported},jt.uploadEvent({log:"trtcstats-"+JSON.stringify(zn),userId:this.userId_}),this.log_.info("TrtcStats-"+JSON.stringify(zn)),jt.uploadEvent({log:"trtcadvancedstats-"+JSON.stringify(Un),userId:this.userId_});case 26:case"end":return on.stop()}},Q,this,[[0,7],[9,16]])})),function(){return Oe.apply(this,arguments)})},{key:"doJoin",value:function(Q){var j=this;return new Promise(function(le,fe){j.roomId_=Q.roomId,kt(Q.role)||(j.role_=Q.role),kt(Q.privateMapKey)||(j.privateMapKey_=Q.privateMapKey),j.log_.info("Join() => joining room: ".concat(Q.roomId," useStringRoomId: ").concat(j.useStringRoomId_," mode: ").concat(j.mode_," role: ").concat(j.role_));var Ie={roomId:String(Q.roomId),useStringRoomId:j.useStringRoomId_,privateMapKey:j.privateMapKey_,trtcRole:j.role_==="anchor"?rd:Ua,trtcScene:j.mode_==="live"?sI:YT,sdpSemantics:j.sdpSemantics_,version:EA(j.version_),ua:navigator&&navigator.userAgent||"",autoSubscribe:j.autoSubscribe_,terminalType:ed?4:ny?2:Zl?3:cy?12:X0?5:df?13:1,netType:Iy[zI()],bussinessInfo:j.bussinessInfo_};if(j.publishCDNManager_){var Ne=j.publishCDNManager_.handleCDNConfigForJoinData(j.bussinessInfo_),lt=Ne.bussinessInfo,Dt=Ne.pushUserCdnInfo;Object.assign(Ie,{bussinessInfo:lt,pushUserCdnInfo:Dt})}j.log_.debug("join room signal data: ".concat(JSON.stringify(Ie))),j.joinTimeout_=setTimeout(function(){j.log_.error("join room timeout observed"),fe(new et({code:Ye.JOIN_ROOM_FAILED,message:rt({key:Sf})}))},5e3),Me.emit(iE,{client:j}),j.signalChannel_.once(bR,function(Ut){j.clearJoinTimeout(),Me.emit(Xy,{client:j,error:Ut}),fe(Ut)}),j.signalChannel_.send(HA,Ie),j.signalChannel_.once(wr.JOIN_ROOM_RESULT,function(Ut){j.clearJoinTimeout();var St=Ut.data,_n=St.code,Gt=St.message,zn=St.data;j.onPublishedUserList({data:{userList:zn.publishers}}),Me.emit(En,{client:j,code:_n}),_n===0?(j.isJoined_=!0,j.log_.info("Join room success, start heartbeat"),j.startHeartbeat(),j.badCaseDetector_&&j.badCaseDetector_.start(),j.syncUserList(),j.startSyncUserListInterval(),le()):(j.log_.error("Join room failed result: "+_n+" error: "+Gt),fe(new et({code:Ye.JOIN_ROOM_FAILED,extraCode:_n,message:rt({key:If,data:{error:Gt,code:_n}})})))})})}},{key:"reJoin",value:(Re=D(regeneratorRuntime.mark(function Q(){return regeneratorRuntime.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(this.isJoined_){j.next=3;break}return this.log_.warn("reJoin abort"),j.abrupt("return");case 3:return this.isJoined_=!1,j.prev=4,this.log_.warn("reJoin pending: ".concat(this.joinOptions_.roomId)),this.subscriptionManager_&&this.subscriptionManager_.markAllStream(),this.signalChannel_.close(),j.next=10,this.signalChannel_.connect();case 10:return j.next=12,this.doJoin(m(m({},this.joinOptions_),{},{role:this.role_,privateMapKey:this.privateMapKey_}));case 12:this.log_.warn("reJoin success"),jt.logSuccessEvent({userId:this.userId_,eventType:lI}),this.checkConnectionsToReconnect(),this.republish(),this.mixTranscodeManager_&&this.mixTranscodeManager_.reStartMixTranscode(),j.next=25;break;case 19:j.prev=19,j.t0=j.catch(4),this.log_.warn("reJoin fail "+j.t0),this.reset(),jt.logFailedEvent({userId:this.userId_,eventType:lI,error:j.t0}),this.emitter_.emit(Er.ERROR,new et({code:Ye.JOIN_ROOM_FAILED,message:rt({key:tv,data:{roomId:this.joinOptions_.roomId}})}));case 25:case"end":return j.stop()}},Q,this,[[4,19]])})),function(){return Re.apply(this,arguments)})},{key:"republish",value:function(){var Q=this;if(this.uplinkConnection_&&this.localStream_&&!this.uplinkConnection_.getIsReconnecting()){this.log_.warn("republish pending");var j=this.localStream_;this.doUnpublish(j).then(function(){return Q.publish(j)}).then(function(){return Q.log_.warn("republish success")}).catch(function(le){return Q.log_.warn("republish fail "+le)})}}},{key:"leave",value:(je=D(regeneratorRuntime.mark(function Q(){var j;return regeneratorRuntime.wrap(function(le){for(;;)switch(le.prev=le.next){case 0:return Me.emit(zy,{client:this}),Eo(this.userId_,{eventId:dd,eventDesc:"leaving room",timestamp:Yi(),userId:this.userId_,tinyId:this.tinyId_}),le.prev=2,le.next=5,this.doHeartbeat();case 5:le.next=9;break;case 7:le.prev=7,le.t0=le.catch(2);case 9:this.doLeave(),Me.emit(pv,{client:this}),jt.logSuccessEvent({userId:this.userId_,eventType:eM}),j=Math.floor((So()-this.joinedTimestamp_)/1e3),jt.logSuccessEvent({userId:this.userId_,eventType:tM,delta:j});case 14:case"end":return le.stop()}},Q,this,[[2,7]])})),function(){return je.apply(this,arguments)})},{key:"doLeave",value:function(){this.isJoined_&&(Me.emit(Nf,{client:this}),this.log_.info("leave() => leaving room"),this.signalChannel_.send(TE),this.reset())}},{key:"clearNetworkQuality",value:function(){this.networkQuality_&&(this.networkQuality_.stop(),this.networkQuality_=null)}},{key:"closeConnections",value:function(){var Q=this;this.connections_.forEach(function(j){Q.closeDownLink(j.getTinyId())})}},{key:"clearJoinTimeout",value:function(){clearTimeout(this.joinTimeout_),this.joinTimeout_=-1}},{key:"destroy",value:function(){var Q,j,le;if(this.isJoined_)throw this.log_.warn(ad.INVALID_DESTROY),new et({code:Ye.INVALID_OPERATION,message:rt({key:$b})});this.isDestroyed_||(this.log_.info("destroy client"),this.joinReject_&&(this.joinReject_(new et({code:Ye.INVALID_OPERATION,message:rt({key:Cy,data:{funName:"join"}})})),this.clearJoinTimeout(),this.reset()),this.off("*"),(Q=this.callDurationCalculator_)===null||Q===void 0||Q.destroy(),(j=this.keyPointManager_)===null||j===void 0||j.destroy(),(le=this.deviceDetector_)===null||le===void 0||le.destroy(),this.callDurationCalculator_=null,this.keyPointManager_=null,this.deviceDetector_=null,this.badCaseDetector_=null,this.publishCDNManager_=null,this.isDestroyed_=!0,Me.emit(oE,{client:this}))}},{key:"reset",value:function(){this.keyPointManager_&&this.keyPointManager_.prepareReport(),this.mixTranscodeManager_&&(this.mixTranscodeManager_.reset(),this.mixTranscodeManager_=null),this.publishCDNManager_&&this.publishCDNManager_.reset(),this.userMap_.clear(),this.stopSyncUserListInterval(),this.stopHeartbeat(),this.closeConnections(),this.mutedStates_.clear(),this.clearNetworkQuality(),this.badCaseDetector_&&this.callDurationCalculator_&&this.uploadAllCallStats(),this.closeUplink(),this.isJoined_=!1,this.signalChannel_&&(this.log_.info("destroying SignalChannel"),this.signalChannel_.close(),this.signalChannel_=null)}},{key:"startSyncUserListInterval",value:function(){this.syncUserListInterval_===-1&&(this.syncUserListInterval_=ii.setInterval(this.syncUserList.bind(this),1e4))}},{key:"stopSyncUserListInterval",value:function(){ii.clearInterval(this.syncUserListInterval_),this.syncUserListInterval_=-1}},{key:"syncUserList",value:(Ve=D(regeneratorRuntime.mark(function Q(){var j,le=this;return regeneratorRuntime.wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return fe.prev=0,fe.next=3,this.getUserList();case 3:j=fe.sent,this.userMap_.size!==0&&this.userMap_.forEach(function(Ie){j.findIndex(function(Ne){return Ne.userId===Ie.userId})<0&&(le.log_.info("peer leave detected: ".concat(Ie.userId)),le.cleanUser({userId:Ie.userId,tinyId:Ie.tinyId}))}),j.forEach(function(Ie){var Ne=Ie.userId;le.userMap_.has(Ne)||Ne===le.userId_||(le.userMap_.set(Ne,Ie),le.emitter_.emit(Er.PEER_JOIN,{userId:Ne}))}),fe.next=11;break;case 8:fe.prev=8,fe.t0=fe.catch(0),this.log_.warn("sync user list failed: "+fe.t0);case 11:case"end":return fe.stop()}},Q,this,[[0,8]])})),function(){return Ve.apply(this,arguments)})},{key:"getUserList",value:function(){var Q=this;return new Promise(function(j,le){Q.signalChannel_.send(ZA),Q.signalChannel_.once(wr.USER_LIST_RES,function(fe){var Ie=fe.data,Ne=Ie.code,lt=Ie.message;if(Ne!==0){var Dt=rt({key:Ay,data:{signalResponse:wr.USER_LIST_RES,code:Ne,message:lt}});le(Dt)}else{var Ut=(fe.data.data&&fe.data.data.userList||[]).map(function(St){var _n=St.userId,Gt=St.srcTinyId,zn=St.role;return new ow({userId:_n,tinyId:Gt,role:zn})});j(Ut)}}),setTimeout(le,2e3)})}},{key:"publish",value:(Ce=D(regeneratorRuntime.mark(function Q(j){var le,fe,Ie,Ne,lt=this;return regeneratorRuntime.wrap(function(Dt){for(;;)switch(Dt.prev=Dt.next){case 0:return j.setPublishState(yf),this.isPublishing_=!0,le=So(),Me.emit(Yc,{client:this,stream:j}),this.log_.info("publish() => publishing local stream"),fe=new Ix({userId:this.userId_,tinyId:this.tinyId_,client:this,isUplink:!0,signalChannel:this.signalChannel_,enableSEI:this.enableSEI_}),j.setConnection(fe),fe.initialize(),fe.on(or.ERROR,function(Ut){var St=Ut.getCode();St!==Ye.ICE_TRANSPORT_ERROR&&(St===Ye.UPLINK_RECONNECTION_FAILED&&lt.closeUplink(),lt.emitter_.emit(Er.ERROR,Ut))}),Dt.prev=9,Dt.next=12,fe.publish(j);case 12:this.localStream_=Dt.sent,this.localStream_.getBeautyStatus()&&this.log_.info("beauty stream is published successfully"),this.log_.info("local stream is published successfully"),this.isPublishing_=!1,j.setPublishState(iM),this.uplinkConnection_=fe,Ie=So(),Ne=Ie-le,jt.logSuccessEvent({userId:this.userId_,eventType:dI}),jt.logSuccessEvent({userId:this.userId_,eventType:nM,delta:Ne}),j.hasAudio()&&Eo(this.userId_,{eventId:vs,eventDesc:"publish audio track",timestamp:Yi(),userId:this.userId_,tinyId:this.tinyId_}),j.hasVideo()&&Eo(this.userId_,{eventId:ms,eventDesc:"publish video track",timestamp:Yi(),userId:this.userId_,tinyId:this.tinyId_}),this.networkQuality_&&this.networkQuality_.setUplinkConnection(this.uplinkConnection_),this.deviceDetector_&&this.deviceDetector_.setLocalStream(this.localStream_),Me.emit(sE,{localStream:this.localStream_,client:this}),this.notPublishWithoutH264Supported_=!1,Dt.next=39;break;case 30:throw Dt.prev=30,Dt.t0=Dt.catch(9),Dt.t0 instanceof et&&Dt.t0.getCode()===Ye.NOT_SUPPORTED_H264&&(this.notPublishWithoutH264Supported_=!0),j.setPublishState(wI),fe.close(),this.log_.error("failed to publish stream "+Dt.t0),this.isPublishing_=!1,jt.logFailedEvent({userId:this.userId_,eventType:dI,error:Dt.t0}),Dt.t0;case 39:case"end":return Dt.stop()}},Q,this,[[9,30]])})),function(Q){return Ce.apply(this,arguments)})},{key:"unpublish",value:(oe=D(regeneratorRuntime.mark(function Q(){return regeneratorRuntime.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(this.localStream_){j.next=2;break}return j.abrupt("return");case 2:return this.log_.info("unpublish() => unpublishing local stream"),j.prev=3,j.next=6,this.doUnpublish();case 6:jt.logSuccessEvent({userId:this.userId_,eventType:hI}),j.next=13;break;case 9:throw j.prev=9,j.t0=j.catch(3),jt.logFailedEvent({userId:this.userId_,eventType:hI,error:j.t0}),j.t0;case 13:case"end":return j.stop()}},Q,this,[[3,9]])})),function(){return oe.apply(this,arguments)})},{key:"doUnpublish",value:function(){var Q=this;return this.signalChannel_.sendWaitForResponse({command:wR,commandDesc:"unpublish",responseCommand:wr.UNPUBLISH_RESULT}).then(function(){Q.closeUplink()}).catch(function(){Q.closeUplink()})}},{key:"closeUplink",value:function(){this.uplinkConnection_&&(this.uplinkConnection_.getIsReconnecting()&&this.uplinkConnection_.stopReconnection(),this.uplinkConnection_.close(),this.uplinkConnection_=null,this.networkQuality_&&this.networkQuality_.setUplinkConnection(null),this.localStream_.hasAudio()&&Eo(this.userId_,{eventId:Xc,eventDesc:"unpublish audio track",timestamp:Yi(),userId:this.userId_,tinyId:this.tinyId_}),this.localStream_.hasVideo()&&Eo(this.userId_,{eventId:Bh,eventDesc:"unpublish video track",timestamp:Yi(),userId:this.userId_,tinyId:this.tinyId_}),this.localStream_.setClient(null),this.localStream_.setConnection(null),this.localStream_=null,this.deviceDetector_&&this.deviceDetector_.setLocalStream(null))}},{key:"closeDownLink",value:function(Q){var j=this.connections_.get(Q);j&&(j.getIsReconnecting()&&j.stopReconnection(),this.subscriptionManager_&&this.subscriptionManager_.delete(j.getUserId()),j.close(),this.connections_.delete(Q),this.mutedStates_.delete(Q))}},{key:"subscribe",value:(X=D(regeneratorRuntime.mark(function Q(j,le){var fe,Ie,Ne;return regeneratorRuntime.wrap(function(lt){for(;;)switch(lt.prev=lt.next){case 0:return this.log_.info("subscribe() => subscribe to [".concat(j.getUserId(),"] ").concat(j.getType()," stream with options: ").concat(JSON.stringify(le))),kt(le)&&(le={audio:!0,video:!0}),kt(le.video)&&(le.video=!0),kt(le.audio)&&(le.audio=!0),lt.prev=4,fe=j.getConnection(),Me.emit(gv,{client:this,stream:j}),lt.next=9,fe.subscribe(j,le);case 9:this.subscriptionManager_&&this.subscriptionManager_.addSubscriptionRecord(j.getUserId(),j,le),this.notSubscribeWithoutH264Supported_=!1,jt.logSuccessEvent({userId:this.userId_,eventType:pI}),lt.next=22;break;case 14:throw lt.prev=14,lt.t0=lt.catch(4),(Ie=lt.t0 instanceof et?lt.t0.getCode():Ye.UNKNOWN)===Ye.NOT_SUPPORTED_H264&&(this.notSubscribeWithoutH264Supported_=!0),Ne=new et({code:Ie,message:rt({key:zb,data:{message:lt.t0.message,stream:j}})}),jt.logFailedEvent({userId:this.userId_,eventType:pI,error:Ne}),this.log_.error(Ne),Ne;case 22:case"end":return lt.stop()}},Q,this,[[4,14]])})),function(Q,j){return X.apply(this,arguments)})},{key:"unsubscribe",value:(K=D(regeneratorRuntime.mark(function Q(j){var le;return regeneratorRuntime.wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return this.log_.info("unsubscribe() => unsubscribe to [".concat(j.getUserId(),"] ").concat(j.getType()," stream")),fe.prev=1,le=j.getConnection(),fe.next=5,le.unsubscribe(j);case 5:this.subscriptionManager_&&this.subscriptionManager_.addUnsubscriptionRecord(j.getUserId(),j),Me.emit(Qu,{client:this,stream:j}),jt.logSuccessEvent({userId:this.userId_,eventType:gy}),fe.next=14;break;case 10:throw fe.prev=10,fe.t0=fe.catch(1),jt.logFailedEvent({userId:this.userId_,eventType:gy,error:fe.t0}),fe.t0;case 14:case"end":return fe.stop()}},Q,this,[[1,10]])})),function(Q){return K.apply(this,arguments)})},{key:"switchRole",value:(P=D(regeneratorRuntime.mark(function Q(j){return regeneratorRuntime.wrap(function(le){for(;;)switch(le.prev=le.next){case 0:if(this.role_!==j){le.next=2;break}return le.abrupt("return");case 2:if(j!=="audience"||!this.localStream_){le.next=5;break}return le.next=5,this.unpublish(this.localStream_);case 5:return this.log_.info("switchRole() => switch role to: "+j),le.next=8,this.doSwitchRole(j);case 8:case"end":return le.stop()}},Q,this)})),function(Q){return P.apply(this,arguments)})},{key:"doSwitchRole",value:function(Q){var j=this;return new Promise(function(le,fe){var Ie={role:Q==="anchor"?rd:Ua,privateMapKey:j.privateMapKey_};j.log_.info("switchRole signal data: "+JSON.stringify(Ie));var Ne=setTimeout(function(){j.log_.error("switchRole timeout observed"),j.signalChannel_.off(wr.SWITCH_ROLE_RES,lt),fe(new et({code:Ye.SWITCH_ROLE_FAILED,message:rt({key:Jb})}))},5e3),lt=function(Dt){clearTimeout(Ne);var Ut=Dt.data,St=Ut.code,_n=Ut.message;St===0?(j.role_=Q,le()):(j.log_.error("switchRole failed, errCode: ".concat(St,", errMsg: ").concat(_n)),fe(new et({code:Ye.SWITCH_ROLE_FAILED,message:rt({key:UI,data:{message:_n,code:St}})})))};j.signalChannel_.once(wr.SWITCH_ROLE_RES,lt),j.signalChannel_.send(ek,Ie)})}},{key:"on",value:function(Q,j,le){this.emitter_.on(Q,j,le)}},{key:"off",value:function(Q,j,le){Q==="*"?this.emitter_.removeAllListeners():this.emitter_.off(Q,j,le)}},{key:"getRemoteMutedState",value:function(){var Q=this,j=[];return this.mutedStates_.forEach(function(le,fe,Ie){var Ne=Q.connections_.get(fe);Ne&&j.push(m({userId:Ne.getUserId()},le))}),j}},{key:"getTransportStats",value:(G=D(regeneratorRuntime.mark(function Q(){var j,le,fe,Ie,Ne,lt,Dt;return regeneratorRuntime.wrap(function(Ut){for(;;)switch(Ut.prev=Ut.next){case 0:if(j={rtt:0,downlinksRTT:{}},!this.uplinkConnection_){Ut.next=6;break}return Ut.next=4,this.stats_.getSenderStats(this.uplinkConnection_);case 4:le=Ut.sent,j.rtt=le.rtt;case 6:fe=ke(this.connections_),Ut.prev=7,fe.s();case 9:if((Ie=fe.n()).done){Ut.next=17;break}return(Ne=Pe(Ie.value,2))[0],lt=Ne[1],Ut.next=13,this.stats_.getReceiverStats(lt);case 13:Dt=Ut.sent,j.downlinksRTT[Dt.userId]=Dt.rtt;case 15:Ut.next=9;break;case 17:Ut.next=22;break;case 19:Ut.prev=19,Ut.t0=Ut.catch(7),fe.e(Ut.t0);case 22:return Ut.prev=22,fe.f(),Ut.finish(22);case 25:return Ut.abrupt("return",j);case 26:case"end":return Ut.stop()}},Q,this,[[7,19,22,25]])})),function(){return G.apply(this,arguments)})},{key:"getLocalAudioStats",value:(F=D(regeneratorRuntime.mark(function Q(){var j,le;return regeneratorRuntime.wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:if((j={})[this.userId_]={bytesSent:0,packetsSent:0},!this.uplinkConnection_){fe.next=7;break}return fe.next=5,this.stats_.getSenderStats(this.uplinkConnection_);case 5:le=fe.sent,j[this.userId_]={bytesSent:le.audio.bytesSent,packetsSent:le.audio.packetsSent};case 7:return fe.abrupt("return",j);case 8:case"end":return fe.stop()}},Q,this)})),function(){return F.apply(this,arguments)})},{key:"getLocalVideoStats",value:(O=D(regeneratorRuntime.mark(function Q(){var j,le;return regeneratorRuntime.wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:if((j={})[this.userId_]={bytesSent:0,packetsSent:0,framesEncoded:0,framesSent:0,frameWidth:0,frameHeight:0},!this.uplinkConnection_){fe.next=7;break}return fe.next=5,this.stats_.getSenderStats(this.uplinkConnection_);case 5:le=fe.sent,j[this.userId_]={bytesSent:le.video.bytesSent,packetsSent:le.video.packetsSent,framesEncoded:le.video.framesEncoded,framesSent:le.video.framesSent,frameWidth:le.video.frameWidth,frameHeight:le.video.frameHeight};case 7:return fe.abrupt("return",j);case 8:case"end":return fe.stop()}},Q,this)})),function(){return O.apply(this,arguments)})},{key:"getRemoteAudioStats",value:(N=D(regeneratorRuntime.mark(function Q(){var j,le,fe,Ie,Ne,lt,Dt,Ut;return regeneratorRuntime.wrap(function(St){for(;;)switch(St.prev=St.next){case 0:j={},le=ke(this.connections_),St.prev=2,le.s();case 4:if((fe=le.n()).done){St.next=13;break}return(Ie=Pe(fe.value,2))[0],Ne=Ie[1],lt=Ne.getDelay(),Dt=lt.audioDelay,St.next=9,this.stats_.getReceiverStats(Ne);case 9:(Ut=St.sent).hasAudio&&(j[Ut.userId]={bytesReceived:Ut.audio.bytesReceived,packetsReceived:Ut.audio.packetsReceived,packetsLost:Ut.audio.packetsLost,end2EndDelay:Dt});case 11:St.next=4;break;case 13:St.next=18;break;case 15:St.prev=15,St.t0=St.catch(2),le.e(St.t0);case 18:return St.prev=18,le.f(),St.finish(18);case 21:return St.abrupt("return",j);case 22:case"end":return St.stop()}},Q,this,[[2,15,18,21]])})),function(){return N.apply(this,arguments)})},{key:"getRemoteVideoStats",value:(k=D(regeneratorRuntime.mark(function Q(){var j,le,fe,Ie,Ne,lt,Dt,Ut,St,_n=arguments;return regeneratorRuntime.wrap(function(Gt){for(;;)switch(Gt.prev=Gt.next){case 0:j=_n.length>0&&_n[0]!==void 0?_n[0]:kr,le={},fe=ke(this.connections_),Gt.prev=3,fe.s();case 5:if((Ie=fe.n()).done){Gt.next=15;break}return(Ne=Pe(Ie.value,2))[0],lt=Ne[1],Gt.next=9,this.stats_.getReceiverStats(lt);case 9:Dt=Gt.sent,Ut=lt.getDelay(),St=Ut.videoDelay,j===kr&&Dt.hasVideo&&(le[Dt.userId]={bytesReceived:Dt.video.bytesReceived,packetsReceived:Dt.video.packetsReceived,packetsLost:Dt.video.packetsLost,framesDecoded:Dt.video.framesDecoded,frameWidth:Dt.video.frameWidth,frameHeight:Dt.video.frameHeight,end2EndDelay:St}),j===Ni&&Dt.hasAuxiliary&&(le[Dt.userId]={bytesReceived:Dt.auxiliary.bytesReceived,packetsReceived:Dt.auxiliary.packetsReceived,packetsLost:Dt.auxiliary.packetsLost,framesDecoded:Dt.auxiliary.framesDecoded,frameWidth:Dt.auxiliary.frameWidth,frameHeight:Dt.auxiliary.frameHeight,end2EndDelay:St});case 13:Gt.next=5;break;case 15:Gt.next=20;break;case 17:Gt.prev=17,Gt.t0=Gt.catch(3),fe.e(Gt.t0);case 20:return Gt.prev=20,fe.f(),Gt.finish(20);case 23:return Gt.abrupt("return",le);case 24:case"end":return Gt.stop()}},Q,this,[[3,17,20,23]])})),function(){return k.apply(this,arguments)})},{key:"getSdpSemantics",value:function(){return this.sdpSemantics_}},{key:"getIceServers",value:function(){return this.turnServers_.length===0&&this.schedule_.iceServers?this.schedule_.iceServers:this.turnServers_}},{key:"getConnections",value:function(){return this.connections_}},{key:"getMutedStates",value:function(){return this.mutedStates_}},{key:"startHeartbeat",value:function(){this.heartbeat_===-1&&(this.log_.info("startHeartbeat..."),this.heartbeat_=ii.setInterval(this.doHeartbeat.bind(this),2e3))}},{key:"stopHeartbeat",value:function(){this.heartbeat_!==-1&&(this.log_.info("stopHeartbeat"),ii.clearInterval(this.heartbeat_),this.heartbeat_=-1,this.lastHeartBeatTime_=-1)}},{key:"doHeartbeat",value:(b=D(regeneratorRuntime.mark(function Q(){var j,le,fe,Ie,Ne;return regeneratorRuntime.wrap(function(lt){for(;;)switch(lt.prev=lt.next){case 0:return j=this.badCaseDetector_.getMonitorFreeze(),lt.next=3,this.stats_.getStatsReport({uplinkConnection:this.uplinkConnection_,downlinkConnections:this.connections_,freezeMap:j});case 3:if(le=lt.sent,Me.emit(Yy,{client:this,stats:le}),this.badCaseDetector_.resetMonitor(),this.signalChannel_){lt.next=8;break}return lt.abrupt("return");case 8:fe=this.signalChannel_.isConnected()?ck(this.userId_):[],Ie=m(m({str_sdk_version:this.version_,uint64_datetime:new Date().getTime(),msg_user_info:{str_identifier:this.userId_,uint64_tinyid:this.tinyId_},msg_device_info:{uint32_terminal_type:15,str_device_name:navigator.platform,str_os_version:"",uint32_net_type:Iy[this.networkType_]}},le),{},{msg_event_msg:fe}),this.signalChannel_.send(kR,Ie),Ne=Date.now(),this.lastHeartBeatTime_>0&&Ne-this.lastHeartBeatTime_>1e4&&this.log_.warn("heartbeat took ".concat(Ne-this.lastHeartBeatTime_)),this.lastHeartBeatTime_=Ne,!this.isRelayChanged_&&this.isRelayMaybeFailed()&&(this.reJoin(),this.isRelayChanged_=!0);case 15:case"end":return lt.stop()}},Q,this)})),function(){return b.apply(this,arguments)})},{key:"onRemoteStreamAdded",value:function(Q){var j=Q.content,le=j.userId,fe=j.tinyId,Ie=j.audio,Ne=j.bigVideo,lt=j.auxVideo,Dt=j.smallVideo;if(le!==null){this.userMap_.has(le)||(this.userMap_.set(le,new ow({userId:le,tinyId:fe,role:"anchor"})),this.emitter_.emit(Er.PEER_JOIN,{userId:le}));var Ut=this.connections_.get(fe);if(Ut){if(Ut.getIsReconnecting())return;this.log_.warn("duplicated stream-added observed, rebuild the connection"),Ut.close(),this.connections_.delete(fe)}var St={audio:Ie,video:Ne,auxiliary:lt,smallVideo:Dt};this.log_.info("remote peer [".concat(le,"] published stream. trackState: ").concat(JSON.stringify(St))),this.createDownlinkConnection({userId:le,tinyId:fe,trackState:St})}else this.log_.warn("received null userId on stream added")}},{key:"createDownlinkConnection",value:function(Q){var j=this,le=Q.userId,fe=Q.tinyId,Ie=Q.trackState,Ne=new Ex({userId:le,tinyId:fe,client:this,isUplink:!1,signalChannel:this.signalChannel_,autoSubscribe:this.autoSubscribe_,trackState:Ie,enableSEI:this.enableSEI_});this.connections_.set(fe,Ne),this.installDownlinkEvents(Ne,le,fe),this.autoSubscribe_?(Ne.initialize(),Ne.connect().catch(function(){!Ne.getMainStream()&&Ne.hasMainStream()&&j.initRemoteStream({type:kr,userId:le,downlinkConnection:Ne}),!Ne.getAuxStream()&&Ne.hasAuxStream()&&j.initRemoteStream({type:Ni,userId:le,downlinkConnection:Ne})})):(Ne.hasMainStream()&&this.initRemoteStream({type:kr,userId:le,downlinkConnection:Ne}),Ne.hasAuxStream()&&this.initRemoteStream({type:Ni,userId:le,downlinkConnection:Ne}))}},{key:"initRemoteStream",value:function(Q){var j=Q.type,le=Q.userId,fe=Q.downlinkConnection,Ie=new iw({type:j,userId:le,client:this});Ie.setConnection(fe),fe.setRemoteStream(j===kr?uo:Hu,Ie),Ie.setIsStreamAddedEventEmitted(!0),Me.emit(Pf,{client:this,stream:Ie}),this.emitter_.emit(Er.STREAM_ADDED,{stream:Ie})}},{key:"installDownlinkEvents",value:function(Q,j,le){var fe=this;Q.on(or.SEI_MESSAGE,function(Ie){fe.emitter_.emit(Er.SEI_MESSAGE,Ie)}),Q.on(or.STREAM_ADDED,function(Ie){Ie.stream.setIsStreamAddedEventEmitted(!0),Me.emit(Pf,{client:fe,stream:Ie.stream}),fe.emitter_.emit(Er.STREAM_ADDED,{stream:Ie.stream})}),Q.on(or.STREAM_REMOVED,function(Ie){fe.changeBigSmallRecords_.delete(Ie.stream.getUserId()),Ie.stream.stop(),Ie.stream.setIsStreamAddedEventEmitted(!1),fe.subscriptionManager_&&fe.subscriptionManager_.deleteAutoRecoveryFlag(Ie.stream.getUserId(),Ie.stream.getType()),Me.emit(mv,{client:fe,stream:Ie.stream}),fe.emitter_.emit(Er.STREAM_REMOVED,{stream:Ie.stream})}),Q.on(or.STREAM_UPDATED,function(Ie){Me.emit(bA,{client:fe,stream:Ie.stream}),fe.emitter_.emit(Er.STREAM_UPDATED,{stream:Ie.stream})}),Q.on(or.STREAM_SUBSCRIBED,function(Ie){Me.emit(Xu,{client:fe,stream:Ie.stream}),fe.emitter_.emit(Er.STREAM_SUBSCRIBED,{stream:Ie.stream})}),Q.on(or.ERROR,function(Ie){var Ne=Ie.getCode();Ne!==Ye.ICE_TRANSPORT_ERROR&&(Ne===Ye.DOWNLINK_RECONNECTION_FAILED&&fe.closeDownLink(le),fe.emitter_.emit(Er.ERROR,Ie))})}},{key:"onPeerJoin",value:function(Q){var j=Q.data.data,le=j.srcTinyId,fe=j.userId,Ie=j.role;this.userMap_.has(fe)||(this.userMap_.set(fe,new ow({userId:fe,tinyId:le,role:Ie})),this.emitter_.emit(Er.PEER_JOIN,{userId:fe}))}},{key:"onPeerLeave",value:function(Q){var j=Q.data.data,le=j.srcTinyId,fe=j.userId,Ie=j.reason,Ne=Ie===void 0?0:Ie;this.log_.info("peer leave [".concat(fe,"]: ").concat(fM[Ne])),this.cleanUser({userId:fe,tinyId:le})}},{key:"cleanUser",value:function(Q){var j=Q.userId,le=Q.tinyId;this.userMap_.delete(j),this.closeDownLink(le),this.emitter_.emit(Er.PEER_LEAVE,{userId:j})}},{key:"onPublishedUserList",value:function(Q){var j=this;try{var le=Q.data.userList.map(function(fe){return fe.userId});this.connections_.forEach(function(fe){var Ie=fe.getUserId(),Ne=fe.getTinyId();le.findIndex(function(lt){return lt===Ie})<0&&(j.log_.info("peer unpublished detected [".concat(Ie,"]")),j.closeDownLink(Ne))}),Q.data.userList.forEach(function(fe){var Ie=fe.userId,Ne=fe.srcTinyId,lt=fe.flag;if(Ie!==j.userId_){var Dt=!!(1&lt),Ut=!!(8&lt),St=!!(4&lt),_n=!!(2&lt),Gt=j.connections_.get(Ne);if(j.changeBigSmallRecords_.has(Ie)&&j.checkSubscribeBigSmallVideo(Gt,_n),Gt){var zn=Gt.getTrackState(),Un=zn.audio,on=zn.video,vr=zn.auxiliary,qi=zn.smallVideo;!on&&Dt&&Me.emit(ji,{client:j,tinyId:Ne,userId:Ie,action:Ku,kind:An}),!Un&&Ut&&Me.emit(ji,{client:j,tinyId:Ne,userId:Ie,action:Ku,kind:ln}),!vr&&St&&Me.emit(ji,{client:j,tinyId:Ne,userId:Ie,action:Ku,kind:Xi}),!qi&&_n&&Me.emit(ji,{client:j,tinyId:Ne,userId:Ie,action:Ku,kind:ju}),on&&!Dt&&Me.emit(ji,{client:j,tinyId:Ne,userId:Ie,action:id,kind:An}),Un&&!Ut&&Me.emit(ji,{client:j,tinyId:Ne,userId:Ie,action:id,kind:ln}),vr&&!St&&Me.emit(ji,{client:j,tinyId:Ne,userId:Ie,action:id,kind:Xi}),qi&&!_n&&Me.emit(ji,{client:j,tinyId:Ne,userId:Ie,action:id,kind:ju})}else j.log_.info("peer published detected [".concat(Ie,"]")),j.onRemoteStreamAdded({content:{audio:Ut,bigVideo:Dt,auxVideo:St,smallVideo:_n,userId:Ie,tinyId:Ne}})}})}catch{}}},{key:"onUpdateRemoteMuteStat",value:function(Q){var j=this,le=Q.data;(le&&le.userList||[]).forEach(function(fe){var Ie=fe.srcTinyId,Ne=fe.userId;if(Ie!==0&&Ie!==j.tinyId_){var lt=j.connections_.get(Ie);if(lt){var Dt=lt.getMainStream();if(Dt&&Dt.getIsStreamAddedEventEmitted()){var Ut=!!(1&fe.flag),St=!!(8&fe.flag),_n=!!(2&fe.flag),Gt=!!(64&fe.flag),zn=!!(16&fe.flag),Un=j.mutedStates_.get(Ie);if(Un===void 0)return j.mutedStates_.set(Ie,{hasAudio:St,hasVideo:Ut,hasSmall:_n,audioMuted:Gt,videoMuted:zn}),Ut?zn?j.emitter_.emit(Er.MUTE_VIDEO,{userId:Ne}):j.emitter_.emit(Er.UNMUTE_VIDEO,{userId:Ne}):j.emitter_.emit(Er.MUTE_VIDEO,{userId:Ne}),void(St?Gt?j.emitter_.emit(Er.MUTE_AUDIO,{userId:Ne}):j.emitter_.emit(Er.UNMUTE_AUDIO,{userId:Ne}):j.emitter_.emit(Er.MUTE_AUDIO,{userId:Ne}));var on=!Gt&&St;(!Un.audioMuted&&Un.hasAudio)!==on&&(on?j.emitter_.emit(Er.UNMUTE_AUDIO,{userId:Ne}):j.emitter_.emit(Er.MUTE_AUDIO,{userId:Ne}));var vr=!zn&&Ut;(!Un.videoMuted&&Un.hasVideo)!==vr&&(vr?j.emitter_.emit(Er.UNMUTE_VIDEO,{userId:Ne}):j.emitter_.emit(Er.MUTE_VIDEO,{userId:Ne})),j.mutedStates_.set(Ie,{hasAudio:St,hasVideo:Ut,hasSmall:_n,audioMuted:Gt,videoMuted:zn})}}else j.mutedStates_.delete(Ie)}})}},{key:"getEnv",value:function(){return this.env_}},{key:"getSubscriptionManager",value:function(){return this.subscriptionManager_}},{key:"startPublishCDNStream",value:(T=D(regeneratorRuntime.mark(function Q(){var j,le=arguments;return regeneratorRuntime.wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:if(j=le.length>0&&le[0]!==void 0?le[0]:{},this.log_.info("startPublishCDNStream params: ".concat(JSON.stringify(j),"; isJoined: ").concat(this.isJoined_,"; isPublished: ").concat(!!this.localStream_)),this.localStream_){fe.next=4;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:GI})});case 4:return fe.next=6,this.publishCDNManager_.startPublishTencentCDN(j);case 6:if(!(j.appId&&j.bizId&&j.url)){fe.next=9;break}return fe.next=9,this.publishCDNManager_.startPublishGivenCDN(j);case 9:case"end":return fe.stop()}},Q,this)})),function(){return T.apply(this,arguments)})},{key:"stopPublishCDNStream",value:(I=D(regeneratorRuntime.mark(function Q(){return regeneratorRuntime.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(this.publishCDNManager_.getIsPublishingTencentCDN()){j.next=2;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:Ef})});case 2:return this.log_.info("stopPublishCDNStream"),j.next=5,this.publishCDNManager_.stopPublishTencentCDN();case 5:if(!this.publishCDNManager_.getIsPublishingGivenCDN()){j.next=8;break}return j.next=8,this.publishCDNManager_.stopPublishGivenCDN();case 8:case"end":return j.stop()}},Q,this)})),function(){return I.apply(this,arguments)})},{key:"startMixTranscode",value:(y=D(regeneratorRuntime.mark(function Q(j){return regeneratorRuntime.wrap(function(le){for(;;)switch(le.prev=le.next){case 0:if(this.isJoined_&&this.mixTranscodeManager_){le.next=2;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:Qb})});case 2:return kt(j.mode)&&(j.mode=Sy.MANUAL),le.prev=3,this.log_.info("startMixTranscode with config ".concat(JSON.stringify(j))),jt.uploadEvent({log:"mix-transcode-mode:".concat(j.mode),userId:this.userId_}),le.next=8,this.mixTranscodeManager_.startMixTranscode(j);case 8:jt.logSuccessEvent({userId:this.userId_,eventType:TI}),le.next=15;break;case 11:throw le.prev=11,le.t0=le.catch(3),jt.logFailedEvent({userId:this.userId_,eventType:TI,error:le.t0}),le.t0;case 15:case"end":return le.stop()}},Q,this,[[3,11]])})),function(Q){return y.apply(this,arguments)})},{key:"stopMixTranscode",value:(f=D(regeneratorRuntime.mark(function Q(){return regeneratorRuntime.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(this.isJoined_&&this.mixTranscodeManager_){j.next=2;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:wM})});case 2:return j.prev=2,j.next=5,this.mixTranscodeManager_.stopMixTranscode();case 5:jt.logSuccessEvent({userId:this.userId_,eventType:MI}),j.next=12;break;case 8:throw j.prev=8,j.t0=j.catch(2),jt.logFailedEvent({userId:this.userId_,eventType:MI,error:j.t0}),j.t0;case 12:case"end":return j.stop()}},Q,this,[[2,8]])})),function(){return f.apply(this,arguments)})},{key:"getSystemResult",value:function(){return this.checkSystemResult_}},{key:"enableAudioVolumeEvaluation",value:function(){var Q=this,j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2e3,le=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!ha(j))throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:DM})});if(this.log_.info("enableAudioVolumeEvaluation with interval: "+j),j<=0)return this.enableAudioVolumeEvaluation_=!1,ii.clearInterval(this.audioVolumeIntervalId_),void(this.audioVolumeIntervalId_=null);j=Math.floor(Math.max(j,16)),Me.emit(Qy,{interval:j}),this.audioVolumeIntervalId_&&(ii.clearInterval(this.audioVolumeIntervalId_),this.audioVolumeIntervalId_=null),this.enableAudioVolumeEvaluation_=!0,this.audioVolumeIntervalId_=ii.setInterval(function(){var fe=[];if(Q.localStream_){var Ie=Math.floor(100*Q.localStream_.getAudioLevel());fe.push({userId:Q.userId_,audioVolume:Ie,stream:Q.localStream_})}Q.connections_.forEach(function(Ne){var lt=Ne.getSubscribedMainStream();if(lt){var Dt=Math.floor(100*lt.getAudioLevel());fe.push({userId:Ne.getUserId(),audioVolume:Dt,stream:lt})}}),Q.emitter_.emit(Er.AUDIO_VOLUME,{result:fe})},j,le)}},{key:"callExperimentalAPI",value:function(Q,j){return Px.call(Q,m({client:this},j))}},{key:"setProperty",value:function(Q,j){var le="".concat(Q,"_");kt(this[le])||(this[le]=j)}},{key:"uploadAllCallStats",value:function(){var Q=this;this.callDurationCalculator_.getDurationMap().forEach(function(j,le){var fe={userId:j.userId,type:j.type,duration:Q.callDurationCalculator_.getDuration(le,An),dataFreeze:Q.badCaseDetector_.getDataFreezeDuration(le).dataFreeze,renderFreeze:Q.badCaseDetector_.getRenderFreezeDuration(le).renderFreeze};jt.uploadEvent({log:"callStats-"+JSON.stringify(fe),userId:Q.userId_})}),this.badCaseDetector_.stop(),this.callDurationCalculator_.reset()}},{key:"enableSmallStream",value:(v=D(regeneratorRuntime.mark(function Q(){return regeneratorRuntime.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(!this.isPublished()&&!this.isPublishing_){j.next=2;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:OM})});case 2:if(!nC()){j.next=7;break}this.setIsEnableSmallStream(!0),this.log_.info("SmallStream successfully enabled"),j.next=8;break;case 7:throw new et({code:Ye.INVALID_OPERATION,message:rt({key:Mf})});case 8:case"end":return j.stop()}},Q,this)})),function(){return v.apply(this,arguments)})},{key:"disableSmallStream",value:(p=D(regeneratorRuntime.mark(function Q(){return regeneratorRuntime.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(!this.isPublished()&&!this.isPublishing_){j.next=2;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:Zb})});case 2:this.setIsEnableSmallStream(!1),this.log_.info("SmallStream successfully disabled");case 4:case"end":return j.stop()}},Q,this)})),function(){return p.apply(this,arguments)})},{key:"setSmallStreamProfile",value:function(Q){var j=this;Q&&Q.framerate&&(Q.frameRate=Q.framerate),Object.keys(this.smallStreamConfig_).forEach(function(Dt){Q[Dt]&&(j.smallStreamConfig_[Dt]=Q[Dt])}),this.log_.info("setSmallStreamProfile: bitrate=".concat(this.smallStreamConfig_.bitrate,", frameRate=").concat(this.smallStreamConfig_.frameRate,", height=").concat(this.smallStreamConfig_.height,", width=").concat(this.smallStreamConfig_.width));var le=this.smallStreamConfig_,fe=le.width,Ie=le.height,Ne=le.bitrate,lt=le.frameRate;if(fe<0||Ie<0||Ne<0||lt<0)throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:FI})})}},{key:"setRemoteVideoStreamType",value:(d=D(regeneratorRuntime.mark(function Q(j,le){return regeneratorRuntime.wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:fe.t0=le,fe.next=fe.t0==="big"||fe.t0==="small"?3:6;break;case 3:return fe.next=5,this.changeVideoType(j,le);case 5:case 6:return fe.abrupt("break",7);case 7:case"end":return fe.stop()}},Q,this)})),function(Q,j){return d.apply(this,arguments)})},{key:"changeVideoType",value:(u=D(regeneratorRuntime.mark(function Q(j,le){var fe,Ie;return regeneratorRuntime.wrap(function(Ne){for(;;)switch(Ne.prev=Ne.next){case 0:if(j instanceof iw){Ne.next=2;break}throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:NM})});case 2:if(j.getConnection()){Ne.next=4;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:xI})});case 4:fe=j.getUserId(),Ie={stream:j,options:{video:le==="big",smallVideo:le==="small"},isSubscribing:!1,reSubscribeCount:10},this.changeBigSmallRecords_.set(fe,Ie),this.log_.info("change video type: streamType=".concat(j.getType(),", set ").concat(le));case 9:case"end":return Ne.stop()}},Q,this)})),function(Q,j){return u.apply(this,arguments)})},{key:"checkSubscribeBigSmallVideo",value:(c=D(regeneratorRuntime.mark(function Q(j,le){var fe,Ie,Ne,lt,Dt,Ut,St,_n,Gt,zn,Un;return regeneratorRuntime.wrap(function(on){for(;;)switch(on.prev=on.next){case 0:if(j.isBigStreamSubscribed||j.isSmallStreamSubscribed){on.next=2;break}return on.abrupt("return");case 2:if(fe=j.getUserId(),Ie=this.changeBigSmallRecords_.get(fe)||{},Ne=j.getSubscribeState(),lt=Ne.video,Dt=Ne.smallVideo,Ut=Ie.stream,St=Ie.options,_n=Ie.isSubscribing,Gt=Ie.reSubscribeCount,!(St.video&&lt||St.smallVideo&&Dt&&le)){on.next=8;break}return on.abrupt("return");case 8:if(!_n){on.next=10;break}return on.abrupt("return");case 10:if(!(le&&j.isBigStreamSubscribed||j.isSmallStreamSubscribed)){on.next=29;break}if(on.prev=11,!(St&&Ut&&!_n&&Gt>=1)){on.next=23;break}return this.log_.info("subscribe small video: userId=".concat(fe)),Ie.isSubscribing=!0,Ie.reSubscribeCount=Gt-1,zn={video:St.video,smallVideo:St.smallVideo},Un=Ut.getConnection(),!le&&Un.isSmallStreamSubscribed&&(zn={video:!0,smallVideo:!1}),on.next=21,Un==null?void 0:Un.subscribe(Ut,zn);case 21:Ie.isSubscribing=!1,this.log_.info("changeType ".concat(fe," ").concat(St.smallVideo?"small":"big"," video success, count ").concat(11-Gt));case 23:on.next=29;break;case 25:on.prev=25,on.t0=on.catch(11),this.log_.info("resubscribe ".concat(fe," ").concat(St.smallVideo?"small":"big"," video failed, count ").concat(11-Gt)),Gt===0&&(Ie.isSubscribing=!1);case 29:case"end":return on.stop()}},Q,this,[[11,25]])})),function(Q,j){return c.apply(this,arguments)})},{key:"setIsEnableSmallStream",value:function(Q){this.isEnableSmallStream_=Q}},{key:"getIsEnableSmallStream",value:function(){return this.isEnableSmallStream_}},{key:"smallStreamConfig",get:function(){return this.smallStreamConfig_}},{key:"isPublished",value:function(){return!!this.localStream_}},{key:"getUplinkConnection",value:function(){return this.uplinkConnection_}},{key:"getLocalStream",value:function(){return this.localStream_}},{key:"getMode",value:function(){return this.mode_}},{key:"getBadCaseDetector",value:function(){return this.badCaseDetector_}},{key:"getCallDurationCalculator",value:function(){return this.callDurationCalculator_}},{key:"getIsJoined",value:function(){return this.isJoined_}},{key:"getAllConnections",value:function(){var Q=de(this.connections_.values());return this.uplinkConnection_&&Q.push(this.uplinkConnection_),Q}},{key:"isRelayMaybeFailed",value:function(){var Q=this.getAllConnections();if(Q.length===0)return!1;for(var j=0;j<Q.length;j++)if(Q[j].getReconnectionCount()<6)return!1;return!0}},{key:"getUseStringRoomId",value:function(){return this.useStringRoomId_}},{key:"checkConnectionsToReconnect",value:function(){var Q=this;this.getAllConnections().forEach(function(j){if(!j.getIsReconnecting()){var le=j.getPeerConnection();le&&le.connectionState===py&&(Q.log_.warn("[".concat(j.getUserId(),"] pc is closed but not reconnect")),j.startReconnection())}})}},{key:"getEnableAutoPlayDialog",value:function(){return this.enableAutoPlayDialog_}},{key:"sendSEIMessage",value:function(Q,j){this.uplinkConnection_.sendSEI(Q,j)}}]),r}()).prototype,"join",[fD,gD],Object.getOwnPropertyDescriptor(Or.prototype,"join"),Or.prototype),De(Or.prototype,"leave",[mD],Object.getOwnPropertyDescriptor(Or.prototype,"leave"),Or.prototype),De(Or.prototype,"publish",[vD,_D],Object.getOwnPropertyDescriptor(Or.prototype,"publish"),Or.prototype),De(Or.prototype,"unpublish",[yD,SD],Object.getOwnPropertyDescriptor(Or.prototype,"unpublish"),Or.prototype),De(Or.prototype,"subscribe",[ID],Object.getOwnPropertyDescriptor(Or.prototype,"subscribe"),Or.prototype),De(Or.prototype,"unsubscribe",[ED],Object.getOwnPropertyDescriptor(Or.prototype,"unsubscribe"),Or.prototype),De(Or.prototype,"switchRole",[TD,MD],Object.getOwnPropertyDescriptor(Or.prototype,"switchRole"),Or.prototype),De(Or.prototype,"startPublishCDNStream",[RD],Object.getOwnPropertyDescriptor(Or.prototype,"startPublishCDNStream"),Or.prototype),De(Or.prototype,"startMixTranscode",[CD],Object.getOwnPropertyDescriptor(Or.prototype,"startMixTranscode"),Or.prototype),De(Or.prototype,"sendSEIMessage",[bD,AD],Object.getOwnPropertyDescriptor(Or.prototype,"sendSEIMessage"),Or.prototype),Or),uw=Gf({retryFunction:function(){var r=D(regeneratorRuntime.mark(function c(u){var d,p,v;return regeneratorRuntime.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!Bf()){f.next=2;break}return f.abrupt("return");case 2:return f.next=4,Ux(u);case 4:if(d=f.sent,Bt.info("getUserMedia with constraints: "+JSON.stringify(d)),!d.audio){f.next=11;break}return f.next=9,Qr.getMicrophones();case 9:p=f.sent,Bt.info("microphones: ".concat(JSON.stringify(p)));case 11:if(!d.video){f.next=16;break}return f.next=14,Qr.getCameras();case 14:v=f.sent,Bt.info("cameras: ".concat(JSON.stringify(v)));case 16:return f.prev=16,f.next=19,navigator.mediaDevices.getUserMedia(d);case 19:return f.abrupt("return",f.sent);case 22:if(f.prev=22,f.t0=f.catch(16),f.t0.name!=="NotFoundError"){f.next=29;break}if(!v||v.length!==0){f.next=27;break}throw new et({code:Ye.DEVICE_NOT_FOUND,message:rt({key:$M})});case 27:if(!p||p.length!==0){f.next=29;break}throw new et({code:Ye.DEVICE_NOT_FOUND,message:rt({key:vA})});case 29:throw new et({code:Ye.INITIALIZE_FAILED,name:f.t0.name,message:f.t0.message,constraint:f.t0.constraint});case 30:case"end":return f.stop()}},c,null,[[16,22]])}));return function(c){return r.apply(this,arguments)}}(),settings:{retries:3,timeout:500},onError:function(r,c,u){r.name==="NotReadableError"?c():u(r)},onRetrying:function(r){Bt.warn("getUserMedia NotReadableError observed, retrying [".concat(r,"/3]"))}});function Ux(r){return kD.apply(this,arguments)}function kD(){return(kD=D(regeneratorRuntime.mark(function r(c){var u,d,p,v,f,y;return regeneratorRuntime.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(u={echoCancellation:c.echoCancellation,autoGainControl:c.autoGainControl,noiseSuppression:c.noiseSuppression},c.audio){I.next=5;break}u=!1,I.next=15;break;case 5:if(hd(c.microphoneId)){I.next=9;break}u=m({deviceId:{exact:c.microphoneId},sampleRate:c.sampleRate,channelCount:c.channelCount},u),I.next=15;break;case 9:return u=m({sampleRate:c.sampleRate,channelCount:c.channelCount},u),I.next=12,Qr.getMicrophones();case 12:d=I.sent,(p=d.filter(function(T){return T.deviceId.length>0})).length>0&&(u.deviceId={exact:p[0].deviceId});case 15:return v={},f={ideal:c.width,max:c.width},y={ideal:c.height,max:c.height},v=!kt(c.facingMode)&&c.video?{facingMode:c.facingMode,width:f,height:y,frameRate:c.frameRate}:!hd(c.cameraId)&&c.video?{deviceId:{exact:c.cameraId},width:f,height:y,frameRate:c.frameRate}:!!c.video&&(!!kt(c.width)||{width:f,height:y,frameRate:c.frameRate}),I.abrupt("return",{audio:u,video:v});case 20:case"end":return I.stop()}},r)}))).apply(this,arguments)}var Gx=function(){var r=D(regeneratorRuntime.mark(function c(u){var d,p,v,f,y,I,T,b,k;return regeneratorRuntime.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(!Bf()){N.next=2;break}return N.abrupt("return");case 2:if(d=null,!(gf&&tI<74||Th)){N.next=27;break}return p=lw(u),Bt.info("getDisplayMedia with constraints: "+JSON.stringify(p)),N.next=8,navigator.mediaDevices.getDisplayMedia(p);case 8:if(v=N.sent,!u.screenAudio){N.next=14;break}return Bt.warn("Your browser not support capture system audio"),N.abrupt("return",v);case 14:if(!u.audio){N.next=24;break}return f=wD(u),Bt.info("getUserMedia with constraints: "+JSON.stringify(f)),N.next=19,navigator.mediaDevices.getUserMedia(f);case 19:return d=N.sent,v.addTrack(d.getAudioTracks()[0]),N.abrupt("return",v);case 24:return N.abrupt("return",v);case 25:N.next=53;break;case 27:if(!u.screenAudio){N.next=37;break}return u.audioConstraints={echoCancellation:!0,noiseSuppression:!0,sampleRate:44100},y=lw(u),Bt.info("getDisplayMedia with constraints: "+JSON.stringify(y)),N.next=33,navigator.mediaDevices.getDisplayMedia(y);case 33:return I=N.sent,N.abrupt("return",I);case 37:return T=lw(u),Bt.info("getDisplayMedia with constraints: "+JSON.stringify(T)),N.next=41,navigator.mediaDevices.getDisplayMedia(T);case 41:if(b=N.sent,!u.audio){N.next=52;break}return k=wD(u),Bt.info("getUserMedia with constraints: "+JSON.stringify(k)),N.next=47,navigator.mediaDevices.getUserMedia(k);case 47:return d=N.sent,b.addTrack(d.getAudioTracks()[0]),N.abrupt("return",b);case 52:return N.abrupt("return",b);case 53:case"end":return N.stop()}},c)}));return function(c){return r.apply(this,arguments)}}();function wD(r){var c={echoCancellation:r.echoCancellation,autoGainControl:r.autoGainControl,noiseSuppression:r.noiseSuppression,sampleRate:r.sampleRate,channelCount:r.channelCount};return kt(r.microphoneId)||(c.deviceId={exact:r.microphoneId}),{audio:c,video:!1}}function lw(r){var c={},u={width:{ideal:r.width,max:r.width},height:{ideal:r.height,max:r.height},frameRate:r.frameRate};return kt(r.screenSource)||(u.displaySurface=r.screenSource),c.video=u,kt(r.audioConstraints)||(c.audio=r.audioConstraints),c}var DD,OD,wv,ND,LD,Dv,dw=new Map([["120p",{width:160,height:120,frameRate:15,bitrate:200}],["120p_2",{width:160,height:120,frameRate:15,bitrate:100}],["180p",{width:320,height:180,frameRate:15,bitrate:350}],["180p_2",{width:320,height:180,frameRate:15,bitrate:150}],["240p",{width:320,height:240,frameRate:15,bitrate:400}],["240p_2",{width:320,height:240,frameRate:15,bitrate:200}],["360p",{width:640,height:360,frameRate:15,bitrate:800}],["360p_2",{width:640,height:360,frameRate:15,bitrate:400}],["480p",{width:640,height:480,frameRate:15,bitrate:900}],["480p_2",{width:640,height:480,frameRate:15,bitrate:500}],["720p",{width:1280,height:720,frameRate:15,bitrate:1500}],["1080p",{width:1920,height:1080,frameRate:15,bitrate:2e3}],["1440p",{width:2560,height:1440,frameRate:30,bitrate:4860}],["4K",{width:3840,height:2160,frameRate:30,bitrate:9e3}]]),hw=new Map([["480p",{width:640,height:480,frameRate:5,bitrate:900}],["480p_2",{width:640,height:480,frameRate:30,bitrate:1e3}],["720p",{width:1280,height:720,frameRate:5,bitrate:1200}],["720p_2",{width:1280,height:720,frameRate:30,bitrate:3e3}],["1080p",{width:1920,height:1080,frameRate:5,bitrate:1600}],["1080p_2",{width:1920,height:1080,frameRate:30,bitrate:4e3}]]),PD=new Map([["standard",{sampleRate:48e3,channelCount:1,bitrate:40}],["standard-stereo",{sampleRate:48e3,channelCount:2,bitrate:64}],["high",{sampleRate:48e3,channelCount:1,bitrate:128}],["high-stereo",{sampleRate:48e3,channelCount:2,bitrate:192}]]),Fx=(DD=yd.apply(void 0,de(Ts.LOCAL_STREAM.switchDevice)),OD=BC(Ts.LOCAL_STREAM.setAudioCaptureVolume),De((wv=function(r){re(N,r);var c,u,d,p,v,f,y,I,T,b,k=Xe(N);function N(O){var F;x(this,N);var G=m(m({},O),{isRemote:!1,type:"local"});return(F=k.call(this,G)).name_=Ey,F.client_=null,F.video_=O.video,F.audio_=O.audio,F.cameraId_=O.cameraId,F.cameraGroupId_="",F.facingMode_=O.facingMode,F.microphoneId_=O.microphoneId,F.microphoneGroupId_="",F.videoSource_=O.videoSource,F.audioSource_=O.audioSource,F.screen_=O.screen,F.screenSource_=O.screenSource,F.screenAudio_=O.screenAudio,F.audioProfile_={echoCancellation:!!kt(O.echoCancellation)||O.echoCancellation,autoGainControl:!!kt(O.autoGainControl)||O.autoGainControl,noiseSuppression:!!kt(O.noiseSuppression)||O.noiseSuppression,sampleRate:48e3,channelCount:1,bitrate:40},F.videoProfile_=dw.get("480p_2"),F.screenProfile_=hw.get("1080p"),F.videoSetting_=null,F.muteState_={video:!1,audio:!1,auxVideo:!1},F.beautyStatus_=!1,F.recoverCaptureCount_=0,F.initState(),F.canvas_=null,F.canvasInterval_=-1,F.gain_={audioTrack:null,source:null,gainNode:null},F.captureVolume_=100,F.log_.info("stream created: "+F.id_),F}return B(N,[{key:"initState",value:function(){this.isAddingTrack_=!1,this.isRemovingTrack_=!1,this.setIsReadyToPublish(!1),this.setPublishState(wI)}},{key:"installEvents",value:function(){Be(ie(N.prototype),"installEvents",this).call(this),Me.on(sE,this.onStreamPublished,this),Me.on(dE,this.onVideoTrackStopped,this),Me.on(Gh,this.onVideoTrackStopped,this),Me.on(pE,this.onAudioTrackStopped,this),Me.on(hE,this.onAudioTrackStopped,this)}},{key:"uninstallEvents",value:function(){Be(ie(N.prototype),"uninstallEvents",this).call(this),Me.off(sE,this.onStreamPublished,this),Me.off(dE,this.onVideoTrackStopped,this),Me.off(Gh,this.onVideoTrackStopped,this),Me.off(pE,this.onAudioTrackStopped,this),Me.off(hE,this.onAudioTrackStopped,this)}},{key:"initialize",value:function(){var O=this;return new Promise(function(F,G){if(jf())G(new et({code:Ye.INVALID_OPERATION,message:rt({key:qM})}));else{if(kt(O.audio_)){var P=new MediaStream;return kt(O.audioSource_)||(P.addTrack(O.audioSource_),O.updateAudioPlayingState(!0)),kt(O.videoSource_)||(P.addTrack(O.videoSource_),O.updateVideoPlayingState(!0)),O.setMediaStream(P),jt.logSuccessEvent({userId:O.client_?O.client_.getUserId():O.userId_,eventType:_f,kind:"custom"}),O.setIsReadyToPublish(!0),F()}O.screen_?(O.log_.info("initialize stream audio: "+O.audio_+" screenAudio: "+O.screenAudio_+" screen: "+O.screen_),Gx({audio:O.audio_,screenAudio:O.screenAudio_,microphoneId:O.microphoneId_,screenSource:O.screenSource_,width:O.screenProfile_.width,height:O.screenProfile_.height,frameRate:O.screenProfile_.frameRate,sampleRate:O.audioProfile_.sampleRate,channelCount:O.audioProfile_.channelCount,autoGainControl:O.audioProfile_.autoGainControl,noiseSuppression:O.audioProfile_.noiseSuppression,echoCancellation:O.audioProfile_.echoCancellation}).then(function(K){O.setMediaStream(K),O.updateAudioPlayingState(O.audio_||O.screenAudio_),O.updateVideoPlayingState(!0);var X=O.getVideoTrack();return O.listenForScreenSharingStopped(X),O.setVideoContentHint(WT),O.updateDeviceIdInUse(),O.setIsReadyToPublish(!0),O.log_.info(JSON.stringify(X.getSettings())),jt.logSuccessEvent({userId:O.client_?O.client_.getUserId():O.userId_,eventType:_f,kind:"getDisplayMedia"}),F()}).catch(function(K){jt.logFailedEvent({userId:O.client_?O.client_.getUserId():O.userId_,eventType:_f,kind:"getDisplayMedia",error:K}),O.log_.error("getDisplayMedia error observed "+K),G(K instanceof et?K:new et({code:Ye.INITIALIZE_FAILED,name:K.name,message:K.message}))})):(Me.emit(cE,{stream:O,audio:O.audio_,video:O.video_}),O.log_.info("initialize stream audio: "+O.audio_+" video: "+O.video_),uw({audio:O.audio_,video:O.video_,facingMode:O.facingMode_,cameraId:O.cameraId_,microphoneId:O.microphoneId_,width:O.videoProfile_.width,height:O.videoProfile_.height,frameRate:O.videoProfile_.frameRate,sampleRate:O.audioProfile_.sampleRate,channelCount:O.audioProfile_.channelCount,autoGainControl:O.audioProfile_.autoGainControl,noiseSuppression:O.audioProfile_.noiseSuppression,echoCancellation:O.audioProfile_.echoCancellation}).then(function(K){Me.emit(xf,{stream:O,audio:O.audio_,video:O.video_}),O.setMediaStream(K);var X=O.getVideoTrack();return X&&(qf&&(O.videoSetting_=X.getSettings()),vk&&O.log_.info("video capabilities: "+JSON.stringify(X.getCapabilities()))),O.updateAudioPlayingState(O.audio_),O.updateVideoPlayingState(O.video_),O.updateDeviceIdInUse(),O.log_.info("gotStream hasAudio: "+O.hasAudio()+" hasVideo: "+O.hasVideo()),O.setIsReadyToPublish(!0),jt.logSuccessEvent({userId:O.client_?O.client_.getUserId():O.userId_,eventType:_f,kind:"getUserMedia"}),F()}).catch(function(K){Me.emit(uE,{stream:O,audio:O.audio_,video:O.video_,error:K}),jt.logFailedEvent({userId:O.client_?O.client_.getUserId():O.userId_,eventType:_f,kind:"getUserMedia",error:K}),O.log_.error("getUserMedia error observed "+K),G(K)}))}})}},{key:"listenForScreenSharingStopped",value:function(O){var F=this;O.addEventListener("ended",function(G){F.log_.info("screen sharing was stopped because the video track is ended"),F.emitter_.emit(_k)})}},{key:"muteAudio",value:function(){var O=Be(ie(N.prototype),"muteAudio",this).call(this);return O&&(this.log_.info("localStream mute audio"),this.sendMutedFlag(ln,!0)),O}},{key:"muteVideo",value:function(){var O=Be(ie(N.prototype),"muteVideo",this).call(this);return O&&(this.log_.info("localStream mute video"),this.sendMutedFlag(An,!0)),O}},{key:"unmuteAudio",value:function(){var O=Be(ie(N.prototype),"unmuteAudio",this).call(this);return O&&(this.log_.info("localStream unmute audio"),this.sendMutedFlag(ln,!1)),O}},{key:"unmuteVideo",value:function(){var O=Be(ie(N.prototype),"unmuteVideo",this).call(this);return O&&(this.log_.info("localStream unmute video"),this.sendMutedFlag(An,!1)),O}},{key:"sendMutedFlag",value:function(O,F){this.setMuteState(O,F);var G=this.getConnection();if(G){G.sendMutedFlag(this.muteState_);var P=G.getUserId(),K=G.getTinyId(),X="".concat(F?Tt:Pt," local ").concat(O," track");Eo(P,{eventId:O===ln?F?jh:tk:F?NR:rS,eventDesc:X,timestamp:Yi(),userId:P,tinyId:K})}}},{key:"setMuteState",value:function(O,F){this.muteState_[O]=F,this.log_.info("set ".concat(O," muted state: [").concat(F?"mute":"unmute","]"))}},{key:"setAudioProfile",value:function(O){var F;R(O)==="object"?F=O:(F=PD.get(O))===void 0&&(F=PD.get("standard")),this.log_.info("setAudioProfile: "+JSON.stringify(F)),this.audioProfile_=m(m({},this.audioProfile_),F)}},{key:"setVideoProfile",value:(b=D(regeneratorRuntime.mark(function O(F){var G,P,K;return regeneratorRuntime.wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(!this.connection_||DE()){X.next=2;break}throw new et({code:Ye.NOT_SUPPORTED,message:rt({key:fA})});case 2:if(sd(F)?G=m(m({},this.videoProfile_),F):yo(F)&&(G=dw.get(F),kt(G)&&(G=dw.get("480p_2"))),G&&G.width*G.height>921600&&Mh&&(G.width=1280,G.height=720,this.log_.warn("reset to 1280 * 720 on iOS 13~14")),this.log_.info("setVideoProfile "+JSON.stringify(G)),!(P=this.getVideoTrack())){X.next=9;break}return X.next=9,P.applyConstraints(G);case 9:if(K=this.videoProfile_.bitrate!==G.bitrate,this.videoProfile_=G,!K||!this.connection_){X.next=15;break}return X.next=14,this.connection_.setBandwidth(G.bitrate,An);case 14:this.connection_.updateMediaSettings(this.mediaStream_);case 15:case"end":return X.stop()}},O,this)})),function(O){return b.apply(this,arguments)})},{key:"getVideoBitrate",value:function(){return this.screen_?this.screenProfile_.bitrate:this.videoProfile_.bitrate}},{key:"getAudioBitrate",value:function(){return this.audioProfile_.bitrate}},{key:"setScreenProfile",value:function(O){var F=O;yo(O)&&(F=hw.get(O)||hw.get("1080p")),this.log_.info("setScreenProfile "+JSON.stringify(O)),this.screenProfile_=F}},{key:"getVideoProfile",value:function(){return this.screen_?this.screenProfile_:this.videoProfile_}},{key:"getAudioProfile",value:function(){return this.audioProfile_}},{key:"setVideoContentHint",value:function(O){var F=this.getVideoTrack();F&&"contentHint"in F&&(this.log_.info("set video track contentHint to: "+O),F.contentHint=O,F.contentHint!==O&&this.log_.warn("Invalid video track contentHint: "+O))}},{key:"switchDevice",value:(T=D(regeneratorRuntime.mark(function O(F,G){var P,K,X,oe,Ce,Ve,je,Re,Oe,qe,$e,Tn,Q,j,le,fe,Ie;return regeneratorRuntime.wrap(function(Ne){for(;;)switch(Ne.prev=Ne.next){case 0:if(!(P=F===ln)){Ne.next=8;break}if(this.microphoneId_!==G){Ne.next=4;break}return Ne.abrupt("return");case 4:this.microphoneId_=G,this.audio_=!0,Ne.next=12;break;case 8:if(this.cameraId_!==G){Ne.next=10;break}return Ne.abrupt("return");case 10:G===bh||G===rI?this.facingMode_=G:this.cameraId_=G,this.video_=!0;case 12:if(this.getMediaStream()){Ne.next=14;break}return Ne.abrupt("return");case 14:return this.setIsReadyToPublish(!1),this.log_.info("switchDevice "+F+" to: "+G),P||((K=this.getVideoTrack())&&K.stop(),uy&&(X=this.getAudioTrack())&&(this.log_.info("stop audio track first in huawei env"),X.stop())),P&&(oe=this.getAudioTrack(),Ce=this.getMicrophoneTrackMixed(),oe&&oe.stop(),Ce&&Ce.stop()),Ne.next=20,uw({audio:this.audio_&&F===ln||uy,video:this.video_&&F===An,facingMode:G===bh||G===rI?G:void 0,cameraId:this.cameraId_,microphoneId:this.microphoneId_,width:this.videoProfile_.width,height:this.videoProfile_.height,frameRate:this.videoProfile_.frameRate,sampleRate:this.audioProfile_.sampleRate,channelCount:this.audioProfile_.channelCount});case 20:if(Ve=Ne.sent,je=null,!P){Ne.next=27;break}(Re=Ve.getAudioTracks()[0])&&this.isAudioTrackMixed()?(Oe=this.getAudioTrack(),qe=Qr.AudioMixerPlugin.getAudioTrackMap(),$e=Qr.AudioMixerPlugin.mix({targetTrack:Re,sourceList:qe.get(Oe.id).sourceList,trackList:qe.get(Oe.id).trackList}),je=$e):je=Re,Ne.next=36;break;case 27:if(!(je=Ve.getVideoTracks()[0])||!this.isVideoTrackBeautified()){Ne.next=32;break}return Ne.next=31,this.generateBeautyTrack(je);case 31:je=Ne.sent;case 32:if(!(Tn=Ve.getAudioTracks()[0])||!uy){Ne.next=36;break}return Ne.next=36,this.replaceTrack_(Tn);case 36:return Ne.next=38,this.replaceTrack_(je);case 38:this.updateDeviceIdInUse(),(Q=this.getConnection())&&(j=Q.getUserId(),le=Q.getTinyId(),fe=PR,Ie="switch camera",P&&(fe=xR,Ie="switch microphone"),Eo(j,{eventId:fe,eventDesc:Ie,timestamp:Yi(),userId:j,tinyId:le})),this.log_.info("switch ".concat(P?"microphone":"camera"," success ")),this.setIsReadyToPublish(!0);case 43:case"end":return Ne.stop()}},O,this)})),function(O,F){return T.apply(this,arguments)})},{key:"addTrack",value:(I=D(regeneratorRuntime.mark(function O(F){var G,P,K;return regeneratorRuntime.wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(!this.isAddingTrack_){X.next=2;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:tA})});case 2:if(!this.isRemovingTrack_){X.next=4;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:PM})});case 4:if(this.publishState_!==yf){X.next=6;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:nA})});case 6:if(G=this.getMediaStream()){X.next=9;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:xM})});case 9:if(!(F.kind===ln&&G.getAudioTracks().length>0||F.kind===An&&G.getVideoTracks().length>0)){X.next=11;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:rA})});case 11:if(F.kind===An&&qf&&(P=F.getSettings(),!this.videoSetting_||P.width===this.videoSetting_.width&&P.height===this.videoSetting_.height||this.log_.warn("video resolution of the track (".concat(P.width," x ").concat(P.height,") shall be kept the same as the previous: ").concat(this.videoSetting_.width," x ").concat(this.videoSetting_.height,". It may cause abnormal Cloud Recording."))),X.prev=12,this.isAddingTrack_=!0,this.keepMuteState(F),G.addTrack(F),!(K=this.getConnection())){X.next=20;break}return X.next=20,K.addTrack(F);case 20:F.kind===ln?(this.audio_=!0,this.updateAudioPlayingState(!0)):(this.video_=!0,this.updateVideoPlayingState(!0)),this.isAddingTrack_=!1,X.next=29;break;case 24:throw X.prev=24,X.t0=X.catch(12),G.removeTrack(F),this.isAddingTrack_=!1,X.t0;case 29:case"end":return X.stop()}},O,this,[[12,24]])})),function(O){return I.apply(this,arguments)})},{key:"removeTrack",value:(y=D(regeneratorRuntime.mark(function O(F){var G,P;return regeneratorRuntime.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(F.kind!==ln){K.next=2;break}throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:BI})});case 2:if(!this.isAddingTrack_){K.next=4;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:iA})});case 4:if(!this.isRemovingTrack_){K.next=6;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:oA})});case 6:if(this.publishState_!==yf){K.next=8;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:jI})});case 8:if(G=this.getMediaStream()){K.next=11;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:xM})});case 11:if(G.getTracks().indexOf(F)!==-1){K.next=13;break}throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:aA})});case 13:if(G.getTracks().length!==1){K.next=15;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:UM})});case 15:if(K.prev=15,this.isRemovingTrack_=!0,!(P=this.getConnection())){K.next=21;break}return K.next=21,P.removeTrack(F);case 21:G.removeTrack(F),F.kind===ln?(this.audio_=!1,this.updateAudioPlayingState(!1)):(this.video_=!1,this.updateVideoPlayingState(!1)),this.isRemovingTrack_=!1,K.next=30;break;case 26:throw K.prev=26,K.t0=K.catch(15),this.isRemovingTrack_=!1,K.t0;case 30:case"end":return K.stop()}},O,this,[[15,26]])})),function(O){return y.apply(this,arguments)})},{key:"replaceTrack",value:(f=D(regeneratorRuntime.mark(function O(F){var G,P,K;return regeneratorRuntime.wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(G=this.getMediaStream()){X.next=3;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:eA})});case 3:if(this.publishState_!==yf){X.next=5;break}throw new et({code:Ye.INVALID_OPERATION,message:rt({key:VI})});case 5:if(!(F.kind===ln&&G.getAudioTracks().length<=0||F.kind===An&&G.getVideoTracks().length<=0)){X.next=7;break}throw new et({code:Ye.INVALID_PARAMETER,message:rt({key:Ys,data:F})});case 7:if(F.kind===An&&qf&&(P=F.getSettings(),!this.videoSetting_||P.width===this.videoSetting_.width&&P.height===this.videoSetting_.height||this.log_.warn("video resolution of the track (".concat(P.width," x ").concat(P.height,") shall be kept the same as the previous: ").concat(this.videoSetting_.width," x ").concat(this.videoSetting_.height,". It may cause abnormal Cloud Recording."))),this.keepMuteState(F),F.kind!==ln){X.next=18;break}if(G.removeTrack(G.getAudioTracks()[0]),G.addTrack(F),Be(ie(N.prototype),"restartAudio",this).call(this),!this.gain_.gainNode){X.next=16;break}return this.reconnectGainNode(F),X.abrupt("return");case 16:X.next=21;break;case 18:G.removeTrack(G.getVideoTracks()[0]),G.addTrack(F),Be(ie(N.prototype),"restartVideo",this).call(this);case 21:if(!(K=this.getConnection())){X.next=25;break}return X.next=25,K.replaceTrack(F);case 25:case"end":return X.stop()}},O,this)})),function(O){return f.apply(this,arguments)})},{key:"updateStream",value:(v=D(regeneratorRuntime.mark(function O(F){var G,P,K,X,oe,Ce,Ve,je,Re,Oe,qe,$e,Tn,Q,j;return regeneratorRuntime.wrap(function(le){for(;;)switch(le.prev=le.next){case 0:if(this.mediaStream_){le.next=2;break}return le.abrupt("return");case 2:return this.log_.info("updateStream() try to recover local stream"),le.prev=3,le.next=6,Qr.getCameras();case 6:return G=le.sent,le.next=9,Qr.getMicrophones();case 9:if(P=le.sent,K=this.audio_&&F.audio,(X=this.video_&&F.video)&&G.length===0&&(X=!1,this.log_.info("updateStream() video flag is true, but no camera detected, set video to false")),K&&P.length===0&&(K=!1,this.log_.info("updateStream() audio flag is true, but no microphone detected, set audio to false")),K!==!1||X!==!1){le.next=17;break}return this.log_.info("updateStream() both audio and video are false, recover stream aborted"),le.abrupt("return");case 17:return oe=F&&G.findIndex(function(fe){return fe.deviceId===F.cameraId})>=0,Ce=F&&P.findIndex(function(fe){return fe.deviceId===F.microphoneId})>=0,le.next=21,uw({audio:K,video:X,cameraId:oe?F.cameraId:void 0,microphoneId:Ce?F.microphoneId:void 0,facingMode:this.facingMode_,width:this.videoProfile_.width,height:this.videoProfile_.height,frameRate:this.videoProfile_.frameRate,sampleRate:this.audioProfile_.sampleRate,channelCount:this.audioProfile_.channelCount});case 21:Ve=le.sent,je=Ve.getTracks(),Re=0;case 24:if(!(Re<je.length)){le.next=49;break}if((Oe=je[Re]).kind!==ln||!this.isAudioTrackMixed()){le.next=37;break}if(qe=this.getAudioTrack(),$e=Qr.AudioMixerPlugin.getAudioTrackMap(),(Tn=$e.get(qe.id)).hasMicrophone){le.next=33;break}return Oe.stop(),le.abrupt("continue",46);case 33:return Q=Qr.AudioMixerPlugin.mix({targetTrack:Oe,sourceList:Tn.sourceList,trackList:Tn.trackList}),le.next=36,this.replaceTrack_(Q);case 36:return le.abrupt("continue",46);case 37:if(Oe.kind!==An||!this.isVideoTrackBeautified()){le.next=44;break}return le.next=40,this.generateBeautyTrack(Oe);case 40:return j=le.sent,le.next=43,this.replaceTrack_(j);case 43:return le.abrupt("continue",46);case 44:return le.next=46,this.replaceTrack_(Oe);case 46:Re++,le.next=24;break;case 49:this.updateDeviceIdInUse(),jt.logSuccessEvent({userId:this.client_?this.client_.getUserId():this.userId_,eventType:II}),this.log_.info("updateStream() recover local stream successfully"),this.emitter_.emit(PE,{isCamera:F.video,isMicrophone:F.audio,cameraId:this.cameraId_,microphoneId:this.microphoneId_}),le.next=60;break;case 55:le.prev=55,le.t0=le.catch(3),jt.logFailedEvent({userId:this.client_?this.client_.getUserId():this.userId_,eventType:II,error:le.t0}),this.log_.error("updateStream() failed to recover local stream, "+le.t0),this.emitter_.emit(Hf,new et({code:Ye.DEVICE_AUTO_RECOVER_FAILED,message:le.t0.message}));case 60:case"end":return le.stop()}},O,this,[[3,55]])})),function(O){return v.apply(this,arguments)})},{key:"replaceTrack_",value:(p=D(regeneratorRuntime.mark(function O(F){var G,P,K,X;return regeneratorRuntime.wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(G=this.mediaStream_.getAudioTracks(),P=this.mediaStream_.getVideoTracks(),!(F.kind===ln&&G.length<=0||F.kind===An&&P.length<=0)){oe.next=5;break}return this.log_.info("there is no previous ".concat(F.kind," track, replacement ignored")),oe.abrupt("return");case 5:if(this.keepMuteState(F),F.kind!==ln){oe.next=15;break}if(this.mediaStream_.removeTrack(G[0]),this.mediaStream_.addTrack(F),Be(ie(N.prototype),"restartAudio",this).call(this),!this.gain_.gainNode){oe.next=13;break}return this.reconnectGainNode(F),oe.abrupt("return");case 13:oe.next=19;break;case 15:qf&&(K=F.getSettings(),!this.videoSetting_||K.width===this.videoSetting_.width&&K.height===this.videoSetting_.height||this.log_.warn("the resolution of video track to be replaced (".concat(K.width," x ").concat(K.height,") is different from the previous video settings (").concat(this.videoSetting_.width," x ").concat(this.videoSetting_.height,"). It may cause a cloud recording exception"))),this.mediaStream_.removeTrack(P[0]),this.mediaStream_.addTrack(F),Be(ie(N.prototype),"restartVideo",this).call(this);case 19:if(!(X=this.getConnection())){oe.next=23;break}return oe.next=23,X.replaceTrack(F);case 23:case"end":return oe.stop()}},O,this)})),function(O){return p.apply(this,arguments)})},{key:"updateDeviceIdInUse",value:function(){var O=this;if(!this.mediaStream_)return this.cameraId_="",this.cameraGroupId_="",this.microphoneId_="",void(this.microphoneGroupId_="");qf&&this.mediaStream_.getTracks().forEach(function(P){if(P.kind===ln&&O.isAudioTrackMixed()){var K=O.getMicrophoneTrackMixed();if(K){var X=K.getSettings(),oe=X.deviceId,Ce=X.groupId;oe&&(O.microphoneId_=oe,O.microphoneGroupId_=Ce)}}else if(P.kind===An&&O.isVideoTrackBeautified()){var Ve=O.getBeautyOriginTrack();if(Ve){var je=Ve.getSettings(),Re=je.deviceId,Oe=je.groupId;Re&&(O.cameraId_=Re,O.cameraGroupId_=Oe)}}else{var qe=P.getSettings(),$e=qe.deviceId,Tn=qe.groupId;$e&&(P.kind===ln?(O.microphoneId_=$e,O.microphoneGroupId_=Tn):P.kind!==An||O.screen_||(O.cameraId_=$e,O.cameraGroupId_=Tn))}});var F=this.mediaStream_.getAudioTracks(),G=this.mediaStream_.getVideoTracks();F&&F.length===0&&(this.microphoneId_="",this.microphoneGroupId_=""),G&&G.length===0&&(this.cameraId_="",this.cameraGroupId_="")}},{key:"isAudioTrackMixed",value:function(){if(Qr.AudioMixerPlugin){var O=Qr.AudioMixerPlugin.getAudioTrackMap(),F=this.getAudioTrack();if(O&&F&&O.has(F.id))return!0}return!1}},{key:"getMicrophoneTrackMixed",value:function(){if(Qr.AudioMixerPlugin){var O=Qr.AudioMixerPlugin.getAudioTrackMap(),F=this.getAudioTrack();if(O&&F&&O.has(F.id)){var G=O.get(F.id);return G.hasMicrophone?G.microphoneTrack:null}}return null}},{key:"isVideoTrackBeautified",value:function(){if(Qr.beautyTrackMap){var O=Qr.beautyTrackMap,F=this.getVideoTrack();if(F&&O.has(F.id))return!0}return!1}},{key:"getBeautyOriginTrack",value:function(){if(Qr.beautyTrackMap){var O=Qr.beautyTrackMap,F=this.getVideoTrack();if(F&&O.has(F.id)){var G=O.get(F.id);if(G.originTrack)return G.originTrack}}return null}},{key:"generateBeautyTrack",value:(d=D(regeneratorRuntime.mark(function O(F){var G,P,K,X;return regeneratorRuntime.wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(G=null,P=this.getVideoTrack(),K=Qr.beautyTrackMap.get(P.id),X=K.param,K.type){oe.next=8;break}G=K.pluginInstance.generateBeautyTrack(F),oe.next=22;break;case 8:oe.t0=K.type,oe.next=oe.t0==="beauty"?11:oe.t0==="virtual"?13:oe.t0==="mixed"?17:21;break;case 11:return G=K.pluginInstance.generateBeautyTrack(F),oe.abrupt("break",22);case 13:return oe.next=15,K.pluginInstance.generateVirtualTrack({videoTrack:F,type:X.type,img:X.img});case 15:return G=oe.sent,oe.abrupt("break",22);case 17:return oe.next=19,K.pluginInstance.generateMixedTrack({videoTrack:F,type:X.type,img:X.img});case 19:return G=oe.sent,oe.abrupt("break",22);case 21:return oe.abrupt("break",22);case 22:return K.pluginInstance.deleteSource(P.id),this.log_.info("regenerate beauty track, track id = ".concat(F.id)),oe.abrupt("return",G);case 25:case"end":return oe.stop()}},O,this)})),function(O){return d.apply(this,arguments)})},{key:"getScreen",value:function(){return this.screen_}},{key:"hasScreenTrack",value:function(){if(this.screen_)return!0;var O=this.getVideoTrack();return!!O&&(O.contentHint===WT||O.contentHint===zT)}},{key:"getVideo",value:function(){return this.video_}},{key:"getAudio",value:function(){return this.audio_}},{key:"getCameraId",value:function(){return this.cameraId_}},{key:"getMicrophoneId",value:function(){return this.microphoneId_}},{key:"getMicrophoneGroupId",value:function(){return this.microphoneGroupId_}},{key:"getIsReadyToPublish",value:function(){return this.isReadyToPublish_}},{key:"setIsReadyToPublish",value:function(O){this.isReadyToPublish_=O}},{key:"setPublishState",value:function(O){this.publishState_=O}},{key:"setBeautyStatus",value:function(O){this.beautyStatus_=!!O}},{key:"getBeautyStatus",value:function(){return this.beautyStatus_}},{key:"onStreamPublished",value:function(O){var F=O.localStream,G=O.client;F===this&&(this.client_=G,this.log_.setUserId(G.getUserId()),this.log_.setSdkAppId(G.getSDKAppId()),this.syncMuteState())}},{key:"syncMuteState",value:function(){var O=this.getAudioTrack(),F=this.getVideoTrack();if(O){var G=!O.enabled;this.setMuteState(ln,G)}if(F){var P=!F.enabled;this.setMuteState(An,P)}this.connection_&&this.connection_.sendMutedFlag(this.muteState_)}},{key:"keepMuteState",value:function(O){O instanceof MediaStreamTrack&&this.muteState_[O.kind]&&(O.enabled=!1,this.log_.warn("prev ".concat(O.kind," track is muted, keep mute state")))}},{key:"onVideoTrackStopped",value:(u=D(regeneratorRuntime.mark(function O(F){var G,P,K,X;return regeneratorRuntime.wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(G=F.stream,P=F.type,!(G!==this||!this.video_||!this.cameraId_||this.recoverCaptureCount_>10||(Sh||ed||Th)&&P===Tt)){oe.next=3;break}return oe.abrupt("return");case 3:if(!(K=this.getVideoTrack())){oe.next=11;break}return X=K.getSettings().deviceId,oe.next=8,Qr.getCameras();case 8:if(!(oe.sent.findIndex(function(Ce){return Ce.deviceId===X})<0)){oe.next=11;break}return oe.abrupt("return");case 11:this.recoverCaptureCount_+=1,jt.uploadEvent({log:"stat-local-video-".concat(P),userId:this.userId_}),this.updateStream({audio:!1,video:!0,cameraId:this.cameraId_});case 14:case"end":return oe.stop()}},O,this)})),function(O){return u.apply(this,arguments)})},{key:"onAudioTrackStopped",value:(c=D(regeneratorRuntime.mark(function O(F){var G,P,K,X,oe,Ce;return regeneratorRuntime.wrap(function(Ve){for(;;)switch(Ve.prev=Ve.next){case 0:if(G=F.stream,P=F.type,!(G!==this||!this.audio_||!this.microphoneId_||this.recoverCaptureCount_>10||(Sh||ed||Th)&&P===Tt)){Ve.next=3;break}return Ve.abrupt("return");case 3:if(!(K=this.getAudioTrack())){Ve.next=11;break}return X=K.getSettings(),oe=X.groupId,Ce=X.deviceId,Ve.next=8,Qr.getMicrophones();case 8:if(!(Ve.sent.findIndex(function(je){return je.deviceId===Ce&&(kt(oe)||oe===je.groupId)})<0)){Ve.next=11;break}return Ve.abrupt("return");case 11:this.recoverCaptureCount_+=1,jt.uploadEvent({log:"stat-local-audio-".concat(P),userId:this.userId_}),this.updateStream({audio:!0,video:!1,microphoneId:this.microphoneId_});case 14:case"end":return Ve.stop()}},O,this)})),function(O){return c.apply(this,arguments)})},{key:"setAudioVolume",value:function(O){Be(ie(N.prototype),"setAudioVolume",this).call(this,O)}},{key:"clearCanvas",value:function(){this.canvasInterval_&&(ii.clearInterval(this.canvasInterval_),this.canvasInterval_=-1,this.canvas_=null)}},{key:"genCanvasTrack",value:function(O){var F=this;this.log_.info("gen canvas track");var G=O.getSettings(),P=G.width,K=G.height,X=G.frameRate;this.canvas_=document.createElement("canvas");var oe=this.canvas_.getContext("2d");return this.canvas_.width=P,this.canvas_.height=K,this.canvasInterval_=ii.setInterval(function(){if(F.hasVideo()){var Ce=F.getVideoTrack().getSettings();Ce.width===F.canvas_.width&&Ce.height===F.canvas_.height||(F.canvas_.width=Ce.width,F.canvas_.height=Ce.height)}F.videoPlayer_&&F.videoPlayer_.element_&&oe.drawImage(F.videoPlayer_.element_,0,0,F.canvas_.width,F.canvas_.height)},Math.max(66,Math.floor(1e3/X))),this.canvas_.captureStream().getVideoTracks()[0]}},{key:"setClient",value:function(O){this.client_=O}},{key:"setAudioCaptureVolume",value:function(){var O=this,F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!this.hasAudio()||F<0||!Iv())return!1;if(this.captureVolume_===F)return!0;this.captureVolume_=F,this.log_.info("setCaptureVolume "+F),F/=100;var G=ZM();if(this.gain_.gainNode)this.gain_.gainNode.gain.value=F;else{var P,K=new MediaStream;K.addTrack(this.getAudioTrack());var X=G.createMediaStreamDestination(),oe=G.createMediaStreamSource(K),Ce=G.createGain();Ce.gain.value=F,oe.connect(Ce),Ce.connect(X);var Ve=X.stream.getAudioTracks()[0],je=function(Re){return O.log_.info("gained audio track ".concat(Re))};Ve.onmute=function(){return je("muted")},Ve.onunmute=function(){return je("unmuted")},Ve.onended=function(){return je("ended")},this.gain_={source:oe,audioTrack:Ve,gainNode:Ce},(P=this.connection_)===null||P===void 0||P.replaceTrack(Ve),Be(ie(N.prototype),"restartAudio",this).call(this)}return!0}},{key:"getGainedTrack",value:function(){return this.gain_.audioTrack}},{key:"reconnectGainNode",value:function(O){this.log_.warn("reconnect gain node");var F=new MediaStream;F.addTrack(O);var G=ZM().createMediaStreamSource(F);G.connect(this.gain_.gainNode),this.gain_.source.disconnect(),this.gain_.source=G}},{key:"close",value:function(){var O=this.gain_,F=O.audioTrack,G=O.source,P=O.gainNode;P&&(G.disconnect(),P.disconnect(),F.onmute=null,F.onunmute=null,F.onended=null,F.stop(),this.gain_={source:null,gainNode:null,audioTrack:null}),Be(ie(N.prototype),"close",this).call(this)}}]),N}(cD)).prototype,"switchDevice",[DD],Object.getOwnPropertyDescriptor(wv.prototype,"switchDevice"),wv.prototype),De(wv.prototype,"setAudioCaptureVolume",[OD],Object.getOwnPropertyDescriptor(wv.prototype,"setAudioCaptureVolume"),wv.prototype),wv),Vx=0,Bx=0,Qr=new(ND=BC(Ts.TRTC.createClient),LD=BC(Ts.TRTC.createStream),De((Dv=function(){function r(){x(this,r),this.name_=uM,this.VERSION="4.14.0",this.Logger={loggerManager:Bt,LogLevel:Ga,setLogLevel:function(f){Bt.setLogLevel(f),f<=1&&IA()},enableUploadLog:function(){Bt.enableUploadLog()},disableUploadLog:function(){Bt.warn("disableUploadLog"),Bt.disableUploadLog()}}}var c,u,d,p,v;return B(r,[{key:"checkSystemRequirements",value:(v=D(regeneratorRuntime.mark(function f(){return regeneratorRuntime.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,wE();case 2:return y.abrupt("return",y.sent);case 3:case"end":return y.stop()}},f)})),function(){return v.apply(this,arguments)})},{key:"isScreenShareSupported",value:function(){return QR()}},{key:"isSmallStreamSupported",value:function(){return nC()}},{key:"getDevices",value:(p=D(regeneratorRuntime.mark(function f(){var y;return regeneratorRuntime.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(!jf()&&!Bf()){I.next=2;break}return I.abrupt("return",[]);case 2:return I.next=4,navigator.mediaDevices.enumerateDevices();case 4:return y=I.sent,I.abrupt("return",y.filter(function(T){return T.kind!==mf||T.deviceId!="communications"}).map(function(T,b){var k=T.label;T.label||(k=T.kind+"_"+b);var N={label:k,deviceId:T.deviceId,kind:T.kind};return T.groupId&&(N.groupId=T.groupId),N}));case 6:case"end":return I.stop()}},f)})),function(){return p.apply(this,arguments)})},{key:"getCameras",value:(d=D(regeneratorRuntime.mark(function f(){var y;return regeneratorRuntime.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(!jf()&&!Bf()){I.next=2;break}return I.abrupt("return",[]);case 2:return I.next=4,navigator.mediaDevices.enumerateDevices();case 4:return y=I.sent,I.abrupt("return",y.filter(function(T){return T.kind===oI}).map(function(T,b){var k=T.label;T.label||(k="camera_"+b);var N={label:k,deviceId:T.deviceId,kind:T.kind};return T.groupId&&(N.groupId=T.groupId),N}));case 6:case"end":return I.stop()}},f)})),function(){return d.apply(this,arguments)})},{key:"getMicrophones",value:(u=D(regeneratorRuntime.mark(function f(){var y;return regeneratorRuntime.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(!jf()&&!Bf()){I.next=2;break}return I.abrupt("return",[]);case 2:return I.next=4,navigator.mediaDevices.enumerateDevices();case 4:return y=I.sent,I.abrupt("return",y.filter(function(T){return T.kind===mf&&T.deviceId!=="communications"}).map(function(T,b){var k=T.label;T.label||(k="microphone_"+b);var N={label:k,deviceId:T.deviceId,kind:T.kind};return T.groupId&&(N.groupId=T.groupId),N}));case 6:case"end":return I.stop()}},f)})),function(){return u.apply(this,arguments)})},{key:"getSpeakers",value:(c=D(regeneratorRuntime.mark(function f(){var y;return regeneratorRuntime.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(!jf()&&!Bf()){I.next=2;break}return I.abrupt("return",[]);case 2:return I.next=4,navigator.mediaDevices.enumerateDevices();case 4:return y=I.sent,I.abrupt("return",y.filter(function(T){return T.kind==="audiooutput"}).map(function(T,b){var k=T.label;T.label||(k="speaker_"+b);var N={label:k,deviceId:T.deviceId,kind:T.kind};return T.groupId&&(N.groupId=T.groupId),N}));case 6:case"end":return I.stop()}},f)})),function(){return c.apply(this,arguments)})},{key:"createClient",value:function(f){pR&&(pR=!1,Bt.getLogLevel()!=Qr.Logger.LogLevel.NONE&&(console.info("******************************************************************************"),console.info("*   TRTC Web SDK"),console.info("*   API Document: "+"".concat(My,"index.html")),console.info("*   Changelog: https://cloud.tencent.com/document/product/647/38958"),console.info("*   Report issues: https://github.com/LiteAVSDK/TRTC_Web/issues"),console.info("******************************************************************************")),Bt.info("TRTC Web SDK Version: 4.14.0"),Bt.info("UserAgent: "+navigator.userAgent),Bt.info("URL of current page: "+location.href));var y={version:this.VERSION},I=new xx(m(m(m({},y),f),{},{seq:++Vx}));return Me.emit(dR,{client:I}),I}},{key:"createStream",value:function(f){return new Fx(m(m({},f),{},{seq:++Bx}))}}]),r}()).prototype,"createClient",[ND],Object.getOwnPropertyDescriptor(Dv.prototype,"createClient"),Dv.prototype),De(Dv.prototype,"createStream",[LD],Object.getOwnPropertyDescriptor(Dv.prototype,"createStream"),Dv.prototype),Dv);return Qr})}(Tw)),Tw.exports}var Mw=bL();const Y5=0,J5=1,JO=2;class mg extends Db.exports.EventEmitter{constructor(){super();we(this,"client");we(this,"shareClient");we(this,"startJoinTimestamp",0);we(this,"joinedTimestamp",0);we(this,"localStream");we(this,"testCameraStream");we(this,"localStreamRenderParams");we(this,"shareStream");we(this,"audioQuality");we(this,"priorRemoteVideoStreamType");we(this,"playViewMap",new Map);we(this,"cameraList",[]);we(this,"micList",[]);we(this,"speakerList",[]);we(this,"currentCameraId","");we(this,"currentMicId","");we(this,"currentSpeakerId","");we(this,"isJoining",!1);we(this,"isJoined",!1);we(this,"isExiting",!1);we(this,"isPublishing",!1);we(this,"isPublished",!1);we(this,"isSubscribed",!1);we(this,"sdkAppId");we(this,"userId","");we(this,"userSig","");we(this,"roomId",0);we(this,"strRoomId","");we(this,"mode",mb);we(this,"role",RL);we(this,"privateMapKey","255");we(this,"streamId","");we(this,"remoteStreamMap");we(this,"isSmallStreamSupported",!1);we(this,"isSharing",!1);we(this,"isShareClientJoined",!1);we(this,"isShareStreamPublished",!1);we(this,"isShareClientLeaving",!1);we(this,"isStaringLocalPreview",!1);we(this,"isStartedLocalPreview",!1);we(this,"isStaringLocalAudio",!1);we(this,"isStartedLocalAudio",!1);we(this,"videoEncodeParam");we(this,"defaultVideoWidth",640);we(this,"defaultVideoHeight",480);we(this,"defaultVideoFps",15);we(this,"defaultVideoBitRate",900);we(this,"prevLocalVideoStats",{bytesSent:0,packetsSent:0,framesEncoded:0,framesSent:0,frameWidth:0,frameHeight:0});we(this,"beautyPlugin");we(this,"beautyDefaultBeauty",.5);we(this,"beautyDefaultBrightness",.5);we(this,"beautyDefaultRuddy",.5);we(this,"TRTC",Mw);this.audioQuality=c1.TRTCAudioQualityDefault,this.priorRemoteVideoStreamType=Ed.TRTCVideoStreamTypeBig,this.remoteStreamMap=new Map,this.isSmallStreamSupported=Mw&&Mw.isSmallStreamSupported()||!1,this.videoEncodeParam={width:this.defaultVideoWidth,height:this.defaultVideoHeight,frameRate:this.defaultVideoFps,bitrate:this.defaultVideoBitRate}}promiseRetry(g){const{retryFunction:m,settings:R,onError:A,onRetrying:D,context:x}=g;return(...$)=>{const B=R.retries||5;let te=0,re=-1,ie=Y5;const W=async(Y,se)=>{try{const Ae=x||this,Je=await m.apply(Ae,$);te=0,Y(Je)}catch(Ae){const Je=()=>{clearTimeout(re),te=0,ie=JO,se(Ae)},Xe=()=>{ie!==JO&&te<B?(te++,ie=J5,D&&D(te,Je),re=window.setTimeout(()=>{re=-1,W(Y,se)},typeof R.timeout>"u"?1e3:R.timeout)):Je()};A?A(Ae,Xe,se):Xe()}};return new Promise(W)}}}const X5={code:-1e3,message:"js \u6267\u884C\u62A5\u9519"},Ms={code:-1001,message:"\u53C2\u6570\u9519\u8BEF, \u8BF7\u68C0\u67E5\u53C2\u6570\u683C\u5F0F\u3001\u662F\u5426\u975E\u7A7A\u7B49"},XO={code:-1002,message:"\u8FDB\u623F\u5931\u8D25\uFF1A\u8FDB\u623F\u4E2D\u6216\u5DF2\u8FDB\u623F"},QO={code:-1003,message:"\u9000\u623F\u5931\u8D25\uFF1A\u672A\u8FDB\u623F\u6216\u9000\u623F\u4E2D"},eg={code:-1004,message:"\u8C03\u7528\u8BE5\u51FD\u6570\u6240\u9700\u8981\u6761\u4EF6\u4E0D\u6EE1\u8DB3"};class Q5 extends gg(mg){async startPublishing(s,g){try{if(!this.isPublished){this.log_.error(`(startPublishing) failed - ${this.isPublished}`),this.emitError({conditionsError:eg,message:`${eg.message} - isPublished = ${this.isPublished}`});return}if(!this.client){this.log_.error(`(startPublishing) failed - ${this.client}`),this.emitError({conditionsError:eg,message:`${eg.message} - client = ${this.client}`});return}const m={streamId:s};await this.client.startPublishCDNStream(m)}catch(m){this.callFunctionErrorManage(m,"startPublishing")}}async stopPublishing(){try{if(!this.client){this.log_.error(`(stopPublishing) failed - ${this.client}`),this.emitError({conditionsError:eg,message:`${eg.message} - client = ${this.client}`});return}await this.client.stopPublishCDNStream()}catch(s){this.callFunctionErrorManage(s,"stopPublishing")}}async startPublishCDNStream(s){try{if(s instanceof F5){const{appId:g,bizId:m,url:R}=s,A={appId:g,bizId:m,url:R};await this.client.startPublishCDNStream(A)}else this.log_.error(`(startPublishCDNStream) failed - ${JSON.stringify(s)}`),this.emitError(Ms)}catch(g){this.callFunctionErrorManage(g,"startPublishCDNStream")}}async stopPublishCDNStream(){try{if(!this.client){this.log_.error(`(stopPublishCDNStream) failed - ${this.client}`),this.emitError({conditionsError:eg,message:`${eg.message} - client = ${this.client}`});return}await this.client.stopPublishCDNStream()}catch(s){this.callFunctionErrorManage(s,"stopPublishCDNStream")}}}class Z5 extends gg(mg){async startLocalPreview(s){this.log_.info("(startLocalPreview) start - start local preview",s);try{if(this.localStreamHasVideoOrAudio("video")){this.playStream(this.localStream,s);return}await this.promiseRetry({retryFunction:this.doStartLocalPreview,settings:{retries:6,timeout:1e3}})(s)}catch(g){this.isStaringLocalPreview=!1,this.callFunctionErrorManage(g,"startLocalPreview")}}async doStartLocalPreview(s){if(this.isStaringLocalAudio)throw new Error("startLocalAudio is under implementation.");if(this.isStaringLocalPreview=!0,BS(s))this.emitError(Ms),this.log_.error(`(startLocalPreview) failed - ${Ms.message}: ${s}`);else if(s!==null){const g={userId:this.client&&`${this.client.getUserId()} video`||"video undefined",video:!0,audio:!1,screenAudio:!1};if(this.currentCameraId&&(g.cameraId=this.currentCameraId),this.localStream){const m=this.TRTC.createStream(g);this.videoEncodeParam&&await m.setVideoProfile(this.videoEncodeParam),await m.initialize();const R=m.getVideoTrack();await this.localStream.addTrack(R)}else await this.initStream(g);this.isStartedLocalPreview=!0,this.localStream&&(this.playStream(this.localStream,s,this.localStreamRenderParams),this.clearTempAudioContainer("localAudio")),await this.publishLocalStream(),this.isStaringLocalPreview=!1}}async stopLocalPreview(){if(this.log_.info("(stopLocalPreview) stop - stop local preview"),!this.isStartedLocalPreview){this.log_.info("(stopLocalPreview) stop - local preview has not been started");return}return new Promise(async(s,g)=>{try{if(this.localStream)if(this.localStream.getAudioTrack()){const R=this.localStream.getVideoTrack();R&&this.localStream.removeTrack(R).then(()=>{R.stop(),this.isStartedLocalPreview=!1,s(1)})}else await this.unPublishStream(),this.localStream.stop(),this.localStream.close(),this.localStream=null,this.isStartedLocalPreview=!1,s(1)}catch(m){this.callFunctionErrorManage(m,"stopLocalPreview"),g(m)}})}muteLocalVideo(s=!1){try{this.localStream&&(s?this.localStream.muteVideo():this.localStream.unmuteVideo())}catch(g){this.callFunctionErrorManage(g,"muteLocalVideo")}}startRemoteView(s,g,m){try{let R=KO[m||Ed.TRTCVideoStreamTypeBig];if(!this.isSmallStreamSupported&&m&&m!==Ed.TRTCVideoStreamTypeSub&&(R=KO[Ed.TRTCVideoStreamTypeBig]),BS(g))this.emitError(Ms),this.log_.error(`(startRemoteView) failed - ${Ms.message}: ${g}`);else{const A=R===ST?zO(s):PS(s);if(this.remoteStreamMap.has(A)){const D=this.remoteStreamMap.get(A);R!==ST&&this.client&&this.client.setRemoteVideoStreamType(D,R),D&&this.playStream(D,g)}}}catch(R){this.callFunctionErrorManage(R,"startRemoteView")}}async stopRemoteView(s,g){try{let m=g;BS(g)||(m=this.priorRemoteVideoStreamType),console.log("stopRemoteView streamType: ",m);const R=this.remoteStreamMap.get(PS(s));R&&(await R.stop(),await R.close(),this.remoteStreamMap.delete(PS(s)),this.remoteStreamMap.delete(zO(s)))}catch(m){this.callFunctionErrorManage(m,"stopRemoteView")}}muteRemoteVideoStream(s,g=!1){try{if(!s){this.emitError(Ms),this.log_.error(`(muteRemoteVideoStream) failed - ${Ms.message}: userId = ${s}`);return}const m=this.remoteStreamMap.get(PS(s));m&&(g?m.muteVideo():m.unmuteVideo())}catch(m){this.callFunctionErrorManage(m,"stopRemoteView")}}async setVideoEncoderParam(s){try{const{videoEncodeParam:g}=this;if(s.videoResolution){const R=(TL[s.videoResolution]||"").split("_");g.width=R.length>1&&R[1],g.height=R.length>2&&R[2]}s.videoFps&&(g.frameRate=s.videoFps),s.videoBitrate&&(g.bitrate=s.videoBitrate),this.videoEncodeParam=g,await this.setStreamVideoParam(this.videoEncodeParam)}catch(g){this.callFunctionErrorManage(g,"setVideoEncoderParam")}}setLocalRenderParams(s){try{const g={};s.mirrorType===cg.TRTCVideoMirrorType_Enable&&(g.mirror=!0),s.mirrorType===cg.TRTCVideoMirrorType_Disable&&(g.mirror=!1),s.fillMode===LS.TRTCVideoFillMode_Fill&&(g.objectFit="cover"),s.fillMode===LS.TRTCVideoFillMode_Fit&&(g.objectFit="contain"),this.localStreamRenderParams=g;const m=this.playViewMap.get(`${this.localStream.getUserId()}_${this.localStream.getType()}`);if(this.playStream(this.localStream,m,g),this.testCameraStream){const R=this.playViewMap.get(`${this.testCameraStream.getUserId()}_${this.testCameraStream.getType()}`);this.playStream(this.testCameraStream,R,g)}}catch(g){this.callFunctionErrorManage(g,"setLocalRenderParams")}}setRemoteRenderParams(s,g,m){try{const R={};m.mirrorType===cg.TRTCVideoMirrorType_Enable&&(R.mirror=!0),m.mirrorType===cg.TRTCVideoMirrorType_Disable&&(R.mirror=!1),m.fillMode===LS.TRTCVideoFillMode_Fill&&(R.objectFit="cover"),m.fillMode===LS.TRTCVideoFillMode_Fit&&(R.objectFit="contain");const A=this.playViewMap.get(`${s}_${g}`),D=this.remoteStreamMap.get(`${s}-${g}`);this.playStream(D,A,R)}catch(R){this.callFunctionErrorManage(R,"setRemoteRenderParams")}}async startCameraDeviceTest(s){if(this.log_.info("(startCameraDeviceTest) start - start test camera Device",s),s!==null){const g={userId:"test camera",video:!0,audio:!1,screenAudio:!1};this.currentCameraId&&(g.cameraId=this.currentCameraId),this.testCameraStream=this.TRTC.createStream(g),this.videoEncodeParam&&this.testCameraStream.setVideoProfile(this.videoEncodeParam),await this.testCameraStream.initialize(),this.playStream(this.testCameraStream,s,this.localStreamRenderParams)}}stopCameraDeviceTest(){this.testCameraStream&&(this.testCameraStream.stop(),this.testCameraStream.close(),this.testCameraStream=null)}}class e8 extends gg(mg){async startLocalAudio(s){if(this.log_.info("(startLocalAudio) start - start local audio"),!this.localStreamHasVideoOrAudio("audio"))try{await this.promiseRetry({retryFunction:this.doStartLocalAudio,settings:{retries:6,timeout:1e3}})(s)}catch(g){this.callFunctionErrorManage(g,"startLocalAudio")}}async doStartLocalAudio(s){if(this.isStaringLocalPreview)throw new Error("startLocalPreview is under implementation.");try{this.isStaringLocalAudio=!0;let g=s;BS(s)||(g=this.audioQuality);const m={userId:this.client&&`${this.client.getUserId()} audio`||"audio undefined",video:!1,audio:!0,screenAudio:!1};this.currentMicId&&(m.microphoneId=this.currentMicId);const R=this.TRTC.createStream(m);R.setAudioProfile(W5[g||c1.TRTCAudioQualityDefault]),await R.initialize();const A=R.getAudioTrack();if(this.localStream)await this.localStream.addTrack(A);else{this.localStream=R;const D=this.generateTempAudioContainer("localAudio");this.localStream&&this.playStream(this.localStream,D)}this.isStartedLocalAudio=!0,await this.publishLocalStream(),this.isStaringLocalAudio=!1,this.isPublished||this.getLocalStreamAudioLevel()}catch(g){throw g}}getLocalStreamAudioLevel(){this.enableAudioVolumeInterval&&(this.enableAudioVolumeTimer=setInterval(()=>{const s=[],g=Math.floor(this.localStream.getAudioLevel()*100);s.push({userId:"local",audioVolume:g,stream:this.localStream}),this.emit("onUserVoiceVolume",s)},this.enableAudioVolumeInterval))}generateTempAudioContainer(s){const g=document.createElement("div");return g.id=s,g.style.width="0",g.style.height="0",document.getElementsByTagName("body")[0].appendChild(g),g}clearTempAudioContainer(s){const g=document.getElementById(s);g&&document.getElementsByTagName("body")[0].removeChild(g)}async stopLocalAudio(){if(this.log_.info("(stopLocalAudio) stop - stop local audio"),!this.isStartedLocalAudio){this.log_.info("(stopLocalAudio) stop - local audio has not been started");return}return new Promise(async(s,g)=>{try{if(this.localStream)if(this.enableAudioVolumeTimer&&clearInterval(this.enableAudioVolumeTimer),this.localStream.getVideoTrack()){const R=this.localStream.getAudioTrack();R&&(R.stop(),this.isStartedLocalAudio=!1,s(1))}else await this.unPublishStream(),this.localStream.stop(),this.localStream.close(),this.clearTempAudioContainer("localAudio"),this.localStream=null,this.isStartedLocalAudio=!1,s(1)}catch(m){this.callFunctionErrorManage(m,"stopLocalAudio"),g(m)}})}muteLocalAudio(s=!1){try{this.localStream&&(s?this.localStream.muteAudio():this.localStream.unmuteAudio())}catch(g){this.callFunctionErrorManage(g,"muteLocalAudio")}}muteRemoteAudio(s,g=!1){try{if(!s){this.emitError(Ms),this.log_.error(`(muteRemoteVideoStream) failed - ${Ms.message}: userId = ${s}`);return}const m=this.remoteStreamMap.get(PS(s));m&&(g?m.muteAudio():m.unmuteAudio())}catch(m){this.callFunctionErrorManage(m,"muteRemoteAudio")}}setRemoteAudioVolume(s,g){try{if(!s||g<0){this.emitError(Ms),this.log_.error(`(muteRemoteVideoStream) failed - ${Ms.message}: userId = ${s}, volume = ${g}`);return}const m=this.remoteStreamMap.get(PS(s));if(m){const R=g>100?1:g/100;m.setAudioVolume(R)}}catch(m){this.callFunctionErrorManage(m,"setRemoteAudioVolume")}}getAudioCaptureVolume(){try{return this.localStream?this.localStream.getAudioLevel():(this.log_.error(`(getAudioCaptureVolume) failed - localStream = ${this.localStream}`),0)}catch(s){return this.callFunctionErrorManage(s,"getAudioCaptureVolume"),0}}}class t8 extends gg(mg){async getCameraDevicesList(){try{const s=await this.TRTC.getCameras();return this.cameraList=s.map(g=>({deviceId:g.deviceId,deviceName:g.label})),Promise.resolve(this.cameraList)}catch(s){return this.callFunctionErrorManage(s,"getCameraDevicesList"),this.cameraList=[],Promise.resolve([])}}async setCurrentCameraDevice(s){try{return s?(this.currentCameraId=s||"",this.localStream&&await this.localStream.switchDevice("video",s),this.testCameraStream&&await this.testCameraStream.switchDevice("video",s),Promise.resolve(!0)):Promise.resolve(!1)}catch(g){return this.callFunctionErrorManage(g,"setCurrentCameraDevice"),this.cameraList=[],Promise.resolve(!1)}}getCurrentCameraDevice(){return(this.cameraList||[]).filter(s=>s.deviceId===this.currentCameraId)[0]||{}}}class n8 extends gg(mg){async getMicDevicesList(){try{const s=await this.TRTC.getMicrophones();return this.micList=s.map(g=>({deviceId:g.deviceId,deviceName:g.label})),Promise.resolve(this.micList)}catch(s){return this.callFunctionErrorManage(s,"getMicDevicesList"),Promise.resolve([])}}getCurrentMicDevice(){return(this.micList||[]).filter(s=>s.deviceId===this.currentMicId)[0]||{}}async setCurrentMicDevice(s){try{return s?(this.currentMicId=s||"",this.localStream&&this.localStream?await this.localStream.switchDevice("audio",s):Promise.resolve(!0)):Promise.resolve(!1)}catch(g){return this.callFunctionErrorManage(g,"setCurrentMicDevice"),Promise.resolve(!1)}}async getSpeakerDevicesList(){try{const s=await this.TRTC.getSpeakers();return this.speakerList=s.map(g=>({deviceId:g.deviceId,deviceName:g.label})),Promise.resolve(this.speakerList)}catch(s){return this.callFunctionErrorManage(s,"getSpeakerDevicesList"),Promise.resolve([])}}getCurrentSpeakerDevice(){return this.speakerList[0]||{}}async setCurrentSpeakerDevice(s){try{return!s||(this.currentSpeakerId=s||"",!this.localStream)?Promise.resolve(!1):await this.localStream.setAudioOutput(s)}catch(g){return this.callFunctionErrorManage(g,"setCurrentSpeakerDevice"),Promise.resolve(!1)}}}class r8 extends gg(mg){getScreenCaptureSources(){}selectScreenCaptureTarget(){}async startScreenCapture(s,g,m){}async initShareClient(s,g){try{this.shareClient=await this.TRTC.createClient({mode:"rtc",sdkAppId:this.sdkAppId,userId:s,userSig:g,autoSubscribe:!1}),console.log(`ShareClient [${s}] created.`),this.installShareClientEventHandlers()}catch(m){throw console.error(`Failed to create Client [${s}].`),m}}installShareClientEventHandlers(){this.shareClient.on("error",this.handleShareClientError.bind(this)),this.shareClient.on("client-banned",this.handleShareClientBanned.bind(this)),this.shareClient.on("stream-subscribed",this.handleShareClientStreamSubscribed.bind(this))}handleShareClientError(s){console.error("ShareClient error:",s)}handleShareClientBanned(s){console.error("ShareClient has been banned for:",s)}handleShareClientStreamSubscribed(s){const g=s.stream,m=g.getId(),R=g.getUserId();console.log(`remote stream received and unsubscribed: [${R}] ID: ${m} type: ${g.getType()}`),this.shareClient.unsubscribe(g)}async initShareStream(){try{return this.shareStream=this.TRTC.createStream({audio:!1,screen:!0,userId:this.userId}),this.shareStream.setScreenProfile({width:1920,height:1080,frameRate:15,bitrate:1500}),await this.shareStream.initialize(),this.shareStream.on("screen-sharing-stopped",()=>{console.log("ShareStream video track ended"),this.emit("onWebScreenSharingStopped"),this.shareClientLeave()}),this.shareStream}catch(s){throw console.error(`ShareStream failed to initialize. Error: ${s}`),s}}async shareClientJoin(s,g){try{this.shareClient||await this.initShareClient(s,g),await this.shareClient.join({roomId:this.roomId}),this.isShareClientJoined=!0}catch(m){throw console.error("ShareClient join room failed:",m),m}}async shareClientPublish(){if(!this.isShareClientJoined){console.warn("ShareClient cannot publish() - please join() firstly");return}if(this.isShareStreamPublished){console.warn("ShareClient duplicate publish() observed");return}try{await this.shareClient.publish(this.shareStream),console.log("ShareStream is published successfully"),this.isShareStreamPublished=!0}catch(s){throw console.error(`ShareStream is failed to publish. Error: ${s}`),s}}async shareClientUnpublish(){if(!this.isShareClientJoined){console.warn("ShareClient cannot unpublish() - please join() firstly");return}if(!this.isShareStreamPublished){console.warn("ShareClient cannot unpublish() - you have not published yet");return}try{this.shareStream&&await this.shareClient.unpublish(this.shareStream),this.isShareStreamPublished=!1,console.log("Unpublish ShareStream success")}catch(s){throw console.error("unpublish failed",s),s}}async shareClientLeave(){if(!this.isShareClientJoined){console.warn("ShareClient cannot leave() - please join() firstly");return}if(this.isShareClientLeaving){console.warn("ShareClient duplicate leave() observed");return}this.isShareStreamPublished&&await this.shareClientUnpublish();try{this.isShareClientLeaving=!0,await this.shareClient.leave(),this.isShareClientJoined=!1,console.log("ShareClient leave room success"),this.shareStream&&(this.shareStream.stop(),this.shareStream.close(),this.shareStream=null),this.isShareClientLeaving=!1}catch(s){throw console.error("ShareClient leave failed:",s),s}}async startScreenShare(s){const{shareUserId:g,shareUserSig:m}=s;try{await this.initShareStream(),await this.shareClientJoin(g,m),await this.shareClientPublish(),console.log("Start share screen success"),this.isSharing=!0}catch(R){throw console.error("Start share screen error:",R),R}}async stopScreenShare(){try{await this.shareClientUnpublish(),await this.shareClientLeave(),this.isSharing=!1}catch(s){throw console.error("Stop screen share error:",s),s}}}var AL={exports:{}};(function(i,s){(function(g,m){i.exports=m(bL())})(rc,function(g){function m(C,U,q,J,ce,z,pe){try{var ye=C[z](pe),ue=ye.value}catch(be){return void q(be)}ye.done?U(ue):Promise.resolve(ue).then(J,ce)}function R(C){return function(){var U=this,q=arguments;return new Promise(function(J,ce){var z=C.apply(U,q);function pe(ue){m(z,J,ce,pe,ye,"next",ue)}function ye(ue){m(z,J,ce,pe,ye,"throw",ue)}pe(void 0)})}}function A(C,U){if(!(C instanceof U))throw new TypeError("Cannot call a class as a function")}function D(C,U){for(var q=0;q<U.length;q++){var J=U[q];J.enumerable=J.enumerable||!1,J.configurable=!0,"value"in J&&(J.writable=!0),Object.defineProperty(C,J.key,J)}}function x(C,U,q){return U&&D(C.prototype,U),q&&D(C,q),C}g=g&&Object.prototype.hasOwnProperty.call(g,"default")?g.default:g;var $=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof rc<"u"?rc:typeof self<"u"?self:{};function B(C,U){return C(U={exports:{}},U.exports),U.exports}B(function(C){var U=function(q){var J=Object.prototype,ce=J.hasOwnProperty,z=typeof Symbol=="function"?Symbol:{},pe=z.iterator||"@@iterator",ye=z.asyncIterator||"@@asyncIterator",ue=z.toStringTag||"@@toStringTag";function be(_t,Rt,me){return Object.defineProperty(_t,Rt,{value:me,enumerable:!0,configurable:!0,writable:!0}),_t[Rt]}try{be({},"")}catch{be=function(Rt,me,Nn){return Rt[me]=Nn}}function He(_t,Rt,me,Nn){var At=Rt&&Rt.prototype instanceof ot?Rt:ot,Wn=Object.create(At.prototype),$r=new Bn(Nn||[]);return Wn._invoke=function(Di,Kr,Xt){var tr="suspendedStart";return function(Oi,tn){if(tr==="executing")throw new Error("Generator is already running");if(tr==="completed"){if(Oi==="throw")throw tn;return ei()}for(Xt.method=Oi,Xt.arg=tn;;){var Xn=Xt.delegate;if(Xn){var Rn=Fi(Xn,Xt);if(Rn){if(Rn===mt)continue;return Rn}}if(Xt.method==="next")Xt.sent=Xt._sent=Xt.arg;else if(Xt.method==="throw"){if(tr==="suspendedStart")throw tr="completed",Xt.arg;Xt.dispatchException(Xt.arg)}else Xt.method==="return"&&Xt.abrupt("return",Xt.arg);tr="executing";var co=gt(Di,Kr,Xt);if(co.type==="normal"){if(tr=Xt.done?"completed":"suspendedYield",co.arg===mt)continue;return{value:co.arg,done:Xt.done}}co.type==="throw"&&(tr="completed",Xt.method="throw",Xt.arg=co.arg)}}}(_t,me,$r),Wn}function gt(_t,Rt,me){try{return{type:"normal",arg:_t.call(Rt,me)}}catch(Nn){return{type:"throw",arg:Nn}}}q.wrap=He;var mt={};function ot(){}function Zt(){}function In(){}var un={};be(un,pe,function(){return this});var zt=Object.getPrototypeOf,en=zt&&zt(zt(Hr([])));en&&en!==J&&ce.call(en,pe)&&(un=en);var Pn=In.prototype=ot.prototype=Object.create(un);function cr(_t){["next","throw","return"].forEach(function(Rt){be(_t,Rt,function(me){return this._invoke(Rt,me)})})}function ao(_t,Rt){var me;this._invoke=function(Nn,At){function Wn(){return new Rt(function($r,Di){(function Kr(Xt,tr,Oi,tn){var Xn=gt(_t[Xt],_t,tr);if(Xn.type!=="throw"){var Rn=Xn.arg,co=Rn.value;return co&&typeof co=="object"&&ce.call(co,"__await")?Rt.resolve(co.__await).then(function($n){Kr("next",$n,Oi,tn)},function($n){Kr("throw",$n,Oi,tn)}):Rt.resolve(co).then(function($n){Rn.value=$n,Oi(Rn)},function($n){return Kr("throw",$n,Oi,tn)})}tn(Xn.arg)})(Nn,At,$r,Di)})}return me=me?me.then(Wn,Wn):Wn()}}function Fi(_t,Rt){var me=_t.iterator[Rt.method];if(me===void 0){if(Rt.delegate=null,Rt.method==="throw"){if(_t.iterator.return&&(Rt.method="return",Rt.arg=void 0,Fi(_t,Rt),Rt.method==="throw"))return mt;Rt.method="throw",Rt.arg=new TypeError("The iterator does not provide a 'throw' method")}return mt}var Nn=gt(me,_t.iterator,Rt.arg);if(Nn.type==="throw")return Rt.method="throw",Rt.arg=Nn.arg,Rt.delegate=null,mt;var At=Nn.arg;return At?At.done?(Rt[_t.resultName]=At.value,Rt.next=_t.nextLoc,Rt.method!=="return"&&(Rt.method="next",Rt.arg=void 0),Rt.delegate=null,mt):At:(Rt.method="throw",Rt.arg=new TypeError("iterator result is not an object"),Rt.delegate=null,mt)}function so(_t){var Rt={tryLoc:_t[0]};1 in _t&&(Rt.catchLoc=_t[1]),2 in _t&&(Rt.finallyLoc=_t[2],Rt.afterLoc=_t[3]),this.tryEntries.push(Rt)}function Jn(_t){var Rt=_t.completion||{};Rt.type="normal",delete Rt.arg,_t.completion=Rt}function Bn(_t){this.tryEntries=[{tryLoc:"root"}],_t.forEach(so,this),this.reset(!0)}function Hr(_t){if(_t){var Rt=_t[pe];if(Rt)return Rt.call(_t);if(typeof _t.next=="function")return _t;if(!isNaN(_t.length)){var me=-1,Nn=function At(){for(;++me<_t.length;)if(ce.call(_t,me))return At.value=_t[me],At.done=!1,At;return At.value=void 0,At.done=!0,At};return Nn.next=Nn}}return{next:ei}}function ei(){return{value:void 0,done:!0}}return Zt.prototype=In,be(Pn,"constructor",In),be(In,"constructor",Zt),Zt.displayName=be(In,ue,"GeneratorFunction"),q.isGeneratorFunction=function(_t){var Rt=typeof _t=="function"&&_t.constructor;return!!Rt&&(Rt===Zt||(Rt.displayName||Rt.name)==="GeneratorFunction")},q.mark=function(_t){return Object.setPrototypeOf?Object.setPrototypeOf(_t,In):(_t.__proto__=In,be(_t,ue,"GeneratorFunction")),_t.prototype=Object.create(Pn),_t},q.awrap=function(_t){return{__await:_t}},cr(ao.prototype),be(ao.prototype,ye,function(){return this}),q.AsyncIterator=ao,q.async=function(_t,Rt,me,Nn,At){At===void 0&&(At=Promise);var Wn=new ao(He(_t,Rt,me,Nn),At);return q.isGeneratorFunction(Rt)?Wn:Wn.next().then(function($r){return $r.done?$r.value:Wn.next()})},cr(Pn),be(Pn,ue,"Generator"),be(Pn,pe,function(){return this}),be(Pn,"toString",function(){return"[object Generator]"}),q.keys=function(_t){var Rt=[];for(var me in _t)Rt.push(me);return Rt.reverse(),function Nn(){for(;Rt.length;){var At=Rt.pop();if(At in _t)return Nn.value=At,Nn.done=!1,Nn}return Nn.done=!0,Nn}},q.values=Hr,Bn.prototype={constructor:Bn,reset:function(_t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(Jn),!_t)for(var Rt in this)Rt.charAt(0)==="t"&&ce.call(this,Rt)&&!isNaN(+Rt.slice(1))&&(this[Rt]=void 0)},stop:function(){this.done=!0;var _t=this.tryEntries[0].completion;if(_t.type==="throw")throw _t.arg;return this.rval},dispatchException:function(_t){if(this.done)throw _t;var Rt=this;function me(Kr,Xt){return Wn.type="throw",Wn.arg=_t,Rt.next=Kr,Xt&&(Rt.method="next",Rt.arg=void 0),!!Xt}for(var Nn=this.tryEntries.length-1;Nn>=0;--Nn){var At=this.tryEntries[Nn],Wn=At.completion;if(At.tryLoc==="root")return me("end");if(At.tryLoc<=this.prev){var $r=ce.call(At,"catchLoc"),Di=ce.call(At,"finallyLoc");if($r&&Di){if(this.prev<At.catchLoc)return me(At.catchLoc,!0);if(this.prev<At.finallyLoc)return me(At.finallyLoc)}else if($r){if(this.prev<At.catchLoc)return me(At.catchLoc,!0)}else{if(!Di)throw new Error("try statement without catch or finally");if(this.prev<At.finallyLoc)return me(At.finallyLoc)}}}},abrupt:function(_t,Rt){for(var me=this.tryEntries.length-1;me>=0;--me){var Nn=this.tryEntries[me];if(Nn.tryLoc<=this.prev&&ce.call(Nn,"finallyLoc")&&this.prev<Nn.finallyLoc){var At=Nn;break}}At&&(_t==="break"||_t==="continue")&&At.tryLoc<=Rt&&Rt<=At.finallyLoc&&(At=null);var Wn=At?At.completion:{};return Wn.type=_t,Wn.arg=Rt,At?(this.method="next",this.next=At.finallyLoc,mt):this.complete(Wn)},complete:function(_t,Rt){if(_t.type==="throw")throw _t.arg;return _t.type==="break"||_t.type==="continue"?this.next=_t.arg:_t.type==="return"?(this.rval=this.arg=_t.arg,this.method="return",this.next="end"):_t.type==="normal"&&Rt&&(this.next=Rt),mt},finish:function(_t){for(var Rt=this.tryEntries.length-1;Rt>=0;--Rt){var me=this.tryEntries[Rt];if(me.finallyLoc===_t)return this.complete(me.completion,me.afterLoc),Jn(me),mt}},catch:function(_t){for(var Rt=this.tryEntries.length-1;Rt>=0;--Rt){var me=this.tryEntries[Rt];if(me.tryLoc===_t){var Nn=me.completion;if(Nn.type==="throw"){var At=Nn.arg;Jn(me)}return At}}throw new Error("illegal catch attempt")},delegateYield:function(_t,Rt,me){return this.delegate={iterator:Hr(_t),resultName:Rt,nextLoc:me},this.method==="next"&&(this.arg=void 0),mt}},q}(C.exports);try{regeneratorRuntime=U}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=U:Function("r","regeneratorRuntime = r")(U)}});var te,re,ie=function(C){return C&&C.Math==Math&&C},W=ie(typeof globalThis=="object"&&globalThis)||ie(typeof window=="object"&&window)||ie(typeof self=="object"&&self)||ie(typeof $=="object"&&$)||function(){return this}()||Function("return this")(),Y=function(C){try{return!!C()}catch{return!0}},se=!Y(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Ae={}.propertyIsEnumerable,Je=Object.getOwnPropertyDescriptor,Xe={f:Je&&!Ae.call({1:2},1)?function(C){var U=Je(this,C);return!!U&&U.enumerable}:Ae},Ue=function(C,U){return{enumerable:!(1&C),configurable:!(2&C),writable:!(4&C),value:U}},Be={}.toString,Pe=function(C){return Be.call(C).slice(8,-1)},de="".split,Se=Y(function(){return!Object("z").propertyIsEnumerable(0)})?function(C){return Pe(C)=="String"?de.call(C,""):Object(C)}:Object,Ee=function(C){if(C==null)throw TypeError("Can't call method on "+C);return C},ke=function(C){return Se(Ee(C))},De=function(C){return typeof C=="function"},Qe=function(C){return typeof C=="object"?C!==null:De(C)},vt=function(C){return De(C)?C:void 0},ft=function(C,U){return arguments.length<2?vt(W[C]):W[C]&&W[C][U]},it=ft("navigator","userAgent")||"",ut=W.process,ee=W.Deno,xe=ut&&ut.versions||ee&&ee.version,Et=xe&&xe.v8;Et?re=(te=Et.split("."))[0]<4?1:te[0]+te[1]:it&&(!(te=it.match(/Edge\/(\d+)/))||te[1]>=74)&&(te=it.match(/Chrome\/(\d+)/))&&(re=te[1]);var Fn=re&&+re,Fr=!!Object.getOwnPropertySymbols&&!Y(function(){var C=Symbol();return!String(C)||!(Object(C)instanceof Symbol)||!Symbol.sham&&Fn&&Fn<41}),dt=Fr&&!Symbol.sham&&typeof Symbol.iterator=="symbol",ai=dt?function(C){return typeof C=="symbol"}:function(C){var U=ft("Symbol");return De(U)&&Object(C)instanceof U},bi=function(C){try{return String(C)}catch{return"Object"}},dr=function(C){if(De(C))return C;throw TypeError(bi(C)+" is not a function")},Gn=function(C,U){var q=C[U];return q==null?void 0:dr(q)},Ai=function(C,U){try{Object.defineProperty(W,C,{value:U,configurable:!0,writable:!0})}catch{W[C]=U}return U},si=W["__core-js_shared__"]||Ai("__core-js_shared__",{}),Nr=B(function(C){(C.exports=function(U,q){return si[U]||(si[U]=q!==void 0?q:{})})("versions",[]).push({version:"3.18.2",mode:"global",copyright:"\xA9 2021 Denis Pushkarev (zloirock.ru)"})}),_i=function(C){return Object(Ee(C))},ve={}.hasOwnProperty,qn=Object.hasOwn||function(C,U){return ve.call(_i(C),U)},ho=0,hr=Math.random(),Ki=function(C){return"Symbol("+String(C===void 0?"":C)+")_"+(++ho+hr).toString(36)},Co=Nr("wks"),qr=W.Symbol,Oo=dt?qr:qr&&qr.withoutSetter||Ki,an=function(C){return qn(Co,C)&&(Fr||typeof Co[C]=="string")||(Fr&&qn(qr,C)?Co[C]=qr[C]:Co[C]=Oo("Symbol."+C)),Co[C]},ur=an("toPrimitive"),bt=function(C,U){if(!Qe(C)||ai(C))return C;var q,J=Gn(C,ur);if(J){if(U===void 0&&(U="default"),q=J.call(C,U),!Qe(q)||ai(q))return q;throw TypeError("Can't convert object to primitive value")}return U===void 0&&(U="number"),function(ce,z){var pe,ye;if(z==="string"&&De(pe=ce.toString)&&!Qe(ye=pe.call(ce))||De(pe=ce.valueOf)&&!Qe(ye=pe.call(ce))||z!=="string"&&De(pe=ce.toString)&&!Qe(ye=pe.call(ce)))return ye;throw TypeError("Can't convert object to primitive value")}(C,U)},xt=function(C){var U=bt(C,"string");return ai(U)?U:String(U)},Qo=W.document,_r=Qe(Qo)&&Qe(Qo.createElement),nt=function(C){return _r?Qo.createElement(C):{}},nn=!se&&!Y(function(){return Object.defineProperty(nt("div"),"a",{get:function(){return 7}}).a!=7}),yi=Object.getOwnPropertyDescriptor,Lr={f:se?yi:function(C,U){if(C=ke(C),U=xt(U),nn)try{return yi(C,U)}catch{}if(qn(C,U))return Ue(!Xe.f.call(C,U),C[U])}},pr=function(C){if(Qe(C))return C;throw TypeError(String(C)+" is not an object")},ma=Object.defineProperty,Ge={f:se?ma:function(C,U,q){if(pr(C),U=xt(U),pr(q),nn)try{return ma(C,U,q)}catch{}if("get"in q||"set"in q)throw TypeError("Accessors not supported");return"value"in q&&(C[U]=q.value),C}},ct=se?function(C,U,q){return Ge.f(C,U,Ue(1,q))}:function(C,U,q){return C[U]=q,C},Mn=Function.toString;De(si.inspectSource)||(si.inspectSource=function(C){return Mn.call(C)});var Vn,rr,No,ci=si.inspectSource,Zo=W.WeakMap,er=De(Zo)&&/native code/.test(ci(Zo)),Ir=Nr("keys"),va=function(C){return Ir[C]||(Ir[C]=Ki(C))},up={},Cd=W.WeakMap;if(er||si.state){var ui=si.state||(si.state=new Cd),ja=ui.get,Kv=ui.has,fr=ui.set;Vn=function(C,U){if(Kv.call(ui,C))throw new TypeError("Object already initialized");return U.facade=C,fr.call(ui,C,U),U},rr=function(C){return ja.call(ui,C)||{}},No=function(C){return Kv.call(ui,C)}}else{var pl=va("state");up[pl]=!0,Vn=function(C,U){if(qn(C,pl))throw new TypeError("Object already initialized");return U.facade=C,ct(C,pl,U),U},rr=function(C){return qn(C,pl)?C[pl]:{}},No=function(C){return qn(C,pl)}}var st={set:Vn,get:rr,has:No,enforce:function(C){return No(C)?rr(C):Vn(C,{})},getterFor:function(C){return function(U){var q;if(!Qe(U)||(q=rr(U)).type!==C)throw TypeError("Incompatible receiver, "+C+" required");return q}}},Wv=Function.prototype,r0=se&&Object.getOwnPropertyDescriptor,vg=qn(Wv,"name"),Wi={EXISTS:vg,PROPER:vg&&function(){}.name==="something",CONFIGURABLE:vg&&(!se||se&&r0(Wv,"name").configurable)},Pr=B(function(C){var U=Wi.CONFIGURABLE,q=st.get,J=st.enforce,ce=String(String).split("String");(C.exports=function(z,pe,ye,ue){var be,He=!!ue&&!!ue.unsafe,gt=!!ue&&!!ue.enumerable,mt=!!ue&&!!ue.noTargetGet,ot=ue&&ue.name!==void 0?ue.name:pe;De(ye)&&(String(ot).slice(0,7)==="Symbol("&&(ot="["+String(ot).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!qn(ye,"name")||U&&ye.name!==ot)&&ct(ye,"name",ot),(be=J(ye)).source||(be.source=ce.join(typeof ot=="string"?ot:""))),z!==W?(He?!mt&&z[pe]&&(gt=!0):delete z[pe],gt?z[pe]=ye:ct(z,pe,ye)):gt?z[pe]=ye:Ai(pe,ye)})(Function.prototype,"toString",function(){return De(this)&&q(this).source||ci(this)})}),Lo=Math.ceil,_g=Math.floor,oc=function(C){var U=+C;return U!=U||U===0?0:(U>0?_g:Lo)(U)},Qt=Math.max,i0=Math.min,qa=function(C,U){var q=oc(C);return q<0?Qt(q+U,0):i0(q,U)},bd=Math.min,Si=function(C){return C>0?bd(oc(C),9007199254740991):0},bo=function(C){return Si(C.length)},zv=function(C){return function(U,q,J){var ce,z=ke(U),pe=bo(z),ye=qa(J,pe);if(C&&q!=q){for(;pe>ye;)if((ce=z[ye++])!=ce)return!0}else for(;pe>ye;ye++)if((C||ye in z)&&z[ye]===q)return C||ye||0;return!C&&-1}},_a={includes:zv(!0),indexOf:zv(!1)},yg=_a.indexOf,lp=function(C,U){var q,J=ke(C),ce=0,z=[];for(q in J)!qn(up,q)&&qn(J,q)&&z.push(q);for(;U.length>ce;)qn(J,q=U[ce++])&&(~yg(z,q)||z.push(q));return z},ki=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Sg=ki.concat("length","prototype"),uu={f:Object.getOwnPropertyNames||function(C){return lp(C,Sg)}},o0={f:Object.getOwnPropertySymbols},Sn=ft("Reflect","ownKeys")||function(C){var U=uu.f(pr(C)),q=o0.f;return q?U.concat(q(C)):U},a0=function(C,U){for(var q=Sn(U),J=Ge.f,ce=Lr.f,z=0;z<q.length;z++){var pe=q[z];qn(C,pe)||J(C,pe,ce(U,pe))}},Ad=/#|\.prototype\./,kd=function(C,U){var q=Hn[Yn(C)];return q==dp||q!=Yv&&(De(U)?Y(U):!!U)},Yn=kd.normalize=function(C){return String(C).replace(Ad,".").toLowerCase()},Hn=kd.data={},Yv=kd.NATIVE="N",dp=kd.POLYFILL="P",ya=kd,Sa=Lr.f,wi=function(C,U){var q,J,ce,z,pe,ye=C.target,ue=C.global,be=C.stat;if(q=ue?W:be?W[ye]||Ai(ye,{}):(W[ye]||{}).prototype)for(J in U){if(z=U[J],ce=C.noTargetGet?(pe=Sa(q,J))&&pe.value:q[J],!ya(ue?J:ye+(be?".":"#")+J,C.forced)&&ce!==void 0){if(typeof z==typeof ce)continue;a0(z,ce)}(C.sham||ce&&ce.sham)&&ct(z,"sham",!0),Pr(q,J,z,C)}},As=function(C,U,q){if(dr(C),U===void 0)return C;switch(q){case 0:return function(){return C.call(U)};case 1:return function(J){return C.call(U,J)};case 2:return function(J,ce){return C.call(U,J,ce)};case 3:return function(J,ce,z){return C.call(U,J,ce,z)}}return function(){return C.apply(U,arguments)}},fl=Array.isArray||function(C){return Pe(C)=="Array"},gl={};gl[an("toStringTag")]="z";var ac,ks=String(gl)==="[object z]",Ig=an("toStringTag"),Jv=Pe(function(){return arguments}())=="Arguments",to=ks?Pe:function(C){var U,q,J;return C===void 0?"Undefined":C===null?"Null":typeof(q=function(ce,z){try{return ce[z]}catch{}}(U=Object(C),Ig))=="string"?q:Jv?Pe(U):(J=Pe(U))=="Object"&&De(U.callee)?"Arguments":J},hp=[],wd=ft("Reflect","construct"),Eg=/^\s*(?:class|function)\b/,ea=Eg.exec,Jr=!Eg.exec(function(){}),lu=function(C){if(!De(C))return!1;try{return wd(Object,hp,C),!0}catch{return!1}},Xv=!wd||Y(function(){var C;return lu(lu.call)||!lu(Object)||!lu(function(){C=!0})||C})?function(C){if(!De(C))return!1;switch(to(C)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}return Jr||!!ea.call(Eg,ci(C))}:lu,sc=an("species"),Tr=function(C,U){return new(function(q){var J;return fl(q)&&(J=q.constructor,(Xv(J)&&(J===Array||fl(J.prototype))||Qe(J)&&(J=J[sc])===null)&&(J=void 0)),J===void 0?Array:J}(C))(U===0?0:U)},lr=[].push,sr=function(C){var U=C==1,q=C==2,J=C==3,ce=C==4,z=C==6,pe=C==7,ye=C==5||z;return function(ue,be,He,gt){for(var mt,ot,Zt=_i(ue),In=Se(Zt),un=As(be,He,3),zt=bo(In),en=0,Pn=gt||Tr,cr=U?Pn(ue,zt):q||pe?Pn(ue,0):void 0;zt>en;en++)if((ye||en in In)&&(ot=un(mt=In[en],en,Zt),C))if(U)cr[en]=ot;else if(ot)switch(C){case 3:return!0;case 5:return mt;case 6:return en;case 2:lr.call(cr,mt)}else switch(C){case 4:return!1;case 7:lr.call(cr,mt)}return z?-1:J||ce?ce:cr}},Ha={forEach:sr(0),map:sr(1),filter:sr(2),some:sr(3),every:sr(4),find:sr(5),findIndex:sr(6),filterReject:sr(7)},$a=an("species"),Ia=Ha.filter,s0=(ac="filter",Fn>=51||!Y(function(){var C=[];return(C.constructor={})[$a]=function(){return{foo:1}},C[ac](Boolean).foo!==1}));wi({target:"Array",proto:!0,forced:!s0},{filter:function(C){return Ia(this,C,arguments.length>1?arguments[1]:void 0)}});var Li=Date.prototype,po=Li.toString,Ea=Li.getTime;String(new Date(NaN))!="Invalid Date"&&Pr(Li,"toString",function(){var C=Ea.call(this);return C==C?po.call(this):"Invalid Date"});var xr=[].slice,Pi={},ml=function(C,U,q){if(!(U in Pi)){for(var J=[],ce=0;ce<U;ce++)J[ce]="a["+ce+"]";Pi[U]=Function("C,a","return new C("+J.join(",")+")")}return Pi[U](C,q)},Dd=Function.bind||function(C){var U=dr(this),q=xr.call(arguments,1),J=function(){var ce=q.concat(xr.call(arguments));return this instanceof J?ml(U,ce.length,ce):U.apply(C,ce)};return Qe(U.prototype)&&(J.prototype=U.prototype),J};wi({target:"Function",proto:!0},{bind:Dd});var Qv=[].slice,Tg=/MSIE .\./.test(it),vl=function(C){return function(U,q){var J=arguments.length>2,ce=J?Qv.call(arguments,2):void 0;return C(J?function(){(De(U)?U:Function(U)).apply(this,ce)}:U,q)}};wi({global:!0,bind:!0,forced:Tg},{setTimeout:vl(W.setTimeout),setInterval:vl(W.setInterval)});var du,cc=Object.keys||function(C){return lp(C,ki)},ta=se?Object.defineProperties:function(C,U){pr(C);for(var q,J=cc(U),ce=J.length,z=0;ce>z;)Ge.f(C,q=J[z++],U[q]);return C},pp=ft("document","documentElement"),Zv=va("IE_PROTO"),fp=function(){},e_=function(C){return"<script>"+C+"<\/script>"},_l=function(C){C.write(e_("")),C.close();var U=C.parentWindow.Object;return C=null,U},uc=function(){try{du=new ActiveXObject("htmlfile")}catch{}var C,U;uc=typeof document<"u"?document.domain&&du?_l(du):((U=nt("iframe")).style.display="none",pp.appendChild(U),U.src=String("javascript:"),(C=U.contentWindow.document).open(),C.write(e_("document.F=Object")),C.close(),C.F):_l(du);for(var q=ki.length;q--;)delete uc.prototype[ki[q]];return uc()};up[Zv]=!0;var Od=Object.create||function(C,U){var q;return C!==null?(fp.prototype=pr(C),q=new fp,fp.prototype=null,q[Zv]=C):q=uc(),U===void 0?q:ta(q,U)},Mg=an("unscopables"),Rg=Array.prototype;Rg[Mg]==null&&Ge.f(Rg,Mg,{configurable:!0,value:Od(null)});var Ta,hu,sn,cn=function(C){Rg[Mg][C]=!0},lc={},Ma=!Y(function(){function C(){}return C.prototype.constructor=null,Object.getPrototypeOf(new C)!==C.prototype}),dc=va("IE_PROTO"),t_=Object.prototype,xi=Ma?Object.getPrototypeOf:function(C){var U=_i(C);if(qn(U,dc))return U[dc];var q=U.constructor;return De(q)&&U instanceof q?q.prototype:U instanceof Object?t_:null},Cg=an("iterator"),fn=!1;[].keys&&("next"in(sn=[].keys())?(hu=xi(xi(sn)))!==Object.prototype&&(Ta=hu):fn=!0),(Ta==null||Y(function(){var C={};return Ta[Cg].call(C)!==C}))&&(Ta={}),De(Ta[Cg])||Pr(Ta,Cg,function(){return this});var hc={IteratorPrototype:Ta,BUGGY_SAFARI_ITERATORS:fn},Ka=Ge.f,yl=an("toStringTag"),Sl=function(C,U,q){C&&!qn(C=q?C:C.prototype,yl)&&Ka(C,yl,{configurable:!0,value:U})},n_=hc.IteratorPrototype,Nd=function(){return this},li=Object.setPrototypeOf||("__proto__"in{}?function(){var C,U=!1,q={};try{(C=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(q,[]),U=q instanceof Array}catch{}return function(J,ce){return pr(J),function(z){if(typeof z=="object"||De(z))return z;throw TypeError("Can't set "+String(z)+" as a prototype")}(ce),U?C.call(J,ce):J.__proto__=ce,J}}():void 0),c0=Wi.PROPER,ws=Wi.CONFIGURABLE,gp=hc.IteratorPrototype,pc=hc.BUGGY_SAFARI_ITERATORS,Il=an("iterator"),r_=function(){return this},El=function(C,U,q,J,ce,z,pe){(function(zt,en,Pn){var cr=en+" Iterator";zt.prototype=Od(n_,{next:Ue(1,Pn)}),Sl(zt,cr,!1),lc[cr]=Nd})(q,U,J);var ye,ue,be,He=function(zt){if(zt===ce&&In)return In;if(!pc&&zt in ot)return ot[zt];switch(zt){case"keys":case"values":case"entries":return function(){return new q(this,zt)}}return function(){return new q(this)}},gt=U+" Iterator",mt=!1,ot=C.prototype,Zt=ot[Il]||ot["@@iterator"]||ce&&ot[ce],In=!pc&&Zt||He(ce),un=U=="Array"&&ot.entries||Zt;if(un&&(ye=xi(un.call(new C)))!==Object.prototype&&ye.next&&(xi(ye)!==gp&&(li?li(ye,gp):De(ye[Il])||Pr(ye,Il,r_)),Sl(ye,gt,!0)),c0&&ce=="values"&&Zt&&Zt.name!=="values"&&(ws?ct(ot,"name","values"):(mt=!0,In=function(){return Zt.call(this)})),ce)if(ue={values:He("values"),keys:z?In:He("keys"),entries:He("entries")},pe)for(be in ue)(pc||mt||!(be in ot))&&Pr(ot,be,ue[be]);else wi({target:U,proto:!0,forced:pc||mt},ue);return ot[Il]!==In&&Pr(ot,Il,In,{name:ce}),lc[U]=In,ue},Ld=st.set,no=st.getterFor("Array Iterator"),Zr=El(Array,"Array",function(C,U){Ld(this,{type:"Array Iterator",target:ke(C),index:0,kind:U})},function(){var C=no(this),U=C.target,q=C.kind,J=C.index++;return!U||J>=U.length?(C.target=void 0,{value:void 0,done:!0}):q=="keys"?{value:J,done:!1}:q=="values"?{value:U[J],done:!1}:{value:[J,U[J]],done:!1}},"values");lc.Arguments=lc.Array,cn("keys"),cn("values"),cn("entries");var mp=uu.f,Tl={}.toString,vp=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],i_={f:function(C){return vp&&Tl.call(C)=="[object Window]"?function(U){try{return mp(U)}catch{return vp.slice()}}(C):mp(ke(C))}},o_=!Y(function(){return Object.isExtensible(Object.preventExtensions({}))}),Ds=B(function(C){var U=Ge.f,q=!1,J=Ki("meta"),ce=0,z=Object.isExtensible||function(){return!0},pe=function(ue){U(ue,J,{value:{objectID:"O"+ce++,weakData:{}}})},ye=C.exports={enable:function(){ye.enable=function(){},q=!0;var ue=uu.f,be=[].splice,He={};He[J]=1,ue(He).length&&(uu.f=function(gt){for(var mt=ue(gt),ot=0,Zt=mt.length;ot<Zt;ot++)if(mt[ot]===J){be.call(mt,ot,1);break}return mt},wi({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:i_.f}))},fastKey:function(ue,be){if(!Qe(ue))return typeof ue=="symbol"?ue:(typeof ue=="string"?"S":"P")+ue;if(!qn(ue,J)){if(!z(ue))return"F";if(!be)return"E";pe(ue)}return ue[J].objectID},getWeakData:function(ue,be){if(!qn(ue,J)){if(!z(ue))return!0;if(!be)return!1;pe(ue)}return ue[J].weakData},onFreeze:function(ue){return o_&&q&&z(ue)&&!qn(ue,J)&&pe(ue),ue}};up[J]=!0}),na=(Ds.enable,Ds.fastKey,Ds.getWeakData,Ds.onFreeze,an("iterator")),a_=Array.prototype,ra=function(C){return C!==void 0&&(lc.Array===C||a_[na]===C)},fc=an("iterator"),Pd=function(C){if(C!=null)return Gn(C,fc)||Gn(C,"@@iterator")||lc[to(C)]},Ml=function(C,U){var q=arguments.length<2?Pd(C):U;if(dr(q))return pr(q.call(C));throw TypeError(String(C)+" is not iterable")},gc=function(C,U,q){var J,ce;pr(C);try{if(!(J=Gn(C,"return"))){if(U==="throw")throw q;return q}J=J.call(C)}catch(z){ce=!0,J=z}if(U==="throw")throw q;if(ce)throw J;return pr(J),q},pu=function(C,U){this.stopped=C,this.result=U},_p=function(C,U,q){var J,ce,z,pe,ye,ue,be,He=q&&q.that,gt=!(!q||!q.AS_ENTRIES),mt=!(!q||!q.IS_ITERATOR),ot=!(!q||!q.INTERRUPTED),Zt=As(U,He,1+gt+ot),In=function(zt){return J&&gc(J,"normal",zt),new pu(!0,zt)},un=function(zt){return gt?(pr(zt),ot?Zt(zt[0],zt[1],In):Zt(zt[0],zt[1])):ot?Zt(zt,In):Zt(zt)};if(mt)J=C;else{if(!(ce=Pd(C)))throw TypeError(String(C)+" is not iterable");if(ra(ce)){for(z=0,pe=bo(C);pe>z;z++)if((ye=un(C[z]))&&ye instanceof pu)return ye;return new pu(!1)}J=Ml(C,ce)}for(ue=J.next;!(be=ue.call(J)).done;){try{ye=un(be.value)}catch(zt){gc(J,"throw",zt)}if(typeof ye=="object"&&ye&&ye instanceof pu)return ye}return new pu(!1)},Ra=function(C,U,q){if(C instanceof U)return C;throw TypeError("Incorrect "+(q?q+" ":"")+"invocation")},Os=an("iterator"),yp=!1;try{var xd=0,bg={next:function(){return{done:!!xd++}},return:function(){yp=!0}};bg[Os]=function(){return this},Array.from(bg,function(){throw 2})}catch{}var Ud=function(C,U){if(!U&&!yp)return!1;var q=!1;try{var J={};J[Os]=function(){return{next:function(){return{done:q=!0}}}},C(J)}catch{}return q},Rl=function(C,U,q){var J,ce;return li&&De(J=U.constructor)&&J!==q&&Qe(ce=J.prototype)&&ce!==q.prototype&&li(C,ce),C},fu=function(C,U,q){for(var J in U)Pr(C,J,U[J],q);return C},Wa=an("species"),Ui=function(C){var U=ft(C),q=Ge.f;se&&U&&!U[Wa]&&q(U,Wa,{configurable:!0,get:function(){return this}})},Cl=Ge.f,Ag=Ds.fastKey,gu=st.set,Sp=st.getterFor,bl=(function(C,U,q){var J=C.indexOf("Map")!==-1,ce=C.indexOf("Weak")!==-1,z=J?"set":"add",pe=W[C],ye=pe&&pe.prototype,ue=pe,be={},He=function(un){var zt=ye[un];Pr(ye,un,un=="add"?function(en){return zt.call(this,en===0?0:en),this}:un=="delete"?function(en){return!(ce&&!Qe(en))&&zt.call(this,en===0?0:en)}:un=="get"?function(en){return ce&&!Qe(en)?void 0:zt.call(this,en===0?0:en)}:un=="has"?function(en){return!(ce&&!Qe(en))&&zt.call(this,en===0?0:en)}:function(en,Pn){return zt.call(this,en===0?0:en,Pn),this})};if(ya(C,!De(pe)||!(ce||ye.forEach&&!Y(function(){new pe().entries().next()}))))ue=q.getConstructor(U,C,J,z),Ds.enable();else if(ya(C,!0)){var gt=new ue,mt=gt[z](ce?{}:-0,1)!=gt,ot=Y(function(){gt.has(1)}),Zt=Ud(function(un){new pe(un)}),In=!ce&&Y(function(){for(var un=new pe,zt=5;zt--;)un[z](zt,zt);return!un.has(-0)});Zt||((ue=U(function(un,zt){Ra(un,ue,C);var en=Rl(new pe,un,ue);return zt!=null&&_p(zt,en[z],{that:en,AS_ENTRIES:J}),en})).prototype=ye,ye.constructor=ue),(ot||In)&&(He("delete"),He("has"),J&&He("get")),(In||mt)&&He(z),ce&&ye.clear&&delete ye.clear}be[C]=ue,wi({global:!0,forced:ue!=pe},be),Sl(ue,C),ce||q.setStrong(ue,C,J)}("Map",function(C){return function(){return C(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(C,U,q,J){var ce=C(function(ue,be){Ra(ue,ce,U),gu(ue,{type:U,index:Od(null),first:void 0,last:void 0,size:0}),se||(ue.size=0),be!=null&&_p(be,ue[J],{that:ue,AS_ENTRIES:q})}),z=Sp(U),pe=function(ue,be,He){var gt,mt,ot=z(ue),Zt=ye(ue,be);return Zt?Zt.value=He:(ot.last=Zt={index:mt=Ag(be,!0),key:be,value:He,previous:gt=ot.last,next:void 0,removed:!1},ot.first||(ot.first=Zt),gt&&(gt.next=Zt),se?ot.size++:ue.size++,mt!=="F"&&(ot.index[mt]=Zt)),ue},ye=function(ue,be){var He,gt=z(ue),mt=Ag(be);if(mt!=="F")return gt.index[mt];for(He=gt.first;He;He=He.next)if(He.key==be)return He};return fu(ce.prototype,{clear:function(){for(var ue=z(this),be=ue.index,He=ue.first;He;)He.removed=!0,He.previous&&(He.previous=He.previous.next=void 0),delete be[He.index],He=He.next;ue.first=ue.last=void 0,se?ue.size=0:this.size=0},delete:function(ue){var be=z(this),He=ye(this,ue);if(He){var gt=He.next,mt=He.previous;delete be.index[He.index],He.removed=!0,mt&&(mt.next=gt),gt&&(gt.previous=mt),be.first==He&&(be.first=gt),be.last==He&&(be.last=mt),se?be.size--:this.size--}return!!He},forEach:function(ue){for(var be,He=z(this),gt=As(ue,arguments.length>1?arguments[1]:void 0,3);be=be?be.next:He.first;)for(gt(be.value,be.key,this);be&&be.removed;)be=be.previous},has:function(ue){return!!ye(this,ue)}}),fu(ce.prototype,q?{get:function(ue){var be=ye(this,ue);return be&&be.value},set:function(ue,be){return pe(this,ue===0?0:ue,be)}}:{add:function(ue){return pe(this,ue=ue===0?0:ue,ue)}}),se&&Cl(ce.prototype,"size",{get:function(){return z(this).size}}),ce},setStrong:function(C,U,q){var J=U+" Iterator",ce=Sp(U),z=Sp(J);El(C,U,function(pe,ye){gu(this,{type:J,target:pe,state:ce(pe),kind:ye,last:void 0})},function(){for(var pe=z(this),ye=pe.kind,ue=pe.last;ue&&ue.removed;)ue=ue.previous;return pe.target&&(pe.last=ue=ue?ue.next:pe.state.first)?ye=="keys"?{value:ue.key,done:!1}:ye=="values"?{value:ue.value,done:!1}:{value:[ue.key,ue.value],done:!1}:(pe.target=void 0,{value:void 0,done:!0})},q?"entries":"values",!q,!0),Ui(U)}}),ks?{}.toString:function(){return"[object "+to(this)+"]"});ks||Pr(Object.prototype,"toString",bl,{unsafe:!0});var ro=function(C){if(to(C)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return String(C)},Ip=function(C){return function(U,q){var J,ce,z=ro(Ee(U)),pe=oc(q),ye=z.length;return pe<0||pe>=ye?C?"":void 0:(J=z.charCodeAt(pe))<55296||J>56319||pe+1===ye||(ce=z.charCodeAt(pe+1))<56320||ce>57343?C?z.charAt(pe):J:C?z.slice(pe,pe+2):ce-56320+(J-55296<<10)+65536}},gn={codeAt:Ip(!1),charAt:Ip(!0)},kg=gn.charAt,Al=st.set,s_=st.getterFor("String Iterator");El(String,"String",function(C){Al(this,{type:"String Iterator",string:ro(C),index:0})},function(){var C,U=s_(this),q=U.string,J=U.index;return J>=q.length?{value:void 0,done:!0}:(C=kg(q,J),U.index+=C.length,{value:C,done:!1})});var mc={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Gi=nt("span").classList,mu=Gi&&Gi.constructor&&Gi.constructor.prototype,wg=mu===Object.prototype?void 0:mu,Ep=an("iterator"),kl=an("toStringTag"),za=Zr.values,Dg=function(C,U){if(C){if(C[Ep]!==za)try{ct(C,Ep,za)}catch{C[Ep]=za}if(C[kl]||ct(C,kl,U),mc[U]){for(var q in Zr)if(C[q]!==Zr[q])try{ct(C,q,Zr[q])}catch{C[q]=Zr[q]}}}};for(var vc in mc)Dg(W[vc]&&W[vc].prototype,vc);Dg(wg,"DOMTokenList");var Og=typeof ArrayBuffer<"u"&&typeof DataView<"u",Po=function(C){if(C===void 0)return 0;var U=oc(C),q=Si(U);if(U!==q)throw RangeError("Wrong length or index");return q},Ng=Math.abs,io=Math.pow,Lg=Math.floor,Pg=Math.log,c_=Math.LN2,xg=function(C,U,q){var J,ce,z,pe=new Array(q),ye=8*q-U-1,ue=(1<<ye)-1,be=ue>>1,He=U===23?io(2,-24)-io(2,-77):0,gt=C<0||C===0&&1/C<0?1:0,mt=0;for((C=Ng(C))!=C||C===1/0?(ce=C!=C?1:0,J=ue):(J=Lg(Pg(C)/c_),C*(z=io(2,-J))<1&&(J--,z*=2),(C+=J+be>=1?He/z:He*io(2,1-be))*z>=2&&(J++,z/=2),J+be>=ue?(ce=0,J=ue):J+be>=1?(ce=(C*z-1)*io(2,U),J+=be):(ce=C*io(2,be-1)*io(2,U),J=0));U>=8;pe[mt++]=255&ce,ce/=256,U-=8);for(J=J<<U|ce,ye+=U;ye>0;pe[mt++]=255&J,J/=256,ye-=8);return pe[--mt]|=128*gt,pe},Gd=function(C,U){var q,J=C.length,ce=8*J-U-1,z=(1<<ce)-1,pe=z>>1,ye=ce-7,ue=J-1,be=C[ue--],He=127&be;for(be>>=7;ye>0;He=256*He+C[ue],ue--,ye-=8);for(q=He&(1<<-ye)-1,He>>=-ye,ye+=U;ye>0;q=256*q+C[ue],ue--,ye-=8);if(He===0)He=1-pe;else{if(He===z)return q?NaN:be?-1/0:1/0;q+=io(2,U),He-=pe}return(be?-1:1)*q*io(2,He-U)},Ug=function(C){for(var U=_i(this),q=bo(U),J=arguments.length,ce=qa(J>1?arguments[1]:void 0,q),z=J>2?arguments[2]:void 0,pe=z===void 0?q:qa(z,q);pe>ce;)U[ce++]=C;return U},_c=uu.f,Gg=Ge.f,Fg=Wi.PROPER,Vg=Wi.CONFIGURABLE,yc=st.get,Bg=st.set,Ao=W.ArrayBuffer,oo=Ao,xo=W.DataView,wl=xo&&xo.prototype,Fd=Object.prototype,vu=W.RangeError,fo=xg,Sc=Gd,Vd=function(C){return[255&C]},Dl=function(C){return[255&C,C>>8&255]},Bd=function(C){return[255&C,C>>8&255,C>>16&255,C>>24&255]},jg=function(C){return C[3]<<24|C[2]<<16|C[1]<<8|C[0]},ia=function(C){return fo(C,23,4)},_u=function(C){return fo(C,52,8)},Tp=function(C,U){Gg(C.prototype,U,{get:function(){return yc(this)[U]}})},Ca=function(C,U,q,J){var ce=Po(q),z=yc(C);if(ce+U>z.byteLength)throw vu("Wrong index");var pe=yc(z.buffer).bytes,ye=ce+z.byteOffset,ue=pe.slice(ye,ye+U);return J?ue:ue.reverse()},Ns=function(C,U,q,J,ce,z){var pe=Po(q),ye=yc(C);if(pe+U>ye.byteLength)throw vu("Wrong index");for(var ue=yc(ye.buffer).bytes,be=pe+ye.byteOffset,He=J(+ce),gt=0;gt<U;gt++)ue[be+gt]=He[z?gt:U-gt-1]};if(Og){var Mp=Fg&&Ao.name!=="ArrayBuffer";if(Y(function(){Ao(1)})&&Y(function(){new Ao(-1)})&&!Y(function(){return new Ao,new Ao(1.5),new Ao(NaN),Mp&&!Vg}))Mp&&Vg&&ct(Ao,"name","ArrayBuffer");else{for(var di,u_=(oo=function(C){return Ra(this,oo),new Ao(Po(C))}).prototype=Ao.prototype,jd=_c(Ao),Ic=0;jd.length>Ic;)(di=jd[Ic++])in oo||ct(oo,di,Ao[di]);u_.constructor=oo}li&&xi(wl)!==Fd&&li(wl,Fd);var Ls=new xo(new oo(2)),Ec=wl.setInt8;Ls.setInt8(0,2147483648),Ls.setInt8(1,2147483649),!Ls.getInt8(0)&&Ls.getInt8(1)||fu(wl,{setInt8:function(C,U){Ec.call(this,C,U<<24>>24)},setUint8:function(C,U){Ec.call(this,C,U<<24>>24)}},{unsafe:!0})}else oo=function(C){Ra(this,oo,"ArrayBuffer");var U=Po(C);Bg(this,{bytes:Ug.call(new Array(U),0),byteLength:U}),se||(this.byteLength=U)},xo=function(C,U,q){Ra(this,xo,"DataView"),Ra(C,oo,"DataView");var J=yc(C).byteLength,ce=oc(U);if(ce<0||ce>J)throw vu("Wrong offset");if(ce+(q=q===void 0?J-ce:Si(q))>J)throw vu("Wrong length");Bg(this,{buffer:C,byteLength:q,byteOffset:ce}),se||(this.buffer=C,this.byteLength=q,this.byteOffset=ce)},se&&(Tp(oo,"byteLength"),Tp(xo,"buffer"),Tp(xo,"byteLength"),Tp(xo,"byteOffset")),fu(xo.prototype,{getInt8:function(C){return Ca(this,1,C)[0]<<24>>24},getUint8:function(C){return Ca(this,1,C)[0]},getInt16:function(C){var U=Ca(this,2,C,arguments.length>1?arguments[1]:void 0);return(U[1]<<8|U[0])<<16>>16},getUint16:function(C){var U=Ca(this,2,C,arguments.length>1?arguments[1]:void 0);return U[1]<<8|U[0]},getInt32:function(C){return jg(Ca(this,4,C,arguments.length>1?arguments[1]:void 0))},getUint32:function(C){return jg(Ca(this,4,C,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(C){return Sc(Ca(this,4,C,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(C){return Sc(Ca(this,8,C,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(C,U){Ns(this,1,C,Vd,U)},setUint8:function(C,U){Ns(this,1,C,Vd,U)},setInt16:function(C,U){Ns(this,2,C,Dl,U,arguments.length>2?arguments[2]:void 0)},setUint16:function(C,U){Ns(this,2,C,Dl,U,arguments.length>2?arguments[2]:void 0)},setInt32:function(C,U){Ns(this,4,C,Bd,U,arguments.length>2?arguments[2]:void 0)},setUint32:function(C,U){Ns(this,4,C,Bd,U,arguments.length>2?arguments[2]:void 0)},setFloat32:function(C,U){Ns(this,4,C,ia,U,arguments.length>2?arguments[2]:void 0)},setFloat64:function(C,U){Ns(this,8,C,_u,U,arguments.length>2?arguments[2]:void 0)}});Sl(oo,"ArrayBuffer"),Sl(xo,"DataView");var Ya={ArrayBuffer:oo,DataView:xo},qd=function(C){if(Xv(C))return C;throw TypeError(bi(C)+" is not a constructor")},l_=an("species"),Tc=function(C,U){var q,J=pr(C).constructor;return J===void 0||(q=pr(J)[l_])==null?U:qd(q)},Mc=Ya.ArrayBuffer,mn=Ya.DataView,Z=Mc.prototype.slice,ba=Y(function(){return!new Mc(2).slice(1,void 0).byteLength});wi({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:ba},{slice:function(C,U){if(Z!==void 0&&U===void 0)return Z.call(pr(this),C);for(var q=pr(this).byteLength,J=qa(C,q),ce=qa(U===void 0?q:U,q),z=new(Tc(this,Mc))(Si(ce-J)),pe=new mn(this),ye=new mn(z),ue=0;J<ce;)ye.setUint8(ue++,pe.getUint8(J++));return z}});var go,mo,Ol,Rp=Ge.f,Nl=W.Int8Array,Cp=Nl&&Nl.prototype,qg=W.Uint8ClampedArray,Uo=qg&&qg.prototype,Ja=Nl&&xi(Nl),Aa=Cp&&xi(Cp),Hg=Object.prototype,u0=Hg.isPrototypeOf,d_=an("toStringTag"),hi=Ki("TYPED_ARRAY_TAG"),$g=Ki("TYPED_ARRAY_CONSTRUCTOR"),Xa=Og&&!!li&&to(W.opera)!=="Opera",Kg=!1,Go={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Rc={BigInt64Array:8,BigUint64Array:8},h_=function(C){if(!Qe(C))return!1;var U=to(C);return qn(Go,U)||qn(Rc,U)};for(go in Go)(Ol=(mo=W[go])&&mo.prototype)?ct(Ol,$g,mo):Xa=!1;for(go in Rc)(Ol=(mo=W[go])&&mo.prototype)&&ct(Ol,$g,mo);if((!Xa||!De(Ja)||Ja===Function.prototype)&&(Ja=function(){throw TypeError("Incorrect invocation")},Xa))for(go in Go)W[go]&&li(W[go],Ja);if((!Xa||!Aa||Aa===Hg)&&(Aa=Ja.prototype,Xa))for(go in Go)W[go]&&li(W[go].prototype,Aa);if(Xa&&xi(Uo)!==Aa&&li(Uo,Aa),se&&!qn(Aa,d_))for(go in Kg=!0,Rp(Aa,d_,{get:function(){return Qe(this)?this[hi]:void 0}}),Go)W[go]&&ct(W[go],hi,go);var rn={NATIVE_ARRAY_BUFFER_VIEWS:Xa,TYPED_ARRAY_CONSTRUCTOR:$g,TYPED_ARRAY_TAG:Kg&&hi,aTypedArray:function(C){if(h_(C))return C;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(C){if(De(C)&&(!li||u0.call(Ja,C)))return C;throw TypeError(bi(C)+" is not a typed array constructor")},exportTypedArrayMethod:function(C,U,q){if(se){if(q)for(var J in Go){var ce=W[J];if(ce&&qn(ce.prototype,C))try{delete ce.prototype[C]}catch{}}Aa[C]&&!q||Pr(Aa,C,q?U:Xa&&Cp[C]||U)}},exportTypedArrayStaticMethod:function(C,U,q){var J,ce;if(se){if(li){if(q){for(J in Go)if((ce=W[J])&&qn(ce,C))try{delete ce[C]}catch{}}if(Ja[C]&&!q)return;try{return Pr(Ja,C,q?U:Xa&&Ja[C]||U)}catch{}}for(J in Go)!(ce=W[J])||ce[C]&&!q||Pr(ce,C,U)}},isView:function(C){if(!Qe(C))return!1;var U=to(C);return U==="DataView"||qn(Go,U)||qn(Rc,U)},isTypedArray:h_,TypedArray:Ja,TypedArrayPrototype:Aa},l0=rn.NATIVE_ARRAY_BUFFER_VIEWS,Wg=W.ArrayBuffer,Ps=W.Int8Array,Cc=!l0||!Y(function(){Ps(1)})||!Y(function(){new Ps(-1)})||!Ud(function(C){new Ps,new Ps(null),new Ps(1.5),new Ps(C)},!0)||Y(function(){return new Ps(new Wg(2),1,void 0).length!==1}),p_=Math.floor,yu=Number.isInteger||function(C){return!Qe(C)&&isFinite(C)&&p_(C)===C},bp=function(C,U){var q=function(J){var ce=oc(J);if(ce<0)throw RangeError("The argument can't be less than 0");return ce}(C);if(q%U)throw RangeError("Wrong offset");return q},d0=rn.aTypedArrayConstructor,Vr=function(C){var U,q,J,ce,z,pe,ye=qd(this),ue=_i(C),be=arguments.length,He=be>1?arguments[1]:void 0,gt=He!==void 0,mt=Pd(ue);if(mt&&!ra(mt))for(pe=(z=Ml(ue,mt)).next,ue=[];!(ce=pe.call(z)).done;)ue.push(ce.value);for(gt&&be>2&&(He=As(He,arguments[2],2)),q=bo(ue),J=new(d0(ye))(q),U=0;q>U;U++)J[U]=gt?He(ue[U],U):ue[U];return J};B(function(C){var U=uu.f,q=Ha.forEach,J=st.get,ce=st.set,z=Ge.f,pe=Lr.f,ye=Math.round,ue=W.RangeError,be=Ya.ArrayBuffer,He=Ya.DataView,gt=rn.NATIVE_ARRAY_BUFFER_VIEWS,mt=rn.TYPED_ARRAY_CONSTRUCTOR,ot=rn.TYPED_ARRAY_TAG,Zt=rn.TypedArray,In=rn.TypedArrayPrototype,un=rn.aTypedArrayConstructor,zt=rn.isTypedArray,en=function(Jn,Bn){for(var Hr=0,ei=Bn.length,_t=new(un(Jn))(ei);ei>Hr;)_t[Hr]=Bn[Hr++];return _t},Pn=function(Jn,Bn){z(Jn,Bn,{get:function(){return J(this)[Bn]}})},cr=function(Jn){var Bn;return Jn instanceof be||(Bn=to(Jn))=="ArrayBuffer"||Bn=="SharedArrayBuffer"},ao=function(Jn,Bn){return zt(Jn)&&!ai(Bn)&&Bn in Jn&&yu(+Bn)&&Bn>=0},Fi=function(Jn,Bn){return Bn=xt(Bn),ao(Jn,Bn)?Ue(2,Jn[Bn]):pe(Jn,Bn)},so=function(Jn,Bn,Hr){return Bn=xt(Bn),!(ao(Jn,Bn)&&Qe(Hr)&&qn(Hr,"value"))||qn(Hr,"get")||qn(Hr,"set")||Hr.configurable||qn(Hr,"writable")&&!Hr.writable||qn(Hr,"enumerable")&&!Hr.enumerable?z(Jn,Bn,Hr):(Jn[Bn]=Hr.value,Jn)};se?(gt||(Lr.f=Fi,Ge.f=so,Pn(In,"buffer"),Pn(In,"byteOffset"),Pn(In,"byteLength"),Pn(In,"length")),wi({target:"Object",stat:!0,forced:!gt},{getOwnPropertyDescriptor:Fi,defineProperty:so}),C.exports=function(Jn,Bn,Hr){var ei=Jn.match(/\d+$/)[0]/8,_t=Jn+(Hr?"Clamped":"")+"Array",Rt="get"+Jn,me="set"+Jn,Nn=W[_t],At=Nn,Wn=At&&At.prototype,$r={},Di=function(Kr,Xt){z(Kr,Xt,{get:function(){return function(tr,Oi){var tn=J(tr);return tn.view[Rt](Oi*ei+tn.byteOffset,!0)}(this,Xt)},set:function(tr){return function(Oi,tn,Xn){var Rn=J(Oi);Hr&&(Xn=(Xn=ye(Xn))<0?0:Xn>255?255:255&Xn),Rn.view[me](tn*ei+Rn.byteOffset,Xn,!0)}(this,Xt,tr)},enumerable:!0})};gt?Cc&&(At=Bn(function(Kr,Xt,tr,Oi){return Ra(Kr,At,_t),Rl(Qe(Xt)?cr(Xt)?Oi!==void 0?new Nn(Xt,bp(tr,ei),Oi):tr!==void 0?new Nn(Xt,bp(tr,ei)):new Nn(Xt):zt(Xt)?en(At,Xt):Vr.call(At,Xt):new Nn(Po(Xt)),Kr,At)}),li&&li(At,Zt),q(U(Nn),function(Kr){Kr in At||ct(At,Kr,Nn[Kr])}),At.prototype=Wn):(At=Bn(function(Kr,Xt,tr,Oi){Ra(Kr,At,_t);var tn,Xn,Rn,co=0,$n=0;if(Qe(Xt)){if(!cr(Xt))return zt(Xt)?en(At,Xt):Vr.call(At,Xt);tn=Xt,$n=bp(tr,ei);var fh=Xt.byteLength;if(Oi===void 0){if(fh%ei||(Xn=fh-$n)<0)throw ue("Wrong length")}else if((Xn=Si(Oi)*ei)+$n>fh)throw ue("Wrong length");Rn=Xn/ei}else Rn=Po(Xt),tn=new be(Xn=Rn*ei);for(ce(Kr,{buffer:tn,byteOffset:$n,byteLength:Xn,length:Rn,view:new He(tn)});co<Rn;)Di(Kr,co++)}),li&&li(At,Zt),Wn=At.prototype=Od(In)),Wn.constructor!==At&&ct(Wn,"constructor",At),ct(Wn,mt,At),ot&&ct(Wn,ot,_t),$r[_t]=At,wi({global:!0,forced:At!=Nn,sham:!gt},$r),"BYTES_PER_ELEMENT"in At||ct(At,"BYTES_PER_ELEMENT",ei),"BYTES_PER_ELEMENT"in Wn||ct(Wn,"BYTES_PER_ELEMENT",ei),Ui(_t)}):C.exports=function(){}})("Float32",function(C){return function(U,q,J){return C(this,U,q,J)}});var Ap=Math.min,f_=[].copyWithin||function(C,U){var q=_i(this),J=bo(q),ce=qa(C,J),z=qa(U,J),pe=arguments.length>2?arguments[2]:void 0,ye=Ap((pe===void 0?J:qa(pe,J))-z,J-ce),ue=1;for(z<ce&&ce<z+ye&&(ue=-1,z+=ye-1,ce+=ye-1);ye-- >0;)z in q?q[ce]=q[z]:delete q[ce],ce+=ue,z+=ue;return q},g_=rn.aTypedArray;(0,rn.exportTypedArrayMethod)("copyWithin",function(C,U){return f_.call(g_(this),C,U,arguments.length>2?arguments[2]:void 0)});var Hd=Ha.every,kp=rn.aTypedArray;(0,rn.exportTypedArrayMethod)("every",function(C){return Hd(kp(this),C,arguments.length>1?arguments[1]:void 0)});var zg=rn.aTypedArray;(0,rn.exportTypedArrayMethod)("fill",function(C){return Ug.apply(zg(this),arguments)});var wp=rn.TYPED_ARRAY_CONSTRUCTOR,ka=rn.aTypedArrayConstructor,$d=function(C){return ka(Tc(C,C[wp]))},Yg=function(C,U){return function(q,J){for(var ce=0,z=J.length,pe=new q(z);z>ce;)pe[ce]=J[ce++];return pe}($d(C),U)},Jg=Ha.filter,m_=rn.aTypedArray;(0,rn.exportTypedArrayMethod)("filter",function(C){var U=Jg(m_(this),C,arguments.length>1?arguments[1]:void 0);return Yg(this,U)});var Su=Ha.find,v_=rn.aTypedArray;(0,rn.exportTypedArrayMethod)("find",function(C){return Su(v_(this),C,arguments.length>1?arguments[1]:void 0)});var bc=Ha.findIndex,Kd=rn.aTypedArray;(0,rn.exportTypedArrayMethod)("findIndex",function(C){return bc(Kd(this),C,arguments.length>1?arguments[1]:void 0)});var h0=Ha.forEach,Wd=rn.aTypedArray;(0,rn.exportTypedArrayMethod)("forEach",function(C){h0(Wd(this),C,arguments.length>1?arguments[1]:void 0)});var __=_a.includes,Dp=rn.aTypedArray;(0,rn.exportTypedArrayMethod)("includes",function(C){return __(Dp(this),C,arguments.length>1?arguments[1]:void 0)});var p0=_a.indexOf,oa=rn.aTypedArray;(0,rn.exportTypedArrayMethod)("indexOf",function(C){return p0(oa(this),C,arguments.length>1?arguments[1]:void 0)});var Xg=Wi.PROPER,Qg=an("iterator"),zd=W.Uint8Array,Op=Zr.values,Zg=Zr.keys,Np=Zr.entries,Lp=rn.aTypedArray,Qa=rn.exportTypedArrayMethod,Yd=zd&&zd.prototype[Qg],Iu=!!Yd&&Yd.name==="values",Pp=function(){return Op.call(Lp(this))};Qa("entries",function(){return Np.call(Lp(this))}),Qa("keys",function(){return Zg.call(Lp(this))}),Qa("values",Pp,Xg&&!Iu),Qa(Qg,Pp,Xg&&!Iu);var Ll=rn.aTypedArray,xp=[].join;(0,rn.exportTypedArrayMethod)("join",function(C){return xp.apply(Ll(this),arguments)});var Jd=function(C,U){var q=[][C];return!!q&&Y(function(){q.call(null,U||function(){throw 1},1)})},y_=Math.min,em=[].lastIndexOf,hn=!!em&&1/[1].lastIndexOf(1,-0)<0,S_=Jd("lastIndexOf"),I_=hn||!S_?function(C){if(hn)return em.apply(this,arguments)||0;var U=ke(this),q=bo(U),J=q-1;for(arguments.length>1&&(J=y_(J,oc(arguments[1]))),J<0&&(J=q+J);J>=0;J--)if(J in U&&U[J]===C)return J||0;return-1}:em,f0=rn.aTypedArray;(0,rn.exportTypedArrayMethod)("lastIndexOf",function(C){return I_.apply(f0(this),arguments)});var E_=Ha.map,tm=rn.aTypedArray;(0,rn.exportTypedArrayMethod)("map",function(C){return E_(tm(this),C,arguments.length>1?arguments[1]:void 0,function(U,q){return new($d(U))(q)})});var Up=function(C){return function(U,q,J,ce){dr(q);var z=_i(U),pe=Se(z),ye=bo(z),ue=C?ye-1:0,be=C?-1:1;if(J<2)for(;;){if(ue in pe){ce=pe[ue],ue+=be;break}if(ue+=be,C?ue<0:ye<=ue)throw TypeError("Reduce of empty array with no initial value")}for(;C?ue>=0:ye>ue;ue+=be)ue in pe&&(ce=q(ce,pe[ue],ue,z));return ce}},Gp={left:Up(!1),right:Up(!0)},g0=Gp.left,Pl=rn.aTypedArray;(0,rn.exportTypedArrayMethod)("reduce",function(C){return g0(Pl(this),C,arguments.length,arguments.length>1?arguments[1]:void 0)});var nm=Gp.right,xl=rn.aTypedArray;(0,rn.exportTypedArrayMethod)("reduceRight",function(C){return nm(xl(this),C,arguments.length,arguments.length>1?arguments[1]:void 0)});var rm=rn.aTypedArray,im=rn.exportTypedArrayMethod,Fp=Math.floor;im("reverse",function(){for(var C,U=rm(this).length,q=Fp(U/2),J=0;J<q;)C=this[J],this[J++]=this[--U],this[U]=C;return this});var Xd=rn.aTypedArray;(0,rn.exportTypedArrayMethod)("set",function(C){Xd(this);var U=bp(arguments.length>1?arguments[1]:void 0,1),q=this.length,J=_i(C),ce=bo(J),z=0;if(ce+U>q)throw RangeError("Wrong length");for(;z<ce;)this[U+z]=J[z++]},Y(function(){new Int8Array(1).set({})}));var Eu=rn.aTypedArray,om=[].slice;(0,rn.exportTypedArrayMethod)("slice",function(C,U){for(var q=om.call(Eu(this),C,U),J=$d(this),ce=0,z=q.length,pe=new J(z);z>ce;)pe[ce]=q[ce++];return pe},Y(function(){new Int8Array(1).slice()}));var T_=Ha.some,am=rn.aTypedArray;(0,rn.exportTypedArrayMethod)("some",function(C){return T_(am(this),C,arguments.length>1?arguments[1]:void 0)});var M_=Math.floor,wa=function(C,U){var q=C.length,J=M_(q/2);return q<8?Ac(C,U):R_(wa(C.slice(0,J),U),wa(C.slice(J),U),U)},Ac=function(C,U){for(var q,J,ce=C.length,z=1;z<ce;){for(J=z,q=C[z];J&&U(C[J-1],q)>0;)C[J]=C[--J];J!==z++&&(C[J]=q)}return C},R_=function(C,U,q){for(var J=C.length,ce=U.length,z=0,pe=0,ye=[];z<J||pe<ce;)z<J&&pe<ce?ye.push(q(C[z],U[pe])<=0?C[z++]:U[pe++]):ye.push(z<J?C[z++]:U[pe++]);return ye},xs=wa,C_=it.match(/firefox\/(\d+)/i),b_=!!C_&&+C_[1],A_=/MSIE|Trident/.test(it),sm=it.match(/AppleWebKit\/(\d+)\./),Vp=!!sm&&+sm[1],kc=rn.aTypedArray,m0=rn.exportTypedArrayMethod,Bp=W.Uint16Array,Da=Bp&&Bp.prototype.sort,cm=!!Da&&!Y(function(){var C=new Bp(2);C.sort(null),C.sort({})}),Ul=!!Da&&!Y(function(){if(Fn)return Fn<74;if(b_)return b_<67;if(A_)return!0;if(Vp)return Vp<602;var C,U,q=new Bp(516),J=Array(516);for(C=0;C<516;C++)U=C%4,q[C]=515-C,J[C]=C-2*U+3;for(q.sort(function(ce,z){return(ce/4|0)-(z/4|0)}),C=0;C<516;C++)if(q[C]!==J[C])return!0});m0("sort",function(C){if(C!==void 0&&dr(C),Ul)return Da.call(this,C);kc(this);var U,q=bo(this),J=Array(q);for(U=0;U<q;U++)J[U]=this[U];for(J=xs(this,function(ce){return function(z,pe){return ce!==void 0?+ce(z,pe)||0:pe!=pe?-1:z!=z?1:z===0&&pe===0?1/z>0&&1/pe<0?1:-1:z>pe}}(C)),U=0;U<q;U++)this[U]=J[U];return this},!Ul||cm);var v0=rn.aTypedArray;(0,rn.exportTypedArrayMethod)("subarray",function(C,U){var q=v0(this),J=q.length,ce=qa(C,J);return new($d(q))(q.buffer,q.byteOffset+ce*q.BYTES_PER_ELEMENT,Si((U===void 0?J:qa(U,J))-ce))});var wc=W.Int8Array,um=rn.aTypedArray,lm=rn.exportTypedArrayMethod,k_=[].toLocaleString,_0=[].slice,y0=!!wc&&Y(function(){k_.call(new wc(1))});lm("toLocaleString",function(){return k_.apply(y0?_0.call(um(this)):um(this),arguments)},Y(function(){return[1,2].toLocaleString()!=new wc([1,2]).toLocaleString()})||!Y(function(){wc.prototype.toLocaleString.call([1,2])}));var dm=rn.exportTypedArrayMethod,jp=W.Uint8Array,w_=jp&&jp.prototype||{},Qd=[].toString,Dc=[].join;Y(function(){Qd.call({})})&&(Qd=function(){return Dc.call(this)});var hm=w_.toString!=Qd;dm("toString",Qd,hm);var Zd=function(){var C=pr(this),U="";return C.global&&(U+="g"),C.ignoreCase&&(U+="i"),C.multiline&&(U+="m"),C.dotAll&&(U+="s"),C.unicode&&(U+="u"),C.sticky&&(U+="y"),U},D_=W.RegExp,Gl={UNSUPPORTED_Y:Y(function(){var C=D_("a","y");return C.lastIndex=2,C.exec("abcd")!=null}),BROKEN_CARET:Y(function(){var C=D_("^r","gy");return C.lastIndex=2,C.exec("str")!=null})},pm=W.RegExp,eh=Y(function(){var C=pm(".","s");return!(C.dotAll&&C.exec(`
`)&&C.flags==="s")}),S0=W.RegExp,Oc=Y(function(){var C=S0("(?<a>b)","g");return C.exec("b").groups.a!=="b"||"b".replace(C,"$<a>c")!=="bc"}),I0=st.get,Fl=RegExp.prototype.exec,E0=Nr("native-string-replace",String.prototype.replace),Tu=Fl,qp=function(){var C=/a/,U=/b*/g;return Fl.call(C,"a"),Fl.call(U,"a"),C.lastIndex!==0||U.lastIndex!==0}(),fm=Gl.UNSUPPORTED_Y||Gl.BROKEN_CARET,Vl=/()??/.exec("")[1]!==void 0;(qp||Vl||fm||eh||Oc)&&(Tu=function(C){var U,q,J,ce,z,pe,ye,ue=this,be=I0(ue),He=ro(C),gt=be.raw;if(gt)return gt.lastIndex=ue.lastIndex,U=Tu.call(gt,He),ue.lastIndex=gt.lastIndex,U;var mt=be.groups,ot=fm&&ue.sticky,Zt=Zd.call(ue),In=ue.source,un=0,zt=He;if(ot&&((Zt=Zt.replace("y","")).indexOf("g")===-1&&(Zt+="g"),zt=He.slice(ue.lastIndex),ue.lastIndex>0&&(!ue.multiline||ue.multiline&&He.charAt(ue.lastIndex-1)!==`
`)&&(In="(?: "+In+")",zt=" "+zt,un++),q=new RegExp("^(?:"+In+")",Zt)),Vl&&(q=new RegExp("^"+In+"$(?!\\s)",Zt)),qp&&(J=ue.lastIndex),ce=Fl.call(ot?q:ue,zt),ot?ce?(ce.input=ce.input.slice(un),ce[0]=ce[0].slice(un),ce.index=ue.lastIndex,ue.lastIndex+=ce[0].length):ue.lastIndex=0:qp&&ce&&(ue.lastIndex=ue.global?ce.index+ce[0].length:J),Vl&&ce&&ce.length>1&&E0.call(ce[0],q,function(){for(z=1;z<arguments.length-2;z++)arguments[z]===void 0&&(ce[z]=void 0)}),ce&&mt)for(ce.groups=pe=Od(null),z=0;z<mt.length;z++)pe[(ye=mt[z])[0]]=ce[ye[1]];return ce});var Mu=Tu;wi({target:"RegExp",proto:!0,forced:/./.exec!==Mu},{exec:Mu});var T0=an("species"),gm=RegExp.prototype,M0=gn.charAt,Za=function(C,U,q){return U+(q?M0(C,U).length:1)},Hp=Math.floor,$p="".replace,Kp=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Ru=/\$([$&'`]|\d{1,2})/g,O_=function(C,U,q,J,ce,z){var pe=q+C.length,ye=J.length,ue=Ru;return ce!==void 0&&(ce=_i(ce),ue=Kp),$p.call(z,ue,function(be,He){var gt;switch(He.charAt(0)){case"$":return"$";case"&":return C;case"`":return U.slice(0,q);case"'":return U.slice(pe);case"<":gt=ce[He.slice(1,-1)];break;default:var mt=+He;if(mt===0)return be;if(mt>ye){var ot=Hp(mt/10);return ot===0?be:ot<=ye?J[ot-1]===void 0?He.charAt(1):J[ot-1]+He.charAt(1):be}gt=J[mt-1]}return gt===void 0?"":gt})},th=function(C,U){var q=C.exec;if(De(q)){var J=q.call(C,U);return J!==null&&pr(J),J}if(Pe(C)==="RegExp")return Mu.call(C,U);throw TypeError("RegExp#exec called on incompatible receiver")},Bl=an("replace"),R0=Math.max,nh=Math.min,C0="a".replace(/./,"$0")==="$0",Wp=!!/./[Bl]&&/./[Bl]("a","$0")==="";(function(C,U,q,J){var ce=an(C),z=!Y(function(){var be={};return be[ce]=function(){return 7},""[C](be)!=7}),pe=z&&!Y(function(){var be=!1,He=/a/;return C==="split"&&((He={}).constructor={},He.constructor[T0]=function(){return He},He.flags="",He[ce]=/./[ce]),He.exec=function(){return be=!0,null},He[ce](""),!be});if(!z||!pe||q){var ye=/./[ce],ue=U(ce,""[C],function(be,He,gt,mt,ot){var Zt=He.exec;return Zt===Mu||Zt===gm.exec?z&&!ot?{done:!0,value:ye.call(He,gt,mt)}:{done:!0,value:be.call(gt,He,mt)}:{done:!1}});Pr(String.prototype,C,ue[0]),Pr(gm,ce,ue[1])}J&&ct(gm[ce],"sham",!0)})("replace",function(C,U,q){var J=Wp?"$":"$0";return[function(ce,z){var pe=Ee(this),ye=ce==null?void 0:Gn(ce,Bl);return ye?ye.call(ce,pe,z):U.call(ro(pe),ce,z)},function(ce,z){var pe=pr(this),ye=ro(ce);if(typeof z=="string"&&z.indexOf(J)===-1&&z.indexOf("$<")===-1){var ue=q(U,pe,ye,z);if(ue.done)return ue.value}var be=De(z);be||(z=ro(z));var He=pe.global;if(He){var gt=pe.unicode;pe.lastIndex=0}for(var mt=[];;){var ot=th(pe,ye);if(ot===null||(mt.push(ot),!He))break;ro(ot[0])===""&&(pe.lastIndex=Za(ye,Si(pe.lastIndex),gt))}for(var Zt,In="",un=0,zt=0;zt<mt.length;zt++){ot=mt[zt];for(var en=ro(ot[0]),Pn=R0(nh(oc(ot.index),ye.length),0),cr=[],ao=1;ao<ot.length;ao++)cr.push((Zt=ot[ao])===void 0?Zt:String(Zt));var Fi=ot.groups;if(be){var so=[en].concat(cr,Pn,ye);Fi!==void 0&&so.push(Fi);var Jn=ro(z.apply(void 0,so))}else Jn=O_(en,ye,Pn,cr,Fi,z);Pn>=un&&(In+=ye.slice(un,Pn)+Jn,un=Pn+en.length)}return In+ye.slice(un)}]},!!Y(function(){var C=/./;return C.exec=function(){var U=[];return U.groups={a:"7"},U},"".replace(C,"$<a>")!=="7"})||!C0||Wp);var b0=Wi.PROPER,zp=RegExp.prototype,N_=zp.toString,mm=Y(function(){return N_.call({source:"a",flags:"b"})!="/a/b"}),L_=b0&&N_.name!="toString";(mm||L_)&&Pr(RegExp.prototype,"toString",function(){var C=pr(this),U=ro(C.source),q=C.flags;return"/"+U+"/"+ro(q===void 0&&C instanceof RegExp&&!("flags"in zp)?Zd.call(C):q)},{unsafe:!0});var A0=an("match"),jl=Ge.f,vm=uu.f,zi=st.enforce,P_=an("match"),es=W.RegExp,Nc=es.prototype,x_=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,Lc=/a/g,_m=/a/g,ym=new es(Lc)!==Lc,Yp=Gl.UNSUPPORTED_Y,Sm=se&&(!ym||Yp||eh||Oc||Y(function(){return _m[P_]=!1,es(Lc)!=Lc||es(_m)==_m||es(Lc,"i")!="/a/i"}));if(ya("RegExp",Sm)){for(var Oa=function(C,U){var q,J,ce,z,pe,ye,ue,be,He=this instanceof Oa,gt=Qe(q=C)&&((J=q[A0])!==void 0?!!J:Pe(q)=="RegExp"),mt=U===void 0,ot=[],Zt=C;if(!He&&gt&&mt&&C.constructor===Oa)return C;if((gt||C instanceof Oa)&&(C=C.source,mt&&(U="flags"in Zt?Zt.flags:Zd.call(Zt))),C=C===void 0?"":ro(C),U=U===void 0?"":ro(U),Zt=C,eh&&"dotAll"in Lc&&(z=!!U&&U.indexOf("s")>-1)&&(U=U.replace(/s/g,"")),ce=U,Yp&&"sticky"in Lc&&(pe=!!U&&U.indexOf("y")>-1)&&(U=U.replace(/y/g,"")),Oc&&(C=(ye=function(In){for(var un,zt=In.length,en=0,Pn="",cr=[],ao={},Fi=!1,so=!1,Jn=0,Bn="";en<=zt;en++){if((un=In.charAt(en))==="\\")un+=In.charAt(++en);else if(un==="]")Fi=!1;else if(!Fi)switch(!0){case un==="[":Fi=!0;break;case un==="(":x_.test(In.slice(en+1))&&(en+=2,so=!0),Pn+=un,Jn++;continue;case(un===">"&&so):if(Bn===""||qn(ao,Bn))throw new SyntaxError("Invalid capture group name");ao[Bn]=!0,cr.push([Bn,Jn]),so=!1,Bn="";continue}so?Bn+=un:Pn+=un}return[Pn,cr]}(C))[0],ot=ye[1]),ue=Rl(es(C,U),He?this:Nc,Oa),(z||pe||ot.length)&&(be=zi(ue),z&&(be.dotAll=!0,be.raw=Oa(function(In){for(var un,zt=In.length,en=0,Pn="",cr=!1;en<=zt;en++)(un=In.charAt(en))!=="\\"?cr||un!=="."?(un==="["?cr=!0:un==="]"&&(cr=!1),Pn+=un):Pn+="[\\s\\S]":Pn+=un+In.charAt(++en);return Pn}(C),ce)),pe&&(be.sticky=!0),ot.length&&(be.groups=ot)),C!==Zt)try{ct(ue,"source",Zt===""?"(?:)":Zt)}catch{}return ue},Im=function(C){C in Oa||jl(Oa,C,{configurable:!0,get:function(){return es[C]},set:function(U){es[C]=U}})},U_=vm(es),Em=0;U_.length>Em;)Im(U_[Em++]);Nc.constructor=Oa,Oa.prototype=Nc,Pr(W,"RegExp",Oa)}Ui("RegExp");var G_=[].join,rh=Se!=Object,Cu=Jd("join",",");wi({target:"Array",proto:!0,forced:rh||!Cu},{join:function(C){return G_.call(ke(this),C===void 0?",":C)}});var aa=Ha.forEach,bu=Jd("forEach")?[].forEach:function(C){return aa(this,C,arguments.length>1?arguments[1]:void 0)};wi({target:"Array",proto:!0,forced:[].forEach!=bu},{forEach:bu});var ts=function(C){if(C&&C.forEach!==bu)try{ct(C,"forEach",bu)}catch{C.forEach=bu}};for(var ns in mc)mc[ns]&&ts(W[ns]&&W[ns].prototype);function Tm(C,U,q){var J=function(be,He,gt){var mt=new RegExp("\\b".concat(He," \\w+ (\\w+)"),"ig");be.replace(mt,function(ot,Zt){return gt[Zt]=0,ot})},ce=function(be,He,gt){var mt=be.createShader(gt);return be.shaderSource(mt,He),be.compileShader(mt),be.getShaderParameter(mt,be.COMPILE_STATUS)?mt:(console.log(be.getShaderInfoLog(mt)),null)};this.uniform={},this.attribute={};var z=ce(C,U,C.VERTEX_SHADER),pe=ce(C,q,C.FRAGMENT_SHADER);for(var ye in this.id=C.createProgram(),C.attachShader(this.id,z),C.attachShader(this.id,pe),C.linkProgram(this.id),C.getProgramParameter(this.id,C.LINK_STATUS)||console.log(C.getProgramInfoLog(this.id)),C.useProgram(this.id),J(U,"attribute",this.attribute),this.attribute)this.attribute[ye]=C.getAttribLocation(this.id,ye);for(var ue in J(U,"uniform",this.uniform),J(q,"uniform",this.uniform),this.uniform)this.uniform[ue]=C.getUniformLocation(this.id,ue)}function Au(C,U,q,J){for(var ce=[],z=0;z<U.length;++z)ce.push(ko(C,U[z],C[ih[z]]));return function(pe,ye,ue,be){var He=pe.createProgram();return ye.forEach(function(gt){pe.attachShader(He,gt)}),ue&&ue.forEach(function(gt,mt){pe.bindAttribLocation(He,be?be[mt]:mt,gt)}),pe.linkProgram(He),pe.getProgramParameter(He,pe.LINK_STATUS)?He:(pe.deleteProgram(He),null)}(C,ce,q,J)}ts(wg);var ih=["VERTEX_SHADER","FRAGMENT_SHADER"];function ko(C,U,q){var J=C.createShader(q);return C.shaderSource(J,U),C.compileShader(J),C.getShaderParameter(J,C.COMPILE_STATUS)?J:(C.deleteShader(J),null)}var ql,Us,Mm,ku,k0=function(){function C(U){A(this,C),this.canvas=U.canvas,this.video=U.video,this.width=U.width||640,this.height=U.height||480,this.vertexBuffer=null,this.currentProgram=null,this.applied=!1,this.beautyParams={beauty:.5,brightness:.5,ruddy:.5},this.gl=this.createGL(U.canvas),this.sourceTexture=this.gl.createTexture()}return x(C,[{key:"setRect",value:function(U,q){this.width=U,this.height=q}},{key:"apply",value:function(U){if(!this.vertexBuffer){var q=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,-1,1,0,0,1,-1,1,1,1,1,1,0]);this.vertexBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,q,this.gl.STATIC_DRAW),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0)}this.gl.viewport(0,0,this.width,this.height),this.gl.bindTexture(this.gl.TEXTURE_2D,this.sourceTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.applied?this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,this.gl.RGB,this.gl.UNSIGNED_BYTE,U):(this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGB,this.gl.RGB,this.gl.UNSIGNED_BYTE,U),this.applied=!0);var J=this.beautyParams,ce=J.beauty,z=J.brightness,pe=J.ruddy,ye=2/this.width,ue=2/this.height,be=this.compileBeautyShader();this.gl.uniform2f(be.uniform.singleStepOffset,ye,ue);var He=new Float32Array([1-.8*ce,1-.6*ce,.1+.45*pe,.1+.45*pe]);this.gl.uniform4fv(be.uniform.params,He),this.gl.uniform1f(be.uniform.brightness,.12*z),this.gl.bindTexture(this.gl.TEXTURE_2D,this.sourceTexture),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.uniform1f(this.currentProgram.uniform.flipY,1),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}},{key:"compileBeautyShader",value:function(){if(this.currentProgram)return this.currentProgram;this.currentProgram=new Tm(this.gl,["precision highp float;","attribute vec2 pos;","attribute vec2 uv;","varying vec2 vUv;","uniform float flipY;","void main(void) {","vUv = uv;","gl_Position = vec4(pos.x, pos.y*flipY, 0.0, 1.);","}"].join(`
`),["precision highp float;","uniform vec2 singleStepOffset;","uniform sampler2D texture;","uniform vec4 params;","uniform float brightness;","varying vec2 vUv;","const highp vec3 W = vec3(0.299,0.587,0.114);","const mat3 saturateMatrix = mat3(1.1102,-0.0598,-0.061,-0.0774,1.0826,-0.1186,-0.0228,-0.0228,1.1772);","vec2 blurCoordinates[24];","float hardLight(float color){","if(color <= 0.5){","color = color * color * 2.0;","} else {","color = 1.0 - ((1.0 - color)*(1.0 - color) * 2.0);","}","return color;","}","void main(){","vec3 centralColor = texture2D(texture, vUv).rgb;","blurCoordinates[0] = vUv.xy + singleStepOffset * vec2(0.0, -10.0);","blurCoordinates[1] = vUv.xy + singleStepOffset * vec2(0.0, 10.0);","blurCoordinates[2] = vUv.xy + singleStepOffset * vec2(-10.0, 0.0);","blurCoordinates[3] = vUv.xy + singleStepOffset * vec2(10.0, 0.0);","blurCoordinates[4] = vUv.xy + singleStepOffset * vec2(5.0, -8.0);","blurCoordinates[5] = vUv.xy + singleStepOffset * vec2(5.0, 8.0);","blurCoordinates[6] = vUv.xy + singleStepOffset * vec2(-5.0, 8.0);","blurCoordinates[7] = vUv.xy + singleStepOffset * vec2(-5.0, -8.0);","blurCoordinates[8] = vUv.xy + singleStepOffset * vec2(8.0, -5.0);","blurCoordinates[9] = vUv.xy + singleStepOffset * vec2(8.0, 5.0);","blurCoordinates[10] = vUv.xy + singleStepOffset * vec2(-8.0, 5.0);","blurCoordinates[11] = vUv.xy + singleStepOffset * vec2(-8.0, -5.0);","blurCoordinates[12] = vUv.xy + singleStepOffset * vec2(0.0, -6.0);","blurCoordinates[13] = vUv.xy + singleStepOffset * vec2(0.0, 6.0);","blurCoordinates[14] = vUv.xy + singleStepOffset * vec2(6.0, 0.0);","blurCoordinates[15] = vUv.xy + singleStepOffset * vec2(-6.0, 0.0);","blurCoordinates[16] = vUv.xy + singleStepOffset * vec2(-4.0, -4.0);","blurCoordinates[17] = vUv.xy + singleStepOffset * vec2(-4.0, 4.0);","blurCoordinates[18] = vUv.xy + singleStepOffset * vec2(4.0, -4.0);","blurCoordinates[19] = vUv.xy + singleStepOffset * vec2(4.0, 4.0);","blurCoordinates[20] = vUv.xy + singleStepOffset * vec2(-2.0, -2.0);","blurCoordinates[21] = vUv.xy + singleStepOffset * vec2(-2.0, 2.0);","blurCoordinates[22] = vUv.xy + singleStepOffset * vec2(2.0, -2.0);","blurCoordinates[23] = vUv.xy + singleStepOffset * vec2(2.0, 2.0);","float sampleColor = centralColor.g * 22.0;","sampleColor += texture2D(texture, blurCoordinates[0]).g;","sampleColor += texture2D(texture, blurCoordinates[1]).g;","sampleColor += texture2D(texture, blurCoordinates[2]).g;","sampleColor += texture2D(texture, blurCoordinates[3]).g;","sampleColor += texture2D(texture, blurCoordinates[4]).g;","sampleColor += texture2D(texture, blurCoordinates[5]).g;","sampleColor += texture2D(texture, blurCoordinates[6]).g;","sampleColor += texture2D(texture, blurCoordinates[7]).g;","sampleColor += texture2D(texture, blurCoordinates[8]).g;","sampleColor += texture2D(texture, blurCoordinates[9]).g;","sampleColor += texture2D(texture, blurCoordinates[10]).g;","sampleColor += texture2D(texture, blurCoordinates[11]).g;","sampleColor += texture2D(texture, blurCoordinates[12]).g * 2.0;","sampleColor += texture2D(texture, blurCoordinates[13]).g * 2.0;","sampleColor += texture2D(texture, blurCoordinates[14]).g * 2.0;","sampleColor += texture2D(texture, blurCoordinates[15]).g * 2.0;","sampleColor += texture2D(texture, blurCoordinates[16]).g * 2.0;","sampleColor += texture2D(texture, blurCoordinates[17]).g * 2.0;","sampleColor += texture2D(texture, blurCoordinates[18]).g * 2.0;","sampleColor += texture2D(texture, blurCoordinates[19]).g * 2.0;","sampleColor += texture2D(texture, blurCoordinates[20]).g * 3.0;","sampleColor += texture2D(texture, blurCoordinates[21]).g * 3.0;","sampleColor += texture2D(texture, blurCoordinates[22]).g * 3.0;","sampleColor += texture2D(texture, blurCoordinates[23]).g * 3.0;","sampleColor = sampleColor / 62.0;","float highPass = centralColor.g - sampleColor + 0.5;","for(int i = 0; i < 5;i++){","highPass = hardLight(highPass);","}","float luminance = dot(centralColor, W);","float alpha = pow(luminance, params.r);","vec3 smoothColor = centralColor + (centralColor-vec3(highPass))*alpha*0.1;","smoothColor.r = clamp(pow(smoothColor.r, params.g),0.0,1.0);","smoothColor.g = clamp(pow(smoothColor.g, params.g),0.0,1.0);","smoothColor.b = clamp(pow(smoothColor.b, params.g),0.0,1.0);","vec3 screen = vec3(1.0) - (vec3(1.0)-smoothColor) * (vec3(1.0)-centralColor);","vec3 lighten = max(smoothColor, centralColor);","vec3 softLight = 2.0 * centralColor*smoothColor + centralColor*centralColor - 2.0 * centralColor*centralColor * smoothColor;","gl_FragColor = vec4(mix(centralColor, screen, alpha), 1.0);","gl_FragColor.rgb = mix(gl_FragColor.rgb, lighten, alpha);","gl_FragColor.rgb = mix(gl_FragColor.rgb, softLight, params.b);","vec3 satColor = gl_FragColor.rgb * saturateMatrix;","gl_FragColor.rgb = mix(gl_FragColor.rgb, satColor, params.a);","gl_FragColor.rgb = vec3(gl_FragColor.rgb + vec3(brightness));","}"].join(`
`));var U=Float32Array.BYTES_PER_ELEMENT,q=4*U;return this.gl.enableVertexAttribArray(this.currentProgram.attribute.pos),this.gl.vertexAttribPointer(this.currentProgram.attribute.pos,2,this.gl.FLOAT,!1,q,0),this.gl.enableVertexAttribArray(this.currentProgram.attribute.uv),this.gl.vertexAttribPointer(this.currentProgram.attribute.uv,2,this.gl.FLOAT,!1,q,2*U),this.currentProgram}},{key:"createGL",value:function(U){var q=U.getContext("webgl2");if(q||U.getContext("experimental-webgl",{preserveDrawingBuffer:!0}),!q)throw"Couldn't get WebGL context";return q}},{key:"setBeautyParams",value:function(U){this.beautyParams=U}},{key:"reset",value:function(){this.applied=!1}}]),C}(),F_=function(){function C(q){A(this,C),this.canvas=q.canvas,this.video=q.video,this.width=q.width||640,this.height=q.height||480,this.gl=this.createGL(q.canvas),this.vao=this.gl.createVertexArray(),this.positionBuffer=this.gl.createBuffer(),this.sourceTexture=this.gl.createTexture(),this.program=null,this.blurParams={resolutionLocation:null,imageLocation0:null,imageLocation1:null},this.virtualParams={resolutionLocation:null,imageLocation0:null,imageLocation1:null,imageLocation2:null,imageOldLocation0:null,imageOldLocation1:null,imageOldLocation2:null,imageOldLocation3:null,imageOldLocation4:null,imageOldLocation5:null},this.virtualLocation={postProcessTypeLocation:null,sigmaLocation:null,bSigmaLocation:null,mSizeLocation:null,overlayTypeLocation:null,hardThresholdLocation:null,sigmoidClipLocation:null},this.maskBuffer=[],this.frameBuffer=[],this.virtualOption={postProcess:2,sigma:100,bSigma:10,kSize:19,overlayType:0,hardThreshold:.5,sigmoidClip:1},this.type=0,this.frameRate=0,this.rafId=null,this.timeoutId=null,this.img=null,this.isRender=!1}var U;return x(C,[{key:"initVirtualParams",value:function(q){var J=q.img,ce=q.type;this.type=ce==="blur"?0:1,this.setBackground(J),this.type===0?this.initBackgroundBlurProgram():this.type===1&&this.initVirtualBackgroundProgram()}},{key:"setBackground",value:function(q){this.img=q}},{key:"setRect",value:function(q,J){this.width=q,this.height=J}},{key:"createGL",value:function(q){var J=q.getContext("webgl2");if(J||q.getContext("experimental-webgl",{preserveDrawingBuffer:!0}),!J)throw"Couldn't get WebGL context";return J}},{key:"setRectangle",value:function(q,J,ce,z,pe){var ye=J,ue=J+z,be=ce,He=ce+pe;q.bufferData(q.ARRAY_BUFFER,new Float32Array([ye,be,ue,be,ye,He,ye,He,ue,be,ue,He]),q.STATIC_DRAW)}},{key:"startVirtual",value:function(q){this.frameRate=q;var J=window.selfieSegmentation;J.setOptions({selfieMode:!1,modelSelection:0,effect:"background"}),this.type===0?J.onResults(this.onBlurResult.bind(this)):J.onResults(this.onVirtualResults.bind(this)),this.startTime=new Date().getTime(),this.isRender=!0,this.installEvents()}},{key:"render",value:(U=R(regeneratorRuntime.mark(function q(){var J,ce=this;return regeneratorRuntime.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(this.isRender){z.next=2;break}return z.abrupt("return");case 2:if(!((J=new Date().getTime())-this.startTime>1e3/this.frameRate)){z.next=8;break}if(this.video.readyState!==this.video.HAVE_ENOUGH_DATA){z.next=7;break}return z.next=7,window.selfieSegmentation.send({image:this.video});case 7:this.startTime=J;case 8:document.hidden?(this.timeoutId&&clearTimeout(this.timeoutId),this.rafId&&cancelAnimationFrame(this.rafId),this.timeoutId=setTimeout(function(){ce.render()},1e3/this.frameRate)):(this.timeoutId&&clearTimeout(this.timeoutId),this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(this.render.bind(this)));case 9:case"end":return z.stop()}},q,this)})),function(){return U.apply(this,arguments)})},{key:"installEvents",value:function(){window.addEventListener("visibilitychange",this.render.bind(this))}},{key:"uninstallEvents",value:function(){window.addEventListener("visibilitychange",this.render.bind(this))}},{key:"destroy",value:function(){this.isRender=!1,cancelAnimationFrame(this.rafId),clearTimeout(this.timeoutId),this.uninstallEvents()}},{key:"initBackgroundBlurProgram",value:function(){var q=this.gl,J={vertexShaderSource:`#version 300 es
    
    // an attribute is an input (in) to a vertex shader.
    // It will receive data from a buffer
    in vec2 position;
    in vec2 texCoord;
    
    // Used to pass in the resolution of the canvas
    uniform vec2 resolution;
    
    // Used to pass the texture coordinates to the fragment shader
    out vec2 v_texCoord;
    
    // all shaders have a main function
    void main() {
    
      // convert the position from pixels to 0.0 to 1.0
      vec2 zeroToOne = position / resolution;
    
      // convert from 0->1 to 0->2
      vec2 zeroToTwo = zeroToOne * 2.0;
    
      // convert from 0->2 to -1->+1 (clipspace)
      vec2 clipSpace = zeroToTwo - 1.0;
    
      gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
    
      // pass the texCoord to the fragment shader
      // The GPU will interpolate this value between points.
      v_texCoord = texCoord;
    }
    `,fragmentShaderSource:`#version 300 es
    
    // fragment shaders don't have a default precision so we need
    // to pick one. highp is a good default. It means "high precision"
    precision highp float;
    
    // our texture
    uniform sampler2D u_image0;
    uniform sampler2D u_image1;
    
    // the texCoords passed in from the vertex shader.
    in vec2 v_texCoord;
    
    // we need to declare an output for the fragment shader
    out vec4 outColor;
    
    void main() {
      vec2 onePixel = vec2(1) / vec2(textureSize(u_image0, 0));
    
      vec4 color0 = texture(u_image0, v_texCoord);
      vec4 color1 = texture(u_image1, v_texCoord);
      
      vec4 gaussianBlur = vec4(0.0);
    
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-12.0 * onePixel.x, -12.0 * onePixel.y)) * 0.004937634762006754;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-12.0 * onePixel.x, -10.0 * onePixel.y)) * 0.00572726182364418;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-12.0 * onePixel.x, -8.0 * onePixel.y)) * 0.006427731733273422;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-12.0 * onePixel.x, -6.0 * onePixel.y)) * 0.006979930414848231;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-12.0 * onePixel.x, -4.0 * onePixel.y)) * 0.007333766846250579;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-12.0 * onePixel.x, -2.0 * onePixel.y)) * 0.0074556543695930904;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-12.0 * onePixel.x, 0.0 * onePixel.y)) * 0.007333766846250585;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-12.0 * onePixel.x, 2.0 * onePixel.y)) * 0.0069799304148482205;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-12.0 * onePixel.x, 4.0 * onePixel.y)) * 0.006427731733273439;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-12.0 * onePixel.x, 6.0 * onePixel.y)) * 0.0057272618236441745;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-12.0 * onePixel.x, 8.0 * onePixel.y)) * 0.004937634762006749;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-10.0 * onePixel.x, -12.0 * onePixel.y)) * 0.00572726182364418;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-10.0 * onePixel.x, -10.0 * onePixel.y)) * 0.006643166126617444;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-10.0 * onePixel.x, -8.0 * onePixel.y)) * 0.007455655256615504;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-10.0 * onePixel.x, -6.0 * onePixel.y)) * 0.008096161608439047;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-10.0 * onePixel.x, -4.0 * onePixel.y)) * 0.008506583598534066;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-10.0 * onePixel.x, -2.0 * onePixel.y)) * 0.008647963387211346;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-10.0 * onePixel.x, 0.0 * onePixel.y)) * 0.008506583598534071;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-10.0 * onePixel.x, 2.0 * onePixel.y)) * 0.008096161608439035;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-10.0 * onePixel.x, 4.0 * onePixel.y)) * 0.007455655256615524;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-10.0 * onePixel.x, 6.0 * onePixel.y)) * 0.006643166126617437;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-10.0 * onePixel.x, 8.0 * onePixel.y)) * 0.005727261823644173;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-8.0 * onePixel.x, -12.0 * onePixel.y)) * 0.006427731733273422;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-8.0 * onePixel.x, -10.0 * onePixel.y)) * 0.007455655256615504;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-8.0 * onePixel.x, -8.0 * onePixel.y)) * 0.008367515465671788;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-8.0 * onePixel.x, -6.0 * onePixel.y)) * 0.009086358628382269;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-8.0 * onePixel.x, -4.0 * onePixel.y)) * 0.009546977075905662;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-8.0 * onePixel.x, -2.0 * onePixel.y)) * 0.009705648249340199;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-8.0 * onePixel.x, 0.0 * onePixel.y)) * 0.00954697707590567;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-8.0 * onePixel.x, 2.0 * onePixel.y)) * 0.009086358628382255;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-8.0 * onePixel.x, 4.0 * onePixel.y)) * 0.00836751546567181;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-8.0 * onePixel.x, 6.0 * onePixel.y)) * 0.007455655256615497;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-8.0 * onePixel.x, 8.0 * onePixel.y)) * 0.006427731733273414;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-6.0 * onePixel.x, -12.0 * onePixel.y)) * 0.006979930414848231;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-6.0 * onePixel.x, -10.0 * onePixel.y)) * 0.008096161608439047;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-6.0 * onePixel.x, -8.0 * onePixel.y)) * 0.009086358628382269;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-6.0 * onePixel.x, -6.0 * onePixel.y)) * 0.009866956740300258;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-6.0 * onePixel.x, -4.0 * onePixel.y)) * 0.010367146363159857;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-6.0 * onePixel.x, -2.0 * onePixel.y)) * 0.010539448785751998;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-6.0 * onePixel.x, 0.0 * onePixel.y)) * 0.010367146363159866;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-6.0 * onePixel.x, 2.0 * onePixel.y)) * 0.009866956740300243;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-6.0 * onePixel.x, 4.0 * onePixel.y)) * 0.009086358628382293;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-6.0 * onePixel.x, 6.0 * onePixel.y)) * 0.00809616160843904;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-6.0 * onePixel.x, 8.0 * onePixel.y)) * 0.006979930414848224;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-4.0 * onePixel.x, -12.0 * onePixel.y)) * 0.007333766846250579;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-4.0 * onePixel.x, -10.0 * onePixel.y)) * 0.008506583598534066;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-4.0 * onePixel.x, -8.0 * onePixel.y)) * 0.009546977075905662;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-4.0 * onePixel.x, -6.0 * onePixel.y)) * 0.010367146363159857;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-4.0 * onePixel.x, -4.0 * onePixel.y)) * 0.010892692300575347;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-4.0 * onePixel.x, -2.0 * onePixel.y)) * 0.01107372931946121;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-4.0 * onePixel.x, 0.0 * onePixel.y)) * 0.010892692300575355;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-4.0 * onePixel.x, 2.0 * onePixel.y)) * 0.01036714636315984;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-4.0 * onePixel.x, 4.0 * onePixel.y)) * 0.009546977075905686;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-4.0 * onePixel.x, 6.0 * onePixel.y)) * 0.008506583598534057;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-4.0 * onePixel.x, 8.0 * onePixel.y)) * 0.007333766846250571;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-2.0 * onePixel.x, -12.0 * onePixel.y)) * 0.0074556543695930904;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-2.0 * onePixel.x, -10.0 * onePixel.y)) * 0.008647963387211346;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-2.0 * onePixel.x, -8.0 * onePixel.y)) * 0.009705648249340199;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-2.0 * onePixel.x, -6.0 * onePixel.y)) * 0.010539448785751998;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-2.0 * onePixel.x, -4.0 * onePixel.y)) * 0.01107372931946121;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-2.0 * onePixel.x, -2.0 * onePixel.y)) * 0.011257775181459748;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-2.0 * onePixel.x, 0.0 * onePixel.y)) * 0.011073729319461219;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-2.0 * onePixel.x, 2.0 * onePixel.y)) * 0.010539448785751979;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-2.0 * onePixel.x, 4.0 * onePixel.y)) * 0.009705648249340225;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-2.0 * onePixel.x, 6.0 * onePixel.y)) * 0.008647963387211337;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(-2.0 * onePixel.x, 8.0 * onePixel.y)) * 0.007455654369593082;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(0.0 * onePixel.x, -12.0 * onePixel.y)) * 0.007333766846250585;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(0.0 * onePixel.x, -10.0 * onePixel.y)) * 0.008506583598534071;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(0.0 * onePixel.x, -8.0 * onePixel.y)) * 0.00954697707590567;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(0.0 * onePixel.x, -6.0 * onePixel.y)) * 0.010367146363159866;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(0.0 * onePixel.x, -4.0 * onePixel.y)) * 0.010892692300575355;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(0.0 * onePixel.x, -2.0 * onePixel.y)) * 0.011073729319461219;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(0.0 * onePixel.x, 0.0 * onePixel.y)) * 0.010892692300575364;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(0.0 * onePixel.x, 2.0 * onePixel.y)) * 0.01036714636315985;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(0.0 * onePixel.x, 4.0 * onePixel.y)) * 0.009546977075905695;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(0.0 * onePixel.x, 6.0 * onePixel.y)) * 0.008506583598534064;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(0.0 * onePixel.x, 8.0 * onePixel.y)) * 0.007333766846250576;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(2.0 * onePixel.x, -12.0 * onePixel.y)) * 0.0069799304148482205;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(2.0 * onePixel.x, -10.0 * onePixel.y)) * 0.008096161608439035;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(2.0 * onePixel.x, -8.0 * onePixel.y)) * 0.009086358628382255;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(2.0 * onePixel.x, -6.0 * onePixel.y)) * 0.009866956740300243;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(2.0 * onePixel.x, -4.0 * onePixel.y)) * 0.01036714636315984;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(2.0 * onePixel.x, -2.0 * onePixel.y)) * 0.010539448785751979;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(2.0 * onePixel.x, 0.0 * onePixel.y)) * 0.01036714636315985;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(2.0 * onePixel.x, 2.0 * onePixel.y)) * 0.009866956740300227;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(2.0 * onePixel.x, 4.0 * onePixel.y)) * 0.00908635862838228;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(2.0 * onePixel.x, 6.0 * onePixel.y)) * 0.008096161608439026;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(2.0 * onePixel.x, 8.0 * onePixel.y)) * 0.006979930414848213;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(4.0 * onePixel.x, -12.0 * onePixel.y)) * 0.006427731733273439;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(4.0 * onePixel.x, -10.0 * onePixel.y)) * 0.007455655256615524;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(4.0 * onePixel.x, -8.0 * onePixel.y)) * 0.00836751546567181;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(4.0 * onePixel.x, -6.0 * onePixel.y)) * 0.009086358628382293;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(4.0 * onePixel.x, -4.0 * onePixel.y)) * 0.009546977075905686;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(4.0 * onePixel.x, -2.0 * onePixel.y)) * 0.009705648249340225;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(4.0 * onePixel.x, 0.0 * onePixel.y)) * 0.009546977075905695;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(4.0 * onePixel.x, 2.0 * onePixel.y)) * 0.00908635862838228;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(4.0 * onePixel.x, 4.0 * onePixel.y)) * 0.008367515465671832;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(4.0 * onePixel.x, 6.0 * onePixel.y)) * 0.007455655256615516;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(4.0 * onePixel.x, 8.0 * onePixel.y)) * 0.006427731733273432;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(6.0 * onePixel.x, -12.0 * onePixel.y)) * 0.0057272618236441745;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(6.0 * onePixel.x, -10.0 * onePixel.y)) * 0.006643166126617437;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(6.0 * onePixel.x, -8.0 * onePixel.y)) * 0.007455655256615497;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(6.0 * onePixel.x, -6.0 * onePixel.y)) * 0.00809616160843904;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(6.0 * onePixel.x, -4.0 * onePixel.y)) * 0.008506583598534057;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(6.0 * onePixel.x, -2.0 * onePixel.y)) * 0.008647963387211337;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(6.0 * onePixel.x, 0.0 * onePixel.y)) * 0.008506583598534064;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(6.0 * onePixel.x, 2.0 * onePixel.y)) * 0.008096161608439026;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(6.0 * onePixel.x, 4.0 * onePixel.y)) * 0.007455655256615516;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(6.0 * onePixel.x, 6.0 * onePixel.y)) * 0.00664316612661743;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(6.0 * onePixel.x, 8.0 * onePixel.y)) * 0.005727261823644167;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(8.0 * onePixel.x, -12.0 * onePixel.y)) * 0.004937634762006749;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(8.0 * onePixel.x, -10.0 * onePixel.y)) * 0.005727261823644173;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(8.0 * onePixel.x, -8.0 * onePixel.y)) * 0.006427731733273414;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(8.0 * onePixel.x, -6.0 * onePixel.y)) * 0.006979930414848224;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(8.0 * onePixel.x, -4.0 * onePixel.y)) * 0.007333766846250571;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(8.0 * onePixel.x, -2.0 * onePixel.y)) * 0.007455654369593082;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(8.0 * onePixel.x, 0.0 * onePixel.y)) * 0.007333766846250576;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(8.0 * onePixel.x, 2.0 * onePixel.y)) * 0.006979930414848213;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(8.0 * onePixel.x, 4.0 * onePixel.y)) * 0.006427731733273432;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(8.0 * onePixel.x, 6.0 * onePixel.y)) * 0.005727261823644167;
      gaussianBlur += texture(u_image1, v_texCoord+ vec2(8.0 * onePixel.x, 8.0 * onePixel.y)) * 0.004937634762006742;
    
      outColor = (1.0 - color0.r) * gaussianBlur + color0.r * color1;
    }
    `},ce=J.vertexShaderSource,z=J.fragmentShaderSource;this.program=Au(q,[ce,z]);var pe=q.getAttribLocation(this.program,"position"),ye=q.getAttribLocation(this.program,"texCoord");this.blurParams.resolutionLocation=q.getUniformLocation(this.program,"resolution"),this.blurParams.imageLocation0=q.getUniformLocation(this.program,"u_image0"),this.blurParams.imageLocation1=q.getUniformLocation(this.program,"u_image1"),q.bindVertexArray(this.vao),q.bindBuffer(q.ARRAY_BUFFER,this.positionBuffer),q.enableVertexAttribArray(pe),q.vertexAttribPointer(pe,2,q.FLOAT,!1,0,0),q.bindBuffer(q.ARRAY_BUFFER,q.createBuffer()),q.bufferData(q.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),q.STATIC_DRAW),q.enableVertexAttribArray(ye),q.vertexAttribPointer(ye,2,q.FLOAT,!1,0,0)}},{key:"onBlurResult",value:function(q){for(var J=q.segmentationMask,ce=q.image,z=this.gl,pe=[],ye=[J,ce],ue=0;ue<2;++ue){var be=z.createTexture();z.bindTexture(z.TEXTURE_2D,be),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.NEAREST),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.NEAREST),z.texImage2D(z.TEXTURE_2D,0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,ye[ue]),pe.push(be)}z.bindBuffer(z.ARRAY_BUFFER,this.positionBuffer),this.setRectangle(z,0,0,this.width,this.height),z.viewport(0,0,this.width,this.height),z.clearColor(0,0,0,0),z.clear(z.COLOR_BUFFER_BIT|z.DEPTH_BUFFER_BIT),z.useProgram(this.program),z.bindVertexArray(this.vao);var He=this.blurParams,gt=He.resolutionLocation,mt=He.imageLocation0,ot=He.imageLocation1;z.uniform2f(gt,this.width,this.height),z.uniform1i(mt,0),z.uniform1i(ot,1),z.activeTexture(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,pe[0]),z.activeTexture(z.TEXTURE1),z.bindTexture(z.TEXTURE_2D,pe[1]),z.drawArrays(z.TRIANGLES,0,6)}},{key:"initVirtualBackgroundProgram",value:function(){var q=this.gl,J={vertexShaderSource:`#version 300 es
    
    // an attribute is an input (in) to a vertex shader.
    // It will receive data from a buffer
    in vec2 position;
    in vec2 texCoord;
    
    // Used to pass in the resolution of the canvas
    uniform vec2 resolution;
    
    // Used to pass the texture coordinates to the fragment shader
    out vec2 v_texCoord;
    
    // all shaders have a main function
    void main() {
    
      // convert the position from pixels to 0.0 to 1.0
      vec2 zeroToOne = position / resolution;
    
      // convert from 0->1 to 0->2
      vec2 zeroToTwo = zeroToOne * 2.0;
    
      // convert from 0->2 to -1->+1 (clipspace)
      vec2 clipSpace = zeroToTwo - 1.0;
    
      gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
    
      // pass the texCoord to the fragment shader
      // The GPU will interpolate this value between points.
      v_texCoord = texCoord;
    }
    `,fragmentShaderSource:`#version 300 es
    
    // fragment shaders don't have a default precision so we need
    // to pick one. highp is a good default. It means "high precision"
    precision highp float;
    
    // Some hyperParameter:
    uniform int PostProcessType;
    uniform int MSIZE;
    uniform float SIGMA;
    uniform float BSIGMA;
    uniform int overlayType;
    uniform float hardThreshold;
    uniform int sigmoidClip;
    
    // our texture
    uniform sampler2D u_image0;
    uniform sampler2D u_image1;
    uniform sampler2D u_image2;
    
    // time-wise texture
    uniform sampler2D u_image_old0;
    uniform sampler2D u_image_old1;
    uniform sampler2D u_image_old2;
    uniform sampler2D u_image_old3;
    uniform sampler2D u_image_old4;
    uniform sampler2D u_image_old5;
    
    // the texCoords passed in from the vertex shader.
    in vec2 v_texCoord;
    
    // we need to declare an output for the fragment shader
    out vec4 outColor;
    
    float normpdf(in float x, in float sigma)
    {
      return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;
    }
    
    float normpdf3(in vec3 v, in float sigma)
    {
    return 0.39894*exp(-0.5*dot(v,v)/(sigma*sigma))/sigma;
    }
    
    void main() {
      vec2 onePixel = vec2(1) / vec2(textureSize(u_image0, 0));
    
      vec4 color0 = texture(u_image0, v_texCoord);                  // mask. r & a are same.
      vec4 color1 = texture(u_image1, v_texCoord);                  // video image.
      vec4 color2 = texture(u_image2, v_texCoord);                  // background image.
      vec4 color_old0 = texture(u_image_old0, v_texCoord);          // old mask(3 frames old)
      vec4 color_old1 = texture(u_image_old1, v_texCoord);          // old mask(2 frames old)
      vec4 color_old2 = texture(u_image_old2, v_texCoord);          // old mask(1 frames old)
      vec4 color_old3 = texture(u_image_old3, v_texCoord);          // old video image(3 frames old)
      vec4 color_old4 = texture(u_image_old4, v_texCoord);          // old video image(2 frames old)
      vec4 color_old5 = texture(u_image_old5, v_texCoord);          // old video image(1 frames old)
      
      float maskValue = color0.a;
      if (PostProcessType == 0) {
        // Do nothing to the mask. Passthrough.
      }
      else if (PostProcessType == 1) {
          // JBF
          vec4 c = texture(u_image1, v_texCoord);
          int kSize = (MSIZE-1)/2;
          float kernel[40];
          float bfinal_colour = 0.0;
          float bZ = 0.0;
          //create the 1-D kernel
          for (int j = 0; j <= kSize; ++j) {
            kernel[kSize+j] = kernel[kSize-j] = normpdf(float(j), SIGMA);
          }
        
          vec3 cc;
          float gfactor;
          float bfactor;
          float bZnorm = 1.0/normpdf(0.0, BSIGMA);
          
          for (int i=-kSize; i <= kSize; ++i)
            {
              for (int j=-kSize; j <= kSize; ++j)
              {
                cc = texture(u_image1, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).rgb;
                
                // compute both the gaussian smoothed and bilateral
                gfactor = kernel[kSize+j]*kernel[kSize+i];
                bfactor = normpdf3(cc-c.rgb, BSIGMA)*bZnorm*gfactor;
                bZ += bfactor;
                
                bfinal_colour += bfactor * texture(u_image0, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).a;
              }
            }
          
          maskValue = bfinal_colour / bZ;
      }
      else if (PostProcessType == 2) {
          // Joint Bilateral filter. + avg time domain filter. Pixel image is time-domain filtered, ref image is not.
          // vec4 c = texture(u_image1, v_texCoord);
          // vec4 c = texture(u_image1, v_texCoord) * 0.25 + texture(u_image_old3, v_texCoord) * 0.25 +
          //          texture(u_image_old4, v_texCoord) * 0.25 + texture(u_image_old5, v_texCoord) * 0.25;
          // vec4 c = sqrt(
          // texture(u_image1, v_texCoord) * texture(u_image1, v_texCoord) * 0.25 +
          // texture(u_image1, v_texCoord) * texture(u_image_old3, v_texCoord) * 0.25 +
          // texture(u_image1, v_texCoord) * texture(u_image_old4, v_texCoord) * 0.25 +
          // texture(u_image1, v_texCoord) * texture(u_image_old5, v_texCoord) * 0.25
          // );
          vec4 c = texture(u_image1, v_texCoord) * 0.5 + texture(u_image_old4, v_texCoord) * 0.5;
          
          int kSize = (MSIZE-1)/2;
          float kernel[40];
          float bfinal_colour = 0.0;
          float bZ = 0.0;
          //create the 1-D kernel
          for (int j = 0; j <= kSize; ++j) {
            kernel[kSize+j] = kernel[kSize-j] = normpdf(float(j), SIGMA);
          }
        
          vec3 cc;
          float gfactor;
          float bfactor;
          float bZnorm = 1.0/normpdf(0.0, BSIGMA);
          
          for (int i=-kSize; i <= kSize; ++i)
            {
              for (int j=-kSize; j <= kSize; ++j)
              {
                vec3 p0 = texture(u_image1, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).rgb;
                // vec3 p1 = texture(u_image_old3, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).rgb;
                // vec3 p2 = texture(u_image_old4, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).rgb;
                vec3 p3 = texture(u_image_old5, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).rgb;
                cc = p0 * 0.5 + p3 * 0.5;
                
                // compute both the gaussian smoothed and bilateral
                gfactor = kernel[kSize+j]*kernel[kSize+i];
                bfactor = normpdf3(cc-c.rgb, BSIGMA)*bZnorm*gfactor;
                bZ += bfactor;
        
                // bfinal_colour += bfactor * texture(u_image0, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).a;
                float tmp0 = texture(u_image0, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).a;
                float tmp1 = texture(u_image_old0, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).a;
                float tmp2 = texture(u_image_old1, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).a;
                float tmp3 = texture(u_image_old2, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).a;
                
                bfinal_colour += bfactor  * ( tmp0 * 0.5 + tmp3 * 0.5 ); // smooth filter on latest 2 frames.
              }
            }
          
          maskValue = bfinal_colour / bZ;
      }
      else if (PostProcessType == 3) {
          // Joint Bilateral filter. + avg time domain filter. Pixel image is time-domain filtered, ref image is not.
          vec4 c = texture(u_image1, v_texCoord) * 0.33 + texture(u_image_old5, v_texCoord) * 0.33 + texture(u_image_old4, v_texCoord) * 0.33;
          
          int kSize = (MSIZE-1)/2;
          float kernel[40];
          float bfinal_colour = 0.0;
          float bZ = 0.0;
          //create the 1-D kernel
          for (int j = 0; j <= kSize; ++j) {
            kernel[kSize+j] = kernel[kSize-j] = normpdf(float(j), SIGMA);
          }
        
          vec3 cc;
          float gfactor;
          float bfactor;
          float bZnorm = 1.0/normpdf(0.0, BSIGMA);
          
          for (int i=-kSize; i <= kSize; ++i)
            {
              for (int j=-kSize; j <= kSize; ++j)
              {
                vec3 p0 = texture(u_image1, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).rgb;
                vec3 p2 = texture(u_image_old4, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).rgb;
                vec3 p3 = texture(u_image_old5, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).rgb;
                cc = p0 * 0.33 + p3 * 0.33 + p2 * 0.33;
                
                // compute both the gaussian smoothed and bilateral
                gfactor = kernel[kSize+j]*kernel[kSize+i];
                bfactor = normpdf3(cc-c.rgb, BSIGMA)*bZnorm*gfactor;
                bZ += bfactor;
        
                // bfinal_colour += bfactor * texture(u_image0, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).a;
                float tmp0 = texture(u_image0, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).a;
                float tmp1 = texture(u_image_old0, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).a;
                float tmp2 = texture(u_image_old1, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).a;
                float tmp3 = texture(u_image_old2, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).a;
                
                bfinal_colour += bfactor  * ( tmp0 * 0.33 + tmp3 * 0.33 + tmp2 * 0.33 ); // smooth filter on latest 3 frames.
              }
            }
          
          maskValue = bfinal_colour / bZ;
      }
      else if (PostProcessType == 4) {
          vec4 c = texture(u_image1, v_texCoord) * 0.25 + texture(u_image_old5, v_texCoord) * 0.25 +
                   texture(u_image_old4, v_texCoord) * 0.25 + texture(u_image_old3, v_texCoord) * 0.25;
          
          int kSize = (MSIZE-1)/2;
          float kernel[40];
          float bfinal_colour = 0.0;
          float bZ = 0.0;
          //create the 1-D kernel
          for (int j = 0; j <= kSize; ++j) {
            kernel[kSize+j] = kernel[kSize-j] = normpdf(float(j), SIGMA);
          }
        
          vec3 cc;
          float gfactor;
          float bfactor;
          float bZnorm = 1.0/normpdf(0.0, BSIGMA);
          
          for (int i=-kSize; i <= kSize; ++i)
            {
              for (int j=-kSize; j <= kSize; ++j)
              {
                vec3 p0 = texture(u_image1, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).rgb;
                vec3 p1 = texture(u_image_old3, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).rgb;
                vec3 p2 = texture(u_image_old4, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).rgb;
                vec3 p3 = texture(u_image_old5, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).rgb;
                cc = p0 * 0.25 + p1 * 0.25 + p2 * 0.25 + p3 * 0.25;
                
                // compute both the gaussian smoothed and bilateral
                gfactor = kernel[kSize+j]*kernel[kSize+i];
                bfactor = normpdf3(cc-c.rgb, BSIGMA)*bZnorm*gfactor;
                bZ += bfactor;
    
                float tmp0 = texture(u_image0, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).a;
                float tmp1 = texture(u_image_old0, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).a;
                float tmp2 = texture(u_image_old1, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).a;
                float tmp3 = texture(u_image_old2, v_texCoord+ vec2(float(i) * onePixel.x, float(j) * onePixel.y)).a;
                
                bfinal_colour += bfactor  * ( tmp0 * 0.25 + tmp3 * 0.25 + tmp1 * 0.25 + tmp2 * 0.25 ); // smooth filter on latest 4 frames.
              }
            }
          
          maskValue = bfinal_colour / bZ;
      }
      
      if (sigmoidClip == 1) {
        maskValue = 1.0 / (1.0 + exp(-10.0 * (maskValue - 0.5)));
      }
      
      if (overlayType != 0) {
        maskValue = maskValue > hardThreshold ? 1.0 : 0.0;
      }
      
      outColor.rgb = (maskValue * color1 + (1.0 - maskValue) * color2).rgb;
      outColor.a = 1.0;
    }
    `},ce=J.vertexShaderSource,z=J.fragmentShaderSource;this.program=Au(q,[ce,z]);var pe=q.getAttribLocation(this.program,"position"),ye=q.getAttribLocation(this.program,"texCoord"),ue=this.program;this.virtualParams={resolutionLocation:q.getUniformLocation(ue,"resolution"),imageLocation0:q.getUniformLocation(ue,"u_image0"),imageLocation1:q.getUniformLocation(ue,"u_image1"),imageLocation2:q.getUniformLocation(ue,"u_image2"),imageOldLocation0:q.getUniformLocation(ue,"u_image_old0"),imageOldLocation1:q.getUniformLocation(ue,"u_image_old1"),imageOldLocation2:q.getUniformLocation(ue,"u_image_old2"),imageOldLocation3:q.getUniformLocation(ue,"u_image_old3"),imageOldLocation4:q.getUniformLocation(ue,"u_image_old4"),imageOldLocation5:q.getUniformLocation(ue,"u_image_old5")},this.virtualLocation={postProcessTypeLocation:q.getUniformLocation(ue,"PostProcessType"),sigmaLocation:q.getUniformLocation(ue,"SIGMA"),bSigmaLocation:q.getUniformLocation(ue,"BSIGMA"),mSizeLocation:q.getUniformLocation(ue,"MSIZE"),overlayTypeLocation:q.getUniformLocation(ue,"overlayType"),hardThresholdLocation:q.getUniformLocation(ue,"hardThreshold"),sigmoidClipLocation:q.getUniformLocation(ue,"sigmoidClip")},q.bindVertexArray(this.vao),q.bindBuffer(q.ARRAY_BUFFER,this.positionBuffer),q.enableVertexAttribArray(pe),q.vertexAttribPointer(pe,2,q.FLOAT,!1,0,0),q.bindBuffer(q.ARRAY_BUFFER,q.createBuffer()),q.bufferData(q.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),q.STATIC_DRAW),q.enableVertexAttribArray(ye),q.vertexAttribPointer(ye,2,q.FLOAT,!1,0,0)}},{key:"onVirtualResults",value:function(q){var J=q.segmentationMask,ce=q.image,z=this.gl;this.maskBuffer.length<3&&this.maskBuffer.push(J,J,J),this.frameBuffer.length<3&&this.frameBuffer.push(ce,ce,ce);for(var pe=[],ye=[J,ce,this.img,this.maskBuffer[0],this.maskBuffer[1],this.maskBuffer[2],this.frameBuffer[0],this.frameBuffer[1],this.frameBuffer[2]],ue=0;ue<ye.length;++ue)this.texture=z.createTexture(),z.bindTexture(z.TEXTURE_2D,this.texture),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.NEAREST),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.NEAREST),z.texImage2D(z.TEXTURE_2D,0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,ye[ue]),pe.push(this.texture);z.bindBuffer(z.ARRAY_BUFFER,this.positionBuffer),this.setRectangle(z,0,0,this.width,this.height),z.viewport(0,0,this.width,this.height),z.clearColor(0,0,0,0),z.clear(z.COLOR_BUFFER_BIT|z.DEPTH_BUFFER_BIT),z.useProgram(this.program),z.bindVertexArray(this.vao);var be=this.virtualParams,He=be.resolutionLocation,gt=be.imageLocation0,mt=be.imageLocation1,ot=be.imageLocation2,Zt=be.imageOldLocation0,In=be.imageOldLocation1,un=be.imageOldLocation2,zt=be.imageOldLocation3,en=be.imageOldLocation4,Pn=be.imageOldLocation5;z.uniform2f(He,this.width,this.height);var cr=this.virtualOption,ao=cr.postProcess,Fi=cr.kSize,so=cr.sigma,Jn=cr.bSigma,Bn=cr.overlayType,Hr=cr.hardThreshold,ei=cr.sigmoidClip,_t=this.virtualLocation,Rt=_t.postProcessTypeLocation,me=_t.mSizeLocation,Nn=_t.sigmaLocation,At=_t.bSigmaLocation,Wn=_t.overlayTypeLocation,$r=_t.hardThresholdLocation,Di=_t.sigmoidClipLocation;z.uniform1i(Rt,ao),z.uniform1i(me,Fi),z.uniform1f(Nn,so),z.uniform1f(At,Jn),z.uniform1i(Wn,Bn),z.uniform1f($r,Hr),z.uniform1i(Di,ei),z.uniform1i(gt,0),z.uniform1i(mt,1),z.uniform1i(ot,2),z.uniform1i(Zt,3),z.uniform1i(In,4),z.uniform1i(un,5),z.uniform1i(zt,6),z.uniform1i(en,7),z.uniform1i(Pn,8),z.activeTexture(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,pe[0]),z.activeTexture(z.TEXTURE1),z.bindTexture(z.TEXTURE_2D,pe[1]),z.activeTexture(z.TEXTURE2),z.bindTexture(z.TEXTURE_2D,pe[2]),z.activeTexture(z.TEXTURE3),z.bindTexture(z.TEXTURE_2D,pe[3]),z.activeTexture(z.TEXTURE4),z.bindTexture(z.TEXTURE_2D,pe[4]),z.activeTexture(z.TEXTURE5),z.bindTexture(z.TEXTURE_2D,pe[5]),z.activeTexture(z.TEXTURE6),z.bindTexture(z.TEXTURE_2D,pe[6]),z.activeTexture(z.TEXTURE7),z.bindTexture(z.TEXTURE_2D,pe[7]),z.activeTexture(z.TEXTURE8),z.bindTexture(z.TEXTURE_2D,pe[8]),z.drawArrays(z.TRIANGLES,0,6),this.maskBuffer[0]=this.maskBuffer[1],this.maskBuffer[1]=this.maskBuffer[2],this.maskBuffer[2]=J,this.frameBuffer[0]=this.frameBuffer[1],this.frameBuffer[1]=this.frameBuffer[2],this.frameBuffer[2]=ce}}]),C}(),oh=W.Promise,sa=/(?:ipad|iphone|ipod).*applewebkit/i.test(it),rs=Pe(W.process)=="process",Na=W.setImmediate,ah=W.clearImmediate,Gs=W.process,Jp=W.MessageChannel,sh=W.Dispatch,Xp=0,wu={};try{ql=W.location}catch{}var Rm=function(C){if(wu.hasOwnProperty(C)){var U=wu[C];delete wu[C],U()}},ch=function(C){return function(){Rm(C)}},V_=function(C){Rm(C.data)},Qp=function(C){W.postMessage(String(C),ql.protocol+"//"+ql.host)};Na&&ah||(Na=function(C){for(var U=[],q=arguments.length,J=1;q>J;)U.push(arguments[J++]);return wu[++Xp]=function(){(De(C)?C:Function(C)).apply(void 0,U)},Us(Xp),Xp},ah=function(C){delete wu[C]},rs?Us=function(C){Gs.nextTick(ch(C))}:sh&&sh.now?Us=function(C){sh.now(ch(C))}:Jp&&!sa?(ku=(Mm=new Jp).port2,Mm.port1.onmessage=V_,Us=As(ku.postMessage,ku,1)):W.addEventListener&&De(W.postMessage)&&!W.importScripts&&ql&&ql.protocol!=="file:"&&!Y(Qp)?(Us=Qp,W.addEventListener("message",V_,!1)):Us="onreadystatechange"in nt("script")?function(C){pp.appendChild(nt("script")).onreadystatechange=function(){pp.removeChild(this),Rm(C)}}:function(C){setTimeout(ch(C),0)});var Fs,is,Vs,Du,Ou,La,Bs,Hl,Pc={set:Na,clear:ah},uh=/ipad|iphone|ipod/i.test(it)&&W.Pebble!==void 0,Zp=/web0s(?!.*chrome)/i.test(it),ef=Lr.f,tf=Pc.set,Yi=W.MutationObserver||W.WebKitMutationObserver,Cm=W.document,B_=W.process,$l=W.Promise,lh=ef(W,"queueMicrotask"),nf=lh&&lh.value;nf||(Fs=function(){var C,U;for(rs&&(C=B_.domain)&&C.exit();is;){U=is.fn,is=is.next;try{U()}catch(q){throw is?Du():Vs=void 0,q}}Vs=void 0,C&&C.enter()},sa||rs||Zp||!Yi||!Cm?!uh&&$l&&$l.resolve?((Bs=$l.resolve(void 0)).constructor=$l,Hl=Bs.then,Du=function(){Hl.call(Bs,Fs)}):Du=rs?function(){B_.nextTick(Fs)}:function(){tf.call(W,Fs)}:(Ou=!0,La=Cm.createTextNode(""),new Yi(Fs).observe(La,{characterData:!0}),Du=function(){La.data=Ou=!Ou}));var rf,bm,dh,Am,km=nf||function(C){var U={fn:C,next:void 0};Vs&&(Vs.next=U),is||(is=U,Du()),Vs=U},os=function(C){var U,q;this.promise=new C(function(J,ce){if(U!==void 0||q!==void 0)throw TypeError("Bad Promise constructor");U=J,q=ce}),this.resolve=dr(U),this.reject=dr(q)},xc={f:function(C){return new os(C)}},hh=function(C){try{return{error:!1,value:C()}}catch(U){return{error:!0,value:U}}},wm=typeof window=="object",Nu=Pc.set,Dm=an("species"),Fo="Promise",Om=st.get,j_=st.set,Uc=st.getterFor(Fo),js=oh&&oh.prototype,Pa=oh,Kl=js,q_=W.TypeError,ca=W.document,as=W.process,Lu=xc.f,H_=Lu,Pu=!!(ca&&ca.createEvent&&W.dispatchEvent),ua=De(W.PromiseRejectionEvent),Wl=!1,zl=ya(Fo,function(){var C=ci(Pa),U=C!==String(Pa);if(!U&&Fn===66)return!0;if(Fn>=51&&/native code/.test(C))return!1;var q=new Pa(function(ce){ce(1)}),J=function(ce){ce(function(){},function(){})};return(q.constructor={})[Dm]=J,!(Wl=q.then(function(){})instanceof J)||!U&&wm&&!ua}),of=zl||!Ud(function(C){Pa.all(C).catch(function(){})}),qs=function(C){var U;return!(!Qe(C)||!De(U=C.then))&&U},Hs=function(C,U){if(!C.notified){C.notified=!0;var q=C.reactions;km(function(){for(var J=C.value,ce=C.state==1,z=0;q.length>z;){var pe,ye,ue,be=q[z++],He=ce?be.ok:be.fail,gt=be.resolve,mt=be.reject,ot=be.domain;try{He?(ce||(C.rejection===2&&af(C),C.rejection=1),He===!0?pe=J:(ot&&ot.enter(),pe=He(J),ot&&(ot.exit(),ue=!0)),pe===be.promise?mt(q_("Promise-chain cycle")):(ye=qs(pe))?ye.call(pe,gt,mt):gt(pe)):mt(J)}catch(Zt){ot&&!ue&&ot.exit(),mt(Zt)}}C.reactions=[],C.notified=!1,U&&!C.rejection&&w0(C)})}},ph=function(C,U,q){var J,ce;Pu?((J=ca.createEvent("Event")).promise=U,J.reason=q,J.initEvent(C,!1,!0),W.dispatchEvent(J)):J={promise:U,reason:q},!ua&&(ce=W["on"+C])?ce(J):C==="unhandledrejection"&&function(z,pe){var ye=W.console;ye&&ye.error&&(arguments.length===1?ye.error(z):ye.error(z,pe))}("Unhandled promise rejection",q)},w0=function(C){Nu.call(W,function(){var U,q=C.facade,J=C.value;if(Nm(C)&&(U=hh(function(){rs?as.emit("unhandledRejection",J,q):ph("unhandledrejection",q,J)}),C.rejection=rs||Nm(C)?2:1,U.error))throw U.value})},Nm=function(C){return C.rejection!==1&&!C.parent},af=function(C){Nu.call(W,function(){var U=C.facade;rs?as.emit("rejectionHandled",U):ph("rejectionhandled",U,C.value)})},Vo=function(C,U,q){return function(J){C(U,J,q)}},Yl=function(C,U,q){C.done||(C.done=!0,q&&(C=q),C.value=U,C.state=2,Hs(C,!0))},sf=function(C,U,q){if(!C.done){C.done=!0,q&&(C=q);try{if(C.facade===U)throw q_("Promise can't be resolved itself");var J=qs(U);J?km(function(){var ce={done:!1};try{J.call(U,Vo(sf,ce,C),Vo(Yl,ce,C))}catch(z){Yl(ce,z,C)}}):(C.value=U,C.state=1,Hs(C,!1))}catch(ce){Yl({done:!1},ce,C)}}};if(zl&&(Kl=(Pa=function(C){Ra(this,Pa,Fo),dr(C),rf.call(this);var U=Om(this);try{C(Vo(sf,U),Vo(Yl,U))}catch(q){Yl(U,q)}}).prototype,(rf=function(C){j_(this,{type:Fo,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=fu(Kl,{then:function(C,U){var q=Uc(this),J=Lu(Tc(this,Pa));return J.ok=!De(C)||C,J.fail=De(U)&&U,J.domain=rs?as.domain:void 0,q.parent=!0,q.reactions.push(J),q.state!=0&&Hs(q,!1),J.promise},catch:function(C){return this.then(void 0,C)}}),bm=function(){var C=new rf,U=Om(C);this.promise=C,this.resolve=Vo(sf,U),this.reject=Vo(Yl,U)},xc.f=Lu=function(C){return C===Pa||C===dh?new bm(C):H_(C)},De(oh)&&js!==Object.prototype)){Am=js.then,Wl||(Pr(js,"then",function(C,U){var q=this;return new Pa(function(J,ce){Am.call(q,J,ce)}).then(C,U)},{unsafe:!0}),Pr(js,"catch",Kl.catch,{unsafe:!0}));try{delete js.constructor}catch{}li&&li(js,Kl)}wi({global:!0,wrap:!0,forced:zl},{Promise:Pa}),Sl(Pa,Fo,!1),Ui(Fo),dh=ft(Fo),wi({target:Fo,stat:!0,forced:zl},{reject:function(C){var U=Lu(this);return U.reject.call(void 0,C),U.promise}}),wi({target:Fo,stat:!0,forced:zl},{resolve:function(C){return function(U,q){if(pr(U),Qe(q)&&q.constructor===U)return q;var J=xc.f(U);return(0,J.resolve)(q),J.promise}(this,C)}}),wi({target:Fo,stat:!0,forced:of},{all:function(C){var U=this,q=Lu(U),J=q.resolve,ce=q.reject,z=hh(function(){var pe=dr(U.resolve),ye=[],ue=0,be=1;_p(C,function(He){var gt=ue++,mt=!1;ye.push(void 0),be++,pe.call(U,He).then(function(ot){mt||(mt=!0,ye[gt]=ot,--be||J(ye))},ce)}),--be||J(ye)});return z.error&&ce(z.value),q.promise},race:function(C){var U=this,q=Lu(U),J=q.reject,ce=hh(function(){var z=dr(U.resolve);_p(C,function(pe){z.call(U,pe).then(q.resolve,J)})});return ce.error&&J(ce.value),q.promise}});var $_=function(){function C(){A(this,C),this.selfieSegmentation=null}var U,q,J;return x(C,[{key:"init",value:(J=R(regeneratorRuntime.mark(function ce(){return regeneratorRuntime.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,this.loadScript();case 2:return z.next=4,this.initSelfie();case 4:case"end":return z.stop()}},ce,this)})),function(){return J.apply(this,arguments)})},{key:"loadResources",value:(q=R(regeneratorRuntime.mark(function ce(){return regeneratorRuntime.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,window.selfieSegmentation.initialize();case 2:case"end":return z.stop()}},ce)})),function(){return q.apply(this,arguments)})},{key:"initSelfie",value:(U=R(regeneratorRuntime.mark(function ce(){return regeneratorRuntime.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,new window.SelfieSegmentation({locateFile:function(pe){return"https://web.sdk.qcloud.com/trtc/webrtc/test/iris-test/selfie_segmentation/".concat(pe)}});case 2:this.selfieSegmentation=z.sent,window.selfieSegmentation=this.selfieSegmentation;case 4:case"end":return z.stop()}},ce,this)})),function(){return U.apply(this,arguments)})},{key:"loadScript",value:function(){return new Promise(function(ce,z){var pe=document.createElement("script");pe.type="text/javascript",pe.crossOrigin="anonymous",pe.onload=function(){return ce()},pe.onerror=function(){return z("load selfie_segmentation error")},pe.src="https://web.sdk.qcloud.com/trtc/webrtc/test/iris-test/selfie_segmentation/selfie_segmentation.js",document.getElementsByTagName("head")[0].appendChild(pe)})}}]),C}(),cf=function(C){return typeof C=="number"},ss=function(){function C(){A(this,C),this.videoBeauty=document.createElement("video"),this.videoBeauty.loop=!0,this.videoBeauty.autoplay=!0,this.videoVirtual=document.createElement("video"),this.videoVirtual.loop=!0,this.videoVirtual.autoplay=!0,this.canvasBeauty=document.createElement("canvas"),this.filter=new k0({canvas:this.canvasBeauty,video:this.videoBeauty}),this.canvasVirtual=document.createElement("canvas"),this.virtual=new F_({canvas:this.canvasVirtual,video:this.videoVirtual}),this.beautyParams={beauty:.5,brightness:.5,ruddy:.5},this.timeoutId=null,this.rafId=null,this.startTime=null,this.originTrack=null,this.beautyTrack=null,this.resultTrack=null,this.localStream=null,this.frameRate=null,this.disableStatus=!1}var U,q,J,ce,z;return x(C,[{key:"generateBeautyStream",value:function(pe){var ye=pe.getVideoTrack();if(!ye)throw new Error("Your localStream does not contain video track.");var ue=this.generateBeautyTrack(ye);return pe.replaceTrack(ue),this.localStream=pe,pe.setBeautyStatus&&pe.setBeautyStatus(!0),pe}},{key:"generateBeautyTrack",value:function(pe){var ye=this;this.reset();var ue=pe.getSettings();this.frameRate=ue.frameRate,this.filter.setRect(ue.width,ue.height),this.setRect(ue.width,ue.height);var be=new MediaStream;be.addTrack(pe),this.videoBeauty.srcObject=be,this.videoBeauty.play();var He=this.canvasBeauty.captureStream(this.frameRate||15).getVideoTracks()[0];return this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(function(){ye.startTime=new Date().getTime(),ye.render()}),this.installEvents(),this.originTrack=pe,this.beautyTrack=He,this.setTrackParam({type:"beauty",originTrack:pe,resultTrack:He,param:this.beautyParams}),He}},{key:"loadResources",value:(z=R(regeneratorRuntime.mark(function pe(){var ye;return regeneratorRuntime.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:return ye=new $_,ue.next=3,ye.init();case 3:return ue.next=5,ye.loadResources();case 5:case"end":return ue.stop()}},pe)})),function(){return z.apply(this,arguments)})},{key:"setBackground",value:function(pe){if(!(pe instanceof HTMLImageElement))throw new Error("you should use an HTMLImageElement to set background");this.virtual.setBackground(pe)}},{key:"generateStream",value:(ce=R(regeneratorRuntime.mark(function pe(ye){var ue,be,He,gt,mt;return regeneratorRuntime.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:if(ue=ye.localStream,be=ye.type,He=ye.img,gt=ue.getVideoTrack()){ot.next=4;break}throw new Error("Your localStream does not contain video track.");case 4:return this.localStream=ue,ot.next=7,this.generateMixedTrack({videoTrack:gt,type:be,img:He});case 7:return mt=ot.sent,ue.replaceTrack(mt),ue.setBeautyStatus&&ue.setBeautyStatus(!0),ot.abrupt("return",ue);case 11:case"end":return ot.stop()}},pe,this)})),function(pe){return ce.apply(this,arguments)})},{key:"generateMixedTrack",value:(J=R(regeneratorRuntime.mark(function pe(ye){var ue,be,He,gt,mt;return regeneratorRuntime.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:if(ue=ye.videoTrack,be=ye.type,He=ye.img,window.selfieSegmentation){ot.next=3;break}throw new Error("you should call loadResources() first");case 3:return this.virtual.initVirtualParams({type:be,img:He}),ot.next=6,this.generateBeautyTrack(ue);case 6:return gt=ot.sent,ot.next=9,this.generateVirtualTrack({videoTrack:gt,type:be,img:He});case 9:return mt=ot.sent,this.beautyTrack=gt,this.resultTrack=mt,this.setTrackParam({type:"mixed",originTrack:this.originTrack,resultTrack:this.resultTrack,param:{type:be,img:He}}),ot.abrupt("return",this.resultTrack);case 14:case"end":return ot.stop()}},pe,this)})),function(pe){return J.apply(this,arguments)})},{key:"generateVirtualStream",value:(q=R(regeneratorRuntime.mark(function pe(ye){var ue,be,He,gt,mt;return regeneratorRuntime.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:if(ue=ye.localStream,be=ye.type,He=ye.img,gt=ue.getVideoTrack()){ot.next=4;break}throw new Error("Your localStream does not contain video track.");case 4:return this.localStream=ue,ot.next=7,this.generateVirtualTrack({videoTrack:gt,type:be,img:He});case 7:return mt=ot.sent,ue.replaceTrack(mt),ue.setBeautyStatus&&ue.setBeautyStatus(!0),ot.abrupt("return",ue);case 11:case"end":return ot.stop()}},pe,this)})),function(pe){return q.apply(this,arguments)})},{key:"generateVirtualTrack",value:(U=R(regeneratorRuntime.mark(function pe(ye){var ue,be,He,gt,mt;return regeneratorRuntime.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:if(ue=ye.videoTrack,be=ye.type,He=ye.img,window.selfieSegmentation){ot.next=3;break}throw new Error("you should call loadResources() first");case 3:return this.virtual.initVirtualParams({type:be,img:He}),gt=ue.getSettings(),this.frameRate=gt.frameRate,this.virtual.setRect(gt.width,gt.height),this.setRect(gt.width,gt.height),(mt=new MediaStream).addTrack(ue),this.videoVirtual.srcObject=mt,ot.next=13,this.videoVirtual.play();case 13:return this.virtual.startVirtual(this.frameRate),ot.next=16,this.virtual.render();case 16:return this.originTrack=ue,this.resultTrack=this.canvasVirtual.captureStream(this.frameRate||15).getVideoTracks()[0],this.setTrackParam({type:"virtual",originTrack:this.originTrack,resultTrack:this.resultTrack,param:{type:be,img:He}}),ot.abrupt("return",this.resultTrack);case 20:case"end":return ot.stop()}},pe,this)})),function(pe){return U.apply(this,arguments)})},{key:"deleteSource",value:function(pe){if(g){var ye=g.beautyTrackMap.get(pe);ye&&(ye.type==="mixed"&&this.deleteSource(ye.originTrack.id),ye.originTrack&&(ye.originTrack.stop(),ye.originTrack=null),ye.beautyTrack&&(ye.beautyTrack.stop(),ye.beautyTrack=null),ye.resultTrack&&(ye.resultTrack.stop(),ye.resultTrack=null),g.beautyTrackMap.delete(pe))}}},{key:"draw",value:function(){this.videoBeauty&&this.videoBeauty.readyState===this.videoBeauty.HAVE_ENOUGH_DATA&&this.filter.apply(this.videoBeauty)}},{key:"render",value:function(){var pe=this,ye=new Date().getTime();ye-this.startTime>1e3/this.frameRate&&(this.draw(),this.startTime=ye),document.hidden?(clearTimeout(this.timeoutId),this.timeoutId=setTimeout(function(){pe.render()},1e3/this.frameRate)):(this.timeoutId&&clearTimeout(this.timeoutId),this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(this.render.bind(this)))}},{key:"setBeautyParam",value:function(pe){var ye=pe.beauty,ue=pe.brightness,be=pe.ruddy;cf(ye)&&(this.beautyParams.beauty=ye),cf(ue)&&(this.beautyParams.brightness=ue),cf(be)&&(this.beautyParams.ruddy=be),this.filter.setBeautyParams(this.beautyParams),this.getClose()&&!this.disableStatus&&this.disable(),!this.getClose()&&this.disableStatus&&this.enable()}},{key:"setRect",value:function(pe,ye){var ue=pe||640,be=ye||480;this.videoBeauty.height=be,this.videoBeauty.width=ue,this.canvasBeauty.height=be,this.canvasBeauty.width=ue,this.videoVirtual.height=be,this.videoVirtual.width=ue,this.canvasVirtual.height=be,this.canvasVirtual.width=ue}},{key:"reset",value:function(){cancelAnimationFrame(this.rafId),clearTimeout(this.timeoutId),this.videoBeauty.pause(),this.filter.reset(),this.beautyTrack&&this.beautyTrack.stop(),this.videoVirtual.pause(),this.resultTrack&&this.resultTrack.stop(),this.originTrack&&this.originTrack.stop()}},{key:"destroy",value:function(){cancelAnimationFrame(this.rafId),clearTimeout(this.timeoutId),this.canvasBeauty&&(this.canvasBeauty.width=0,this.canvasBeauty.height=0,this.canvasBeauty.remove(),this.canvasBeauty=null),this.videoBeauty&&(this.videoBeauty.pause(),this.videoBeauty.removeAttribute("srcObject"),this.videoBeauty.removeAttribute("src"),this.videoBeauty.load(),this.videoBeauty.width=0,this.videoBeauty.height=0,this.videoBeauty.remove(),this.videoBeauty=null),this.beautyTrack&&(this.deleteSource(this.beautyTrack.id),this.beautyTrack.stop(),this.beautyTrack=null),this.originTrack&&(this.originTrack.stop(),this.originTrack=null),this.resultTrack&&(this.deleteSource(this.resultTrack.id),this.resultTrack.stop(),this.resultTrack=null),this.canvasVirtual&&(this.canvasVirtual.width=0,this.canvasVirtual.height=0,this.canvasVirtual.remove(),this.canvasVirtual=null),this.videoVirtual&&(this.videoVirtual.pause(),this.videoVirtual.removeAttribute("srcObject"),this.videoVirtual.removeAttribute("src"),this.videoVirtual.load(),this.videoVirtual.width=0,this.videoVirtual.height=0,this.videoVirtual.remove(),this.videoVirtual=null),this.virtual.destroy(),this.uninstallEvents()}},{key:"generateVideoTrackFromCanvasCapture",value:function(pe){return this.canvasVirtual.captureStream(pe).getVideoTracks()[0]}},{key:"setTrackParam",value:function(pe){var ye=pe.type,ue=pe.originTrack,be=pe.resultTrack,He=pe.param;g&&(g.beautyTrackMap||(g.beautyTrackMap=new Map),g.beautyTrackMap.set(be.id,{type:ye,originTrack:ue,resultTrack:be,param:He,pluginInstance:this}))}},{key:"disable",value:function(){this.localStream&&this.originTrack&&(this.localStream.replaceTrack(this.originTrack),cancelAnimationFrame(this.rafId),clearTimeout(this.timeoutId),this.disableStatus=!0)}},{key:"enable",value:function(){this.localStream&&this.beautyTrack&&(this.localStream.replaceTrack(this.beautyTrack),this.render(),this.disableStatus=!1)}},{key:"installEvents",value:function(){document.addEventListener("visibilitychange",this.render.bind(this))}},{key:"uninstallEvents",value:function(){document.removeEventListener("visibilitychange",this.render.bind(this))}},{key:"getClose",value:function(){return this.beautyParams.beauty===0&&this.beautyParams.brightness===0&&this.beautyParams.ruddy===0}}]),C}();return g&&(g.getRTCBeautyPlugin=function(){return new ss}),ss})})(AL);const i8=AL.exports;class o8 extends gg(mg){async setBeautyStyle(s,g,m,R){try{this.beautyPlugin||(this.beautyPlugin=new i8,this.localStream&&this.localStream.getVideoTrack()&&this.beautyPlugin.generateBeautyStream(this.localStream));const A=.11,D={beauty:g*A||this.beautyDefaultBeauty,brightness:m*A||this.beautyDefaultBrightness,ruddy:R*A||this.beautyDefaultRuddy};this.beautyPlugin.setBeautyParam(D)}catch(A){this.callFunctionErrorManage(A,"setBeautyStyle")}}destroyBeautyPlugin(){try{this.beautyPlugin&&this.beautyPlugin.destroy()}catch(s){this.callFunctionErrorManage(s,"destroyBeautyPlugin")}}}let AS=null;class vb extends gg(Db.exports.EventEmitter,mg,Q5,Z5,e8,t8,n8,r8,o8){constructor(){super();we(this,"logPrefix","universal");we(this,"enableAudioVolumeInterval",0);we(this,"enableAudioVolumeTimer",-1);we(this,"log_");this.log_=this.TRTC.Logger.loggerManager,this.handleError=this.handleError.bind(this),this.handlePeerJoin=this.handlePeerJoin.bind(this),this.handlePeerLeave=this.handlePeerLeave.bind(this),this.handleStreamAdded=this.handleStreamAdded.bind(this),this.handleStreamSubscribed=this.handleStreamSubscribed.bind(this),this.handleStreamRemoved=this.handleStreamRemoved.bind(this),this.handleStreamUpdated=this.handleStreamUpdated.bind(this),this.handleMuteAudio=this.handleMuteAudio.bind(this),this.handleUnmuteAudio=this.handleUnmuteAudio.bind(this),this.handleMuteVideo=this.handleMuteVideo.bind(this),this.handleUnmuteVideo=this.handleUnmuteVideo.bind(this),this.handleAudioVolume=this.handleAudioVolume.bind(this),this.handleNetworkQuality=this.handleNetworkQuality.bind(this)}static getTRTCShareInstance(){return AS||(AS=new vb),AS}static destroyTRTCShareInstance(){AS&&(AS.destroy(),AS=null)}async enterRoom(g,m){if(g instanceof ML){const{sdkAppId:R,userId:A,userSig:D,roomId:x,strRoomId:$,role:B,privateMapKey:te,streamId:re}=g;this.sdkAppId=R,this.userId=A,this.userSig=D,this.roomId=x,this.strRoomId=$,this.mode=K5[m],this.role=$O[B],this.remoteUserAvailable=new Map;let ie=x,W=!1;if(!x&&$&&(ie=$,W=!0),this.isJoining||this.isJoined){this.log_.error(`(enterRoom) failed - ${XO.message} isJoining: ${this.isJoining}, isJoined: ${this.isJoined}`),this.emitError(XO);return}try{this.isJoining=!0;let Y={sdkAppId:R,userId:A,userSig:D,mode:this.mode,useStringRoomId:W,frameWorkType:38};Y=te?{...Y,privateMapKey:te}:Y,Y=re?{...Y,streamId:re}:Y,this.initClient(Y),this.startJoinTimestamp=WO(),await this.client.join({roomId:ie,role:this.role}),this.isJoined=!0,this.isJoining=!1,this.joinedTimestamp=WO();const se=this.joinedTimestamp-this.startJoinTimestamp;this.emit("onEnterRoom",se),this.log_.info("(enterRoom) success - enter room"),await this.publishLocalStream()}catch(Y){this.isJoining=!1,this.emit("onEnterRoom",j5),this.callFunctionErrorManage(Y,"enterRoom")}}else this.emitError(Ms),this.log_.error(`(enterRoom) failed - ${Ms.message}: ${JSON.stringify(g)}`)}async exitRoom(){this.log_.info(`(exitRoom) exitRoom, isJoined: ${this.isJoined}; isPublished: ${this.isPublished}`);try{if(!this.isJoined||this.isExiting){this.log_.error(`(exitRoom) failed - ${QO.message} isJoined: ${this.isJoined} isExiting: ${this.isExiting}`),this.emitError(QO);return}this.isExiting=!0,this.isSharing&&await this.stopScreenShare(),this.isPublished&&(await this.unPublishStream(),this.destroyLocalStream()),await this.client.leave(),this.destroyBeautyPlugin(),this.resetStatus(),this.destroy(),this.emit("onExitRoom",Gw.ActiveExitRoom),this.log_.info("(exitRoom) success - exit room")}catch(g){this.isExiting=!1,this.callFunctionErrorManage(g,"exitRoom")}}async switchRole(g){if(this.mode===mb){this.log_.info(`(publishLocalStream) failed - mode = ${this.mode}, role = ${g}`);return}await this.client.switchRole(g===uT.TRTCRoleAnchor?"anchor":"audience"),this.role=$O[g]}getSDKVersion(){return this.VERSION||""}callFunctionErrorManage(g,m){g&&g.getCode&&g.getCode()?(this.emit(XC,g.getCode(),g.message_),this.log_.error(`(${m}) failed - ${g.message_}`)):(this.emit(XC,X5.code,g.message),this.log_.error(`(${m}) failed - ${g.message}`))}resetStatus(){this.isExiting=!1,this.isJoining=!1,this.isJoined=!1,this.isPublishing=!1,this.isPublished=!1,this.isSubscribed=!1,this.remoteStreamMap.clear()}async publishLocalStream(){const{mode:g,role:m,isJoined:R,isPublishing:A,isPublished:D,localStream:x,client:$}=this;if(g===Uw&&m===CL){this.log_.info(`(publishLocalStream) failed - mode = ${g}, role = ${m}`);return}if(!R||A||D||!x||!$){this.log_.info(`(publishLocalStream) failed - isJoined = ${R},
        isPublishing = ${A}, isPublished = ${D}, localStream = ${x}, client = ${$}`);return}if(this.log_.info("(publishLocalStream) start - publish stream"),R&&!D){this.isPublishing=!0;try{await this.setStreamVideoParam(this.videoEncodeParam),await this.client.publish(this.localStream),this.isPublishing=!1,this.isPublished=!0,this.enableAudioVolumeTimer&&clearInterval(this.enableAudioVolumeTimer),this.log_.info("(publishLocalStream) success - publish stream")}catch(B){this.isPublishing=!1,this.callFunctionErrorManage(B,"publishLocalStream")}}}async unPublishStream(){this.log_.info("(unPublishStream) unPublishStream",this.localStream),this.isPublished&&this.localStream&&(await this.client.unpublish(this.localStream),this.isPublished=!1)}async setStreamVideoParam(g){try{if(this.localStream){let m=this.localStream.getVideoTrack();if(!m)return;if(await this.localStream.setVideoProfile(g),m=this.localStream.getVideoTrack(),m){const R=m.getSettings();console.log(`\u5206\u8FA8\u7387\uFF1A${R.width} * ${R.height}, \u5E27\u7387\uFF1A${R.frameRate}`)}}else this.videoEncodeParam=g}catch(m){if(m.name==="OverconstrainedError"){console.error("\u5F53\u524D\u6444\u50CF\u5934\u4E0D\u652F\u6301\u8BE5 profile");const R=this.TRTC.createStream({video:!0,audio:!1});await R.initialize(),this.localStream.replaceTrack(R.getVideoTrack())}else console.error("\u5F53\u524D\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u52A8\u6001\u8C03\u7528\u8BE5\u63A5\u53E3")}}destroyLocalStream(){this.localStream&&(this.localStream.stop(),this.localStream&&this.localStream.close())}destroy(){this.unbindEvents(),this.client&&(this.client=null)}enableAudioVolumeEvaluation(g){this.client&&this.client.enableAudioVolumeEvaluation(g),this.enableAudioVolumeInterval=g}async initStream(g){this.localStream=this.TRTC.createStream(g),this.videoEncodeParam&&this.localStream.setVideoProfile(this.videoEncodeParam),await this.localStream.initialize()}localStreamHasVideoOrAudio(g){if((!g||!z5(g))&&this.emitError(Ms),!this.localStream)return!1;switch(g){case"video":return!!this.localStream.getVideoTrack();case"audio":return!!this.localStream.getAudioTrack();default:return!1}}async playStream(g,m,R){if(!m||!g){this.log_.error(`(playStream) failed - dom = ${m}, stream = ${g}`);return}g.play(m,R),this.playViewMap.set(`${g.getUserId()}_${g.getType()}`,m)}initClient(g){this.client=this.TRTC.createClient(g),this.enableAudioVolumeInterval&&this.client.enableAudioVolumeEvaluation(this.enableAudioVolumeInterval),this.bindEvents()}bindEvents(){this.client.on("error",this.handleError),this.client.on("peer-join",this.handlePeerJoin),this.client.on("peer-leave",this.handlePeerLeave),this.client.on("stream-added",this.handleStreamAdded),this.client.on("stream-subscribed",this.handleStreamSubscribed),this.client.on("stream-removed",this.handleStreamRemoved),this.client.on("stream-updated",this.handleStreamUpdated),this.client.on("mute-audio",this.handleMuteAudio),this.client.on("unmute-audio",this.handleUnmuteAudio),this.client.on("mute-video",this.handleMuteVideo),this.client.on("unmute-video",this.handleUnmuteVideo),this.client.on("client-banned",g=>{this.log_.error(`client has been banned for ${g}`),this.emit("onExitRoom",Gw.KickedExitRoom)}),this.client.on("audio-volume",this.handleAudioVolume),this.client.on("network-quality",this.handleNetworkQuality)}unbindEvents(){this.client&&this.client.off("*")}emitError(g){!g||!this.emit||this.emit(XC,g.code,g.message)}handleError(g){console.error("onError = ",g),this.emit(XC,g.getCode(),g.message)}handlePeerJoin(g){const{userId:m}=g;this.remoteUserAvailable.set(m,{isAudioAvailable:!1,isVideoAvailable:!1}),this.emit("onRemoteUserEnterRoom",m)}handlePeerLeave(g){const{userId:m}=g,R=0;this.emit("onRemoteUserLeaveRoom",m,R)}handleStreamAdded(g){const{stream:m}=g,R=m.getUserId(),A=m&&m.getType();this.remoteStreamMap.set(`${R}-${A}`,g.stream),A===ST?this.emit("onUserSubStreamAvailable",R,1):(m.hasAudio()&&(this.remoteUserAvailable.get(R).isAudioAvailable=!0,this.emit("onUserAudioAvailable",R,1)),m.hasVideo()&&(this.remoteUserAvailable.get(R).isVideoAvailable=!0,this.emit("onUserVideoAvailable",R,1))),this.handleSubscribe(g.stream)}async handleSubscribe(g,m={audio:!0,video:!0}){try{await this.client.subscribe(g,{audio:BS(m.audio)?!0:m.audio,video:BS(m.video)?!0:m.video})}catch(R){console.error(`subscribe ${g.getUserId()} with audio: ${m.audio} video: ${m.video} error`,R)}}handleStreamSubscribed(){this.isSubscribed=!0}handleStreamRemoved(g){const m=g.stream,R=m.getUserId(),A=m.getType();A==="main"?(this.emit("onUserAudioAvailable",R,0),this.emit("onUserVideoAvailable",R,0)):A==="auxiliary"&&this.emit("onUserSubStreamAvailable",R,0),this.remoteStreamMap.delete(`${R}-${A}`)}handleStreamUpdated(g){const{stream:m}=g,R=m.getUserId();m.hasAudio()&&!this.remoteUserAvailable.get(R).isAudioAvailable&&(this.remoteUserAvailable.get(R).isAudioAvailable=!0,this.emit("onUserAudioAvailable",R,1)),m.hasVideo()&&!this.remoteUserAvailable.get(R).isAudioAvailable&&(this.remoteUserAvailable.get(R).isVideoAvailable=!0,this.emit("onUserVideoAvailable",R,1))}handleMuteAudio(g){this.emit("onUserAudioAvailable",g.userId,0)}handleUnmuteAudio(g){this.emit("onUserAudioAvailable",g.userId,1)}handleMuteVideo(g){this.emit("onUserVideoAvailable",g.userId,0)}handleUnmuteVideo(g){this.emit("onUserVideoAvailable",g.userId,1)}handleAudioVolume(g){const{result:m}=g;this.emit("onUserVoiceVolume",m)}getLocalStatistics(){return this.client.getLocalVideoStats().then(g=>{const m=g[this.client.getUserId()];let R=m.bytesSent-this.prevLocalVideoStats.bytesSent,A=m.framesEncoded-this.prevLocalVideoStats.framesEncoded;const D=m.frameWidth,x=m.frameHeight;R<0&&(R=0),A<0&&(A=0),this.prevLocalVideoStats=m;const $=Number((R*8/1e3/2).toFixed()),B=Number((A/2).toFixed()),te=Ed.TRTCVideoStreamTypeBig;return new V5(D,x,B,$,0,0,te)})}async handleNetworkQuality(g){const{uplinkNetworkQuality:m,uplinkRTT:R,uplinkLoss:A,downlinkLoss:D}=g,x=new G5("",m);this.emit("onNetworkQuality",x);const $=await this.getLocalStatistics(),B=new B5(A,D,0,0,R,0,0,[$]);this.emit("onStatistics",B)}}const kS={ENTER_ROOM:"enterRoom",EXIT_ROOM:"exitRoom"},_b=class{constructor(){we(this,"sdkAppId",0);we(this,"roomId",0);we(this,"userId","");we(this,"userSig","");we(this,"isInRoom",!1);we(this,"role",0);we(this,"rtcCloud");we(this,"methodResolveRejectMap",new Map);we(this,"emitter",new bT);this.rtcCloud=vb.getTRTCShareInstance(),this.onEnterRoom=this.onEnterRoom.bind(this),this.onExitRoom=this.onExitRoom.bind(this),this.bindEvent()}invokeEventCallbacks(s,g){if(this.methodResolveRejectMap.has(s)){const m=this.methodResolveRejectMap.get(s);m&&m.length&&(m.forEach(({resolve:R,reject:A})=>{g.isSuccess?R(Ot.success(g.data||null)):A(Ht.error(g.data.code,g.data.message))}),this.methodResolveRejectMap.delete(s))}}onEnterRoom(s){Fe.log(`${_b.logPrefix}.onEnterRoom result: ${s}`);let g=null;s>0?(g={isSuccess:!0,data:s},this.isInRoom=!0):(g={isSuccess:!1,data:{code:Jt.ENTER_ROOM_ERROR,message:yn.ENTER_ROOM_ERROR}},this.isInRoom=!1),this.invokeEventCallbacks(kS.ENTER_ROOM,g)}onExitRoom(s){Fe.log(`${_b.logPrefix}onExitRoom reason: ${s}`),this.invokeEventCallbacks(kS.EXIT_ROOM,{isSuccess:!0}),this.isInRoom=!1}bindEvent(){var s,g;(s=this.rtcCloud)==null||s.on("onEnterRoom",this.onEnterRoom),(g=this.rtcCloud)==null||g.on("onExitRoom",this.onExitRoom)}unbindEvent(){var s,g;(s=this.rtcCloud)==null||s.off("onEnterRoom",this.onEnterRoom),(g=this.rtcCloud)==null||g.off("onExitRoom",this.onExitRoom)}async enterRoom(s,g){return new Promise((m,R)=>{const A=this.methodResolveRejectMap.get(kS.ENTER_ROOM)||[];A.push({resolve:m,reject:R}),this.methodResolveRejectMap.set(kS.ENTER_ROOM,A),this.innerEnterRoom(s,g)})}innerEnterRoom(s,g){if(!this.rtcCloud)throw new Ht(Jt.TRTC_NOT_EXIST_ERROR,yn.TRTC_NOT_EXIST_ERROR);const{sdkAppId:m,roomId:R,userId:A,userSig:D,role:x}=s;this.sdkAppId=m,this.roomId=R,this.userId=A,this.userSig=D,this.role=x;const $=new ML;$.sdkAppId=m,$.roomId=R,$.userId=A,$.userSig=D,$.userDefineRecordId="",$.role=x,this.rtcCloud.enterRoom($,g)}async exitRoom(){return this.isInRoom?new Promise((s,g)=>{const m=this.methodResolveRejectMap.get(kS.EXIT_ROOM)||[];m.push({resolve:s,reject:g}),this.methodResolveRejectMap.set(kS.EXIT_ROOM,m),this.innerExitRoom()}):Ot.success()}async innerExitRoom(){if(!this.rtcCloud)throw new Ht(Jt.TRTC_NOT_EXIST_ERROR,yn.TRTC_NOT_EXIST_ERROR);await this.rtcCloud.stopLocalPreview(),await this.rtcCloud.stopLocalAudio(),this.rtcCloud.exitRoom()}async switchRole(s){if(!this.rtcCloud)throw new Ht(Jt.TRTC_NOT_EXIST_ERROR,yn.TRTC_NOT_EXIST_ERROR);await this.rtcCloud.switchRole(s)}setVideoEncoderParam(s){var g;(g=this.rtcCloud)==null||g.setVideoEncoderParam(s)}async startLocalVideo(s){var g;await((g=this.rtcCloud)==null?void 0:g.startLocalPreview(s))}async stopLocalVideo(){var s;await((s=this.rtcCloud)==null?void 0:s.stopLocalPreview())}async startLocalAudio(s){var g;await((g=this.rtcCloud)==null?void 0:g.startLocalAudio(s))}async stopLocalAudio(){var s;await((s=this.rtcCloud)==null?void 0:s.stopLocalAudio())}startSystemAudioLoopback(){var s;(s=this.rtcCloud)==null||s.startSystemAudioLoopback()}stopSystemAudioLoopback(){var s;(s=this.rtcCloud)==null||s.stopSystemAudioLoopback()}setVideoMirror(s){var g;(g=this.rtcCloud)==null||g.setLocalRenderParams({mirrorType:s?cg.TRTCVideoMirrorType_Enable:cg.TRTCVideoMirrorType_Disable,rotation:xw.TRTCVideoRotation0,fillMode:LS.TRTCVideoFillMode_Fit})}setRemoteVideoFillMode(s,g,m){var R;(R=this.rtcCloud)==null||R.setRemoteRenderParams(s,g,{mirrorType:cg.TRTCVideoMirrorType_Disable,rotation:xw.TRTCVideoRotation0,fillMode:m})}muteLocalVideo(s){var g;(g=this.rtcCloud)==null||g.muteLocalVideo(s)}muteLocalAudio(s){var g;(g=this.rtcCloud)==null||g.muteLocalAudio(s)}startCameraDeviceTest(s){var g;(g=this.rtcCloud)==null||g.startCameraDeviceTest(s)}stopCameraDeviceTest(){var s;(s=this.rtcCloud)==null||s.stopCameraDeviceTest()}startRemoteView(s,g,m){var R,A;m===ru.CAMERA?(R=this.rtcCloud)==null||R.startRemoteView(s,g,Ed.TRTCVideoStreamTypeBig):m===ru.SCREEN&&((A=this.rtcCloud)==null||A.startRemoteView(s,g,Ed.TRTCVideoStreamTypeSub))}stopRemoteView(s,g){var m,R;g===ru.CAMERA?(m=this.rtcCloud)==null||m.stopRemoteView(s,Ed.TRTCVideoStreamTypeBig):g===ru.SCREEN&&((R=this.rtcCloud)==null||R.stopRemoteView(s,Ed.TRTCVideoStreamTypeSub))}muteRemoteVideo(s,g){var m;(m=this.rtcCloud)==null||m.muteRemoteVideoStream(s,g)}muteRemoteAudio(s,g){var m;(m=this.rtcCloud)==null||m.muteRemoteAudio(s,g)}enableAudioVolumeEvaluation(s){var g;(g=this.rtcCloud)==null||g.enableAudioVolumeEvaluation(s)}setVideoQosPreference(s){var g;(g=this.rtcCloud)==null||g.setNetworkQosParam(s)}getMicrophoneList(){var s;return(s=this.rtcCloud)==null?void 0:s.getMicDevicesList()}getCurrentMicrophone(){var s;return(s=this.rtcCloud)==null?void 0:s.getCurrentMicDevice()}async setCurrentMicrophone(s){var g;await((g=this.rtcCloud)==null?void 0:g.setCurrentMicDevice(s))}async getCameraList(){var s;return await((s=this.rtcCloud)==null?void 0:s.getCameraDevicesList())}getCurrentCamera(){var s;return(s=this.rtcCloud)==null?void 0:s.getCurrentCameraDevice()}async setCurrentCamera(s){var g;await((g=this.rtcCloud)==null?void 0:g.setCurrentCameraDevice(s))}getSpeakerList(){var s;return(s=this.rtcCloud)==null?void 0:s.getSpeakerDevicesList()}getCurrentSpeaker(){var s;return(s=this.rtcCloud)==null?void 0:s.getCurrentSpeakerDevice()}async setCurrentSpeaker(s){var g;await((g=this.rtcCloud)==null?void 0:g.setCurrentSpeakerDevice(s))}on(s,g){var m;(m=this.rtcCloud)==null||m.on(s,g)}off(s,g){var m;(m=this.rtcCloud)==null||m.off(s,g)}getSDKVersion(){var s;return(s=this.rtcCloud)==null?void 0:s.getSDKVersion()}destroy(){this.unbindEvent(),vb.destroyTRTCShareInstance(),this.rtcCloud=null,this.sdkAppId=0,this.userSig="",this.userId="",this.roomId=0,this.isInRoom=!1}};let rb=_b;we(rb,"logPrefix","[BaseTRTCService]");const p1=class extends rb{constructor(){super()}getScreenCaptureSources(s,g,m,R){throw new Error("getScreenCaptureSources() not supported")}selectScreenCaptureTarget(s,g,m,R,A,D){throw new Error("selectScreenCaptureTarget() not supported")}async startScreenCapture(s,g){throw new Error("startScreenCapture() not supported")}async pauseScreenCapture(){throw new Error("pauseScreenCapture() not supported")}async resumeScreenCapture(){throw new Error("resumeScreenCapture() not supported")}async stopScreenCapture(){throw new Error("stopScreenCapture() not supported")}async startScreenShare(s){var g;if(!s.shareUserId||!s.shareUserSig)return Ot.fail(Jt.INVALID_PARAM_ERROR,yn.INVALID_PARAM_ERROR);try{return await((g=this.rtcCloud)==null?void 0:g.startScreenShare(s)),Ot.success()}catch(m){switch(m.name){case"NotReadableError":return Ot.fail(Jt.WEB_SCREEN_SHARE_SYSTEM_DENY,yn.WEB_SCREEN_SHARE_SYSTEM_DENY);case"NotAllowedError":return m.message.includes("Permission denied by system")?Ot.fail(Jt.WEB_SCREEN_SHARE_SYSTEM_DENY,yn.WEB_SCREEN_SHARE_SYSTEM_DENY):Ot.fail(Jt.WEB_SCREEN_SHARE_USER_DENY,yn.WEB_SCREEN_SHARE_USER_DENY);default:return Fe.error(`${p1.logPrefix}startScreenShare unknown error:`,m),Ot.fail(Jt.WEB_SCREEN_SHARE_UNKNOWN,yn.WEB_SCREEN_SHARE_UNKNOWN)}}}setScreenProfile(s){}async replaceScreenShare(){}async stopScreenShare(){var s;return await((s=this.rtcCloud)==null?void 0:s.stopScreenShare())}};let ib=p1;we(ib,"logPrefix","[TRTCService]");const Rr=class{constructor(){we(this,"sdkAppId",0);we(this,"isSdkReady",!1);we(this,"isLogin",!1);we(this,"userId","");we(this,"userSig","");we(this,"tim");we(this,"groupId","");we(this,"emitter",new bT);we(this,"loginResolveRejectCache");this.loginResolveRejectCache=[],this.onTIMReadyStateUpdate=this.onTIMReadyStateUpdate.bind(this),this.onError=this.onError.bind(this),this.onMessageReceived=this.onMessageReceived.bind(this)}init(s){const{sdkAppId:g,userId:m,userSig:R,tim:A}=s;this.sdkAppId=g,this.userId=m,this.userSig=R,this.tim=A,this.bindEvent()}preCheckMethodCall(){if(!this.isSdkReady)throw Ht.error(Jt.SDK_NOT_READY,yn.SDK_NOT_READY);if(!this.isLogin)throw Ht.error(Jt.NOT_LOGIN,yn.NOT_LOGIN)}setGroupId(s){this.groupId=`${OS}${s}`}async createGroup(s,g){Fe.debug(`${Rr.logPrefix}.createGroup groupId: ${s}`),this.preCheckMethodCall(),this.groupId=`${OS}${s}`;let m=null,R=null;try{return R=await this.tim.createGroup({type:Cr.TYPES.GRP_PUBLIC,name:this.groupId,groupID:this.groupId,joinOption:Cr.TYPES.JOIN_OPTIONS_FREE_ACCESS,notification:JSON.stringify(g)}),m=R.data.group,Fe.log(`${Rr.logPrefix}createGroup response:`,R),Ot.success(m)}catch(A){throw A instanceof Ht?A:(Fe.error(`${Rr.logPrefix}createGroup error:`,A),Ht.error(Jt.CREATE_GROUP_ERROR,yn.CREATE_GROUP_ERROR))}}async dismissGroup(){this.preCheckMethodCall();try{return await this.tim.dismissGroup(this.groupId),Ot.success()}catch(s){throw Fe.error(`${Rr.logPrefix}dismissGroup error:`,s),Ht.error(Jt.DISMISS_GROUP_ERROR,yn.DISMISS_GROUP_ERROR)}}async joinGroup(s){Fe.debug(`${Rr.logPrefix}.joinGroup groupID: ${s}`),this.preCheckMethodCall(),this.groupId=`${OS}${s}`;try{let g=null;const m=await this.tim.joinGroup({groupID:this.groupId,type:Cr.TYPES.GRP_PUBLIC});return m.data.status===Cr.TYPES.JOIN_STATUS_ALREADY_IN_GROUP?g=(await this.tim.searchGroupByID(this.groupId)).data.group:g=m.data.group,Fe.log(`${Rr.logPrefix}joinGroup groupInfo:`,g),Ot.success(g)}catch(g){if(Fe.error(`${Rr.logPrefix}joinGroup error:`,g),g.code===10013){const m=await this.tim.searchGroupByID(this.groupId);return Ot.success(m.data.group)}throw Ht.error(Jt.JOIN_GROUP_ERROR,yn.JOIN_GROUP_ERROR)}}async quitGroup(){Fe.debug(`${Rr.logPrefix}.quitGroup`),this.preCheckMethodCall();try{return await this.tim.quitGroup(this.groupId),Ot.success()}catch(s){throw Fe.error(`${Rr.logPrefix}quitGroup error:`,s),Ht.error(Jt.QUIT_GROUP_ERROR,yn.QUIT_GROUP_ERROR)}}async checkGroupExistence(s){Fe.debug(`${Rr.logPrefix}.checkGroupExistence groupId: ${s}`),this.preCheckMethodCall();let g=null;const m=`${OS}${s}`;try{g=(await this.tim.searchGroupByID(m)).data.group}catch{return Ot.success(null)}return Ot.success(g)}async getGroupProfile(s,g){Fe.debug(`${Rr.logPrefix}.getGroupProfile groupId: ${s}`);const m=`${OS}${s}`;try{const R={groupID:m};g&&Object.assign(R,{groupCustomFieldFilter:g});const D=(await this.tim.getGroupProfile(R)).data.group;return Ot.success(D)}catch(R){return Ot.fail(R.code,R.message)}}async changeGroupOwner(s){Fe.debug(`${Rr.logPrefix}.changeGroupOwner userId: ${s}`);try{return await this.tim.changeGroupOwner({groupID:this.groupId,newOwnerID:s}),Ot.success()}catch(g){throw Fe.error(`${Rr.logPrefix}changeGroupOwner error:`,g),Ht.error(Jt.CHANGE_GROUP_OWNER,yn.CHANGE_GROUP_OWNER)}}async getGroupMemberProfile(s){Fe.debug(`${Rr.logPrefix}.getGroupMemberProfile userIdList: ${s}`);try{const g=await this.tim.getGroupMemberProfile({groupID:this.groupId,userIDList:s}),{memberList:m}=g.data;return Ot.success(m)}catch(g){throw Fe.error(`${Rr.logPrefix}getGroupMemberProfile error:`,g),Ht.error(Jt.GET_GROUP_MEMBER_PROFILE_ERROR,yn.GET_GROUP_MEMBER_PROFILE_ERROR)}}async getGroupMemberList(){Fe.debug(`${Rr.logPrefix}.getGroupMemberList`);try{const s=await this.tim.getGroupMemberList({groupID:this.groupId,count:100,offset:0}),{memberList:g}=s.data;return Ot.success(g)}catch(s){throw Fe.error(`${Rr.logPrefix}getGroupMemberList error:`,s),Ht.error(Jt.GET_GROUP_MEMBER_LIST_ERROR,yn.GET_GROUP_MEMBER_LIST_ERROR)}}bindEvent(){this.tim.on(Cr.EVENT.SDK_READY,this.onTIMReadyStateUpdate),this.tim.on(Cr.EVENT.SDK_NOT_READY,this.onTIMReadyStateUpdate),this.tim.on(Cr.EVENT.ERROR,this.onError),this.tim.on(Cr.EVENT.MESSAGE_RECEIVED,this.onMessageReceived)}unbindEvent(){this.tim.off(Cr.EVENT.SDK_READY,this.onTIMReadyStateUpdate),this.tim.off(Cr.EVENT.SDK_NOT_READY,this.onTIMReadyStateUpdate),this.tim.off(Cr.EVENT.ERROR,this.onError),this.tim.off(Cr.EVENT.MESSAGE_RECEIVED,this.onMessageReceived)}onTIMReadyStateUpdate(s){Fe.debug(`${Rr.logPrefix}onTIMReadyStateUpdate event:`,s),s.name===Cr.EVENT.SDK_READY?(this.isSdkReady=!0,this.isLogin=!0,this.loginResolveRejectCache.forEach(({resolve:m})=>{m(Ot.success())})):(this.isSdkReady=!1,this.isLogin=!1,this.loginResolveRejectCache.forEach(({reject:m})=>{m(Ht.error(Jt.LOGIN_ERROR,JSON.stringify(s)))}),this.unbindEvent()),this.loginResolveRejectCache=[]}onError(s){Fe.error(`${Rr.logPrefix}onError error:`,s)}onMessageReceived(s){Fe.log(`${Rr.logPrefix}onMessageReceived message:`,s),s.data.forEach(g=>{if(g.to===this.groupId)switch(g.type){case Cr.TYPES.MSG_TEXT:this.handleTextMessage(g);break;case Cr.TYPES.MSG_CUSTOM:this.handleCustomMessage(g);break;case Cr.TYPES.MSG_GRP_SYS_NOTICE:this.handleGroupNotice(g);break;case Cr.TYPES.MSG_GRP_TIP:this.handleGroupTip(g);break;default:Fe.warn(`${Rr.logPrefix}onMessageReceived ignored message:`,g)}})}handleTextMessage(s){Fe.log(`${Rr.logPrefix}handleTextMessage message:`,s),this.emitter.emit(ze.onReceiveChatMessage,Sr(s))}handleCustomMessage(s){Fe.log(`${Rr.logPrefix}handleCustomMessage message:`,s),this.emitter.emit(ze.onReceiveCustomMessage,Sr(s))}handleGroupNotice(s){Fe.log(`${Rr.logPrefix}handleGroupNotice message:`,s);const{operationType:g}=s.payload;switch(g){case 5:this.emitter.emit(ze.onRoomDestroyed,null);break;default:Fe.warn(`${Rr.logPrefix}handleGroupNotice ignored notice:`,s)}}handleGroupTip(s){Fe.log(`${Rr.logPrefix}handleGroupTip message:`,s);const{payload:{operatorID:g,operationType:m}}=s;switch(m){case Cr.TYPES.GRP_TIP_MBR_JOIN:this.emitter.emit("onRemoteUserEnterRoom",g);break;case Cr.TYPES.GRP_TIP_MBR_QUIT:this.emitter.emit("onRemoteUserLeaveRoom",g);break;case Cr.TYPES.GRP_TIP_GRP_PROFILE_UPDATED:this.handleGroupProfileUpdate(s.payload);break}}handleGroupProfileUpdate(s){Fe.log(`${Rr.logPrefix}handleGroupProfileUpdate message:`,s);const{newGroupProfile:g}=s;g.ownerID&&this.emitter.emit(ze.onRoomMasterChanged,g.ownerID)}async sendChatMessage(s){this.preCheckMethodCall();try{const g=this.tim.createTextMessage({to:this.groupId,conversationType:Cr.TYPES.CONV_GROUP,payload:{text:s}}),m=await this.tim.sendMessage(g);if(Fe.log(`${Rr.logPrefix}sendChatMessage success:`,m),m.code===0)return Ot.success(Sr(m.data.message));throw Ht.error(Jt.SEND_MESSAGE_ERROR,m.message||yn.SEND_MESSAGE_ERROR)}catch(g){throw Fe.error(`${Rr.logPrefix}sendChatMessage error:`,g),Ht.error(Jt.SEND_MESSAGE_ERROR,yn.SEND_MESSAGE_ERROR)}}async sendCustomMessage(s,g){this.preCheckMethodCall();try{const m=this.tim.createCustomMessage({to:this.groupId,conversationType:Cr.TYPES.CONV_GROUP,payload:{data:g,description:s,extension:""}}),R=await this.tim.sendMessage(m);if(R.code===0)return Ot.success(Sr(R.data.message));throw Ht.error(Jt.SEND_CUSTOM_MESSAGE_ERROR,R.message||yn.SEND_CUSTOM_MESSAGE_ERROR)}catch(m){throw Fe.error(`${Rr.logPrefix}sendCustomMessage error:`,m),Ht.error(Jt.SEND_CUSTOM_MESSAGE_ERROR,yn.SEND_CUSTOM_MESSAGE_ERROR)}}on(s,g){var m;(m=this.tim)==null||m.on(s,g)}off(s,g){var m;(m=this.tim)==null||m.on(s,g)}onRoomEvent(s,g,m){this.emitter.on(s,g,m)}offRoomEvent(s,g){this.emitter.off(s,g)}async sendMessage(s){return await this.tim.sendMessage(s)}createCustomMessage(s){return this.tim.createCustomMessage(s)}updateMyProfile(s){return this.tim.updateMyProfile(s)}async destroy(){return this.unbindEvent(),this.sdkAppId=0,this.userId="",this.userSig="",this.groupId="",this.isSdkReady=!1,this.isLogin=!1,this.tim=null,this.loginResolveRejectCache.length&&(this.loginResolveRejectCache.forEach(({reject:s})=>{s(Ht.error(Jt.ROOM_BEEN_DESTROYED,yn.ROOM_BEEN_DESTROYED))}),this.loginResolveRejectCache=[]),Ot.success()}};let lT=Rr;we(lT,"logPrefix","[TIMService]");const Dn=class{constructor(s,g){we(this,"groupId","");we(this,"roomId",0);we(this,"state");we(this,"tim");we(this,"emitter");we(this,"tSignalingService");we(this,"isBindTimEvent");we(this,"isBindTSignalingEvent");if(!s||!g)throw Ht.error(Jt.INVALID_PARAM_ERROR,yn.INVALID_PARAM_ERROR);this.state=s,this.tSignalingService=g,this.isBindTimEvent=!1,this.isBindTSignalingEvent=!1,this.emitter=new bT}init(s){const{roomId:g,tim:m}=s;this.roomId=g,this.groupId=`${OS}${g}`,this.tim=m,this.isBindTimEvent&&this.unbindTIMEvent(),this.isBindTSignalingEvent&&this.unbindTSignalingEvent(),this.bindTIMEvent(),this.bindTSignalingEvent(),this.handleInitNotification(this.state.roomInfo.roomConfig)}handleInitNotification(s){var A,D,x;const{isCallingRoll:g,isAllMicMuted:m,isAllCameraMuted:R}=s;g&&((A=this.emitter)==null||A.emit(ze.onCallingRollStarted,s.isCallingRoll)),m&&this.state.currentUser.role!==zr.MASTER&&((D=this.emitter)==null||D.emit(ze.onMicrophoneMuted,{mute:s.isAllMicMuted,muteType:rg.MasterMuteAll})),R&&this.state.currentUser.role!==zr.MASTER&&((x=this.emitter)==null||x.emit(ze.onCameraMuted,{mute:s.isAllCameraMuted,muteType:rg.MasterMuteAll}))}async setControlConfig(s){Fe.debug(`${Dn.logPrefix}setControlConfig params:`,s,this);try{return await this.tim.updateGroupProfile({groupID:this.groupId,notification:JSON.stringify(s)}),Ot.success(s)}catch(g){throw Fe.error(`${Dn.logPrefix}setControlConfig error:`,g),Ht.error(Jt.SET_ROOM_CONTROL_CONFIG_ERROR,yn.SET_ROOM_CONTROL_CONFIG_ERROR)}}async getControlConfig(){Fe.debug(`${Dn.logPrefix}getControlConfig`,this);try{const s=await this.tim.getGroupProfile({groupId:this.groupId,groupCustomFieldFilter:["notification"]});Fe.log(`${Dn.logPrefix}getGroupAttributes`,s);const{group:g}=s.data;if(g.notification)try{const m=sg(g.notification);return Ot.success(m)}catch{Fe.error(`${Dn.logPrefix}getControlConfig parse group notification error:`,g.notification)}return Ot.success(null)}catch{throw Ht.error(Jt.GROUP_NOT_EXIST_ERROR,yn.GROUP_NOT_EXIST_ERROR)}}async muteUserMicrophone(s,g){Fe.debug(`${Dn.logPrefix}muteUserMicrophone userId: ${s} mute: ${g}`,this);try{const m={cmd:Qn.MuteUserMicrophone,room_id:this.roomId,receiver_id:s,mute:g},R=await this.tSignalingService.invite(s,m,Lv.timeout);return R.code===0?Ot.success(R.data):Ot.fail(R.code,"",R.data)}catch{throw Ht.error(Jt.SEND_CUSTOM_MESSAGE_ERROR,yn.SEND_CUSTOM_MESSAGE_ERROR)}}async muteAllUsersMicrophone(s){Fe.debug(`${Dn.logPrefix}muteAllUsersMicrophone mute: ${s}`,this);try{return await this.tim.updateGroupProfile({groupID:this.groupId,notification:JSON.stringify({...this.state.roomInfo.roomConfig,isAllMicMuted:s})}),Ot.success()}catch(g){throw Fe.error(`${Dn.logPrefix}muteAllUsersMicrophone error:`,g),Ht.error(Jt.CHANGE_ALL_MIC_MUTE_ERROR,yn.CHANGE_ALL_MIC_MUTE_ERROR)}}async muteUserCamera(s,g){Fe.debug(`${Dn.logPrefix}muteUserCamera userId: ${s} mute: ${g}`,this);try{const m={cmd:Qn.MuteUserCamera,room_id:this.roomId,receiver_id:s,mute:g},R=await this.tSignalingService.invite(s,m,Lv.timeout);return R.code===0?Ot.success(R.data):Ot.fail(R.code,"",R.data)}catch{throw Ht.error(Jt.SEND_CUSTOM_MESSAGE_ERROR,yn.SEND_CUSTOM_MESSAGE_ERROR)}}async muteAllUsersCamera(s){Fe.debug(`${Dn.logPrefix}muteAllUsersCamera mute: ${s}`,this);try{return await this.tim.updateGroupProfile({groupID:this.groupId,notification:JSON.stringify({...this.state.roomInfo.roomConfig,isAllCameraMuted:s})}),Ot.success()}catch(g){throw Fe.error(`${Dn.logPrefix}muteAllUsersCamera error:`,g),Ht.error(Jt.CHANGE_ALL_CAMERA_MUTE_ERROR,yn.CHANGE_ALL_CAMERA_MUTE_ERROR)}return Ot.success()}async muteChatRoom(s){return Fe.debug(`${Dn.logPrefix}muteChatRoom mute: ${s}`,this),Ot.success()}async muteUserChatRoom(s,g){Fe.debug(`${Dn.logPrefix}muteUserChatRoom userId: ${s} mute: ${g}`,this);try{const m={cmd:Qn.MuteUserChatRoom,room_id:this.roomId,receiver_id:s,mute:g},R=await this.tSignalingService.invite(s,m,Lv.timeout),A=60*60*24;if(R.code===0){const D=g?A:0;return this.tim.setGroupMemberMuteTime({groupID:this.groupId,userID:s,muteTime:D}),Ot.success(R.data)}return Ot.fail(R.code,"",R.data)}catch{throw Ht.error(Jt.SEND_CUSTOM_MESSAGE_ERROR,yn.SEND_CUSTOM_MESSAGE_ERROR)}}async kickOffUser(s){Fe.debug(`${Dn.logPrefix}kickOffUser userId: ${s}`,this);try{const g={cmd:Qn.KickOffUser,room_id:this.roomId,receiver_id:s},m=await this.tSignalingService.invite(s,g,Lv.timeout);return m.code===0?Ot.success(m.data):Ot.fail(m.code,"",m.data)}catch{throw Ht.error(Jt.SEND_CUSTOM_MESSAGE_ERROR,yn.SEND_CUSTOM_MESSAGE_ERROR)}}async startCallingRoll(){if(Fe.debug(`${Dn.logPrefix}startCallingRoll`,this.state.roomInfo.roomConfig),this.state.roomInfo.roomConfig.isCallingRoll)throw Ht.error(Jt.CALLING_ROLL,yn.CALLING_ROLL);try{return await this.setControlConfig({...this.state.roomInfo.roomConfig,isCallingRoll:!0}),Ot.success()}catch(s){throw Fe.error(`${Dn.logPrefix}startCallingRoll error:`,s),Ht.error(Jt.START_CALL_ROLL_ERROR,yn.START_CALL_ROLL_ERROR)}}async stopCallingRoll(){if(Fe.debug(`${Dn.logPrefix}stopCallingRoll`,this.state.roomInfo.roomConfig),!this.state.roomInfo.roomConfig.isCallingRoll)throw Ht.error(Jt.NOT_CALL_ROLL,yn.NOT_CALL_ROLL);try{return await this.setControlConfig({...this.state.roomInfo.roomConfig,isCallingRoll:!1}),Ot.success()}catch(s){throw Fe.error(`${Dn.logPrefix}stopCallingRoll error:`,s),Ht.error(Jt.STOP_CALL_ROLL_ERROR,yn.STOP_CALL_ROLL_ERROR)}}async replyCallingRoll(){var s,g,m;if(Fe.debug(`${Dn.logPrefix}replyCallingRoll`,(s=this.state.roomInfo)==null?void 0:s.roomConfig),!((m=(g=this.state.roomInfo)==null?void 0:g.roomConfig)!=null&&m.isCallingRoll))throw Ht.error(Jt.NOT_CALL_ROLL,yn.NOT_CALL_ROLL);try{const R={cmd:Qn.ReplyCallingRoll,room_id:this.roomId,sender_id:this.state.currentUser.userId},A=await this.tSignalingService.invite(this.state.roomInfo.ownerId,R);return Ot.success(A.data)}catch{throw Ht.error(Jt.SEND_CUSTOM_MESSAGE_ERROR,yn.SEND_CUSTOM_MESSAGE_ERROR)}}async sendSpeechInvitation(s){Fe.debug(`${Dn.logPrefix}sendSpeechInvitation userId: ${s}`,this);try{const g={cmd:Qn.PickSeat,room_id:this.roomId,receiver_id:s},m=await this.tSignalingService.invite(s,g,Lv.timeout);return m.code===0?Ot.success(m.data):Ot.fail(m.code,"",m.data)}catch{throw Ht.error(Jt.SEND_CUSTOM_MESSAGE_ERROR,yn.SEND_CUSTOM_MESSAGE_ERROR)}}async cancelSpeechInvitation(s){Fe.debug(`${Dn.logPrefix}cancelSpeechInvitation userId: ${s}`,this);try{const g={cmd:Qn.PickSeat,room_id:this.roomId,receiver_id:s},m=await this.tSignalingService.cancel(s,g);return Ot.success(m.data)}catch{throw Ht.error(Jt.SEND_CUSTOM_MESSAGE_ERROR,yn.SEND_CUSTOM_MESSAGE_ERROR)}}async replySpeechInvitation(s){Fe.debug(`${Dn.logPrefix}replySpeechInvitation agree: ${s}`,this);try{const g={cmd:Qn.PickSeat,room_id:this.roomId,receiver_id:this.state.currentUser.userId};let m=null;return s?m=await this.tSignalingService.accept(this.state.roomInfo.ownerId,g):m=await this.tSignalingService.reject(this.state.roomInfo.ownerId,g),Ot.success(m.data)}catch{throw Ht.error(Jt.SEND_CUSTOM_MESSAGE_ERROR,yn.SEND_CUSTOM_MESSAGE_ERROR)}}async kickUserOffStage(s){Fe.debug(`${Dn.logPrefix}kickUserOffStage userId: ${s}`,this);try{const g={cmd:Qn.KickSeat,room_id:this.roomId,receiver_id:s},m=await this.tSignalingService.invite(s,g,Lv.timeout);return m.code===0?Ot.success(m.data):Ot.fail(m.code,"",m.data)}catch{throw Ht.error(Jt.SEND_CUSTOM_MESSAGE_ERROR,yn.SEND_CUSTOM_MESSAGE_ERROR)}}async sendSpeechApplication(){Fe.debug(`${Dn.logPrefix}sendSpeechApplication`,this);try{const s={cmd:Qn.TakeSeat,room_id:this.roomId,seat_number:-1},g=await this.tSignalingService.invite(this.state.roomInfo.ownerId,s,Lv.timeout);return g.code===0?Ot.success(g.data):Ot.fail(g.code,"",g.data)}catch(s){throw Fe.debug(`${Dn.logPrefix} sendSpeechApplication error`,s),Ht.error(Jt.SEND_CUSTOM_MESSAGE_ERROR,yn.SEND_CUSTOM_MESSAGE_ERROR)}}async cancelSpeechApplication(){Fe.debug(`${Dn.logPrefix}cancelSpeechApplication`,this);try{const s={cmd:Qn.TakeSeat,room_id:this.roomId,seat_number:-1},g=await this.tSignalingService.cancel(this.state.roomInfo.ownerId,s);return Ot.success(g.data)}catch{throw Ht.error(Jt.SEND_CUSTOM_MESSAGE_ERROR,yn.SEND_CUSTOM_MESSAGE_ERROR)}}async replySpeechApplication(s,g){try{const m={cmd:Qn.TakeSeat,room_id:this.roomId,seat_number:-1};let R=null;return g?R=await this.tSignalingService.accept(s,m):R=await this.tSignalingService.reject(s,m),Ot.success(R.data)}catch{throw Ht.error(Jt.SEND_CUSTOM_MESSAGE_ERROR,yn.SEND_CUSTOM_MESSAGE_ERROR)}}async forbidSpeechApplication(s){return Fe.debug(`${Dn.logPrefix}forbidSpeechApplication forbid: ${s}`,this),Ot.success()}async sendOffSpeaker(s){return Fe.debug(`${Dn.logPrefix}sendOffSpeaker userId: ${s}`,this),Ot.success()}async sendOffAllSpeakers(){return Fe.debug(`${Dn.logPrefix}sendOffAllSpeakers`,this),Ot.success()}async exitSpeechState(){return Fe.debug(`${Dn.logPrefix}exitSpeechState`,this),Ot.success()}bindTIMEvent(){this.isBindTimEvent=!0,this.tim.on(Cr.EVENT.MESSAGE_RECEIVED,this.onMessageReceived,this)}unbindTIMEvent(){this.isBindTimEvent=!1,this.tim.off(Cr.EVENT.MESSAGE_RECEIVED,this.onMessageReceived,this)}onMessageReceived(s){Fe.log(`${Dn.logPrefix}onMessageReceived message:`,s),s.data.forEach(g=>{switch(g.type){case Cr.TYPES.MSG_GRP_TIP:this.handleGroupTip(g);break;default:Fe.warn(`${Dn.logPrefix}onMessageReceived ignored message:`,g)}})}handleGroupTip(s){Fe.log(`${Dn.logPrefix}handleGroupTip message:`,s);const{operationType:g}=s.payload,m=sg(s.payload.newGroupProfile.notification);switch(g){case Cr.TYPES.GRP_TIP_GRP_PROFILE_UPDATED:this.handleGroupNotification(m);break;default:Fe.warn(`${Dn.logPrefix}handleGroupTip ignored notice:`,s)}}handleGroupNotification(s){const g=Sr(s);Fe.log(`${Dn.logPrefix}handleGroupNotification message:`,g),Object.keys(this.state.roomInfo.roomConfig).forEach(m=>{var R,A,D;if(typeof g[m]<"u"&&this.state.roomInfo.roomConfig[m]!==g[m])switch(m){case eb.isCallingRoll:(R=this.emitter)==null||R.emit(g[m]?ze.onCallingRollStarted:ze.onCallingRollStopped,g[m]),this.state.roomInfo.roomConfig[m]=g[m];break;case eb.isAllMicMuted:Fe.warn(`${Dn.logPrefix}.handleGroupProfileUpdate mute all mic`,g[m]),this.state.roomInfo.roomConfig[m]=g[m],this.state.currentUser.role!==zr.MASTER&&((A=this.emitter)==null||A.emit(ze.onMicrophoneMuted,{mute:g[m],muteType:rg.MasterMuteAll}));break;case eb.isAllCameraMuted:Fe.warn(`${Dn.logPrefix}.handleGroupProfileUpdate mute all camera`,g[m]),this.state.roomInfo.roomConfig[m]=g[m],this.state.currentUser.role!==zr.MASTER&&((D=this.emitter)==null||D.emit(ze.onCameraMuted,{mute:g[m],muteType:rg.MasterMuteAll}));break;default:Fe.warn(`${Dn.logPrefix}handleGroupNotification ignored notice:`,`${m}: ${g[m]}`);break}})}bindTSignalingEvent(){this.isBindTSignalingEvent=!0,this.tSignalingService.on(ze.onUserReplyCallingRoll,this.onUserReplyCallingRoll,this),this.tSignalingService.on(ze.onReceiveSpeechInvitation,this.onReceiveSpeechInvitation,this),this.tSignalingService.on(ze.onReceiveInvitationCancelled,this.onReceiveInvitationCancelled,this),this.tSignalingService.on(ze.onReceiveInvitationTimeout,this.onReceiveInvitationTimeout,this),this.tSignalingService.on(ze.onReceiveSpeechApplication,this.onReceiveSpeechApplication,this),this.tSignalingService.on(ze.onSpeechApplicationCancelled,this.onSpeechApplicationCancelled,this),this.tSignalingService.on(ze.onSpeechApplicationTimeout,this.onSpeechApplicationTimeout,this),this.tSignalingService.on(ze.onMicrophoneMuted,this.onMicrophoneMuted,this),this.tSignalingService.on(ze.onCameraMuted,this.onCameraMuted,this),this.tSignalingService.on(ze.onUserChatRoomMuted,this.onUserChatRoomMuted,this),this.tSignalingService.on(ze.onUserKickOff,this.onUserKickOff,this),this.tSignalingService.on(ze.onUserKickOffStage,this.onUserKickOffStage,this)}unbindTSignalingEvent(){this.isBindTSignalingEvent=!1,this.tSignalingService.off(ze.onUserReplyCallingRoll,this.onUserReplyCallingRoll,this),this.tSignalingService.off(ze.onReceiveSpeechInvitation,this.onReceiveSpeechInvitation,this),this.tSignalingService.off(ze.onReceiveInvitationCancelled,this.onReceiveInvitationCancelled,this),this.tSignalingService.off(ze.onReceiveInvitationTimeout,this.onReceiveInvitationTimeout,this),this.tSignalingService.off(ze.onReceiveSpeechApplication,this.onReceiveSpeechApplication,this),this.tSignalingService.off(ze.onSpeechApplicationCancelled,this.onSpeechApplicationCancelled,this),this.tSignalingService.off(ze.onSpeechApplicationTimeout,this.onSpeechApplicationTimeout,this),this.tSignalingService.off(ze.onMicrophoneMuted,this.onMicrophoneMuted,this),this.tSignalingService.off(ze.onCameraMuted,this.onCameraMuted,this),this.tSignalingService.off(ze.onUserChatRoomMuted,this.onUserChatRoomMuted,this),this.tSignalingService.off(ze.onUserKickOff,this.onUserKickOff,this),this.tSignalingService.off(ze.onUserKickOffStage,this.onUserKickOffStage,this)}async onUserReplyCallingRoll(s){var D;const{eventCode:g,data:{inviterId:m,type:R}}=s;Fe.log(`${Dn.logPrefix}onUserReplyCallingRoll event:`,g,m,R);const A={cmd:Qn.ReplyCallingRoll,room_id:this.roomId,sender_id:this.state.currentUser.userId};await this.tSignalingService.accept(m,A),(D=this.emitter)==null||D.emit(ze.onUserReplyCallingRoll,{inviterId:m})}async onReceiveSpeechInvitation(s){var R;const{inviterId:g,type:m}=s;Fe.log(`${Dn.logPrefix}onReceiveSpeechInvitation event:`,g,m),(R=this.emitter)==null||R.emit(ze.onReceiveSpeechInvitation,g)}async onReceiveInvitationCancelled(s){var R;const{inviterId:g,type:m}=s;Fe.log(`${Dn.logPrefix}onReceiveInvitationCancelled event:`,g,m),(R=this.emitter)==null||R.emit(ze.onReceiveInvitationCancelled,g)}async onReceiveInvitationTimeout(s){var A;const{eventCode:g,data:{inviterId:m,type:R}}=s;Fe.log(`${Dn.logPrefix}onReceiveInvitationTimeout event:`,g,m,R),(A=this.emitter)==null||A.emit(ze.onReceiveInvitationTimeout,m)}async onReceiveSpeechApplication(s){var R;const{inviterId:g,type:m}=s;Fe.log(`${Dn.logPrefix}onReceiveSpeechApplication event:`,m,g),(R=this.emitter)==null||R.emit(ze.onReceiveSpeechApplication,{userId:s.inviterId})}async onSpeechApplicationCancelled(s){var R;const{inviterId:g,type:m}=s;Fe.log(`${Dn.logPrefix}onSpeechApplicationCancelled event:`,m,g),(R=this.emitter)==null||R.emit(ze.onSpeechApplicationCancelled,{userId:s.inviterId})}async onSpeechApplicationTimeout(s){var A;const{eventCode:g,data:{inviterId:m,type:R}}=s;Fe.log(`${Dn.logPrefix}onSpeechApplicationTimeout event:`,g,m,R),(A=this.emitter)==null||A.emit(ze.onSpeechApplicationTimeout,m)}async onMicrophoneMuted(s){var A;Fe.log(`${Dn.logPrefix}onMicrophoneMuted data:`,s);const{mute:g,inviterId:m}=s,R={cmd:Qn.MuteUserMicrophone,room_id:this.roomId,receiver_id:this.state.currentUser.userId,mute:g};(A=this.emitter)==null||A.emit(ze.onMicrophoneMuted,{mute:g,muteType:rg.MasterMuteCurrentUser}),await this.tSignalingService.accept(m,R)}async onCameraMuted(s){var A;Fe.log(`${Dn.logPrefix}onCameraMuted data:`,s);const{mute:g,inviterId:m}=s,R={cmd:Qn.MuteUserCamera,room_id:this.roomId,receiver_id:this.state.currentUser.userId,mute:g};(A=this.emitter)==null||A.emit(ze.onCameraMuted,{mute:g,muteType:rg.MasterMuteCurrentUser}),await this.tSignalingService.accept(m,R)}async onUserChatRoomMuted(s){var A;Fe.log(`${Dn.logPrefix}onUserChatRoomMuted data:`,s);const{mute:g,inviterId:m}=s,R={cmd:Qn.MuteUserChatRoom,room_id:this.roomId,receiver_id:this.state.currentUser.userId,mute:g};(A=this.emitter)==null||A.emit(ze.onUserChatRoomMuted,{mute:g,muteType:rg.MasterMuteCurrentUser}),await this.tSignalingService.accept(m,R)}async onUserKickOff(s){var R;Fe.log(`${Dn.logPrefix}onUserKickOff data:`,s);const{inviterId:g}=s,m={cmd:Qn.KickOffUser,room_id:this.roomId,receiver_id:this.state.currentUser.userId};(R=this.emitter)==null||R.emit(ze.onUserKickOff,{}),await this.tSignalingService.accept(g,m)}async onUserKickOffStage(s){var R;Fe.log(`${Dn.logPrefix}onUserKickOffStage data:`,s);const{inviterId:g}=s,m={cmd:Qn.KickSeat,room_id:this.roomId,receiver_id:g};(R=this.emitter)==null||R.emit(ze.onUserKickOffStage,{}),await this.tSignalingService.accept(g,m)}on(s,g,m){var R;(R=this.emitter)==null||R.on(s,g,m)}off(s,g){var m;(m=this.emitter)==null||m.off(s,g)}destroy(){this.groupId="",this.roomId=0,this.state=null,this.tim=null,this.emitter=null,this.tSignalingService=null,this.unbindTSignalingEvent(),this.unbindTIMEvent()}};let ob=Dn;we(ob,"logPrefix","[TUIRoomCoordinator]");class a8{constructor(){we(this,"currentUser");we(this,"userMap");we(this,"roomInfo");this.init()}init(){this.currentUser=new xv,this.userMap=new Map,this.roomInfo=new A5}reset(){this.init()}}const nc=class{constructor(s,g,m){we(this,"state");we(this,"timService");we(this,"trtcService");if(!s||!g||!m)throw Ht.error(Jt.INVALID_PARAM_ERROR,yn.INVALID_PARAM_ERROR);this.state=s,this.timService=g,this.trtcService=m}async createRoom(s){Fe.debug(`${nc.logPrefix}createRoom options:`,s);const{sdkAppId:g,userId:m,userSig:R,roomId:A,mode:D}=s,x=`${A}`;let $=null;try{if(this.state.roomInfo.roomConfig.startTime=new Date().getTime(),this.state.roomInfo.roomConfig.speechMode=D,$=(await this.timService.checkGroupExistence(x)).data,$)if($.ownerID===m){if(Fe.log(`${lT.logPrefix}createGroup: group exist and current user is owner.`,$),this.timService.setGroupId(x),$=(await this.timService.getGroupProfile(x)).data,$.notification)try{this.state.roomInfo.roomConfig=Object.assign(this.state.roomInfo.roomConfig,sg($.notification))}catch{Fe.error(`${nc.logPrefix}createRoom parse group notification error:`,$.notification)}}else throw Ht.error(Jt.ROOM_EXISTED,yn.ROOM_EXISTED);else{const re=await this.timService.createGroup(A,this.state.roomInfo.roomConfig),{data:ie}=re;Fe.debug(`${nc.logPrefix}createRoom createGroup response:`,ie)}const te=D===iu.APPLY_SPEECH?DS.TRTCAppSceneLIVE:DS.TRTCAppSceneVideoCall;return await this.trtcService.enterRoom({sdkAppId:g,userId:m,userSig:R,roomId:A,role:tb.TRTCRoleAnchor},te),this.state.roomInfo.roomId=A,this.state.roomInfo.ownerId=m,this.state.currentUser.role=zr.MASTER,Ot.success(Sr({room:this.state.roomInfo,user:this.state.currentUser}))}catch(B){throw B instanceof Ht?B:(Fe.error(`${nc.logPrefix}createRoom error:`,B),Ht.error(Jt.CREATE_ROOM_ERROR,yn.CREATE_ROOM_ERROR))}}async enterRoom(s){Fe.debug(`${nc.logPrefix}enterRoom options:`,s);const{sdkAppId:g,userId:m,userSig:R,roomId:A}=s;try{await this.timService.joinGroup(A);const D=await this.timService.getGroupProfile(A),{data:x}=D;if(Fe.debug(`${nc.logPrefix}enterRoom joinGroup:`,x),x.notification)try{this.state.roomInfo.roomConfig=Object.assign(this.state.roomInfo.roomConfig,sg(x.notification))}catch{Fe.error(`${nc.logPrefix}enterRoom parse group notification error:`,x.notification)}const $=this.state.roomInfo.roomConfig.speechMode===iu.FREE_SPEECH?DS.TRTCAppSceneVideoCall:DS.TRTCAppSceneLIVE,B=$===DS.TRTCAppSceneVideoCall?tb.TRTCRoleAnchor:tb.TRTCRoleAudience;return await this.trtcService.enterRoom({sdkAppId:g,userId:m,userSig:R,roomId:A,role:B},$),this.state.roomInfo.roomId=A,this.state.roomInfo.ownerId=x.ownerID,this.state.currentUser.userId===this.state.roomInfo.ownerId?this.state.currentUser.role=zr.MASTER:this.state.currentUser.role=zr.ANCHOR,Ot.success(Sr({room:this.state.roomInfo,user:this.state.currentUser}))}catch(D){throw D instanceof Ht?D:(Fe.error(`${nc.logPrefix}enterRoom error:`,D),Ht.error(Jt.ENTER_ROOM_ERROR,yn.ENTER_ROOM_ERROR))}}async exitRoom(){Fe.debug(`${nc.logPrefix}exitRoom`);try{await this.trtcService.exitRoom(),await this.timService.quitGroup();const s=Sr({room:this.state.roomInfo,user:this.state.currentUser});return this.state.reset(),Ot.success(s)}catch(s){throw s instanceof Ht?s:(Fe.error(`${nc.logPrefix}exitRoom error:`,s),Ht.error(Jt.EXIT_ROOM_ERROR,yn.EXIT_ROOM_ERROR))}}async destroyRoom(){if(Fe.debug(`${Ot}destroyRoom`,this.state.currentUser),this.state.currentUser.role!==zr.MANAGER&&this.state.currentUser.role!==zr.MASTER)throw Ht.error(Jt.NO_PRIVILEGE,yn.NO_PRIVILEGE);try{await this.trtcService.exitRoom(),await this.timService.dismissGroup();const s=Sr({room:this.state.roomInfo,user:this.state.currentUser});return this.state.reset(),Ot.success(s)}catch(s){throw s instanceof Ht?s:(Fe.error(`${nc.logPrefix}destroyRoom error:`,s),Ht.error(Jt.DESTROY_ROOM_ERROR,yn.DESTROY_ROOM_ERROR))}}destroy(){this.state=null,this.timService=null,this.trtcService=null}};let ab=nc;we(ab,"logPrefix","[TUIRoomLifecycle]");const US=class{constructor(s,g,m){we(this,"state");we(this,"tSignalingService");we(this,"trtcService");if(!s||!g||!m)throw Ht.error(Jt.INVALID_PARAM_ERROR,yn.INVALID_PARAM_ERROR);this.state=s,this.tSignalingService=g,this.trtcService=m}async init(s,g){Fe.debug(`${US.logPrefix}.init userID: ${s} userSig: ${g}`),this.state.currentUser.userId=s,this.state.currentUser.isLocal=!0,this.state.userMap.set(s,this.state.currentUser)}async login(s,g){Fe.debug(`${US.logPrefix}.login userID: ${s} userSig: ${g}`);const m=await this.tSignalingService.login(s,g);return Fe.debug(`${US.logPrefix}login result:`,m),m}async logout(){return Fe.debug(`${US.logPrefix}logout`),await this.trtcService.exitRoom(),await this.tSignalingService.logout(),Ot.success()}destroy(){this.state=null,this.tSignalingService=null,this.trtcService=null}};let sb=US;we(sb,"logPrefix","[TUIRoomAuth]");var kL={exports:{}};(function(i,s){(function(g,m){i.exports=m(s1.exports)})(window,function(g){return function(m){var R={};function A(D){if(R[D])return R[D].exports;var x=R[D]={i:D,l:!1,exports:{}};return m[D].call(x.exports,x,x.exports,A),x.l=!0,x.exports}return A.m=m,A.c=R,A.d=function(D,x,$){A.o(D,x)||Object.defineProperty(D,x,{enumerable:!0,get:$})},A.r=function(D){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(D,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(D,"__esModule",{value:!0})},A.t=function(D,x){if(1&x&&(D=A(D)),8&x||4&x&&typeof D=="object"&&D&&D.__esModule)return D;var $=Object.create(null);if(A.r($),Object.defineProperty($,"default",{enumerable:!0,value:D}),2&x&&typeof D!="string")for(var B in D)A.d($,B,function(te){return D[te]}.bind(null,B));return $},A.n=function(D){var x=D&&D.__esModule?function(){return D.default}:function(){return D};return A.d(x,"a",x),x},A.o=function(D,x){return Object.prototype.hasOwnProperty.call(D,x)},A.p="",A(A.s=5)}([function(m,R,A){A.d(R,"e",function(){return W}),A.d(R,"g",function(){return Y}),A.d(R,"c",function(){return se}),A.d(R,"f",function(){return Ae}),A.d(R,"b",function(){return Xe}),A.d(R,"d",function(){return Ue}),A.d(R,"a",function(){return de}),A.d(R,"h",function(){return Se});const D=typeof window<"u",x=(typeof wx<"u"&&wx.getSystemInfoSync,D&&window.navigator&&window.navigator.userAgent||""),$=/AppleWebKit\/([\d.]+)/i.exec(x),B=($&&parseFloat($.pop()),/iPad/i.test(x));/iPhone/i.test(x),/iPod/i.test(x);const te=(function(){const Ee=x.match(/OS (\d+)_/i);Ee&&Ee[1]&&Ee[1]}(),/Android/i.test(x));(function(){const Ee=x.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!Ee)return null;const ke=Ee[1]&&parseFloat(Ee[1]),De=Ee[2]&&parseFloat(Ee[2]);return ke&&De?parseFloat(Ee[1]+"."+Ee[2]):ke||null})(),!(te&&/webkit/i.test(x),/Firefox/i.test(x),/Edge/i.test(x))&&/Chrome/i.test(x);const ie=(function(){const Ee=x.match(/Chrome\/(\d+)/);Ee&&Ee[1]&&parseFloat(Ee[1])}(),/MSIE/.test(x),/MSIE\s8\.0/.test(x),function(){const Ee=/MSIE\s(\d+)\.\d/.exec(x);let ke=Ee&&parseFloat(Ee[1]);!ke&&/Trident\/7.0/i.test(x)&&/rv:11.0/.test(x)&&(ke=11)}(),/Safari/i.test(x),/TBS\/\d+/i.test(x));(function(){const Ee=x.match(/TBS\/(\d+)/i);Ee&&Ee[1]&&Ee[1]})(),!ie&&/MQQBrowser\/\d+/i.test(x),!ie&&/ QQBrowser\/\d+/i.test(x),/(micromessenger|webbrowser)/i.test(x),/Windows/i.test(x),/MAC OS X/i.test(x),/MicroMessenger/i.test(x),A(2),A(1);const W=function(Ee){return Be(Ee)==="map"},Y=function(Ee){return Be(Ee)==="set"},se=function(Ee){return Be(Ee)==="file"},Ae=function(Ee){if(typeof Ee!="object"||Ee===null)return!1;const ke=Object.getPrototypeOf(Ee);if(ke===null)return!0;let De=ke;for(;Object.getPrototypeOf(De)!==null;)De=Object.getPrototypeOf(De);return ke===De},Je=function(Ee){return typeof Array.isArray=="function"?Array.isArray(Ee):Be(Ee)==="array"},Xe=function(Ee){return Je(Ee)||function(ke){return ke!==null&&typeof ke=="object"}(Ee)},Ue=function(Ee){return Ee instanceof Error},Be=function(Ee){return Object.prototype.toString.call(Ee).match(/^\[object (.*)\]$/)[1].toLowerCase()};let Pe=0;Date.now||(Date.now=function(){return new Date().getTime()});const de={now:function(){Pe===0&&(Pe=Date.now()-1);const Ee=Date.now()-Pe;return Ee>4294967295?(Pe+=4294967295,Date.now()-Pe):Ee},utc:function(){return Math.round(Date.now()/1e3)}},Se=function(Ee){return JSON.stringify(Ee,["message","code"])}},function(m,R,A){A.r(R);var D=A(3),x=A(0);let $=0;const B=new Map;function te(){const ie=new Date;return"TSignaling "+ie.toLocaleTimeString("en-US",{hour12:!1})+"."+function(W){let Y;switch(W.toString().length){case 1:Y="00"+W;break;case 2:Y="0"+W;break;default:Y=W}return Y}(ie.getMilliseconds())+":"}const re={_data:[],_length:0,_visible:!1,arguments2String(ie){let W;if(ie.length===1)W=te()+ie[0];else{W=te();for(let Y=0,se=ie.length;Y<se;Y++)Object(x.b)(ie[Y])?Object(x.d)(ie[Y])?W+=Object(x.h)(ie[Y]):W+=JSON.stringify(ie[Y]):W+=ie[Y],W+=" "}return W},debug:function(){if($<=-1){const ie=this.arguments2String(arguments);re.record(ie,"debug"),D.a.debug(ie)}},log:function(){if($<=0){const ie=this.arguments2String(arguments);re.record(ie,"log"),D.a.log(ie)}},info:function(){if($<=1){const ie=this.arguments2String(arguments);re.record(ie,"info"),D.a.info(ie)}},warn:function(){if($<=2){const ie=this.arguments2String(arguments);re.record(ie,"warn"),D.a.warn(ie)}},error:function(){if($<=3){const ie=this.arguments2String(arguments);re.record(ie,"error"),D.a.error(ie)}},time:function(ie){B.set(ie,x.a.now())},timeEnd:function(ie){if(B.has(ie)){const W=x.a.now()-B.get(ie);return B.delete(ie),W}return D.a.warn(`\u672A\u627E\u5230\u5BF9\u5E94label: ${ie}, \u8BF7\u5728\u8C03\u7528 logger.timeEnd \u524D\uFF0C\u8C03\u7528 logger.time`),0},setLevel:function(ie){ie<4&&D.a.log(te()+"set level from "+$+" to "+ie),$=ie},record:function(ie,W){re._length===1100&&(re._data.splice(0,100),re._length=1e3),re._length++,re._data.push(`${ie} [${W}] 
`)},getLog:function(){return re._data}};R.default=re},function(m,R,A){A.r(R),R.default={MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected",ENTER_ROOM_SUCCESS:"JoinedSuccess",ALREADY_IN_ROOM:"AlreadyInGroup"}},function(m,R,A){(function(D){let x,$;x=typeof console<"u"?console:D!==void 0&&D.console?D.console:typeof window<"u"&&window.console?window.console:{};const B=function(){},te=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];let re=te.length;for(;re--;)$=te[re],console[$]||(x[$]=B);x.methods=te,R.a=x}).call(this,A(8))},function(m,R,A){Object.defineProperty(R,"__esModule",{value:!0}),R.default={NEW_INVITATION_RECEIVED:"ts_new_invitation_received",INVITEE_ACCEPTED:"ts_invitee_accepted",INVITEE_REJECTED:"ts_invitee_rejected",INVITATION_CANCELLED:"ts_invitation_cancelled",INVITATION_TIMEOUT:"ts_invitation_timeout",SDK_READY:"ts_im_ready",SDK_NOT_READY:"ts_im_not_ready",TEXT_MESSAGE_RECEIVED:"ts_text_message_received",CUSTOM_MESSAGE_RECEIVED:"ts_custom_message_received",REMOTE_USER_JOIN:"ts_remote_user_join",REMOTE_USER_LEAVE:"ts_remote_user_leave",KICKED_OUT:"ts_kicked_out",NET_STATE_CHANGE:"ts_net_state_change"}},function(m,R,A){var D=this&&this.__awaiter||function(Pe,de,Se,Ee){return new(Se||(Se=Promise))(function(ke,De){function Qe(it){try{ft(Ee.next(it))}catch(ut){De(ut)}}function vt(it){try{ft(Ee.throw(it))}catch(ut){De(ut)}}function ft(it){var ut;it.done?ke(it.value):(ut=it.value,ut instanceof Se?ut:new Se(function(ee){ee(ut)})).then(Qe,vt)}ft((Ee=Ee.apply(Pe,de||[])).next())})},x=this&&this.__generator||function(Pe,de){var Se,Ee,ke,De,Qe={label:0,sent:function(){if(1&ke[0])throw ke[1];return ke[1]},trys:[],ops:[]};return De={next:vt(0),throw:vt(1),return:vt(2)},typeof Symbol=="function"&&(De[Symbol.iterator]=function(){return this}),De;function vt(ft){return function(it){return function(ut){if(Se)throw new TypeError("Generator is already executing.");for(;Qe;)try{if(Se=1,Ee&&(ke=2&ut[0]?Ee.return:ut[0]?Ee.throw||((ke=Ee.return)&&ke.call(Ee),0):Ee.next)&&!(ke=ke.call(Ee,ut[1])).done)return ke;switch(Ee=0,ke&&(ut=[2&ut[0],ke.value]),ut[0]){case 0:case 1:ke=ut;break;case 4:return Qe.label++,{value:ut[1],done:!1};case 5:Qe.label++,Ee=ut[1],ut=[0];continue;case 7:ut=Qe.ops.pop(),Qe.trys.pop();continue;default:if(ke=Qe.trys,!((ke=ke.length>0&&ke[ke.length-1])||ut[0]!==6&&ut[0]!==2)){Qe=0;continue}if(ut[0]===3&&(!ke||ut[1]>ke[0]&&ut[1]<ke[3])){Qe.label=ut[1];break}if(ut[0]===6&&Qe.label<ke[1]){Qe.label=ke[1],ke=ut;break}if(ke&&Qe.label<ke[2]){Qe.label=ke[2],Qe.ops.push(ut);break}ke[2]&&Qe.ops.pop(),Qe.trys.pop();continue}ut=de.call(Pe,Qe)}catch(ee){ut=[6,ee],Ee=0}finally{Se=ke=0}if(5&ut[0])throw ut[1];return{value:ut[0]?ut[1]:void 0,done:!0}}([ft,it])}}},$=this&&this.__spreadArrays||function(){for(var Pe=0,de=0,Se=arguments.length;de<Se;de++)Pe+=arguments[de].length;var Ee=Array(Pe),ke=0;for(de=0;de<Se;de++)for(var De=arguments[de],Qe=0,vt=De.length;Qe<vt;Qe++,ke++)Ee[ke]=De[Qe];return Ee};Object.defineProperty(R,"__esModule",{value:!0});var B=A(6),te=A(7),re=A(4),ie=A(2),W=A(1),Y=A(9),se=A(10),Ae=A(11),Je=A(12),Xe=A(14),Ue=A(15).version,Be=function(){function Pe(de){if(this._outerEmitter=null,this._safetyCallbackFactory=null,this._tim=null,this._imSDKAppID=0,this._userID=null,this._groupID="",this._isHandling=!1,this._inviteInfoMap=new Map,W.default.info("TSignaling version:"+Ue),Y.default(de.SDKAppID))return W.default.error("TSignaling \u8BF7\u4F20\u5165 SDKAppID !!!"),null;this._outerEmitter=new te.default,this._outerEmitter._emit=this._outerEmitter.emit,this._outerEmitter.emit=function(){for(var Se=[],Ee=0;Ee<arguments.length;Ee++)Se[Ee]=arguments[Ee];var ke=Se[0],De=[ke,{name:Se[0],data:Se[1]}];this._outerEmitter._emit.apply(this._outerEmitter,$(De))}.bind(this),this._safetyCallbackFactory=new Ae.default,de.tim?this._tim=de.tim:this._tim=Xe.create({SDKAppID:de.SDKAppID,scene:"TSignaling"}),this._imSDKAppID=de.SDKAppID,this._tim.on(Xe.EVENT.SDK_READY,this._onIMReady.bind(this)),this._tim.on(Xe.EVENT.SDK_NOT_READY,this._onIMNotReady.bind(this)),this._tim.on(Xe.EVENT.KICKED_OUT,this._onKickedOut.bind(this)),this._tim.on(Xe.EVENT.NET_STATE_CHANGE,this._onNetStateChange.bind(this)),this._tim.on(Xe.EVENT.MESSAGE_RECEIVED,this._onMessageReceived.bind(this))}return Pe.prototype.setLogLevel=function(de){W.default.setLevel(de),this._tim.setLogLevel(de)},Pe.prototype.login=function(de){return D(this,void 0,void 0,function(){return x(this,function(Se){return W.default.log("TSignaling.login",de),this._userID=de.userID,[2,this._tim.login(de)]})})},Pe.prototype.logout=function(){return D(this,void 0,void 0,function(){return x(this,function(de){return W.default.log("TSignaling.logout"),this._userID="",this._inviteInfoMap.clear(),[2,this._tim.logout()]})})},Pe.prototype.on=function(de,Se,Ee){W.default.log("TSignaling.on eventName:"+de),this._outerEmitter.on(de,this._safetyCallbackFactory.defense(de,Se,Ee),Ee)},Pe.prototype.off=function(de,Se){W.default.log("TSignaling.off eventName:"+de);var Ee=this._safetyCallbackFactory.find(de,Se);Ee!==null&&(this._outerEmitter.off(de,Ee),this._safetyCallbackFactory.delete(de,Se))},Pe.prototype.joinGroup=function(de){return D(this,void 0,void 0,function(){return x(this,function(Se){return W.default.log("TSignaling.joinGroup groupID:"+de),this._groupID=de,[2,this._tim.joinGroup({groupID:de})]})})},Pe.prototype.quitGroup=function(de){return D(this,void 0,void 0,function(){return x(this,function(Se){return W.default.log("TSignaling.quitGroup groupID:"+de),[2,this._tim.quitGroup(de)]})})},Pe.prototype.sendTextMessage=function(de){return D(this,void 0,void 0,function(){var Se;return x(this,function(Ee){return Se=this._tim.createTextMessage({to:de.to,conversationType:de.groupFlag===!0?Xe.TYPES.CONV_GROUP:Xe.TYPES.CONV_C2C,priority:de.priority||Xe.TYPES.MSG_PRIORITY_NORMAL,payload:{text:de.text}}),[2,this._tim.sendMessage(Se)]})})},Pe.prototype.sendCustomMessage=function(de){return D(this,void 0,void 0,function(){var Se;return x(this,function(Ee){return Se=this._tim.createCustomMessage({to:de.to,conversationType:de.groupFlag===!0?Xe.TYPES.CONV_GROUP:Xe.TYPES.CONV_C2C,priority:de.priority||Xe.TYPES.MSG_PRIORITY_NORMAL,payload:{data:de.data||"",description:de.description||"",extension:de.extension||""}}),[2,this._tim.sendMessage(Se)]})})},Pe.prototype.invite=function(de){return D(this,void 0,void 0,function(){var Se,Ee,ke,De,Qe,vt,ft;return x(this,function(it){switch(it.label){case 0:return Se=Je.generate(),W.default.log("TSignaling.invite",de,"inviteID="+Se),Y.default(de)||Y.default(de.userID)?[2,Promise.reject(new se.default({code:B.ErrorCode.ERR_INVALID_PARAMETERS,message:"userID is invalid"}))]:(Ee=de.userID,ke=de.data,De=de.timeout,Qe=de.offlinePushInfo,vt={businessID:B.BusinessID.SIGNAL,inviteID:Se,inviter:this._userID,actionType:B.ActionType.INVITE,inviteeList:[Ee],data:ke,timeout:Y.default(De)?0:De,groupID:""},[4,this._sendCustomMessage(Ee,vt,Qe)]);case 1:return(ft=it.sent()).code===0?(W.default.log("TSignaling.invite ok"),this._inviteInfoMap.set(Se,vt),this._startTimer(vt,!0),[2,{inviteID:Se,code:ft.code,data:ft.data}]):[2,ft]}})})},Pe.prototype.inviteInGroup=function(de){return D(this,void 0,void 0,function(){var Se,Ee,ke,De,Qe,vt,ft,it;return x(this,function(ut){switch(ut.label){case 0:return Se=Je.generate(),W.default.log("TSignaling.inviteInGroup",de,"inviteID="+Se),Y.default(de)||Y.default(de.groupID)?[2,Promise.reject(new se.default({code:B.ErrorCode.ERR_INVALID_PARAMETERS,message:"groupID is invalid"}))]:(Ee=de.groupID,ke=de.inviteeList,De=de.data,Qe=de.timeout,vt=de.offlinePushInfo,ft={businessID:B.BusinessID.SIGNAL,inviteID:Se,inviter:this._userID,actionType:B.ActionType.INVITE,inviteeList:ke,data:De,timeout:Y.default(Qe)?0:Qe,groupID:Ee},[4,this._sendCustomMessage(Ee,ft,vt)]);case 1:return(it=ut.sent()).code===0?(W.default.log("TSignaling.inviteInGroup ok"),this._inviteInfoMap.set(Se,ft),this._startTimer(ft,!0),[2,{inviteID:Se,code:it.code,data:it.data}]):[2,it]}})})},Pe.prototype.cancel=function(de){return D(this,void 0,void 0,function(){var Se,Ee,ke,De,Qe,vt,ft,it,ut;return x(this,function(ee){switch(ee.label){case 0:return W.default.log("TSignaling.cancel",de),Y.default(de)||Y.default(de.inviteID)||!this._inviteInfoMap.has(de.inviteID)||this._isHandling?[2,Promise.reject(new se.default({code:B.ErrorCode.ERR_SDK_SIGNALING_INVALID_INVITE_ID,message:"inviteID is invalid or invitation has been processed"}))]:(this._isHandling=!0,Se=de.inviteID,Ee=de.data,ke=this._inviteInfoMap.get(Se),De=ke.inviter,Qe=ke.groupID,vt=ke.inviteeList,De!==this._userID?[3,2]:(ft={businessID:B.BusinessID.SIGNAL,inviteID:Se,inviter:De,actionType:B.ActionType.CANCEL_INVITE,inviteeList:vt,data:Ee,timeout:0,groupID:Qe},it=Qe||vt[0],[4,this._sendCustomMessage(it,ft)]));case 1:return ut=ee.sent(),this._isHandling=!1,ut&&ut.code===0?(W.default.log("TSignaling.cancel ok"),this._deleteInviteInfoByID(Se),[2,{inviteID:Se,code:ut.code,data:ut.data}]):[2,ut];case 2:return W.default.error("TSignaling.cancel unmatched inviter="+De+" and userID="+this._userID),this._isHandling=!1,[2,Promise.reject(new se.default({code:B.ErrorCode.ERR_SDK_SIGNALING_NO_PERMISSION,message:"\u4FE1\u4EE4\u8BF7\u6C42\u65E0\u6743\u9650\uFF0C\u6BD4\u5982\u53D6\u6D88\u975E\u81EA\u5DF1\u53D1\u8D77\u7684\u9080\u8BF7\uFF0C\u63A5\u53D7\u6216\u5219\u62D2\u7EDD\u975E\u53D1\u7ED9\u81EA\u5DF1\u7684\u9080\u8BF7"}))]}})})},Pe.prototype.accept=function(de){return D(this,void 0,void 0,function(){var Se,Ee,ke,De,Qe,vt,ft,it;return x(this,function(ut){switch(ut.label){case 0:return W.default.log("TSignaling.accept",de),Y.default(de)||Y.default(de.inviteID)||!this._inviteInfoMap.has(de.inviteID)||this._isHandling?[2,Promise.reject(new se.default({code:B.ErrorCode.ERR_SDK_SIGNALING_INVALID_INVITE_ID,message:"inviteID is invalid or invitation has been processed"}))]:(this._isHandling=!0,Se=de.inviteID,Ee=de.data,ke=this._inviteInfoMap.get(Se),De=ke.inviter,Qe=ke.groupID,ke.inviteeList.includes(this._userID)?(vt={businessID:B.BusinessID.SIGNAL,inviteID:Se,inviter:De,actionType:B.ActionType.ACCEPT_INVITE,inviteeList:[this._userID],data:Ee,timeout:0,groupID:Qe},ft=Qe||De,[4,this._sendCustomMessage(ft,vt)]):[3,2]);case 1:return it=ut.sent(),this._isHandling=!1,it&&it.code===0?(W.default.log("TSignaling.accept ok"),this._updateLocalInviteInfo(vt),[2,{inviteID:Se,code:it.code,data:it.data}]):[2,it];case 2:return W.default.error("TSignaling.accept inviteeList do not include userID="+this._userID+". inviteID="+Se+" groupID="+Qe),this._isHandling=!1,[2,Promise.reject(new se.default({code:B.ErrorCode.ERR_SDK_SIGNALING_INVALID_INVITE_ID,message:"inviteID is invalid or invitation has been processed"}))]}})})},Pe.prototype.reject=function(de){return D(this,void 0,void 0,function(){var Se,Ee,ke,De,Qe,vt,ft,it;return x(this,function(ut){switch(ut.label){case 0:return W.default.log("TSignaling.reject",de),Y.default(de)||Y.default(de.inviteID)||!this._inviteInfoMap.has(de.inviteID)||this._isHandling?[2,Promise.reject(new se.default({code:B.ErrorCode.ERR_SDK_SIGNALING_INVALID_INVITE_ID,message:"inviteID is invalid or invitation has been processed"}))]:(this._isHandling=!0,Se=de.inviteID,Ee=de.data,ke=this._inviteInfoMap.get(Se),De=ke.inviter,Qe=ke.groupID,ke.inviteeList.includes(this._userID)?(vt={businessID:B.BusinessID.SIGNAL,inviteID:Se,inviter:De,actionType:B.ActionType.REJECT_INVITE,inviteeList:[this._userID],data:Ee,timeout:0,groupID:Qe},ft=Qe||De,[4,this._sendCustomMessage(ft,vt)]):[3,2]);case 1:return it=ut.sent(),this._isHandling=!1,it&&it.code===0?(W.default.log("TSignaling.reject ok"),this._updateLocalInviteInfo(vt),[2,{inviteID:Se,code:it.code,data:it.data}]):[2,it];case 2:return W.default.error("TSignaling.reject inviteeList do not include userID="+this._userID+". inviteID="+Se+" groupID="+Qe),this._isHandling=!1,[2,Promise.reject(new se.default({code:B.ErrorCode.ERR_SDK_SIGNALING_INVALID_INVITE_ID,message:"inviteID is invalid or invitation has been processed"}))]}})})},Pe.prototype._onIMReady=function(de){W.default.log("TSignaling._onIMReady"),this._outerEmitter.emit(re.default.SDK_READY)},Pe.prototype._onIMNotReady=function(de){W.default.log("TSignaling.onSdkNotReady"),this._outerEmitter.emit(re.default.SDK_NOT_READY)},Pe.prototype._onKickedOut=function(de){W.default.log("TSignaling._onKickedOut"),this._outerEmitter.emit(re.default.KICKED_OUT,de.data)},Pe.prototype._onNetStateChange=function(de){W.default.log("TSignaling._onNetStateChange"),this._outerEmitter.emit(re.default.NET_STATE_CHANGE,de.data)},Pe.prototype._onMessageReceived=function(de){var Se=this;W.default.log("TSignaling._onMessageReceived inviteID="+JSON.stringify(de));var Ee=de.data,ke=Ee.filter(function(it){return it.type===Xe.TYPES.MSG_TEXT});W.default.log("TSignaling._onMessageReceived textMessages"+JSON.stringify(ke)),Y.default(ke)||this._outerEmitter.emit(re.default.TEXT_MESSAGE_RECEIVED,ke);var De=Ee.filter(function(it){return it.type===Xe.TYPES.MSG_GRP_TIP&&it.payload.operationType===Xe.TYPES.GRP_TIP_MBR_JOIN});Y.default(De)||this._outerEmitter.emit(re.default.REMOTE_USER_JOIN,De);var Qe=Ee.filter(function(it){return it.type===Xe.TYPES.MSG_GRP_TIP&&it.payload.operationType===Xe.TYPES.GRP_TIP_MBR_QUIT});Y.default(Qe)||this._outerEmitter.emit(re.default.REMOTE_USER_LEAVE,Qe);var vt=Ee.filter(function(it){return it.type===Xe.TYPES.MSG_CUSTOM}),ft=[];vt.forEach(function(it){var ut,ee=it.payload.data,xe=!0;try{ut=JSON.parse(ee)}catch{xe=!1}if(xe){var Et=ut.businessID,Fn=ut.actionType;if(Et===1)switch(Fn){case B.ActionType.INVITE:Se._onNewInvitationReceived(ut);break;case B.ActionType.REJECT_INVITE:Se._onInviteeRejected(ut);break;case B.ActionType.ACCEPT_INVITE:Se._onInviteeAccepted(ut);break;case B.ActionType.CANCEL_INVITE:Se._onInvitationCancelled(ut);break;case B.ActionType.INVITE_TIMEOUT:Se._onInvitationTimeout(ut)}else{if(Et==="av_call")return!0;W.default.warn("TSignaling._onMessageReceived unknown businessID="+Et),ft.push(it)}}else ft.push(it)}),Y.default(ft)||this._outerEmitter.emit(re.default.CUSTOM_MESSAGE_RECEIVED,ft)},Pe.prototype._hasLocalInviteInfo=function(de,Se){var Ee=de.inviteID,ke=de.groupID;if(W.default.log("TSignaling._hasLocalInviteInfo inviteID="+Ee+" groupID="+ke),!this._inviteInfoMap.has(Ee))return!1;var De=this._inviteInfoMap.get(Ee).inviteeList;return!ke||(Se?De.length>0:De.length>0&&De.includes(this._userID))},Pe.prototype._startTimer=function(de,Se){var Ee=this;Se===void 0&&(Se=!0);var ke=de.timeout;if(W.default.log("TSignaling._startTimer timeout="+ke+" isInvitator="+Se+" timeoutStatus="+(ke===0)),ke!==0)var De=Se?ke+5:ke,Qe=1,vt=setInterval(function(){var ft=Ee._hasLocalInviteInfo(de,Se);W.default.log("TSignaling.setInterval hasInviteInfo="+ft),Qe<De&&ft?++Qe:(ft&&Ee._sendTimeoutNotice(de,Se),clearInterval(vt))},1e3)},Pe.prototype._sendTimeoutNotice=function(de,Se){return D(this,void 0,void 0,function(){var Ee,ke,De,Qe,vt,ft,it,ut;return x(this,function(ee){switch(ee.label){case 0:return Ee=de.inviteID,ke=de.groupID,De=de.inviteeList,Qe=de.inviter,vt=de.data,ft=Se?ke||De[0]:ke||Qe,W.default.log("TSignaling._sendTimeoutNotice inviteID="+Ee+" to="+ft+" isInvitator="+Se),it={businessID:B.BusinessID.SIGNAL,inviteID:Ee,inviter:Qe,actionType:B.ActionType.INVITE_TIMEOUT,inviteeList:Se?De:[this._userID],data:vt,timeout:0,groupID:ke},[4,this._sendCustomMessage(ft,it)];case 1:return(ut=ee.sent())&&ut.code===0&&(this._outerEmitter.emit(re.default.INVITATION_TIMEOUT,{inviter:Qe,inviteID:Ee,groupID:ke,inviteeList:it.inviteeList,isSelfTimeout:!0}),Se?this._deleteInviteInfoByID(Ee):this._updateLocalInviteInfo(it)),[2,ut]}})})},Pe.prototype._onNewInvitationReceived=function(de){var Se=de.inviteID,Ee=de.inviter,ke=de.inviteeList,De=de.groupID,Qe=de.data,vt=ke.includes(this._userID);W.default.log("TSignaling._onNewInvitationReceived",de,"myselfIncluded="+vt);var ft=JSON.parse(Qe),it=De&&(ft.call_end===0||Y.default(ft.room_id));Y.default(ft.room_id)&&ft.call_end>0||it?this._outerEmitter.emit(Pe.EVENT.NEW_INVITATION_RECEIVED,{inviteID:Se,inviter:Ee,groupID:De,inviteeList:ke,data:de.data||""}):(De&&vt||!De)&&(this._inviteInfoMap.set(Se,de),this._outerEmitter.emit(Pe.EVENT.NEW_INVITATION_RECEIVED,{inviteID:Se,inviter:Ee,groupID:De,inviteeList:ke,data:de.data||""}),this._startTimer(de,!1))},Pe.prototype._onInviteeRejected=function(de){var Se=de.inviteID,Ee=de.inviter,ke=de.groupID,De=this._inviteInfoMap.has(Se);W.default.log("TSignaling._onInviteeRejected inviteID="+Se+" hasInviteID="+De+" inviter="+Ee+" groupID="+ke),(ke&&De||!ke)&&(this._updateLocalInviteInfo(de),this._outerEmitter.emit(re.default.INVITEE_REJECTED,{inviteID:Se,inviter:Ee,groupID:ke,invitee:de.inviteeList[0],data:de.data||""}))},Pe.prototype._onInviteeAccepted=function(de){var Se=de.inviteID,Ee=de.inviter,ke=de.groupID,De=this._inviteInfoMap.has(Se);W.default.log("TSignaling._onInviteeAccepted inviteID="+Se+" hasInviteID="+De+" inviter="+Ee+" groupID="+ke),(ke&&De||!ke)&&(this._updateLocalInviteInfo(de),this._outerEmitter.emit(re.default.INVITEE_ACCEPTED,{inviteID:Se,inviter:Ee,groupID:ke,invitee:de.inviteeList[0],data:de.data||""}))},Pe.prototype._onInvitationCancelled=function(de){var Se=de.inviteID,Ee=de.inviter,ke=de.groupID,De=this._inviteInfoMap.has(Se);W.default.log("TSignaling._onInvitationCancelled inviteID="+Se+" hasInviteID="+De+" inviter="+Ee+" groupID="+ke),(ke&&De||!ke)&&(this._deleteInviteInfoByID(Se),this._outerEmitter.emit(re.default.INVITATION_CANCELLED,{inviteID:Se,inviter:Ee,groupID:ke,data:de.data||""}))},Pe.prototype._onInvitationTimeout=function(de){var Se=de.inviteID,Ee=de.inviter,ke=de.groupID,De=de.data,Qe=this._inviteInfoMap.has(Se);W.default.log("TSignaling._onInvitationTimeout inviteID="+Se+" hasInviteID="+Qe+" inviter="+Ee+" groupID="+ke),W.default.log("TSignaling._onInvitationTimeout data="+de.data);var vt=JSON.parse(De),ft=ke&&(vt.call_end===0||Y.default(vt.room_id));Y.default(vt.room_id)&&vt.call_end>0||ft||(ke&&Qe||!ke)&&(this._updateLocalInviteInfo(de),this._outerEmitter.emit(re.default.INVITATION_TIMEOUT,{inviteID:Se,inviter:Ee,groupID:ke,inviteeList:de.inviteeList,isSelfTimeout:!1}))},Pe.prototype._updateLocalInviteInfo=function(de){var Se=de.inviteID,Ee=de.inviter,ke=de.inviteeList,De=de.groupID;if(W.default.log("TSignaling._updateLocalInviteInfo inviteID="+Se+" inviter="+Ee+" groupID="+De),De){if(this._inviteInfoMap.has(Se)){var Qe=ke[0],vt=this._inviteInfoMap.get(Se).inviteeList;vt.includes(Qe)&&(vt.splice(vt.indexOf(Qe),1),W.default.log("TSignaling._updateLocalInviteInfo remove "+Qe+" from localInviteeList. "+vt.length+" invitees left")),vt.length===0&&this._deleteInviteInfoByID(Se)}}else this._deleteInviteInfoByID(Se)},Pe.prototype._deleteInviteInfoByID=function(de){this._inviteInfoMap.has(de)&&(W.default.log("TSignaling._deleteInviteInfoByID remove "+de+" from inviteInfoMap."),this._inviteInfoMap.delete(de))},Pe.prototype._sendCustomMessage=function(de,Se,Ee){return D(this,void 0,void 0,function(){var ke,De,Qe,vt;return x(this,function(ft){return ke=Se.groupID,De=this._tim.createCustomMessage({to:de,conversationType:ke?Xe.TYPES.CONV_GROUP:Xe.TYPES.CONV_C2C,priority:Xe.TYPES.MSG_PRIORITY_HIGH,payload:{data:JSON.stringify(Se)}}),Se.actionType===B.ActionType.INVITE?(vt={title:(Qe=Ee||{}).title||"",description:Qe.description||"\u60A8\u6709\u4E00\u4E2A\u901A\u8BDD\u8BF7\u6C42",androidOPPOChannelID:Qe.androidOPPOChannelID||"",extension:this._handleOfflineInfo(Se,Qe.extension||"")},W.default.log("TSignaling.offlinePushInfo "+JSON.stringify(vt)),[2,this._tim.sendMessage(De,{offlinePushInfo:{title:vt.title,description:vt.description,androidOPPOChannelID:vt.androidOPPOChannelID,extension:vt.extension}})]):[2,this._tim.sendMessage(De)]})})},Pe.prototype._handleOfflineInfo=function(de,Se){var Ee=JSON.parse(de.data),ke={action:de.actionType,call_type:Ee.call_type,room_id:Ee.room_id,call_id:de.inviteID,timeout:Ee.timeout,version:4,invited_list:de.inviteeList};de.groupID&&(ke.group_id=de.groupID);var De={entity:{action:2,chatType:de.groupID?2:1,content:JSON.stringify(ke),sendTime:parseInt(Date.now()/1e3+""),sender:de.inviter,version:1},userData:Se||""},Qe=JSON.stringify(De);return W.default.log("TSignaling._handleOfflineInfo "+Qe),Qe},Pe.EVENT=re.default,Pe.TYPES=ie.default,Pe}();R.default=Be},function(m,R,A){var D,x,$;Object.defineProperty(R,"__esModule",{value:!0}),R.ErrorCode=R.BusinessID=R.ActionType=void 0,function(B){B[B.INVITE=1]="INVITE",B[B.CANCEL_INVITE=2]="CANCEL_INVITE",B[B.ACCEPT_INVITE=3]="ACCEPT_INVITE",B[B.REJECT_INVITE=4]="REJECT_INVITE",B[B.INVITE_TIMEOUT=5]="INVITE_TIMEOUT"}(D||(D={})),R.ActionType=D,function(B){B[B.SIGNAL=1]="SIGNAL"}(x||(x={})),R.BusinessID=x,function(B){B[B.ERR_INVALID_PARAMETERS=6017]="ERR_INVALID_PARAMETERS",B[B.ERR_SDK_SIGNALING_INVALID_INVITE_ID=8010]="ERR_SDK_SIGNALING_INVALID_INVITE_ID",B[B.ERR_SDK_SIGNALING_NO_PERMISSION=8011]="ERR_SDK_SIGNALING_NO_PERMISSION"}($||($={})),R.ErrorCode=$},function(m,R,A){A.r(R),A.d(R,"default",function(){return B});const D=Function.prototype.apply,x=new WeakMap;function $(te){return x.has(te)||x.set(te,{}),x.get(te)}class B{constructor(re=null,ie=console){const W=$(this);return W._events=new Set,W._callbacks={},W._console=ie,W._maxListeners=re===null?null:parseInt(re,10),this}_addCallback(re,ie,W,Y){return this._getCallbacks(re).push({callback:ie,context:W,weight:Y}),this._getCallbacks(re).sort((se,Ae)=>se.weight>Ae.weight),this}_getCallbacks(re){return $(this)._callbacks[re]}_getCallbackIndex(re,ie){return this._has(re)?this._getCallbacks(re).findIndex(W=>W.callback===ie):null}_achieveMaxListener(re){return $(this)._maxListeners!==null&&$(this)._maxListeners<=this.listenersNumber(re)}_callbackIsExists(re,ie,W){const Y=this._getCallbackIndex(re,ie),se=Y!==-1?this._getCallbacks(re)[Y]:void 0;return Y!==-1&&se&&se.context===W}_has(re){return $(this)._events.has(re)}on(re,ie,W=null,Y=1){const se=$(this);if(typeof ie!="function")throw new TypeError(ie+" is not a function");return this._has(re)?(this._achieveMaxListener(re)&&se._console.warn(`Max listeners (${se._maxListeners}) for event "${re}" is reached!`),this._callbackIsExists(...arguments)&&se._console.warn(`Event "${re}" already has the callback ${ie}.`)):(se._events.add(re),se._callbacks[re]=[]),this._addCallback(...arguments),this}once(re,ie,W=null,Y=1){const se=(...Ae)=>(this.off(re,se),D.call(ie,W,Ae));return this.on(re,se,W,Y)}off(re,ie=null){const W=$(this);let Y;return this._has(re)&&(ie===null?(W._events.delete(re),W._callbacks[re]=null):(Y=this._getCallbackIndex(re,ie),Y!==-1&&(W._callbacks[re].splice(Y,1),this.off(...arguments)))),this}emit(re,...ie){return this._has(re)&&this._getCallbacks(re).forEach(W=>D.call(W.callback,W.context,ie)),this}clear(){const re=$(this);return re._events.clear(),re._callbacks={},this}listenersNumber(re){return this._has(re)?this._getCallbacks(re).length:null}}},function(m,R){var A;A=function(){return this}();try{A=A||new Function("return this")()}catch{typeof window=="object"&&(A=window)}m.exports=A},function(m,R,A){A.r(R);var D=A(0);const x=Object.prototype.hasOwnProperty;R.default=function($){if($==null)return!0;if(typeof $=="boolean")return!1;if(typeof $=="number")return $===0;if(typeof $=="string"||typeof $=="function"||Array.isArray($))return $.length===0;if($ instanceof Error)return $.message==="";if(Object(D.f)($)){for(const B in $)if(x.call($,B))return!1;return!0}return!!(Object(D.e)($)||Object(D.g)($)||Object(D.c)($))&&$.size===0}},function(m,R,A){A.r(R);class D extends Error{constructor($){super(),this.code=$.code,this.message=$.message,this.data=$.data||{}}}R.default=D},function(m,R,A){A.r(R);var D=A(1),x=A(4),$=A.n(x);R.default=class{constructor(){this._funcMap=new Map}defense(B,te,re){if(typeof B!="string"||B.length===0||typeof te!="function")return null;if(this._funcMap.has(B)&&this._funcMap.get(B).has(te))return this._funcMap.get(B).get(te);this._funcMap.has(B)||this._funcMap.set(B,new Map);let ie=null;return this._funcMap.get(B).has(te)?ie=this._funcMap.get(B).get(te):(ie=this._pack(B,te,re),this._funcMap.get(B).set(te,ie)),ie}defenseOnce(B,te,re){return typeof te!="function"?null:this._pack(B,te,re)}find(B,te){return typeof B!="string"||B.length===0||typeof te!="function"?null:this._funcMap.has(B)?this._funcMap.get(B).has(te)?this._funcMap.get(B).get(te):(D.default.log(`SafetyCallback.find: \u627E\u4E0D\u5230 func \u2014\u2014 ${B}/${te.name!==""?te.name:"[anonymous]"}`),null):(D.default.log(`SafetyCallback.find: \u627E\u4E0D\u5230 eventName-${B} \u5BF9\u5E94\u7684 func`),null)}delete(B,te){return typeof te=="function"&&!!this._funcMap.has(B)&&!!this._funcMap.get(B).has(te)&&(this._funcMap.get(B).delete(te),this._funcMap.get(B).size===0&&this._funcMap.delete(B),!0)}_pack(B,te,re){return function(){try{te.apply(re,Array.from(arguments))}catch(ie){const W=Object.values($.a).indexOf(B),Y=Object.keys($.a)[W];D.default.error(`\u63A5\u5165\u4FA7\u4E8B\u4EF6 EVENT.${Y} \u5BF9\u5E94\u7684\u56DE\u8C03\u51FD\u6570\u903B\u8F91\u5B58\u5728\u95EE\u9898\uFF0C\u8BF7\u68C0\u67E5\uFF01`,ie)}}}}},function(m,R,A){/**
 * UUID.js - RFC-compliant UUID Generator for JavaScript
 *
 * @file
 * @author  LiosK
 * @version v4.2.5
 * @license Apache License 2.0: Copyright (c) 2010-2020 LiosK
 */var D;D=function(x){function $(){var te=B._getRandomInt;this.timestamp=0,this.sequence=te(14),this.node=1099511627776*(1|te(8))+te(40),this.tick=te(4)}function B(){}return B.generate=function(){var te=B._getRandomInt,re=B._hexAligner;return re(te(32),8)+"-"+re(te(16),4)+"-"+re(16384|te(12),4)+"-"+re(32768|te(14),4)+"-"+re(te(48),12)},B._getRandomInt=function(te){if(te<0||te>53)return NaN;var re=0|1073741824*Math.random();return te>30?re+1073741824*(0|Math.random()*(1<<te-30)):re>>>30-te},B._hexAligner=function(te,re){for(var ie=te.toString(16),W=re-ie.length,Y="0";W>0;W>>>=1,Y+=Y)1&W&&(ie=Y+ie);return ie},B.overwrittenUUID=x,function(){var te=B._getRandomInt;B.useMathRandom=function(){B._getRandomInt=te};var re=null,ie=te;typeof window<"u"&&(re=window.crypto||window.msCrypto)?re.getRandomValues&&typeof Uint32Array<"u"&&(ie=function(W){if(W<0||W>53)return NaN;var Y=new Uint32Array(W>32?2:1);return Y=re.getRandomValues(Y)||Y,W>32?Y[0]+4294967296*(Y[1]>>>64-W):Y[0]>>>32-W}):(re=A(13))&&re.randomBytes&&(ie=function(W){if(W<0||W>53)return NaN;var Y=re.randomBytes(W>32?8:4),se=Y.readUInt32BE(0);return W>32?se+4294967296*(Y.readUInt32BE(4)>>>64-W):se>>>32-W}),B._getRandomInt=ie}(),B.FIELD_NAMES=["timeLow","timeMid","timeHiAndVersion","clockSeqHiAndReserved","clockSeqLow","node"],B.FIELD_SIZES=[32,16,16,8,8,48],B.genV4=function(){var te=B._getRandomInt;return new B()._init(te(32),te(16),16384|te(12),128|te(6),te(8),te(48))},B.parse=function(te){var re;if(re=/^\s*(urn:uuid:|\{)?([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{2})([0-9a-f]{2})-([0-9a-f]{12})(\})?\s*$/i.exec(te)){var ie=re[1]||"",W=re[8]||"";if(ie+W===""||ie==="{"&&W==="}"||ie.toLowerCase()==="urn:uuid:"&&W==="")return new B()._init(parseInt(re[2],16),parseInt(re[3],16),parseInt(re[4],16),parseInt(re[5],16),parseInt(re[6],16),parseInt(re[7],16))}return null},B.prototype._init=function(){var te=B.FIELD_NAMES,re=B.FIELD_SIZES,ie=B._binAligner,W=B._hexAligner;this.intFields=new Array(6),this.bitFields=new Array(6),this.hexFields=new Array(6);for(var Y=0;Y<6;Y++){var se=parseInt(arguments[Y]||0);this.intFields[Y]=this.intFields[te[Y]]=se,this.bitFields[Y]=this.bitFields[te[Y]]=ie(se,re[Y]),this.hexFields[Y]=this.hexFields[te[Y]]=W(se,re[Y]>>>2)}return this.version=this.intFields.timeHiAndVersion>>>12&15,this.bitString=this.bitFields.join(""),this.hexNoDelim=this.hexFields.join(""),this.hexString=this.hexFields[0]+"-"+this.hexFields[1]+"-"+this.hexFields[2]+"-"+this.hexFields[3]+this.hexFields[4]+"-"+this.hexFields[5],this.urn="urn:uuid:"+this.hexString,this},B._binAligner=function(te,re){for(var ie=te.toString(2),W=re-ie.length,Y="0";W>0;W>>>=1,Y+=Y)1&W&&(ie=Y+ie);return ie},B.prototype.toString=function(){return this.hexString},B.prototype.equals=function(te){if(!(te instanceof B))return!1;for(var re=0;re<6;re++)if(this.intFields[re]!==te.intFields[re])return!1;return!0},B.NIL=new B()._init(0,0,0,0,0,0),B.genV1=function(){B._state==null&&B.resetState();var te=new Date().getTime(),re=B._state;te!=re.timestamp?(te<re.timestamp&&re.sequence++,re.timestamp=te,re.tick=B._getRandomInt(4)):Math.random()<B._tsRatio&&re.tick<9984?re.tick+=1+B._getRandomInt(4):re.sequence++;var ie=B._getTimeFieldValues(re.timestamp),W=ie.low+re.tick,Y=4095&ie.hi|4096;re.sequence&=16383;var se=re.sequence>>>8|128,Ae=255&re.sequence;return new B()._init(W,ie.mid,Y,se,Ae,re.node)},B.resetState=function(){B._state=new $},B._tsRatio=1/4,B._state=null,B._getTimeFieldValues=function(te){var re=te-Date.UTC(1582,9,15),ie=re/4294967296*1e4&268435455;return{low:1e4*(268435455&re)%4294967296,mid:65535&ie,hi:ie>>>16,timestamp:re}},typeof m.exports=="object"&&(m.exports=B),B}(D)},function(m,R){},function(m,R){m.exports=g},function(m){m.exports=JSON.parse('{"name":"tsignaling","version":"0.10.0","description":"\u817E\u8BAF\u4E91 Web \u4FE1\u4EE4 SDK","main":"./src/index.ts","scripts":{"lint":"./node_modules/.bin/eslint ./src","fix":"./node_modules/.bin/eslint --fix ./src","ts2js":"tsc src/index.ts --outDir build/ts2js","doc":"npm run ts2js && npm run doc:clean && npm run doc:build","doc:build":"./node_modules/.bin/jsdoc -c build/jsdoc/jsdoc.json && node ./build/jsdoc/fix-doc.js","doc:clean":"node ./build/jsdoc/clean-doc.js","build:wx":"cross-env NODE_ENV=wx webpack --config webpack.prod.config.js","build:web":"node node_modules/cross-env/src/bin/cross-env.js NODE_ENV=web node_modules/webpack/bin/webpack.js --config webpack.prod.config.js","build:package":"node build/package-bundle.js","prerelease":"npm run build:web && npm run build:wx && npm run build:package && node ./build/copy.js","start:wx":"cross-env NODE_ENV=wx  webpack-dev-server --config webpack.config.js","start:web":"node node_modules/cross-env/src/bin/cross-env.js NODE_ENV=web node_modules/webpack-dev-server/bin/webpack-dev-server.js --config webpack.dev.config.js","build_withcopy":"npm run build:web && cp dist/npm/tsignaling-js.js ../TIM-demo-web/node_modules/tsignaling/tsignaling-js.js","build_withcopy:mp":"npm run build:wx && cp dist/npm/tsignaling-wx.js ../TIM-demo-mini/static/component/TRTCCalling/utils/tsignaling-wx.js","changelog":"cp CHANGELOG.md build/jsdoc/tutorials/CHANGELOG.md"},"husky":{"hooks":{"pre-commit":"npm run lint"}},"lint-staged":{"*.{.ts,.tsx}":["eslint","git add"]},"keywords":["\u817E\u8BAF\u4E91","\u5373\u65F6\u901A\u4FE1","\u4FE1\u4EE4"],"author":"","license":"ISC","devDependencies":{"conventional-changelog-cli":"^2.1.1","cross-env":"^7.0.2","fs-extra":"^9.0.1","html-webpack-plugin":"^4.3.0","ts-loader":"^7.0.5","typescript":"^3.9.9","webpack":"^4.43.0","webpack-cli":"^3.3.11","webpack-dev-server":"^3.11.0"},"dependencies":{"@typescript-eslint/eslint-plugin":"^4.22.1","@typescript-eslint/parser":"^4.22.1","EventEmitter":"^1.0.0","docdash-blue":"^1.1.3","eslint":"^5.16.0","eslint-config-google":"^0.13.0","eslint-plugin-classes":"^0.1.1","jsdoc":"^3.6.4","jsdoc-plugin-typescript":"^2.0.5","pretty":"^2.0.0","replace":"^1.2.0","uuidjs":"^4.2.5"}}')}]).default})})(kL);const cl=SB(kL.exports),mi=class{constructor(){we(this,"sdkAppId",0);we(this,"userId","");we(this,"userSig","");we(this,"isSdkReady",!1);we(this,"isLogin",!1);we(this,"tim");we(this,"tsignaling");we(this,"emitter");we(this,"loginResolveRejectCache");we(this,"inviteInfoMap");this.loginResolveRejectCache=[],this.onTIMReadyStateUpdate=this.onTIMReadyStateUpdate.bind(this),this.emitter=new bT,this.inviteInfoMap=new Map}init(s){const{sdkAppId:g,userId:m,userSig:R,tim:A}=s;this.sdkAppId=g,this.userId=m,this.userSig=R,this.tim=A,this.tsignaling=new cl({SDKAppID:g,tim:A}),this.bindTSignalingEvent(),this.bindTIMEvent()}getInviteInfoMapKey(s,g){return Fe.debug(`${mi.logPrefix}getInviteInfoMapKey: ${this}`),`${s}-${g}`}setTSignalingData(s){return Fe.debug(`${mi.logPrefix}setTSignalingData: ${this}`),JSON.stringify({version:1,businessID:"TUIRoom",platform:"Electron",data:s})}async login(s,g){return Fe.debug(`${mi.logPrefix}login userId: ${s} userSig: ${g}`),await this.loginTSignaling(s,g),this.isLogin=!0,Ot.success()}loginTSignaling(s,g){return new Promise((m,R)=>{this.tsignaling.login({userID:s,userSig:g}).then(A=>(Fe.debug(`${mi.logPrefix}login cache resolve/reject`,A),this.loginResolveRejectCache.push({resolve:m,reject:R}),null)).catch(A=>{R(A)})})}async logout(){try{const s=await this.tim.logout();if(s.code===0)return Fe.debug(`${mi.logPrefix}logout success`),this.isLogin=!1,Ot.success(s.data);throw Fe.error(`${mi.logPrefix}.logout error:`,s),Ht.error(Jt.LOGOUT_ERROR,JSON.stringify(s.data)||yn.LOGOUT_ERROR)}catch(s){throw Fe.warn(`${mi.logPrefix}logout error:`,s),new Ht(Jt.TIM_ERROR,s.message)}}async invite(s,g,m){const R=this.getInviteInfoMapKey(s,g==null?void 0:g.cmd);return new Promise((A,D)=>{this.tsignaling.invite({userID:s,data:this.setTSignalingData(g),timeout:m}).then(x=>{Fe.log(`${mi.logPrefix}invite cache resolve/reject: ${JSON.stringify(x)}`);const $={type:g==null?void 0:g.cmd,inviteId:x.inviteID,resolve:A,reject:D};return this.inviteInfoMap.set(R,$),null}).catch(x=>{D(x)})})}async accept(s,g){var R,A,D,x,$;const m=this.getInviteInfoMapKey(s,g==null?void 0:g.cmd);if(!((R=this.inviteInfoMap)!=null&&R.has(m)))throw new Ht(Jt.TS_CMD_ERROR,yn.TS_CMD_ERROR);try{Fe.log(`${mi.logPrefix}accept`,m,(A=this.inviteInfoMap)==null?void 0:A.get(m));const B=(x=(D=this.inviteInfoMap)==null?void 0:D.get(m))==null?void 0:x.inviteId,te=await this.tsignaling.accept({inviteID:B,data:this.setTSignalingData(g)});return($=this.inviteInfoMap)==null||$.delete(m),Ot.success(te)}catch(B){throw new Ht(Jt.TIM_ERROR,B.message)}}async cancel(s,g){var R,A,D,x,$,B,te;const m=this.getInviteInfoMapKey(s,g==null?void 0:g.cmd);if(!((R=this.inviteInfoMap)!=null&&R.has(m)))throw new Ht(Jt.TS_CMD_ERROR,yn.TS_CMD_ERROR);try{Fe.log(`${mi.logPrefix}cancel`,m,(A=this.inviteInfoMap)==null?void 0:A.get(m));const re=(x=(D=this.inviteInfoMap)==null?void 0:D.get(m))==null?void 0:x.inviteId,ie=await this.tsignaling.cancel({inviteID:re,data:this.setTSignalingData(g)}),W={code:rT.CANCELLED,data:{inviteId:re,inviterId:s}};return(B=($=this.inviteInfoMap)==null?void 0:$.get(m))==null||B.resolve(W),(te=this.inviteInfoMap)==null||te.delete(m),Ot.success(ie)}catch(re){throw new Ht(Jt.TIM_ERROR,re.message)}}async reject(s,g){var R,A,D,x,$;const m=this.getInviteInfoMapKey(s,g==null?void 0:g.cmd);if(!((R=this.inviteInfoMap)!=null&&R.has(m)))throw new Ht(Jt.TS_CMD_ERROR,yn.TS_CMD_ERROR);try{Fe.log(`${mi.logPrefix}reject`,m,(A=this.inviteInfoMap)==null?void 0:A.get(m));const B=(x=(D=this.inviteInfoMap)==null?void 0:D.get(m))==null?void 0:x.inviteId,te=await this.tsignaling.reject({inviteID:B,data:this.setTSignalingData(g)});return($=this.inviteInfoMap)==null||$.delete(m),Ot.success(te)}catch(B){throw new Ht(Jt.TIM_ERROR,B.message)}}bindTIMEvent(){this.tim.on(Cr.EVENT.SDK_READY,this.onTIMReadyStateUpdate),this.tim.on(Cr.EVENT.SDK_NOT_READY,this.onTIMReadyStateUpdate)}unbindTIMEvent(){this.tim.off(Cr.EVENT.SDK_READY,this.onTIMReadyStateUpdate),this.tim.off(Cr.EVENT.SDK_NOT_READY,this.onTIMReadyStateUpdate)}onTIMReadyStateUpdate(s){Fe.debug(`${mi.logPrefix}onTIMReadyStateUpdate event:`,s,this.loginResolveRejectCache),s.name===Cr.EVENT.SDK_READY?(this.isSdkReady=!0,this.loginResolveRejectCache.forEach(({resolve:m})=>{m(Ot.success())})):(this.isSdkReady=!1,this.loginResolveRejectCache.forEach(({reject:m})=>{m(Ht.error(Jt.LOGIN_ERROR,JSON.stringify(s)))}),this.unbindTIMEvent()),this.loginResolveRejectCache=[]}bindTSignalingEvent(){this.tsignaling.on(cl.EVENT.NEW_INVITATION_RECEIVED,this.onNewInvitationReceived,this),this.tsignaling.on(cl.EVENT.INVITEE_ACCEPTED,this.onInviteeAccepted,this),this.tsignaling.on(cl.EVENT.INVITEE_REJECTED,this.onInviteeRejected,this),this.tsignaling.on(cl.EVENT.INVITATION_CANCELLED,this.onInvitationCancelled,this),this.tsignaling.on(cl.EVENT.INVITATION_TIMEOUT,this.onInvitationTimeout,this)}unbindTSignalingEvent(){this.tsignaling.off(cl.EVENT.NEW_INVITATION_RECEIVED,this.onNewInvitationReceived,this),this.tsignaling.off(cl.EVENT.INVITEE_ACCEPTED,this.onInviteeAccepted,this),this.tsignaling.off(cl.EVENT.INVITEE_REJECTED,this.onInviteeRejected,this),this.tsignaling.off(cl.EVENT.INVITATION_CANCELLED,this.onInvitationCancelled,this),this.tsignaling.off(cl.EVENT.INVITATION_TIMEOUT,this.onInvitationTimeout,this)}onNewInvitationReceived(s){var $,B,te,re,ie,W,Y,se,Ae,Je,Xe,Ue,Be,Pe,de,Se,Ee,ke,De,Qe,vt,ft;Fe.debug(`${mi.logPrefix}onNewInvitationReceived: ${JSON.stringify(s)}`);const{data:{inviteID:g,data:m,inviter:R}}=s,A=sg(m),D=this.getInviteInfoMapKey(R,($=A==null?void 0:A.data)==null?void 0:$.cmd),x={type:(B=A==null?void 0:A.data)==null?void 0:B.cmd,inviteId:g,resolve:()=>{},reject:()=>{}};switch((te=A==null?void 0:A.data)==null?void 0:te.cmd){case Qn.ReplyCallingRoll:this.inviteInfoMap.set(D,x),(ie=this.emitter)==null||ie.emit(ze.onUserReplyCallingRoll,{inviterId:R,type:(re=A==null?void 0:A.data)==null?void 0:re.cmd});break;case Qn.PickSeat:this.inviteInfoMap.set(D,x),(Y=this.emitter)==null||Y.emit(ze.onReceiveSpeechInvitation,{inviterId:R,type:(W=A==null?void 0:A.data)==null?void 0:W.cmd});break;case Qn.TakeSeat:this.inviteInfoMap.set(D,x),(Ae=this.emitter)==null||Ae.emit(ze.onReceiveSpeechApplication,{inviterId:R,type:(se=A==null?void 0:A.data)==null?void 0:se.cmd});break;case Qn.KickSeat:this.inviteInfoMap.set(D,x),(Xe=this.emitter)==null||Xe.emit(ze.onUserKickOffStage,{inviterId:R,type:(Je=A==null?void 0:A.data)==null?void 0:Je.cmd});break;case Qn.MuteUserMicrophone:this.inviteInfoMap.set(D,x),(Pe=this.emitter)==null||Pe.emit(ze.onMicrophoneMuted,{inviterId:R,type:(Ue=A==null?void 0:A.data)==null?void 0:Ue.cmd,mute:(Be=A==null?void 0:A.data)==null?void 0:Be.mute});break;case Qn.MuteUserCamera:this.inviteInfoMap.set(D,x),(Ee=this.emitter)==null||Ee.emit(ze.onCameraMuted,{inviterId:R,type:(de=A==null?void 0:A.data)==null?void 0:de.cmd,mute:(Se=A==null?void 0:A.data)==null?void 0:Se.mute});break;case Qn.MuteUserChatRoom:this.inviteInfoMap.set(D,x),(Qe=this.emitter)==null||Qe.emit(ze.onUserChatRoomMuted,{inviterId:R,type:(ke=A==null?void 0:A.data)==null?void 0:ke.cmd,mute:(De=A==null?void 0:A.data)==null?void 0:De.mute});break;case Qn.KickOffUser:this.inviteInfoMap.set(D,x),(ft=this.emitter)==null||ft.emit(ze.onUserKickOff,{inviterId:R,type:(vt=A==null?void 0:A.data)==null?void 0:vt.cmd});break;default:Fe.warn(`${mi.logPrefix}onNewInvitationReceived ignored cmd:`,A);break}}onInviteeAccepted(s){var x,$,B,te,re;Fe.warn(`${mi.logPrefix}onInviteeAccepted:`,JSON.stringify(s));const{data:{data:g,invitee:m}}=s,R=sg(g),A=this.getInviteInfoMapKey(m,(x=R==null?void 0:R.data)==null?void 0:x.cmd);let D={};switch(($=R==null?void 0:R.data)==null?void 0:$.cmd){case Qn.ReplyCallingRoll:case Qn.PickSeat:case Qn.TakeSeat:case Qn.KickSeat:case Qn.MuteUserMicrophone:case Qn.MuteUserCamera:case Qn.MuteUserChatRoom:case Qn.KickOffUser:D={code:rT.ACCEPTED,data:{inviterId:m}},(te=(B=this.inviteInfoMap)==null?void 0:B.get(A))==null||te.resolve(D),(re=this.inviteInfoMap)==null||re.delete(A);break;default:Fe.warn(`${mi.logPrefix}onInviteeAccepted ignored cmd:`,R);break}}onInviteeRejected(s){var x,$,B,te,re;Fe.warn(`${mi.logPrefix}onInviteeRejected:`,this);const{data:{data:g,invitee:m}}=s,R=sg(g),A=this.getInviteInfoMapKey(m,(x=R==null?void 0:R.data)==null?void 0:x.cmd);let D={};switch(($=R==null?void 0:R.data)==null?void 0:$.cmd){case Qn.PickSeat:case Qn.TakeSeat:D={code:rT.REJECTED,data:{inviterId:m}},(te=(B=this.inviteInfoMap)==null?void 0:B.get(A))==null||te.resolve(D),(re=this.inviteInfoMap)==null||re.delete(A);break;default:Fe.warn(`${mi.logPrefix}onInviteeRejected ignored cmd:`,R);break}}onInvitationCancelled(s){var D,x,$,B,te,re,ie,W;Fe.warn(`${mi.logPrefix}onInvitationCancelled:`,this);const{data:{data:g,inviter:m}}=s,R=sg(g),A=this.getInviteInfoMapKey(m,(D=R==null?void 0:R.data)==null?void 0:D.cmd);switch((x=R==null?void 0:R.data)==null?void 0:x.cmd){case Qn.PickSeat:(B=this.emitter)==null||B.emit(ze.onReceiveInvitationCancelled,{inviterId:m,type:($=R==null?void 0:R.data)==null?void 0:$.cmd}),(te=this.inviteInfoMap)==null||te.delete(A);break;case Qn.TakeSeat:(ie=this.emitter)==null||ie.emit(ze.onSpeechApplicationCancelled,{inviterId:m,type:(re=R==null?void 0:R.data)==null?void 0:re.cmd}),(W=this.inviteInfoMap)==null||W.delete(A);break;default:Fe.warn(`${mi.logPrefix}onInvitationCancelled ignored cmd:`,R);break}}onInvitationTimeout(s){var D;Fe.warn(`${mi.logPrefix}onInvitationTimeout:`,s);const{data:{inviteId:g,inviteeList:m,isSelfTimeout:R,inviter:A}}=s;for(let x=0;x<m.length;x+=1)(D=this.inviteInfoMap)==null||D.forEach(($,B)=>{var te,re,ie,W,Y;if(($==null?void 0:$.inviteId)===g&&R===!1){const se={code:rT.TIMEOUT,data:{inviterId:m[x]}};Fe.warn(`${mi.logPrefix}inviteInfoMap:`,se),$==null||$.resolve(se),(te=this.inviteInfoMap)==null||te.delete(B)}else if(($==null?void 0:$.inviteId)===g&&R)switch($==null?void 0:$.type){case Qn.PickSeat:(re=this.emitter)==null||re.emit(ze.onReceiveInvitationTimeout,{inviterId:A}),(ie=this.inviteInfoMap)==null||ie.delete(B);break;case Qn.TakeSeat:(W=this.emitter)==null||W.emit(ze.onSpeechApplicationTimeout,{inviterId:A}),(Y=this.inviteInfoMap)==null||Y.delete(B);break;default:Fe.warn(`${mi.logPrefix}onInvitationTimeout ignored:`,$);break}})}on(s,g,m){var R;(R=this.emitter)==null||R.on(s,g,m)}off(s,g){var m;(m=this.emitter)==null||m.off(s,g)}destroy(){this.unbindTSignalingEvent(),this.unbindTIMEvent(),this.loginResolveRejectCache.length&&(this.loginResolveRejectCache.forEach(({reject:s})=>{s(Ht.error(Jt.ROOM_BEEN_DESTROYED,yn.ROOM_BEEN_DESTROYED))}),this.loginResolveRejectCache=[])}};let cb=mi;we(cb,"logPrefix","[TSignalingService]");const kn=class{constructor(){we(this,"state");we(this,"trtcService");we(this,"timService");we(this,"tSignalingService");we(this,"roomCoordinator");we(this,"sdkAppId",0);we(this,"userSig","");we(this,"isLogin",!1);we(this,"emitter",new bT);we(this,"tim");we(this,"roomLifecycle");we(this,"roomAuth");this.state=new a8,this.trtcService=new ib,this.timService=new lT,this.tSignalingService=new cb,this.roomAuth=new sb(this.state,this.tSignalingService,this.trtcService),this.roomLifecycle=new ab(this.state,this.timService,this.trtcService),this.roomCoordinator=new ob(this.state,this.tSignalingService),this.onRemoteUserEnterRoom=this.onRemoteUserEnterRoom.bind(this),this.onRemoteUserLeaveRoom=this.onRemoteUserLeaveRoom.bind(this),this.onRemoteUserAVEnabled=this.onRemoteUserAVEnabled.bind(this),this.onRemoteUserAVDisabled=this.onRemoteUserAVDisabled.bind(this),this.onUserVideoAvailable=this.onUserVideoAvailable.bind(this),this.onUserSubStreamAvailable=this.onUserSubStreamAvailable.bind(this),this.onUserAudioAvailable=this.onUserAudioAvailable.bind(this),this.onFirstVideoAvailable=this.onFirstVideoAvailable.bind(this),this.onUserVoiceVolume=this.onUserVoiceVolume.bind(this),this.onNetworkQuality=this.onNetworkQuality.bind(this),this.onStatistics=this.onStatistics.bind(this),this.onDeviceChange=this.onDeviceChange.bind(this),this.onWebScreenSharingStopped=this.onWebScreenSharingStopped.bind(this),this.bindTRTCEvent(),this.onReceiveChatMessage=this.onReceiveChatMessage.bind(this),this.onReceiveCustomMessage=this.onReceiveCustomMessage.bind(this),this.onRoomDestroyed=this.onRoomDestroyed.bind(this),this.onRoomMasterChanged=this.onRoomMasterChanged.bind(this),this.bindIMEvent(),this.onCallingRollStarted=this.onCallingRollStarted.bind(this),this.onCallingRollStopped=this.onCallingRollStopped.bind(this),this.onUserReplyCallingRoll=this.onUserReplyCallingRoll.bind(this),this.onMicrophoneMuted=this.onMicrophoneMuted.bind(this),this.onCameraMuted=this.onCameraMuted.bind(this),this.onUserChatRoomMuted=this.onUserChatRoomMuted.bind(this),this.onUserKickOff=this.onUserKickOff.bind(this),this.onReceiveSpeechInvitation=this.onReceiveSpeechInvitation.bind(this),this.onReceiveInvitationCancelled=this.onReceiveInvitationCancelled.bind(this),this.onReceiveInvitationTimeout=this.onReceiveInvitationTimeout.bind(this),this.onReceiveSpeechApplication=this.onReceiveSpeechApplication.bind(this),this.onSpeechApplicationCancelled=this.onSpeechApplicationCancelled.bind(this),this.onSpeechApplicationTimeout=this.onSpeechApplicationTimeout.bind(this),this.onUserKickOffStage=this.onUserKickOffStage.bind(this),this.bindCoordinatorEvent()}static getInstance(){return kn.instance||(kn.instance=new kn),kn.instance}static destroyInstance(){kn.instance!==null&&kn.instance.destroy()}checkLogin(){if(!this.login)throw new Ht(Jt.NOT_LOGIN,yn.NOT_LOGIN)}async login(s,g,m){return Fe.log(`${kn.logPrefix}.login`,s,g,m),await this.roomAuth.init(g,m),this.isLogin||(this.tim||(this.tim=Cr.create({SDKAppID:s})),this.timService.init({sdkAppId:s,userId:g,userSig:m,tim:this.tim}),this.tSignalingService.init({sdkAppId:s,userId:g,userSig:m,tim:this.tim}),await this.roomAuth.login(g,m),this.sdkAppId=s,this.userSig=m,this.isLogin=!0),Ot.success()}async logout(){return Fe.debug(`${kn.logPrefix}logout`,this.state.currentUser.userId),this.isLogin&&(await this.roomAuth.logout(),this.isLogin=!1),Ot.success()}async setRoomConfig(s){return this.state.roomInfo.roomConfig=Object.assign(this.state.roomInfo.roomConfig,{...s}),this.roomCoordinator.setControlConfig(this.state.roomInfo.roomConfig)}async checkRoomExistence(s){Fe.log(`${kn.logPrefix}checkRoomExistence roomId: ${s}`),this.checkLogin();const g=await this.timService.checkGroupExistence(`${s}`),{data:m}=g;return!!m}async createRoom(s,g=iu.APPLY_SPEECH){Fe.log(`${kn.logPrefix}createRoom`,s,g),this.checkLogin();const m=await this.roomLifecycle.createRoom({sdkAppId:this.sdkAppId,userId:this.state.currentUser.userId,userSig:this.userSig,roomId:s,mode:g});this.roomCoordinator.init({roomId:s,tim:this.tim});const{room:R,user:A}=m.data;return this.emitter.emit(ze.onUserEnterRoom,A),this.getRoomMemberList(),Ot.success(R)}async destroyRoom(){Fe.debug(`${kn.logPrefix}destroyRoom`),this.checkLogin();const s=await this.roomLifecycle.destroyRoom(),{user:g}=s.data;return this.emitter.emit(ze.onUserLeaveRoom,g),Ot.success()}async enterRoom(s){Fe.debug(`${kn.logPrefix}enterRoom roomId: ${s}`),this.checkLogin();const g=await this.roomLifecycle.enterRoom({sdkAppId:this.sdkAppId,userId:this.state.currentUser.userId,userSig:this.userSig,roomId:s});this.roomCoordinator.init({roomId:s,tim:this.tim});const{room:m,user:R}=g.data;return this.emitter.emit(ze.onUserEnterRoom,R),this.getRoomMemberList(),Ot.success(m)}async exitRoom(){var m;if(!((m=this.state.roomInfo)!=null&&m.roomId))return Ot.success();Fe.debug(`${kn.logPrefix}exitRoom`),this.checkLogin();const s=await this.roomLifecycle.exitRoom(),{user:g}=s.data;return this.emitter.emit(ze.onUserLeaveRoom,g),Ot.success()}getRoomInfo(){return Sr(this.state.roomInfo)}getRoomUsers(){const s=[];return this.state.userMap.forEach(g=>{s.push(Sr(g))}),s}async getUserInfo(s){if(this.state.userMap.has(s)){const m=this.state.userMap.get(s);return Sr(m)}const g=await this.timService.getGroupMemberProfile([s]);if(g.data.length>0){const{userID:m,avatar:R,nick:A}=g.data[0];return{userId:m,avatar:R,name:A}}return null}setSelfProfile(s,g){this.state.currentUser.name=s,this.state.currentUser.avatar=g}async transferRoomMaster(s){return Fe.debug(`${kn.logPrefix}transferRoomMaster userId: ${s}`),await this.timService.changeGroupOwner(s),this.state.currentUser.role=zr.ANCHOR,this.emitter.emit(ze.onUserStateChange,Sr(this.state.currentUser)),Ot.success()}setVideoEncoderParam(s){this.trtcService.setVideoEncoderParam(s)}async startCameraPreview(s){Fe.debug(`${kn.logPrefix}startCameraPreview`),await this.trtcService.startLocalVideo(s),this.state.currentUser.isVideoStreamAvailable=!0,this.emitter.emit(ze.onUserVideoAvailable,{userId:this.state.currentUser.userId,available:1,streamType:ru.CAMERA}),this.emitter.emit(ze.onUserStateChange,Sr(this.state.currentUser))}async stopCameraPreview(){Fe.debug(`${kn.logPrefix}stopCameraPreview`),await this.trtcService.stopLocalVideo(),this.state.currentUser.isVideoStreamAvailable=!1,this.emitter.emit(ze.onUserVideoAvailable,{userId:this.state.currentUser.userId,available:0,streamType:ru.CAMERA}),this.emitter.emit(ze.onUserStateChange,Sr(this.state.currentUser))}async startMicrophone(s){Fe.debug(`${kn.logPrefix}startMicrophone`),await this.trtcService.startLocalAudio(s),this.state.currentUser.isAudioStreamAvailable=!0,this.emitter.emit(ze.onUserAudioAvailable,{userId:this.state.currentUser.userId,available:1}),this.emitter.emit(ze.onUserStateChange,Sr(this.state.currentUser))}async stopMicrophone(){Fe.debug(`${kn.logPrefix}stopMicrophone`),await this.trtcService.stopLocalAudio(),this.state.currentUser.isAudioStreamAvailable=!1,this.emitter.emit(ze.onUserAudioAvailable,{userId:this.state.currentUser.userId,available:0}),this.emitter.emit(ze.onUserStateChange,Sr(this.state.currentUser))}async startCameraDeviceTest(s){Fe.debug(`${kn.logPrefix}startCameraDeviceTest`),await this.trtcService.startCameraDeviceTest(s)}stopCameraDeviceTest(){Fe.debug(`${kn.logPrefix}stopCameraDeviceTest`),this.trtcService.stopCameraDeviceTest()}startSystemAudioLoopback(){this.trtcService.startSystemAudioLoopback()}stopSystemAudioLoopback(){this.trtcService.stopSystemAudioLoopback()}setVideoMirror(s){this.trtcService.setVideoMirror(s)}setRemoteVideoFillMode(s,g,m){this.trtcService.setRemoteVideoFillMode(s,g,m)}muteLocalCamera(s){Fe.debug(`${kn.logPrefix}muteLocalCamera`),this.trtcService.muteLocalVideo(s),this.state.currentUser.isVideoStreamAvailable=!s,this.emitter.emit(ze.onUserVideoAvailable,{userId:this.state.currentUser.userId,available:s?0:1,streamType:ru.CAMERA}),this.emitter.emit(ze.onUserStateChange,Sr(this.state.currentUser))}muteLocalMicrophone(s){Fe.debug(`${kn.logPrefix}muteLocalMicrophone`),this.trtcService.muteLocalAudio(s),this.state.currentUser.isAudioStreamAvailable=!s,this.emitter.emit(ze.onUserAudioAvailable,{userId:this.state.currentUser.userId,available:s?0:1}),this.emitter.emit(ze.onUserStateChange,Sr(this.state.currentUser))}startRemoteView(s,g,m){this.trtcService.startRemoteView(s,g,m)}stopRemoteView(s,g){this.trtcService.stopRemoteView(s,g)}muteRemoteCamera(s,g){this.trtcService.muteRemoteVideo(s,g)}muteRemoteAudio(s,g){this.trtcService.muteRemoteAudio(s,g)}enableAudioVolumeEvaluation(s){this.trtcService.enableAudioVolumeEvaluation(s)}getScreenCaptureSources(s,g,m,R){return this.trtcService.getScreenCaptureSources(s,g,m,R)}selectScreenCaptureTarget(s,g,m,R,A,D){this.trtcService.selectScreenCaptureTarget(s,g,m,R,A,D)}async startScreenCapture(s,g){return this.trtcService.startScreenCapture(s,g)}async pauseScreenCapture(){return this.trtcService.pauseScreenCapture()}async resumeScreenCapture(){return this.trtcService.resumeScreenCapture()}async stopScreenCapture(){return this.trtcService.stopScreenCapture()}async startWhiteboardCapture(){return Fe.log(`${kn.logPrefix}startWhiteboardCapture`),Ot.success()}async startScreenShare(s){return Fe.log(`${kn.logPrefix}startScreenShare ${s.shareUserId}`),await this.trtcService.startScreenShare(s)}async stopScreenShare(){return Fe.log(`${kn.logPrefix}stopScreenShare`),await this.trtcService.stopScreenShare()}async getMicrophoneList(){return await this.trtcService.getMicrophoneList()}getCurrentMicrophone(){return this.trtcService.getCurrentMicrophone()}async setCurrentMicrophone(s){await this.trtcService.setCurrentMicrophone(s)}async getCameraList(){return await this.trtcService.getCameraList()}getCurrentCamera(){return this.trtcService.getCurrentCamera()}async setCurrentCamera(s){await this.trtcService.setCurrentCamera(s)}async getSpeakerList(){return await this.trtcService.getSpeakerList()}getCurrentSpeaker(){return this.trtcService.getCurrentSpeaker()}async setCurrentSpeaker(s){await this.trtcService.setCurrentSpeaker(s)}async startCloudRecord(){return Fe.debug(`${kn.logPrefix}startCloudRecord`),Ot.success()}async stopCloudRecord(){return Fe.debug(`${kn.logPrefix}stopCloudRecord`),Ot.success()}setBeautyStyle(s,g,m,R){Fe.debug(`${kn.logPrefix}setBeautyStyle:`,s,g,m,R)}setVideoQosPreference(s){this.trtcService.setVideoQosPreference(s),Fe.debug(`${kn.logPrefix}setVideoQosPreference preference:`,s)}bindTRTCEvent(){this.trtcService.on("onRemoteUserEnterRoom",this.onRemoteUserAVEnabled),this.trtcService.on("onRemoteUserLeaveRoom",this.onRemoteUserAVDisabled),this.trtcService.on("onUserVideoAvailable",this.onUserVideoAvailable),this.trtcService.on("onUserSubStreamAvailable",this.onUserSubStreamAvailable),this.trtcService.on("onUserAudioAvailable",this.onUserAudioAvailable),this.trtcService.on("onFirstVideoAvailable",this.onFirstVideoAvailable),this.trtcService.on("onUserVoiceVolume",this.onUserVoiceVolume),this.trtcService.on("onNetworkQuality",this.onNetworkQuality),this.trtcService.on("onStatistics",this.onStatistics),this.trtcService.on("onDeviceChange",this.onDeviceChange),this.trtcService.on("onWebScreenSharingStopped",this.onWebScreenSharingStopped)}unbindTRTCEvent(){this.trtcService.off("onRemoteUserEnterRoom",this.onRemoteUserAVEnabled),this.trtcService.off("onRemoteUserLeaveRoom",this.onRemoteUserAVDisabled),this.trtcService.off("onUserVideoAvailable",this.onUserVideoAvailable),this.trtcService.off("onUserSubStreamAvailable",this.onUserSubStreamAvailable),this.trtcService.off("onUserAudioAvailable",this.onUserAudioAvailable),this.trtcService.off("onFirstVideoAvailable",this.onFirstVideoAvailable),this.trtcService.off("onUserVoiceVolume",this.onUserVoiceVolume),this.trtcService.off("onNetworkQuality",this.onNetworkQuality),this.trtcService.off("onStatistics",this.onStatistics),this.trtcService.off("onDeviceChange",this.onDeviceChange),this.trtcService.off("onWebScreenSharingStopped",this.onWebScreenSharingStopped)}async onRemoteUserEnterRoom(s){Fe.log(`${kn.logPrefix}onRemoteUserEnterRoom userId: ${s}`);const m=(await this.timService.getGroupMemberProfile([s])).data[0];let R=this.state.userMap.get(s);R||(R=new xv,R.userId=s),m&&(R.name=m.nick,R.avatar=m.avatar),this.state.userMap.set(s,R),this.emitter.emit(ze.onUserEnterRoom,Sr(R))}async onRemoteUserAVEnabled(s){Fe.log(`${kn.logPrefix}onRemoteUserAVEnabled userId: ${s}`);let g=null;s.indexOf("share_")===0?g=await this.timService.getGroupMemberProfile([s.slice(6)]):g=await this.timService.getGroupMemberProfile([s]);const m=g.data[0];let R=this.state.userMap.get(s);R||(R=new xv,R.userId=s),m&&(R.name=m.nick,R.avatar=m.avatar),this.state.userMap.set(s,R),this.emitter.emit(ze.onUserAVEnabled,Sr(R))}onRemoteUserLeaveRoom(s,g){if(Fe.log(`${kn.logPrefix}onRemoteUserLeaveRoom userId: ${s} reason: ${g}`),this.state.userMap.has(s)){const m=this.state.userMap.get(s);this.state.userMap.delete(s),this.emitter.emit(ze.onUserLeaveRoom,Sr(m))}}onRemoteUserAVDisabled(s,g){if(Fe.log(`${kn.logPrefix}onRemoteUserAVDisabled userId: ${s} reason: ${g}`),this.state.userMap.has(s)){const m=this.state.userMap.get(s);this.emitter.emit(ze.onUserAVDisabled,Sr(m))}}onUserVideoAvailable(s,g){Fe.log(`${kn.logPrefix}onUserVideoAvailable userId: ${s} available: ${g}`);let m=this.state.userMap.get(s);m?(m.isVideoStreamAvailable=Boolean(g),this.emitter.emit(ze.onUserStateChange,Sr(m))):(m=new xv,m.userId=s,m.isVideoStreamAvailable=Boolean(g),this.state.userMap.set(s,m),this.emitter.emit(ze.onUserEnterRoom,Sr(m))),this.emitter.emit(ze.onUserVideoAvailable,{userId:s,available:g,streamType:ru.CAMERA})}onUserAudioAvailable(s,g){Fe.log(`${kn.logPrefix}onUserAudioAvailable userId: ${s} available: ${g}`);let m=this.state.userMap.get(s);m?(m.isAudioStreamAvailable=Boolean(g),this.emitter.emit(ze.onUserStateChange,Sr(m))):(m=new xv,m.userId=s,m.isAudioStreamAvailable=Boolean(g),this.state.userMap.set(s,m),this.emitter.emit(ze.onUserEnterRoom,Sr(m))),this.emitter.emit(ze.onUserAudioAvailable,{userId:s,available:g})}onUserSubStreamAvailable(s,g){Fe.log(`${kn.logPrefix}onUserSubStreamAvailable userId: ${s} available: ${g}`);let m=this.state.userMap.get(s);m?(m.isScreenStreamAvailable=Boolean(g),this.emitter.emit(ze.onUserStateChange,Sr(m))):(m=new xv,m.userId=s,m.isScreenStreamAvailable=Boolean(g),this.state.userMap.set(s,m),this.emitter.emit(ze.onUserEnterRoom,Sr(m))),this.emitter.emit(ze.onUserVideoAvailable,{userId:s,available:g,streamType:ru.SCREEN})}onFirstVideoAvailable(s,g,m,R){this.emitter.emit(ze.onFirstVideoFrame,{userId:s||this.state.currentUser.userId,streamType:g===gb.TRTCVideoStreamTypeBig?ru.CAMERA:ru.SCREEN,width:m,height:R})}onUserVoiceVolume(s){this.emitter.emit(ze.onUserVoiceVolume,s)}onNetworkQuality(s){this.emitter.emit(ze.onNetworkQuality,s)}onStatistics(s){this.emitter.emit(ze.onStatistics,s)}onDeviceChange(s,g,m){this.emitter.emit(ze.onDeviceChange,{deviceId:s,type:g,state:m})}onWebScreenSharingStopped(){this.emitter.emit(ze.onWebScreenSharingStopped,{})}sendChatMessage(s){return this.timService.sendChatMessage(s)}sendCustomMessage(s,g){return this.timService.sendCustomMessage(s,g)}updateMyProfile(s){return this.timService.updateMyProfile(s)}async getRoomMemberList(){(await this.timService.getGroupMemberList()).data.forEach(g=>{const{userID:m,nick:R,avatar:A}=g;if(m===this.state.currentUser.userId)return;let D=this.state.userMap.get(m);D||(D=new xv,D.userId=m),D.name=R,D.avatar=A,this.state.userMap.set(m,D),this.emitter.emit(ze.onUserEnterRoom,Sr(D))})}bindIMEvent(){this.timService.onRoomEvent(ze.onReceiveChatMessage,this.onReceiveChatMessage),this.timService.onRoomEvent(ze.onReceiveCustomMessage,this.onReceiveCustomMessage),this.timService.onRoomEvent(ze.onRoomDestroyed,this.onRoomDestroyed),this.timService.onRoomEvent(ze.onRoomMasterChanged,this.onRoomMasterChanged),this.timService.onRoomEvent("onRemoteUserEnterRoom",this.onRemoteUserEnterRoom),this.timService.onRoomEvent("onRemoteUserLeaveRoom",this.onRemoteUserLeaveRoom)}unbindIMEvent(){this.timService.offRoomEvent(ze.onReceiveChatMessage,this.onReceiveChatMessage),this.timService.offRoomEvent(ze.onReceiveCustomMessage,this.onReceiveCustomMessage),this.timService.offRoomEvent(ze.onRoomDestroyed,this.onRoomDestroyed),this.timService.offRoomEvent(ze.onRoomMasterChanged,this.onRoomMasterChanged),this.timService.offRoomEvent("onRemoteUserEnterRoom",this.onRemoteUserEnterRoom),this.timService.offRoomEvent("onRemoteUserLeaveRoom",this.onRemoteUserLeaveRoom)}onReceiveChatMessage(s){Fe.log(`${kn.logPrefix}onReceiveChatMessage message:`,s),this.emitter.emit(ze.onReceiveChatMessage,s)}onReceiveCustomMessage(s){Fe.log(`${kn.logPrefix}onReceiveChatMessage message:`,s);const{data:g}=s;this.emitter.emit(ze.onReceiveCustomMessage,g)}onRoomDestroyed(){Fe.log(`${kn.logPrefix}onRoomDestroyed`),this.trtcService.exitRoom(),this.state.reset(),this.emitter.emit(ze.onRoomDestroyed,null)}onRoomMasterChanged(s){Fe.log(`${kn.logPrefix}onRoomMasterChangd`,s,this.state),this.state.currentUser.userId===s&&(this.state.currentUser.role=zr.MASTER,this.emitter.emit(ze.onUserStateChange,Sr(this.state.currentUser))),this.emitter.emit(ze.onRoomMasterChanged,s)}async muteUserMicrophone(s,g){return this.roomCoordinator.muteUserMicrophone(s,g)}async muteAllUsersMicrophone(s){return this.roomCoordinator.muteAllUsersMicrophone(s)}async muteUserCamera(s,g){return this.roomCoordinator.muteUserCamera(s,g)}async muteAllUsersCamera(s){return this.roomCoordinator.muteAllUsersCamera(s)}async muteChatRoom(s){return this.roomCoordinator.muteChatRoom(s)}async muteUserChatRoom(s,g){return this.roomCoordinator.muteUserChatRoom(s,g)}async kickOffUser(s){return this.roomCoordinator.kickOffUser(s)}async startCallingRoll(){return this.roomCoordinator.startCallingRoll()}async stopCallingRoll(){return this.roomCoordinator.stopCallingRoll()}async replyCallingRoll(){return this.roomCoordinator.replyCallingRoll()}async sendSpeechInvitation(s){return this.roomCoordinator.sendSpeechInvitation(s)}async cancelSpeechInvitation(s){return this.roomCoordinator.cancelSpeechInvitation(s)}async replySpeechInvitation(s){const g=await this.roomCoordinator.replySpeechInvitation(s);return s&&this.trtcService.switchRole(uT.TRTCRoleAnchor),g}async kickUserOffStage(s){return this.roomCoordinator.kickUserOffStage(s)}async sendSpeechApplication(){const s=await this.roomCoordinator.sendSpeechApplication(),{code:g}=s;return g===0&&this.trtcService.switchRole(uT.TRTCRoleAnchor),s}async cancelSpeechApplication(){return this.roomCoordinator.cancelSpeechApplication()}async sendOffSpeaker(){return await this.stopCameraPreview(),await this.stopMicrophone(),await this.trtcService.switchRole(uT.TRTCRoleAudience),Ot.success()}async replySpeechApplication(s,g){return this.roomCoordinator.replySpeechApplication(s,g)}async forbidSpeechApplication(s){return this.roomCoordinator.forbidSpeechApplication(s)}async sendOffAllSpeakers(){return this.roomCoordinator.sendOffAllSpeakers()}async exitSpeechState(){return this.roomCoordinator.exitSpeechState()}bindCoordinatorEvent(){this.roomCoordinator.on(ze.onCallingRollStarted,this.onCallingRollStarted),this.roomCoordinator.on(ze.onCallingRollStopped,this.onCallingRollStopped),this.roomCoordinator.on(ze.onUserReplyCallingRoll,this.onUserReplyCallingRoll),this.roomCoordinator.on(ze.onMicrophoneMuted,this.onMicrophoneMuted),this.roomCoordinator.on(ze.onCameraMuted,this.onCameraMuted),this.roomCoordinator.on(ze.onUserChatRoomMuted,this.onUserChatRoomMuted),this.roomCoordinator.on(ze.onUserKickOff,this.onUserKickOff),this.roomCoordinator.on(ze.onReceiveSpeechInvitation,this.onReceiveSpeechInvitation),this.roomCoordinator.on(ze.onReceiveInvitationCancelled,this.onReceiveInvitationCancelled),this.roomCoordinator.on(ze.onReceiveInvitationTimeout,this.onReceiveInvitationTimeout),this.roomCoordinator.on(ze.onReceiveSpeechApplication,this.onReceiveSpeechApplication),this.roomCoordinator.on(ze.onSpeechApplicationCancelled,this.onSpeechApplicationCancelled),this.roomCoordinator.on(ze.onSpeechApplicationTimeout,this.onSpeechApplicationTimeout),this.roomCoordinator.on(ze.onUserKickOffStage,this.onUserKickOffStage)}unbindCoordinatorEvent(){this.roomCoordinator.off(ze.onCallingRollStarted,this.onCallingRollStarted),this.roomCoordinator.off(ze.onCallingRollStopped,this.onCallingRollStopped),this.roomCoordinator.off(ze.onUserReplyCallingRoll,this.onUserReplyCallingRoll),this.roomCoordinator.off(ze.onMicrophoneMuted,this.onMicrophoneMuted),this.roomCoordinator.off(ze.onCameraMuted,this.onCameraMuted),this.roomCoordinator.off(ze.onUserChatRoomMuted,this.onUserChatRoomMuted),this.roomCoordinator.off(ze.onUserKickOff,this.onUserKickOff),this.roomCoordinator.off(ze.onReceiveSpeechInvitation,this.onReceiveSpeechInvitation),this.roomCoordinator.off(ze.onReceiveInvitationCancelled,this.onReceiveInvitationCancelled),this.roomCoordinator.off(ze.onReceiveInvitationTimeout,this.onReceiveInvitationTimeout),this.roomCoordinator.off(ze.onReceiveSpeechApplication,this.onReceiveSpeechApplication),this.roomCoordinator.off(ze.onSpeechApplicationCancelled,this.onSpeechApplicationCancelled),this.roomCoordinator.off(ze.onSpeechApplicationTimeout,this.onSpeechApplicationTimeout),this.roomCoordinator.off(ze.onUserKickOffStage,this.onUserKickOffStage)}onCallingRollStarted(s){Fe.log(`${kn.logPrefix}onCallingRollStarted`,s),this.emitter.emit(ze.onCallingRollStarted,Sr(s.data))}onCallingRollStopped(s){Fe.log(`${kn.logPrefix}onCallingRollStopped`,s),this.emitter.emit(ze.onCallingRollStopped,Sr(s.data))}onUserReplyCallingRoll(s){Fe.log(`${kn.logPrefix}onUserReplyCallingRoll`,s),this.emitter.emit(ze.onUserReplyCallingRoll,Sr(s.data))}onMicrophoneMuted(s){Fe.log(`${kn.logPrefix}onMicrophoneMuted`,JSON.stringify(s)),this.emitter.emit(ze.onMicrophoneMuted,s)}onCameraMuted(s){Fe.log(`${kn.logPrefix}onCameraMuted`,JSON.stringify(s)),this.emitter.emit(ze.onCameraMuted,s)}onUserChatRoomMuted(s){Fe.log(`${kn.logPrefix}onUserChatRoomMuted`,JSON.stringify(s)),this.emitter.emit(ze.onUserChatRoomMuted,s)}onUserKickOff(s){this.emitter.emit(ze.onUserKickOff,s)}onReceiveSpeechInvitation(s){Fe.log(`${kn.logPrefix}onReceiveSpeechInvitation`,s),this.emitter.emit(ze.onReceiveSpeechInvitation,s.data)}onReceiveInvitationCancelled(s){Fe.log(`${kn.logPrefix}onReceiveInvitationCancelled`,s),this.emitter.emit(ze.onReceiveInvitationCancelled,s.data)}onReceiveInvitationTimeout(s){Fe.log(`${kn.logPrefix}onReceiveInvitationTimeout`,s),this.emitter.emit(ze.onReceiveInvitationTimeout,s.data)}onReceiveSpeechApplication(s){Fe.log(`${kn.logPrefix}onReceiveSpeechApplication`,s),this.emitter.emit(ze.onReceiveSpeechApplication,s)}onSpeechApplicationCancelled(s){Fe.log(`${kn.logPrefix}onReceiveSpeechApplication`,s),this.emitter.emit(ze.onSpeechApplicationCancelled,s)}onSpeechApplicationTimeout(s){Fe.log(`${kn.logPrefix}onSpeechApplicationTimeout`,s),this.emitter.emit(ze.onSpeechApplicationTimeout,s)}onUserKickOffStage(s){Fe.log(`${kn.logPrefix} onUserKickOffStage`,s),this.emitter.emit(ze.onUserKickOffStage,s.data)}on(s,g,m){this.emitter.on(s,g,m)}off(s,g){this.emitter.off(s,g)}getSDKVersion(){return this.trtcService.getSDKVersion()}async destroy(){Fe.log(`${kn.logPrefix}destroy`);try{this.isLogin&&await this.logout(),this.state.reset(),this.unbindTRTCEvent(),this.trtcService.destroy(),this.unbindCoordinatorEvent(),this.roomCoordinator.destroy(),this.tSignalingService.destroy(),this.unbindIMEvent(),this.timService.destroy()}catch(s){throw s}}};let xS=kn;we(xS,"logPrefix","[TUIRoomCore]"),we(xS,"instance");const ul=xS.getInstance();window.roomcore=xS.getInstance();const s8={class:"title"},c8=Ar({__name:"IconButton",props:{title:null,iconName:null,hasMore:{type:Boolean},hideHoverEffect:{type:Boolean},disabled:{type:Boolean}},emits:["clickIcon","clickMore"],setup(i){return(s,g)=>(pt(),qt("div",{class:Nt(["icon-box",`${!i.hideHoverEffect&&"hover-effect"}`,`${i.disabled&&"disabled"}`])},[Kt("span",{class:"icon-content",onClick:g[0]||(g[0]=m=>s.$emit("clickIcon"))},[i.iconName?(pt(),nr(lb,{key:0,"icon-name":i.iconName},null,8,["icon-name"])):wn("",!0),br(s.$slots,"default",{},void 0,!0),Kt("span",s8,lo(i.title),1)]),i.hasMore?(pt(),qt("span",{key:0,ref:"moreSpanRef",class:"icon-arrow",onClick:g[1]||(g[1]=m=>s.$emit("clickMore"))},[jr(lb,{class:"arrow","icon-name":"arrow-up",size:"small"})],512)):wn("",!0)],2))}});const K8=pg(c8,[["__scopeId","data-v-e800d29f"]]);var Fw=(i=>(i.NINE_EQUAL_POINTS="nine_equal_points",i.TWENTY_FIVE_EQUAL_POINTS="twenty_five_equal_points",i.RIGHT_SIDE_LIST="right_side_list",i.TOP_SIDE_LIST="top_side_list",i.LARGE_SMALL_WINDOW="large_small_window",i))(Fw||{}),Vv=(i=>(i.SIMPLE="simple",i.DETAIL="detail",i))(Vv||{});const u1=iN("basic",{state:()=>({sdkAppId:0,userId:"",userSig:"",shareUserId:"",shareUserSig:"",userName:"",userAvatar:"",useStringRoomId:!1,roomId:0,roomMode:iu.FREE_SPEECH,isSidebarOpen:!1,layout:Fw.NINE_EQUAL_POINTS,showSettingDialog:!1,showApplyUserList:!1,activeSettingTab:"audio",isLocalStreamMirror:!0,sidebarName:"",role:null,masterUserId:"",localQuality:0,statistics:{appCpu:0,downLoss:0,localStatisticsArray:[],localStatisticsArraySize:0,receivedBytes:0,remoteStatisticsArray:[],remoteStatisticsArraySize:0,rtt:0,sentBytes:0,systemCpu:0,upLoss:0},isMuteAllAudio:!1,isMuteAllVideo:!1,canControlSelfAudio:!0,canControlSelfVideo:!0}),getters:{localVideoBitrate:i=>{const s=i.statistics.localStatisticsArray.find(g=>g.streamType===gb.TRTCVideoStreamTypeBig);return s&&s.videoBitrate?s.videoBitrate:0},localFrameRate:i=>{const s=i.statistics.localStatisticsArray.find(g=>g.streamType===gb.TRTCVideoStreamTypeBig);return s&&s.frameRate?s.frameRate:0},isMaster(i){return i.role===zr.MASTER},isAnchor(i){return i.role===zr.ANCHOR},isAudience(i){return i.role===zr.AUDIENCE},isLocalAudioIconDisable(i){const s=i.userId!==i.masterUserId&&!i.canControlSelfAudio,g=i.roomMode===iu.APPLY_SPEECH&&i.role===zr.AUDIENCE;return s||g},isLocalVideoIconDisable(i){const s=i.userId!==i.masterUserId&&!i.canControlSelfVideo,g=i.roomMode===iu.APPLY_SPEECH&&i.role===zr.AUDIENCE;return s||g}},actions:{setSdkAppId(i){this.sdkAppId=i},setUserId(i){this.userId=i},setUserSig(i){this.userSig=i},setShareUserId(i){this.shareUserId=i},setShareUserSig(i){this.shareUserSig=i},setUserName(i){this.userName=i},setUserAvatar(i){this.userAvatar=i},setRoomId(i){this.roomId=i,this.useStringRoomId=typeof i=="string"},setRoomMode(i){this.roomMode=i},setSidebarOpenStatus(i){this.isSidebarOpen=i},setSidebarName(i){this.sidebarName=i},setLayout(i){this.layout=i},setShowSettingDialog(i){this.showSettingDialog=i},setShowApplyUserList(i){this.showApplyUserList=i},setActiveSettingTab(i){this.activeSettingTab=i},setIsLocalStreamMirror(i){this.isLocalStreamMirror=i},setBasicInfo(i){const{sdkAppId:s,userId:g,userSig:m,shareUserId:R,shareUserSig:A,userName:D,userAvatar:x,roomId:$}=i;s&&this.setSdkAppId(s),g&&this.setUserId(g),m&&this.setUserSig(m),R&&this.setShareUserId(R),A&&this.setShareUserSig(A),D&&this.setUserName(D),x&&this.setUserAvatar(x),$&&this.setRoomId($)},setRole(i){this.role=i},setMasterUserId(i){this.masterUserId=i},setRoomInfo(i){const{ownerId:s,roomConfig:{isAllMicMuted:g,isAllCameraMuted:m,speechMode:R}}=i;this.masterUserId=s,this.userId===s?this.role=zr.MASTER:this.role=R===iu.APPLY_SPEECH?zr.AUDIENCE:zr.ANCHOR,this.isMuteAllAudio=g,this.isMuteAllVideo=m,this.isMuteAllAudio&&(this.canControlSelfAudio=!1),this.isMuteAllVideo&&(this.canControlSelfVideo=!1),this.roomMode=R},setLocalQuality(i){this.localQuality=i},setStatistics(i){this.statistics=i},setIsMuteAllAudio(i){this.isMuteAllAudio=i},setIsMuteAllVideo(i){this.isMuteAllVideo=i},setCanControlSelfAudio(i){this.canControlSelfAudio=i},setCanControlSelfVideo(i){this.canControlSelfVideo=i},reset(){this.isSidebarOpen=!1,this.layout=Fw.NINE_EQUAL_POINTS,this.showSettingDialog=!1,this.activeSettingTab="audio",this.isLocalStreamMirror=!0,this.sidebarName="",this.masterUserId="",this.localQuality=0,this.isMuteAllAudio=!1,this.isMuteAllVideo=!1}}}),Sd=u1(),l1=iN("room",{state:()=>({localUser:{userId:"",userName:"",userAvatar:"",mainStreamInfo:null,screenStreamInfo:null},localStream:{},remoteUserMap:new Map,isDefaultOpenCamera:!1,isDefaultOpenMicrophone:!1,isLocalAudioMuted:!1,isLocalVideoMuted:!1,hasStartedCamera:!1,hasStartedMicrophone:!1,currentCameraId:"",currentMicrophoneId:"",currentSpeakerId:"",cameraList:[],microphoneList:[],speakerList:[]}),getters:{remoteStreamMap:i=>{const s=new Map;return[...i.remoteUserMap.values()].forEach(g=>{const{userId:m,userAvatar:R,userName:A,mainStreamInfo:D,screenStreamInfo:x}=g;D&&s.set(`${m}_main`,{userId:m,userAvatar:R,userName:A,...D}),x&&s.set(`${m}_screen`,{userId:m,userAvatar:R,userName:A,...x})}),s},remoteStreamList(){return[...this.remoteStreamMap.values()]},streamList(){return[this.localStream,...this.remoteStreamMap.values()]},streamNumber(){return this.streamList.length},remoteAnchorList:i=>[...i.remoteUserMap.values()].filter(s=>s.role===zr.ANCHOR),userList:i=>[i.localUser,...i.remoteUserMap.values()],userNumber(){return this.userList.length},applyToAnchorList:i=>[...i.remoteUserMap.values()].filter(s=>s.isUserApplyingToAnchor)||[]},actions:{setLocalUser(i){Object.assign(this.localUser,i),this.localStream={type:"main",...i}},updateLocalStream(i){Object.assign(this.localStream,i)},addRemoteUser(i){const{userId:s,name:g,avatar:m}=i;if(!s||s===Sd.userId||s===`share_${Sd.userId}`)return;const R={userId:s,userName:g||"",userAvatar:m||"",mainStreamInfo:null,screenStreamInfo:null,role:zr.AUDIENCE};Sd.role===zr.MASTER&&Object.assign(R,{isAudioMutedByMaster:Sd.isMuteAllAudio,isVideoMutedByMaster:Sd.isMuteAllVideo,isChatMutedByMaster:!1,isUserApplyingToAnchor:!1,isInvitingUserToAnchor:!1}),this.remoteUserMap.set(s,R)},updateUserAVAbility(i,s){const{userId:g,name:m,avatar:R}=i;if(!(!g||g===Sd.userId||g===`share_${Sd.userId}`))if(i.userId.indexOf("share_")===0){if(!this.remoteUserMap.get(g.slice(6)))return;if(s){const A={userId:g,userName:m||"",userAvatar:R||"",role:zr.ANCHOR,mainStreamInfo:{isAudioStreamAvailable:!1,isVideoStreamAvailable:!1,type:"main"},screenStreamInfo:null};this.remoteUserMap.set(g,A)}else this.remoteUserMap.delete(g)}else{const A=this.remoteUserMap.get(g);if(!A)return;s?(A.mainStreamInfo={isAudioStreamAvailable:!1,isVideoStreamAvailable:!1,audioVolume:0,type:"main"},A.role=zr.ANCHOR):(A.mainStreamInfo=null,A.role=zr.AUDIENCE)}},updateRemoteAudioStream(i){const{userId:s,available:g}=i,m=this.remoteUserMap.get(s);if(!m)return;const R=m.mainStreamInfo||{type:"main"};m.mainStreamInfo=Object.assign(R,{isAudioStreamAvailable:!!g})},updateRemoteVideoStream(i){const{userId:s,available:g}=i,m=this.remoteUserMap.get(s);if(!m)return;const R=m.mainStreamInfo||{type:"main"};m.mainStreamInfo=Object.assign(R,{isVideoStreamAvailable:!!g})},updateRemoteScreenStream(i){const{userId:s,available:g}=i,m=this.remoteUserMap.get(s);if(!!m)if(g){const R=m.screenStreamInfo||{type:"screen"};m.screenStreamInfo=Object.assign(R,{isScreenStreamAvailable:!!g})}else m.screenStreamInfo=null},removeRemoteUser(i){!i||i===Sd.userId||i===`share_${Sd.userId}`||this.remoteUserMap.delete(i)},setAudioVolume(i){i.forEach(s=>{const{userId:g,audioVolume:m}=s;if((g===Sd.userId||g==="local")&&this.localStream)this.localStream.audioVolume=m;else{const R=this.remoteUserMap.get(g);R&&R.mainStreamInfo&&(R.mainStreamInfo.audioVolume=m)}})},setCurrentCameraId(i){this.currentCameraId=i},setCurrentMicrophoneId(i){this.currentMicrophoneId=i},setCurrentSpeakerId(i){this.currentSpeakerId=i},setRoomParam(i){if(!i)return;const s=u1(),{isOpenCamera:g,isOpenMicrophone:m,defaultCameraId:R,defaultMicrophoneId:A,defaultSpeakerId:D}=i;R&&this.setCurrentCameraId(R),A&&this.setCurrentMicrophoneId(A),D&&this.setCurrentSpeakerId(D),(s.isMaster||!s.isMuteAllAudio&&s.roomMode!==iu.APPLY_SPEECH)&&typeof m=="boolean"&&(this.isDefaultOpenMicrophone=m),(s.isMaster||!s.isMuteAllVideo&&s.roomMode!==iu.APPLY_SPEECH)&&typeof g=="boolean"&&(this.isDefaultOpenCamera=g)},setHasStartedCamera(i){this.hasStartedCamera=i},setHasStartedMicrophone(i){this.hasStartedMicrophone=i},setIsLocalAudioMuted(i){this.isLocalAudioMuted=i},setIsLocalVideoMuted(i){this.isLocalVideoMuted=i},setCameraList(i){this.cameraList=i,this.currentCameraId||this.setCurrentCameraId(i[0].deviceId)},setMicrophoneList(i){this.microphoneList=i,this.currentMicrophoneId||this.setCurrentMicrophoneId(i[0].deviceId)},setSpeakerList(i){this.speakerList=i,this.currentSpeakerId||this.setCurrentSpeakerId(i[0].deviceId)},setMuteUserAudio(i,s){const g=this.remoteUserMap.get(i);g&&(g.isAudioMutedByMaster=s)},setMuteAllAudio(i){Array.from(this.remoteUserMap.values()).forEach(g=>{Object.assign(g,{isAudioMutedByMaster:i})})},setMuteUserVideo(i,s){const g=this.remoteUserMap.get(i);g&&(g.isVideoMutedByMaster=s)},setMuteAllVideo(i){Array.from(this.remoteUserMap.values()).forEach(g=>{Object.assign(g,{isVideoMutedByMaster:i})})},setMuteUserChat(i,s){const g=this.remoteUserMap.get(i);g&&(g.isChatMutedByMaster=s)},addApplyToAnchorUser(i){const s=this.remoteUserMap.get(i);s&&(s.isUserApplyingToAnchor=!0)},removeApplyToAnchorUser(i){const s=this.remoteUserMap.get(i);s&&(s.isUserApplyingToAnchor=!1)},addInviteToAnchorUser(i){const s=this.remoteUserMap.get(i);s&&(s.isInvitingUserToAnchor=!0)},removeInviteToAnchorUser(i){const s=this.remoteUserMap.get(i);s&&(s.isInvitingUserToAnchor=!1)},reset(){this.localUser={userId:"",userAvatar:"",userName:"",mainStreamInfo:null,screenStreamInfo:null},this.remoteUserMap=new Map,this.isDefaultOpenCamera=!1,this.isDefaultOpenMicrophone=!1,this.isLocalAudioMuted=!1,this.isLocalVideoMuted=!1,this.hasStartedCamera=!1,this.hasStartedMicrophone=!1}}}),u8=Ar({__name:"DeviceSelect",props:{deviceType:null,onChange:null,disabled:null},setup(i){const{deviceType:s,onChange:g,disabled:m=!1}=i,R=l1(),{currentCameraId:A,currentMicrophoneId:D,currentSpeakerId:x}=oN(R);function $(){return s==="camera"?A:s==="microphone"?D:s==="speaker"?x:""}const B=Ft([]),te=Ft($());jn(te,async W=>{switch(s){case"camera":await ul.setCurrentCamera(W),R.setCurrentCameraId(W);break;case"microphone":await ul.setCurrentMicrophone(W),R.setCurrentMicrophoneId(W);break;case"speaker":await ul.setCurrentSpeaker(W),R.setCurrentSpeakerId(W);break}});function re(W){g&&g(W)}async function ie(){switch(s){case"camera":B.value=await ul.getCameraList();break;case"microphone":B.value=await ul.getMicrophoneList();break;case"speaker":B.value=await ul.getSpeakerList();break}}return Ba(()=>{navigator.mediaDevices.addEventListener("devicechange",ie),ie()}),yb(()=>{navigator.mediaDevices.removeEventListener("devicechange",ie)}),(W,Y)=>{const se=pL,Ae=hL;return pt(),nr(Ae,{modelValue:te.value,"onUpdate:modelValue":Y[0]||(Y[0]=Je=>te.value=Je),placeholder:"placeholder",class:"select custom-element-class",disabled:i.disabled,teleported:!1,onChange:re},{default:Zn(()=>[(pt(!0),qt(ic,null,qS(B.value,Je=>(pt(),nr(se,{key:Je.deviceId,label:Je.deviceName,value:Je.deviceId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])}}});const Vw=pg(u8,[["__scopeId","data-v-54dc5a5b"]]),d1=i=>(aN("data-v-bca9697d"),i=i(),sN(),i),l8={class:"audio-setting-tab"},d8={class:"item-setting"},h8=d1(()=>Kt("span",{class:"title"},"\u9EA6\u514B\u98CE",-1)),p8={class:"flex"},f8={class:"item-setting"},g8=d1(()=>Kt("span",{class:"title"},"\u8F93\u51FA",-1)),m8={class:"mic-bar-container"},v8={class:"item-setting"},_8=d1(()=>Kt("span",{class:"title"},"\u626C\u58F0\u5668",-1)),y8={class:"flex"},S8=Ar({__name:"AudioSettingTab",props:{mode:null},setup(i){const g=i.mode||Vv.SIMPLE,m=It(()=>g===Vv.SIMPLE),R=It(()=>g===Vv.DETAIL),A=l1(),D=It(()=>R.value?36:28),x=It(()=>(A.localStream.audioVolume||0)*D.value/100),$=It(()=>m.value||R.value&&B.value),B=Ft(!1);function te(){B.value=!B.value}const re=Ft(!1),ie=document.createElement("audio");function W(){re.value?(ie.pause(),ie.currentTime=0,re.value=!1):(re.value=!0,ie.src="https://web.sdk.qcloud.com/trtc/electron/download/resources/media/TestSpeaker.mp3",ie.play())}return op(()=>{ie.pause()}),(Y,se)=>(pt(),qt("div",l8,[Kt("div",{class:Nt(["item-setting-container",_e(m)&&"hasDividingLine"])},[Kt("div",d8,[h8,Kt("div",p8,[jr(Vw,{class:Nt(_e(R)?"detail-select":""),"device-type":"microphone"},null,8,["class"]),_e(R)?(pt(),qt("div",{key:0,class:"button",onClick:te},lo(B.value?"\u505C\u6B62\u6D4B\u8BD5":"\u6D4B\u8BD5"),1)):wn("",!0)])]),Kt("div",f8,[g8,Kt("div",m8,[(pt(!0),qt(ic,null,qS(new Array(_e(D)).fill(""),(Ae,Je)=>(pt(),qt("div",{key:Je,class:Nt(["mic-bar",`${_e($)&&_e(x)>Je?"active":""}`])},null,2))),128))])])],2),Kt("div",{class:Nt(["item-setting-container",_e(m)&&"hasDividingLine"])},[Kt("div",v8,[_8,Kt("div",y8,[jr(Vw,{class:Nt(_e(R)?"detail-select":""),"device-type":"speaker"},null,8,["class"]),_e(R)?(pt(),qt("div",{key:0,class:"button",onClick:W},lo(re.value?"\u505C\u6B62\u6D4B\u8BD5":"\u6D4B\u8BD5"),1)):wn("",!0)])])],2)]))}});const W8=pg(S8,[["__scopeId","data-v-bca9697d"]]);const I8=Ar({__name:"VideoProfile",setup(i){const s=Ft("720P"),g=[{label:"\u6D41\u7545\uFF08360P\uFF0C15FPS\uFF09",value:"360P"},{label:"\u6807\u6E05\uFF08540P\uFF0C15FPS\uFF09",value:"540P"},{label:"\u9AD8\u6E05\uFF08720P\uFF0C30FPS\uFF09",value:"720P"},{label:"\u8D85\u6E05\uFF081080P\uFF0C30FPS\uFF09",value:"1080P"}],m={"360P":{videoResolution:iT.TRTCVideoResolution_640_360,fps:15,bitrate:800},"540P":{videoResolution:iT.TRTCVideoResolution_960_540,fps:15,bitrate:900},"720P":{videoResolution:iT.TRTCVideoResolution_1280_720,fps:30,bitrate:1500},"1080P":{videoResolution:iT.TRTCVideoResolution_1920_1080,fps:30,bitrate:2e3}};return jn(s,R=>{const A=m[R];ul.setVideoEncoderParam(A)}),(R,A)=>{const D=pL,x=hL;return pt(),nr(x,{modelValue:s.value,"onUpdate:modelValue":A[0]||(A[0]=$=>s.value=$),placeholder:"placeholder",class:"select custom-element-class",teleported:!1},{default:Zn(()=>[(pt(),qt(ic,null,qS(g,($,B)=>jr(D,{key:B,label:$.label,value:$.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])}}});const E8=pg(I8,[["__scopeId","data-v-63b099df"]]),h1=i=>(aN("data-v-51dbcfd6"),i=i(),sN(),i),T8={class:"video-tab"},M8={class:"item-setting"},R8=h1(()=>Kt("span",{class:"title"},"\u6444\u50CF\u5934",-1)),C8={key:0,class:"item-setting"},b8=h1(()=>Kt("span",{class:"title"},"\u89C6\u9891\u753B\u9762",-1)),A8=h1(()=>Kt("span",{class:"title"},"\u5206\u8FA8\u7387",-1)),k8=Ar({__name:"VideoSettingTab",props:{mode:null},setup(i){const g=i.mode||Vv.SIMPLE,m=It(()=>g===Vv.SIMPLE),R=It(()=>g===Vv.DETAIL),A=Ft(),D=u1(),x=Ft(D.isLocalStreamMirror);jn(x,re=>{ul.setVideoMirror(re),D.setIsLocalStreamMirror(re)});const $=l1(),{currentCameraId:B}=oN($);function te(){D.setShowSettingDialog(!0),D.setActiveSettingTab("video")}return R.value&&(jn(B,re=>{ul.setCurrentCamera(re)}),Ba(()=>{ul.startCameraDeviceTest(A.value)}),yb(()=>{ul.stopCameraDeviceTest()})),(re,ie)=>{const W=jB;return pt(),qt("div",T8,[Kt("div",{class:Nt(["item-setting-container",_e(m)&&"hasDividingLine"])},[Kt("div",M8,[R8,jr(Vw,{class:Nt(_e(R)?"detail-select":""),"device-type":"camera"},null,8,["class"])]),_e(R)?(pt(),qt("div",C8,[b8,Kt("div",{ref_key:"testCameraPreviewRef",ref:A,class:"video-preview"},null,512),_e(R)?(pt(),nr(W,{key:0,modelValue:x.value,"onUpdate:modelValue":ie[0]||(ie[0]=Y=>x.value=Y),class:"mirror-checkbox custom-element-class",label:"\u7FFB\u8F6C\u955C\u50CF"},null,8,["modelValue"])):wn("",!0)])):wn("",!0)],2),_e(m)?(pt(),qt("div",{key:0,class:Nt(["item-setting-container",_e(m)&&"hasDividingLine"])},[A8,jr(E8)],2)):wn("",!0),_e(m)?(pt(),qt("div",{key:1,class:Nt(["item-setting-container",_e(m)&&"hasDividingLine"])},[Kt("div",{class:"item",onClick:te},"\u66F4\u591A\u6444\u50CF\u5934\u8BBE\u7F6E")],2)):wn("",!0)])}}});const z8=pg(k8,[["__scopeId","data-v-51dbcfd6"]]),w8={class:"audio-level"},D8=Ar({__name:"AudioIcon",props:{audioVolume:null,isMuted:{type:Boolean},size:null,isDisabled:{type:Boolean}},setup(i){const s=i,g=It(()=>s.isDisabled?FS.MicOffDisabled:s.isMuted?FS.MicOff:FS.MicOn),m=It(()=>s.isMuted||!s.audioVolume?0:s.audioVolume*4/100*5);return(R,A)=>(pt(),qt("div",{class:Nt(["audio-icon-container",`${i.size=="small"&&"small"}`])},[Kt("div",w8,[(pt(!0),qt(ic,null,qS(new Array(5).fill(""),(D,x)=>(pt(),qt("div",{key:x,class:Nt(["audio-level-item",["audio-level-item",`${_e(m)>x&&"active"}`]])},null,2))),128))]),jr(lb,{class:"audio-icon","icon-name":_e(g)},null,8,["icon-name"])],2))}});const Y8=pg(D8,[["__scopeId","data-v-d5555e3c"]]);export{IN as $,Y8 as A,ZB as B,x8 as C,e5 as D,ze as E,j6 as F,t5 as G,F3 as H,K8 as I,XB as J,tL as K,rL as L,i1 as M,$S as N,yB as O,V8 as P,v3 as Q,Xo as R,Vv as S,ul as T,L8 as U,z8 as V,AN as W,B8 as X,zw as Y,P8 as Z,$i as _,H8 as a,y3 as a0,Mo as a1,G8 as a2,Uv as a3,Rb as a4,U8 as a5,dO as a6,GN as a7,fT as a8,F8 as a9,l4 as aa,pb as ab,P3 as ac,Nw as ad,u1 as ae,Fw as af,Fe as ag,ru as ah,w5 as ai,s2 as aj,iT as ak,k5 as al,$8 as am,zr as an,rT as ao,pL as ap,hL as aq,iu as ar,IB as as,rg as at,FS as b,W8 as c,lb as d,gT as e,Ro as f,Hi as g,Ww as h,Id as i,Lw as j,M3 as k,JV as l,R3 as m,t0 as n,k3 as o,WS as p,np as q,bb as r,vT as s,Ri as t,l1 as u,j8 as v,cp as w,QB as x,q8 as y,Ab as z};
